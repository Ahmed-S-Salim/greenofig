import{j as e}from"./vendor-ui-B996hA52.js";import{a as s,L as t,h as a}from"./vendor-react-sNAoBuc2.js";import{u as r,s as l,B as i,I as n,T as c,t as d,f as o,e as m,H as x}from"./index-KPc8XEHt.js";import{E as u,a as h}from"./EnhancedBlogManager-C3XiFbPM.js";import{C as p,b as g,c as j,a as f,d as v}from"./card-C0GamSXr.js";import{K as b,b3 as N,s as y,J as _,a7 as w,a as k,G as C,b4 as S,N as M,aa as E,U as A,R as F,b5 as D,Q as R,X as I,Y as P,V as z,b6 as q,ad as T,ak as L,j as O,am as W,av as $,aw as U,ah as B,P as K,ai as V,az as G,T as H,b7 as Y,b8 as J,c as Z,b9 as Q,o as X,ba as ee,bb as se,F as te,bc as ae,bd as re,be as le,bf as ie,h as ne,r as ce,bg as de,f as oe,ae as me,n as xe,bh as ue,m as he,aj as pe,I as ge,al as je,O as fe,W as ve,u as be,bi as Ne,bj as ye,bk as _e,bl as we,_ as ke,$ as Ce,a0 as Se,ac as Me,y as Ee,bm as Ae,ar as Fe,ao as De,l as Re,bn as Ie,bo as Pe,bp as ze,bq as qe,br as Te,aJ as Le}from"./vendor-utils-cF2MmNet.js";import{T as Oe,a as We,b as $e,c as Ue}from"./tabs-CCjRZmIk.js";import{D as Be,b as Ke,c as Ve,d as Ge,f as He}from"./dialog-CPlPvohX.js";import{S as Ye}from"./switch-BI5ASXWN.js";import"./checkbox-BxdA3OOk.js";import"./vendor-editor-DcuCxt3Z.js";const Je=()=>{const{user:a}=r(),[n,c]=s.useState({totalClients:0,activeClients:0,activeMealPlans:0,upcomingAppointments:0}),[d,o]=s.useState([]),[m,x]=s.useState([]),[u,h]=s.useState([]),[v,A]=s.useState(!0);s.useEffect(()=>{a&&F()},[a]);const F=async()=>{A(!0);try{const{data:e,error:s}=await l.from("user_profiles").select("id, full_name, email, created_at").eq("role","user");if(s)throw s;const{data:t,error:r}=await l.from("meal_plans_v2").select("id, name, status").eq("nutritionist_id",a.id).eq("status","active"),i=new Date;i.setHours(0,0,0,0);const n=new Date(i);n.setDate(n.getDate()+1);const{data:d,error:m}=await l.from("appointments").select("*, user_profiles!appointments_client_id_fkey(full_name)").eq("nutritionist_id",a.id).gte("appointment_date",i.toISOString()).order("appointment_date",{ascending:!0}).limit(10),u=d?.filter(e=>{const s=new Date(e.appointment_date);return s>=i&&s<n})||[];c({totalClients:e?.length||0,activeClients:e?.length||0,activeMealPlans:t?.length||0,upcomingAppointments:d?.length||0}),o(u),x([{id:1,type:"client_joined",message:"New client registered",time:"2 hours ago"},{id:2,type:"meal_plan",message:"Meal plan created for Sarah Johnson",time:"5 hours ago"},{id:3,type:"appointment",message:"Consultation completed with Mike Chen",time:"1 day ago"}]),h([{id:1,message:"3 clients need follow-up this week",priority:"high"},{id:2,message:"2 meal plans pending review",priority:"medium"}])}catch(e){console.error("Error fetching dashboard data:",e)}finally{A(!1)}},D=({icon:s,label:t,value:a,change:r,color:l})=>e.jsx(p,{className:"bg-card border-border",children:e.jsx(f,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:t}),e.jsx("h3",{className:"text-3xl font-bold text-foreground",children:a}),r&&e.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400 mt-1 flex items-center gap-1",children:[e.jsx(_,{className:"w-4 h-4"}),r]})]}),e.jsx("div",{className:`p-4 rounded-full ${l||"bg-primary/10"}`,children:e.jsx(s,{className:"w-6 h-6 "+(l?"text-primary-foreground":"text-primary")})})]})})});return v?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(D,{icon:b,label:"Total Clients",value:n.totalClients,change:"+12% this month"}),e.jsx(D,{icon:N,label:"Active Meal Plans",value:n.activeMealPlans,color:"bg-green-600 dark:bg-green-700"}),e.jsx(D,{icon:y,label:"Upcoming Appointments",value:n.upcomingAppointments,color:"bg-blue-600 dark:bg-blue-700"}),e.jsx(D,{icon:_,label:"Client Success Rate",value:"87%",change:"+5% this month",color:"bg-purple-600 dark:bg-purple-700"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(p,{className:"lg:col-span-2 bg-card border-border",children:[e.jsx(g,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(j,{className:"flex items-center gap-2 text-foreground",children:[e.jsx(w,{className:"w-5 h-5"}),"Today's Schedule"]}),e.jsx(i,{variant:"ghost",size:"sm",asChild:!0,children:e.jsxs(t,{to:"/app/nutritionist?tab=schedule",children:["View All ",e.jsx(k,{className:"w-4 h-4 ml-1"})]})})]})}),e.jsx(f,{children:d.length>0?e.jsx("div",{className:"space-y-3",children:d.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg hover:bg-muted transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-600 dark:bg-green-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground",children:s.user_profiles?.full_name||"Client"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.consultation_type||"Consultation"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:C(new Date(s.appointment_date),"h:mm a")}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.duration_minutes," min"]})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(y,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No appointments scheduled for today"})]})})]}),e.jsxs(p,{className:"bg-card border-border",children:[e.jsx(g,{children:e.jsxs(j,{className:"flex items-center gap-2 text-foreground",children:[e.jsx(S,{className:"w-5 h-5"}),"Action Items"]})}),e.jsx(f,{children:e.jsx("div",{className:"space-y-3",children:u.map(s=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg border "+("high"===s.priority?"bg-red-50/50 dark:bg-red-950/20 border-red-200 dark:border-red-900":"bg-yellow-50/50 dark:bg-yellow-950/20 border-yellow-200 dark:border-yellow-900"),children:[e.jsx(M,{className:"w-5 h-5 flex-shrink-0 "+("high"===s.priority?"text-red-600 dark:text-red-400":"text-yellow-600 dark:text-yellow-400")}),e.jsx("p",{className:"text-sm text-foreground",children:s.message})]},s.id))})})]})]}),e.jsxs(p,{className:"bg-card border-border",children:[e.jsx(g,{children:e.jsx(j,{className:"text-foreground",children:"Recent Activity"})}),e.jsx(f,{children:e.jsx("div",{className:"space-y-4",children:m.map(s=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-foreground",children:s.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.time})]}),e.jsx(E,{className:"w-4 h-4 text-green-600 dark:text-green-400"})]},s.id))})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(i,{asChild:!0,className:"h-20 text-lg",variant:"outline",children:e.jsxs(t,{to:"/app/nutritionist?tab=clients",children:[e.jsx(b,{className:"w-5 h-5 mr-2"}),"Manage Clients"]})}),e.jsx(i,{asChild:!0,className:"h-20 text-lg",variant:"outline",children:e.jsxs(t,{to:"/app/nutritionist?tab=meals",children:[e.jsx(N,{className:"w-5 h-5 mr-2"}),"Create Meal Plan"]})}),e.jsx(i,{asChild:!0,className:"h-20 text-lg",variant:"outline",children:e.jsxs(t,{to:"/app/nutritionist?tab=schedule",children:[e.jsx(y,{className:"w-5 h-5 mr-2"}),"Schedule Appointment"]})})]})]})},Ze=({client:t,open:a,onOpenChange:o,onUpdate:m})=>{const{user:x}=r(),[u,h]=s.useState("overview"),[v,b]=s.useState([]),[N,y]=s.useState(null),[_,w]=s.useState(""),[k,S]=s.useState({weight_kg:"",body_fat_percentage:"",waist_cm:"",hips_cm:""}),[M,E]=s.useState(!1);s.useEffect(()=>{a&&t&&W()},[a,t]);const W=async()=>{try{const{data:e}=await l.from("client_progress").select("*").eq("client_id",t.id).order("date",{ascending:!0});b(e||[]);const{data:s}=await l.from("client_health_data").select("*").eq("client_id",t.id).single();y(s),w(t.nutritionist_notes||"")}catch(e){console.error("Error fetching client data:",e)}};return e.jsx(Be,{open:a,onOpenChange:o,children:e.jsxs(Ke,{className:"glass-effect custom-scrollbar max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ve,{children:e.jsxs(Ge,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5"}),t?.full_name]})}),e.jsxs(Oe,{value:u,onValueChange:h,children:[e.jsxs(We,{className:"grid w-full grid-cols-3",children:[e.jsx($e,{value:"overview",children:"Overview"}),e.jsx($e,{value:"progress",children:"Progress Tracking"}),e.jsx($e,{value:"notes",children:"Notes"})]}),e.jsxs(Ue,{value:"overview",className:"space-y-4",children:[e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(j,{children:"Basic Information"})}),e.jsxs(f,{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Email"}),e.jsx("p",{className:"font-medium",children:t?.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Age"}),e.jsx("p",{className:"font-medium",children:t?.age||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Height"}),e.jsx("p",{className:"font-medium",children:t?.height_cm?`${t.height_cm} cm`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Current Weight"}),e.jsx("p",{className:"font-medium",children:t?.latestWeight?`${t.latestWeight} kg`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"BMI"}),e.jsx("p",{className:"font-medium",children:((e,s)=>{if(!e||!s)return"N/A";const t=s/100;return(e/(t*t)).toFixed(1)})(t?.latestWeight,t?.height_cm)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Activity Level"}),e.jsx("p",{className:"font-medium capitalize",children:t?.activity_level?.replace("_"," ")||"N/A"})]})]})]}),N&&e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(j,{children:"Health Information"})}),e.jsxs(f,{className:"space-y-3",children:[N.allergies&&N.allergies.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Allergies"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:N.allergies.map((s,t)=>e.jsx("span",{className:"px-2 py-1 bg-destructive/10 text-destructive rounded text-sm",children:s},t))})]}),N.dietary_restrictions&&N.dietary_restrictions.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Dietary Restrictions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:N.dietary_restrictions.map((s,t)=>e.jsx("span",{className:"px-2 py-1 bg-amber-500/10 text-amber-600 rounded text-sm",children:s},t))})]})]})]})]}),e.jsxs(Ue,{value:"progress",className:"space-y-4",children:[v.length>0&&e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(j,{children:"Weight Trend"})}),e.jsx(f,{children:e.jsx(F,{width:"100%",height:300,children:e.jsxs(D,{data:v,children:[e.jsx(R,{strokeDasharray:"3 3"}),e.jsx(I,{dataKey:"date",tickFormatter:e=>C(new Date(e),"MMM d")}),e.jsx(P,{}),e.jsx(z,{labelFormatter:e=>C(new Date(e),"MMM d, yyyy")}),e.jsx(q,{type:"monotone",dataKey:"weight_kg",stroke:"hsl(var(--primary))",strokeWidth:2,dot:{fill:"hsl(var(--primary))"}})]})})})]}),e.jsxs(p,{children:[e.jsx(g,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),"Add Progress Entry"]})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Weight (kg) *"}),e.jsx(n,{type:"number",step:"0.1",value:k.weight_kg,onChange:e=>S({...k,weight_kg:e.target.value}),placeholder:"70.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Body Fat %"}),e.jsx(n,{type:"number",step:"0.1",value:k.body_fat_percentage,onChange:e=>S({...k,body_fat_percentage:e.target.value}),placeholder:"20.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Waist (cm)"}),e.jsx(n,{type:"number",step:"0.1",value:k.waist_cm,onChange:e=>S({...k,waist_cm:e.target.value}),placeholder:"80"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Hips (cm)"}),e.jsx(n,{type:"number",step:"0.1",value:k.hips_cm,onChange:e=>S({...k,hips_cm:e.target.value}),placeholder:"95"})]})]}),e.jsx(i,{onClick:async()=>{if(k.weight_kg){E(!0);try{const{error:e}=await l.from("client_progress").insert({client_id:t.id,nutritionist_id:x.id,...k});if(e)throw e;d({title:"Progress added",description:"Client progress has been recorded"}),S({weight_kg:"",body_fat_percentage:"",waist_cm:"",hips_cm:""}),W(),m&&m()}catch(e){console.error("Error adding progress:",e),d({variant:"destructive",title:"Error",description:"Failed to add progress"})}finally{E(!1)}}else d({variant:"destructive",title:"Error",description:"Weight is required"})},disabled:M,className:"w-full",children:M?"Saving...":"Add Progress"})]})]}),v.length>0&&e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(j,{children:"Progress History"})}),e.jsx(f,{children:e.jsx("div",{className:"space-y-2",children:v.slice().reverse().map(s=>e.jsx("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:C(new Date(s.date),"MMMM d, yyyy")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Weight: ",s.weight_kg," kg",s.body_fat_percentage&&` • Body Fat: ${s.body_fat_percentage}%`]})]})},s.id))})})]})]}),e.jsx(Ue,{value:"notes",className:"space-y-4",children:e.jsxs(p,{children:[e.jsx(g,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5"}),"Private Notes"]})}),e.jsxs(f,{className:"space-y-4",children:[e.jsx(c,{value:_,onChange:e=>w(e.target.value),placeholder:"Add private notes about this client...",rows:10}),e.jsxs(i,{onClick:async()=>{E(!0);try{const{error:e}=await l.from("user_profiles").update({nutritionist_notes:_}).eq("id",t.id);if(e)throw e;d({title:"Notes saved",description:"Your notes have been saved successfully"}),m&&m()}catch(e){console.error("Error saving notes:",e),d({variant:"destructive",title:"Error",description:"Failed to save notes"})}finally{E(!1)}},disabled:M,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),M?"Saving...":"Save Notes"]})]})]})})]})]})})},Qe=()=>{const{user:t}=r(),[a,c]=s.useState([]),[d,o]=s.useState([]),[m,x]=s.useState(""),[u,h]=s.useState("all"),[g,j]=s.useState(null),[v,N]=s.useState(!1),[w,k]=s.useState(!0);s.useEffect(()=>{S()},[t]),s.useEffect(()=>{M()},[m,u,a]);const S=async()=>{k(!0);try{const{data:e,error:s}=await l.from("user_profiles").select("*").eq("role","user").order("created_at",{ascending:!1});if(s)throw s;const t=await Promise.all((e||[]).map(async e=>{const{data:s}=await l.from("client_progress").select("*").eq("client_id",e.id).order("date",{ascending:!1}).limit(2),t=s?.[0],a=s?.[1];return{...e,latestWeight:t?.weight_kg,weightChange:t&&a?(t.weight_kg-a.weight_kg).toFixed(1):null,lastUpdate:t?.date}}));c(t)}catch(e){console.error("Error fetching clients:",e)}finally{k(!1)}},M=()=>{let e=a;m&&(e=e.filter(e=>e.full_name?.toLowerCase().includes(m.toLowerCase())||e.email?.toLowerCase().includes(m.toLowerCase()))),"active"===u?e=e.filter(e=>e.lastUpdate):"inactive"===u&&(e=e.filter(e=>!e.lastUpdate)),o(e)},E=e=>{j(e),N(!0)},A=({client:s})=>{const t=((e,s)=>{if(!e||!s)return"N/A";const t=s/100;return(e/(t*t)).toFixed(1)})(s.latestWeight,s.height_cm),a=s.weightChange&&parseFloat(s.weightChange)<0;return e.jsx(p,{className:"glass-effect hover:shadow-lg transition-all cursor-pointer h-full flex flex-col",onClick:()=>E(s),children:e.jsxs(f,{className:"p-6 flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-lg font-bold text-primary",children:s.full_name?.split(" ").map(e=>e[0]).join("")||"?"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg truncate",children:s.full_name||"Unknown"}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.email})]})]}),e.jsx("div",{className:"px-2 py-1 rounded-full text-xs font-medium whitespace-nowrap flex-shrink-0 ml-2 "+(s.lastUpdate?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"),children:s.lastUpdate?"Active":"Inactive"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Current Weight"}),e.jsx("p",{className:"text-lg font-bold",children:s.latestWeight?`${s.latestWeight} kg`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"BMI"}),e.jsx("p",{className:"text-lg font-bold",children:t})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Progress"}),s.weightChange?e.jsxs("p",{className:"text-lg font-bold flex items-center gap-1 "+(a?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[a?e.jsx($,{className:"w-4 h-4"}):e.jsx(_,{className:"w-4 h-4"}),Math.abs(s.weightChange)," kg"]}):e.jsx("p",{className:"text-lg font-bold text-muted-foreground",children:"-"})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("span",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(y,{className:"w-4 h-4"}),s.lastUpdate?C(new Date(s.lastUpdate),"MMM d, yyyy"):"No updates"]})}),e.jsx(i,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),E(s)},children:"View Profile"})]})]})})};return w?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(b,{className:"w-8 h-8 text-primary"}),"Client Management"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage and track your clients' progress"})]})}),e.jsx(p,{className:"glass-effect",children:e.jsx(f,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(W,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(n,{placeholder:"Search clients by name or email...",value:m,onChange:e=>x(e.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{variant:"all"===u?"default":"outline",onClick:()=>h("all"),children:["All (",a.length,")"]}),e.jsx(i,{variant:"active"===u?"default":"outline",onClick:()=>h("active"),children:"Active"}),e.jsx(i,{variant:"inactive"===u?"default":"outline",onClick:()=>h("inactive"),children:"Inactive"})]})]})})}),d.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 md:gap-6",children:d.map(s=>e.jsx(A,{client:s},s.id))}):e.jsx(p,{className:"glass-effect",children:e.jsxs(f,{className:"p-12 text-center",children:[e.jsx(b,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No clients found"}),e.jsx("p",{className:"text-muted-foreground",children:m?"Try adjusting your search":"Your clients will appear here"})]})}),g&&e.jsx(Ze,{client:g,open:v,onOpenChange:N,onUpdate:S})]})},Xe=({onSelectRecipe:t})=>{const{user:a}=r(),[m,x]=s.useState([]),[u,h]=s.useState([]),[g,j]=s.useState(""),[v,N]=s.useState("all"),[y,_]=s.useState(!1),[k,C]=s.useState(null),[S,M]=s.useState(!0),[E,A]=s.useState(!1),[F,D]=s.useState({name:"",description:"",category:"breakfast",servings:1,prep_time_minutes:0,cook_time_minutes:0,ingredients:[{name:"",amount:"",unit:""}],instructions:[""],calories_per_serving:0,protein_g:0,carbs_g:0,fat_g:0,fiber_g:0,tags:[],is_public:!1}),R=["breakfast","lunch","dinner","snack","dessert"];s.useEffect(()=>{I()},[a]),s.useEffect(()=>{P()},[g,v,m]);const I=async()=>{M(!0);try{const{data:e,error:s}=await l.from("recipes").select("*").or(`nutritionist_id.eq.${a.id},is_public.eq.true`).order("created_at",{ascending:!1});if(s)throw s;x(e||[])}catch(e){console.error("Error fetching recipes:",e),d({variant:"destructive",title:"Error",description:"Failed to fetch recipes"})}finally{M(!1)}},P=()=>{let e=m;g&&(e=e.filter(e=>e.name?.toLowerCase().includes(g.toLowerCase())||e.description?.toLowerCase().includes(g.toLowerCase()))),"all"!==v&&(e=e.filter(e=>e.category===v)),h(e)},z=(e=null)=>{e?(C(e),D({...e,ingredients:e.ingredients||[{name:"",amount:"",unit:""}],instructions:e.instructions||[""],tags:e.tags||[]})):(C(null),D({name:"",description:"",category:"breakfast",servings:1,prep_time_minutes:0,cook_time_minutes:0,ingredients:[{name:"",amount:"",unit:""}],instructions:[""],calories_per_serving:0,protein_g:0,carbs_g:0,fat_g:0,fiber_g:0,tags:[],is_public:!1})),_(!0)},q=(e,s,t)=>{const a=[...F.ingredients];a[e][s]=t,D({...F,ingredients:a})},L=({recipe:s})=>e.jsx(p,{className:"glass-effect hover:shadow-lg transition-all cursor-pointer group",children:e.jsxs(f,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",onClick:()=>t&&t(s),children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.description})]}),e.jsxs("div",{className:"flex gap-1 ml-2",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),z(s)},children:e.jsx(K,{className:"w-4 h-4"})}),s.nutritionist_id===a.id&&e.jsx(i,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),(async e=>{if(confirm("Are you sure you want to delete this recipe?"))try{const{error:s}=await l.from("recipes").delete().eq("id",e);if(s)throw s;d({title:"Recipe deleted successfully"}),I()}catch(s){console.error("Error deleting recipe:",s),d({variant:"destructive",title:"Error",description:"Failed to delete recipe"})}})(s.id)},className:"text-destructive hover:text-destructive",children:e.jsx(V,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx(o,{variant:"outline",className:"capitalize",children:s.category}),s.tags?.slice(0,2).map(s=>e.jsx(o,{variant:"secondary",children:s},s))]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:[(s.prep_time_minutes||0)+(s.cook_time_minutes||0)," min"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:[s.servings," servings"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:[s.calories_per_serving||0," cal"]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[s.protein_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Protein"})]}),e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[s.carbs_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Carbs"})]}),e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[s.fat_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Fat"})]}),e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[s.fiber_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Fiber"})]})]})]})});return S?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(U,{className:"w-8 h-8 text-primary"}),"Recipe Database"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Create and manage your recipe library"})]}),e.jsxs(i,{onClick:()=>z(),children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"New Recipe"]})]}),e.jsx(p,{className:"glass-effect",children:e.jsx(f,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(W,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(n,{placeholder:"Search recipes...",value:g,onChange:e=>j(e.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(i,{variant:"all"===v?"default":"outline",onClick:()=>N("all"),size:"sm",children:"All"}),R.map(s=>e.jsx(i,{variant:v===s?"default":"outline",onClick:()=>N(s),size:"sm",className:"capitalize",children:s},s))]})]})})}),u.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:u.map(s=>e.jsx(L,{recipe:s},s.id))}):e.jsx(p,{className:"glass-effect",children:e.jsxs(f,{className:"p-12 text-center",children:[e.jsx(U,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No recipes found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:g||"all"!==v?"Try adjusting your filters":"Create your first recipe to get started"}),e.jsxs(i,{onClick:()=>z(),children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Create Recipe"]})]})}),e.jsx(Be,{open:y,onOpenChange:_,children:e.jsxs(Ke,{className:"glass-effect custom-scrollbar max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ve,{children:e.jsx(Ge,{children:k?"Edit Recipe":"Create New Recipe"})}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Recipe Name *"}),e.jsx(n,{value:F.name,onChange:e=>D({...F,name:e.target.value}),placeholder:"e.g., Grilled Chicken Salad"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Description"}),e.jsx(c,{value:F.description,onChange:e=>D({...F,description:e.target.value}),placeholder:"Brief description of the recipe",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Category"}),e.jsx("select",{value:F.category,onChange:e=>D({...F,category:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:R.map(s=>e.jsx("option",{value:s,className:"capitalize",children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Servings"}),e.jsx(n,{type:"number",min:"1",value:F.servings,onChange:e=>D({...F,servings:parseInt(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Prep Time (min)"}),e.jsx(n,{type:"number",min:"0",value:F.prep_time_minutes,onChange:e=>D({...F,prep_time_minutes:parseInt(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Cook Time (min)"}),e.jsx(n,{type:"number",min:"0",value:F.cook_time_minutes,onChange:e=>D({...F,cook_time_minutes:parseInt(e.target.value)})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Nutrition (per serving)"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Calories"}),e.jsx(n,{type:"number",step:"0.1",value:F.calories_per_serving,onChange:e=>D({...F,calories_per_serving:parseFloat(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Protein (g)"}),e.jsx(n,{type:"number",step:"0.1",value:F.protein_g,onChange:e=>D({...F,protein_g:parseFloat(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Carbs (g)"}),e.jsx(n,{type:"number",step:"0.1",value:F.carbs_g,onChange:e=>D({...F,carbs_g:parseFloat(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Fat (g)"}),e.jsx(n,{type:"number",step:"0.1",value:F.fat_g,onChange:e=>D({...F,fat_g:parseFloat(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Fiber (g)"}),e.jsx(n,{type:"number",step:"0.1",value:F.fiber_g,onChange:e=>D({...F,fiber_g:parseFloat(e.target.value)})})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold",children:"Ingredients"}),e.jsxs(i,{onClick:()=>{D({...F,ingredients:[...F.ingredients,{name:"",amount:"",unit:""}]})},size:"sm",variant:"outline",children:[e.jsx(T,{className:"w-4 h-4 mr-1"}),"Add"]})]}),e.jsx("div",{className:"space-y-2",children:F.ingredients.map((s,t)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{placeholder:"Ingredient name",value:s.name,onChange:e=>q(t,"name",e.target.value),className:"flex-1"}),e.jsx(n,{placeholder:"Amount",value:s.amount,onChange:e=>q(t,"amount",e.target.value),className:"w-24"}),e.jsx(n,{placeholder:"Unit",value:s.unit,onChange:e=>q(t,"unit",e.target.value),className:"w-24"}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>(e=>{D({...F,ingredients:F.ingredients.filter((s,t)=>t!==e)})})(t),disabled:1===F.ingredients.length,children:e.jsx(B,{className:"w-4 h-4"})})]},t))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold",children:"Instructions"}),e.jsxs(i,{onClick:()=>{D({...F,instructions:[...F.instructions,""]})},size:"sm",variant:"outline",children:[e.jsx(T,{className:"w-4 h-4 mr-1"}),"Add Step"]})]}),e.jsx("div",{className:"space-y-2",children:F.instructions.map((s,t)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-sm font-medium text-muted-foreground pt-2",children:[t+1,"."]}),e.jsx(c,{placeholder:"Instruction step",value:s,onChange:e=>((e,s)=>{const t=[...F.instructions];t[e]=s,D({...F,instructions:t})})(t,e.target.value),rows:2,className:"flex-1"}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>(e=>{D({...F,instructions:F.instructions.filter((s,t)=>t!==e)})})(t),disabled:1===F.instructions.length,children:e.jsx(B,{className:"w-4 h-4"})})]},t))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["vegetarian","vegan","gluten-free","dairy-free","high-protein","low-carb","keto","paleo"].map(s=>e.jsx(o,{variant:F.tags.includes(s)?"default":"outline",className:"cursor-pointer",onClick:()=>(e=>{const s=F.tags.includes(e)?F.tags.filter(s=>s!==e):[...F.tags,e];D({...F,tags:s})})(s),children:s},s))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"is_public",checked:F.is_public,onChange:e=>D({...F,is_public:e.target.checked}),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"is_public",className:"text-sm font-medium",children:"Make this recipe public (visible to other nutritionists)"})]})]}),e.jsxs(He,{children:[e.jsx(i,{variant:"outline",onClick:()=>_(!1),children:"Cancel"}),e.jsxs(i,{onClick:async()=>{if(F.name){A(!0);try{const e={...F,nutritionist_id:a.id,ingredients:F.ingredients.filter(e=>e.name),instructions:F.instructions.filter(e=>e.trim())};if(k){const{error:s}=await l.from("recipes").update(e).eq("id",k.id);if(s)throw s;d({title:"Recipe updated successfully"})}else{const{error:s}=await l.from("recipes").insert(e);if(s)throw s;d({title:"Recipe created successfully"})}_(!1),I()}catch(e){console.error("Error saving recipe:",e),d({variant:"destructive",title:"Error",description:"Failed to save recipe"})}finally{A(!1)}}else d({variant:"destructive",title:"Error",description:"Recipe name is required"})},disabled:E,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),E?"Saving...":"Save Recipe"]})]})]})})]})},es=()=>{const{user:t}=r(),[a,m]=s.useState([]),[x,u]=s.useState([]),[h,g]=s.useState([]),[j,v]=s.useState(""),[_,w]=s.useState("all"),[k,C]=s.useState(!1),[S,M]=s.useState(null),[E,A]=s.useState(!0),[F,D]=s.useState(!1),[R,I]=s.useState(!1),[P,z]=s.useState(null),[q,L]=s.useState(null),[$,U]=s.useState({client_id:"",name:"",description:"",start_date:"",end_date:"",target_calories:2e3,target_protein_g:150,target_carbs_g:200,target_fat_g:60,meal_schedule:{},notes:"",status:"active"}),B=["breakfast","lunch","dinner","snack"];s.useEffect(()=>{G(),Y()},[t]),s.useEffect(()=>{J()},[j,_,a]);const G=async()=>{A(!0);try{const{data:e,error:s}=await l.from("meal_plans_v2").select("\n          *,\n          client:user_profiles!meal_plans_v2_client_id_fkey(id, full_name, email)\n        ").eq("nutritionist_id",t.id).order("created_at",{ascending:!1});if(s)throw s;m(e||[])}catch(e){console.error("Error fetching meal plans:",e),d({variant:"destructive",title:"Error",description:"Failed to fetch meal plans"})}finally{A(!1)}},Y=async()=>{try{const{data:e,error:s}=await l.from("user_profiles").select("id, full_name, email").eq("role","user").order("full_name",{ascending:!0});if(s)throw s;u(e||[])}catch(e){console.error("Error fetching clients:",e)}},J=()=>{let e=a;j&&(e=e.filter(e=>e.name?.toLowerCase().includes(j.toLowerCase())||e.client?.full_name?.toLowerCase().includes(j.toLowerCase()))),"all"!==_&&(e=e.filter(e=>e.status===_)),g(e)},Z=(e=null)=>{if(e)M(e),U({client_id:e.client_id,name:e.name,description:e.description||"",start_date:e.start_date,end_date:e.end_date,target_calories:e.target_calories||2e3,target_protein_g:e.target_protein_g||150,target_carbs_g:e.target_carbs_g||200,target_fat_g:e.target_fat_g||60,meal_schedule:e.meal_schedule||{},notes:e.notes||"",status:e.status});else{M(null);const e=(new Date).toISOString().split("T")[0],s=new Date(Date.now()+6048e5).toISOString().split("T")[0];U({client_id:"",name:"",description:"",start_date:e,end_date:s,target_calories:2e3,target_protein_g:150,target_carbs_g:200,target_fat_g:60,meal_schedule:{},notes:"",status:"active"})}C(!0)},Q=({plan:s})=>{const t=s.client,a=Math.ceil((new Date(s.end_date)-new Date(s.start_date))/864e5);return e.jsx(p,{className:"glass-effect hover:shadow-lg transition-all",children:e.jsxs(f,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(b,{className:"w-3 h-3"}),t?.full_name||"Unknown Client"]})]}),e.jsx(o,{variant:"active"===s.status?"default":"secondary",children:s.status})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(y,{className:"w-4 h-4"}),"Duration:"]}),e.jsxs("span",{className:"font-medium",children:[a," days"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(H,{className:"w-4 h-4"}),"Daily Calories:"]}),e.jsxs("span",{className:"font-medium",children:[s.target_calories||0," kcal"]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4 text-xs",children:[e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[s.target_protein_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Protein"})]}),e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[s.target_carbs_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Carbs"})]}),e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[s.target_fat_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Fat"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>Z(s),className:"flex-1",children:[e.jsx(K,{className:"w-4 h-4 mr-1"}),"Edit"]}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this meal plan?"))try{const{error:s}=await l.from("meal_plans_v2").delete().eq("id",e);if(s)throw s;d({title:"Meal plan deleted successfully"}),G()}catch(s){console.error("Error deleting meal plan:",s),d({variant:"destructive",title:"Error",description:"Failed to delete meal plan"})}})(s.id),className:"text-destructive",children:e.jsx(V,{className:"w-4 h-4"})})]})]})})};return E?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(N,{className:"w-8 h-8 text-primary"}),"Meal Planning"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Create and manage personalized meal plans"})]}),e.jsxs(i,{onClick:()=>Z(),children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"New Meal Plan"]})]}),e.jsx(p,{className:"glass-effect",children:e.jsx(f,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(W,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(n,{placeholder:"Search meal plans...",value:j,onChange:e=>v(e.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{variant:"all"===_?"default":"outline",onClick:()=>w("all"),size:"sm",children:["All (",a.length,")"]}),e.jsx(i,{variant:"active"===_?"default":"outline",onClick:()=>w("active"),size:"sm",children:"Active"}),e.jsx(i,{variant:"completed"===_?"default":"outline",onClick:()=>w("completed"),size:"sm",children:"Completed"}),e.jsx(i,{variant:"archived"===_?"default":"outline",onClick:()=>w("archived"),size:"sm",children:"Archived"})]})]})})}),h.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:h.map(s=>e.jsx(Q,{plan:s},s.id))}):e.jsx(p,{className:"glass-effect",children:e.jsxs(f,{className:"p-12 text-center",children:[e.jsx(N,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No meal plans found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:j||"all"!==_?"Try adjusting your filters":"Create your first meal plan to get started"}),e.jsxs(i,{onClick:()=>Z(),children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Create Meal Plan"]})]})}),e.jsx(Be,{open:k,onOpenChange:C,children:e.jsxs(Ke,{className:"glass-effect custom-scrollbar max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ve,{children:e.jsx(Ge,{children:S?"Edit Meal Plan":"Create New Meal Plan"})}),e.jsxs(Oe,{defaultValue:"basic",className:"mt-4",children:[e.jsxs(We,{className:"grid w-full grid-cols-3",children:[e.jsx($e,{value:"basic",children:"Basic Info"}),e.jsx($e,{value:"schedule",children:"Meal Schedule"}),e.jsx($e,{value:"targets",children:"Nutrition Targets"})]}),e.jsx(Ue,{value:"basic",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Client *"}),e.jsxs("select",{value:$.client_id,onChange:e=>U({...$,client_id:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"",children:"Select a client"}),x.map(s=>e.jsxs("option",{value:s.id,children:[s.full_name," (",s.email,")"]},s.id))]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Plan Name *"}),e.jsx(n,{value:$.name,onChange:e=>U({...$,name:e.target.value}),placeholder:"e.g., Weight Loss Plan - Week 1"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Description"}),e.jsx(c,{value:$.description,onChange:e=>U({...$,description:e.target.value}),placeholder:"Brief description of the meal plan goals and approach",rows:3})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Start Date *"}),e.jsx(n,{type:"date",value:$.start_date,onChange:e=>U({...$,start_date:e.target.value}),className:"w-full min-w-0"})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"End Date *"}),e.jsx(n,{type:"date",value:$.end_date,onChange:e=>U({...$,end_date:e.target.value}),className:"w-full min-w-0"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Notes"}),e.jsx(c,{value:$.notes,onChange:e=>U({...$,notes:e.target.value}),placeholder:"Additional notes, instructions, or guidelines",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Status"}),e.jsxs("select",{value:$.status,onChange:e=>U({...$,status:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"archived",children:"Archived"})]})]})]})}),e.jsxs(Ue,{value:"schedule",className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground mb-4",children:"Click on a meal slot to assign a recipe from your database"}),e.jsx("div",{className:"space-y-4",children:["monday","tuesday","wednesday","thursday","friday","saturday","sunday"].map(s=>e.jsxs("div",{className:"border border-border rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold capitalize mb-3",children:s}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:B.map(t=>e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>((e,s)=>{z(e),L(s),I(!0)})(s,t),className:"h-auto py-3 flex flex-col items-start",children:[e.jsx("span",{className:"text-xs text-muted-foreground capitalize",children:t}),e.jsx("span",{className:"text-xs mt-1",children:$.meal_schedule?.[s]?.[t]?"✓ Assigned":"+ Add Recipe"})]},t))})]},s))})]}),e.jsxs(Ue,{value:"targets",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Daily Calories Target"}),e.jsx(n,{type:"number",value:$.target_calories,onChange:e=>U({...$,target_calories:parseInt(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Protein Target (g)"}),e.jsx(n,{type:"number",value:$.target_protein_g,onChange:e=>U({...$,target_protein_g:parseInt(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Carbs Target (g)"}),e.jsx(n,{type:"number",value:$.target_carbs_g,onChange:e=>U({...$,target_carbs_g:parseInt(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Fat Target (g)"}),e.jsx(n,{type:"number",value:$.target_fat_g,onChange:e=>U({...$,target_fat_g:parseInt(e.target.value)})})]})]}),e.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Macro Distribution"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Protein"}),e.jsxs("p",{className:"font-semibold",children:[(4*$.target_protein_g/$.target_calories*100).toFixed(0),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Carbs"}),e.jsxs("p",{className:"font-semibold",children:[(4*$.target_carbs_g/$.target_calories*100).toFixed(0),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Fat"}),e.jsxs("p",{className:"font-semibold",children:[(9*$.target_fat_g/$.target_calories*100).toFixed(0),"%"]})]})]})]})]})]}),e.jsxs(He,{className:"mt-6",children:[e.jsx(i,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),e.jsxs(i,{onClick:async()=>{if($.client_id&&$.name&&$.start_date&&$.end_date){D(!0);try{const e={...$,nutritionist_id:t.id};if(S){const{error:s}=await l.from("meal_plans_v2").update(e).eq("id",S.id);if(s)throw s;d({title:"Meal plan updated successfully"})}else{const{error:s}=await l.from("meal_plans_v2").insert(e);if(s)throw s;d({title:"Meal plan created successfully"})}C(!1),G()}catch(e){console.error("Error saving meal plan:",e),d({variant:"destructive",title:"Error",description:"Failed to save meal plan"})}finally{D(!1)}}else d({variant:"destructive",title:"Error",description:"Please fill in all required fields"})},disabled:F,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),F?"Saving...":"Save Meal Plan"]})]})]})}),e.jsx(Be,{open:R,onOpenChange:I,children:e.jsxs(Ke,{className:"glass-effect custom-scrollbar max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ve,{children:e.jsxs(Ge,{children:["Select Recipe for ",P&&q&&e.jsxs("span",{className:"capitalize",children:[P," - ",q]})]})}),e.jsx(Xe,{onSelectRecipe:e=>{if(P&&q){const s={...$.meal_schedule};s[P]||(s[P]={}),s[P][q]=e.id,U({...$,meal_schedule:s}),I(!1),z(null),L(null),d({title:"Recipe added to meal plan"})}}})]})})]})},ss=()=>{const{user:t}=r(),[a,m]=s.useState([]),[x,u]=s.useState([]),[h,v]=s.useState(new Date),[b,N]=s.useState(new Date),[_,k]=s.useState(!1),[S,M]=s.useState(null),[E,F]=s.useState(!0),[D,R]=s.useState(!1),[I,P]=s.useState("month"),[z,q]=s.useState({client_id:"",title:"",description:"",appointment_date:"",appointment_time:"",duration_minutes:60,consultation_type:"follow_up",meeting_link:"",status:"scheduled",notes:""}),L=[{value:"scheduled",label:"Scheduled",color:"bg-blue-500"},{value:"completed",label:"Completed",color:"bg-green-500"},{value:"cancelled",label:"Cancelled",color:"bg-red-500"},{value:"no_show",label:"No Show",color:"bg-gray-500"}];s.useEffect(()=>{W(),$()},[t,h]);const W=async()=>{F(!0);try{const e=Y(h),s=J(h),{data:a,error:r}=await l.from("appointments").select("\n          *,\n          client:user_profiles!appointments_client_id_fkey(id, full_name, email)\n        ").eq("nutritionist_id",t.id).gte("appointment_date",e.toISOString()).lte("appointment_date",s.toISOString()).order("appointment_date",{ascending:!0});if(r)throw r;m(a||[])}catch(e){console.error("Error fetching appointments:",e),d({variant:"destructive",title:"Error",description:"Failed to fetch appointments"})}finally{F(!1)}},$=async()=>{try{const{data:e,error:s}=await l.from("user_profiles").select("id, full_name, email").eq("role","user").order("full_name",{ascending:!0});if(s)throw s;u(e||[])}catch(e){console.error("Error fetching clients:",e)}},U=(e=null,s=null)=>{if(e){const s=new Date(e.appointment_date);M(e),q({client_id:e.client_id,title:e.title,description:e.description||"",appointment_date:C(s,"yyyy-MM-dd"),appointment_time:C(s,"HH:mm"),duration_minutes:e.duration_minutes||60,consultation_type:e.consultation_type||"follow_up",meeting_link:e.meeting_link||"",status:e.status||"scheduled",notes:e.notes||""})}else{const e=s||b;M(null),q({client_id:"",title:"",description:"",appointment_date:C(e,"yyyy-MM-dd"),appointment_time:"10:00",duration_minutes:60,consultation_type:"follow_up",meeting_link:"",status:"scheduled",notes:""})}k(!0)},B=e=>a.filter(s=>ee(le(s.appointment_date),e)),G=({appointment:s,compact:t=!1})=>{const a=L.find(e=>e.value===s.status),r=new Date(s.appointment_date);return t?e.jsxs("div",{onClick:()=>U(s),className:"text-xs p-1 mb-1 rounded cursor-pointer hover:opacity-80 transition-opacity truncate",style:{backgroundColor:a?.color.replace("bg-","")+"30"},children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:C(r,"h:mm a")})]}),e.jsx("div",{className:"truncate",children:s.title})]}):e.jsx(p,{className:"glass-effect hover:shadow-lg transition-all",children:e.jsxs(f,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(w,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm font-semibold",children:[C(r,"MMM d, yyyy")," at ",C(r,"h:mm a")]})]}),e.jsx("h3",{className:"font-semibold text-lg",children:s.title}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(A,{className:"w-3 h-3"}),s.client?.full_name||"Unknown Client"]})]}),e.jsx(o,{variant:"completed"===s.status?"default":"secondary",children:a?.label})]}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Duration: ",s.duration_minutes," min"]}),s.meeting_link&&e.jsxs("span",{className:"flex items-center gap-1 text-primary",children:[e.jsx(ie,{className:"w-4 h-4"}),"Video call"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>U(s),children:e.jsx(K,{className:"w-4 h-4"})}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this appointment?"))try{const{error:s}=await l.from("appointments").delete().eq("id",e);if(s)throw s;d({title:"Appointment deleted successfully"}),W()}catch(s){console.error("Error deleting appointment:",s),d({variant:"destructive",title:"Error",description:"Failed to delete appointment"})}})(s.id),className:"text-destructive",children:e.jsx(V,{className:"w-4 h-4"})})]})]})]})})};return E?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(Z,{className:"w-12 h-12 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(y,{className:"w-8 h-8 text-primary"}),"Schedule"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your appointments and consultations"})]}),e.jsxs(i,{onClick:()=>U(),children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"New Appointment"]})]}),e.jsxs(p,{className:"glass-effect",children:[e.jsx(g,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>v(te(h,1)),children:e.jsx(Q,{className:"w-4 h-4"})}),e.jsx("h3",{className:"text-xl font-semibold min-w-[200px] text-center",children:C(h,"MMMM yyyy")}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>v(ae(h,1)),children:e.jsx(X,{className:"w-4 h-4"})})]}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>v(new Date),children:"Today"})]})}),e.jsx(f,{children:e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(s=>e.jsx("div",{className:"text-center font-semibold text-sm py-2",children:s},s)),(()=>{const e=Y(h),s=J(h);return re({start:e,end:s})})().map(s=>{const t=B(s),a=ee(s,b),r=se(s);return e.jsxs("div",{onClick:()=>N(s),className:`min-h-[100px] p-2 border rounded-lg cursor-pointer transition-colors ${a?"border-primary bg-primary/10":"border-border hover:bg-muted/50"} ${r?"bg-primary/5":""}`,children:[e.jsx("div",{className:"text-sm font-semibold mb-1 "+(r?"text-primary":""),children:C(s,"d")}),e.jsxs("div",{className:"space-y-1",children:[t.slice(0,2).map(s=>e.jsx(G,{appointment:s,compact:!0},s.id)),t.length>2&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["+",t.length-2," more"]})]})]},s.toISOString())})]})})]}),e.jsxs(p,{className:"glass-effect",children:[e.jsx(g,{children:e.jsxs(j,{children:["Appointments for ",C(b,"EEEE, MMMM d, yyyy")]})}),e.jsx(f,{children:B(b).length>0?e.jsx("div",{className:"space-y-4",children:B(b).map(s=>e.jsx(G,{appointment:s},s.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(y,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No appointments scheduled for this date"}),e.jsxs(i,{variant:"outline",onClick:()=>U(null,b),className:"mt-4",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Schedule Appointment"]})]})})]}),e.jsx(Be,{open:_,onOpenChange:k,children:e.jsxs(Ke,{className:"glass-effect custom-scrollbar max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ve,{children:e.jsx(Ge,{children:S?"Edit Appointment":"New Appointment"})}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Client *"}),e.jsxs("select",{value:z.client_id,onChange:e=>q({...z,client_id:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"",children:"Select a client"}),x.map(s=>e.jsxs("option",{value:s.id,children:[s.full_name," (",s.email,")"]},s.id))]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Title *"}),e.jsx(n,{value:z.title,onChange:e=>q({...z,title:e.target.value}),placeholder:"e.g., Initial Consultation"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Description"}),e.jsx(c,{value:z.description,onChange:e=>q({...z,description:e.target.value}),placeholder:"Brief description of the appointment",rows:3})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Date *"}),e.jsx(n,{type:"date",value:z.appointment_date,onChange:e=>q({...z,appointment_date:e.target.value}),className:"w-full min-w-0"})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Time *"}),e.jsx(n,{type:"time",value:z.appointment_time,onChange:e=>q({...z,appointment_time:e.target.value}),className:"w-full min-w-0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Duration (minutes)"}),e.jsx(n,{type:"number",min:"15",step:"15",value:z.duration_minutes,onChange:e=>q({...z,duration_minutes:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Type"}),e.jsx("select",{value:z.consultation_type,onChange:e=>q({...z,consultation_type:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[{value:"initial",label:"Initial Consultation"},{value:"follow_up",label:"Follow-up"},{value:"check_in",label:"Check-in"}].map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Status"}),e.jsx("select",{value:z.status,onChange:e=>q({...z,status:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:L.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Meeting Link (optional)"}),e.jsx(n,{value:z.meeting_link,onChange:e=>q({...z,meeting_link:e.target.value}),placeholder:"https://zoom.us/j/..."})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Notes"}),e.jsx(c,{value:z.notes,onChange:e=>q({...z,notes:e.target.value}),placeholder:"Additional notes about this appointment",rows:3})]})]})}),e.jsxs(He,{children:[e.jsx(i,{variant:"outline",onClick:()=>k(!1),children:"Cancel"}),e.jsx(i,{onClick:async()=>{if(z.client_id&&z.title&&z.appointment_date&&z.appointment_time){R(!0);try{const e=new Date(`${z.appointment_date}T${z.appointment_time}`),s={nutritionist_id:t.id,client_id:z.client_id,title:z.title,description:z.description,appointment_date:e.toISOString(),duration_minutes:parseInt(z.duration_minutes),consultation_type:z.consultation_type,meeting_link:z.meeting_link,status:z.status,notes:z.notes};if(S){const{error:e}=await l.from("appointments").update(s).eq("id",S.id);if(e)throw e;d({title:"Appointment updated successfully"})}else{const{error:e}=await l.from("appointments").insert(s);if(e)throw e;d({title:"Appointment created successfully"})}k(!1),W()}catch(e){console.error("Error saving appointment:",e),d({variant:"destructive",title:"Error",description:"Failed to save appointment"})}finally{R(!1)}}else d({variant:"destructive",title:"Error",description:"Please fill in all required fields"})},disabled:D,children:D?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Save Appointment"]})})]})]})})]})},ts=()=>{const{user:t}=r(),[a,m]=s.useState([]),[x,u]=s.useState([]),[h,j]=s.useState(null),[v,b]=s.useState([]),[N,y]=s.useState(""),[_,w]=s.useState(""),[k,S]=s.useState(!0),[M,E]=s.useState(!1),[F,D]=s.useState(!1),[R,I]=s.useState(""),[P,z]=s.useState("");s.useEffect(()=>{q(),L()},[t]),s.useEffect(()=>{h&&(O(h),$(h))},[h]);const q=async()=>{try{const{data:e,error:s}=await l.from("user_profiles").select("id, full_name, email, profile_picture_url").eq("role","user").order("full_name",{ascending:!0});if(s)throw s;m(e||[])}catch(e){console.error("Error fetching clients:",e)}},L=async()=>{S(!0);try{const{data:e,error:s}=await l.from("messages").select("\n          *,\n          sender:user_profiles!messages_sender_id_fkey(id, full_name, email, profile_picture_url),\n          recipient:user_profiles!messages_recipient_id_fkey(id, full_name, email, profile_picture_url)\n        ").or(`sender_id.eq.${t.id},recipient_id.eq.${t.id}`).order("created_at",{ascending:!1});if(s)throw s;const a=new Map;(e||[]).forEach(e=>{const s=e.sender_id===t.id?e.recipient_id:e.sender_id,r=e.sender_id===t.id?e.recipient:e.sender;a.has(s)||a.set(s,{partnerId:s,partner:r,lastMessage:e,unreadCount:0}),e.recipient_id!==t.id||e.is_read||a.get(s).unreadCount++}),u(Array.from(a.values()))}catch(e){console.error("Error fetching conversations:",e),d({variant:"destructive",title:"Error",description:"Failed to fetch conversations"})}finally{S(!1)}},O=async e=>{try{const s=e.partnerId,{data:a,error:r}=await l.from("messages").select("\n          *,\n          sender:user_profiles!messages_sender_id_fkey(id, full_name, profile_picture_url)\n        ").or(`and(sender_id.eq.${t.id},recipient_id.eq.${s}),and(sender_id.eq.${s},recipient_id.eq.${t.id})`).order("created_at",{ascending:!0});if(r)throw r;b(a||[])}catch(s){console.error("Error fetching messages:",s)}},$=async e=>{try{const{error:s}=await l.from("messages").update({is_read:!0}).eq("sender_id",e.partnerId).eq("recipient_id",t.id).eq("is_read",!1);if(s)throw s;L()}catch(s){console.error("Error marking as read:",s)}},U=async()=>{if(N.trim()&&h){E(!0);try{const{error:e}=await l.from("messages").insert({sender_id:t.id,recipient_id:h.partnerId,message_text:N.trim(),is_read:!1});if(e)throw e;y(""),await O(h),await L()}catch(e){console.error("Error sending message:",e),d({variant:"destructive",title:"Error",description:"Failed to send message"})}finally{E(!1)}}},B=x.filter(e=>e.partner?.full_name?.toLowerCase().includes(_.toLowerCase())||e.partner?.email?.toLowerCase().includes(_.toLowerCase())),K=({conversation:s})=>e.jsx("div",{onClick:()=>j(s),className:"p-4 border-b border-border cursor-pointer hover:bg-muted/50 transition-colors "+(h?.partnerId===s.partnerId?"bg-muted":""),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:s.partner?.profile_picture_url?e.jsx("img",{src:s.partner.profile_picture_url,alt:s.partner.full_name,className:"w-12 h-12 rounded-full object-cover"}):e.jsx(A,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h4",{className:"font-semibold text-sm truncate",children:s.partner?.full_name||"Unknown"}),e.jsx("span",{className:"text-xs text-muted-foreground flex-shrink-0 ml-2",children:C(new Date(s.lastMessage.created_at),"MMM d")})]}),e.jsx("p",{className:"text-sm truncate "+(s.unreadCount>0?"font-semibold":"text-muted-foreground"),children:s.lastMessage.message_text}),s.unreadCount>0&&e.jsxs(o,{variant:"default",className:"mt-1",children:[s.unreadCount," new"]})]})]})}),V=({message:s})=>{const a=s.sender_id===t.id;return e.jsx("div",{className:`flex ${a?"justify-end":"justify-start"} mb-4`,children:e.jsxs("div",{className:"max-w-[70%] "+(a?"order-2":"order-1"),children:[!a&&e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center",children:s.sender?.profile_picture_url?e.jsx("img",{src:s.sender.profile_picture_url,alt:s.sender.full_name,className:"w-6 h-6 rounded-full object-cover"}):e.jsx(A,{className:"w-3 h-3 text-primary"})}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.sender?.full_name})]}),e.jsxs("div",{className:"rounded-lg p-3 "+(a?"bg-primary text-primary-foreground":"bg-muted"),children:[e.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:s.message_text}),e.jsxs("div",{className:"flex items-center justify-end gap-1 mt-1 "+(a?"text-primary-foreground/70":"text-muted-foreground"),children:[e.jsx("span",{className:"text-xs",children:C(new Date(s.created_at),"h:mm a")}),a&&(s.is_read?e.jsx(me,{className:"w-3 h-3"}):e.jsx(xe,{className:"w-3 h-3"}))]})]})]})})};return k?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(Z,{className:"w-12 h-12 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(ne,{className:"w-8 h-8 text-primary"}),"Messages"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Communicate with your clients"})]}),e.jsxs(i,{onClick:()=>D(!0),children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"New Message"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(p,{className:"glass-effect lg:col-span-1",children:[e.jsx(g,{className:"pb-3",children:e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(n,{placeholder:"Search conversations...",value:_,onChange:e=>w(e.target.value),className:"pl-10"})]})}),e.jsx(f,{className:"p-0",children:e.jsx("div",{className:"max-h-[600px] overflow-y-auto",children:B.length>0?B.map(s=>e.jsx(K,{conversation:s},s.partnerId)):e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx(ne,{className:"w-12 h-12 mx-auto text-muted-foreground mb-3 opacity-50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:_?"No conversations found":"No messages yet"}),e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>D(!0),className:"mt-3",children:[e.jsx(T,{className:"w-4 h-4 mr-1"}),"Start a conversation"]})]})})})]}),e.jsx(p,{className:"glass-effect lg:col-span-2",children:h?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"border-b border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>j(null),className:"lg:hidden",children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:h.partner?.profile_picture_url?e.jsx("img",{src:h.partner.profile_picture_url,alt:h.partner.full_name,className:"w-10 h-10 rounded-full object-cover"}):e.jsx(A,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:h.partner?.full_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:h.partner?.email})]})]})}),e.jsxs(f,{className:"p-0",children:[e.jsx("div",{className:"h-[450px] overflow-y-auto p-4",children:v.map(s=>e.jsx(V,{message:s},s.id))}),e.jsxs("div",{className:"border-t border-border p-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{placeholder:"Type your message...",value:N,onChange:e=>y(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),U())},className:"min-h-[60px] resize-none"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(i,{variant:"outline",size:"icon",disabled:!0,title:"File attachment (coming soon)",children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx(i,{onClick:U,disabled:!N.trim()||M,size:"icon",children:M?e.jsx(Z,{className:"w-4 h-4 animate-spin"}):e.jsx(oe,{className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Press Enter to send, Shift+Enter for new line"})]})]})]}):e.jsx(f,{className:"flex items-center justify-center h-[600px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ne,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No conversation selected"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Choose a conversation from the list or start a new one"}),e.jsxs(i,{onClick:()=>D(!0),children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"New Message"]})]})})})]}),e.jsx(Be,{open:F,onOpenChange:D,children:e.jsxs(Ke,{className:"glass-effect custom-scrollbar max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ve,{children:e.jsx(Ge,{children:"New Message"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"To:"}),e.jsxs("select",{value:R,onChange:e=>I(e.target.value),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"",children:"Select a client"}),a.map(s=>e.jsxs("option",{value:s.id,children:[s.full_name," (",s.email,")"]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Message:"}),e.jsx(c,{value:P,onChange:e=>z(e.target.value),placeholder:"Type your message here...",rows:6})]})]}),e.jsxs(He,{children:[e.jsx(i,{variant:"outline",onClick:()=>D(!1),children:"Cancel"}),e.jsx(i,{onClick:async()=>{if(R&&P.trim()){E(!0);try{const{error:e}=await l.from("messages").insert({sender_id:t.id,recipient_id:R,message_text:P.trim(),is_read:!1});if(e)throw e;d({title:"Message sent",description:"Your message has been sent successfully"}),D(!1),I(""),z(""),await L()}catch(e){console.error("Error sending message:",e),d({variant:"destructive",title:"Error",description:"Failed to send message"})}finally{E(!1)}}else d({variant:"destructive",title:"Error",description:"Please select a client and enter a message"})},disabled:M,children:M?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Send Message"]})})]})]})})]})},as=()=>{const{toast:t}=m(),[a,r]=s.useState(!0),[n,c]=s.useState(!1),[d,o]=s.useState("30"),[x,u]=s.useState({totalClients:0,activeClients:0,totalAppointments:0,completedAppointments:0,averageSuccessRate:0,totalRevenue:0}),[h,p]=s.useState([]),[g,j]=s.useState([]),[f,v]=s.useState([]),[N,_]=s.useState([]),[w,k]=s.useState([]),[S,M]=s.useState([]);s.useEffect(()=>{E()},[d]);const E=async()=>{r(!0);try{await Promise.all([A(),T(),L(),O(),W(),$(),U()])}catch(e){console.error("Error fetching analytics:",e),t({title:"Error",description:"Failed to load analytics data",variant:"destructive"})}finally{r(!1)}},A=async()=>{const e=new Date;e.setDate(e.getDate()-parseInt(d));const{data:s}=await l.from("user_profiles").select("id, role, created_at").eq("role","user"),t=s?.length||0,a=s?.filter(s=>new Date(s.created_at)>=e).length||0,{data:r}=await l.from("appointments").select("*").gte("appointment_date",e.toISOString()),i=r?.length||0,n=r?.filter(e=>"completed"===e.status).length||0,{data:c}=await l.from("client_progress").select("*").gte("date",e.toISOString()),o=c?.length>0?c.filter(e=>e.weight_kg&&e.weight_kg>0).length/c.length*100:0;u({totalClients:t,activeClients:a,totalAppointments:i,completedAppointments:n,averageSuccessRate:Math.round(o),totalRevenue:75*i})},T=async()=>{const e=ue(new Date,parseInt(d)),{data:s}=await l.from("client_progress").select("\n        *,\n        user_profiles!client_progress_user_id_fkey(full_name)\n      ").gte("date",e.toISOString()).order("date",{ascending:!0});if(s){const e=s.reduce((e,s)=>{const t=C(new Date(s.date),"MMM dd");return e[t]||(e[t]={date:t,totalWeight:0,count:0}),s.weight_kg&&(e[t].totalWeight+=s.weight_kg,e[t].count+=1),e},{}),t=Object.values(e).map(e=>({date:e.date,avgWeight:e.count>0?(e.totalWeight/e.count).toFixed(1):0}));p(t)}},L=async()=>{const e=ue(new Date,parseInt(d)),{data:s}=await l.from("appointments").select("*").gte("appointment_date",e.toISOString()).order("appointment_date",{ascending:!0});if(s){const e=s.reduce((e,s)=>{const t=C(new Date(s.appointment_date),"MMM dd");return e[t]||(e[t]={date:t,scheduled:0,completed:0,cancelled:0}),"scheduled"===s.status&&(e[t].scheduled+=1),"completed"===s.status&&(e[t].completed+=1),"cancelled"===s.status&&(e[t].cancelled+=1),e},{});j(Object.values(e))}},O=async()=>{const{data:e}=await l.from("client_health_data").select("goals");if(e){const s=e.reduce((e,s)=>((s.goals||[]).forEach(s=>{e[s]=(e[s]||0)+1}),e),{}),t=Object.entries(s).map(([e,s])=>({name:e.replace("_"," ").toUpperCase(),value:s}));v(t)}},W=async()=>{const e=ue(new Date,parseInt(d)),{data:s}=await l.from("habit_logs").select("\n        *,\n        client_habits!habit_logs_habit_id_fkey(habit_name)\n      ").gte("log_date",e.toISOString()).order("log_date",{ascending:!0});if(s){const e=s.reduce((e,s)=>{const t=C(new Date(s.log_date),"MMM dd");return e[t]||(e[t]={date:t,total:0,completed:0}),e[t].total+=1,s.completed&&(e[t].completed+=1),e},{}),t=Object.values(e).map(e=>({date:e.date,rate:e.total>0?Math.round(e.completed/e.total*100):0}));_(t)}},$=async()=>{const e=ue(new Date,parseInt(d)),{data:s}=await l.from("client_progress").select("\n        user_id,\n        weight_kg,\n        date,\n        user_profiles!client_progress_user_id_fkey(full_name, email)\n      ").gte("date",e.toISOString()).order("date",{ascending:!0});if(s){const e=s.reduce((e,s)=>(e[s.user_id]||(e[s.user_id]={userId:s.user_id,name:s.user_profiles?.full_name||"Unknown",email:s.user_profiles?.email||"",weights:[]}),s.weight_kg&&e[s.user_id].weights.push(s.weight_kg),e),{}),t=Object.values(e).map(e=>{const s=e.weights;if(s.length<2)return null;const t=s[0],a=t-s[s.length-1],r=(a/t*100).toFixed(1);return{...e,weightChange:a.toFixed(1),percentChange:parseFloat(r)}}).filter(Boolean).sort((e,s)=>Math.abs(s.percentChange)-Math.abs(e.percentChange)).slice(0,5);k(t)}},U=async()=>{const e=ue(new Date,parseInt(d)),{data:s}=await l.from("appointments").select("appointment_date, consultation_type").eq("status","completed").gte("appointment_date",e.toISOString()).order("appointment_date",{ascending:!0});if(s){const e=s.reduce((e,s)=>{const t=C(new Date(s.appointment_date),"MMM dd");e[t]||(e[t]={date:t,revenue:0});const a="initial"===s.consultation_type?100:"check_in"===s.consultation_type?50:75;return e[t].revenue+=a,e},{});M(Object.values(e))}},B=["hsl(142, 76%, 36%)","hsl(217, 91%, 60%)","hsl(38, 92%, 50%)","hsl(0, 84%, 60%)","hsl(258, 90%, 66%)","hsl(330, 81%, 60%)"];return a?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(he.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-foreground",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Track performance and client success metrics"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:d,onChange:e=>o(e.target.value),className:"px-4 py-2 rounded-lg border border-border bg-card text-foreground",children:[e.jsx("option",{value:"7",children:"Last 7 days"}),e.jsx("option",{value:"30",children:"Last 30 days"}),e.jsx("option",{value:"90",children:"Last 90 days"})]}),e.jsxs(i,{variant:"outline",onClick:async()=>{c(!0),await E(),c(!1),t({title:"Success",description:"Analytics data refreshed"})},disabled:n,children:[e.jsx(pe,{className:"h-4 w-4 mr-2 "+(n?"animate-spin":"")}),"Refresh"]}),e.jsxs(i,{onClick:()=>{t({title:"Export Started",description:"Generating analytics report..."})},children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Export Report"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(rs,{icon:b,title:"Total Clients",value:x.totalClients,change:`+${x.activeClients} this period`,trend:"up",color:"blue"}),e.jsx(rs,{icon:y,title:"Appointments",value:x.totalAppointments,change:`${x.completedAppointments} completed`,trend:"up",color:"green"}),e.jsx(rs,{icon:H,title:"Success Rate",value:`${x.averageSuccessRate}%`,change:"Average client progress",trend:"up",color:"purple"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(he.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Average Client Progress"}),e.jsx(je,{className:"h-5 w-5 text-muted-foreground"})]}),e.jsx(F,{width:"100%",height:300,children:e.jsxs(fe,{data:h,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorWeight",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"hsl(217, 91%, 60%)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"hsl(217, 91%, 60%)",stopOpacity:0})]})}),e.jsx(R,{strokeDasharray:"3 3",className:"stroke-border"}),e.jsx(I,{dataKey:"date",className:"stroke-muted-foreground"}),e.jsx(P,{className:"stroke-muted-foreground"}),e.jsx(z,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--popover-foreground))"}}),e.jsx(ve,{type:"monotone",dataKey:"avgWeight",stroke:"hsl(217, 91%, 60%)",fillOpacity:1,fill:"url(#colorWeight)"})]})})]}),e.jsxs(he.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Appointment Trends"}),e.jsx(be,{className:"h-5 w-5 text-gray-400"})]}),e.jsx(F,{width:"100%",height:300,children:e.jsxs(Ne,{data:g,children:[e.jsx(R,{strokeDasharray:"3 3",className:"stroke-border"}),e.jsx(I,{dataKey:"date",className:"stroke-muted-foreground"}),e.jsx(P,{className:"stroke-muted-foreground"}),e.jsx(z,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--popover-foreground))"}}),e.jsx(ye,{}),e.jsx(_e,{dataKey:"scheduled",fill:"hsl(217, 91%, 60%)",name:"Scheduled"}),e.jsx(_e,{dataKey:"completed",fill:"hsl(142, 76%, 36%)",name:"Completed"}),e.jsx(_e,{dataKey:"cancelled",fill:"hsl(0, 84%, 60%)",name:"Cancelled"})]})})]}),e.jsxs(he.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Client Goals Distribution"}),e.jsx(we,{className:"h-5 w-5 text-gray-400"})]}),e.jsx(F,{width:"100%",height:300,children:e.jsxs(ke,{children:[e.jsx(Ce,{data:f,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,percent:s})=>`${e} ${(100*s).toFixed(0)}%`,outerRadius:80,fill:"hsl(217, 91%, 60%)",dataKey:"value",children:f.map((s,t)=>e.jsx(Se,{fill:B[t%B.length]},`cell-${t}`))}),e.jsx(z,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--popover-foreground))"}})]})})]}),e.jsxs(he.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Client Compliance Rate"}),e.jsx(Me,{className:"h-5 w-5 text-gray-400"})]}),e.jsx(F,{width:"100%",height:300,children:e.jsxs(D,{data:N,children:[e.jsx(R,{strokeDasharray:"3 3",className:"stroke-border"}),e.jsx(I,{dataKey:"date",className:"stroke-muted-foreground"}),e.jsx(P,{className:"stroke-muted-foreground"}),e.jsx(z,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--popover-foreground))"}}),e.jsx(q,{type:"monotone",dataKey:"rate",stroke:"hsl(142, 76%, 36%)",strokeWidth:2,dot:{fill:"hsl(142, 76%, 36%)"}})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(he.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Top Performers"}),e.jsx(Me,{className:"h-5 w-5 text-yellow-500"})]}),0===w.length?e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No progress data available"}):e.jsx("div",{className:"space-y-4",children:w.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 text-primary font-bold",children:t+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold "+(s.weightChange>0?"text-destructive":"text-primary"),children:[s.weightChange>0?"+":"",s.weightChange," kg"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[Math.abs(s.percentChange),"% change"]})]})]},s.userId))})]}),e.jsxs(he.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Revenue Trends"}),e.jsx(Ee,{className:"h-5 w-5 text-green-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-3xl font-bold text-foreground",children:["$",x.totalRevenue.toLocaleString()]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total revenue this period"})]}),e.jsx(F,{width:"100%",height:200,children:e.jsxs(fe,{data:S,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorRevenue",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"hsl(142, 76%, 36%)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"hsl(142, 76%, 36%)",stopOpacity:0})]})}),e.jsx(R,{strokeDasharray:"3 3",className:"stroke-border"}),e.jsx(I,{dataKey:"date",className:"stroke-muted-foreground"}),e.jsx(P,{className:"stroke-muted-foreground"}),e.jsx(z,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--popover-foreground))"}}),e.jsx(ve,{type:"monotone",dataKey:"revenue",stroke:"hsl(142, 76%, 36%)",fillOpacity:1,fill:"url(#colorRevenue)"})]})})]})]})]})},rs=({icon:s,title:t,value:a,change:r,trend:l,color:i})=>e.jsx(he.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:t}),e.jsx("p",{className:"text-3xl font-bold text-card-foreground mb-2",children:a}),e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:["up"===l?e.jsx(_,{className:"h-4 w-4 text-primary"}):e.jsx($,{className:"h-4 w-4 text-destructive"}),e.jsx("span",{className:"up"===l?"text-primary":"text-destructive",children:r})]})]}),e.jsx("div",{className:`p-3 rounded-lg ${{blue:"bg-blue-500/10 text-blue-500",green:"bg-primary/10 text-primary",purple:"bg-violet-500/10 text-violet-500",red:"bg-destructive/10 text-destructive"}[i]}`,children:e.jsx(s,{className:"h-6 w-6"})})]})}),ls=()=>{const{toast:t}=m(),[a,r]=s.useState(!0),[n,c]=s.useState([]),[d,x]=s.useState([]),[u,h]=s.useState(""),[p,g]=s.useState("all"),[j,f]=s.useState(null),[v,b]=s.useState(!1),[N,y]=s.useState(!1),[_,k]=s.useState({title:"",description:"",content:"",resource_type:"article",category:"nutrition",url:"",file_url:"",tags:[],is_public:!0}),[S,M]=s.useState(""),E=[{value:"all",label:"All Resources",icon:Ae},{value:"nutrition",label:"Nutrition",icon:Fe},{value:"exercise",label:"Exercise",icon:Fe},{value:"wellness",label:"Wellness",icon:Fe},{value:"recipes",label:"Recipes",icon:Fe},{value:"guides",label:"Guides",icon:L}],A=[{value:"article",label:"Article",icon:L},{value:"video",label:"Video",icon:ie},{value:"pdf",label:"PDF Document",icon:ge},{value:"link",label:"External Link",icon:Pe}];s.useEffect(()=>{F()},[]),s.useEffect(()=>{D()},[n,u,p]);const F=async()=>{r(!0);try{const{data:e,error:s}=await l.from("educational_resources").select("*").order("created_at",{ascending:!1});if(s)throw s;c(e||[])}catch(e){console.error("Error fetching resources:",e),t({title:"Error",description:"Failed to load resources",variant:"destructive"})}finally{r(!1)}},D=()=>{let e=n;if("all"!==p&&(e=e.filter(e=>e.category===p)),u){const s=u.toLowerCase();e=e.filter(e=>e.title.toLowerCase().includes(s)||e.description?.toLowerCase().includes(s)||e.tags?.some(e=>e.toLowerCase().includes(s)))}x(e)},R=async e=>{t({title:"Share Link Copied",description:"Resource link copied to clipboard"})},I=()=>{S&&!_.tags.includes(S)&&(k({..._,tags:[..._.tags,S]}),M(""))},P=()=>{k({title:"",description:"",content:"",resource_type:"article",category:"nutrition",url:"",file_url:"",tags:[],is_public:!0}),f(null)},z=e=>{const s={article:"bg-blue-500/10 text-blue-600 dark:text-blue-400",video:"bg-purple-500/10 text-purple-600 dark:text-purple-400",pdf:"bg-red-500/10 text-red-600 dark:text-red-400",link:"bg-green-500/10 text-green-600 dark:text-green-400"};return s[e]||s.article};return a?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(he.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-foreground",children:"Resource Library"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage educational content and resources for clients"})]}),e.jsxs(i,{onClick:()=>{P(),b(!0)},children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Add Resource"]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Search resources...",value:u,onChange:e=>h(e.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border border-border bg-background text-foreground"})]}),e.jsx("div",{className:"flex gap-2",children:E.map(s=>{const t=s.icon;return e.jsxs(i,{variant:p===s.value?"default":"outline",onClick:()=>g(s.value),className:"whitespace-nowrap",children:[e.jsx(t,{className:"h-4 w-4 mr-2"}),s.label]},s.value)})})]}),0===d.length?e.jsxs(he.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-12 bg-card rounded-xl border border-border",children:[e.jsx(Fe,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No Resources Found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:u||"all"!==p?"Try adjusting your filters":"Get started by creating your first resource"}),e.jsxs(i,{onClick:()=>{P(),b(!0)},children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Add Resource"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:d.map((s,a)=>{const r=(e=>{const s=A.find(s=>s.value===e);return s?s.icon:L})(s.resource_type);return e.jsxs(he.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*a},className:"bg-card rounded-xl shadow-lg border border-border overflow-hidden hover:shadow-xl transition-shadow",children:[e.jsx("div",{className:`p-4 ${z(s.resource_type)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(r,{className:"h-8 w-8"}),e.jsx(o,{variant:s.is_public?"default":"secondary",children:s.is_public?"Public":"Private"})]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2 line-clamp-2",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-3",children:s.description||"No description available"}),s.tags&&s.tags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[s.tags.slice(0,3).map((s,t)=>e.jsxs(o,{variant:"outline",className:"text-xs",children:[e.jsx(De,{className:"h-3 w-3 mr-1"}),s]},t)),s.tags.length>3&&e.jsxs(o,{variant:"outline",className:"text-xs",children:["+",s.tags.length-3]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground mb-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"h-3 w-3"}),C(new Date(s.created_at),"MMM dd, yyyy")]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Re,{className:"h-3 w-3"}),s.view_count||0," views"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>(async e=>{f(e),y(!0);try{await l.from("educational_resources").update({view_count:(e.view_count||0)+1}).eq("id",e.id)}catch(s){console.error("Error updating view count:",s)}})(s),children:[e.jsx(Re,{className:"h-4 w-4 mr-1"}),"View"]}),e.jsx(i,{size:"sm",variant:"outline",onClick:()=>(e=>{f(e),k({title:e.title,description:e.description||"",content:e.content||"",resource_type:e.resource_type,category:e.category,url:e.url||"",file_url:e.file_url||"",tags:e.tags||[],is_public:e.is_public}),b(!0)})(s),children:e.jsx(K,{className:"h-4 w-4"})}),e.jsx(i,{size:"sm",variant:"outline",onClick:()=>R(),children:e.jsx(Ie,{className:"h-4 w-4"})}),e.jsx(i,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this resource?"))try{const{error:s}=await l.from("educational_resources").delete().eq("id",e);if(s)throw s;t({title:"Success",description:"Resource deleted successfully"}),F()}catch(s){console.error("Error deleting resource:",s),t({title:"Error",description:"Failed to delete resource",variant:"destructive"})}})(s.id),children:e.jsx(V,{className:"h-4 w-4"})})]})]})]},s.id)})}),e.jsx(Be,{open:v,onOpenChange:b,children:e.jsxs(Ke,{className:"glass-effect custom-scrollbar max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ve,{children:e.jsx(Ge,{children:j?"Edit Resource":"Add New Resource"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Title *"}),e.jsx("input",{type:"text",value:_.title,onChange:e=>k({..._,title:e.target.value}),className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",placeholder:"Resource title"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Type *"}),e.jsx("select",{value:_.resource_type,onChange:e=>k({..._,resource_type:e.target.value}),className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",children:A.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Category"}),e.jsx("select",{value:_.category,onChange:e=>k({..._,category:e.target.value}),className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",children:E.filter(e=>"all"!==e.value).map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Description"}),e.jsx("textarea",{value:_.description,onChange:e=>k({..._,description:e.target.value}),rows:3,className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",placeholder:"Brief description"})]}),("link"===_.resource_type||"video"===_.resource_type)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"URL"}),e.jsx("input",{type:"url",value:_.url,onChange:e=>k({..._,url:e.target.value}),className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",placeholder:"https://example.com"})]}),"pdf"===_.resource_type&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"File URL"}),e.jsx("input",{type:"url",value:_.file_url,onChange:e=>k({..._,file_url:e.target.value}),className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",placeholder:"Upload file and paste URL"})]}),"article"===_.resource_type&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Content"}),e.jsx("textarea",{value:_.content,onChange:e=>k({..._,content:e.target.value}),rows:10,className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground font-mono text-sm",placeholder:"Write your article content here (supports Markdown)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Tags"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",value:S,onChange:e=>M(e.target.value),onKeyPress:e=>"Enter"===e.key&&(e.preventDefault(),I()),className:"flex-1 px-4 py-2 rounded-lg border border-border bg-background text-foreground",placeholder:"Add a tag and press Enter"}),e.jsx(i,{onClick:I,children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:_.tags.map((s,t)=>e.jsxs(o,{className:"flex items-center gap-1",children:[s,e.jsx(B,{className:"h-3 w-3 cursor-pointer",onClick:()=>{return e=s,void k({..._,tags:_.tags.filter(s=>s!==e)});var e}})]},t))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"is_public",checked:_.is_public,onChange:e=>k({..._,is_public:e.target.checked}),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"is_public",className:"text-sm font-medium text-foreground",children:"Make this resource public to all clients"})]})]}),e.jsxs(He,{children:[e.jsx(i,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsxs(i,{onClick:async()=>{if(_.title&&_.resource_type)try{const{data:{user:e}}=await l.auth.getUser(),s={..._,created_by:e?.id,view_count:0};let a;if(j){const{data:e,error:r}=await l.from("educational_resources").update(s).eq("id",j.id).select().single();if(r)throw r;a=e,t({title:"Success",description:"Resource updated successfully"})}else{const{data:e,error:r}=await l.from("educational_resources").insert([s]).select().single();if(r)throw r;a=e,t({title:"Success",description:"Resource created successfully"})}b(!1),P(),F()}catch(e){console.error("Error saving resource:",e),t({title:"Error",description:"Failed to save resource",variant:"destructive"})}else t({title:"Validation Error",description:"Please fill in required fields",variant:"destructive"})},children:[j?"Update":"Create"," Resource"]})]})]})}),e.jsx(Be,{open:N,onOpenChange:y,children:e.jsx(Ke,{className:"glass-effect custom-scrollbar max-w-3xl max-h-[90vh] overflow-y-auto",children:j&&e.jsxs(e.Fragment,{children:[e.jsx(Ve,{children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx(Ge,{className:"text-2xl mb-2 text-foreground",children:j.title}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(o,{children:j.resource_type}),e.jsx(o,{variant:"outline",children:j.category}),e.jsx("span",{children:"•"}),e.jsx("span",{children:C(new Date(j.created_at),"MMMM dd, yyyy")}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[j.view_count||0," views"]})]})]})})}),e.jsxs("div",{className:"space-y-4",children:[j.description&&e.jsx("div",{children:e.jsx("p",{className:"text-muted-foreground",children:j.description})}),j.tags&&j.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:j.tags.map((s,t)=>e.jsxs(o,{variant:"outline",children:[e.jsx(De,{className:"h-3 w-3 mr-1"}),s]},t))}),"article"===j.resource_type&&j.content&&e.jsx("div",{className:"prose dark:prose-invert max-w-none",children:e.jsx("div",{className:"whitespace-pre-wrap text-foreground",children:j.content})}),"link"===j.resource_type&&j.url&&e.jsx("div",{className:"p-4 bg-muted/50 rounded-lg",children:e.jsxs("a",{href:j.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-primary hover:underline",children:[e.jsx(ze,{className:"h-4 w-4"}),"Open External Link"]})}),"video"===j.resource_type&&j.url&&e.jsx("div",{className:"aspect-video bg-muted rounded-lg flex items-center justify-center",children:e.jsxs("a",{href:j.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-primary hover:underline",children:[e.jsx(ie,{className:"h-6 w-6"}),"Watch Video"]})}),"pdf"===j.resource_type&&j.file_url&&e.jsx("div",{className:"p-4 bg-muted/50 rounded-lg",children:e.jsxs("a",{href:j.file_url,download:!0,className:"flex items-center gap-2 text-primary hover:underline",children:[e.jsx(ge,{className:"h-4 w-4"}),"Download PDF"]})})]}),e.jsxs(He,{children:[e.jsx(i,{variant:"outline",onClick:()=>y(!1),children:"Close"}),e.jsxs(i,{onClick:()=>R(),children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"Share"]})]})]})})})]})},is=()=>{const{user:t,userProfile:a}=r(),[o,m]=s.useState(!0),[x,u]=s.useState(!1),[h,b]=s.useState("business"),[N,y]=s.useState({business_name:"",business_address:"",business_phone:"",license_number:"",specializations:[],consultation_duration_default:60,buffer_time_minutes:15,working_hours:{monday:{enabled:!0,start:"09:00",end:"17:00"},tuesday:{enabled:!0,start:"09:00",end:"17:00"},wednesday:{enabled:!0,start:"09:00",end:"17:00"},thursday:{enabled:!0,start:"09:00",end:"17:00"},friday:{enabled:!0,start:"09:00",end:"17:00"},saturday:{enabled:!1,start:"09:00",end:"13:00"},sunday:{enabled:!1,start:"09:00",end:"13:00"}},time_zone:Intl.DateTimeFormat().resolvedOptions().timeZone,booking_advance_days:30,hourly_rate:"",initial_consultation_fee:"",follow_up_fee:"",package_pricing:[],email_notifications:!0,sms_notifications:!1,appointment_reminders:!0,reminder_hours_before:24,brand_color:"#10b981",logo_url:"",custom_email_signature:""}),[_,k]=s.useState(""),[C,M]=s.useState({name:"",sessions:"",price:""});s.useEffect(()=>{E()},[t]);const E=async()=>{m(!0);try{const{data:e,error:s}=await l.from("nutritionist_settings").select("*").eq("nutritionist_id",t.id).single();if(s&&"PGRST116"!==s.code)throw s;e&&y({...N,...e,specializations:e.specializations||[],working_hours:e.working_hours||N.working_hours,package_pricing:e.package_pricing||[]})}catch(e){console.error("Error fetching settings:",e)}finally{m(!1)}},A=async()=>{u(!0);try{const{data:e}=await l.from("nutritionist_settings").select("id").eq("nutritionist_id",t.id).single(),s={...N,nutritionist_id:t.id};if(e){const{error:e}=await l.from("nutritionist_settings").update(s).eq("nutritionist_id",t.id);if(e)throw e}else{const{error:e}=await l.from("nutritionist_settings").insert(s);if(e)throw e}d({title:"Settings saved",description:"Your settings have been updated successfully"})}catch(e){console.error("Error saving settings:",e),d({variant:"destructive",title:"Error",description:"Failed to save settings"})}finally{u(!1)}},F=()=>{_.trim()&&!N.specializations.includes(_.trim())&&(y({...N,specializations:[...N.specializations,_.trim()]}),k(""))},D=(e,s,t)=>{y({...N,working_hours:{...N.working_hours,[e]:{...N.working_hours[e],[s]:t}}})};return o?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(Z,{className:"w-12 h-12 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(qe,{className:"w-8 h-8 text-primary"}),"Settings"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your business settings and preferences"})]}),e.jsx(i,{onClick:A,disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Save Changes"]})})]}),e.jsxs(Oe,{value:h,onValueChange:b,children:[e.jsxs(We,{className:"grid w-full grid-cols-5",children:[e.jsx($e,{value:"business",children:"Business"}),e.jsx($e,{value:"availability",children:"Availability"}),e.jsx($e,{value:"pricing",children:"Pricing"}),e.jsx($e,{value:"notifications",children:"Notifications"}),e.jsx($e,{value:"branding",children:"Branding"})]}),e.jsx(Ue,{value:"business",className:"space-y-4",children:e.jsxs(p,{children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5"}),"Business Information"]}),e.jsx(v,{children:"Manage your professional business details"})]}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Business Name"}),e.jsx(n,{value:N.business_name,onChange:e=>y({...N,business_name:e.target.value}),placeholder:"Your Nutrition Practice"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"License Number"}),e.jsx(n,{value:N.license_number,onChange:e=>y({...N,license_number:e.target.value}),placeholder:"License #"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Business Address"}),e.jsx(c,{value:N.business_address,onChange:e=>y({...N,business_address:e.target.value}),placeholder:"123 Main St, City, State, ZIP",rows:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Business Phone"}),e.jsx(n,{value:N.business_phone,onChange:e=>y({...N,business_phone:e.target.value}),placeholder:"+1 (555) 000-0000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Specializations"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(n,{value:_,onChange:e=>k(e.target.value),placeholder:"e.g., Weight Loss, Sports Nutrition",onKeyPress:e=>"Enter"===e.key&&F()}),e.jsx(i,{onClick:F,children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:N.specializations.map((s,t)=>e.jsxs("span",{className:"px-3 py-1 bg-primary/10 text-primary rounded-full text-sm flex items-center gap-2",children:[s,e.jsx("button",{onClick:()=>(e=>{y({...N,specializations:N.specializations.filter(s=>s!==e)})})(s),className:"text-primary/60 hover:text-primary",children:"×"})]},t))})]})]})]})}),e.jsx(Ue,{value:"availability",className:"space-y-4",children:e.jsxs(p,{children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5"}),"Working Hours"]}),e.jsx(v,{children:"Set your available hours for client bookings"})]}),e.jsxs(f,{className:"space-y-4",children:[["monday","tuesday","wednesday","thursday","friday","saturday","sunday"].map(s=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-32",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx(Ye,{checked:N.working_hours[s]?.enabled||!1,onCheckedChange:e=>D(s,"enabled",e)}),e.jsx("span",{className:"capitalize font-medium",children:s})]})}),N.working_hours[s]?.enabled&&e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(n,{type:"time",value:N.working_hours[s]?.start||"09:00",onChange:e=>D(s,"start",e.target.value),className:"w-32 min-w-0"}),e.jsx("span",{children:"to"}),e.jsx(n,{type:"time",value:N.working_hours[s]?.end||"17:00",onChange:e=>D(s,"end",e.target.value),className:"w-32 min-w-0"})]})]},s)),e.jsxs("div",{className:"pt-4 border-t border-border grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Default Consultation Duration"}),e.jsxs("select",{value:N.consultation_duration_default,onChange:e=>y({...N,consultation_duration_default:parseInt(e.target.value)}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"30",children:"30 minutes"}),e.jsx("option",{value:"45",children:"45 minutes"}),e.jsx("option",{value:"60",children:"60 minutes"}),e.jsx("option",{value:"90",children:"90 minutes"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Buffer Time (minutes)"}),e.jsx(n,{type:"number",value:N.buffer_time_minutes,onChange:e=>y({...N,buffer_time_minutes:parseInt(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Booking Advance (days)"}),e.jsx(n,{type:"number",value:N.booking_advance_days,onChange:e=>y({...N,booking_advance_days:parseInt(e.target.value)})})]})]})]})]})}),e.jsx(Ue,{value:"pricing",className:"space-y-4",children:e.jsxs(p,{children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-5 h-5"}),"Consultation Pricing"]}),e.jsx(v,{children:"Set your consultation fees and package pricing"})]}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Hourly Rate"}),e.jsx(n,{type:"number",step:"0.01",value:N.hourly_rate,onChange:e=>y({...N,hourly_rate:e.target.value}),placeholder:"100.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Initial Consultation Fee"}),e.jsx(n,{type:"number",step:"0.01",value:N.initial_consultation_fee,onChange:e=>y({...N,initial_consultation_fee:e.target.value}),placeholder:"150.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Follow-up Fee"}),e.jsx(n,{type:"number",step:"0.01",value:N.follow_up_fee,onChange:e=>y({...N,follow_up_fee:e.target.value}),placeholder:"75.00"})]})]}),e.jsxs("div",{className:"pt-4 border-t border-border",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Package Pricing"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 mb-4",children:[e.jsx(n,{placeholder:"Package name",value:C.name,onChange:e=>M({...C,name:e.target.value})}),e.jsx(n,{type:"number",placeholder:"Sessions",value:C.sessions,onChange:e=>M({...C,sessions:e.target.value})}),e.jsx(n,{type:"number",step:"0.01",placeholder:"Price",value:C.price,onChange:e=>M({...C,price:e.target.value})}),e.jsx(i,{onClick:()=>{C.name&&C.sessions&&C.price&&(y({...N,package_pricing:[...N.package_pricing,{name:C.name,sessions:parseInt(C.sessions),price:parseFloat(C.price)}]}),M({name:"",sessions:"",price:""}))},children:"Add Package"})]}),N.package_pricing.length>0&&e.jsx("div",{className:"space-y-2",children:N.package_pricing.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.sessions," sessions • $",s.price]})]}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>(e=>{y({...N,package_pricing:N.package_pricing.filter((s,t)=>t!==e)})})(t),children:"Remove"})]},t))})]})]})]})}),e.jsx(Ue,{value:"notifications",className:"space-y-4",children:e.jsxs(p,{children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5"}),"Notification Preferences"]}),e.jsx(v,{children:"Manage how you receive notifications and reminders"})]}),e.jsxs(f,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Email Notifications"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive notifications via email"})]}),e.jsx(Ye,{checked:N.email_notifications,onCheckedChange:e=>y({...N,email_notifications:e})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"SMS Notifications"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive notifications via text message"})]}),e.jsx(Ye,{checked:N.sms_notifications,onCheckedChange:e=>y({...N,sms_notifications:e})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Appointment Reminders"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Send reminders for upcoming appointments"})]}),e.jsx(Ye,{checked:N.appointment_reminders,onCheckedChange:e=>y({...N,appointment_reminders:e})})]}),N.appointment_reminders&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Send reminders (hours before appointment)"}),e.jsx(n,{type:"number",value:N.reminder_hours_before,onChange:e=>y({...N,reminder_hours_before:parseInt(e.target.value)})})]})]})]})}),e.jsx(Ue,{value:"branding",className:"space-y-4",children:e.jsxs(p,{children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-5 h-5"}),"Branding & Customization"]}),e.jsx(v,{children:"Customize your brand appearance and communications"})]}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Brand Color"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{type:"color",value:N.brand_color,onChange:e=>y({...N,brand_color:e.target.value}),className:"w-20 h-10"}),e.jsx(n,{value:N.brand_color,onChange:e=>y({...N,brand_color:e.target.value}),placeholder:"#10b981"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Logo URL"}),e.jsx(n,{value:N.logo_url,onChange:e=>y({...N,logo_url:e.target.value}),placeholder:"https://example.com/logo.png"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Custom Email Signature"}),e.jsx(c,{value:N.custom_email_signature,onChange:e=>y({...N,custom_email_signature:e.target.value}),placeholder:"Best regards,\nYour Name\nCertified Nutritionist",rows:4})]})]})]})})]}),e.jsx("div",{className:"flex justify-end sticky bottom-4",children:e.jsx(i,{onClick:A,disabled:x,size:"lg",children:x?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Save All Changes"]})})})]})},ns=({user:t})=>{const[r]=a(),[l,i]=s.useState("dashboard");s.useEffect(()=>{const e=r.get("tab");i(e||"dashboard")},[r]);return e.jsx(u,{children:e.jsx(he.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:(()=>{switch(l){case"dashboard":default:return e.jsx(Je,{user:t});case"clients":return e.jsx(Qe,{});case"meals":return e.jsx(es,{});case"schedule":return e.jsx(ss,{});case"messages":return e.jsx(ts,{});case"analytics":return e.jsx(as,{});case"resources":return e.jsx(ls,{});case"blog":return e.jsx(h,{user:t});case"settings":return e.jsx(is,{})}})()},l)})},cs=()=>{const{userProfile:s}=r(),t={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}};return e.jsxs(e.Fragment,{children:[e.jsxs(x,{children:[e.jsx("title",{children:"Nutritionist Dashboard - GreenoFig"}),e.jsx("meta",{name:"description",content:"Manage your nutrition practice and clients"})]}),e.jsxs(he.div,{variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"visible",className:"space-y-8",children:[e.jsxs(he.div,{variants:t,children:[e.jsxs("h1",{className:"text-4xl font-bold",children:["Nutritionist ",e.jsx("span",{className:"gradient-text",children:"Portal"})]}),e.jsxs("p",{className:"text-text-secondary mt-2",children:["Welcome, ",s?.full_name?.split(" ")[0]||"Nutritionist",". Manage your clients and practice from here."]})]}),e.jsx(he.div,{variants:t,children:e.jsx(ns,{user:s})})]})]})};export{cs as default};
