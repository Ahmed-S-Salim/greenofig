<!DOCTYPE html>
<html>
<head>
    <title>Test Supabase Connection</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .loading { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <h1>Supabase Connection Test</h1>
    <div id="status" class="status loading">Testing connection...</div>
    <div id="details"></div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

        const supabaseUrl = 'https://xdzoikocriuvgkoenjqk.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhkem9pa29jcml1dmdrb2VuanFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAzMzg2NzUsImV4cCI6MjA3NTkxNDY3NX0.hh2GkNEdFHI9wlPfM6-oDraPz-s-zS1HlJpSTElQxHc';

        const supabase = createClient(supabaseUrl, supabaseKey);
        const status = document.getElementById('status');
        const details = document.getElementById('details');

        async function test() {
            try {
                // Test auth session
                status.textContent = 'Testing auth session...';
                const { data: session, error: sessionError } = await supabase.auth.getSession();

                if (sessionError) {
                    throw new Error('Session error: ' + sessionError.message);
                }

                details.innerHTML += '<p>✓ Auth session check: OK</p>';

                // Test database query
                status.textContent = 'Testing database connection...';
                const { data, error } = await supabase
                    .from('user_profiles')
                    .select('count')
                    .limit(1);

                if (error) {
                    throw new Error('Database error: ' + error.message);
                }

                details.innerHTML += '<p>✓ Database connection: OK</p>';
                details.innerHTML += '<p>User: ' + (session.session?.user?.email || 'Not logged in') + '</p>';

                status.textContent = '✓ All tests passed!';
                status.className = 'status success';

            } catch (error) {
                status.textContent = '✗ Connection failed!';
                status.className = 'status error';
                details.innerHTML += '<p style="color: red;"><strong>Error:</strong> ' + error.message + '</p>';
                console.error(error);
            }
        }

        test();
    </script>
</body>
</html>
