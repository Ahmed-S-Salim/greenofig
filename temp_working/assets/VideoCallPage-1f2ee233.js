import{j as e}from"./vendor-ui-1f4695e3.js";import{k as s,u as a,r as t}from"./vendor-react-c35372bd.js";import{C as l,c as r}from"./card-337a2a4f.js";import{a as i,B as n,g as c,I as o,t as m}from"./index-6b8dec48.js";import{u as d}from"./useWebRTC-25f2080c.js";import{au as x,m as h,V as u,z as g,L as j,U as p,a$ as f,b0 as N,b1 as w,d2 as y,u as b,b3 as v,b4 as k,s as C,f as S,e as P,d3 as z,a6 as R}from"./vendor-utils-a892ab91.js";import"./vendor-editor-8f9f6f2d.js";const I=()=>{const{roomId:I}=s(),$=a(),{user:E,profile:T}=i(),[V,F]=t.useState(""),[M,L]=t.useState(!1),[q,J]=t.useState(0),[A,B]=t.useState(!1),[W,X]=t.useState(!0),[G,H]=t.useState(!0),Q=t.useRef(null),U=t.useRef(null),Y=t.useRef(null),_=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),{localStream:D,remoteStream:K,connectionState:O,isMuted:Z,isVideoEnabled:ee,isScreenSharing:se,error:ae,participants:te,callQuality:le,localVideoRef:re,remoteVideoRef:ie,joinRoom:ne,leaveRoom:ce,toggleMute:oe,toggleVideo:me,toggleScreenShare:de,switchCamera:xe,initializeMedia:he}=d(I);t.useEffect(()=>(he().catch(console.error),()=>{ce()}),[]),t.useEffect(()=>("connected"===O?U.current=setInterval(()=>{J(e=>e+1)},1e3):U.current&&clearInterval(U.current),()=>{U.current&&clearInterval(U.current)}),[O]),t.useEffect(()=>{if(_&&M){const e=()=>{X(!1)};return Y.current=setTimeout(e,5e3),()=>{Y.current&&clearTimeout(Y.current)}}},[_,M,W]);const ue=e=>{const s=Math.floor(e/3600),a=Math.floor(e%3600/60),t=e%60;return s>0?`${s}:${a.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`:`${a}:${t.toString().padStart(2,"0")}`};return I?e.jsxs("div",{ref:Q,className:"min-h-screen bg-black flex flex-col",onClick:()=>{_&&M&&(X(!0),Y.current&&clearTimeout(Y.current),Y.current=setTimeout(()=>X(!1),5e3))},children:[e.jsx(h.header,{className:"absolute top-0 left-0 right-0 z-20 p-2 sm:p-4 bg-gradient-to-b from-black/80 to-transparent transition-opacity duration-300 "+(!W&&M?"opacity-0 pointer-events-none":"opacity-100"),initial:{y:-50,opacity:0},animate:{y:0,opacity:W||!M?1:0},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-5 h-5 sm:w-6 sm:h-6 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-semibold text-white text-sm sm:text-base",children:"Video Call"}),M&&"connected"===O&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-400",children:ue(q)}),(()=>{const s={good:"text-green-500",medium:"text-yellow-500",poor:"text-red-500"};return e.jsxs("div",{className:`flex items-center gap-1 ${s[le]||s.good}`,children:[e.jsx(z,{className:"w-3 h-3"}),e.jsx("span",{className:"text-[10px] uppercase",children:le})]})})()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(()=>{switch(O){case"connecting":return e.jsxs(c,{variant:"secondary",className:"text-xs",children:[e.jsx(j,{className:"w-3 h-3 mr-1 animate-spin"})," Connecting..."]});case"connected":return e.jsxs(c,{variant:"default",className:"bg-green-500 text-xs",children:[e.jsx(R,{className:"w-3 h-3 mr-1"})," Connected"]});case"failed":return e.jsxs(c,{variant:"destructive",className:"text-xs",children:[e.jsx(x,{className:"w-3 h-3 mr-1"})," Failed"]});default:return e.jsx(c,{variant:"outline",className:"text-xs",children:"Ready"})}})(),te.length>0&&e.jsxs(c,{variant:"outline",className:"text-white border-gray-600 text-xs",children:[e.jsx(g,{className:"w-3 h-3 mr-1"}),te.length]})]})]})}),e.jsx("main",{className:"flex-1 relative",children:M?e.jsxs("div",{className:"absolute inset-0",children:[e.jsxs("div",{className:"w-full h-full bg-black",children:[e.jsx("video",{ref:ie,autoPlay:!0,playsInline:!0,className:"w-full h-full object-contain"}),!K&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-24 h-24 sm:w-32 sm:h-32 rounded-full bg-gray-800 flex items-center justify-center mx-auto mb-4",children:e.jsx(p,{className:"w-12 h-12 sm:w-16 sm:h-16 text-gray-600"})}),e.jsx(j,{className:"w-8 h-8 text-primary mx-auto mb-3 animate-spin"}),e.jsx("p",{className:"text-gray-400 text-sm sm:text-base",children:"Waiting for others to join..."})]})})]}),G&&e.jsxs(h.div,{className:`absolute ${_?"bottom-28 right-3 w-28 h-36":"bottom-28 right-4 w-40 h-28 sm:w-48 sm:h-36"} bg-gray-800 rounded-xl overflow-hidden border-2 border-gray-600 shadow-xl`,drag:!0,dragConstraints:Q,whileHover:{scale:1.02},whileTap:{scale:.98},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},children:[e.jsx("video",{ref:re,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",style:{transform:"scaleX(-1)"}}),!ee&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-700 flex items-center justify-center",children:e.jsx(p,{className:"w-6 h-6 text-gray-500"})})}),e.jsx("div",{className:"absolute bottom-1 left-1 bg-black/60 px-2 py-0.5 rounded-full",children:e.jsx("span",{className:"text-white text-[10px]",children:"You"})}),Z&&e.jsx("div",{className:"absolute top-1 right-1 bg-red-500/80 p-1 rounded-full",children:e.jsx(f,{className:"w-3 h-3 text-white"})})]}),ae&&e.jsxs(h.div,{className:"absolute top-16 left-4 right-4 sm:left-1/2 sm:right-auto sm:transform sm:-translate-x-1/2 bg-red-500/90 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm",initial:{y:-20,opacity:0},animate:{y:0,opacity:1},children:[e.jsx(x,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-2",children:ae})]})]}):e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center p-4 bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900",children:[e.jsxs("div",{className:"relative w-full max-w-sm sm:max-w-md aspect-[4/3] sm:aspect-video bg-gray-800 rounded-2xl overflow-hidden border-2 border-gray-700 mb-4 sm:mb-6 shadow-2xl",children:[e.jsx("video",{ref:re,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",style:{transform:"scaleX(-1)"}}),!D&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900",children:e.jsxs("div",{className:"text-center",children:[e.jsx(j,{className:"w-10 h-10 sm:w-12 sm:h-12 text-primary mx-auto mb-2 animate-spin"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Loading camera..."})]})}),D&&!ee&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900",children:e.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 rounded-full bg-gray-700 flex items-center justify-center",children:e.jsx(p,{className:"w-10 h-10 sm:w-12 sm:h-12 text-gray-500"})})}),e.jsxs("div",{className:"absolute bottom-3 left-1/2 transform -translate-x-1/2 flex gap-3",children:[e.jsx(n,{variant:Z?"destructive":"secondary",size:"sm",className:"rounded-full w-12 h-12 sm:w-14 sm:h-14",onClick:e=>{e.stopPropagation(),oe()},children:Z?e.jsx(f,{className:"w-5 h-5"}):e.jsx(N,{className:"w-5 h-5"})}),e.jsx(n,{variant:ee?"secondary":"destructive",size:"sm",className:"rounded-full w-12 h-12 sm:w-14 sm:h-14",onClick:e=>{e.stopPropagation(),me()},children:ee?e.jsx(u,{className:"w-5 h-5"}):e.jsx(w,{className:"w-5 h-5"})}),_&&e.jsx(n,{variant:"secondary",size:"sm",className:"rounded-full w-12 h-12 sm:w-14 sm:h-14",onClick:e=>{e.stopPropagation(),xe()},children:e.jsx(y,{className:"w-5 h-5"})})]})]}),e.jsx(l,{className:"w-full max-w-sm sm:max-w-md bg-gray-800/80 backdrop-blur-sm border-gray-700",children:e.jsxs(r,{className:"p-4 sm:p-6",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-center mb-4 text-white",children:"Ready to join?"}),!E&&e.jsx("div",{className:"mb-4",children:e.jsx(o,{value:V,onChange:e=>F(e.target.value),placeholder:"Enter your name",className:"bg-gray-700 border-gray-600 text-white placeholder:text-gray-400"})}),E&&e.jsxs("div",{className:"mb-4 p-3 bg-gray-700/50 rounded-lg flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center",children:e.jsx(p,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Joining as"}),e.jsx("p",{className:"font-semibold text-white text-sm",children:(null==T?void 0:T.full_name)||E.email})]})]}),ae&&e.jsxs("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg text-red-400 text-sm flex items-start gap-2",children:[e.jsx(x,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:ae})]}),e.jsxs(n,{className:"w-full bg-green-500 hover:bg-green-600 gap-2 h-12",size:"lg",onClick:async()=>{if(E||V.trim())try{await ne(),L(!0),m({title:"Joining call...",description:"Connecting to video call"})}catch(e){m({variant:"destructive",title:"Error",description:e.message||"Could not join call. Please check camera/microphone permissions."})}else m({variant:"destructive",title:"Name required",description:"Please enter your name to join the call"})},disabled:!E&&!V.trim(),children:[e.jsx(b,{className:"w-5 h-5"}),"Join Call"]}),!E&&e.jsxs("p",{className:"text-center text-xs text-gray-400 mt-3",children:[e.jsx("a",{href:"/login",className:"text-primary hover:underline",children:"Sign in"})," for a better experience"]})]})})]})}),M&&e.jsxs(h.footer,{className:"absolute bottom-0 left-0 right-0 z-20 p-3 sm:p-4 bg-gradient-to-t from-black/90 to-transparent transition-opacity duration-300 "+(W?"opacity-100":"opacity-0 pointer-events-none"),initial:{y:50,opacity:0},animate:{y:0,opacity:W?1:0},children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 sm:gap-4",children:[e.jsx(n,{variant:Z?"destructive":"secondary",size:"lg",className:"rounded-full "+(_?"w-12 h-12":"w-14 h-14"),onClick:e=>{e.stopPropagation(),oe()},children:Z?e.jsx(f,{className:"w-5 h-5 sm:w-6 sm:h-6"}):e.jsx(N,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),e.jsx(n,{variant:ee?"secondary":"destructive",size:"lg",className:"rounded-full "+(_?"w-12 h-12":"w-14 h-14"),onClick:e=>{e.stopPropagation(),me()},children:ee?e.jsx(u,{className:"w-5 h-5 sm:w-6 sm:h-6"}):e.jsx(w,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),_&&e.jsx(n,{variant:"secondary",size:"lg",className:"rounded-full w-12 h-12",onClick:e=>{e.stopPropagation(),xe()},children:e.jsx(y,{className:"w-5 h-5"})}),!_&&e.jsx(n,{variant:se?"default":"secondary",size:"lg",className:"rounded-full w-14 h-14 "+(se?"bg-primary":""),onClick:e=>{e.stopPropagation(),de()},disabled:"connected"!==O,children:se?e.jsx(v,{className:"w-6 h-6"}):e.jsx(k,{className:"w-6 h-6"})}),e.jsx(n,{variant:"destructive",size:"lg",className:"rounded-full "+(_?"w-14 h-14":"w-16 h-16"),onClick:e=>{e.stopPropagation(),(async()=>{await ce(),J(0),m({title:"Call ended",description:`Call duration: ${ue(q)}`}),$(-1)})()},children:e.jsx(C,{className:"w-6 h-6 sm:w-7 sm:h-7"})}),!_&&e.jsx(n,{variant:"secondary",size:"lg",className:"rounded-full w-14 h-14",onClick:e=>{var s,a,t,l,r,i;e.stopPropagation(),document.fullscreenElement?((null==(r=document.exitFullscreen)?void 0:r.call(document))||null==(i=document.webkitExitFullscreen)||i.call(document),B(!1)):((null==(a=null==(s=Q.current)?void 0:s.requestFullscreen)?void 0:a.call(s))||null==(l=null==(t=Q.current)?void 0:t.webkitRequestFullscreen)||l.call(t),B(!0))},children:A?e.jsx(S,{className:"w-6 h-6"}):e.jsx(P,{className:"w-6 h-6"})})]}),_&&e.jsx("p",{className:"text-center text-[10px] text-gray-500 mt-2",children:"Tap anywhere to show/hide controls"})]})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-900 to-gray-800 p-4",children:e.jsx(l,{className:"max-w-md w-full",children:e.jsxs(r,{className:"p-8 text-center",children:[e.jsx(x,{className:"w-16 h-16 mx-auto text-destructive mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Invalid Call Link"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"This video call link is invalid or has expired."}),e.jsx(n,{onClick:()=>$(-1),children:"Go Back"})]})})})};export{I as default};
