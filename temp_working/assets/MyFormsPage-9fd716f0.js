import{j as e}from"./vendor-ui-1f4695e3.js";import{r as s}from"./vendor-react-c35372bd.js";import{u as t,a as r,s as a,g as l,B as i,D as n,b as o,d,e as m,f as c,T as x,m as u}from"./index-6b8dec48.js";import"./card-337a2a4f.js";import{C as p}from"./ClientIntakeForm-117b49ad.js";import{L as h,l as f,au as g,F as b,U as j,a4 as N,a6 as v,aJ as y,bA as _,h as w,a8 as q,b2 as C}from"./vendor-utils-a892ab91.js";import"./vendor-editor-8f9f6f2d.js";const S={pending:{label:"Pending",label_ar:"قيد الانتظار",color:"bg-yellow-500/10 text-yellow-600 border-yellow-500/30",icon:q},in_progress:{label:"In Progress",label_ar:"قيد التقدم",color:"bg-blue-500/10 text-blue-600 border-blue-500/30",icon:_},submitted:{label:"Submitted",label_ar:"تم الإرسال",color:"bg-primary/10 text-primary border-primary/30",icon:v},approved:{label:"Approved",label_ar:"تمت الموافقة",color:"bg-emerald-500/10 text-emerald-600 border-emerald-500/30",icon:v},edit_requested:{label:"Edit Requested",label_ar:"طلب تعديل",color:"bg-orange-500/10 text-orange-600 border-orange-500/30",icon:C}};function F(){var q,C;const{t:F,i18n:R}=t(),{user:k}=r(),D=R.language,E="ar"===D,[A,L]=s.useState([]),[P,I]=s.useState(!0),[$,z]=s.useState(null),[B,O]=s.useState(""),[T,J]=s.useState(null),[M,U]=s.useState(!1);s.useEffect(()=>{V();const e=a.channel("my_form_assignments").on("postgres_changes",{event:"*",schema:"public",table:"form_assignments",filter:`client_id=eq.${null==k?void 0:k.id}`},()=>{V()}).subscribe();return()=>{e.unsubscribe()}},[null==k?void 0:k.id]);const V=async()=>{try{const{data:e,error:s}=await a.from("form_assignments").select("\n          *,\n          form_template:form_templates(*),\n          responses:form_responses(*)\n        ").eq("client_id",null==k?void 0:k.id).order("created_at",{ascending:!1});if(s)throw s;if(e&&e.length>0){const s=[...new Set(e.map(e=>e.nutritionist_id).filter(Boolean))];if(s.length>0){const{data:t}=await a.from("user_profiles").select("id, full_name, email").in("id",s),r=e.map(e=>({...e,nutritionist:(null==t?void 0:t.find(s=>s.id===e.nutritionist_id))||null}));L(r)}else L(e)}else L([])}catch(e){}finally{I(!1)}},X=()=>{z(null),V()},G=A.filter(e=>["pending","in_progress","edit_requested"].includes(e.status)),H=A.filter(e=>["submitted","approved"].includes(e.status));return P?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(h,{className:"w-8 h-8 animate-spin text-primary"})}):$?e.jsx(p,{assignmentId:$.id,formTemplate:$.form_template,existingResponses:null==(C=null==(q=$.responses)?void 0:q[0])?void 0:C.responses,onComplete:X,onClose:()=>z(null),readOnly:"submitted"===$.status||"approved"===$.status}):e.jsxs("div",{className:"max-w-4xl mx-auto "+(E?"rtl":"ltr"),dir:E?"rtl":"ltr",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-3 rounded-2xl bg-primary/10",children:e.jsx(f,{className:"w-7 h-7 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:E?"النماذج الخاصة بي":"My Forms"}),e.jsx("p",{className:"text-text-secondary mt-1",children:E?"أكمل هذه النماذج لمساعدة أخصائي التغذية في فهم احتياجاتك الصحية":"Complete these forms to help your nutritionist understand your health needs"})]})]})}),G.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(g,{className:"w-5 h-5 text-yellow-600"}),e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:E?"نماذج تحتاج إلى إكمال":"Forms Requiring Completion"}),e.jsx(l,{variant:"outline",className:"bg-yellow-500/10 text-yellow-600 border-yellow-500/30",children:G.length})]}),e.jsx("div",{className:"grid gap-4",children:G.map(s=>{const t=s.form_template,r=S[s.status],a=r.icon,n=E&&t.name_ar||t.name,o=E&&t.description_ar||t.description;return e.jsx("div",{className:"glass-effect rounded-2xl p-4 sm:p-5 border border-border/30 hover:border-primary/30 transition-all cursor-pointer group",onClick:()=>z(s),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"p-2 rounded-xl bg-primary/10 group-hover:bg-primary/20 transition-colors",children:e.jsx(b,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:n}),e.jsxs(l,{className:`${r.color} border text-xs`,children:[e.jsx(a,{className:"w-3 h-3 mr-1"}),E?r.label_ar:r.label]}),s.is_required&&e.jsx(l,{variant:"destructive",className:"text-xs",children:E?"مطلوب":"Required"})]}),e.jsx("p",{className:"text-sm text-text-secondary mb-2",children:o}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-text-secondary",children:[s.nutritionist&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(j,{className:"w-3 h-3"}),E?"من:":"From:"," ",s.nutritionist.full_name]}),s.due_date&&e.jsxs("span",{children:[E?"موعد التسليم:":"Due:"," ",new Date(s.due_date).toLocaleDateString(D)]})]})]})]}),e.jsxs(i,{className:"bg-gradient-to-r from-primary to-green-400 hover:opacity-90 text-primary-foreground shadow-lg min-h-[44px]",children:["in_progress"===s.status?E?"متابعة":"Continue":"edit_requested"===s.status?E?"تعديل":"Edit":E?"ابدأ":"Start",e.jsx(N,{className:"w-4 h-4 ml-2 "+(E?"rotate-180":"")})]})]})},s.id)})})]}),H.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(v,{className:"w-5 h-5 text-primary"}),e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:E?"النماذج المكتملة":"Completed Forms"}),e.jsx(l,{variant:"outline",className:"bg-primary/10 text-primary border-primary/30",children:H.length})]}),e.jsx("div",{className:"grid gap-3",children:H.map(s=>{const t=s.form_template,r=S[s.status],a=r.icon,n=E&&t.name_ar||t.name;return e.jsx("div",{className:"glass-effect rounded-xl p-4 border border-border/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-xl",children:e.jsx(v,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-foreground",children:n}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-text-secondary",children:[s.nutritionist&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(j,{className:"w-3 h-3"}),E?"من:":"From:"," ",s.nutritionist.full_name]}),s.nutritionist&&e.jsx("span",{children:"•"}),e.jsxs("span",{children:[E?"تم الإرسال:":"Submitted:"," ",new Date(s.submitted_at).toLocaleDateString(D)]})]})]}),e.jsxs(l,{className:`${r.color} border text-xs`,children:[e.jsx(a,{className:"w-3 h-3 mr-1"}),E?r.label_ar:r.label]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>z(s),className:"min-h-[40px]",children:[e.jsx(y,{className:"w-4 h-4 mr-1"}),E?"عرض":"View"]}),"submitted"===s.status&&e.jsxs(i,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),J(s.id)},className:"min-h-[40px]",children:[e.jsx(_,{className:"w-4 h-4 mr-1"}),E?"طلب تعديل":"Request Edit"]})]})]})},s.id)})})]}),0===A.length&&e.jsxs("div",{className:"glass-effect rounded-2xl p-8 sm:p-12 text-center border border-border/30",children:[e.jsx("div",{className:"p-4 rounded-full bg-muted inline-block mb-4",children:e.jsx(f,{className:"w-12 h-12 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:E?"لا توجد نماذج حالياً":"No Forms Available"}),e.jsx("p",{className:"text-text-secondary",children:E?"سيظهر هنا أي نماذج يرسلها لك أخصائي التغذية":"Any forms sent to you by your nutritionist will appear here"})]}),e.jsx(n,{open:!!T,onOpenChange:()=>J(null),children:e.jsxs(o,{className:"max-w-md",children:[e.jsxs(d,{children:[e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-primary"}),E?"طلب تعديل النموذج":"Request Form Edit"]}),e.jsx(c,{children:E?"يرجى شرح سبب حاجتك لتعديل هذا النموذج":"Please explain why you need to edit this form"})]}),e.jsx(x,{value:B,onChange:e=>O(e.target.value),placeholder:E?"سبب طلب التعديل...":"Reason for edit request...",className:"min-h-[120px] bg-card/50",dir:E?"rtl":"ltr"}),e.jsxs(u,{children:[e.jsx(i,{variant:"outline",onClick:()=>{J(null),O("")},children:E?"إلغاء":"Cancel"}),e.jsxs(i,{onClick:()=>(async e=>{if(B.trim()){U(!0);try{const{error:s}=await a.from("form_edit_requests").insert({assignment_id:e,client_id:k.id,reason:B});if(s)throw s;await a.from("form_assignments").update({status:"edit_requested"}).eq("id",e),J(null),O(""),V()}catch(s){}finally{U(!1)}}})(T),disabled:!B.trim()||M,className:"bg-gradient-to-r from-primary to-green-400 hover:opacity-90 text-primary-foreground",children:[M?e.jsx(h,{className:"w-4 h-4 animate-spin mr-1"}):e.jsx(w,{className:"w-4 h-4 mr-1"}),E?"إرسال الطلب":"Submit Request"]})]})]})})]})}export{F as default};
