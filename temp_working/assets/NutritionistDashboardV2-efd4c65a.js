import{j as e,o as s,p as t,u as a,q as l,r as i,t as r,v as n,w as c,x as d,y as o,z as m,B as x,E as u,G as h,J as p}from"./vendor-ui-1f4695e3.js";import{r as g,u as j,L as f,R as v,l as b,f as N}from"./vendor-react-c35372bd.js";import{g as y,a as w,s as _,u as k,n as C,D as S,j as D,B as P,b as M,d as A,e as $,I as E,T as R,m as T,t as F,c as z,L as I,f as L,o as q,p as O,_ as B,H as G}from"./index-6b8dec48.js";import{E as W,B as U}from"./BlogManagementHub-b3edf6fc.js";import{C as V,a as H,b as Y,c as K,e as Q}from"./card-337a2a4f.js";import{S as J,a3 as Z,a0 as X,E as ee,m as se,z as te,p as ae,O as le,ac as ie,ad as re,ae as ne,af as ce,ag as de,ah as oe,ai as me,aj as xe,ak as ue,al as he,g as pe,am as ge,a1 as je,an as fe,ao as ve,X as be,q as Ne,C as ye,U as we,B as _e,ap as ke,aq as Ce,L as Se,b as De,a8 as Pe,ar as Me,as as Ae,at as $e,au as Ee,av as Re,aw as Te,y as Fe,ax as ze,ay as Ie,az as Le,a4 as qe,i as Oe,M as Be,F as Ge,k as We,V as Ue,D as Ve,aA as He,aB as Ye,H as Ke,aC as Qe,aD as Je,aE as Ze,aF as Xe,a2 as es,aG as ss,aH as ts,aI as as,aJ as ls,aK as is,aL as rs,aM as ns,aN as cs,aO as ds,aP as os,aQ as ms,aR as xs,aS as us,h as hs,aT as ps,aU as gs,aV as js,aW as fs,aX as vs,aY as bs,aZ as Ns,u as ys,s as ws,a_ as _s,a$ as ks,b0 as Cs,b1 as Ss,b2 as Ds,b3 as Ps,b4 as Ms,f as As,e as $s,b5 as Es,a6 as Rs,b6 as Ts,b7 as Fs,b8 as zs,b9 as Is,ba as Ls,bb as qs,bc as Os,bd as Bs,be as Gs,bf as Ws,bg as Us,_ as Vs,A as Hs,bh as Ys,r as Ks,bi as Qs,bj as Js,bk as Zs,bl as Xs,bm as et,bn as st,j as tt,bo as at,bp as lt,bq as it,br as rt,bs as nt,I as ct,bt as dt,bu as ot,bv as mt,ab as xt,G as ut,bw as ht,bx as pt,by as gt,l as jt,bz as ft,bA as vt,bB as bt,bC as Nt}from"./vendor-utils-a892ab91.js";import{P as yt}from"./progress-0fee62a7.js";import{S as wt,a as _t,b as kt,c as Ct,d as St}from"./select-2a07d39b.js";import{T as Dt,a as Pt,b as Mt,c as At}from"./tabs-fb6868c7.js";import{C as $t}from"./checkbox-7ffa2cd8.js";import{D as Et,a as Rt,b as Tt,c as Ft,d as zt}from"./AIBlogAssistant-056e3d94.js";import{u as It}from"./useWebRTC-25f2080c.js";import{S as Lt}from"./switch-9ad3fbc0.js";import{A as qt,a as Ot}from"./alert-9ac43f95.js";import{C as Bt}from"./ClientIntakeForm-117b49ad.js";import"./vendor-editor-8f9f6f2d.js";import"./BlogTagsManager-515206b7.js";import"./alert-dialog-710c679f.js";const Gt=({tier:s,size:t="default",showIcon:a=!0})=>{const l={Base:{color:"bg-gray-500/10 text-gray-700 dark:bg-gray-500/20 dark:text-gray-300 border-gray-500/20",icon:J,label:"Base"},Premium:{color:"bg-blue-500/10 text-blue-700 dark:bg-blue-500/20 dark:text-blue-300 border-blue-500/20",icon:Z,label:"Premium"},Elite:{color:"bg-gradient-to-r from-yellow-500/10 to-orange-500/10 text-yellow-700 dark:from-yellow-500/20 dark:to-orange-500/20 dark:text-yellow-300 border-yellow-500/20",icon:X,label:"Elite"}},i=l[s]||l.Base,r=i.icon;return e.jsxs(y,{className:`${i.color} ${{sm:"text-xs px-2 py-0.5",default:"text-sm px-3 py-1",lg:"text-base px-4 py-1.5"}[t]} font-semibold border`,variant:"outline",children:[a&&e.jsx(r,{className:"w-3 h-3 mr-1"}),i.label]})},Wt=()=>{const{userProfile:s}=w(),[t,a]=g.useState([]),[l,i]=g.useState(null),[r,n]=g.useState(!0);g.useEffect(()=>{(null==s?void 0:s.id)&&c()},[null==s?void 0:s.id]);const c=async()=>{try{const{data:e,error:t}=await _.from("client_retention_metrics").select("*").eq("nutritionist_id",s.id).order("month_year",{ascending:!1}).limit(6);if(t)return;a((e||[]).reverse()),i((null==e?void 0:e[0])||null),n(!1)}catch(e){n(!1)}},d=t.map(e=>({month:e.month_year,clients:e.total_clients,active:e.active_clients,retention:e.retention_rate,revenue:e.total_revenue}));return r?e.jsxs(V,{className:"glass-effect",children:[e.jsx(H,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5 text-primary"}),"Client Retention Metrics"]})}),e.jsx(K,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-40 bg-muted rounded"}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:[...Array(4)].map((s,t)=>e.jsx("div",{className:"h-20 bg-muted rounded"},t))})]})})]}):e.jsxs(V,{className:"glass-effect",children:[e.jsxs(H,{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5 text-primary"}),"Client Retention Analytics"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Track your client retention, tier distribution, and revenue over time"})]}),e.jsxs(K,{className:"space-y-6",children:[l&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"p-4 bg-gradient-to-br from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(te,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Total Clients"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-400",children:l.total_clients}),e.jsxs("div",{className:"text-xs text-green-400 mt-1",children:["+",l.new_clients," new this month"]})]}),e.jsxs(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"p-4 bg-gradient-to-br from-green-500/10 to-emerald-500/10 rounded-lg border border-green-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ae,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Retention Rate"})]}),e.jsxs("div",{className:"text-2xl font-bold text-green-400",children:[l.retention_rate||0,"%"]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[l.active_clients," active clients"]})]}),e.jsxs(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"p-4 bg-gradient-to-br from-purple-500/10 to-pink-500/10 rounded-lg border border-purple-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(le,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Monthly Revenue"})]}),e.jsxs("div",{className:"text-2xl font-bold text-purple-400",children:["$",l.total_revenue||0]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["$",l.revenue_per_client||0,"/client"]})]}),e.jsxs(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"p-4 bg-gradient-to-br from-orange-500/10 to-red-500/10 rounded-lg border border-orange-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Z,{className:"w-4 h-4 text-orange-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Elite Clients"})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-400",children:l.elite_clients}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Premium: ",l.premium_clients," | Pro: ",l.pro_clients]})]})]}),l&&e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-3 text-sm",children:"Client Tier Distribution"}),e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Base"}),e.jsx("div",{className:"text-lg font-bold",children:l.base_clients}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[Math.round(l.base_clients/l.total_clients*100),"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-xs text-muted-foreground mb-1 flex items-center justify-center gap-1",children:[e.jsx(J,{className:"w-3 h-3"}),"Premium"]}),e.jsx("div",{className:"text-lg font-bold text-blue-400",children:l.premium_clients}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[Math.round(l.premium_clients/l.total_clients*100),"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-xs text-muted-foreground mb-1 flex items-center justify-center gap-1",children:[e.jsx(Z,{className:"w-3 h-3"}),"Pro"]}),e.jsx("div",{className:"text-lg font-bold text-purple-400",children:l.pro_clients}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[Math.round(l.pro_clients/l.total_clients*100),"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-xs text-muted-foreground mb-1 flex items-center justify-center gap-1",children:[e.jsx(X,{className:"w-3 h-3"}),"Elite"]}),e.jsx("div",{className:"text-lg font-bold text-yellow-400",children:l.elite_clients}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[Math.round(l.elite_clients/l.total_clients*100),"%"]})]})]})]}),t.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3 text-sm",children:"6-Month Retention Trend"}),e.jsx(ie,{width:"100%",height:200,children:e.jsxs(re,{data:d,children:[e.jsx(ne,{strokeDasharray:"3 3",stroke:"#333"}),e.jsx(ce,{dataKey:"month",stroke:"#888",style:{fontSize:"12px"}}),e.jsx(de,{stroke:"#888",style:{fontSize:"12px"}}),e.jsx(oe,{contentStyle:{backgroundColor:"#1a1a1a",border:"1px solid #333",borderRadius:"8px"}}),e.jsx(me,{}),e.jsx(xe,{type:"monotone",dataKey:"clients",stroke:"#3b82f6",strokeWidth:2,name:"Total Clients"}),e.jsx(xe,{type:"monotone",dataKey:"active",stroke:"#10b981",strokeWidth:2,name:"Active Clients"}),e.jsx(xe,{type:"monotone",dataKey:"retention",stroke:"#a855f7",strokeWidth:2,name:"Retention %"})]})})]}),0===t.length&&e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(ee,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No retention metrics yet"}),e.jsx("p",{className:"text-xs mt-1",children:"Metrics will automatically calculate at the end of each month"})]})]})]})},Ut=()=>{const{user:s}=w(),{t:t,i18n:a}=k(),l="ar"===a.language,i=j(),[r,n]=g.useState([]),[c,d]=g.useState(!0);g.useEffect(()=>{o()},[]);const o=async()=>{var e;d(!0);try{const t=[],{data:a}=await _.from("user_profiles").select("id, full_name, email, tier, created_at").eq("role","user");for(const l of a||[]){const{data:a}=await _.from("client_progress").select("created_at, weight_kg").eq("user_id",l.id).order("created_at",{ascending:!1}).limit(1),i=null==(e=null==a?void 0:a[0])?void 0:e.created_at,r=i?ue(new Date,new Date(i)):999;r>=7&&t.push({id:`weighin-${l.id}`,type:"missed_weighin",priority:r>=14?"high":"medium",client:l,message:`No weigh-in for ${r} days`,icon:he,action:"message"});const{data:n}=await _.from("messages").select("id, created_at").eq("sender_id",l.id).eq("recipient_id",null==s?void 0:s.id).eq("is_read",!1);if(n&&n.length>0){const e=n.reduce((e,s)=>new Date(s.created_at)<new Date(e.created_at)?s:e),s=ue(new Date,new Date(e.created_at));s>=1&&t.push({id:`message-${l.id}`,type:"unanswered_message",priority:s>=3?"high":"medium",client:l,message:`${n.length} unanswered message${n.length>1?"s":""} (${s}d)`,icon:pe,action:"message"})}}t.sort((e,s)=>{const t={high:0,medium:1,low:2};return t[e.priority]-t[s.priority]}),n(t.slice(0,10))}catch(t){}finally{d(!1)}};return e.jsxs(V,{className:"glass-effect",children:[e.jsx(H,{className:"pb-3",children:e.jsxs(Y,{className:"text-lg flex items-center gap-2 "+(l?"flex-row-reverse":""),children:[e.jsx(ge,{className:"w-5 h-5 text-orange-500"}),t("nutritionistDashboard.clientAlerts","Client Alerts"),r.length>0&&e.jsx(y,{variant:"destructive",children:r.length})]})}),e.jsx(K,{children:c?e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:t("nutritionistDashboard.loading","Loading...")}):0===r.length?e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(je,{className:"w-8 h-8 mx-auto mb-2 text-green-500"}),e.jsx("p",{children:t("nutritionistDashboard.noAlertsAllOnTrack","No alerts - all clients on track!")})]}):e.jsx("div",{className:"space-y-2 max-h-[300px] overflow-y-auto",children:r.map(s=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg cursor-pointer hover:bg-muted/50 transition-colors "+("high"===s.priority?"bg-red-500/10 border border-red-500/20":"medium"===s.priority?"bg-orange-500/10 border border-orange-500/20":"bg-muted/50"),onClick:()=>(e=>{"message"===e.action&&i(`/app/nutritionist/messages?conversation=${e.client.id}`)})(s),children:[e.jsx(s.icon,{className:"w-4 h-4 "+("high"===s.priority?"text-red-500":"text-orange-500")}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:s.client.full_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.message})]}),e.jsx(fe,{className:"w-4 h-4 text-muted-foreground"})]},s.id))})})]})},Vt=()=>{const{t:s,i18n:t}=k(),a="ar"===t.language,[l,i]=g.useState({achieved:0,total:0,percentage:0}),[r,n]=g.useState([]),[c,d]=g.useState(!0);g.useEffect(()=>{o()},[]);const o=async()=>{d(!0);try{const e=new Date;e.setDate(e.getDate()-e.getDay()),e.setHours(0,0,0,0);const{data:s}=await _.from("client_goals").select("\n          *,\n          client:user_profiles!client_goals_client_id_fkey(full_name, email)\n        ").eq("status","active").not("target_date","is",null),t=(s||[]).filter(s=>{const t=new Date(s.target_date),a=ve(e,7);return t>=e&&t<a}).map(e=>{const s=e.current_value&&e.target_value?Math.min(100,Math.round(e.current_value/e.target_value*100)):0;return{...e,progress:s,onTrack:s>=70}}),a=t.filter(e=>e.onTrack).length,l=t.length;i({achieved:a,total:l,percentage:l>0?Math.round(a/l*100):0}),n(t.slice(0,5))}catch(e){}finally{d(!1)}};return e.jsxs(V,{className:"glass-effect",children:[e.jsx(H,{className:"pb-3",children:e.jsxs(Y,{className:"text-lg flex items-center gap-2 "+(a?"flex-row-reverse":""),children:[e.jsx(ae,{className:"w-5 h-5 text-green-500"}),s("nutritionistDashboard.weeklyGoalProgress","Weekly Goal Progress")]})}),e.jsx(K,{children:c?e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:s("nutritionistDashboard.loading","Loading...")}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("div",{className:"text-4xl font-bold text-green-500",children:[l.percentage,"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a?`${l.achieved} Ù…Ù† ${l.total} Ø¹Ù…ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø±`:`${l.achieved} of ${l.total} clients on track`}),e.jsx(yt,{value:l.percentage,className:"mt-2 h-2"})]}),r.length>0&&e.jsx("div",{className:"space-y-2 mt-4",children:r.map(s=>{var t;return e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.onTrack?e.jsx(je,{className:"w-4 h-4 text-green-500"}):e.jsx(be,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"truncate flex-1",children:null==(t=s.client)?void 0:t.full_name}),e.jsxs("span",{className:"text-muted-foreground",children:[s.progress,"%"]})]},s.id)})})]})})]})},Ht=()=>{const{t:s,i18n:t}=k(),a="ar"===t.language,[l,i]=g.useState([]),[r,n]=g.useState(!0);g.useEffect(()=>{c()},[]);const c=async()=>{n(!0);try{const{data:e}=await _.from("user_profiles").select("id, full_name, email, tier, subscription_end_date, created_at").eq("role","user").not("tier","eq","Base").not("subscription_end_date","is",null).order("subscription_end_date",{ascending:!0}),s=new Date,t=ve(s,30),a=(e||[]).filter(e=>{const a=new Date(e.subscription_end_date);return a>=s&&a<=t}).map(e=>({...e,daysUntilRenewal:ue(new Date(e.subscription_end_date),s)}));i(a.slice(0,5))}catch(e){i([])}finally{n(!1)}};return e.jsxs(V,{className:"glass-effect",children:[e.jsx(H,{className:"pb-3",children:e.jsxs(Y,{className:"text-lg flex items-center gap-2 "+(a?"flex-row-reverse":""),children:[e.jsx(Ne,{className:"w-5 h-5 text-blue-500"}),s("nutritionistDashboard.upcomingRenewals","Upcoming Renewals")]})}),e.jsx(K,{children:r?e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:s("nutritionistDashboard.loading","Loading...")}):0===l.length?e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(ye,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:s("nutritionistDashboard.noRenewalsNext30Days","No renewals in the next 30 days")})]}):e.jsx("div",{className:"space-y-3",children:l.map(t=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg bg-muted/50 "+(a?"flex-row-reverse":""),children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(we,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:t.full_name}),e.jsx(y,{variant:"outline",className:"text-xs",children:t.tier})]}),e.jsxs("div",{className:a?"text-left":"text-right",children:[e.jsxs("p",{className:"text-sm font-semibold "+(t.daysUntilRenewal<=7?"text-red-500":t.daysUntilRenewal<=14?"text-orange-500":"text-muted-foreground"),children:[t.daysUntilRenewal,a?"ÙŠ":"d"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s("nutritionistDashboard.daysUntilRenewal","until renewal")})]})]},t.id))})})]})},Yt=()=>{const{user:s}=w(),{t:t,i18n:a}=k(),l="ar"===a.language,i=j(),[r,n]=g.useState([]),[c,d]=g.useState(!0);g.useEffect(()=>{o()},[]);const o=async()=>{d(!0);try{const e=[],t=(new Date).toISOString().split("T")[0],{data:a}=await _.from("appointments").select("*, client:user_profiles!appointments_client_id_fkey(full_name)").eq("date",t).eq("status","scheduled");a&&a.length>0&&e.push({id:"appointments",icon:ye,title:`${a.length} appointment${a.length>1?"s":""} today`,description:a.map(e=>{var s;return null==(s=e.client)?void 0:s.full_name}).slice(0,2).join(", "),action:()=>i("/app/nutritionist/schedule"),priority:"high"});const{data:l,count:r}=await _.from("messages").select("*",{count:"exact",head:!0}).eq("recipient_id",null==s?void 0:s.id).eq("is_read",!1);r&&r>0&&e.push({id:"messages",icon:pe,title:`${r} unread message${r>1?"s":""}`,description:"Review and respond to clients",action:()=>i("/app/nutritionist/messages"),priority:"medium"});const{data:c}=await _.from("user_profiles").select("id, full_name").eq("role","user").not("id","in",_.from("meal_plans_v2").select("client_id"));n(e.slice(0,5))}catch(e){}finally{d(!1)}};return e.jsxs(V,{className:"glass-effect",children:[e.jsx(H,{className:"pb-3",children:e.jsxs(Y,{className:"text-lg flex items-center gap-2 "+(l?"flex-row-reverse":""),children:[e.jsx(_e,{className:"w-5 h-5 text-purple-500"}),t("nutritionistDashboard.actionItems","Action Items")]})}),e.jsx(K,{children:c?e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:t("nutritionistDashboard.loading","Loading...")}):0===r.length?e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(je,{className:"w-8 h-8 mx-auto mb-2 text-green-500"}),e.jsx("p",{children:t("nutritionistDashboard.allCaughtUp","All caught up!")})]}):e.jsx("div",{className:"space-y-2",children:r.map(s=>e.jsxs("div",{onClick:s.action,className:"flex items-center gap-3 p-3 rounded-lg cursor-pointer hover:bg-muted/50 transition-colors "+("high"===s.priority?"bg-primary/5 border border-primary/20":"bg-muted/50"),children:[e.jsx(s.icon,{className:"w-4 h-4 text-primary"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium",children:s.title}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s.description})]}),e.jsx(fe,{className:"w-4 h-4 text-muted-foreground"})]},s.id))})})]})},Kt=[{id:"weekly-checkin",name:"Weekly Check-in",icon:ye,color:"bg-blue-100 text-blue-700",description:"Regular weekly progress check"},{id:"goal-review",name:"Goal Review",icon:ae,color:"bg-purple-100 text-purple-700",description:"Review and adjust client goals"},{id:"inactive-followup",name:"Inactive Follow-up",icon:Ee,color:"bg-red-100 text-red-700",description:"Reach out to inactive clients"},{id:"progress-celebration",name:"Progress Celebration",icon:ee,color:"bg-green-100 text-green-700",description:"Celebrate client achievements"},{id:"custom",name:"Custom Reminder",icon:pe,color:"bg-gray-100 text-gray-700",description:"Custom follow-up reminder"}],Qt=[{value:"once",label:"One-time"},{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"biweekly",label:"Bi-weekly"},{value:"monthly",label:"Monthly"}],Jt=[{value:"low",label:"Low",color:"bg-gray-100 text-gray-700"},{value:"medium",label:"Medium",color:"bg-blue-100 text-blue-700"},{value:"high",label:"High",color:"bg-orange-100 text-orange-700"},{value:"urgent",label:"Urgent",color:"bg-red-100 text-red-700"}],Zt=({nutritionistId:s,compact:t=!1})=>{const{userProfile:a}=w(),{t:l,i18n:i}=k(),r="ar"===i.language,{sendPushToUser:n}=C(),[c,d]=g.useState([]),[o,m]=g.useState([]),[x,u]=g.useState(!0),[h,p]=g.useState(!1),[j,f]=g.useState(!1),[v,b]=g.useState(null),[N,z]=g.useState("all"),[I,L]=g.useState({client_id:"",reminder_type:"weekly-checkin",title:"",description:"",due_date:"",recurrence:"once",priority:"medium",auto_send_message:!1,message_template:""});g.useEffect(()=>{s&&(q(),O())},[s]),g.useEffect(()=>{const e=setInterval(()=>{W()},6e4);return()=>clearInterval(e)},[c]);const q=async()=>{try{u(!0);const{data:e,error:t}=await _.from("follow_up_reminders").select("\n          *,\n          user_profiles (\n            id,\n            full_name,\n            email,\n            avatar_url\n          )\n        ").eq("nutritionist_id",s).order("due_date",{ascending:!0});if(t)throw t;d(e||[])}catch(e){}finally{u(!1)}},O=async()=>{try{const{data:e,error:t}=await _.from("nutritionist_clients").select("\n          client_id,\n          user_profiles (\n            id,\n            full_name,\n            email\n          )\n        ").eq("nutritionist_id",s);if(t)throw t;const a=e.map(e=>({id:e.user_profiles.id,name:e.user_profiles.full_name,email:e.user_profiles.email}));m(a)}catch(e){}},B=async(e,s)=>{try{const{error:t}=await _.from("follow_up_reminders").update(s).eq("id",e);if(t)throw t;b(null),await q()}catch(t){}},G=(e,s)=>{const t=new Date(e);switch(s){case"daily":t.setDate(t.getDate()+1);break;case"weekly":t.setDate(t.getDate()+7);break;case"biweekly":t.setDate(t.getDate()+14);break;case"monthly":t.setMonth(t.getMonth()+1)}return t.toISOString()},W=()=>{const e=new Date,s=c.map(s=>"pending"===s.status&&new Date(s.due_date)<e?{...s,status:"overdue"}:s);JSON.stringify(s)!==JSON.stringify(c)&&d(s)},U=c.filter(e=>"all"===N||("pending"===N?"pending"===e.status:"completed"===N?"completed"===e.status:"overdue"!==N||"overdue"===e.status)),J=e=>{switch(e){case"pending":return"bg-blue-100 text-blue-700";case"overdue":return"bg-red-100 text-red-700";case"completed":return"bg-green-100 text-green-700";case"snoozed":return"bg-yellow-100 text-yellow-700";default:return"bg-gray-100 text-gray-700"}},Z=e=>{const s=new Date,t=new Date(e)-s;if(t<0)return"Overdue";const a=Math.floor(t/36e5),l=Math.floor(a/24);return l>0?`${l} day${l>1?"s":""}`:a>0?`${a} hour${a>1?"s":""}`:"Due soon"};return t?e.jsxs(V,{children:[e.jsx(H,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-5 h-5"}),"Upcoming Reminders"]})}),e.jsx(K,{children:e.jsx("div",{className:"space-y-2",children:c.slice(0,3).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.title}),e.jsx("p",{className:"text-xs text-gray-600",children:s.user_profiles.full_name})]}),e.jsx(y,{variant:"secondary",className:"text-xs",children:Z(s.due_date)})]},s.id))})})]}):e.jsxs("div",{className:"space-y-6 "+(r?"text-right":"text-left"),dir:r?"rtl":"ltr",children:[e.jsx(V,{children:e.jsx(H,{children:e.jsxs("div",{className:"flex items-center justify-between "+(r?"flex-row-reverse":""),children:[e.jsxs("div",{children:[e.jsxs(Y,{className:"flex items-center gap-2 "+(r?"flex-row-reverse":""),children:[e.jsx(ke,{className:"w-6 h-6"}),l("nutritionistDashboard.followUpReminders","Follow-up Reminders")]}),e.jsx(Q,{children:r?"Ø¬Ø¯ÙˆÙ„Ø© ÙˆØ¥Ø¯Ø§Ø±Ø© ØªØ°ÙƒÙŠØ±Ø§Øª Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡":"Schedule and manage client follow-up reminders"})]}),e.jsxs(S,{open:j,onOpenChange:f,children:[e.jsx(D,{asChild:!0,children:e.jsxs(P,{children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Create Reminder"]})}),e.jsxs(M,{className:"max-w-2xl",children:[e.jsx(A,{children:e.jsx($,{children:"Create Follow-up Reminder"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Client"}),e.jsxs(wt,{value:I.client_id,onValueChange:e=>L({...I,client_id:e}),children:[e.jsx(_t,{children:e.jsx(kt,{placeholder:"Select a client"})}),e.jsx(Ct,{children:o.map(s=>e.jsxs(St,{value:s.id,children:[s.name," (",s.email,")"]},s.id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Reminder Type"}),e.jsxs(wt,{value:I.reminder_type,onValueChange:e=>L({...I,reminder_type:e}),children:[e.jsx(_t,{children:e.jsx(kt,{})}),e.jsx(Ct,{children:Kt.map(s=>e.jsx(St,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Title"}),e.jsx(E,{placeholder:"e.g., Weekly check-in with Sarah",value:I.title,onChange:e=>L({...I,title:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Description"}),e.jsx(R,{placeholder:"Notes about this follow-up...",rows:3,value:I.description,onChange:e=>L({...I,description:e.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Due Date & Time"}),e.jsx(E,{type:"datetime-local",value:I.due_date,onChange:e=>L({...I,due_date:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Recurrence"}),e.jsxs(wt,{value:I.recurrence,onValueChange:e=>L({...I,recurrence:e}),children:[e.jsx(_t,{children:e.jsx(kt,{})}),e.jsx(Ct,{children:Qt.map(s=>e.jsx(St,{value:s.value,children:s.label},s.value))})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Priority"}),e.jsxs(wt,{value:I.priority,onValueChange:e=>L({...I,priority:e}),children:[e.jsx(_t,{children:e.jsx(kt,{})}),e.jsx(Ct,{children:Jt.map(s=>e.jsx(St,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("input",{type:"checkbox",id:"auto_send_message",checked:I.auto_send_message,onChange:e=>L({...I,auto_send_message:e.target.checked}),className:"w-4 h-4 rounded border-gray-300"}),e.jsxs("label",{htmlFor:"auto_send_message",className:"flex-1",children:[e.jsx("span",{className:"text-sm font-medium",children:"Notify Client"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Send a notification to the client about this scheduled follow-up"})]})]})]}),e.jsxs(T,{children:[e.jsx(P,{variant:"outline",onClick:()=>f(!1),disabled:h,children:"Cancel"}),e.jsx(P,{onClick:async()=>{var e;p(!0);try{const{data:t,error:l}=await _.from("follow_up_reminders").insert({nutritionist_id:s,client_id:I.client_id,reminder_type:I.reminder_type,title:I.title,description:I.description,due_date:I.due_date,recurrence:I.recurrence,priority:I.priority,status:"pending",auto_send_message:I.auto_send_message,message_template:I.message_template}).select().single();if(l)throw l;const i=o.find(e=>e.id===I.client_id),r=(null==a?void 0:a.full_name)||"Your Nutritionist";await _.from("notifications").insert({user_id:s,type:"reminder",title:`Reminder: ${I.title}`,message:`Follow-up with ${(null==i?void 0:i.name)||"client"} scheduled for ${new Date(I.due_date).toLocaleDateString()}`,is_read:!1}),I.auto_send_message&&I.client_id&&(await _.from("notifications").insert({user_id:I.client_id,type:"appointment_scheduled",title:"Upcoming Check-in",message:`${r} has scheduled a ${(null==(e=Kt.find(e=>e.id===I.reminder_type))?void 0:e.name)||"follow-up"} with you on ${new Date(I.due_date).toLocaleDateString()}`,is_read:!1}),n(I.client_id,"ðŸ“… Upcoming Check-in",`${r} scheduled a follow-up: ${I.title}`,{tag:"greenofig-reminder",data:{type:"reminder",url:"/app/user"}})),F({title:"Reminder Created",description:`Follow-up reminder for ${(null==i?void 0:i.name)||"client"} has been scheduled`}),L({client_id:"",reminder_type:"weekly-checkin",title:"",description:"",due_date:"",recurrence:"once",priority:"medium",auto_send_message:!1,message_template:""}),f(!1),await q()}catch(t){F({variant:"destructive",title:"Error",description:"Failed to create reminder. Please try again."})}finally{p(!1)}},disabled:!I.client_id||!I.title||!I.due_date||h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"w-4 h-4 mr-2 animate-spin"}),"Creating..."]}):"Create Reminder"})]})]})]})]})})}),e.jsx(V,{children:e.jsx(K,{className:"p-3 sm:p-4",children:e.jsx("div",{className:"grid grid-cols-2 sm:flex gap-2",children:[{value:"all",label:"All",labelFull:"All Reminders"},{value:"pending",label:"Pending",labelFull:"Pending"},{value:"overdue",label:"Overdue",labelFull:"Overdue"},{value:"completed",label:"Done",labelFull:"Completed"}].map(s=>e.jsxs(P,{size:"sm",variant:N===s.value?"default":"outline",onClick:()=>z(s.value),className:"flex-1 sm:flex-none text-xs sm:text-sm px-2 sm:px-3 h-9 sm:h-10",children:[e.jsx("span",{className:"hidden sm:inline",children:s.labelFull}),e.jsx("span",{className:"sm:hidden",children:s.label}),e.jsx(y,{variant:"secondary",className:"ml-1 sm:ml-2 text-xs",children:c.filter(e=>"all"===s.value||e.status===s.value).length})]},s.value))})})}),e.jsxs(V,{children:[e.jsx(H,{children:e.jsxs(Y,{children:["all"===N?"All Reminders":`${N.charAt(0).toUpperCase()+N.slice(1)} Reminders`," ","(",U.length,")"]})}),e.jsx(K,{children:x?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading reminders..."}):0===U.length?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:["No ","all"!==N&&N," reminders found"]}):e.jsx("div",{className:"space-y-3",children:e.jsx(De,{children:U.map((t,a)=>{const l=Kt.find(e=>e.id===t.reminder_type),i=Jt.find(e=>e.value===t.priority);return e.jsxs(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,x:-20},transition:{delay:.05*a},className:`border rounded-lg p-4 ${"overdue"===t.status?"border-red-300 bg-red-50":"hover:shadow-md"} transition-shadow`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`w-10 h-10 rounded-full ${l.color} flex items-center justify-center flex-shrink-0`,children:e.jsx(l.icon,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:t.title}),e.jsx(y,{className:i.color,children:i.label})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[e.jsx(we,{className:"w-3 h-3"}),t.user_profiles.full_name]}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:t.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"w-3 h-3"}),new Date(t.due_date).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Pe,{className:"w-3 h-3"}),new Date(t.due_date).toLocaleTimeString()]}),"once"!==t.recurrence&&e.jsx(y,{variant:"outline",className:"text-xs",children:t.recurrence})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(y,{className:J(t.status),children:["pending"===t.status&&Z(t.due_date),"overdue"===t.status&&"Overdue","completed"===t.status&&"Completed","snoozed"===t.status&&"Snoozed"]})})]}),e.jsxs("div",{className:"flex gap-2",children:["completed"!==t.status&&e.jsxs(e.Fragment,{children:[e.jsxs(P,{size:"sm",variant:"default",onClick:()=>(async e=>{try{if(await B(e.id,{status:"completed",completed_at:(new Date).toISOString()}),"once"!==e.recurrence){const t=G(e.due_date,e.recurrence);await _.from("follow_up_reminders").insert({nutritionist_id:s,client_id:e.client_id,reminder_type:e.reminder_type,title:e.title,description:e.description,due_date:t,recurrence:e.recurrence,priority:e.priority,status:"pending",auto_send_message:e.auto_send_message,message_template:e.message_template}),F({title:"Reminder Completed",description:`Next ${e.recurrence} reminder scheduled for ${new Date(t).toLocaleDateString()}`})}else F({title:"Reminder Completed",description:"Follow-up has been marked as complete"});await q()}catch(t){F({variant:"destructive",title:"Error",description:"Failed to complete reminder"})}})(t),children:[e.jsx(Me,{className:"w-3 h-3 mr-1"}),"Complete"]}),e.jsxs(P,{size:"sm",variant:"outline",onClick:()=>(async(e,s)=>{try{const t=new Date;t.setHours(t.getHours()+s),await B(e,{due_date:t.toISOString(),status:"snoozed"})}catch(t){}})(t.id,24),children:[e.jsx(Pe,{className:"w-3 h-3 mr-1"}),"Snooze 24h"]})]}),e.jsx(P,{size:"sm",variant:"outline",onClick:()=>b(t),children:e.jsx(Ae,{className:"w-3 h-3"})}),e.jsx(P,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this reminder?"))try{const{error:s}=await _.from("follow_up_reminders").delete().eq("id",e);if(s)throw s;await q()}catch(s){}})(t.id),children:e.jsx($e,{className:"w-3 h-3"})})]})]},t.id)})})})})]})]})},Xt=()=>{const{user:s}=w(),{t:t,i18n:a}=k(),l="ar"===a.language,[i,r]=g.useState({totalClients:0,baseClients:0,premiumClients:0,eliteClients:0,activeClients:0,activeMealPlans:0,upcomingAppointments:0,monthlyRevenue:0}),[n,c]=g.useState([]),[d,o]=g.useState([]),[m,x]=g.useState([]),[u,h]=g.useState(!0);g.useEffect(()=>{s&&p()},[s]);const p=async()=>{var e;h(!0);try{const t=new Date;t.setHours(0,0,0,0);const a=new Date(t);a.setDate(a.getDate()+1);const l=new Date;l.setDate(l.getDate()-7);const[i,n,d,m]=await Promise.all([_.from("user_profiles").select("id, full_name, email, created_at, tier").eq("role","user"),_.from("meal_plans_v2").select("id, name, status").eq("nutritionist_id",s.id).eq("status","active"),_.from("appointments").select("*, user_profiles!appointments_client_id_fkey(full_name, tier)").eq("nutritionist_id",s.id).gte("appointment_date",t.toISOString()).order("appointment_date",{ascending:!0}).limit(10),_.from("client_progress").select("client_id").gte("date",l.toISOString().split("T")[0])]),u=i.data,h=n.data,p=d.data,g=new Set((null==(e=m.data)?void 0:e.map(e=>e.client_id))||[]).size,j=(null==u?void 0:u.filter(e=>"Base"===(e.tier||"Base")).length)||0,f=(null==u?void 0:u.filter(e=>"Premium"===e.tier).length)||0,v=(null==u?void 0:u.filter(e=>"Elite"===e.tier).length)||0,b=29*f+59*v,N=(null==p?void 0:p.filter(e=>{const s=new Date(e.appointment_date);return s>=t&&s<a}))||[];r({totalClients:(null==u?void 0:u.length)||0,baseClients:j,premiumClients:f,eliteClients:v,activeClients:g,activeMealPlans:(null==h?void 0:h.length)||0,upcomingAppointments:(null==p?void 0:p.length)||0,monthlyRevenue:b}),c(N);const y=[],w=(null==u?void 0:u.filter(e=>!0).length)||0;w>0&&y.push({id:1,message:`${w} clients need follow-up this week`,priority:"high",tier:null}),j>0&&y.push({id:2,message:`${j} Base tier clients could benefit from Premium features`,priority:"medium",tier:"Base"}),f>0&&y.push({id:3,message:`${f} Premium clients eligible for Elite upgrade`,priority:"low",tier:"Premium"}),x(y),o([{id:1,type:"client_joined",message:"New client registered",time:"2 hours ago",tier:"Base"},{id:2,type:"meal_plan",message:"Meal plan created for Elite client",time:"5 hours ago",tier:"Elite"},{id:3,type:"appointment",message:"Premium consultation completed",time:"1 day ago",tier:"Premium"}])}catch(t){}finally{h(!1)}},j=({icon:s,label:t,value:a,change:l,color:i,bgColor:r})=>e.jsx(V,{className:"bg-card border-border",children:e.jsx(K,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:t}),e.jsx("h3",{className:"text-3xl font-bold text-foreground",children:a}),l&&e.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400 mt-1 flex items-center gap-1",children:[e.jsx(ee,{className:"w-4 h-4"}),l]})]}),e.jsx("div",{className:`p-4 rounded-full ${r||"bg-primary/10"}`,children:e.jsx(s,{className:`w-6 h-6 ${i||"text-primary"}`})})]})})}),v=[{name:"Base",value:i.baseClients,color:"#6b7280"},{name:"Premium",value:i.premiumClients,color:"#3b82f6"},{name:"Elite",value:i.eliteClients,color:"#eab308"}].filter(e=>e.value>0);return u?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6 "+(l?"text-right":"text-left"),dir:l?"rtl":"ltr",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:t("nutritionistDashboard.title","Nutritionist Dashboard")}),e.jsx("p",{className:"text-muted-foreground mt-1",children:t("nutritionistDashboard.subtitle","Manage your clients across all subscription tiers")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(j,{icon:te,label:t("nutritionistDashboard.totalClients","Total Clients"),value:i.totalClients,change:`+12% ${t("nutritionistDashboard.thisMonth","this month")}`,color:"text-primary",bgColor:"bg-primary/10"}),e.jsx(j,{icon:Re,label:t("nutritionistDashboard.activeClients","Active Clients"),value:i.activeClients,color:"text-green-600 dark:text-green-400",bgColor:"bg-green-600/10 dark:bg-green-700/10"}),e.jsx(j,{icon:Te,label:t("nutritionistDashboard.activeMealPlans","Active Meal Plans"),value:i.activeMealPlans,color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-600/10 dark:bg-blue-700/10"}),e.jsx(j,{icon:le,label:t("nutritionistDashboard.monthlyRevenue","Monthly Revenue"),value:`$${i.monthlyRevenue}`,change:`+8% ${t("nutritionistDashboard.thisMonth","this month")}`,color:"text-purple-600 dark:text-purple-400",bgColor:"bg-purple-600/10 dark:bg-purple-700/10"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(V,{className:"lg:col-span-2 bg-card border-border",children:[e.jsx(H,{children:e.jsxs(Y,{className:"flex items-center gap-2 text-foreground "+(l?"flex-row-reverse":""),children:[e.jsx(Fe,{className:"w-5 h-5"}),t("nutritionistDashboard.clientTierDistribution","Client Tier Distribution")]})}),e.jsx(K,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"flex items-center justify-center",children:v.length>0?e.jsx(ie,{width:"100%",height:200,children:e.jsxs(ze,{children:[e.jsx(Ie,{data:v,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,value:s})=>`${e}: ${s}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:v.map((s,t)=>e.jsx(Le,{fill:s.color},`cell-${t}`))}),e.jsx(oe,{})]})}):e.jsx("p",{className:"text-muted-foreground",children:t("nutritionistDashboard.noClientsYet","No clients yet")})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-500/10 rounded-lg "+(l?"flex-row-reverse":""),children:[e.jsxs("div",{className:"flex items-center gap-2 "+(l?"flex-row-reverse":""),children:[e.jsx(J,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"}),e.jsx("span",{className:"font-semibold",children:t("nutritionistDashboard.baseTier","Base Tier")})]}),e.jsx("span",{className:"text-xl font-bold",children:i.baseClients})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-500/10 rounded-lg "+(l?"flex-row-reverse":""),children:[e.jsxs("div",{className:"flex items-center gap-2 "+(l?"flex-row-reverse":""),children:[e.jsx(Z,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"}),e.jsx("span",{className:"font-semibold",children:t("nutritionistDashboard.premiumTier","Premium Tier")})]}),e.jsxs("div",{className:l?"text-left":"text-right",children:[e.jsx("span",{className:"text-xl font-bold",children:i.premiumClients}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["$",29*i.premiumClients,"/",l?"Ø´Ù‡Ø±":"mo"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-yellow-500/10 rounded-lg "+(l?"flex-row-reverse":""),children:[e.jsxs("div",{className:"flex items-center gap-2 "+(l?"flex-row-reverse":""),children:[e.jsx(X,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400"}),e.jsx("span",{className:"font-semibold",children:t("nutritionistDashboard.eliteTier","Elite Tier")})]}),e.jsxs("div",{className:l?"text-left":"text-right",children:[e.jsx("span",{className:"text-xl font-bold",children:i.eliteClients}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["$",59*i.eliteClients,"/",l?"Ø´Ù‡Ø±":"mo"]})]})]})]})]})})]}),e.jsxs(V,{className:"bg-card border-border",children:[e.jsx(H,{children:e.jsxs(Y,{className:"flex items-center gap-2 text-foreground "+(l?"flex-row-reverse":""),children:[e.jsx(_e,{className:"w-5 h-5"}),t("nutritionistDashboard.actionItems","Action Items")]})}),e.jsx(K,{children:e.jsx("div",{className:"space-y-3",children:m.length>0?m.map(s=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg border "+("high"===s.priority?"bg-red-50/50 dark:bg-red-950/20 border-red-200 dark:border-red-900":"medium"===s.priority?"bg-yellow-50/50 dark:bg-yellow-950/20 border-yellow-200 dark:border-yellow-900":"bg-blue-50/50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-900"),children:[e.jsx(Ee,{className:"w-5 h-5 flex-shrink-0 "+("high"===s.priority?"text-red-600 dark:text-red-400":"medium"===s.priority?"text-yellow-600 dark:text-yellow-400":"text-blue-600 dark:text-blue-400")}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-foreground",children:s.message}),s.tier&&e.jsx("div",{className:"mt-2",children:e.jsx(Gt,{tier:s.tier,size:"sm"})})]})]},s.id)):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:t("nutritionistDashboard.noActionItems","No action items")})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(V,{className:"lg:col-span-2 bg-card border-border",children:[e.jsx(H,{children:e.jsxs("div",{className:"flex items-center justify-between "+(l?"flex-row-reverse":""),children:[e.jsxs(Y,{className:"flex items-center gap-2 text-foreground "+(l?"flex-row-reverse":""),children:[e.jsx(Pe,{className:"w-5 h-5"}),t("nutritionistDashboard.todaysSchedule","Today's Schedule")]}),e.jsx(P,{variant:"ghost",size:"sm",asChild:!0,children:e.jsxs(f,{to:"/app/nutritionist/schedule",className:"flex items-center "+(l?"flex-row-reverse":""),children:[t("nutritionistDashboard.viewAll","View All")," ",e.jsx(qe,{className:"w-4 h-4 "+(l?"mr-1 rotate-180":"ml-1")})]})})]})}),e.jsx(K,{children:n.length>0?e.jsx("div",{className:"space-y-3",children:n.map(s=>{var a,i;return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg hover:bg-muted transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-600 dark:bg-green-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold text-foreground",children:(null==(a=s.user_profiles)?void 0:a.full_name)||"Client"}),(null==(i=s.user_profiles)?void 0:i.tier)&&e.jsx(Gt,{tier:s.user_profiles.tier,size:"sm"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.consultation_type||t("nutritionistDashboard.consultation","Consultation")})]})]}),e.jsxs("div",{className:l?"text-left":"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:Oe(new Date(s.appointment_date),"h:mm a")}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.duration_minutes," ",t("nutritionistDashboard.min","min")]})]})]},s.id)})}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ye,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:t("nutritionistDashboard.noAppointmentsToday","No appointments scheduled for today")})]})})]}),e.jsxs(V,{className:"bg-card border-border",children:[e.jsx(H,{children:e.jsx(Y,{className:"text-foreground",children:t("nutritionistDashboard.recentActivity","Recent Activity")})}),e.jsx(K,{children:e.jsx("div",{className:"space-y-4",children:d.map(s=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary mt-2"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-foreground",children:s.message}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:s.time}),s.tier&&e.jsx(Gt,{tier:s.tier,size:"sm"})]})]}),e.jsx(Me,{className:"w-4 h-4 text-green-600 dark:text-green-400 flex-shrink-0"})]},s.id))})})]})]}),e.jsx(Wt,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(Ut,{}),e.jsx(Vt,{}),e.jsx(Ht,{}),e.jsx(Yt,{})]}),e.jsx(Zt,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(P,{asChild:!0,className:"h-20 text-lg",variant:"outline",children:e.jsxs(f,{to:"/app/nutritionist/clients",className:"flex items-center "+(l?"flex-row-reverse":""),children:[e.jsx(te,{className:"w-5 h-5 "+(l?"ml-2":"mr-2")}),t("nutritionistDashboard.manageClients","Manage Clients")]})}),e.jsx(P,{asChild:!0,className:"h-20 text-lg",variant:"outline",children:e.jsxs(f,{to:"/app/nutritionist/meals",className:"flex items-center "+(l?"flex-row-reverse":""),children:[e.jsx(Te,{className:"w-5 h-5 "+(l?"ml-2":"mr-2")}),t("nutritionistDashboard.createMealPlan","Create Meal Plan")]})}),e.jsx(P,{asChild:!0,className:"h-20 text-lg",variant:"outline",children:e.jsxs(f,{to:"/app/nutritionist/schedule",className:"flex items-center "+(l?"flex-row-reverse":""),children:[e.jsx(ye,{className:"w-5 h-5 "+(l?"ml-2":"mr-2")}),t("nutritionistDashboard.scheduleAppointment","Schedule Appointment")]})}),e.jsx(P,{asChild:!0,className:"h-20 text-lg",variant:"outline",children:e.jsxs(f,{to:"/app/nutritionist/forms",className:"flex items-center",children:[e.jsx(te,{className:"w-5 h-5 mr-2"}),"Client Forms"]})})]})]})};var[ea,sa]=s("Tooltip",[t]),ta=t(),aa="TooltipProvider",la=700,ia="tooltip.open",[ra,na]=ea(aa),ca=s=>{const{__scopeTooltip:t,delayDuration:a=la,skipDelayDuration:l=300,disableHoverableContent:i=!1,children:r}=s,n=g.useRef(!0),c=g.useRef(!1),d=g.useRef(0);return g.useEffect(()=>{const e=d.current;return()=>window.clearTimeout(e)},[]),e.jsx(ra,{scope:t,isOpenDelayedRef:n,delayDuration:a,onOpen:g.useCallback(()=>{window.clearTimeout(d.current),n.current=!1},[]),onClose:g.useCallback(()=>{window.clearTimeout(d.current),d.current=window.setTimeout(()=>n.current=!0,l)},[l]),isPointerInTransitRef:c,onPointerInTransitChange:g.useCallback(e=>{c.current=e},[]),disableHoverableContent:i,children:r})};ca.displayName=aa;var da="Tooltip",[oa,ma]=ea(da),xa=s=>{const{__scopeTooltip:t,children:a,open:l,defaultOpen:i,onOpenChange:r,disableHoverableContent:n,delayDuration:c}=s,d=na(da,s.__scopeTooltip),o=ta(t),[m,x]=g.useState(null),j=u(),f=g.useRef(0),v=n??d.disableHoverableContent,b=c??d.delayDuration,N=g.useRef(!1),[y,w]=h({prop:l,defaultProp:i??!1,onChange:e=>{e?(d.onOpen(),document.dispatchEvent(new CustomEvent(ia))):d.onClose(),null==r||r(e)},caller:da}),_=g.useMemo(()=>y?N.current?"delayed-open":"instant-open":"closed",[y]),k=g.useCallback(()=>{window.clearTimeout(f.current),f.current=0,N.current=!1,w(!0)},[w]),C=g.useCallback(()=>{window.clearTimeout(f.current),f.current=0,w(!1)},[w]),S=g.useCallback(()=>{window.clearTimeout(f.current),f.current=window.setTimeout(()=>{N.current=!0,w(!0),f.current=0},b)},[b,w]);return g.useEffect(()=>()=>{f.current&&(window.clearTimeout(f.current),f.current=0)},[]),e.jsx(p,{...o,children:e.jsx(oa,{scope:t,contentId:j,open:y,stateAttribute:_,trigger:m,onTriggerChange:x,onTriggerEnter:g.useCallback(()=>{d.isOpenDelayedRef.current?S():k()},[d.isOpenDelayedRef,S,k]),onTriggerLeave:g.useCallback(()=>{v?C():(window.clearTimeout(f.current),f.current=0)},[C,v]),onOpen:k,onClose:C,disableHoverableContent:v,children:a})})};xa.displayName=da;var ua="TooltipTrigger",ha=g.forwardRef((s,t)=>{const{__scopeTooltip:n,...c}=s,d=ma(ua,n),o=na(ua,n),m=ta(n),x=g.useRef(null),u=a(t,x,d.onTriggerChange),h=g.useRef(!1),p=g.useRef(!1),j=g.useCallback(()=>h.current=!1,[]);return g.useEffect(()=>()=>document.removeEventListener("pointerup",j),[j]),e.jsx(l,{asChild:!0,...m,children:e.jsx(i.button,{"aria-describedby":d.open?d.contentId:void 0,"data-state":d.stateAttribute,...c,ref:u,onPointerMove:r(s.onPointerMove,e=>{"touch"!==e.pointerType&&(p.current||o.isPointerInTransitRef.current||(d.onTriggerEnter(),p.current=!0))}),onPointerLeave:r(s.onPointerLeave,()=>{d.onTriggerLeave(),p.current=!1}),onPointerDown:r(s.onPointerDown,()=>{d.open&&d.onClose(),h.current=!0,document.addEventListener("pointerup",j,{once:!0})}),onFocus:r(s.onFocus,()=>{h.current||d.onOpen()}),onBlur:r(s.onBlur,d.onClose),onClick:r(s.onClick,d.onClose)})})});ha.displayName=ua;var[pa,ga]=ea("TooltipPortal",{forceMount:void 0}),ja="TooltipContent",fa=g.forwardRef((s,t)=>{const a=ga(ja,s.__scopeTooltip),{forceMount:l=a.forceMount,side:i="top",...r}=s,c=ma(ja,s.__scopeTooltip);return e.jsx(n,{present:l||c.open,children:c.disableHoverableContent?e.jsx(wa,{side:i,...r,ref:t}):e.jsx(va,{side:i,...r,ref:t})})}),va=g.forwardRef((s,t)=>{const l=ma(ja,s.__scopeTooltip),i=na(ja,s.__scopeTooltip),r=g.useRef(null),n=a(t,r),[c,d]=g.useState(null),{trigger:o,onClose:m}=l,x=r.current,{onPointerInTransitChange:u}=i,h=g.useCallback(()=>{d(null),u(!1)},[u]),p=g.useCallback((e,s)=>{const t=e.currentTarget,a={x:e.clientX,y:e.clientY},l=function(e,s,t=5){const a=[];switch(s){case"top":a.push({x:e.x-t,y:e.y+t},{x:e.x+t,y:e.y+t});break;case"bottom":a.push({x:e.x-t,y:e.y-t},{x:e.x+t,y:e.y-t});break;case"left":a.push({x:e.x+t,y:e.y-t},{x:e.x+t,y:e.y+t});break;case"right":a.push({x:e.x-t,y:e.y-t},{x:e.x-t,y:e.y+t})}return a}(a,function(e,s){const t=Math.abs(s.top-e.y),a=Math.abs(s.bottom-e.y),l=Math.abs(s.right-e.x),i=Math.abs(s.left-e.x);switch(Math.min(t,a,l,i)){case i:return"left";case l:return"right";case t:return"top";case a:return"bottom";default:throw new Error("unreachable")}}(a,t.getBoundingClientRect())),i=function(e){const s=e.slice();return s.sort((e,s)=>e.x<s.x?-1:e.x>s.x?1:e.y<s.y?-1:e.y>s.y?1:0),function(e){if(e.length<=1)return e.slice();const s=[];for(let a=0;a<e.length;a++){const t=e[a];for(;s.length>=2;){const e=s[s.length-1],a=s[s.length-2];if(!((e.x-a.x)*(t.y-a.y)>=(e.y-a.y)*(t.x-a.x)))break;s.pop()}s.push(t)}s.pop();const t=[];for(let a=e.length-1;a>=0;a--){const s=e[a];for(;t.length>=2;){const e=t[t.length-1],a=t[t.length-2];if(!((e.x-a.x)*(s.y-a.y)>=(e.y-a.y)*(s.x-a.x)))break;t.pop()}t.push(s)}return t.pop(),1===s.length&&1===t.length&&s[0].x===t[0].x&&s[0].y===t[0].y?s:s.concat(t)}(s)}([...l,...function(e){const{top:s,right:t,bottom:a,left:l}=e;return[{x:l,y:s},{x:t,y:s},{x:t,y:a},{x:l,y:a}]}(s.getBoundingClientRect())]);d(i),u(!0)},[u]);return g.useEffect(()=>()=>h(),[h]),g.useEffect(()=>{if(o&&x){const e=e=>p(e,x),s=e=>p(e,o);return o.addEventListener("pointerleave",e),x.addEventListener("pointerleave",s),()=>{o.removeEventListener("pointerleave",e),x.removeEventListener("pointerleave",s)}}},[o,x,p,h]),g.useEffect(()=>{if(c){const e=e=>{const s=e.target,t={x:e.clientX,y:e.clientY},a=(null==o?void 0:o.contains(s))||(null==x?void 0:x.contains(s)),l=!function(e,s){const{x:t,y:a}=e;let l=!1;for(let i=0,r=s.length-1;i<s.length;r=i++){const e=s[i],n=s[r],c=e.x,d=e.y,o=n.x,m=n.y;d>a!=m>a&&t<(o-c)*(a-d)/(m-d)+c&&(l=!l)}return l}(t,c);a?h():l&&(h(),m())};return document.addEventListener("pointermove",e),()=>document.removeEventListener("pointermove",e)}},[o,x,c,m,h]),e.jsx(wa,{...s,ref:n})}),[ba,Na]=ea(da,{isInside:!1}),ya=x("TooltipContent"),wa=g.forwardRef((s,t)=>{const{__scopeTooltip:a,children:l,"aria-label":i,onEscapeKeyDown:r,onPointerDownOutside:n,...m}=s,x=ma(ja,a),u=ta(a),{onClose:h}=x;return g.useEffect(()=>(document.addEventListener(ia,h),()=>document.removeEventListener(ia,h)),[h]),g.useEffect(()=>{if(x.trigger){const e=e=>{const s=e.target;(null==s?void 0:s.contains(x.trigger))&&h()};return window.addEventListener("scroll",e,{capture:!0}),()=>window.removeEventListener("scroll",e,{capture:!0})}},[x.trigger,h]),e.jsx(c,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:r,onPointerDownOutside:n,onFocusOutside:e=>e.preventDefault(),onDismiss:h,children:e.jsxs(d,{"data-state":x.stateAttribute,...u,...m,ref:t,style:{...m.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[e.jsx(ya,{children:l}),e.jsx(ba,{scope:a,isInside:!0,children:e.jsx(o,{id:x.contentId,role:"tooltip",children:i||l})})]})})});fa.displayName=ja;var _a="TooltipArrow";g.forwardRef((s,t)=>{const{__scopeTooltip:a,...l}=s,i=ta(a);return Na(_a,a).isInside?null:e.jsx(m,{...i,...l,ref:t})}).displayName=_a;var ka=fa;const Ca=ca,Sa=xa,Da=ha,Pa=g.forwardRef(({className:s,sideOffset:t=4,...a},l)=>e.jsx(ka,{ref:l,sideOffset:t,className:z("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a}));Pa.displayName=ka.displayName;const Ma=({client:s,onAction:t})=>{const a=s.tier||"Base",l=(e,l)=>{i(a,l)?t&&t(e,s):F({title:"Upgrade Required",description:`This feature requires the client to be on ${l} tier or higher.`,variant:"destructive"})},i=(e,s)=>{const t={Base:1,Premium:2,Elite:3};return t[e]>=t[s]},r=({icon:s,label:t,onClick:a,disabled:l,variant:i="outline"})=>e.jsxs(P,{variant:i,size:"sm",onClick:a,disabled:l,className:"w-full justify-start",children:[e.jsx(s,{className:"w-4 h-4 mr-2"}),t]});return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold mb-2 text-muted-foreground",children:"Basic Actions"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{icon:Be,label:"Send Message",onClick:()=>l("message","Base")}),e.jsx(r,{icon:Ge,label:"View Meal Logs",onClick:()=>l("viewMealLogs","Base")})]})]}),i(a,"Premium")&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold mb-2 text-muted-foreground",children:"Premium Actions"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{icon:We,label:"Create Meal Plan",onClick:()=>l("createMealPlan","Premium"),variant:"default"}),e.jsx(r,{icon:ye,label:"Schedule Check-in",onClick:()=>l("scheduleCheckin","Premium"),variant:"default"}),e.jsx(r,{icon:ee,label:"View Progress Charts",onClick:()=>l("viewProgress","Premium"),variant:"default"}),e.jsx(r,{icon:pe,label:"Send Quick Response",onClick:()=>l("quickMessage","Premium"),variant:"default"})]})]}),i(a,"Elite")&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold mb-2 text-muted-foreground flex items-center gap-1",children:["Elite Actions",e.jsx("span",{className:"text-xs text-yellow-600 dark:text-yellow-400",children:"(Priority)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{icon:Ue,label:"Schedule Video Call",onClick:()=>l("scheduleVideo","Elite"),variant:"default"}),e.jsx(r,{icon:Ve,label:"Create Workout Plan",onClick:()=>l("createWorkout","Elite"),variant:"default"}),e.jsx(r,{icon:pe,label:"Real-time Chat",onClick:()=>l("realtimeChat","Elite"),variant:"default"}),e.jsx(r,{icon:Me,label:"Generate Report",onClick:()=>l("generateReport","Elite"),variant:"default"})]})]}),"Base"===a&&e.jsx("div",{className:"p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:e.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:"Suggest Premium upgrade to unlock meal planning and progress tracking"})}),"Premium"===a&&e.jsx("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-lg",children:e.jsx("p",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:"Suggest Elite upgrade for 1-on-1 video calls and priority support"})})]})},Aa=({clientId:s,onClose:t})=>{const{user:a}=w(),[l,i]=g.useState(!0),[r,n]=g.useState(!1),[c,d]=g.useState(!1),[o,m]=g.useState(null),[x,u]=g.useState({height_cm:"",current_weight_kg:"",target_weight_kg:"",date_of_birth:"",gender:"",activity_level:"moderate",health_conditions:[],medications:"",diet_type:"omnivore",allergies:[],food_intolerances:[],disliked_foods:[],favorite_foods:[],primary_goal:"weight_loss",secondary_goals:[],target_calories:2e3,target_protein_g:150,target_carbs_g:200,target_fat_g:65,meals_per_day:3,snacks_per_day:2,cooking_skill:"intermediate",prep_time_minutes:30,budget:"moderate",notes:"",special_instructions:""}),[h,p]=g.useState([]),[j,f]=g.useState("");g.useState("");const[v,b]=g.useState(""),[N,k]=g.useState(""),C=["Peanuts","Tree Nuts","Milk","Eggs","Wheat","Soy","Fish","Shellfish","Sesame"];g.useEffect(()=>{s&&(S(),D())},[s]);const S=async()=>{i(!0);try{const{data:e,error:t}=await _.from("user_profiles").select("*").eq("id",s).single();if(t)throw t;m(e);const{data:a,error:l}=await _.from("client_nutrition_profiles").select("*").eq("client_id",s).maybeSingle();u(a?e=>({...e,...a,health_conditions:a.health_conditions||[],allergies:a.allergies||[],food_intolerances:a.food_intolerances||[],disliked_foods:a.disliked_foods||[],favorite_foods:a.favorite_foods||[],secondary_goals:a.secondary_goals||[]}):s=>({...s,height_cm:e.height_cm||"",current_weight_kg:e.weight_kg||"",date_of_birth:e.date_of_birth||"",gender:e.gender||""}))}catch(e){F({variant:"destructive",title:"Error",description:"Failed to load client profile"})}finally{i(!1)}},D=async()=>{try{const{data:e,error:t}=await _.from("client_progress").select("*").eq("client_id",s).order("date",{ascending:!1}).limit(10);t||p(e||[])}catch(e){}},M=()=>{if(!(x.height_cm&&x.current_weight_kg&&x.date_of_birth&&x.gender))return null;const e=(new Date).getFullYear()-new Date(x.date_of_birth).getFullYear(),s=parseFloat(x.current_weight_kg),t=parseFloat(x.height_cm);return"male"===x.gender?Math.round(10*s+6.25*t-5*e+5):Math.round(10*s+6.25*t-5*e-161)},A=(e,s,t,a)=>{s.trim()&&!x[e].includes(s.trim())&&(u(t=>({...t,[e]:[...t[e],s.trim()]})),a(""))},$=(e,s)=>{u(t=>({...t,[e]:t[e].filter(e=>e!==s)}))};if(l)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(Se,{className:"w-8 h-8 animate-spin text-primary"})});const T=(()=>{if(!x.height_cm||!x.current_weight_kg)return null;const e=x.height_cm/100;return(x.current_weight_kg/(e*e)).toFixed(1)})(),z=M(),L=(()=>{const e=M();if(!e)return null;return Math.round(e*({sedentary:1.2,light:1.375,moderate:1.55,active:1.725,very_active:1.9}[x.activity_level]||1.55))})();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center",children:(null==o?void 0:o.profile_picture_url)?e.jsx("img",{src:o.profile_picture_url,alt:o.full_name,className:"w-16 h-16 rounded-full object-cover"}):e.jsx(we,{className:"w-8 h-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:(null==o?void 0:o.full_name)||"Client"}),e.jsx("p",{className:"text-muted-foreground",children:null==o?void 0:o.email})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[c?e.jsxs(e.Fragment,{children:[e.jsxs(P,{variant:"outline",onClick:()=>d(!1),children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(P,{onClick:async()=>{n(!0);try{const e={client_id:s,nutritionist_id:a.id,...x,updated_at:(new Date).toISOString()},{error:t}=await _.from("client_nutrition_profiles").upsert(e,{onConflict:"client_id"});if(t)throw t;F({title:"Success",description:"Client nutrition profile saved successfully"}),d(!1)}catch(e){F({variant:"destructive",title:"Error",description:"Failed to save profile"})}finally{n(!1)}},disabled:r,children:[r?e.jsx(Se,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(He,{className:"w-4 h-4 mr-2"}),"Save Profile"]})]}):e.jsxs(P,{onClick:()=>d(!0),children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Edit Profile"]}),t&&e.jsx(P,{variant:"ghost",onClick:t,children:e.jsx(be,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[e.jsx(V,{className:"glass-effect",children:e.jsxs(K,{className:"p-4 text-center",children:[e.jsx(he,{className:"w-5 h-5 mx-auto mb-2 text-primary"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Current Weight"}),e.jsxs("p",{className:"text-xl font-bold",children:[x.current_weight_kg||"-"," kg"]})]})}),e.jsx(V,{className:"glass-effect",children:e.jsxs(K,{className:"p-4 text-center",children:[e.jsx(ae,{className:"w-5 h-5 mx-auto mb-2 text-green-500"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Target Weight"}),e.jsxs("p",{className:"text-xl font-bold",children:[x.target_weight_kg||"-"," kg"]})]})}),e.jsx(V,{className:"glass-effect",children:e.jsxs(K,{className:"p-4 text-center",children:[e.jsx(Ye,{className:"w-5 h-5 mx-auto mb-2 text-blue-500"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Height"}),e.jsxs("p",{className:"text-xl font-bold",children:[x.height_cm||"-"," cm"]})]})}),e.jsx(V,{className:"glass-effect",children:e.jsxs(K,{className:"p-4 text-center",children:[e.jsx(Re,{className:"w-5 h-5 mx-auto mb-2 text-purple-500"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"BMI"}),e.jsx("p",{className:"text-xl font-bold",children:T||"-"})]})}),e.jsx(V,{className:"glass-effect",children:e.jsxs(K,{className:"p-4 text-center",children:[e.jsx(Ke,{className:"w-5 h-5 mx-auto mb-2 text-red-500"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"BMR"}),e.jsx("p",{className:"text-xl font-bold",children:z||"-"})]})}),e.jsx(V,{className:"glass-effect",children:e.jsxs(K,{className:"p-4 text-center",children:[e.jsx(Ve,{className:"w-5 h-5 mx-auto mb-2 text-orange-500"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"TDEE"}),e.jsx("p",{className:"text-xl font-bold",children:L||"-"})]})})]}),e.jsxs(Dt,{defaultValue:"basics",className:"w-full",children:[e.jsxs(Pt,{className:"grid w-full grid-cols-5",children:[e.jsx(Mt,{value:"basics",children:"Basics"}),e.jsx(Mt,{value:"dietary",children:"Dietary"}),e.jsx(Mt,{value:"health",children:"Health"}),e.jsx(Mt,{value:"goals",children:"Goals"}),e.jsx(Mt,{value:"progress",children:"Progress"})]}),e.jsxs(At,{value:"basics",className:"space-y-4",children:[e.jsxs(V,{className:"glass-effect",children:[e.jsx(H,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-5 h-5"}),"Basic Information"]})}),e.jsxs(K,{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(I,{children:"Height (cm)"}),e.jsx(E,{type:"number",value:x.height_cm,onChange:e=>u(s=>({...s,height_cm:e.target.value})),disabled:!c})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Current Weight (kg)"}),e.jsx(E,{type:"number",value:x.current_weight_kg,onChange:e=>u(s=>({...s,current_weight_kg:e.target.value})),disabled:!c})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Target Weight (kg)"}),e.jsx(E,{type:"number",value:x.target_weight_kg,onChange:e=>u(s=>({...s,target_weight_kg:e.target.value})),disabled:!c})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Date of Birth"}),e.jsx(E,{type:"date",value:x.date_of_birth,onChange:e=>u(s=>({...s,date_of_birth:e.target.value})),disabled:!c})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Gender"}),e.jsxs("select",{value:x.gender,onChange:e=>u(s=>({...s,gender:e.target.value})),disabled:!c,className:"w-full h-10 px-3 rounded-md border border-input bg-background",children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Activity Level"}),e.jsx("select",{value:x.activity_level,onChange:e=>u(s=>({...s,activity_level:e.target.value})),disabled:!c,className:"w-full h-10 px-3 rounded-md border border-input bg-background",children:[{value:"sedentary",label:"Sedentary (little/no exercise)"},{value:"light",label:"Light (1-3 days/week)"},{value:"moderate",label:"Moderate (3-5 days/week)"},{value:"active",label:"Active (6-7 days/week)"},{value:"very_active",label:"Very Active (2x/day)"}].map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})]})]}),e.jsxs(V,{className:"glass-effect",children:[e.jsx(H,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5"}),"Lifestyle Preferences"]})}),e.jsxs(K,{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(I,{children:"Meals per Day"}),e.jsx(E,{type:"number",min:"1",max:"6",value:x.meals_per_day,onChange:e=>u(s=>({...s,meals_per_day:parseInt(e.target.value)})),disabled:!c})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Snacks per Day"}),e.jsx(E,{type:"number",min:"0",max:"5",value:x.snacks_per_day,onChange:e=>u(s=>({...s,snacks_per_day:parseInt(e.target.value)})),disabled:!c})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Max Prep Time (minutes)"}),e.jsx(E,{type:"number",value:x.prep_time_minutes,onChange:e=>u(s=>({...s,prep_time_minutes:parseInt(e.target.value)})),disabled:!c})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Cooking Skill"}),e.jsxs("select",{value:x.cooking_skill,onChange:e=>u(s=>({...s,cooking_skill:e.target.value})),disabled:!c,className:"w-full h-10 px-3 rounded-md border border-input bg-background",children:[e.jsx("option",{value:"beginner",children:"Beginner"}),e.jsx("option",{value:"intermediate",children:"Intermediate"}),e.jsx("option",{value:"advanced",children:"Advanced"})]})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Budget"}),e.jsxs("select",{value:x.budget,onChange:e=>u(s=>({...s,budget:e.target.value})),disabled:!c,className:"w-full h-10 px-3 rounded-md border border-input bg-background",children:[e.jsx("option",{value:"low",children:"Budget-Friendly"}),e.jsx("option",{value:"moderate",children:"Moderate"}),e.jsx("option",{value:"high",children:"No Limit"})]})]})]})]})]}),e.jsxs(At,{value:"dietary",className:"space-y-4",children:[e.jsxs(V,{className:"glass-effect",children:[e.jsx(H,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-5 h-5"}),"Diet Type"]})}),e.jsx(K,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2",children:[{value:"omnivore",label:"Omnivore"},{value:"vegetarian",label:"Vegetarian"},{value:"vegan",label:"Vegan"},{value:"pescatarian",label:"Pescatarian"},{value:"keto",label:"Keto"},{value:"paleo",label:"Paleo"},{value:"mediterranean",label:"Mediterranean"},{value:"low_carb",label:"Low Carb"},{value:"halal",label:"Halal"},{value:"kosher",label:"Kosher"}].map(s=>e.jsx(P,{variant:x.diet_type===s.value?"default":"outline",size:"sm",onClick:()=>c&&u(e=>({...e,diet_type:s.value})),disabled:!c,className:"w-full",children:s.label},s.value))})})]}),e.jsxs(V,{className:"glass-effect",children:[e.jsx(H,{children:e.jsxs(Y,{className:"flex items-center gap-2 text-red-500",children:[e.jsx(ge,{className:"w-5 h-5"}),"Allergies"]})}),e.jsxs(K,{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:C.map(s=>e.jsx(y,{variant:x.allergies.includes(s)?"destructive":"outline",className:"cursor-pointer",onClick:()=>c&&(x.allergies.includes(s)?$("allergies",s):u(e=>({...e,allergies:[...e.allergies,s]}))),children:s},s))}),c&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{placeholder:"Add custom allergy...",value:j,onChange:e=>f(e.target.value),onKeyPress:e=>"Enter"===e.key&&A("allergies",j,0,f)}),e.jsx(P,{size:"sm",onClick:()=>A("allergies",j,0,f),children:e.jsx(Ce,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:x.allergies.filter(e=>!C.includes(e)).map(s=>e.jsxs(y,{variant:"destructive",className:"flex items-center gap-1",children:[s,c&&e.jsx(be,{className:"w-3 h-3 cursor-pointer",onClick:()=>$("allergies",s)})]},s))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(V,{className:"glass-effect",children:[e.jsx(H,{children:e.jsx(Y,{className:"text-sm",children:"Disliked Foods"})}),e.jsxs(K,{className:"space-y-2",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:x.disliked_foods.map(s=>e.jsxs(y,{variant:"secondary",className:"flex items-center gap-1",children:[s,c&&e.jsx(be,{className:"w-3 h-3 cursor-pointer",onClick:()=>$("disliked_foods",s)})]},s))}),c&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{placeholder:"Add disliked food...",value:v,onChange:e=>b(e.target.value),onKeyPress:e=>"Enter"===e.key&&A("disliked_foods",v,0,b)}),e.jsx(P,{size:"sm",variant:"outline",onClick:()=>A("disliked_foods",v,0,b),children:e.jsx(Ce,{className:"w-4 h-4"})})]})]})]}),e.jsxs(V,{className:"glass-effect",children:[e.jsx(H,{children:e.jsx(Y,{className:"text-sm",children:"Favorite Foods"})}),e.jsxs(K,{className:"space-y-2",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:x.favorite_foods.map(s=>e.jsxs(y,{variant:"default",className:"flex items-center gap-1 bg-green-500",children:[s,c&&e.jsx(be,{className:"w-3 h-3 cursor-pointer",onClick:()=>$("favorite_foods",s)})]},s))}),c&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{placeholder:"Add favorite food...",value:N,onChange:e=>k(e.target.value),onKeyPress:e=>"Enter"===e.key&&A("favorite_foods",N,0,k)}),e.jsx(P,{size:"sm",variant:"outline",onClick:()=>A("favorite_foods",N,0,k),children:e.jsx(Ce,{className:"w-4 h-4"})})]})]})]})]})]}),e.jsxs(At,{value:"health",className:"space-y-4",children:[e.jsxs(V,{className:"glass-effect",children:[e.jsx(H,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"w-5 h-5 text-red-500"}),"Health Conditions"]})}),e.jsx(K,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:["Diabetes Type 1","Diabetes Type 2","Hypertension","High Cholesterol","Heart Disease","PCOS","Thyroid Disorder","IBS","Celiac Disease","Kidney Disease","Liver Disease","Gout","Anemia"].map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($t,{id:s,checked:x.health_conditions.includes(s),onCheckedChange:()=>c&&(e=>{u(s=>({...s,health_conditions:s.health_conditions.includes(e)?s.health_conditions.filter(s=>s!==e):[...s.health_conditions,e]}))})(s),disabled:!c}),e.jsx("label",{htmlFor:s,className:"text-sm cursor-pointer",children:s})]},s))})})]}),e.jsxs(V,{className:"glass-effect",children:[e.jsx(H,{children:e.jsx(Y,{children:"Medications & Supplements"})}),e.jsx(K,{children:e.jsx(R,{placeholder:"List any medications or supplements the client is taking...",value:x.medications,onChange:e=>u(s=>({...s,medications:e.target.value})),disabled:!c,rows:4})})]}),e.jsxs(V,{className:"glass-effect",children:[e.jsx(H,{children:e.jsx(Y,{children:"Special Instructions"})}),e.jsx(K,{children:e.jsx(R,{placeholder:"Any special dietary instructions or restrictions...",value:x.special_instructions,onChange:e=>u(s=>({...s,special_instructions:e.target.value})),disabled:!c,rows:4})})]})]}),e.jsxs(At,{value:"goals",className:"space-y-4",children:[e.jsxs(V,{className:"glass-effect",children:[e.jsx(H,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"Primary Goal"]})}),e.jsx(K,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[{value:"weight_loss",label:"Weight Loss"},{value:"weight_gain",label:"Weight Gain"},{value:"muscle_building",label:"Muscle Building"},{value:"maintenance",label:"Maintenance"},{value:"improve_health",label:"Improve Health"},{value:"increase_energy",label:"Increase Energy"},{value:"better_sleep",label:"Better Sleep"},{value:"reduce_inflammation",label:"Reduce Inflammation"}].map(s=>e.jsx(P,{variant:x.primary_goal===s.value?"default":"outline",size:"sm",onClick:()=>c&&u(e=>({...e,primary_goal:s.value})),disabled:!c,className:"w-full",children:s.label},s.value))})})]}),e.jsxs(V,{className:"glass-effect",children:[e.jsx(H,{children:e.jsx(Y,{children:"Daily Macro Targets"})}),e.jsxs(K,{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(I,{children:"Calories"}),e.jsx(E,{type:"number",value:x.target_calories,onChange:e=>u(s=>({...s,target_calories:parseInt(e.target.value)})),disabled:!c})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Protein (g)"}),e.jsx(E,{type:"number",value:x.target_protein_g,onChange:e=>u(s=>({...s,target_protein_g:parseInt(e.target.value)})),disabled:!c})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Carbs (g)"}),e.jsx(E,{type:"number",value:x.target_carbs_g,onChange:e=>u(s=>({...s,target_carbs_g:parseInt(e.target.value)})),disabled:!c})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Fat (g)"}),e.jsx(E,{type:"number",value:x.target_fat_g,onChange:e=>u(s=>({...s,target_fat_g:parseInt(e.target.value)})),disabled:!c})]})]})]}),L&&e.jsx(V,{className:"glass-effect bg-primary/5",children:e.jsxs(K,{className:"p-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["Recommended based on TDEE (",L," cal):"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Weight Loss"}),e.jsxs("p",{className:"font-bold text-red-500",children:[L-500," cal"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Maintenance"}),e.jsxs("p",{className:"font-bold text-green-500",children:[L," cal"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Weight Gain"}),e.jsxs("p",{className:"font-bold text-blue-500",children:[L+500," cal"]})]})]})]})}),e.jsxs(V,{className:"glass-effect",children:[e.jsx(H,{children:e.jsx(Y,{children:"Notes"})}),e.jsx(K,{children:e.jsx(R,{placeholder:"Additional notes about the client's goals and preferences...",value:x.notes,onChange:e=>u(s=>({...s,notes:e.target.value})),disabled:!c,rows:4})})]})]}),e.jsx(At,{value:"progress",className:"space-y-4",children:e.jsxs(V,{className:"glass-effect",children:[e.jsx(H,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),"Weight Progress History"]})}),e.jsx(K,{children:h.length>0?e.jsx("div",{className:"space-y-2",children:h.map((s,t)=>{const a=h[t+1],l=a?(s.weight_kg-a.weight_kg).toFixed(1):null,i=l&&parseFloat(l)<0;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:Oe(new Date(s.date),"MMM d, yyyy")})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"font-semibold",children:[s.weight_kg," kg"]}),l&&e.jsxs(y,{variant:i?"default":"destructive",className:i?"bg-green-500":"",children:[i?e.jsx(Qe,{className:"w-3 h-3 mr-1"}):e.jsx(ee,{className:"w-3 h-3 mr-1"}),Math.abs(l)," kg"]})]})]},s.id)})}):e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No progress data recorded yet"})})]})})]})]})},$a=({client:s,open:t,onOpenChange:a,onUpdate:l})=>{const{user:i}=w(),[r,n]=g.useState([]),[c,d]=g.useState([]),[o,m]=g.useState([]),[x,u]=g.useState({totalWorkouts:0,totalCalories:0,totalMinutes:0,weeklyWorkouts:0,weeklyCalories:0,weeklyMinutes:0}),[h,p]=g.useState(""),[j,f]=g.useState(""),[v,b]=g.useState(!1),[N,y]=g.useState("overview");g.useEffect(()=>{s&&t&&k()},[s,t]);const k=async()=>{b(!0);try{const{data:e,error:t}=await _.from("client_progress").select("*").eq("client_id",s.id).order("date",{ascending:!0}).limit(30);t||n(e||[]);const{data:a,error:l}=await _.from("meals").select("*").eq("user_id",s.id).order("created_at",{ascending:!1}).limit("Base"===s.tier?5:20);l||d(a||[]);const{data:r,error:c}=await _.from("nutritionist_notes").select("*").eq("client_id",s.id).eq("nutritionist_id",i.id).maybeSingle();!c&&r&&p(r.notes||"");const{data:o,error:x}=await _.from("workout_logs").select("*").eq("user_id",s.id).order("date",{ascending:!1}).limit(20);if(!x&&o){m(o);const e=new Date;e.setDate(e.getDate()-7);const s=o.filter(s=>new Date(s.date)>=e);u({totalWorkouts:o.length,totalCalories:o.reduce((e,s)=>e+(s.calories_burned||0),0),totalMinutes:o.reduce((e,s)=>e+(s.duration_minutes||0),0),weeklyWorkouts:s.length,weeklyCalories:s.reduce((e,s)=>e+(s.calories_burned||0),0),weeklyMinutes:s.reduce((e,s)=>e+(s.duration_minutes||0),0)})}}catch(e){}finally{b(!1)}},C=r.map(e=>({date:Oe(new Date(e.date),"MMM d"),weight:e.weight_kg})),D=r[r.length-1],E=r[r.length-2],T=D&&E?(D.weight_kg-E.weight_kg).toFixed(1):null;return e.jsx(S,{open:t,onOpenChange:a,children:e.jsxs(M,{className:"max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsx(A,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx($,{className:"text-2xl",children:s.full_name}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.email})]}),e.jsx(Gt,{tier:s.tier||"Base",size:"lg"})]})}),e.jsxs(Dt,{value:N,onValueChange:y,className:"w-full",children:[e.jsxs(Pt,{className:"grid w-full grid-cols-6",children:[e.jsx(Mt,{value:"overview",children:"Overview"}),e.jsxs(Mt,{value:"nutrition",className:"flex items-center gap-1",children:[e.jsx(Ke,{className:"w-3 h-3"}),"Nutrition"]}),e.jsxs(Mt,{value:"fitness",className:"flex items-center gap-1",children:[e.jsx(Ve,{className:"w-3 h-3"}),"Fitness"]}),e.jsx(Mt,{value:"progress",children:"Progress"}),e.jsx(Mt,{value:"meals",children:"Meals"}),e.jsx(Mt,{value:"actions",children:"Actions"})]}),e.jsxs(At,{value:"overview",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(V,{children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Current Weight"}),e.jsxs("p",{className:"text-3xl font-bold",children:[(null==D?void 0:D.weight_kg)||"N/A",D&&e.jsx("span",{className:"text-lg",children:" kg"})]}),T&&e.jsxs("p",{className:"text-sm mt-2 flex items-center justify-center gap-1 "+(parseFloat(T)<0?"text-green-600":"text-red-600"),children:[parseFloat(T)<0?e.jsx(Qe,{className:"w-4 h-4"}):e.jsx(ee,{className:"w-4 h-4"}),Math.abs(T)," kg"]})]})})}),e.jsx(V,{children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"BMI"}),e.jsx("p",{className:"text-3xl font-bold",children:((e,s)=>{if(!e||!s)return"N/A";const t=s/100;return(e/(t*t)).toFixed(1)})(null==D?void 0:D.weight_kg,s.height_cm)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Height: ",s.height_cm?`${s.height_cm} cm`:"N/A"]})]})})}),e.jsx(V,{children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Last Update"}),e.jsx("p",{className:"text-lg font-bold",children:(null==D?void 0:D.date)?Oe(new Date(D.date),"MMM d, yyyy"):"No updates"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Member since ",s.created_at?Oe(new Date(s.created_at),"MMM yyyy"):"N/A"]})]})})})]}),e.jsxs(V,{children:[e.jsx(H,{children:e.jsx(Y,{className:"text-lg",children:"Nutritionist Notes"})}),e.jsxs(K,{className:"space-y-4",children:[h&&e.jsx("div",{className:"p-4 bg-muted rounded-lg",children:e.jsx("pre",{className:"whitespace-pre-wrap text-sm font-sans",children:h})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"newNote",children:"Add Note"}),e.jsx(R,{id:"newNote",placeholder:"Add a new note about this client...",value:j,onChange:e=>f(e.target.value),rows:3}),e.jsxs(P,{onClick:async()=>{if(j.trim())try{const e=h?`${h}\n\n[${Oe(new Date,"MMM d, yyyy HH:mm")}]\n${j}`:j,{error:t}=await _.from("nutritionist_notes").upsert({client_id:s.id,nutritionist_id:i.id,notes:e,updated_at:(new Date).toISOString()},{onConflict:"client_id,nutritionist_id"});if(t)throw t;p(e),f(""),F({title:"Note saved",description:"Your note has been saved successfully."})}catch(e){F({title:"Error",description:"Failed to save note.",variant:"destructive"})}},disabled:!j.trim(),children:[e.jsx(Ge,{className:"w-4 h-4 mr-2"}),"Save Note"]})]})]})]})]}),e.jsx(At,{value:"nutrition",className:"space-y-4",children:e.jsx(Aa,{clientId:s.id})}),e.jsxs(At,{value:"fitness",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(V,{children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-primary to-primary/80 flex items-center justify-center mx-auto mb-3",children:e.jsx(Re,{className:"w-6 h-6 text-white"})}),e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Workouts This Week"}),e.jsx("p",{className:"text-3xl font-bold text-foreground",children:x.weeklyWorkouts}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[x.totalWorkouts," total workouts"]})]})})}),e.jsx(V,{children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center mx-auto mb-3",children:e.jsx(Je,{className:"w-6 h-6 text-white"})}),e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Calories Burned (Week)"}),e.jsx("p",{className:"text-3xl font-bold text-foreground",children:x.weeklyCalories.toLocaleString()}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[x.totalCalories.toLocaleString()," total cal"]})]})})}),e.jsx(V,{children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center mx-auto mb-3",children:e.jsx(Pe,{className:"w-6 h-6 text-white"})}),e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Active Minutes (Week)"}),e.jsx("p",{className:"text-3xl font-bold text-foreground",children:x.weeklyMinutes}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[x.totalMinutes," total minutes"]})]})})})]}),e.jsxs(V,{children:[e.jsx(H,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-5 h-5 text-primary"}),"Recent Workout History"]})}),e.jsx(K,{children:o.length>0?e.jsx("div",{className:"space-y-3",children:o.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"font-semibold text-foreground",children:s.workout_name}),e.jsx("span",{className:"px-2 py-0.5 bg-primary/20 text-primary rounded-full text-xs font-medium",children:s.workout_type||"Workout"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.date?Oe(new Date(s.date),"MMM d, yyyy"):"Unknown date",s.intensity&&` â€¢ ${s.intensity} intensity`]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1 text-orange-500",children:[e.jsx(Je,{className:"w-4 h-4"}),e.jsx("span",{className:"font-semibold",children:s.calories_burned||0})]}),e.jsxs("div",{className:"flex items-center gap-1 text-blue-500",children:[e.jsx(Pe,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-semibold",children:[s.duration_minutes||0,"m"]})]})]})})]},s.id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Ve,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No workout history available"}),e.jsx("p",{className:"text-sm mt-1",children:"Client hasn't logged any workouts yet"})]})})]})]}),e.jsx(At,{value:"progress",className:"space-y-4",children:"Base"===s.tier?e.jsx(V,{children:e.jsxs(K,{className:"p-8 text-center",children:[e.jsx(Re,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Progress Tracking Unavailable"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Progress tracking is available for Premium and Elite tier clients"}),e.jsx(Gt,{tier:"Premium"})]})}):e.jsx(e.Fragment,{children:e.jsxs(V,{children:[e.jsx(H,{children:e.jsx(Y,{children:"Weight Progress (Last 30 Days)"})}),e.jsx(K,{children:C.length>0?e.jsx(ie,{width:"100%",height:300,children:e.jsxs(re,{data:C,children:[e.jsx(ne,{strokeDasharray:"3 3"}),e.jsx(ce,{dataKey:"date"}),e.jsx(de,{}),e.jsx(oe,{}),e.jsx(xe,{type:"monotone",dataKey:"weight",stroke:"#3b82f6",strokeWidth:2,dot:{r:4}})]})}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ee,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No progress data available"})]})})]})})}),e.jsx(At,{value:"meals",className:"space-y-4",children:e.jsxs(V,{children:[e.jsx(H,{children:e.jsxs(Y,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Recent Meal Logs"}),"Base"===s.tier&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"(Limited to 5)"})]})}),e.jsx(K,{children:c.length>0?e.jsx("div",{className:"space-y-3",children:c.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.meal_name||"Meal"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.created_at?Oe(new Date(s.created_at),"MMM d, yyyy HH:mm"):"Unknown date"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold",children:[s.calories||0," cal"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["P: ",s.protein||0,"g | C: ",s.carbs||0,"g | F: ",s.fat||0,"g"]})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Ge,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No meal logs available"})]})})]})}),e.jsx(At,{value:"actions",className:"space-y-4",children:e.jsxs(V,{children:[e.jsxs(H,{children:[e.jsx(Y,{children:"Available Actions"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Actions available based on client's ",s.tier," tier"]})]}),e.jsx(K,{children:e.jsx(Ma,{client:s,onAction:(e,s)=>{switch(e){case"message":F({title:"Message",description:"Opening message composer..."});break;case"createMealPlan":F({title:"Meal Plan",description:"Redirecting to meal plan creator..."});break;case"scheduleVideo":F({title:"Video Call",description:"Opening scheduler..."});break;default:F({title:e,description:`Action: ${e}`})}}})})]})})]})]})})},Ea={tier:{label:"Subscription Tier",icon:ts,options:[{value:"base",label:"Base (Free)"},{value:"premium",label:"Premium"},{value:"pro",label:"Pro"},{value:"elite",label:"Elite"}]},goal_type:{label:"Primary Goal",icon:ae,options:[{value:"weight_loss",label:"Weight Loss"},{value:"muscle_gain",label:"Muscle Gain"},{value:"maintenance",label:"Maintenance"},{value:"performance",label:"Performance"}]},progress_status:{label:"Progress Status",icon:ee,options:[{value:"ahead",label:"Ahead of Target (>100%)"},{value:"on-track",label:"On Track (75-100%)"},{value:"behind",label:"Behind (50-75%)"},{value:"struggling",label:"Struggling (<50%)"}]},activity_level:{label:"Activity Level",icon:Re,options:[{value:"very-active",label:"Very Active (Daily logging)"},{value:"active",label:"Active (5-6 days/week)"},{value:"moderate",label:"Moderate (3-4 days/week)"},{value:"low",label:"Low (1-2 days/week)"},{value:"inactive",label:"Inactive (<1 day/week)"}]},tags:{label:"Client Tags",icon:ss,options:[{value:"high-priority",label:"High Priority"},{value:"at-risk",label:"At Risk"},{value:"star-client",label:"Star Client"},{value:"needs-attention",label:"Needs Attention"},{value:"inactive",label:"Inactive"},{value:"making-progress",label:"Making Progress"}]},join_date:{label:"Join Date",icon:ye,options:[{value:"last-7-days",label:"Last 7 days"},{value:"last-30-days",label:"Last 30 days"},{value:"last-90-days",label:"Last 90 days"},{value:"older",label:"Older than 90 days"}]}},Ra=[{id:"at-risk-clients",name:"At-Risk Clients",description:"Clients who are struggling or inactive",filters:{tags:["at-risk","inactive"],activity_level:["low","inactive"]},icon:ge,color:"bg-red-100 text-red-700"},{id:"star-performers",name:"Star Performers",description:"Highly engaged clients making great progress",filters:{tags:["star-client","making-progress"],progress_status:["ahead","on-track"],activity_level:["very-active","active"]},icon:Z,color:"bg-yellow-100 text-yellow-700"},{id:"new-clients",name:"New Clients",description:"Clients who joined in the last 30 days",filters:{join_date:["last-30-days"]},icon:te,color:"bg-blue-100 text-blue-700"},{id:"premium-clients",name:"Premium+ Clients",description:"Premium, Pro, and Elite tier clients",filters:{tier:["premium","pro","elite"]},icon:ts,color:"bg-purple-100 text-purple-700"}],Ta=({nutritionistId:s,onResultsChange:t,compact:a=!1})=>{const[l,i]=g.useState(""),[r,n]=g.useState({}),[c,d]=g.useState([]),[o,m]=g.useState(!1),[x,u]=g.useState(!1),[h,p]=g.useState({total:0,byTier:{},byGoal:{},avgProgress:0});g.useEffect(()=>{s&&j()},[s,l,r]);const j=async()=>{m(!0);try{let e=_.from("nutritionist_clients").select("\n          client_id,\n          created_at,\n          user_profiles (\n            id,\n            full_name,\n            email,\n            avatar_url,\n            tier,\n            created_at\n          ),\n          client_goals (\n            goal_type,\n            target_value,\n            current_value,\n            status\n          ),\n          client_tags (\n            tag_category\n          )\n        ").eq("nutritionist_id",s);const{data:a,error:i}=await e;if(i)throw i;let n=a.map(e=>{var s,t;const a=null==(s=e.client_goals)?void 0:s.find(e=>"active"===e.status),l=a?a.current_value/a.target_value*100:0;return{id:e.user_profiles.id,name:e.user_profiles.full_name,email:e.user_profiles.email,avatar:e.user_profiles.avatar_url,tier:e.user_profiles.tier,joinDate:new Date(e.user_profiles.created_at),relationshipDate:new Date(e.created_at),goalType:null==a?void 0:a.goal_type,progress:l,tags:(null==(t=e.client_tags)?void 0:t.map(e=>e.tag_category))||[]}});if(l){const e=l.toLowerCase();n=n.filter(s=>s.name.toLowerCase().includes(e)||s.email.toLowerCase().includes(e))}if(r.tier&&(n=n.filter(e=>r.tier.includes(e.tier))),r.goal_type&&(n=n.filter(e=>r.goal_type.includes(e.goalType))),r.progress_status&&(n=n.filter(e=>!!(r.progress_status.includes("ahead")&&e.progress>100)||(!!(r.progress_status.includes("on-track")&&e.progress>=75&&e.progress<=100)||(!!(r.progress_status.includes("behind")&&e.progress>=50&&e.progress<75)||!!(r.progress_status.includes("struggling")&&e.progress<50))))),r.tags&&(n=n.filter(e=>r.tags.some(s=>e.tags.includes(s)))),r.join_date){const e=new Date;n=n.filter(s=>{const t=Math.floor((e-s.relationshipDate)/864e5);return!!(r.join_date.includes("last-7-days")&&t<=7)||(!!(r.join_date.includes("last-30-days")&&t<=30)||(!!(r.join_date.includes("last-90-days")&&t<=90)||!!(r.join_date.includes("older")&&t>90)))})}const c={total:n.length,byTier:{},byGoal:{},avgProgress:n.reduce((e,s)=>e+s.progress,0)/n.length||0};n.forEach(e=>{c.byTier[e.tier]=(c.byTier[e.tier]||0)+1,e.goalType&&(c.byGoal[e.goalType]=(c.byGoal[e.goalType]||0)+1)}),d(n),p(c),t&&t(n)}catch(e){}finally{m(!1)}},f=(e,s)=>{n(t=>{var a,l;const i={...t};return i[e]=null==(a=i[e])?void 0:a.filter(e=>e!==s),0===(null==(l=i[e])?void 0:l.length)&&delete i[e],i})},v=e=>{n(e.filters),i("")},b=Object.values(r).reduce((e,s)=>e+s.length,0);return a?e.jsxs(V,{children:[e.jsx(H,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"w-5 h-5"}),"Quick Search"]})}),e.jsxs(K,{children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(E,{placeholder:"Search clients...",value:l,onChange:e=>i(e.target.value),className:"pl-10"})]}),e.jsx("div",{className:"mt-4 space-y-2",children:Ra.slice(0,2).map(s=>e.jsxs(P,{variant:"outline",size:"sm",className:"w-full justify-start",onClick:()=>v(s),children:[e.jsx(s.icon,{className:"w-4 h-4 mr-2"}),s.name]},s.id))})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(V,{children:[e.jsxs(H,{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"w-6 h-6"}),"Advanced Client Search"]}),e.jsx(Q,{children:"Search and filter your clients using multiple criteria"})]}),e.jsx(K,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(E,{placeholder:"Search by name or email...",value:l,onChange:e=>i(e.target.value),className:"pl-10"})]}),e.jsxs(P,{variant:x?"default":"outline",onClick:()=>u(!x),children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),"Filters",b>0&&e.jsx(y,{variant:"secondary",className:"ml-2",children:b})]})]})})]}),e.jsxs(V,{children:[e.jsx(H,{children:e.jsxs(Y,{className:"text-lg flex items-center gap-2",children:[e.jsx(es,{className:"w-5 h-5"}),"Quick Filters"]})}),e.jsx(K,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Ra.map((s,t)=>e.jsx(se.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.05*t},whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(V,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>v(s),children:e.jsxs(K,{className:"p-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-full ${s.color} mb-3 flex items-center justify-center`,children:e.jsx(s.icon,{className:"w-5 h-5"})}),e.jsx("h4",{className:"font-medium text-sm mb-1",children:s.name}),e.jsx("p",{className:"text-xs text-gray-600",children:s.description})]})})},s.id))})})]}),e.jsx(De,{children:x&&e.jsx(se.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:e.jsxs(V,{children:[e.jsx(H,{children:e.jsx(Y,{className:"text-lg",children:"Advanced Filters"})}),e.jsx(K,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Object.entries(Ea).map(([s,t])=>e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(t.icon,{className:"w-4 h-4"}),t.label]}),e.jsx("div",{className:"space-y-2",children:t.options.map(t=>{var a;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($t,{checked:(null==(a=r[s])?void 0:a.includes(t.value))||!1,onCheckedChange:e=>{e?((e,s)=>{n(t=>({...t,[e]:[...t[e]||[],s]}))})(s,t.value):f(s,t.value)}}),e.jsx("label",{className:"text-sm cursor-pointer",children:t.label})]},t.value)})})]},s))})})]})})}),b>0&&e.jsx(V,{className:"bg-green-50 border-green-200",children:e.jsxs(K,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"w-4 h-4 text-green-700"}),e.jsx("span",{className:"text-sm font-medium text-green-700",children:"Active Filters"})]}),e.jsx(P,{size:"sm",variant:"ghost",className:"text-green-700",onClick:()=>{n({}),i("")},children:"Clear All"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(r).map(([s,t])=>t.map(t=>{const a=Ea[s],l=a.options.find(e=>e.value===t);return e.jsxs(y,{variant:"secondary",className:"bg-white cursor-pointer",onClick:()=>f(s,t),children:[a.label,": ",null==l?void 0:l.label,e.jsx(be,{className:"w-3 h-3 ml-1"})]},`${s}-${t}`)}))})]})}),e.jsxs(V,{children:[e.jsx(H,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5"}),"Search Results (",h.total,")"]}),h.total>0&&e.jsx("div",{className:"flex items-center gap-4 text-sm",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"text-gray-600",children:["Avg Progress: ",h.avgProgress.toFixed(1),"%"]})]})})]})}),e.jsx(K,{children:o?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Searching..."}):0===c.length?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No clients found matching your search criteria"}):e.jsx("div",{className:"space-y-3",children:c.map((s,t)=>{var a;return e.jsx(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*t},className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-green-400 to-green-600 flex items-center justify-center text-white font-bold text-lg flex-shrink-0",children:(null==(a=s.name)?void 0:a.charAt(0))||"C"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 truncate",children:s.name}),e.jsx(y,{variant:"outline",className:"text-xs",children:s.tier})]}),e.jsx("p",{className:"text-sm text-gray-600 truncate mb-2",children:s.email}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[s.goalType&&e.jsxs(y,{variant:"secondary",className:"text-xs",children:[e.jsx(ae,{className:"w-3 h-3 mr-1"}),s.goalType.replace("_"," ")]}),s.tags.map(s=>e.jsxs(y,{variant:"outline",className:"text-xs",children:[e.jsx(ss,{className:"w-3 h-3 mr-1"}),s.replace("-"," ")]},s))]}),s.progress>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full "+(s.progress>100?"bg-green-600":s.progress>=75?"bg-green-500":s.progress>=50?"bg-yellow-500":"bg-red-500"),style:{width:`${Math.min(s.progress,100)}%`}})}),e.jsxs("span",{className:"text-xs text-gray-600 w-12 text-right",children:[s.progress.toFixed(0),"%"]})]})]})]})},s.id)})})})]})]})},Fa=[{id:"send-message",name:"Send Message",icon:pe,color:"bg-blue-100 text-blue-700",description:"Send a message to multiple clients"},{id:"add-tag",name:"Add Tag",icon:ss,color:"bg-green-100 text-green-700",description:"Apply tag to selected clients"},{id:"remove-tag",name:"Remove Tag",icon:be,color:"bg-red-100 text-red-700",description:"Remove tag from selected clients"},{id:"assign-goal",name:"Assign Goal",icon:ae,color:"bg-purple-100 text-purple-700",description:"Set a goal for selected clients"},{id:"schedule-checkin",name:"Schedule Check-in",icon:ye,color:"bg-orange-100 text-orange-700",description:"Schedule check-ins for selected clients"},{id:"export-data",name:"Export Data",icon:as,color:"bg-indigo-100 text-indigo-700",description:"Export client data to CSV"}],za=[{id:"high-priority",name:"High Priority"},{id:"at-risk",name:"At Risk"},{id:"star-client",name:"Star Client"},{id:"needs-attention",name:"Needs Attention"},{id:"inactive",name:"Inactive"},{id:"making-progress",name:"Making Progress"}],Ia=({nutritionistId:s,selectedClients:t=[],onClearSelection:a})=>{const[l,i]=g.useState(!1),[r,n]=g.useState(null),[c,d]=g.useState([]),[o,m]=g.useState([]),[x,u]=g.useState({subject:"",content:""}),[h,p]=g.useState(""),[j,f]=g.useState({goal_type:"weight_loss",target_value:"",target_date:"",description:""}),[v,b]=g.useState({scheduled_date:"",checkin_type:"weekly",notes:""});g.useEffect(()=>{s&&(N(),k())},[s]),g.useEffect(()=>{t.length>0&&w()},[t]);const N=async()=>{try{const{data:e,error:t}=await _.from("nutritionist_clients").select("\n          client_id,\n          user_profiles (\n            id,\n            full_name,\n            email,\n            tier\n          )\n        ").eq("nutritionist_id",s);if(t)throw t;const a=e.map(e=>({id:e.user_profiles.id,name:e.user_profiles.full_name,email:e.user_profiles.email,tier:e.user_profiles.tier}));d(a)}catch(e){}},w=async()=>{},k=async()=>{try{const{data:e,error:t}=await _.from("bulk_action_history").select("*").eq("nutritionist_id",s).order("created_at",{ascending:!1}).limit(10);if(t)throw t;m(e||[])}catch(e){}},C=async()=>{const e=t.map(e=>_.from("messages").insert({sender_id:s,recipient_id:e,subject:x.subject,content:x.content,message_type:"nutritionist_to_client"}));await Promise.all(e)},D=async()=>{const e=t.map(e=>_.from("client_tags").upsert({nutritionist_id:s,client_id:e,tag_category:h},{onConflict:"nutritionist_id,client_id,tag_category"}));await Promise.all(e)},F=async()=>{await _.from("client_tags").delete().eq("nutritionist_id",s).in("client_id",t).eq("tag_category",h)},z=async()=>{const e=t.map(e=>_.from("client_goals").insert({user_id:e,nutritionist_id:s,goal_type:j.goal_type,target_value:parseFloat(j.target_value),target_date:j.target_date,description:j.description,status:"active"}));await Promise.all(e)},I=async()=>{const e=t.map(e=>_.from("scheduled_checkins").insert({nutritionist_id:s,client_id:e,scheduled_date:v.scheduled_date,checkin_type:v.checkin_type,notes:v.notes,status:"pending"}));await Promise.all(e)},L=async()=>{try{const{data:e,error:s}=await _.from("user_profiles").select("\n          id,\n          full_name,\n          email,\n          tier,\n          created_at,\n          client_goals (goal_type, target_value, status),\n          client_tags (tag_category),\n          meals (id),\n          workout_logs (id)\n        ").in("id",t);if(s)throw s;const a=q(e),l=new Blob([a],{type:"text/csv"}),i=window.URL.createObjectURL(l),r=document.createElement("a");r.href=i,r.download=`client-data-${(new Date).toISOString().split("T")[0]}.csv`,r.click(),window.URL.revokeObjectURL(i)}catch(e){throw e}},q=e=>{if(!e||0===e.length)return"";const s=e.map(e=>{var s,t,a,l;return[e.full_name,e.email,e.tier,new Date(e.created_at).toLocaleDateString(),(null==(s=e.client_goals)?void 0:s.filter(e=>"active"===e.status).length)||0,(null==(t=e.client_tags)?void 0:t.map(e=>e.tag_category).join("; "))||"None",(null==(a=e.meals)?void 0:a.length)||0,(null==(l=e.workout_logs)?void 0:l.length)||0]});return[["Name","Email","Tier","Join Date","Active Goals","Tags","Meals Logged","Workouts Logged"].join(","),...s.map(e=>e.map(e=>`"${e}"`).join(","))].join("\n")},O=async e=>{try{const a=Fa.find(s=>s.id===e);await _.from("bulk_action_history").insert({nutritionist_id:s,action_type:e,action_name:a.name,clients_affected:t.length,client_ids:t,metadata:{message:x,tag:h,goal:j,checkin:v}})}catch(a){}};return 0===t.length?e.jsx(V,{children:e.jsxs(K,{className:"p-8 text-center",children:[e.jsx(te,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Clients Selected"}),e.jsx("p",{className:"text-gray-600",children:"Select clients from your client list to perform bulk actions"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(V,{className:"bg-green-50 border-green-200",children:e.jsx(K,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Me,{className:"w-5 h-5 text-green-700"}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-green-900",children:[t.length," Client",t.length>1?"s":""," Selected"]}),e.jsx("p",{className:"text-sm text-green-700",children:"Choose an action to perform on selected clients"})]})]}),a&&e.jsx(P,{size:"sm",variant:"ghost",className:"text-green-700",onClick:a,children:"Clear Selection"})]})})}),e.jsxs(V,{children:[e.jsxs(H,{children:[e.jsx(Y,{children:"Bulk Actions"}),e.jsx(Q,{children:"Perform actions on multiple clients simultaneously"})]}),e.jsx(K,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:Fa.map((s,t)=>e.jsx(se.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.05*t},whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(V,{className:"cursor-pointer hover:shadow-lg transition-all",onClick:()=>n(s.id),children:e.jsxs(K,{className:"p-6 text-center",children:[e.jsx("div",{className:`w-12 h-12 rounded-full ${s.color} mx-auto mb-3 flex items-center justify-center`,children:e.jsx(s.icon,{className:"w-6 h-6"})}),e.jsx("h4",{className:"font-medium text-sm mb-1",children:s.name}),e.jsx("p",{className:"text-xs text-gray-600",children:s.description})]})})},s.id))})})]}),o.length>0&&e.jsxs(V,{children:[e.jsx(H,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5"}),"Recent Bulk Actions"]})}),e.jsx(K,{children:e.jsx("div",{className:"space-y-3",children:o.slice(0,5).map((s,t)=>e.jsxs(se.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.05*t},className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx(Me,{className:"w-4 h-4 text-green-700"})}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-sm",children:s.action_name}),e.jsxs("p",{className:"text-xs text-gray-600",children:[s.clients_affected," clients â€¢ ",new Date(s.created_at).toLocaleDateString()]})]})]}),e.jsx(y,{variant:"secondary",children:new Date(s.created_at).toLocaleTimeString()})]},s.id))})})]}),(()=>{if(!r)return null;const s=Fa.find(e=>e.id===r);return e.jsx(S,{open:!!r,onOpenChange:()=>n(null),children:e.jsxs(M,{className:"max-w-2xl",children:[e.jsxs(A,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(s.icon,{className:"w-5 h-5"}),s.name]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.description," (",t.length," clients selected)"]})]}),e.jsxs("div",{className:"space-y-4",children:["send-message"===r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Subject"}),e.jsx(E,{placeholder:"Message subject",value:x.subject,onChange:e=>u({...x,subject:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Message"}),e.jsx(R,{placeholder:"Your message to clients...",rows:6,value:x.content,onChange:e=>u({...x,content:e.target.value})})]})]}),("add-tag"===r||"remove-tag"===r)&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Select Tag"}),e.jsxs(wt,{value:h,onValueChange:p,children:[e.jsx(_t,{children:e.jsx(kt,{placeholder:"Choose a tag"})}),e.jsx(Ct,{children:za.map(s=>e.jsx(St,{value:s.id,children:s.name},s.id))})]})]}),"assign-goal"===r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Goal Type"}),e.jsxs(wt,{value:j.goal_type,onValueChange:e=>f({...j,goal_type:e}),children:[e.jsx(_t,{children:e.jsx(kt,{})}),e.jsxs(Ct,{children:[e.jsx(St,{value:"weight_loss",children:"Weight Loss"}),e.jsx(St,{value:"muscle_gain",children:"Muscle Gain"}),e.jsx(St,{value:"maintenance",children:"Maintenance"}),e.jsx(St,{value:"performance",children:"Performance"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Target Value (kg)"}),e.jsx(E,{type:"number",placeholder:"e.g., 70",value:j.target_value,onChange:e=>f({...j,target_value:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Target Date"}),e.jsx(E,{type:"date",value:j.target_date,onChange:e=>f({...j,target_date:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Description"}),e.jsx(R,{placeholder:"Goal description...",rows:3,value:j.description,onChange:e=>f({...j,description:e.target.value})})]})]}),"schedule-checkin"===r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Check-in Date"}),e.jsx(E,{type:"datetime-local",value:v.scheduled_date,onChange:e=>b({...v,scheduled_date:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Check-in Type"}),e.jsxs(wt,{value:v.checkin_type,onValueChange:e=>b({...v,checkin_type:e}),children:[e.jsx(_t,{children:e.jsx(kt,{})}),e.jsxs(Ct,{children:[e.jsx(St,{value:"weekly",children:"Weekly Check-in"}),e.jsx(St,{value:"biweekly",children:"Bi-weekly Check-in"}),e.jsx(St,{value:"monthly",children:"Monthly Check-in"}),e.jsx(St,{value:"custom",children:"Custom Check-in"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Notes"}),e.jsx(R,{placeholder:"Any notes for this check-in...",rows:3,value:v.notes,onChange:e=>b({...v,notes:e.target.value})})]})]}),"export-data"===r&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(as,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-1",children:"Export Client Data"}),e.jsxs("p",{className:"text-sm text-blue-700",children:["This will export comprehensive data for ",t.length," selected clients including their profile, goals, tags, and activity statistics to a CSV file."]})]})]})})]}),e.jsxs(T,{children:[e.jsx(P,{variant:"outline",onClick:()=>n(null),disabled:l,children:"Cancel"}),e.jsx(P,{onClick:()=>(async e=>{i(!0);try{switch(e){case"send-message":await C();break;case"add-tag":await D();break;case"remove-tag":await F();break;case"assign-goal":await z();break;case"schedule-checkin":await I();break;case"export-data":await L()}await O(e),await k(),n(null),a&&a()}catch(s){alert("Failed to execute action. Please try again.")}finally{i(!1)}})(r),disabled:l,children:l?"Processing...":`Execute Action (${t.length} clients)`})]})]})})})()]})},La=[{id:"high-priority",name:"High Priority",icon:ge,color:"bg-red-100 text-red-700 border-red-300",dotColor:"bg-red-500",description:"Clients requiring immediate attention"},{id:"at-risk",name:"At Risk",icon:Ee,color:"bg-orange-100 text-orange-700 border-orange-300",dotColor:"bg-orange-500",description:"Clients showing signs of potential churn"},{id:"star-client",name:"Star Client",icon:Z,color:"bg-yellow-100 text-yellow-700 border-yellow-300",dotColor:"bg-yellow-500",description:"High-performing clients with excellent results"},{id:"needs-attention",name:"Needs Attention",icon:ls,color:"bg-blue-100 text-blue-700 border-blue-300",dotColor:"bg-blue-500",description:"Clients who need follow-up or check-in"},{id:"inactive",name:"Inactive",icon:Pe,color:"bg-gray-100 text-gray-700 border-gray-300",dotColor:"bg-gray-500",description:"Clients with low activity in the past 2 weeks"},{id:"making-progress",name:"Making Progress",icon:ee,color:"bg-green-100 text-green-700 border-green-300",dotColor:"bg-green-500",description:"Clients showing consistent progress toward goals"}],qa=({nutritionistId:s,compact:t=!1})=>{const[a,l]=g.useState([]),[i,r]=g.useState(!0),[n,c]=g.useState([]),[d,o]=g.useState(""),[m,x]=g.useState([]),[u,h]=g.useState(!1);g.useState(!1);const[p,j]=g.useState({});g.useEffect(()=>{s&&(f(),v())},[s]);const f=async()=>{try{r(!0);const{data:e,error:t}=await _.from("nutritionist_clients").select("\n          client_id,\n          user_profiles (\n            id,\n            full_name,\n            email,\n            avatar_url,\n            tier\n          ),\n          client_tags (\n            tag_category,\n            created_at\n          )\n        ").eq("nutritionist_id",s);if(t)throw t;const a=e.map(e=>({id:e.user_profiles.id,name:e.user_profiles.full_name,email:e.user_profiles.email,avatar:e.user_profiles.avatar_url,tier:e.user_profiles.tier,tags:e.client_tags||[]}));l(a)}catch(e){}finally{r(!1)}},v=async()=>{try{const{data:e,error:t}=await _.from("client_tags").select("tag_category").eq("nutritionist_id",s);if(t)throw t;const a={};La.forEach(s=>{a[s.id]=e.filter(e=>e.tag_category===s.id).length}),j(a)}catch(e){}},b=a.filter(e=>{const s=e.name.toLowerCase().includes(d.toLowerCase())||e.email.toLowerCase().includes(d.toLowerCase()),t=0===n.length||n.every(s=>e.tags.some(e=>e.tag_category===s));return s&&t}),N=e=>{c(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])};return t?e.jsxs(V,{children:[e.jsx(H,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"w-5 h-5"}),"Client Tags"]})}),e.jsx(K,{children:e.jsx("div",{className:"flex flex-wrap gap-2",children:La.map(s=>e.jsxs(y,{variant:"outline",className:`${s.color} cursor-pointer`,onClick:()=>N(s.id),children:[e.jsx(s.icon,{className:"w-3 h-3 mr-1"}),s.name,e.jsx("span",{className:"ml-1 px-1.5 py-0.5 bg-white/50 rounded-full text-xs",children:p[s.id]||0})]},s.id))})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(V,{children:[e.jsxs(H,{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"w-6 h-6"}),"Client Tag Management"]}),e.jsx(Q,{children:"Organize and filter your clients using custom tags"})]}),e.jsx(K,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:La.map(s=>{const t=s.icon,a=p[s.id]||0,l=n.includes(s.id);return e.jsx(se.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(V,{className:"cursor-pointer transition-all "+(l?"ring-2 ring-green-500 shadow-lg":"hover:shadow-md"),onClick:()=>N(s.id),children:e.jsxs(K,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(t,{className:"w-5 h-5 "+(l?"text-green-600":"text-gray-600")}),e.jsx("span",{className:`w-2 h-2 rounded-full ${s.dotColor}`})]}),e.jsx("div",{className:"text-2xl font-bold mb-1",children:a}),e.jsx("div",{className:"text-xs text-gray-600",children:s.name})]})})},s.id)})})})]}),n.length>0&&e.jsx(se.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:e.jsx(V,{className:"bg-green-50 border-green-200",children:e.jsx(K,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(Xe,{className:"w-4 h-4 text-green-700"}),e.jsx("span",{className:"text-sm font-medium text-green-700",children:"Active Filters:"}),n.map(s=>{const t=La.find(e=>e.id===s);return e.jsxs(y,{className:`${t.color} cursor-pointer`,onClick:()=>N(s),children:[t.name,e.jsx(be,{className:"w-3 h-3 ml-1"})]},s)}),e.jsx(P,{size:"sm",variant:"ghost",className:"text-green-700",onClick:()=>c([]),children:"Clear All"})]})})})}),e.jsx(V,{children:e.jsx(K,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(E,{placeholder:"Search clients by name or email...",value:d,onChange:e=>o(e.target.value),className:"pl-10"})]}),m.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(y,{variant:"secondary",children:[m.length," selected"]}),e.jsxs(S,{open:u,onOpenChange:h,children:[e.jsx(D,{asChild:!0,children:e.jsx(P,{variant:"outline",size:"sm",children:"Bulk Actions"})}),e.jsxs(M,{children:[e.jsx(A,{children:e.jsx($,{children:"Bulk Tag Actions"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Add Tag to Selected Clients"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:La.map(t=>e.jsxs(P,{variant:"outline",size:"sm",className:t.color,onClick:()=>(async e=>{try{const t=m.map(t=>({nutritionist_id:s,client_id:t,tag_category:e})),{error:a}=await _.from("client_tags").upsert(t,{onConflict:"nutritionist_id,client_id,tag_category"});if(a)throw a;x([]),h(!1),await f(),await v()}catch(t){}})(t.id),children:[e.jsx(t.icon,{className:"w-4 h-4 mr-1"}),t.name]},t.id))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Remove Tag from Selected Clients"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:La.map(t=>e.jsxs(P,{variant:"outline",size:"sm",onClick:()=>(async e=>{try{const{error:t}=await _.from("client_tags").delete().eq("nutritionist_id",s).in("client_id",m).eq("tag_category",e);if(t)throw t;x([]),h(!1),await f(),await v()}catch(t){}})(t.id),children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),t.name]},t.id))})]})]})]})]}),e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>x([]),children:"Clear Selection"})]})]})})}),e.jsxs(V,{children:[e.jsx(H,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5"}),"Clients (",b.length,")"]})}),e.jsx(K,{children:i?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading clients..."}):0===b.length?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No clients found matching your filters"}):e.jsx("div",{className:"space-y-3",children:e.jsx(De,{children:b.map(t=>{var a;return e.jsx(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx($t,{checked:m.includes(t.id),onCheckedChange:()=>{return e=t.id,void x(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e]);var e}}),e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-green-400 to-green-600 flex items-center justify-center text-white font-bold text-lg flex-shrink-0",children:(null==(a=t.name)?void 0:a.charAt(0))||"C"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 truncate",children:t.name}),e.jsx(y,{variant:"outline",className:"text-xs",children:t.tier})]}),e.jsx("p",{className:"text-sm text-gray-600 truncate mb-2",children:t.email}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.tags.map(a=>{const l=La.find(e=>e.id===a.tag_category);return l?e.jsxs(y,{variant:"outline",className:`${l.color} text-xs`,children:[e.jsx(l.icon,{className:"w-3 h-3 mr-1"}),l.name,e.jsx("button",{onClick:()=>(async(e,t)=>{try{const{error:a}=await _.from("client_tags").delete().eq("nutritionist_id",s).eq("client_id",e).eq("tag_category",t);if(a)throw a;await f(),await v()}catch(a){}})(t.id,a.tag_category),className:"ml-1 hover:text-red-700",children:e.jsx(be,{className:"w-3 h-3"})})]},a.tag_category):null}),e.jsxs(S,{children:[e.jsx(D,{asChild:!0,children:e.jsxs(P,{variant:"outline",size:"sm",className:"h-6 px-2 text-xs",children:[e.jsx(Ce,{className:"w-3 h-3 mr-1"}),"Add Tag"]})}),e.jsxs(M,{children:[e.jsx(A,{children:e.jsxs($,{children:["Add Tag to ",t.name]})}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:La.map(a=>{const l=t.tags.some(e=>e.tag_category===a.id);return e.jsxs(P,{variant:l?"secondary":"outline",className:`${a.color} justify-start`,onClick:()=>{l||(async(e,t)=>{try{const{data:a}=await _.from("client_tags").select("*").eq("nutritionist_id",s).eq("client_id",e).eq("tag_category",t).single();if(a)return;const{error:l}=await _.from("client_tags").insert({nutritionist_id:s,client_id:e,tag_category:t});if(l)throw l;await f(),await v()}catch(a){}})(t.id,a.id)},disabled:l,children:[e.jsx(a.icon,{className:"w-4 h-4 mr-2"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:a.name}),e.jsx("div",{className:"text-xs opacity-75",children:a.description})]}),l&&e.jsx(Me,{className:"w-4 h-4 ml-auto"})]},a.id)})})]})]})]})]})]})},t.id)})})})})]})]})},Oa=()=>{const{user:s}=w(),t=j(),[a,l]=g.useState([]),[i,r]=g.useState([]),[n,c]=g.useState(""),[d,o]=g.useState("all"),[m,x]=g.useState("all"),[u,h]=g.useState(null),[p,f]=g.useState(!1),[v,b]=g.useState(!0),[N,y]=g.useState(!1),[k,C]=g.useState(!1),[D,R]=g.useState(!1),[T,F]=g.useState([]),[z,I]=g.useState({total:0,base:0,premium:0,elite:0,active:0,inactive:0,atRisk:0});g.useEffect(()=>{L()},[s]),g.useEffect(()=>{O(),q()},[n,d,m,a]);const L=async()=>{b(!0);try{const{data:e,error:s}=await _.from("user_profiles").select("*").eq("role","user").order("created_at",{ascending:!1});if(s)throw s;const t=await Promise.all((e||[]).map(async e=>{const{data:s}=await _.from("client_progress").select("*").eq("client_id",e.id).order("date",{ascending:!1}).limit(2),{data:t}=await _.from("messages").select("created_at").or(`sender_id.eq.${e.id},recipient_id.eq.${e.id}`).order("created_at",{ascending:!1}).limit(1).maybeSingle(),{data:a}=await _.from("client_goals").select("*").eq("client_id",e.id).eq("status","active").limit(3),l=null==s?void 0:s[0],i=null==s?void 0:s[1],r=new Date;r.setDate(r.getDate()-7);const n=new Date;n.setDate(n.getDate()-14);const c=(null==l?void 0:l.date)?new Date(l.date):null,d=c&&c>r,o=c?ue(new Date,c):999,m=o>=7&&o<14||l&&i&&parseFloat(l.weight_kg)>parseFloat(i.weight_kg)&&"weight_loss"===e.goal_type;return{...e,tier:e.tier||"Base",latestWeight:null==l?void 0:l.weight_kg,weightChange:l&&i?(l.weight_kg-i.weight_kg).toFixed(1):null,lastUpdate:null==l?void 0:l.date,lastContact:null==t?void 0:t.created_at,daysSinceContact:(null==t?void 0:t.created_at)?ue(new Date,new Date(t.created_at)):null,isActive:d,isAtRisk:m,goals:a||[],goalCount:(null==a?void 0:a.length)||0}}));l(t)}catch(e){}finally{b(!1)}},q=()=>{const e={total:a.length,base:a.filter(e=>"Base"===e.tier).length,premium:a.filter(e=>"Premium"===e.tier).length,elite:a.filter(e=>"Elite"===e.tier).length,active:a.filter(e=>e.isActive).length,inactive:a.filter(e=>!e.isActive&&!e.isAtRisk).length,atRisk:a.filter(e=>e.isAtRisk).length};I(e)},O=()=>{let e=a;n&&(e=e.filter(e=>{var s,t;return(null==(s=e.full_name)?void 0:s.toLowerCase().includes(n.toLowerCase()))||(null==(t=e.email)?void 0:t.toLowerCase().includes(n.toLowerCase()))})),"all"!==d&&(e=e.filter(e=>e.tier===d)),"active"===m?e=e.filter(e=>e.isActive):"inactive"===m?e=e.filter(e=>!e.isActive&&!e.isAtRisk):"at-risk"===m&&(e=e.filter(e=>e.isAtRisk)),r(e)},B=(e,s)=>{s.stopPropagation(),t(`/app/nutritionist/messages?conversation=${e.id}`)},G=e=>{h(e),f(!0)},W=({client:s})=>{var a;const l=((e,s)=>{if(!e||!s)return"N/A";const t=s/100;return(e/(t*t)).toFixed(1)})(s.latestWeight,s.height_cm),i=s.weightChange&&parseFloat(s.weightChange)<0;return e.jsx(Ca,{children:e.jsx(V,{className:"glass-effect hover:shadow-lg transition-all cursor-pointer h-full flex flex-col "+(s.isAtRisk?"border-orange-500/50 bg-orange-500/5":""),onClick:()=>G(s),children:e.jsxs(K,{className:"p-6 flex flex-col h-full",children:[s.isAtRisk&&e.jsxs("div",{className:"flex items-center gap-2 mb-3 p-2 bg-orange-100 dark:bg-orange-900/30 rounded-lg text-orange-700 dark:text-orange-300 text-xs",children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"At Risk - Needs attention"})]}),e.jsxs("div",{className:"flex items-start justify-between mb-4 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsxs("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 relative",children:[e.jsx("span",{className:"text-lg font-bold text-primary",children:(null==(a=s.full_name)?void 0:a.split(" ").map(e=>e[0]).join(""))||"?"}),s.isActive&&e.jsx("span",{className:"absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 bg-green-500 border-2 border-background rounded-full"})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg truncate",children:s.full_name||"Unknown"}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.email})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 items-end flex-shrink-0",children:[e.jsx(Gt,{tier:s.tier,size:"sm"}),e.jsx("div",{className:"px-2 py-1 rounded-full text-xs font-medium whitespace-nowrap "+(s.isAtRisk?"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200":s.isActive?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"),children:s.isAtRisk?"At Risk":s.isActive?"Active":"Inactive"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Current Weight"}),e.jsx("p",{className:"text-lg font-bold",children:s.latestWeight?`${s.latestWeight} kg`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"BMI"}),e.jsx("p",{className:"text-lg font-bold",children:l})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Progress"}),s.weightChange?e.jsxs("p",{className:"text-lg font-bold flex items-center gap-1 "+(i?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[i?e.jsx(Qe,{className:"w-4 h-4"}):e.jsx(ee,{className:"w-4 h-4"}),Math.abs(s.weightChange)," kg"]}):e.jsx("p",{className:"text-lg font-bold text-muted-foreground",children:"-"})]})]}),s.goalCount>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-3 text-xs text-muted-foreground",children:[e.jsx(ae,{className:"w-3.5 h-3.5 text-primary"}),e.jsxs("span",{children:[s.goalCount," active goal",s.goalCount>1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground mb-4",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"w-3.5 h-3.5"}),s.lastUpdate?Oe(new Date(s.lastUpdate),"MMM d"):"No updates"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Pe,{className:"w-3.5 h-3.5"}),null!==s.daysSinceContact?0===s.daysSinceContact?"Contacted today":`${s.daysSinceContact}d since contact`:"No messages"]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-auto pt-3 border-t border-border",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(Sa,{children:[e.jsx(Da,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:e=>B(s,e),children:e.jsx(pe,{className:"w-4 h-4 text-blue-500"})})}),e.jsx(Pa,{children:"Send Message"})]}),e.jsxs(Sa,{children:[e.jsx(Da,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:e=>((e,s)=>{s.stopPropagation(),t(`/app/nutritionist/meals?assign=${e.id}`)})(s,e),children:e.jsx(We,{className:"w-4 h-4 text-green-500"})})}),e.jsx(Pa,{children:"Assign Meal Plan"})]}),e.jsxs(Sa,{children:[e.jsx(Da,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:e=>((e,s)=>{s.stopPropagation(),t(`/app/nutritionist/schedule?client=${e.id}`)})(s,e),children:e.jsx(is,{className:"w-4 h-4 text-purple-500"})})}),e.jsx(Pa,{children:"Schedule Call"})]}),e.jsxs(Et,{children:[e.jsx(Rt,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:e=>e.stopPropagation(),children:e.jsx(rs,{className:"w-4 h-4"})})}),e.jsxs(Tt,{align:"end",children:[e.jsx(Ft,{onClick:e=>{e.stopPropagation(),G(s)},children:"View Full Profile"}),e.jsxs(Ft,{onClick:e=>B(s,e),children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Send Email"]}),e.jsx(zt,{}),e.jsx(Ft,{onClick:e=>{e.stopPropagation()},children:"Add Note"})]})]})]}),e.jsx(P,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),G(s)},children:"View Details"})]})]})})})},U=({icon:s,label:t,value:a,color:l,bgColor:i})=>e.jsx(V,{className:"glass-effect",children:e.jsx(K,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:t}),e.jsx("p",{className:"text-3xl font-bold",children:a})]}),e.jsx("div",{className:`p-3 rounded-full ${i}`,children:e.jsx(s,{className:`w-6 h-6 ${l}`})})]})})});return v?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(te,{className:"w-8 h-8 text-primary"}),"Client Management"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage and track your clients by subscription tier"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(P,{variant:"outline",size:"sm",onClick:()=>y(!0),children:[e.jsx(Ze,{className:"w-4 h-4 mr-2"}),"Advanced Search"]}),e.jsxs(P,{variant:"outline",size:"sm",onClick:()=>C(!0),disabled:0===T.length,children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Bulk Actions ",T.length>0&&`(${T.length})`]}),e.jsxs(P,{variant:"outline",size:"sm",onClick:()=>R(!0),children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Manage Tags"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(U,{icon:te,label:"Total Clients",value:z.total,color:"text-primary",bgColor:"bg-primary/10"}),e.jsx(U,{icon:J,label:"Base Tier",value:z.base,color:"text-gray-600 dark:text-gray-400",bgColor:"bg-gray-500/10"}),e.jsx(U,{icon:Z,label:"Premium Tier",value:z.premium,color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-500/10"}),e.jsx(U,{icon:X,label:"Elite Tier",value:z.elite,color:"text-yellow-600 dark:text-yellow-400",bgColor:"bg-yellow-500/10"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(V,{className:"glass-effect",children:e.jsxs(K,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Active Clients"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:z.active}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Activity in last 7 days"})]}),e.jsx("div",{className:"p-3 rounded-full bg-green-500/10",children:e.jsx(Re,{className:"w-6 h-6 text-green-600 dark:text-green-400"})})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 transition-all",style:{width:(z.total?z.active/z.total*100:0)+"%"}})})]})}),e.jsx(V,{className:"glass-effect "+(z.atRisk>0?"border-orange-500/50":""),children:e.jsxs(K,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"At-Risk Clients"}),e.jsx("p",{className:"text-3xl font-bold "+(z.atRisk>0?"text-orange-600":"text-muted-foreground"),children:z.atRisk}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Needs attention"})]}),e.jsx("div",{className:"p-3 rounded-full "+(z.atRisk>0?"bg-orange-500/10":"bg-muted"),children:e.jsx(ge,{className:"w-6 h-6 "+(z.atRisk>0?"text-orange-600":"text-muted-foreground")})})]}),z.atRisk>0&&e.jsx(P,{variant:"outline",size:"sm",className:"w-full text-orange-600 border-orange-300 hover:bg-orange-50",onClick:()=>x("at-risk"),children:"View At-Risk Clients"})]})}),e.jsx(V,{className:"glass-effect",children:e.jsxs(K,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Revenue Estimate"}),e.jsxs("p",{className:"text-3xl font-bold",children:["$",(29*z.premium+59*z.elite).toFixed(0)]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Monthly recurring revenue"})]}),e.jsx("div",{className:"p-3 rounded-full bg-primary/10",children:e.jsx(Fe,{className:"w-6 h-6 text-primary"})})]}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),e.jsxs("span",{children:["Premium: $",29*z.premium]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),e.jsxs("span",{children:["Elite: $",59*z.elite]})]})]})]})})]}),e.jsx(V,{className:"glass-effect",children:e.jsx(K,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(E,{placeholder:"Search clients by name or email...",value:n,onChange:e=>c(e.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(P,{variant:"all"===d?"default":"outline",size:"sm",onClick:()=>o("all"),className:"whitespace-nowrap",children:"All Tiers"}),e.jsxs(P,{variant:"Base"===d?"default":"outline",size:"sm",onClick:()=>o("Base"),className:"whitespace-nowrap "+("Base"===d?"":"border-gray-500/20"),children:[e.jsx(J,{className:"w-3 h-3 mr-1 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Base"})," (",z.base,")"]}),e.jsxs(P,{variant:"Premium"===d?"default":"outline",size:"sm",onClick:()=>o("Premium"),className:"whitespace-nowrap "+("Premium"===d?"":"border-blue-500/20"),children:[e.jsx(Z,{className:"w-3 h-3 mr-1 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Premium"})," (",z.premium,")"]}),e.jsxs(P,{variant:"Elite"===d?"default":"outline",size:"sm",onClick:()=>o("Elite"),className:"whitespace-nowrap "+("Elite"===d?"":"border-yellow-500/20"),children:[e.jsx(X,{className:"w-3 h-3 mr-1 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Elite"})," (",z.elite,")"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 sm:ml-auto",children:[e.jsx(P,{variant:"all"===m?"default":"outline",size:"sm",onClick:()=>x("all"),className:"whitespace-nowrap",children:"All"}),e.jsxs(P,{variant:"active"===m?"default":"outline",size:"sm",onClick:()=>x("active"),className:"whitespace-nowrap",children:[e.jsx(Re,{className:"w-3 h-3 mr-1"}),"Active (",z.active,")"]}),e.jsxs(P,{variant:"at-risk"===m?"default":"outline",size:"sm",onClick:()=>x("at-risk"),className:"whitespace-nowrap "+("at-risk"===m?"bg-orange-500 hover:bg-orange-600":"text-orange-600 border-orange-300 hover:bg-orange-50"),children:[e.jsx(ge,{className:"w-3 h-3 mr-1"}),"At Risk (",z.atRisk,")"]}),e.jsxs(P,{variant:"inactive"===m?"default":"outline",size:"sm",onClick:()=>x("inactive"),className:"whitespace-nowrap",children:["Inactive (",z.inactive,")"]})]})]})]})})}),i.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 md:gap-6",children:i.map(s=>e.jsx(W,{client:s},s.id))}):e.jsx(V,{className:"glass-effect",children:e.jsxs(K,{className:"p-12 text-center",children:[e.jsx(te,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No clients found"}),e.jsx("p",{className:"text-muted-foreground",children:n||"all"!==d||"all"!==m?"Try adjusting your filters or search":"Your clients will appear here"})]})}),u&&e.jsx($a,{client:u,open:p,onOpenChange:f,onUpdate:L}),e.jsx(S,{open:N,onOpenChange:y,children:e.jsxs(M,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(A,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"w-5 h-5"}),"Advanced Client Search"]})}),e.jsx(Ta,{nutritionistId:null==s?void 0:s.id,onResultsChange:e=>{e&&e.length>0&&r(e)}})]})}),e.jsx(S,{open:k,onOpenChange:C,children:e.jsxs(M,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(A,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5"}),"Bulk Actions (",T.length," clients selected)"]})}),e.jsx(Ia,{nutritionistId:null==s?void 0:s.id,selectedClients:T,onClearSelection:()=>{F([]),C(!1),L()}})]})}),e.jsx(S,{open:D,onOpenChange:R,children:e.jsxs(M,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(A,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"Manage Client Tags"]})}),e.jsx(qa,{nutritionistId:null==s?void 0:s.id})]})})]})},Ba=()=>{var s,t,a,l,i,r,n,c,d;const{user:o}=w();k();const[m,x]=g.useState([]),[u,h]=g.useState([]),[p,j]=g.useState(""),[f,v]=g.useState("pending"),[b,N]=g.useState(null),[C,D]=g.useState(!1),[F,z]=g.useState(!0),[I,q]=g.useState(""),[O,B]=g.useState("Base");g.useEffect(()=>{G()},[]),g.useEffect(()=>{W()},[p,f,m]);const G=async()=>{z(!0);try{const{data:e,error:s}=await _.from("client_intake_forms").select("\n          *,\n          user_profiles!client_intake_forms_client_id_fkey (\n            id,\n            full_name,\n            email,\n            avatar_url\n          )\n        ").order("submitted_at",{ascending:!1});if(s)throw s;x(e||[])}catch(e){}finally{z(!1)}},W=()=>{let e=m;"all"!==f&&(e=e.filter(e=>e.status===f)),p&&(e=e.filter(e=>{var s,t,a,l;return(null==(t=null==(s=e.user_profiles)?void 0:s.full_name)?void 0:t.toLowerCase().includes(p.toLowerCase()))||(null==(l=null==(a=e.user_profiles)?void 0:a.email)?void 0:l.toLowerCase().includes(p.toLowerCase()))})),h(e)},U=s=>{switch(s){case"pending":return e.jsx(Pe,{className:"w-4 h-4 text-yellow-500"});case"approved":return e.jsx(Me,{className:"w-4 h-4 text-green-500"});case"rejected":return e.jsx(cs,{className:"w-4 h-4 text-red-500"});default:return e.jsx(Ee,{className:"w-4 h-4 text-gray-500"})}},H=e=>({weight_loss:"Weight Loss",muscle_gain:"Muscle Gain",maintenance:"Maintenance",athletic_performance:"Athletic Performance",health_improvement:"Health Improvement"}[e]||e);return F?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(ns,{className:"w-6 h-6 text-primary"}),"Client Onboarding"]}),e.jsx("p",{className:"text-text-secondary mt-1",children:"Review and approve new client intake forms"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(V,{children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold",children:m.filter(e=>"pending"===e.status).length})]}),e.jsx(Pe,{className:"w-8 h-8 text-yellow-500"})]})})}),e.jsx(V,{children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Approved"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:m.filter(e=>"approved"===e.status).length})]}),e.jsx(Me,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(V,{children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Under Review"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:m.filter(e=>"reviewed"===e.status).length})]}),e.jsx(ls,{className:"w-8 h-8 text-blue-500"})]})})}),e.jsx(V,{children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Rejected"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:m.filter(e=>"rejected"===e.status).length})]}),e.jsx(cs,{className:"w-8 h-8 text-red-500"})]})})})]}),e.jsx(V,{children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-text-secondary w-4 h-4"}),e.jsx(E,{placeholder:"Search by name or email...",value:p,onChange:e=>j(e.target.value),className:"pl-10"})]})}),e.jsx(Dt,{value:f,onValueChange:v,children:e.jsxs(Pt,{children:[e.jsx(Mt,{value:"pending",children:"Pending"}),e.jsx(Mt,{value:"reviewed",children:"Reviewed"}),e.jsx(Mt,{value:"approved",children:"Approved"}),e.jsx(Mt,{value:"rejected",children:"Rejected"}),e.jsx(Mt,{value:"all",children:"All"})]})})]})})}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:0===u.length?e.jsx(V,{children:e.jsxs(K,{className:"pt-12 pb-12 text-center",children:[e.jsx(Ge,{className:"w-12 h-12 text-text-secondary mx-auto mb-4"}),e.jsx("p",{className:"text-text-secondary",children:"No intake forms found"})]})}):u.map(s=>{var t,a,l,i,r;return e.jsx(V,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(K,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:(null==(t=s.user_profiles)?void 0:t.avatar_url)?e.jsx("img",{src:s.user_profiles.avatar_url,alt:s.user_profiles.full_name,className:"w-12 h-12 rounded-full object-cover"}):e.jsx("span",{className:"text-primary font-bold text-lg",children:(null==(l=null==(a=s.user_profiles)?void 0:a.full_name)?void 0:l.charAt(0))||"?"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:(null==(i=s.user_profiles)?void 0:i.full_name)||"Unknown"}),e.jsx("p",{className:"text-sm text-text-secondary",children:null==(r=s.user_profiles)?void 0:r.email})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[U(s.status),e.jsx(y,{variant:"approved"===s.status?"success":"rejected"===s.status?"destructive":"secondary",children:s.status})]}),e.jsxs("p",{className:"text-xs text-text-secondary",children:["Submitted ",Oe(new Date(s.submitted_at),"MMM dd, yyyy")]})]}),e.jsxs(P,{onClick:()=>(e=>{var s;N(e),q(""),B((null==(s=e.user_profiles)?void 0:s.tier)||"Base"),D(!0)})(s),variant:"outline",size:"sm",children:[e.jsx(ls,{className:"w-4 h-4 mr-2"}),"Review"]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mt-4 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Goal"}),e.jsx("p",{className:"text-sm font-medium",children:H(s.primary_goal)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Target Weight"}),e.jsxs("p",{className:"text-sm font-medium",children:[s.target_weight_kg," kg"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Activity"}),e.jsx("p",{className:"text-sm font-medium capitalize",children:s.activity_level})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Deadline"}),e.jsx("p",{className:"text-sm font-medium",children:s.goal_deadline?Oe(new Date(s.goal_deadline),"MMM dd, yyyy"):"Not set"})]})]})]})]})},s.id)})}),e.jsx(S,{open:C,onOpenChange:D,children:e.jsxs(M,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(A,{children:[e.jsx($,{children:"Client Intake Form Review"}),e.jsx(L,{children:"Review the client's health information and assign them to your practice"})]}),b&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-muted rounded-lg",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center",children:(null==(s=b.user_profiles)?void 0:s.avatar_url)?e.jsx("img",{src:b.user_profiles.avatar_url,alt:b.user_profiles.full_name,className:"w-16 h-16 rounded-full object-cover"}):e.jsx("span",{className:"text-primary font-bold text-2xl",children:(null==(a=null==(t=b.user_profiles)?void 0:t.full_name)?void 0:a.charAt(0))||"?"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-xl",children:null==(l=b.user_profiles)?void 0:l.full_name}),e.jsx("p",{className:"text-text-secondary",children:null==(i=b.user_profiles)?void 0:i.email}),e.jsxs(y,{className:"mt-2",children:[b.age," years old â€¢ ",b.gender]})]})]}),e.jsxs(Dt,{defaultValue:"personal",className:"w-full",children:[e.jsxs(Pt,{className:"grid w-full grid-cols-4",children:[e.jsx(Mt,{value:"personal",children:"Personal"}),e.jsx(Mt,{value:"health",children:"Health"}),e.jsx(Mt,{value:"lifestyle",children:"Lifestyle"}),e.jsx(Mt,{value:"goals",children:"Goals"})]}),e.jsx(At,{value:"personal",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Height"}),e.jsxs("p",{className:"text-lg",children:[b.height_cm," cm"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Current Weight"}),e.jsxs("p",{className:"text-lg",children:[b.current_weight_kg," kg"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Target Weight"}),e.jsxs("p",{className:"text-lg",children:[b.target_weight_kg," kg"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"BMI"}),e.jsx("p",{className:"text-lg",children:(b.current_weight_kg/(b.height_cm/100)**2).toFixed(1)})]})]})}),e.jsxs(At,{value:"health",className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Medical Conditions"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:(null==(r=b.medical_conditions)?void 0:r.length)>0?b.medical_conditions.map((s,t)=>e.jsx(y,{variant:"outline",children:s},t)):e.jsx("p",{className:"text-text-secondary",children:"None reported"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Allergies"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:(null==(n=b.allergies)?void 0:n.length)>0?b.allergies.map((s,t)=>e.jsx(y,{variant:"outline",children:s},t)):e.jsx("p",{className:"text-text-secondary",children:"None reported"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Medications"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:(null==(c=b.medications)?void 0:c.length)>0?b.medications.map((s,t)=>e.jsx(y,{variant:"outline",children:s},t)):e.jsx("p",{className:"text-text-secondary",children:"None reported"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Dietary Restrictions"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:(null==(d=b.dietary_restrictions)?void 0:d.length)>0?b.dietary_restrictions.map((s,t)=>e.jsx(y,{variant:"outline",children:s},t)):e.jsx("p",{className:"text-text-secondary",children:"None"})})]})]}),e.jsx(At,{value:"lifestyle",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Activity Level"}),e.jsx("p",{className:"text-lg",children:(Y=b.activity_level,{sedentary:"Sedentary (Little to no exercise)",light:"Light (1-3 days/week)",moderate:"Moderate (3-5 days/week)",very_active:"Very Active (6-7 days/week)",extremely_active:"Extremely Active (2x/day)"}[Y]||Y)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Sleep Hours"}),e.jsxs("p",{className:"text-lg",children:[b.sleep_hours," hours/night"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Stress Level"}),e.jsx(y,{variant:"high"===b.stress_level?"destructive":"secondary",children:b.stress_level})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Water Intake"}),e.jsxs("p",{className:"text-lg",children:[b.water_intake_liters," L/day"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Cooking Skill"}),e.jsx("p",{className:"text-lg capitalize",children:b.cooking_skill_level})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Weekly Budget"}),e.jsxs("p",{className:"text-lg",children:["$",b.budget_per_week]})]})]})}),e.jsxs(At,{value:"goals",className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Primary Goal"}),e.jsx("p",{className:"text-lg",children:H(b.primary_goal)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Goal Deadline"}),e.jsx("p",{className:"text-lg",children:b.goal_deadline?Oe(new Date(b.goal_deadline),"MMMM dd, yyyy"):"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Motivation Level"}),e.jsx(y,{variant:"high"===b.motivation_level?"success":"secondary",children:b.motivation_level})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Previous Diet Experience"}),e.jsx("p",{className:"text-sm mt-2 p-3 bg-muted rounded",children:b.previous_diet_experience||"None provided"})]})]})]}),"pending"===b.status&&e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-semibold",children:"Assignment Details"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Assign Tier"}),e.jsx("div",{className:"flex gap-2 mt-2",children:["Base","Premium","Elite"].map(s=>e.jsx(P,{variant:O===s?"default":"outline",onClick:()=>B(s),size:"sm",children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Review Notes (Optional)"}),e.jsx(R,{placeholder:"Add any notes about this client...",value:I,onChange:e=>q(e.target.value),rows:3})]})]})]}),e.jsxs(T,{children:["pending"===(null==b?void 0:b.status)&&e.jsxs(e.Fragment,{children:[e.jsxs(P,{variant:"outline",onClick:async()=>{if(b)try{const{error:e}=await _.from("client_intake_forms").update({status:"rejected",reviewed_at:(new Date).toISOString(),reviewed_by:o.id}).eq("id",b.id);if(e)throw e;await _.rpc("create_notification",{p_user_id:b.client_id,p_type:"new_client",p_title:"Intake Form Update",p_message:"Your intake form needs additional information. Please update and resubmit.",p_action_url:"/app/survey",p_priority:"normal"}),await G(),D(!1)}catch(e){alert("Failed to reject form. Please try again.")}},children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),"Reject"]}),e.jsxs(P,{onClick:async()=>{if(b)try{const{error:e}=await _.from("client_intake_forms").update({status:"approved",reviewed_at:(new Date).toISOString(),reviewed_by:o.id}).eq("id",b.id);if(e)throw e;const{error:s}=await _.from("nutritionist_client_assignments").insert({nutritionist_id:o.id,client_id:b.client_id,tier:O,notes:I,status:"active"});if(s&&!s.message.includes("duplicate"))throw s;await _.rpc("create_notification",{p_user_id:b.client_id,p_type:"new_client",p_title:"Welcome to GreenoFig!",p_message:`You've been assigned to ${o.full_name}. Let's start your transformation journey!`,p_action_url:"/app/messages",p_priority:"high"}),await G(),D(!1)}catch(e){alert("Failed to approve form. Please try again.")}},children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Approve & Assign"]})]}),"pending"!==(null==b?void 0:b.status)&&e.jsx(P,{variant:"outline",onClick:()=>D(!1),children:"Close"})]})]})})]});var Y},Ga=({clientId:s})=>{const{user:t,userProfile:a}=w(),{sendPushToUser:l}=C(),[i,r]=g.useState([]),[n,c]=g.useState(null),[d,o]=g.useState(!1),[m,x]=g.useState(!1),[u,h]=g.useState(!0),[p,j]=g.useState([]),[f,v]=g.useState({goal_type:"weight",title:"",description:"",target_value:"",current_value:"",unit:"kg",difficulty:"moderate",priority:"medium",start_date:(new Date).toISOString().split("T")[0],target_date:""});g.useEffect(()=>{s&&b()},[s]);const b=async()=>{h(!0);try{const{data:e,error:t}=await _.from("client_goals").select("*").eq("client_id",s).order("created_at",{ascending:!1});if(t)throw t;r(e||[])}catch(e){}finally{h(!1)}},N=async(e,t)=>{try{const n={status:t};"completed"===t&&(n.completed_at=(new Date).toISOString(),n.progress_percentage=100);const{error:c}=await _.from("client_goals").update(n).eq("id",e);if(c)throw c;if("completed"===t){const t=i.find(s=>s.id===e);try{await _.rpc("create_notification",{p_user_id:s,p_type:"achievement",p_title:"Goal Achieved! ðŸŽ‰",p_message:`Congratulations on completing: ${t.title}`,p_action_url:"/app/progress",p_priority:"high"})}catch(a){await _.from("notifications").insert({user_id:s,type:"achievement",title:"Goal Achieved! ðŸŽ‰",message:`Congratulations on completing: ${t.title}`,is_read:!1})}l(s,"ðŸ† Goal Achieved!",`Congratulations on completing: ${t.title}`,{tag:"greenofig-achievement",data:{type:"achievement",url:"/app/progress"}});try{await _.from("client_achievements").insert({client_id:s,achievement_type:"first_goal_completed",title:"Goal Achiever",description:`Completed goal: ${t.title}`,icon:"trophy",points:100})}catch(r){}}await b()}catch(n){}},k=e=>ue(new Date(e),new Date),D=()=>{v({goal_type:"weight",title:"",description:"",target_value:"",current_value:"",unit:"kg",difficulty:"moderate",priority:"medium",start_date:(new Date).toISOString().split("T")[0],target_date:""}),x(!1)},F=s=>{switch(s){case"active":return e.jsx(Re,{className:"w-4 h-4 text-blue-500"});case"completed":return e.jsx(Me,{className:"w-4 h-4 text-green-500"});case"paused":return e.jsx(Pe,{className:"w-4 h-4 text-yellow-500"});case"cancelled":case"failed":return e.jsx(Ee,{className:"w-4 h-4 text-red-500"});default:return e.jsx(ae,{className:"w-4 h-4 text-gray-500"})}},z=e=>{switch(e){case"critical":return"text-red-600";case"high":return"text-orange-600";case"medium":return"text-yellow-600";default:return"text-gray-600"}},I=e=>{c(e),(async e=>{try{const{data:s,error:t}=await _.from("goal_progress_updates").select("*").eq("goal_id",e).order("created_at",{ascending:!0});if(t)throw t;const a=s.map(e=>({date:Oe(new Date(e.created_at),"MMM dd"),value:parseFloat(e.current_value),mood:e.mood}));j(a)}catch(s){}})(e.id),x(!1),o(!0)},q=()=>{D(),c(null),x(!0),o(!0)};return u?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(ae,{className:"w-6 h-6 text-primary"}),"Goal Management"]}),e.jsx("p",{className:"text-text-secondary mt-1",children:"Track and manage client goals"})]}),e.jsxs(P,{onClick:q,children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Create Goal"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(V,{children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Active Goals"}),e.jsx("p",{className:"text-2xl font-bold",children:i.filter(e=>"active"===e.status).length})]}),e.jsx(Re,{className:"w-8 h-8 text-blue-500"})]})})}),e.jsx(V,{children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:i.filter(e=>"completed"===e.status).length})]}),e.jsx(Me,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(V,{children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Avg Progress"}),e.jsxs("p",{className:"text-2xl font-bold",children:[i.length>0?Math.round(i.reduce((e,s)=>e+(s.progress_percentage||0),0)/i.length):0,"%"]})]}),e.jsx(Fe,{className:"w-8 h-8 text-purple-500"})]})})}),e.jsx(V,{children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Achievements"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:100*i.filter(e=>"completed"===e.status).length})]}),e.jsx(ts,{className:"w-8 h-8 text-yellow-500"})]})})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:0===i.length?e.jsx(V,{children:e.jsxs(K,{className:"pt-12 pb-12 text-center",children:[e.jsx(ae,{className:"w-12 h-12 text-text-secondary mx-auto mb-4"}),e.jsx("p",{className:"text-text-secondary mb-4",children:"No goals set yet"}),e.jsxs(P,{onClick:q,children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Create First Goal"]})]})}):i.map(s=>{const t=s.progress_percentage||(e=>{if(!e.target_value||!e.current_value)return 0;const s=parseFloat(e.current_value),t=parseFloat(e.target_value),a=parseFloat(e.current_value);return"weight"===e.goal_type&&s>t?Math.min(100,Math.max(0,(s-a)/(s-t)*100)):Math.min(100,Math.max(0,(a-s)/(t-s)*100))})(s),a=k(s.target_date),l=a<0&&"active"===s.status;return e.jsx(V,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(K,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[F(s.status),e.jsx("h3",{className:"font-semibold text-lg",children:s.title}),e.jsx(y,{variant:"completed"===s.status?"success":"active"===s.status?"default":"secondary",children:s.status}),e.jsxs(y,{variant:"outline",className:z(s.priority),children:[s.priority," priority"]})]}),s.description&&e.jsx("p",{className:"text-sm text-text-secondary mb-3",children:s.description})]}),e.jsxs(P,{variant:"outline",size:"sm",onClick:()=>I(s),children:[e.jsx(ls,{className:"w-4 h-4 mr-2"}),"View"]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-text-secondary",children:"Progress"}),e.jsxs("span",{className:"font-semibold",children:[Math.round(t),"%"]})]}),e.jsx(yt,{value:t,className:"h-2"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Current"}),e.jsxs("p",{className:"text-sm font-semibold",children:[s.current_value," ",s.unit]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Target"}),e.jsxs("p",{className:"text-sm font-semibold",children:[s.target_value," ",s.unit]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-text-secondary",children:l?"Overdue by":"Days left"}),e.jsxs("p",{className:"text-sm font-semibold "+(l?"text-red-600":""),children:[Math.abs(a)," days"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Deadline"}),e.jsx("p",{className:"text-sm font-semibold",children:Oe(new Date(s.target_date),"MMM dd")})]})]}),"active"===s.status&&e.jsxs("div",{className:"flex gap-2 mt-4 pt-4 border-t",children:[e.jsxs(P,{variant:"outline",size:"sm",onClick:()=>N(s.id,"paused"),children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Pause"]}),e.jsxs(P,{variant:"default",size:"sm",onClick:()=>N(s.id,"completed"),children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Mark Complete"]})]})]})},s.id)})}),e.jsx(S,{open:d,onOpenChange:o,children:e.jsxs(M,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(A,{children:[e.jsx($,{children:m?"Create New Goal":"Goal Details"}),e.jsx(L,{children:m?"Set a SMART goal for your client":"View and manage goal progress"})]}),m?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Goal Type"}),e.jsxs(wt,{value:f.goal_type,onValueChange:e=>v({...f,goal_type:e}),children:[e.jsx(_t,{children:e.jsx(kt,{})}),e.jsxs(Ct,{children:[e.jsx(St,{value:"weight",children:"Weight"}),e.jsx(St,{value:"body_fat",children:"Body Fat %"}),e.jsx(St,{value:"muscle_mass",children:"Muscle Mass"}),e.jsx(St,{value:"measurements",children:"Measurements"}),e.jsx(St,{value:"habit",children:"Habit Building"}),e.jsx(St,{value:"nutrition",children:"Nutrition Goal"}),e.jsx(St,{value:"fitness",children:"Fitness Goal"}),e.jsx(St,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Unit"}),e.jsx(E,{value:f.unit,onChange:e=>v({...f,unit:e.target.value}),placeholder:"kg, %, cm, etc."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Goal Title"}),e.jsx(E,{value:f.title,onChange:e=>v({...f,title:e.target.value}),placeholder:"e.g., Lose 10kg in 3 months"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Description"}),e.jsx(R,{value:f.description,onChange:e=>v({...f,description:e.target.value}),placeholder:"Detailed goal description...",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Current Value"}),e.jsx(E,{type:"number",step:"0.01",value:f.current_value,onChange:e=>v({...f,current_value:e.target.value}),placeholder:"75.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Target Value"}),e.jsx(E,{type:"number",step:"0.01",value:f.target_value,onChange:e=>v({...f,target_value:e.target.value}),placeholder:"65.0"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Start Date"}),e.jsx(E,{type:"date",value:f.start_date,onChange:e=>v({...f,start_date:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Target Date"}),e.jsx(E,{type:"date",value:f.target_date,onChange:e=>v({...f,target_date:e.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Difficulty"}),e.jsxs(wt,{value:f.difficulty,onValueChange:e=>v({...f,difficulty:e}),children:[e.jsx(_t,{children:e.jsx(kt,{})}),e.jsxs(Ct,{children:[e.jsx(St,{value:"easy",children:"Easy"}),e.jsx(St,{value:"moderate",children:"Moderate"}),e.jsx(St,{value:"challenging",children:"Challenging"}),e.jsx(St,{value:"very_challenging",children:"Very Challenging"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Priority"}),e.jsxs(wt,{value:f.priority,onValueChange:e=>v({...f,priority:e}),children:[e.jsx(_t,{children:e.jsx(kt,{})}),e.jsxs(Ct,{children:[e.jsx(St,{value:"low",children:"Low"}),e.jsx(St,{value:"medium",children:"Medium"}),e.jsx(St,{value:"high",children:"High"}),e.jsx(St,{value:"critical",children:"Critical"})]})]})]})]})]}):n&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[F(n.status),e.jsx("h3",{className:"font-bold text-xl",children:n.title}),e.jsx(y,{variant:"completed"===n.status?"success":"default",children:n.status})]}),n.description&&e.jsx("p",{className:"text-sm text-text-secondary",children:n.description})]}),p.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Progress Chart"}),e.jsx(ie,{width:"100%",height:300,children:e.jsxs(re,{data:p,children:[e.jsx(ne,{strokeDasharray:"3 3"}),e.jsx(ce,{dataKey:"date"}),e.jsx(de,{}),e.jsx(oe,{}),e.jsx(ds,{y:parseFloat(n.target_value),label:"Target",stroke:"green",strokeDasharray:"3 3"}),e.jsx(xe,{type:"monotone",dataKey:"value",stroke:"#10b981",strokeWidth:2,dot:{r:4}})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("p",{className:"text-sm text-text-secondary mb-1",children:"Current Value"}),e.jsxs("p",{className:"text-2xl font-bold",children:[n.current_value," ",n.unit]})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("p",{className:"text-sm text-text-secondary mb-1",children:"Target Value"}),e.jsxs("p",{className:"text-2xl font-bold",children:[n.target_value," ",n.unit]})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("p",{className:"text-sm text-text-secondary mb-1",children:"Progress"}),e.jsxs("p",{className:"text-2xl font-bold",children:[n.progress_percentage||0,"%"]})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("p",{className:"text-sm text-text-secondary mb-1",children:"Days Remaining"}),e.jsxs("p",{className:"text-2xl font-bold",children:[k(n.target_date)," days"]})]})]})]}),e.jsx(T,{children:m?e.jsxs(e.Fragment,{children:[e.jsx(P,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsx(P,{onClick:async()=>{try{const{error:i}=await _.from("client_goals").insert({client_id:s,nutritionist_id:t.id,...f,target_value:parseFloat(f.target_value),current_value:parseFloat(f.current_value)});if(i)throw i;try{await _.rpc("create_notification",{p_user_id:s,p_type:"goal_milestone",p_title:"New Goal Set!",p_message:`Your nutritionist set a new goal: ${f.title}`,p_action_url:"/app/progress",p_priority:"normal"})}catch(e){await _.from("notifications").insert({user_id:s,type:"goal",title:"New Goal Set!",message:`Your nutritionist set a new goal: ${f.title}`,is_read:!1})}const r=(null==a?void 0:a.full_name)||"Your Nutritionist";l(s,"ðŸŽ¯ New Goal Set!",`${r} set a new goal for you: ${f.title}`,{tag:"greenofig-goal",data:{type:"goal",url:"/app/progress"}}),await b(),o(!1),D()}catch(i){alert("Failed to create goal")}},children:"Create Goal"})]}):e.jsx(P,{variant:"outline",onClick:()=>o(!1),children:"Close"})})]})})]})},Wa=({onSelectRecipe:s})=>{const{user:t}=w(),[a,l]=g.useState([]),[i,r]=g.useState([]),[n,c]=g.useState(""),[d,o]=g.useState("all"),[m,x]=g.useState(!1),[u,h]=g.useState(null),[p,j]=g.useState(!0),[f,v]=g.useState(!1),[b,N]=g.useState({name:"",description:"",category:"breakfast",servings:1,prep_time_minutes:0,cook_time_minutes:0,ingredients:[{name:"",amount:"",unit:""}],instructions:[""],calories_per_serving:0,protein_g:0,carbs_g:0,fat_g:0,fiber_g:0,tags:[],is_public:!1}),k=["breakfast","lunch","dinner","snack","dessert"];g.useEffect(()=>{C()},[t]),g.useEffect(()=>{D()},[n,d,a]);const C=async()=>{j(!0);try{const{data:e,error:s}=await _.from("recipes").select("*").or(`nutritionist_id.eq.${t.id},is_public.eq.true`).order("created_at",{ascending:!1});if(s)throw s;l(e||[])}catch(e){F({variant:"destructive",title:"Error",description:"Failed to fetch recipes"})}finally{j(!1)}},D=()=>{let e=a;n&&(e=e.filter(e=>{var s,t;return(null==(s=e.name)?void 0:s.toLowerCase().includes(n.toLowerCase()))||(null==(t=e.description)?void 0:t.toLowerCase().includes(n.toLowerCase()))})),"all"!==d&&(e=e.filter(e=>e.category===d)),r(e)},z=(e=null)=>{e?(h(e),N({...e,ingredients:e.ingredients||[{name:"",amount:"",unit:""}],instructions:e.instructions||[""],tags:e.tags||[]})):(h(null),N({name:"",description:"",category:"breakfast",servings:1,prep_time_minutes:0,cook_time_minutes:0,ingredients:[{name:"",amount:"",unit:""}],instructions:[""],calories_per_serving:0,protein_g:0,carbs_g:0,fat_g:0,fiber_g:0,tags:[],is_public:!1})),x(!0)},I=(e,s,t)=>{const a=[...b.ingredients];a[e][s]=t,N({...b,ingredients:a})},L=({recipe:a})=>{var l;return e.jsx(V,{className:"glass-effect hover:shadow-lg transition-all cursor-pointer group",children:e.jsxs(K,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",onClick:()=>s&&s(a),children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:a.description})]}),e.jsxs("div",{className:"flex gap-1 ml-2",children:[e.jsx(P,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),z(a)},children:e.jsx(Ae,{className:"w-4 h-4"})}),a.nutritionist_id===t.id&&e.jsx(P,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),(async e=>{if(confirm("Are you sure you want to delete this recipe?"))try{const{error:s}=await _.from("recipes").delete().eq("id",e);if(s)throw s;F({title:"Recipe deleted successfully"}),C()}catch(s){F({variant:"destructive",title:"Error",description:"Failed to delete recipe"})}})(a.id)},className:"text-destructive hover:text-destructive",children:e.jsx($e,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx(y,{variant:"outline",className:"capitalize",children:a.category}),null==(l=a.tags)?void 0:l.slice(0,2).map(s=>e.jsx(y,{variant:"secondary",children:s},s))]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Pe,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:[(a.prep_time_minutes||0)+(a.cook_time_minutes||0)," min"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(te,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:[a.servings," servings"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Je,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:[a.calories_per_serving||0," cal"]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[a.protein_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Protein"})]}),e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[a.carbs_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Carbs"})]}),e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[a.fat_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Fat"})]}),e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[a.fiber_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Fiber"})]})]})]})})};return p?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(os,{className:"w-8 h-8 text-primary"}),"Recipe Database"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Create and manage your recipe library"})]}),e.jsxs(P,{onClick:()=>z(),children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"New Recipe"]})]}),e.jsx(V,{className:"glass-effect",children:e.jsx(K,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(E,{placeholder:"Search recipes...",value:n,onChange:e=>c(e.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(P,{variant:"all"===d?"default":"outline",onClick:()=>o("all"),size:"sm",children:"All"}),k.map(s=>e.jsx(P,{variant:d===s?"default":"outline",onClick:()=>o(s),size:"sm",className:"capitalize",children:s},s))]})]})})}),i.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map(s=>e.jsx(L,{recipe:s},s.id))}):e.jsx(V,{className:"glass-effect",children:e.jsxs(K,{className:"p-12 text-center",children:[e.jsx(os,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No recipes found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:n||"all"!==d?"Try adjusting your filters":"Create your first recipe to get started"}),e.jsxs(P,{onClick:()=>z(),children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Create Recipe"]})]})}),e.jsx(S,{open:m,onOpenChange:x,children:e.jsxs(M,{className:"glass-effect custom-scrollbar max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(A,{children:e.jsx($,{children:u?"Edit Recipe":"Create New Recipe"})}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Recipe Name *"}),e.jsx(E,{value:b.name,onChange:e=>N({...b,name:e.target.value}),placeholder:"e.g., Grilled Chicken Salad"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Description"}),e.jsx(R,{value:b.description,onChange:e=>N({...b,description:e.target.value}),placeholder:"Brief description of the recipe",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Category"}),e.jsx("select",{value:b.category,onChange:e=>N({...b,category:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:k.map(s=>e.jsx("option",{value:s,className:"capitalize",children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Servings"}),e.jsx(E,{type:"number",min:"1",value:b.servings,onChange:e=>N({...b,servings:parseInt(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Prep Time (min)"}),e.jsx(E,{type:"number",min:"0",value:b.prep_time_minutes,onChange:e=>N({...b,prep_time_minutes:parseInt(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Cook Time (min)"}),e.jsx(E,{type:"number",min:"0",value:b.cook_time_minutes,onChange:e=>N({...b,cook_time_minutes:parseInt(e.target.value)})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Nutrition (per serving)"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Calories"}),e.jsx(E,{type:"number",step:"0.1",value:b.calories_per_serving,onChange:e=>N({...b,calories_per_serving:parseFloat(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Protein (g)"}),e.jsx(E,{type:"number",step:"0.1",value:b.protein_g,onChange:e=>N({...b,protein_g:parseFloat(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Carbs (g)"}),e.jsx(E,{type:"number",step:"0.1",value:b.carbs_g,onChange:e=>N({...b,carbs_g:parseFloat(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Fat (g)"}),e.jsx(E,{type:"number",step:"0.1",value:b.fat_g,onChange:e=>N({...b,fat_g:parseFloat(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Fiber (g)"}),e.jsx(E,{type:"number",step:"0.1",value:b.fiber_g,onChange:e=>N({...b,fiber_g:parseFloat(e.target.value)})})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold",children:"Ingredients"}),e.jsxs(P,{onClick:()=>{N({...b,ingredients:[...b.ingredients,{name:"",amount:"",unit:""}]})},size:"sm",variant:"outline",children:[e.jsx(Ce,{className:"w-4 h-4 mr-1"}),"Add"]})]}),e.jsx("div",{className:"space-y-2",children:b.ingredients.map((s,t)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{placeholder:"Ingredient name",value:s.name,onChange:e=>I(t,"name",e.target.value),className:"flex-1"}),e.jsx(E,{placeholder:"Amount",value:s.amount,onChange:e=>I(t,"amount",e.target.value),className:"w-24"}),e.jsx(E,{placeholder:"Unit",value:s.unit,onChange:e=>I(t,"unit",e.target.value),className:"w-24"}),e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>(e=>{N({...b,ingredients:b.ingredients.filter((s,t)=>t!==e)})})(t),disabled:1===b.ingredients.length,children:e.jsx(be,{className:"w-4 h-4"})})]},t))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold",children:"Instructions"}),e.jsxs(P,{onClick:()=>{N({...b,instructions:[...b.instructions,""]})},size:"sm",variant:"outline",children:[e.jsx(Ce,{className:"w-4 h-4 mr-1"}),"Add Step"]})]}),e.jsx("div",{className:"space-y-2",children:b.instructions.map((s,t)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-sm font-medium text-muted-foreground pt-2",children:[t+1,"."]}),e.jsx(R,{placeholder:"Instruction step",value:s,onChange:e=>((e,s)=>{const t=[...b.instructions];t[e]=s,N({...b,instructions:t})})(t,e.target.value),rows:2,className:"flex-1"}),e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>(e=>{N({...b,instructions:b.instructions.filter((s,t)=>t!==e)})})(t),disabled:1===b.instructions.length,children:e.jsx(be,{className:"w-4 h-4"})})]},t))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["vegetarian","vegan","gluten-free","dairy-free","high-protein","low-carb","keto","paleo"].map(s=>e.jsx(y,{variant:b.tags.includes(s)?"default":"outline",className:"cursor-pointer",onClick:()=>(e=>{const s=b.tags.includes(e)?b.tags.filter(s=>s!==e):[...b.tags,e];N({...b,tags:s})})(s),children:s},s))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"is_public",checked:b.is_public,onChange:e=>N({...b,is_public:e.target.checked}),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"is_public",className:"text-sm font-medium",children:"Make this recipe public (visible to other nutritionists)"})]})]}),e.jsxs(T,{children:[e.jsx(P,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsxs(P,{onClick:async()=>{if(b.name){v(!0);try{const e={...b,nutritionist_id:t.id,ingredients:b.ingredients.filter(e=>e.name),instructions:b.instructions.filter(e=>e.trim())};if(u){const{error:s}=await _.from("recipes").update(e).eq("id",u.id);if(s)throw s;F({title:"Recipe updated successfully"})}else{const{error:s}=await _.from("recipes").insert(e);if(s)throw s;F({title:"Recipe created successfully"})}x(!1),C()}catch(e){F({variant:"destructive",title:"Error",description:"Failed to save recipe"})}finally{v(!1)}}else F({variant:"destructive",title:"Error",description:"Recipe name is required"})},disabled:f,children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),f?"Saving...":"Save Recipe"]})]})]})})]})},Ua=({onPlanGenerated:s,onClose:t})=>{const{user:a}=w(),[l,i]=g.useState(1),[r,n]=g.useState(!1),[c,d]=g.useState(!1),[o,m]=g.useState([]),[x,u]=g.useState(null),[h,p]=g.useState(null),[j,f]=g.useState(null),[b,N]=g.useState({duration_days:7,meals_per_day:3,include_snacks:!0,cuisine_preferences:[],exclude_ingredients:[],budget:"moderate",prep_time:"medium",goal_focus:"balanced"}),k=["Mediterranean","Asian","Mexican","Indian","American","Italian","Middle Eastern","Japanese","Thai","Greek"],C=[{value:"weight_loss",label:"Weight Loss",icon:ae},{value:"muscle_gain",label:"Muscle Gain",icon:Ve},{value:"maintenance",label:"Maintenance",icon:Ke},{value:"energy",label:"More Energy",icon:J}];g.useEffect(()=>{D()},[]);const D=async()=>{try{const{data:e,error:s}=await _.from("user_profiles").select("id, full_name, email, tier").eq("role","user").order("full_name");if(s)throw s;m(e||[])}catch(e){}},E=e=>{const{targetCalories:s,targetProtein:t,targetCarbs:a,targetFat:l,allergies:i,dietType:r,dislikedFoods:n,favoriteFoods:c,healthConditions:d,duration_days:o,meals_per_day:m,include_snacks:u,cuisine_preferences:h,budget:p,prep_time:g,goal_focus:j}=e,f={breakfast:[{name:"Greek Yogurt Parfait",calories:350,protein:20,carbs:45,fat:10,tags:["vegetarian","quick"],ingredients:["greek yogurt","berries","granola","honey"]},{name:"Overnight Oats",calories:400,protein:15,carbs:60,fat:12,tags:["vegetarian","vegan-option","quick"],ingredients:["oats","almond milk","chia seeds","banana"]},{name:"Egg White Veggie Omelette",calories:280,protein:25,carbs:10,fat:15,tags:["vegetarian","keto-friendly","quick"],ingredients:["egg whites","spinach","tomatoes","feta cheese"]},{name:"Avocado Toast with Eggs",calories:420,protein:18,carbs:35,fat:25,tags:["vegetarian"],ingredients:["whole grain bread","avocado","eggs","cherry tomatoes"]},{name:"Protein Smoothie Bowl",calories:380,protein:30,carbs:45,fat:8,tags:["vegetarian","quick"],ingredients:["protein powder","banana","spinach","almond butter"]},{name:"Smoked Salmon Bagel",calories:450,protein:28,carbs:40,fat:18,tags:["pescatarian"],ingredients:["whole wheat bagel","smoked salmon","cream cheese","capers"]},{name:"Quinoa Breakfast Bowl",calories:380,protein:14,carbs:55,fat:12,tags:["vegan","gluten-free"],ingredients:["quinoa","almond milk","walnuts","berries"]},{name:"Turkey Breakfast Wrap",calories:400,protein:32,carbs:30,fat:16,tags:["high-protein"],ingredients:["turkey","eggs","whole wheat wrap","spinach"]}],lunch:[{name:"Grilled Chicken Salad",calories:450,protein:40,carbs:20,fat:22,tags:["keto-friendly","high-protein"],ingredients:["chicken breast","mixed greens","avocado","olive oil"]},{name:"Quinoa Buddha Bowl",calories:520,protein:18,carbs:65,fat:20,tags:["vegan","high-fiber"],ingredients:["quinoa","chickpeas","roasted vegetables","tahini"]},{name:"Turkey & Avocado Wrap",calories:480,protein:35,carbs:35,fat:22,tags:["high-protein"],ingredients:["turkey breast","avocado","whole wheat wrap","lettuce"]},{name:"Mediterranean Grain Bowl",calories:500,protein:22,carbs:55,fat:20,tags:["vegetarian","mediterranean"],ingredients:["farro","feta","cucumber","olives","hummus"]},{name:"Tuna Poke Bowl",calories:480,protein:38,carbs:45,fat:16,tags:["pescatarian","asian"],ingredients:["ahi tuna","sushi rice","edamame","seaweed"]},{name:"Lentil Soup with Bread",calories:420,protein:20,carbs:60,fat:10,tags:["vegan","budget-friendly"],ingredients:["lentils","carrots","celery","whole grain bread"]},{name:"Chicken Caesar Wrap",calories:520,protein:38,carbs:32,fat:26,tags:["high-protein"],ingredients:["grilled chicken","romaine","parmesan","caesar dressing"]},{name:"Asian Salmon Salad",calories:480,protein:35,carbs:25,fat:28,tags:["pescatarian","asian","keto-friendly"],ingredients:["salmon","mixed greens","edamame","sesame dressing"]}],dinner:[{name:"Baked Salmon with Vegetables",calories:520,protein:42,carbs:25,fat:28,tags:["pescatarian","keto-friendly"],ingredients:["salmon fillet","asparagus","lemon","olive oil"]},{name:"Lean Beef Stir Fry",calories:480,protein:38,carbs:35,fat:20,tags:["asian","high-protein"],ingredients:["lean beef","broccoli","bell peppers","brown rice"]},{name:"Grilled Chicken with Sweet Potato",calories:550,protein:45,carbs:50,fat:15,tags:["high-protein","meal-prep"],ingredients:["chicken breast","sweet potato","green beans"]},{name:"Vegetable Curry with Rice",calories:480,protein:15,carbs:70,fat:16,tags:["vegan","indian"],ingredients:["chickpeas","coconut milk","mixed vegetables","basmati rice"]},{name:"Turkey Meatballs with Zucchini Noodles",calories:420,protein:38,carbs:20,fat:22,tags:["keto-friendly","italian"],ingredients:["ground turkey","zucchini","marinara sauce","parmesan"]},{name:"Shrimp & Vegetable Skewers",calories:380,protein:35,carbs:20,fat:18,tags:["pescatarian","mediterranean","quick"],ingredients:["shrimp","zucchini","bell peppers","quinoa"]},{name:"Herb Roasted Chicken",calories:520,protein:48,carbs:25,fat:26,tags:["high-protein","meal-prep"],ingredients:["chicken thighs","potatoes","carrots","rosemary"]},{name:"Black Bean Tacos",calories:450,protein:18,carbs:55,fat:18,tags:["vegetarian","mexican"],ingredients:["black beans","corn tortillas","avocado","salsa"]}],snack:[{name:"Apple with Almond Butter",calories:200,protein:6,carbs:25,fat:10,tags:["vegan","quick"],ingredients:["apple","almond butter"]},{name:"Greek Yogurt & Berries",calories:150,protein:15,carbs:18,fat:3,tags:["vegetarian","quick"],ingredients:["greek yogurt","mixed berries"]},{name:"Protein Energy Balls",calories:180,protein:8,carbs:20,fat:8,tags:["vegetarian","meal-prep"],ingredients:["oats","protein powder","honey","nut butter"]},{name:"Hummus & Veggies",calories:160,protein:6,carbs:18,fat:8,tags:["vegan","quick"],ingredients:["hummus","carrots","celery","cucumber"]},{name:"Cottage Cheese with Fruit",calories:180,protein:20,carbs:15,fat:4,tags:["vegetarian","high-protein"],ingredients:["cottage cheese","pineapple"]},{name:"Mixed Nuts",calories:200,protein:6,carbs:8,fat:18,tags:["vegan","keto-friendly","quick"],ingredients:["almonds","walnuts","cashews"]},{name:"Protein Shake",calories:180,protein:25,carbs:10,fat:4,tags:["quick","high-protein"],ingredients:["protein powder","almond milk","banana"]},{name:"Rice Cakes with Avocado",calories:170,protein:4,carbs:20,fat:10,tags:["vegan","quick"],ingredients:["rice cakes","avocado","sea salt"]}]},v=e=>e.filter(e=>{if(i.some(s=>e.ingredients.some(e=>e.toLowerCase().includes(s.toLowerCase()))))return!1;return!n.some(s=>e.ingredients.some(e=>e.toLowerCase().includes(s.toLowerCase())))&&(!("vegan"===r&&!e.tags.includes("vegan"))&&(!("vegetarian"===r&&!e.tags.includes("vegetarian")&&!e.tags.includes("vegan"))&&(("pescatarian"!==r||!e.ingredients.some(e=>["chicken","beef","pork","turkey","lamb"].some(s=>e.toLowerCase().includes(s))))&&!("keto"===r&&!e.tags.includes("keto-friendly")))))}),b=v(f.breakfast),N=v(f.lunch),y=v(f.dinner),w=v(f.snack),_=[],k=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];for(let x=0;x<o;x++){const e={day:k[x%7],dayNumber:x+1,meals:[]},s=b[Math.floor(Math.random()*b.length)]||f.breakfast[0];e.meals.push({type:"Breakfast",...s});const t=N[Math.floor(Math.random()*N.length)]||f.lunch[0];e.meals.push({type:"Lunch",...t});const a=y[Math.floor(Math.random()*y.length)]||f.dinner[0];if(e.meals.push({type:"Dinner",...a}),u){const s=w[Math.floor(Math.random()*w.length)]||f.snack[0],t=w[Math.floor(Math.random()*w.length)]||f.snack[1];e.meals.push({type:"Morning Snack",...s}),e.meals.push({type:"Afternoon Snack",...t})}e.totals={calories:e.meals.reduce((e,s)=>e+s.calories,0),protein:e.meals.reduce((e,s)=>e+s.protein,0),carbs:e.meals.reduce((e,s)=>e+s.carbs,0),fat:e.meals.reduce((e,s)=>e+s.fat,0)},_.push(e)}const C=new Set;return _.forEach(e=>{e.meals.forEach(e=>{e.ingredients.forEach(e=>C.add(e))})}),{client_id:x.id,client_name:x.full_name,duration_days:o,target_calories:s,target_protein:t,target_carbs:a,target_fat:l,diet_type:r,allergies:i,days:_,grocery_list:Array.from(C).sort(),generated_at:(new Date).toISOString()}};return e.jsx(S,{open:!0,onOpenChange:t,children:e.jsxs(M,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(A,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-primary"}),"AI Meal Plan Generator"]})}),e.jsx("div",{className:"flex items-center justify-center gap-2 my-4",children:[1,2,3].map(s=>e.jsxs(v.Fragment,{children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium "+(l>=s?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"),children:l>s?e.jsx(je,{className:"w-4 h-4"}):s}),s<3&&e.jsx("div",{className:"w-12 h-1 "+(l>s?"bg-primary":"bg-muted")})]},s))}),1===l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(J,{className:"w-12 h-12 mx-auto text-primary mb-2"}),e.jsx("h3",{className:"text-xl font-semibold",children:"Select a Client"}),e.jsx("p",{className:"text-muted-foreground",children:"Choose a client to generate a personalized meal plan"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-[400px] overflow-y-auto",children:o.map(s=>e.jsx(V,{className:"cursor-pointer transition-all hover:shadow-md "+((null==x?void 0:x.id)===s.id?"ring-2 ring-primary":""),onClick:()=>{(async e=>{n(!0);try{const{data:s,error:t}=await _.from("client_nutrition_profiles").select("*").eq("client_id",e).maybeSingle(),{data:a,error:l}=await _.from("user_profiles").select("*").eq("id",e).single();if(l)throw l;const i={...a,nutrition:s||null};p(i),u(a),s&&N(e=>({...e,meals_per_day:s.meals_per_day||3,include_snacks:s.snacks_per_day>0,budget:s.budget||"moderate",prep_time:"beginner"===s.cooking_skill?"quick":"advanced"===s.cooking_skill?"any":"medium",goal_focus:s.primary_goal||"balanced"}))}catch(s){F({variant:"destructive",title:"Error",description:"Failed to load client profile"})}finally{n(!1)}})(s.id)},children:e.jsxs(K,{className:"p-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(we,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:s.full_name}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s.email})]}),e.jsx(y,{variant:"outline",className:"text-xs",children:s.tier||"Base"}),(null==x?void 0:x.id)===s.id&&e.jsx(je,{className:"w-5 h-5 text-primary"})]})},s.id))}),r&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(Se,{className:"w-6 h-6 animate-spin mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Loading client profile..."})]}),h&&e.jsx(V,{className:"bg-primary/5 border-primary/20",children:e.jsxs(K,{className:"p-4",children:[e.jsxs("h4",{className:"font-semibold mb-2 flex items-center gap-2",children:[e.jsx(Ke,{className:"w-4 h-4 text-red-500"}),"Client Profile Summary"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Diet Type"}),e.jsx("p",{className:"font-medium capitalize",children:(null==(R=h.nutrition)?void 0:R.diet_type)||"Not set"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Goal"}),e.jsx("p",{className:"font-medium capitalize",children:(null==(L=null==(z=h.nutrition)?void 0:z.primary_goal)?void 0:L.replace("_"," "))||"Not set"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Allergies"}),e.jsxs("p",{className:"font-medium",children:[(null==(O=null==(q=h.nutrition)?void 0:q.allergies)?void 0:O.length)||0," listed"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Target Calories"}),e.jsxs("p",{className:"font-medium",children:[(null==(B=h.nutrition)?void 0:B.target_calories)||2e3," kcal"]})]})]}),(null==(W=null==(G=h.nutrition)?void 0:G.allergies)?void 0:W.length)>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-1",children:h.nutrition.allergies.map(s=>e.jsxs(y,{variant:"destructive",className:"text-xs",children:[e.jsx(ge,{className:"w-3 h-3 mr-1"}),s]},s))})]})})]}),2===l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(ae,{className:"w-12 h-12 mx-auto text-primary mb-2"}),e.jsx("h3",{className:"text-xl font-semibold",children:"Configure Meal Plan"}),e.jsxs("p",{className:"text-muted-foreground",children:["Customize the plan settings for ",null==x?void 0:x.full_name]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(I,{children:"Plan Duration"}),e.jsxs("select",{value:b.duration_days,onChange:e=>N({...b,duration_days:parseInt(e.target.value)}),className:"w-full mt-1 px-3 py-2 border rounded-md bg-background",children:[e.jsx("option",{value:7,children:"7 Days (1 Week)"}),e.jsx("option",{value:14,children:"14 Days (2 Weeks)"}),e.jsx("option",{value:21,children:"21 Days (3 Weeks)"}),e.jsx("option",{value:28,children:"28 Days (4 Weeks)"})]})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Meals Per Day"}),e.jsxs("select",{value:b.meals_per_day,onChange:e=>N({...b,meals_per_day:parseInt(e.target.value)}),className:"w-full mt-1 px-3 py-2 border rounded-md bg-background",children:[e.jsx("option",{value:3,children:"3 Meals"}),e.jsx("option",{value:4,children:"4 Meals"}),e.jsx("option",{value:5,children:"5 Meals"}),e.jsx("option",{value:6,children:"6 Meals"})]})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Budget Level"}),e.jsxs("select",{value:b.budget,onChange:e=>N({...b,budget:e.target.value}),className:"w-full mt-1 px-3 py-2 border rounded-md bg-background",children:[e.jsx("option",{value:"low",children:"Budget-Friendly"}),e.jsx("option",{value:"moderate",children:"Moderate"}),e.jsx("option",{value:"high",children:"No Limit"})]})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Prep Time Preference"}),e.jsxs("select",{value:b.prep_time,onChange:e=>N({...b,prep_time:e.target.value}),className:"w-full mt-1 px-3 py-2 border rounded-md bg-background",children:[e.jsx("option",{value:"quick",children:"Quick (under 20 min)"}),e.jsx("option",{value:"medium",children:"Medium (20-45 min)"}),e.jsx("option",{value:"any",children:"Any Duration"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($t,{id:"snacks",checked:b.include_snacks,onCheckedChange:e=>N({...b,include_snacks:e})}),e.jsx(I,{htmlFor:"snacks",children:"Include snacks between meals"})]}),e.jsxs("div",{children:[e.jsx(I,{className:"mb-2 block",children:"Goal Focus"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:C.map(s=>e.jsxs(P,{variant:b.goal_focus===s.value?"default":"outline",size:"sm",onClick:()=>N({...b,goal_focus:s.value}),className:"flex items-center gap-2",children:[e.jsx(s.icon,{className:"w-4 h-4"}),s.label]},s.value))})]}),e.jsxs("div",{children:[e.jsx(I,{className:"mb-2 block",children:"Cuisine Preferences (Optional)"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:k.map(s=>e.jsx(y,{variant:b.cuisine_preferences.includes(s)?"default":"outline",className:"cursor-pointer",onClick:()=>{const e=b.cuisine_preferences.includes(s)?b.cuisine_preferences.filter(e=>e!==s):[...b.cuisine_preferences,s];N({...b,cuisine_preferences:e})},children:s},s))})]})]}),3===l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(je,{className:"w-12 h-12 mx-auto text-green-500 mb-2"}),e.jsx("h3",{className:"text-xl font-semibold",children:"Meal Plan Generated!"}),e.jsx("p",{className:"text-muted-foreground",children:"Review the plan before saving"})]}),j&&e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"bg-primary/5",children:e.jsx(K,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:j.duration_days}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Days"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:j.target_calories}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Daily Calories"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[j.target_protein,"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Protein Target"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:j.grocery_list.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Grocery Items"})]})]})})}),e.jsxs("div",{className:"max-h-[300px] overflow-y-auto space-y-3",children:[j.days.slice(0,3).map((s,t)=>e.jsx(V,{children:e.jsxs(K,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"font-semibold",children:["Day ",s.dayNumber," - ",s.day]}),e.jsxs(y,{variant:"outline",children:[s.totals.calories," kcal"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-sm",children:s.meals.map((s,t)=>e.jsxs("div",{className:"p-2 bg-muted/50 rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:s.type}),e.jsx("p",{className:"font-medium truncate",children:s.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.calories," kcal"]})]},t))})]})},t)),j.days.length>3&&e.jsxs("p",{className:"text-center text-muted-foreground text-sm",children:["+ ",j.days.length-3," more days..."]})]})]})]}),e.jsxs(T,{className:"mt-6",children:[l>1&&e.jsx(P,{variant:"outline",onClick:()=>i(l-1),children:"Back"}),1===l&&e.jsxs(P,{onClick:()=>i(2),disabled:!h,children:["Next",e.jsx(fe,{className:"w-4 h-4 ml-1"})]}),2===l&&e.jsx(P,{onClick:async()=>{if(x&&h){d(!0);try{const e=h.nutrition||{},s=e.target_calories||2e3,t=e.target_protein_g||150,a=e.target_carbs_g||200,l=e.target_fat_g||65,r=E({targetCalories:s,targetProtein:t,targetCarbs:a,targetFat:l,allergies:e.allergies||[],dietType:e.diet_type||"omnivore",dislikedFoods:e.disliked_foods||[],favoriteFoods:e.favorite_foods||[],healthConditions:e.health_conditions||[],...b});f(r),i(3),F({title:"Meal Plan Generated!",description:`${b.duration_days}-day plan created for ${x.full_name}`})}catch(e){F({variant:"destructive",title:"Error",description:"Failed to generate meal plan"})}finally{d(!1)}}},disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"w-4 h-4 mr-2 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Generate Plan"]})}),3===l&&e.jsxs(e.Fragment,{children:[e.jsxs(P,{variant:"outline",onClick:()=>{i(2),f(null)},children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"Regenerate"]}),e.jsxs(P,{onClick:async()=>{if(j){n(!0);try{const e=new Date,l=new Date(e);l.setDate(l.getDate()+j.duration_days);const i={},r=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"];j.days.forEach((e,s)=>{const t=r[s%7];i[t]={},e.meals.forEach(e=>{const s=e.type.toLowerCase().replace(" ","_");i[t][s]={name:e.name,calories:e.calories,protein:e.protein,carbs:e.carbs,fat:e.fat,ingredients:e.ingredients}})});const n={client_id:j.client_id,nutritionist_id:a.id,name:`AI Generated Plan - ${x.full_name}`,description:`${j.duration_days}-day ${j.diet_type} meal plan generated by AI based on client profile`,start_date:e.toISOString().split("T")[0],end_date:l.toISOString().split("T")[0],target_calories:j.target_calories,target_protein_g:j.target_protein,target_carbs_g:j.target_carbs,target_fat_g:j.target_fat,meal_schedule:i,notes:`AI Generated. Allergies: ${j.allergies.join(", ")||"None"}. Diet: ${j.diet_type}`,status:"active"},{error:c}=await _.from("meal_plans_v2").insert(n);if(c)throw c;F({title:"Success!",description:"Meal plan saved successfully"}),s&&s(n),t&&t()}catch(e){F({variant:"destructive",title:"Error",description:"Failed to save meal plan"})}finally{n(!1)}}},disabled:r,children:[r?e.jsx(Se,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(He,{className:"w-4 h-4 mr-2"}),"Save Meal Plan"]})]})]})]})});var R,z,L,q,O,B,G,W},Va=({mealPlanId:s,onClose:t})=>{var a;const{user:l}=w(),[i,r]=g.useState(!0),[n,c]=g.useState(null),[d,o]=g.useState([]),[m,x]=g.useState({}),[u,h]=g.useState(""),[p,j]=g.useState(""),[f,v]=g.useState("all"),b={produce:{label:"Fruits & Vegetables",icon:ps,color:"text-green-500"},protein:{label:"Meat & Protein",icon:gs,color:"text-red-500"},dairy:{label:"Dairy & Eggs",icon:js,color:"text-blue-500"},grains:{label:"Grains & Bread",icon:fs,color:"text-amber-500"},seafood:{label:"Seafood",icon:vs,color:"text-cyan-500"},pantry:{label:"Pantry Items",icon:bs,color:"text-purple-500"},beverages:{label:"Beverages",icon:Ns,color:"text-brown-500"},other:{label:"Other",icon:xs,color:"text-gray-500"}},N={apple:"produce",banana:"produce",berries:"produce","mixed berries":"produce",spinach:"produce",kale:"produce",lettuce:"produce",romaine:"produce",tomatoes:"produce","cherry tomatoes":"produce",cucumber:"produce",avocado:"produce",broccoli:"produce","bell peppers":"produce",carrots:"produce",celery:"produce",onion:"produce",garlic:"produce",lemon:"produce",lime:"produce",orange:"produce",pineapple:"produce",asparagus:"produce",zucchini:"produce",mushrooms:"produce","sweet potato":"produce",potatoes:"produce","green beans":"produce","mixed greens":"produce","mixed vegetables":"produce","roasted vegetables":"produce",edamame:"produce","chicken breast":"protein",chicken:"protein","chicken thighs":"protein","grilled chicken":"protein",turkey:"protein","turkey breast":"protein","ground turkey":"protein","lean beef":"protein",beef:"protein",pork:"protein",lamb:"protein",bacon:"protein",tofu:"protein",tempeh:"protein",seitan:"protein",salmon:"seafood","salmon fillet":"seafood","smoked salmon":"seafood",tuna:"seafood","ahi tuna":"seafood",shrimp:"seafood",fish:"seafood",cod:"seafood",tilapia:"seafood",eggs:"dairy",egg:"dairy","egg whites":"dairy",milk:"dairy","almond milk":"dairy","oat milk":"dairy","greek yogurt":"dairy",yogurt:"dairy","cottage cheese":"dairy",cheese:"dairy","feta cheese":"dairy",feta:"dairy",parmesan:"dairy","cream cheese":"dairy",butter:"dairy",oats:"grains",quinoa:"grains",rice:"grains","brown rice":"grains","sushi rice":"grains","basmati rice":"grains",farro:"grains",bread:"grains","whole grain bread":"grains","whole wheat bread":"grains","whole wheat bagel":"grains","whole wheat wrap":"grains",tortillas:"grains","corn tortillas":"grains",pasta:"grains",granola:"grains","rice cakes":"grains","olive oil":"pantry","coconut oil":"pantry","sesame oil":"pantry",honey:"pantry","maple syrup":"pantry","nut butter":"pantry","almond butter":"pantry","peanut butter":"pantry",hummus:"pantry",tahini:"pantry",salsa:"pantry","marinara sauce":"pantry","soy sauce":"pantry",chickpeas:"pantry","black beans":"pantry",lentils:"pantry","chia seeds":"pantry",nuts:"pantry",almonds:"pantry",walnuts:"pantry",cashews:"pantry",capers:"pantry",olives:"pantry","protein powder":"pantry",seaweed:"pantry",rosemary:"pantry","sea salt":"pantry","caesar dressing":"pantry","sesame dressing":"pantry","coconut milk":"pantry",coffee:"beverages",tea:"beverages",water:"beverages"};g.useEffect(()=>{s&&k()},[s]);const k=async()=>{r(!0);try{const{data:e,error:t}=await _.from("meal_plans_v2").select("\n          *,\n          client:user_profiles!meal_plans_v2_client_id_fkey(full_name, email)\n        ").eq("id",s).single();if(t)throw t;c(e),C(e)}catch(e){F({variant:"destructive",title:"Error",description:"Failed to load meal plan"})}finally{r(!1)}},C=e=>{const s=new Map;e.meal_schedule&&Object.values(e.meal_schedule).forEach(e=>{Object.values(e).forEach(e=>{e&&e.ingredients&&e.ingredients.forEach(e=>{const t=e.toLowerCase().trim();if(s.has(t))s.set(t,{...s.get(t),count:s.get(t).count+1});else{const a=D(t);s.set(t,{id:crypto.randomUUID(),name:e,category:a,count:1,checked:!1})}})})});const t=Array.from(s.values()).sort((e,s)=>e.category===s.category?e.name.localeCompare(s.name):e.category.localeCompare(s.category));o(t)},D=e=>{const s=e.toLowerCase();if(N[s])return N[s];for(const[t,a]of Object.entries(N))if(s.includes(t)||t.includes(s))return a;return"other"},R=()=>{if(!u.trim())return;const e={id:crypto.randomUUID(),name:u.trim(),category:"other",count:1,isCustom:!0};o(s=>[...s,e]),h(""),F({title:"Item added"})},z=d.filter(e=>{const s=e.name.toLowerCase().includes(p.toLowerCase()),t="all"===f||e.category===f;return s&&t}).reduce((e,s)=>(e[s.category]||(e[s.category]=[]),e[s.category].push(s),e),{});return i?e.jsx(S,{open:!0,onOpenChange:t,children:e.jsx(M,{className:"max-w-2xl",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Se,{className:"w-8 h-8 animate-spin text-primary"})})})}):e.jsx(S,{open:!0,onOpenChange:t,children:e.jsxs(M,{className:"max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs(A,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(xs,{className:"w-5 h-5 text-primary"}),"Grocery List Generator"]}),n&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[n.name," - ",null==(a=n.client)?void 0:a.full_name]})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(E,{placeholder:"Search items...",value:p,onChange:e=>j(e.target.value),className:"pl-10"})]}),e.jsxs("select",{value:f,onChange:e=>v(e.target.value),className:"px-3 py-2 border rounded-md bg-background",children:[e.jsx("option",{value:"all",children:"All Categories"}),Object.entries(b).map(([s,t])=>e.jsx("option",{value:s,children:t.label},s))]})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx(E,{placeholder:"Add custom item...",value:u,onChange:e=>h(e.target.value),onKeyPress:e=>"Enter"===e.key&&R()}),e.jsx(P,{onClick:R,size:"sm",children:e.jsx(Ce,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-4 text-sm",children:[e.jsxs(y,{variant:"outline",children:[d.length," items total"]}),e.jsxs(y,{variant:"outline",className:"text-green-600",children:[Object.values(m).filter(Boolean).length," checked"]}),e.jsxs(y,{variant:"outline",className:"text-orange-600",children:[d.length-Object.values(m).filter(Boolean).length," remaining"]})]}),e.jsxs("div",{id:"grocery-list-content",className:"flex-1 overflow-y-auto space-y-4",children:[Object.entries(z).map(([s,t])=>{var a,l,i;const r=(null==(a=b[s])?void 0:a.icon)||xs;return e.jsxs(V,{children:[e.jsx(H,{className:"py-3",children:e.jsxs(Y,{className:"text-sm flex items-center gap-2",children:[e.jsx(r,{className:`w-4 h-4 ${(null==(l=b[s])?void 0:l.color)||""}`}),(null==(i=b[s])?void 0:i.label)||s,e.jsx(y,{variant:"secondary",className:"ml-auto",children:t.length})]})}),e.jsx(K,{className:"py-0 pb-3",children:e.jsx("div",{className:"space-y-1",children:t.map(s=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded hover:bg-muted/50 "+(m[s.id]?"opacity-50":""),children:[e.jsx($t,{checked:m[s.id]||!1,onCheckedChange:()=>{return e=s.id,void x(s=>({...s,[e]:!s[e]}));var e}}),e.jsx("span",{className:"flex-1 "+(m[s.id]?"line-through":""),children:s.name}),s.count>1&&e.jsxs(y,{variant:"outline",className:"text-xs",children:["x",s.count]}),s.isCustom&&e.jsx(P,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-destructive",onClick:()=>{return e=s.id,void o(s=>s.filter(s=>s.id!==e));var e},children:e.jsx($e,{className:"w-3 h-3"})})]},s.id))})})]},s)}),0===Object.keys(z).length&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(xs,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No items found"})]})]}),e.jsxs(T,{className:"mt-4 flex-wrap gap-2",children:[e.jsxs(P,{variant:"outline",onClick:()=>(e=>{var s,t;let a="";if("text"===e){a=`Grocery List for ${(null==(s=null==n?void 0:n.client)?void 0:s.full_name)||"Client"}\n`,a+=`${(null==n?void 0:n.name)||"Meal Plan"}\n`,a+=`Generated: ${(new Date).toLocaleDateString()}\n\n`,Object.entries(z).forEach(([e,s])=>{var t;a+=`\n--- ${(null==(t=b[e])?void 0:t.label)||e} ---\n`,s.forEach(e=>{const s=m[e.id]?"[x]":"[ ]";a+=`${s} ${e.name}${e.count>1?` (x${e.count})`:""}\n`})});const e=new Blob([a],{type:"text/plain"}),l=URL.createObjectURL(e),i=document.createElement("a");i.href=l,i.download=`grocery-list-${(null==(t=null==n?void 0:n.client)?void 0:t.full_name)||"client"}.txt`,i.click(),URL.revokeObjectURL(l)}F({title:"Grocery list exported!"})})("text"),children:[e.jsx(as,{className:"w-4 h-4 mr-2"}),"Export"]}),e.jsxs(P,{variant:"outline",onClick:()=>{var e,s;document.getElementById("grocery-list-content");const t=window.open("","_blank");t.document.write(`\n      <html>\n        <head>\n          <title>Grocery List - ${(null==(e=null==n?void 0:n.client)?void 0:e.full_name)||"Client"}</title>\n          <style>\n            body { font-family: Arial, sans-serif; padding: 20px; }\n            h1 { font-size: 24px; margin-bottom: 5px; }\n            h2 { font-size: 18px; color: #666; margin-bottom: 20px; }\n            h3 { font-size: 16px; margin-top: 20px; border-bottom: 1px solid #ddd; padding-bottom: 5px; }\n            ul { list-style: none; padding: 0; }\n            li { padding: 8px 0; border-bottom: 1px solid #eee; }\n            .checkbox { width: 18px; height: 18px; border: 2px solid #333; display: inline-block; margin-right: 10px; vertical-align: middle; }\n            .count { color: #888; font-size: 12px; }\n          </style>\n        </head>\n        <body>\n          <h1>Grocery List</h1>\n          <h2>${(null==n?void 0:n.name)||"Meal Plan"} - ${(null==(s=null==n?void 0:n.client)?void 0:s.full_name)||"Client"}</h2>\n          ${Object.entries(z).map(([e,s])=>{var t;return`\n            <h3>${(null==(t=b[e])?void 0:t.label)||e}</h3>\n            <ul>\n              ${s.map(e=>`\n                <li>\n                  <span class="checkbox"></span>\n                  ${e.name}\n                  ${e.count>1?`<span class="count">(x${e.count})</span>`:""}\n                </li>\n              `).join("")}\n            </ul>\n          `}).join("")}\n        </body>\n      </html>\n    `),t.document.close(),t.print()},children:[e.jsx(us,{className:"w-4 h-4 mr-2"}),"Print"]}),e.jsxs(P,{onClick:async()=>{if(null==n?void 0:n.client_id)try{let e="Here's your grocery list for the meal plan:\n\n";Object.entries(z).forEach(([s,t])=>{var a;e+=`**${(null==(a=b[s])?void 0:a.label)||s}**\n`,t.forEach(s=>{e+=`â€¢ ${s.name}${s.count>1?` (x${s.count})`:""}\n`}),e+="\n"});const{error:s}=await _.from("messages").insert({sender_id:l.id,recipient_id:n.client_id,body:e,created_at:(new Date).toISOString()});if(s)throw s;F({title:"Sent!",description:"Grocery list sent to client"})}catch(e){F({variant:"destructive",title:"Error",description:"Failed to send grocery list"})}},children:[e.jsx(hs,{className:"w-4 h-4 mr-2"}),"Send to Client"]})]})]})})},Ha=()=>{const{user:s,userProfile:t}=w(),{sendPushToUser:a}=C(),[l,i]=g.useState([]),[r,n]=g.useState([]),[c,d]=g.useState([]),[o,m]=g.useState([]),[x,u]=g.useState(""),[h,p]=g.useState("all"),[j,f]=g.useState(!1),[v,b]=g.useState(null),[N,k]=g.useState(!0),[D,z]=g.useState(!1),[I,L]=g.useState(!1),[q,O]=g.useState(null),[B,G]=g.useState(null),[W,U]=g.useState(!1),[Q,Z]=g.useState(null),[X,ee]=g.useState(!1),[se,le]=g.useState(!1),[ie,re]=g.useState(null),[ne,ce]=g.useState({client_id:"",name:"",description:"",start_date:"",end_date:"",target_calories:2e3,target_protein_g:150,target_carbs_g:200,target_fat_g:60,meal_schedule:{},notes:"",status:"active"}),de=["breakfast","lunch","dinner","snack"];g.useEffect(()=>{oe(),me(),xe()},[s]),g.useEffect(()=>{ue()},[x,h,l]);const oe=async()=>{k(!0);try{const{data:e,error:t}=await _.from("meal_plans_v2").select("\n          *,\n          client:user_profiles!meal_plans_v2_client_id_fkey(id, full_name, email)\n        ").eq("nutritionist_id",s.id).order("created_at",{ascending:!1});if(t)throw t;i(e||[])}catch(e){F({variant:"destructive",title:"Error",description:"Failed to fetch meal plans"})}finally{k(!1)}},me=async()=>{try{const{data:e,error:s}=await _.from("user_profiles").select("id, full_name, email").eq("role","user").order("full_name",{ascending:!0});if(s)throw s;d(e||[])}catch(e){}},xe=async()=>{try{const{data:e,error:s}=await _.from("tier_default_meal_plans").select("*").order("tier_name",{ascending:!0});if(s)throw s;n(e||[])}catch(e){}},ue=()=>{let e=l;x&&(e=e.filter(e=>{var s,t,a;return(null==(s=e.name)?void 0:s.toLowerCase().includes(x.toLowerCase()))||(null==(a=null==(t=e.client)?void 0:t.full_name)?void 0:a.toLowerCase().includes(x.toLowerCase()))})),"all"!==h&&(e=e.filter(e=>e.status===h)),m(e)},he=(e=null)=>{if(e)b(e),ce({client_id:e.client_id,name:e.name,description:e.description||"",start_date:e.start_date,end_date:e.end_date,target_calories:e.target_calories||2e3,target_protein_g:e.target_protein_g||150,target_carbs_g:e.target_carbs_g||200,target_fat_g:e.target_fat_g||60,meal_schedule:e.meal_schedule||{},notes:e.notes||"",status:e.status});else{b(null);const e=(new Date).toISOString().split("T")[0],s=new Date(Date.now()+6048e5).toISOString().split("T")[0];ce({client_id:"",name:"",description:"",start_date:e,end_date:s,target_calories:2e3,target_protein_g:150,target_carbs_g:200,target_fat_g:60,meal_schedule:{},notes:"",status:"active"})}f(!0)},pe=({plan:s})=>{const t=s.client,a=Math.ceil((new Date(s.end_date)-new Date(s.start_date))/864e5);return e.jsx(V,{className:"glass-effect hover:shadow-lg transition-all",children:e.jsxs(K,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(te,{className:"w-3 h-3"}),(null==t?void 0:t.full_name)||"Unknown Client"]})]}),e.jsx(y,{variant:"active"===s.status?"default":"secondary",children:s.status})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(ye,{className:"w-4 h-4"}),"Duration:"]}),e.jsxs("span",{className:"font-medium",children:[a," days"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(ae,{className:"w-4 h-4"}),"Daily Calories:"]}),e.jsxs("span",{className:"font-medium",children:[s.target_calories||0," kcal"]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4 text-xs",children:[e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[s.target_protein_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Protein"})]}),e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[s.target_carbs_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Carbs"})]}),e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[s.target_fat_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Fat"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(P,{variant:"outline",size:"sm",onClick:()=>he(s),className:"flex-1",children:[e.jsx(Ae,{className:"w-4 h-4 mr-1"}),"Edit"]}),e.jsx(P,{variant:"outline",size:"sm",onClick:()=>{re(s.id),le(!0)},title:"Generate Grocery List",children:e.jsx(xs,{className:"w-4 h-4"})}),e.jsx(P,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this meal plan?"))try{const{error:s}=await _.from("meal_plans_v2").delete().eq("id",e);if(s)throw s;F({title:"Meal plan deleted successfully"}),oe()}catch(s){F({variant:"destructive",title:"Error",description:"Failed to delete meal plan"})}})(s.id),className:"text-destructive",children:e.jsx($e,{className:"w-4 h-4"})})]})]})})};return N?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold flex items-center gap-2",children:[e.jsx(Te,{className:"w-6 h-6 sm:w-8 sm:h-8 text-primary"}),"Meal Planning"]}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mt-1",children:"Create and manage personalized meal plans"})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs(P,{variant:"outline",onClick:()=>ee(!0),className:"flex-1 sm:flex-none text-sm",children:[e.jsx(J,{className:"w-4 h-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"AI Generate"}),e.jsx("span",{className:"sm:hidden",children:"AI"})]}),e.jsxs(P,{onClick:()=>he(),className:"flex-1 sm:flex-none text-sm",children:[e.jsx(Ce,{className:"w-4 h-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"New Meal Plan"}),e.jsx("span",{className:"sm:hidden",children:"New"})]})]})]}),e.jsx(V,{className:"glass-effect",children:e.jsx(K,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(E,{placeholder:"Search meal plans...",value:x,onChange:e=>u(e.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-1 scrollbar-hide -mx-1 px-1",children:[e.jsxs(P,{variant:"all"===h?"default":"outline",onClick:()=>p("all"),size:"sm",className:"flex-shrink-0 text-xs sm:text-sm",children:["All (",l.length,")"]}),e.jsx(P,{variant:"active"===h?"default":"outline",onClick:()=>p("active"),size:"sm",className:"flex-shrink-0 text-xs sm:text-sm",children:"Active"}),e.jsx(P,{variant:"completed"===h?"default":"outline",onClick:()=>p("completed"),size:"sm",className:"flex-shrink-0 text-xs sm:text-sm",children:"Completed"}),e.jsx(P,{variant:"archived"===h?"default":"outline",onClick:()=>p("archived"),size:"sm",className:"flex-shrink-0 text-xs sm:text-sm",children:"Archived"})]})]})})}),e.jsxs(V,{className:"glass-effect",children:[e.jsxs(H,{className:"pb-2 sm:pb-4",children:[e.jsxs(Y,{className:"text-lg sm:text-xl font-bold flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Meal Plan Templates"]}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Pre-made meal plans for each tier that you can assign to clients"})]}),e.jsx(K,{className:"pt-0 sm:pt-2",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-4",children:r.map(s=>e.jsx(V,{className:"border-2 hover:border-primary transition-colors",children:e.jsxs(K,{className:"p-2 sm:p-4",children:[e.jsx("div",{className:"mb-2 sm:mb-3",children:e.jsx(y,{variant:"Base"===s.tier_name?"secondary":("Premium"===s.tier_name||s.tier_name,"default"),className:"text-xs",children:s.tier_name})}),e.jsx("h4",{className:"font-semibold text-xs sm:text-sm mb-1 line-clamp-1",children:s.plan_name}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground mb-2 sm:mb-3 line-clamp-2 hidden sm:block",children:s.description}),e.jsxs("div",{className:"space-y-0.5 sm:space-y-1 text-[10px] sm:text-xs mb-2 sm:mb-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Duration:"}),e.jsxs("span",{className:"font-medium",children:[s.duration_days,"d"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Cal:"}),e.jsx("span",{className:"font-medium",children:s.target_calories})]}),e.jsxs("div",{className:"flex justify-between hidden sm:flex",children:[e.jsx("span",{className:"text-muted-foreground",children:"Protein:"}),e.jsxs("span",{className:"font-medium",children:[s.target_protein_g,"g"]})]})]}),e.jsxs(P,{size:"sm",className:"w-full text-xs h-7 sm:h-8",onClick:()=>{Z(s),U(!0)},children:[e.jsx(te,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Assign to Client"}),e.jsx("span",{className:"sm:hidden",children:"Assign"})]})]})},s.id))})})]}),o.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:o.map(s=>e.jsx(pe,{plan:s},s.id))}):e.jsx(V,{className:"glass-effect",children:e.jsxs(K,{className:"p-12 text-center",children:[e.jsx(Te,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No meal plans found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:x||"all"!==h?"Try adjusting your filters":"Create your first meal plan to get started"}),e.jsxs(P,{onClick:()=>he(),children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Create Meal Plan"]})]})}),e.jsx(S,{open:j,onOpenChange:f,children:e.jsxs(M,{className:"glass-effect custom-scrollbar max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsx(A,{children:e.jsx($,{children:v?"Edit Meal Plan":"Create New Meal Plan"})}),e.jsxs(Dt,{defaultValue:"basic",className:"mt-4",children:[e.jsxs(Pt,{className:"grid w-full grid-cols-3",children:[e.jsx(Mt,{value:"basic",children:"Basic Info"}),e.jsx(Mt,{value:"schedule",children:"Meal Schedule"}),e.jsx(Mt,{value:"targets",children:"Nutrition Targets"})]}),e.jsx(At,{value:"basic",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Client *"}),e.jsxs("select",{value:ne.client_id,onChange:e=>ce({...ne,client_id:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"",children:"Select a client"}),c.map(s=>e.jsxs("option",{value:s.id,children:[s.full_name," (",s.email,")"]},s.id))]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Plan Name *"}),e.jsx(E,{value:ne.name,onChange:e=>ce({...ne,name:e.target.value}),placeholder:"e.g., Weight Loss Plan - Week 1"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Description"}),e.jsx(R,{value:ne.description,onChange:e=>ce({...ne,description:e.target.value}),placeholder:"Brief description of the meal plan goals and approach",rows:3})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Start Date *"}),e.jsx(E,{type:"date",value:ne.start_date,onChange:e=>ce({...ne,start_date:e.target.value}),className:"w-full min-w-0"})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"End Date *"}),e.jsx(E,{type:"date",value:ne.end_date,onChange:e=>ce({...ne,end_date:e.target.value}),className:"w-full min-w-0"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Notes"}),e.jsx(R,{value:ne.notes,onChange:e=>ce({...ne,notes:e.target.value}),placeholder:"Additional notes, instructions, or guidelines",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Status"}),e.jsxs("select",{value:ne.status,onChange:e=>ce({...ne,status:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"archived",children:"Archived"})]})]})]})}),e.jsxs(At,{value:"schedule",className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground mb-4",children:"Click on a meal slot to assign a recipe from your database"}),e.jsx("div",{className:"space-y-4",children:["monday","tuesday","wednesday","thursday","friday","saturday","sunday"].map(s=>e.jsxs("div",{className:"border border-border rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold capitalize mb-3",children:s}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:de.map(t=>{var a,l;return e.jsxs(P,{variant:"outline",size:"sm",onClick:()=>((e,s)=>{O(e),G(s),L(!0)})(s,t),className:"h-auto py-3 flex flex-col items-start",children:[e.jsx("span",{className:"text-xs text-muted-foreground capitalize",children:t}),e.jsx("span",{className:"text-xs mt-1",children:(null==(l=null==(a=ne.meal_schedule)?void 0:a[s])?void 0:l[t])?"âœ“ Assigned":"+ Add Recipe"})]},t)})})]},s))})]}),e.jsxs(At,{value:"targets",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Daily Calories Target"}),e.jsx(E,{type:"number",value:ne.target_calories,onChange:e=>ce({...ne,target_calories:parseInt(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Protein Target (g)"}),e.jsx(E,{type:"number",value:ne.target_protein_g,onChange:e=>ce({...ne,target_protein_g:parseInt(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Carbs Target (g)"}),e.jsx(E,{type:"number",value:ne.target_carbs_g,onChange:e=>ce({...ne,target_carbs_g:parseInt(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Fat Target (g)"}),e.jsx(E,{type:"number",value:ne.target_fat_g,onChange:e=>ce({...ne,target_fat_g:parseInt(e.target.value)})})]})]}),e.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Macro Distribution"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Protein"}),e.jsxs("p",{className:"font-semibold",children:[(4*ne.target_protein_g/ne.target_calories*100).toFixed(0),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Carbs"}),e.jsxs("p",{className:"font-semibold",children:[(4*ne.target_carbs_g/ne.target_calories*100).toFixed(0),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Fat"}),e.jsxs("p",{className:"font-semibold",children:[(9*ne.target_fat_g/ne.target_calories*100).toFixed(0),"%"]})]})]})]})]})]}),e.jsxs(T,{className:"mt-6",children:[e.jsx(P,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsxs(P,{onClick:async()=>{if(ne.client_id&&ne.name&&ne.start_date&&ne.end_date){z(!0);try{const e={...ne,nutritionist_id:s.id};if(v){const{error:s}=await _.from("meal_plans_v2").update(e).eq("id",v.id);if(s)throw s;F({title:"Meal plan updated successfully"})}else{const{error:s}=await _.from("meal_plans_v2").insert(e);if(s)throw s;F({title:"Meal plan created successfully"})}f(!1),oe()}catch(e){F({variant:"destructive",title:"Error",description:"Failed to save meal plan"})}finally{z(!1)}}else F({variant:"destructive",title:"Error",description:"Please fill in all required fields"})},disabled:D,children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),D?"Saving...":"Save Meal Plan"]})]})]})}),e.jsx(S,{open:I,onOpenChange:L,children:e.jsxs(M,{className:"glass-effect custom-scrollbar max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsx(A,{children:e.jsxs($,{children:["Select Recipe for ",q&&B&&e.jsxs("span",{className:"capitalize",children:[q," - ",B]})]})}),e.jsx(Wa,{onSelectRecipe:e=>{if(q&&B){const s={...ne.meal_schedule};s[q]||(s[q]={}),s[q][B]=e.id,ce({...ne,meal_schedule:s}),L(!1),O(null),G(null),F({title:"Recipe added to meal plan"})}}})]})}),e.jsx(S,{open:W,onOpenChange:U,children:e.jsxs(M,{className:"glass-effect",children:[e.jsx(A,{children:e.jsx($,{children:"Assign Meal Plan Template"})}),Q&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(y,{children:Q.tier_name}),e.jsx("h3",{className:"font-semibold",children:Q.plan_name})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:Q.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Duration:"}),e.jsxs("span",{className:"font-medium ml-2",children:[Q.duration_days," days"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Calories:"}),e.jsxs("span",{className:"font-medium ml-2",children:[Q.target_calories," kcal"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Protein:"}),e.jsxs("span",{className:"font-medium ml-2",children:[Q.target_protein_g,"g"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Carbs:"}),e.jsxs("span",{className:"font-medium ml-2",children:[Q.target_carbs_g,"g"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Fat:"}),e.jsxs("span",{className:"font-medium ml-2",children:[Q.target_fat_g,"g"]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Select Client"}),e.jsxs("select",{id:"client-select",className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"",children:"Choose a client"}),c.map(s=>e.jsxs("option",{value:s.id,children:[s.full_name," (",s.email,")"]},s.id))]})]}),e.jsxs(T,{children:[e.jsx(P,{variant:"outline",onClick:()=>U(!1),children:"Cancel"}),e.jsx(P,{onClick:()=>{(async e=>{if(Q&&e){z(!0);try{const{error:l}=await _.from("ai_meal_plans").insert({user_id:e,plan_name:Q.plan_name,plan_description:Q.description,duration_days:Q.duration_days,daily_meals:Q.meal_structure,target_calories:Q.target_calories,target_protein_g:Q.target_protein_g,target_carbs_g:Q.target_carbs_g,target_fat_g:Q.target_fat_g,tier_name:Q.tier_name});if(l)throw l;const i=(null==t?void 0:t.full_name)||"Your Nutritionist";a(e,"ðŸ½ï¸ New Meal Plan Assigned",`${i} has assigned you a new meal plan: ${Q.plan_name}`,{tag:"greenofig-mealplan",data:{type:"meal_plan",url:"/app/nutrition"}});try{await _.from("notifications").insert({user_id:e,type:"meal_plan",title:"New Meal Plan Assigned",message:`${i} has assigned you a new meal plan: ${Q.plan_name}`,is_read:!1})}catch(s){}F({title:"Success",description:"Meal plan template assigned to client"}),U(!1),Z(null)}catch(l){F({variant:"destructive",title:"Error",description:"Failed to assign meal plan template"})}finally{z(!1)}}else F({variant:"destructive",title:"Error",description:"Please select a client"})})(document.getElementById("client-select").value)},disabled:D,children:D?"Assigning...":"Assign to Client"})]})]})]})}),X&&e.jsx(Ua,{onPlanGenerated:()=>{oe(),ee(!1)},onClose:()=>ee(!1)}),se&&ie&&e.jsx(Va,{mealPlanId:ie,onClose:()=>{le(!1),re(null)}})]})},Ya=({appointment:s,onClose:t,isOpen:a})=>{var l,i,r;const{user:n,userProfile:c}=w(),{showIncomingCallNotification:d,showMissedCallNotification:o,requestPermission:m,sendPushToUser:x}=C(),[u,h]=g.useState(null);g.useState(!1);const[p,j]=g.useState(!1),[f,v]=g.useState(0),[b,N]=g.useState(!1),[k,D]=g.useState([]),[A,$]=g.useState(""),[E,R]=g.useState(!1),[T,z]=g.useState(null);g.useState(null);const I=g.useRef(null),L=g.useRef(null),q=g.useRef(null),O=g.useRef(null),B=g.useRef(null);g.useEffect(()=>{(null==s?void 0:s.id)&&h(`gf-call-${s.id}`)},[null==s?void 0:s.id]),g.useEffect(()=>{a||(v(0),R(!1),z(null),j(!1),N(!1),D([]),$(""),L.current&&(clearInterval(L.current),L.current=null))},[a]);const{localStream:G,remoteStream:W,connectionState:U,isMuted:V,isVideoEnabled:H,isScreenSharing:Y,error:K,participants:Q,localVideoRef:J,remoteVideoRef:Z,joinRoom:X,leaveRoom:ee,toggleMute:ae,toggleVideo:le,toggleScreenShare:ie,initializeMedia:re}=It(u);g.useEffect(()=>(q.current=(()=>{const e=new(window.AudioContext||window.webkitAudioContext),s=(s,t)=>{const a=e.createOscillator(),l=e.createGain();a.connect(l),l.connect(e.destination),a.frequency.value=s,a.type="sine",l.gain.setValueAtTime(.3,e.currentTime),l.gain.exponentialRampToValueAtTime(.01,e.currentTime+t),a.start(e.currentTime),a.stop(e.currentTime+t)};return{play:()=>{s(880,.2),setTimeout(()=>s(880,.2),300)},context:e}})(),()=>{var e;(null==(e=q.current)?void 0:e.context)&&q.current.context.close()}),[]),g.useEffect(()=>{if(!u||!(null==n?void 0:n.id))return;const e=_.channel(`call-signal:${u}`);return e.on("broadcast",{event:"incoming-call"},async({payload:s})=>{if(s.callerId!==n.id){z(s),B.current=Date.now();try{await _.from("notifications").insert({user_id:n.id,type:"incoming_call",title:"Incoming Call",message:`Video call from ${s.callerName}`,is_read:!1})}catch(t){}const a=setInterval(()=>{var e;null==(e=q.current)||e.play()},1500);await d(s.callerName,u,s.callerId);const l=setTimeout(async()=>{clearInterval(a),z(null),await o(s.callerName,u);try{await _.from("notifications").insert({user_id:n.id,type:"missed_call",title:"Missed Call",message:`You missed a video call from ${s.callerName}`,is_read:!1})}catch(t){}},3e4);e.ringInterval=a,e.missedCallTimeout=l}}),e.on("broadcast",{event:"call-ended"},()=>{e.ringInterval&&clearInterval(e.ringInterval),e.missedCallTimeout&&clearTimeout(e.missedCallTimeout),z(null)}),e.on("broadcast",{event:"call-answered"},()=>{e.ringInterval&&clearInterval(e.ringInterval),e.missedCallTimeout&&clearTimeout(e.missedCallTimeout),R(!1)}),e.on("broadcast",{event:"call-declined"},({payload:s})=>{e.ringInterval&&clearInterval(e.ringInterval),e.missedCallTimeout&&clearTimeout(e.missedCallTimeout),R(!1),z(null),F({variant:"destructive",title:"Call Declined",description:"The client declined your call"}),ee()}),e.subscribe(),O.current=e,()=>{e.ringInterval&&clearInterval(e.ringInterval),e.missedCallTimeout&&clearTimeout(e.missedCallTimeout),_.removeChannel(e)}},[u,null==n?void 0:n.id,d,o]),g.useEffect(()=>("connected"===U?L.current=setInterval(()=>{v(e=>e+1)},1e3):L.current&&clearInterval(L.current),()=>{L.current&&clearInterval(L.current)}),[U]);const ne=e=>{const s=Math.floor(e/3600),t=Math.floor(e%3600/60),a=e%60;return s>0?`${s}:${t.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`:`${t}:${a.toString().padStart(2,"0")}`},ce=async()=>{var e;try{R(!0),B.current=Date.now();const a={callerId:null==n?void 0:n.id,callerName:(null==c?void 0:c.full_name)||"Nutritionist",appointmentId:null==s?void 0:s.id,roomId:u,timestamp:(new Date).toISOString()};try{await _.from("notifications").insert({user_id:null==n?void 0:n.id,type:"outgoing_call",title:"Outgoing Call",message:`Video call to ${(null==(e=null==s?void 0:s.client)?void 0:e.full_name)||"client"}`,is_read:!0})}catch(t){}if(O.current&&O.current.send({type:"broadcast",event:"incoming-call",payload:a}),null==s?void 0:s.client_id){const e=_.channel(`user-calls:${s.client_id}`);e.subscribe(async s=>{"SUBSCRIBED"===s&&await e.send({type:"broadcast",event:"incoming-call",payload:a})}),x(s.client_id,`Incoming Call from ${(null==c?void 0:c.full_name)||"Your Nutritionist"}`,"Tap to answer the video call",{tag:"greenofig-video-call",requireInteraction:!0,data:{type:"incoming_call",roomId:u,callerId:null==n?void 0:n.id,callUrl:`/call/${u}`},actions:[{action:"answer",title:"Answer"},{action:"decline",title:"Decline"}]})}await X(),F({title:"Calling...",description:"Waiting for participant to answer"})}catch(t){R(!1),F({variant:"destructive",title:"Error",description:"Could not start call. Please check camera/microphone permissions."})}},de=async()=>{try{O.current&&O.current.send({type:"broadcast",event:"call-answered",payload:{answeredBy:null==n?void 0:n.id}}),z(null),await X()}catch(e){F({variant:"destructive",title:"Error",description:"Could not join call."})}},oe=()=>{O.current&&O.current.send({type:"broadcast",event:"call-declined",payload:{declinedBy:null==n?void 0:n.id,declinedAt:(new Date).toISOString()}}),z(null)},me=()=>{const e=`${window.location.origin}/call/${u}`;navigator.clipboard.writeText(e),F({title:"Link copied!",description:"Share this link with your client to join the call"})};return a?T?e.jsx(S,{open:!0,onOpenChange:()=>{},children:e.jsx(M,{className:"sm:max-w-md",children:e.jsxs("div",{className:"flex flex-col items-center py-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-green-400 to-green-600 flex items-center justify-center mb-4 animate-pulse",children:e.jsx(ys,{className:"w-10 h-10 text-white"})}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Incoming Call"}),e.jsxs("p",{className:"text-muted-foreground mb-6",children:[T.callerName," is calling..."]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(P,{variant:"destructive",size:"lg",className:"rounded-full w-16 h-16",onClick:oe,children:e.jsx(ws,{className:"w-6 h-6"})}),e.jsx(P,{size:"lg",className:"rounded-full w-16 h-16 bg-green-500 hover:bg-green-600",onClick:de,children:e.jsx(ys,{className:"w-6 h-6"})})]})]})})}):e.jsx(S,{open:a,onOpenChange:t,children:e.jsx(M,{className:"w-full max-w-5xl h-[100dvh] sm:h-[85vh] p-0 overflow-hidden",children:e.jsxs("div",{ref:I,className:"flex flex-col h-full bg-gray-900",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 sm:p-4 bg-gray-800/50 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0",children:[e.jsx(Ue,{className:"w-4 h-4 sm:w-5 sm:h-5 text-primary flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"font-semibold text-white text-sm sm:text-base truncate",children:(null==s?void 0:s.title)||"Video Call"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-400 truncate hidden sm:block",children:(null==(l=null==s?void 0:s.client)?void 0:l.full_name)||"Client"})]})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-3 flex-shrink-0",children:[(()=>{switch(U){case"connecting":return e.jsxs(y,{variant:"secondary",className:"animate-pulse text-xs",children:[e.jsx(Se,{className:"w-3 h-3 mr-1 animate-spin"})," Connecting..."]});case"connected":return e.jsxs(y,{variant:"default",className:"bg-green-500 text-xs",children:[e.jsx(Rs,{className:"w-3 h-3 mr-1"})," Connected"]});case"failed":return e.jsxs(y,{variant:"destructive",className:"text-xs",children:[e.jsx(Ee,{className:"w-3 h-3 mr-1"})," Failed"]});default:return e.jsx(y,{variant:"outline",className:"text-xs",children:"Ready"})}})(),"connected"===U&&e.jsxs(y,{variant:"outline",className:"text-white border-gray-600 text-xs hidden sm:flex",children:[e.jsx(Pe,{className:"w-3 h-3 mr-1"}),ne(f)]}),e.jsxs(y,{variant:"outline",className:"text-white border-gray-600 text-xs",children:[e.jsx(te,{className:"w-3 h-3 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:Q.length})]})]})]}),e.jsxs("div",{className:"flex-1 relative p-2 sm:p-4 overflow-hidden",children:["disconnected"===U?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full px-4",children:[e.jsx("div",{className:"relative mb-4 sm:mb-6 w-full max-w-xs sm:max-w-sm",children:e.jsxs("div",{className:"w-full aspect-[4/3] bg-gray-800 rounded-2xl overflow-hidden border-2 border-gray-700",children:[e.jsx("video",{ref:J,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",style:{transform:"scaleX(-1)"}}),!G&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(we,{className:"w-12 h-12 sm:w-16 sm:h-16 text-gray-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-400 text-xs sm:text-sm",children:"Camera preview"})]})})]})}),e.jsx("h2",{className:"text-lg sm:text-2xl font-bold text-white mb-1 sm:mb-2 text-center",children:"Ready to join?"}),e.jsx("p",{className:"text-gray-400 mb-4 sm:mb-6 text-sm sm:text-base text-center",children:(null==(i=null==s?void 0:s.client)?void 0:i.full_name)||"Participant"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 mb-4 sm:mb-6 w-full max-w-xs",children:[e.jsx(P,{size:"lg",className:"bg-green-500 hover:bg-green-600 gap-2 w-full sm:w-auto",onClick:ce,disabled:E,children:E?e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"w-5 h-5 animate-spin"}),"Calling..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ys,{className:"w-5 h-5"}),"Start Call"]})}),e.jsxs(P,{variant:"outline",size:"lg",className:"gap-2 border-gray-600 text-white hover:bg-gray-800 w-full sm:w-auto",onClick:me,children:[e.jsx(_s,{className:"w-5 h-5"}),"Copy Link"]})]}),e.jsxs("div",{className:"flex gap-2 sm:gap-4",children:[e.jsxs(P,{variant:"ghost",size:"sm",className:"text-gray-400 hover:text-white "+(V?"text-red-400":""),onClick:ae,children:[V?e.jsx(ks,{className:"w-4 h-4 sm:mr-2"}):e.jsx(Cs,{className:"w-4 h-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:V?"Unmute":"Mute"})]}),e.jsxs(P,{variant:"ghost",size:"sm",className:"text-gray-400 hover:text-white "+(H?"":"text-red-400"),onClick:le,children:[H?e.jsx(Ue,{className:"w-4 h-4 sm:mr-2"}):e.jsx(Ss,{className:"w-4 h-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:H?"Stop Video":"Start Video"})]})]})]}):e.jsxs("div",{className:"relative h-full",children:[e.jsxs("div",{className:"absolute inset-0 bg-gray-800 rounded-xl sm:rounded-2xl overflow-hidden",children:[e.jsx("video",{ref:Z,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),!W&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Se,{className:"w-8 h-8 sm:w-12 sm:h-12 text-primary mx-auto mb-2 sm:mb-4 animate-spin"}),e.jsx("p",{className:"text-gray-400 text-sm sm:text-base",children:"Waiting for participant..."})]})}),W&&e.jsx("div",{className:"absolute bottom-2 left-2 sm:bottom-4 sm:left-4 bg-black/50 px-2 py-1 sm:px-3 rounded-full",children:e.jsx("span",{className:"text-white text-xs sm:text-sm",children:(null==(r=null==s?void 0:s.client)?void 0:r.full_name)||"Participant"})}),"connected"===U&&e.jsx("div",{className:"absolute top-2 left-2 sm:hidden bg-black/50 px-2 py-1 rounded-full",children:e.jsx("span",{className:"text-white text-xs",children:ne(f)})})]}),e.jsxs(se.div,{className:"absolute bottom-20 sm:bottom-24 right-2 sm:right-4 w-24 h-32 sm:w-36 sm:h-48 md:w-48 md:h-36 bg-gray-800 rounded-lg sm:rounded-xl overflow-hidden border-2 border-gray-600 shadow-lg",drag:!0,dragConstraints:I,whileTap:{scale:.95},children:[e.jsx("video",{ref:J,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",style:{transform:"scaleX(-1)"}}),!H&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900",children:e.jsx(we,{className:"w-6 h-6 sm:w-10 sm:h-10 text-gray-600"})}),e.jsx("div",{className:"absolute bottom-1 left-1 sm:bottom-2 sm:left-2 bg-black/50 px-1.5 py-0.5 sm:px-2 rounded-full",children:e.jsx("span",{className:"text-white text-[10px] sm:text-xs",children:"You"})})]})]}),K&&e.jsxs("div",{className:"absolute top-2 left-2 right-2 sm:top-4 sm:left-1/2 sm:right-auto sm:transform sm:-translate-x-1/2 bg-red-500/90 text-white px-3 py-2 rounded-lg flex items-center gap-2 text-sm",children:[e.jsx(Ee,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:K}),e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>window.location.reload(),className:"p-1",children:e.jsx(ms,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"p-2 sm:p-4 bg-gray-800/50 border-t border-gray-700 safe-area-bottom",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 sm:gap-4",children:[e.jsx(P,{variant:V?"destructive":"secondary",size:"lg",className:"rounded-full w-11 h-11 sm:w-14 sm:h-14",onClick:ae,children:V?e.jsx(ks,{className:"w-5 h-5 sm:w-6 sm:h-6"}):e.jsx(Cs,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),e.jsx(P,{variant:H?"secondary":"destructive",size:"lg",className:"rounded-full w-11 h-11 sm:w-14 sm:h-14",onClick:le,children:H?e.jsx(Ue,{className:"w-5 h-5 sm:w-6 sm:h-6"}):e.jsx(Ss,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),e.jsx(P,{variant:"secondary",size:"lg",className:"rounded-full w-11 h-11 sm:hidden",onClick:async()=>{if(G){const s=G.getVideoTracks()[0];if(s){const t="user"===s.getConstraints().facingMode?"environment":"user";try{const e=(await navigator.mediaDevices.getUserMedia({video:{facingMode:t},audio:!0})).getVideoTracks()[0];s.stop(),G.removeTrack(s),G.addTrack(e),J.current&&(J.current.srcObject=G)}catch(e){}}}},children:e.jsx(Ds,{className:"w-5 h-5"})}),e.jsx(P,{variant:Y?"default":"secondary",size:"lg",className:"rounded-full w-14 h-14 hidden sm:flex "+(Y?"bg-primary":""),onClick:ie,disabled:"connected"!==U,children:Y?e.jsx(Ps,{className:"w-6 h-6"}):e.jsx(Ms,{className:"w-6 h-6"})}),"disconnected"===U?e.jsx(P,{size:"lg",className:"rounded-full w-11 h-11 sm:w-14 sm:h-14 bg-green-500 hover:bg-green-600",onClick:ce,disabled:E,children:e.jsx(ys,{className:"w-5 h-5 sm:w-6 sm:h-6"})}):e.jsx(P,{variant:"destructive",size:"lg",className:"rounded-full w-11 h-11 sm:w-14 sm:h-14",onClick:async()=>{var e;const t=f;if(O.current)try{await O.current.send({type:"broadcast",event:"call-ended",payload:{endedBy:null==n?void 0:n.id}})}catch(a){}if(await ee(),t>0)try{await _.from("notifications").insert({user_id:null==n?void 0:n.id,type:"completed_call",title:"Call Completed",message:`Video call with ${(null==(e=null==s?void 0:s.client)?void 0:e.full_name)||"participant"} - ${ne(t)}`,is_read:!0})}catch(l){}v(0),R(!1),z(null),L.current&&(clearInterval(L.current),L.current=null),F({title:"Call ended",description:`Call duration: ${ne(t)}`})},children:e.jsx(ws,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),e.jsx(P,{variant:"secondary",size:"lg",className:"rounded-full w-14 h-14 hidden sm:flex",onClick:()=>{var e;document.fullscreenElement?(document.exitFullscreen(),j(!1)):(null==(e=I.current)||e.requestFullscreen(),j(!0))},children:p?e.jsx(As,{className:"w-6 h-6"}):e.jsx($s,{className:"w-6 h-6"})}),e.jsx(P,{variant:"secondary",size:"lg",className:"rounded-full w-11 h-11 sm:w-14 sm:h-14",onClick:me,children:e.jsx(Es,{className:"w-5 h-5 sm:w-6 sm:h-6"})})]})})]})})}):null},Ka=({appointment:s,onClose:t})=>{var a;const[l,i]=g.useState("idle"),[r,n]=g.useState(!1),[c,d]=g.useState(!0),[o,m]=g.useState((null==s?void 0:s.meeting_link)||""),[x,u]=g.useState(!1),[h,p]=g.useState(!1);return e.jsx(S,{open:!0,onOpenChange:t,children:e.jsxs(M,{className:"max-w-3xl",children:[e.jsx(A,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5 text-primary"}),"Video Call"]})}),s&&e.jsx("div",{className:"bg-muted/50 p-4 rounded-lg mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["With ",(null==(a=s.client)?void 0:a.full_name)||"Client"]})]}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(ye,{className:"w-4 h-4"}),s.appointment_date?new Date(s.appointment_date).toLocaleDateString():"No date"]}),e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(Pe,{className:"w-4 h-4"}),s.appointment_date?new Date(s.appointment_date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""," (",s.duration_minutes||60," min)"]})]})]})}),e.jsxs(V,{children:[e.jsx(H,{className:"pb-3",children:e.jsxs(Y,{className:"text-sm flex items-center gap-2",children:[e.jsx(Es,{className:"w-4 h-4"}),"Meeting Link"]})}),e.jsx(K,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{value:o,onChange:e=>m(e.target.value),placeholder:"Paste meeting link (Zoom, Google Meet, etc.)",className:"flex-1"}),e.jsx(P,{variant:"outline",size:"icon",onClick:()=>{o&&(navigator.clipboard.writeText(o),F({title:"Link copied!",description:"Meeting link copied to clipboard"}))},disabled:!o,children:e.jsx(_s,{className:"w-4 h-4"})}),e.jsx(P,{variant:"outline",onClick:()=>u(!0),children:"Create New"})]})})]}),e.jsx(V,{className:"bg-muted/30",children:e.jsxs(K,{className:"p-6",children:["idle"===l&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-24 h-24 mx-auto bg-primary/10 rounded-full flex items-center justify-center mb-4",children:e.jsx(Ue,{className:"w-12 h-12 text-primary"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Ready to Join"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:'Click "Join Call" to start your video consultation'})]}),"connecting"===l&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Se,{className:"w-12 h-12 mx-auto animate-spin text-primary mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Connecting..."}),e.jsx("p",{className:"text-muted-foreground",children:"Opening meeting in new tab"})]}),"connected"===l&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Rs,{className:"w-12 h-12 mx-auto text-green-500 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Call in Progress"}),e.jsx("p",{className:"text-muted-foreground",children:"Your meeting is open in another tab"})]}),"ended"===l&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ws,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Call Ended"}),e.jsx("p",{className:"text-muted-foreground",children:"The video call has been ended"})]})]})}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx(P,{variant:r?"destructive":"outline",size:"lg",className:"rounded-full w-14 h-14",onClick:()=>n(!r),children:r?e.jsx(ks,{className:"w-6 h-6"}):e.jsx(Cs,{className:"w-6 h-6"})}),e.jsx(P,{variant:c?"outline":"destructive",size:"lg",className:"rounded-full w-14 h-14",onClick:()=>d(!c),children:c?e.jsx(Ue,{className:"w-6 h-6"}):e.jsx(Ss,{className:"w-6 h-6"})}),"idle"===l||"ended"===l?e.jsx(P,{size:"lg",className:"rounded-full w-14 h-14 bg-green-500 hover:bg-green-600",onClick:()=>{o?(window.open(o,"_blank"),i("connecting")):F({variant:"destructive",title:"No meeting link",description:"Please add a meeting link first"})},children:e.jsx(ys,{className:"w-6 h-6"})}):e.jsx(P,{variant:"destructive",size:"lg",className:"rounded-full w-14 h-14",onClick:()=>{i("ended"),F({title:"Call ended",description:"The video call has been ended"})},children:e.jsx(ws,{className:"w-6 h-6"})}),e.jsx(P,{variant:"outline",size:"lg",className:"rounded-full w-14 h-14",onClick:()=>o&&window.open(o,"_blank"),children:e.jsx(Ts,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"bg-primary/5 p-4 rounded-lg mt-4",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Quick Tips"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"- Test your audio and video before the call"}),e.jsx("li",{children:"- Ensure good lighting and a quiet environment"}),e.jsx("li",{children:"- Have client notes ready for reference"}),e.jsx("li",{children:"- Share meeting link with client via message"})]})]}),e.jsx(S,{open:x,onOpenChange:u,children:e.jsxs(M,{children:[e.jsx(A,{children:e.jsx($,{children:"Create New Meeting"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose a video conferencing platform to create your meeting:"}),e.jsx("div",{className:"space-y-3",children:[{id:"zoom",name:"Zoom",logo:"/zoom-logo.png",description:"Video conferencing with up to 100 participants",createUrl:"https://zoom.us/meeting/schedule"},{id:"google-meet",name:"Google Meet",logo:"/meet-logo.png",description:"Free video meetings from Google",createUrl:"https://meet.google.com/new"},{id:"teams",name:"Microsoft Teams",logo:"/teams-logo.png",description:"Enterprise video conferencing",createUrl:"https://teams.microsoft.com/"}].map(s=>e.jsx(V,{className:"cursor-pointer hover:border-primary transition-colors",onClick:()=>(async e=>{p(!0);try{window.open(e.createUrl,"_blank"),F({title:"Create Meeting",description:`Create your meeting in ${e.name}, then paste the link here`})}finally{p(!1)}})(s),children:e.jsxs(K,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-muted rounded-lg flex items-center justify-center",children:e.jsx(Ue,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]}),e.jsx(Ts,{className:"w-5 h-5 text-muted-foreground"})]})},s.id))}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Or paste any meeting link:"}),e.jsx(E,{placeholder:"https://...",value:o,onChange:e=>m(e.target.value)})]})]}),e.jsxs(T,{children:[e.jsx(P,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsx(P,{onClick:()=>u(!1),disabled:!o,children:"Save Link"})]})]})})]})})},Qa=()=>{const{user:s,userProfile:t}=w(),{sendPushToUser:a}=C(),[l,i]=g.useState([]),[r,n]=g.useState([]),[c,d]=g.useState(new Date),[o,m]=g.useState(new Date),[x,u]=g.useState(!1),[h,p]=g.useState(null),[j,f]=g.useState(!0),[v,b]=g.useState(!1);g.useState("month");const[N,k]=g.useState(!1),[D,z]=g.useState(!1),[I,L]=g.useState(null),[q,O]=g.useState({client_id:"",title:"",description:"",appointment_date:"",appointment_time:"",duration_minutes:60,consultation_type:"follow_up",meeting_link:"",status:"scheduled",notes:""}),B=[{value:"scheduled",label:"Scheduled",color:"bg-blue-500"},{value:"completed",label:"Completed",color:"bg-green-500"},{value:"cancelled",label:"Cancelled",color:"bg-red-500"},{value:"no_show",label:"No Show",color:"bg-gray-500"}];g.useEffect(()=>{G(),W()},[s,c]);const G=async()=>{f(!0);try{const e=Fs(c),t=zs(c),{data:a,error:l}=await _.from("appointments").select("\n          *,\n          client:user_profiles!appointments_client_id_fkey(id, full_name, email)\n        ").eq("nutritionist_id",s.id).gte("appointment_date",e.toISOString()).lte("appointment_date",t.toISOString()).order("appointment_date",{ascending:!0});if(l)throw l;i(a||[])}catch(e){F({variant:"destructive",title:"Error",description:"Failed to fetch appointments"})}finally{f(!1)}},W=async()=>{try{const{data:e,error:s}=await _.from("user_profiles").select("id, full_name, email").eq("role","user").order("full_name",{ascending:!0});if(s)throw s;n(e||[])}catch(e){}},U=async(e,s,t)=>{const l="appointment_scheduled"===s?"New Appointment Scheduled":"appointment_updated"===s?"Appointment Updated":"appointment_cancelled"===s?"Appointment Cancelled":"Appointment";try{const{error:r}=await _.from("notifications").insert({user_id:e,type:s,title:l,message:t,is_read:!1});a(e,l,t,{tag:"greenofig-appointment",data:{type:s,url:"/app/user"},actions:[{action:"view",title:"View Details"}]});try{const a=_.channel(`user-${e}`);await a.subscribe(),await a.send({type:"broadcast",event:"notification",payload:{type:s,title:l,message:t,timestamp:(new Date).toISOString()}})}catch(i){}}catch(r){}},Q=(e=null,s=null)=>{if(e){const s=new Date(e.appointment_date);p(e),O({client_id:e.client_id,title:e.title,description:e.description||"",appointment_date:Oe(s,"yyyy-MM-dd"),appointment_time:Oe(s,"HH:mm"),duration_minutes:e.duration_minutes||60,consultation_type:e.consultation_type||"follow_up",meeting_link:e.meeting_link||"",status:e.status||"scheduled",notes:e.notes||""})}else{const e=s||o;p(null),O({client_id:"",title:"",description:"",appointment_date:Oe(e,"yyyy-MM-dd"),appointment_time:"10:00",duration_minutes:60,consultation_type:"follow_up",meeting_link:"",status:"scheduled",notes:""})}u(!0)},J=e=>l.filter(s=>Ls(Bs(s.appointment_date),e)),Z=({appointment:s,compact:t=!1})=>{var a;const i=B.find(e=>e.value===s.status),r=new Date(s.appointment_date);return t?e.jsxs("div",{onClick:()=>Q(s),className:"text-xs p-1 mb-1 rounded cursor-pointer hover:opacity-80 transition-opacity truncate",style:{backgroundColor:(null==i?void 0:i.color.replace("bg-",""))+"30"},children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Pe,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:Oe(r,"h:mm a")})]}),e.jsx("div",{className:"truncate",children:s.title})]}):e.jsx(V,{className:"glass-effect hover:shadow-lg transition-all",children:e.jsxs(K,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Pe,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm font-semibold",children:[Oe(r,"MMM d, yyyy")," at ",Oe(r,"h:mm a")]})]}),e.jsx("h3",{className:"font-semibold text-lg",children:s.title}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(we,{className:"w-3 h-3"}),(null==(a=s.client)?void 0:a.full_name)||"Unknown Client"]})]}),e.jsx(y,{variant:"completed"===s.status?"default":"secondary",children:null==i?void 0:i.label})]}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Duration: ",s.duration_minutes," min"]}),s.meeting_link&&e.jsxs("span",{className:"flex items-center gap-1 text-primary",children:[e.jsx(Ue,{className:"w-4 h-4"}),"Video call"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(P,{variant:"outline",size:"sm",className:"text-primary border-primary hover:bg-primary/10",onClick:()=>{L(s),k(!0)},title:"Start native video call",children:[e.jsx(Ue,{className:"w-4 h-4 mr-1"}),"Call"]}),e.jsxs(P,{variant:"outline",size:"sm",className:"text-blue-500 border-blue-500 hover:bg-blue-500/10",onClick:()=>{L(s),z(!0)},title:"Use Zoom, Google Meet, or Teams",children:[e.jsx(Ts,{className:"w-4 h-4 mr-1"}),"External"]}),s.meeting_link&&e.jsx(P,{variant:"outline",size:"sm",onClick:()=>window.open(s.meeting_link,"_blank"),title:"Join existing meeting",children:e.jsx(ys,{className:"w-4 h-4"})}),e.jsx(P,{variant:"outline",size:"sm",onClick:()=>Q(s),children:e.jsx(Ae,{className:"w-4 h-4"})}),e.jsx(P,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this appointment?"))try{const s=l.find(s=>s.id===e),{error:t}=await _.from("appointments").delete().eq("id",e);if(t)throw t;if(s){const e=new Date(s.appointment_date);await U(s.client_id,"appointment_cancelled",`Your appointment "${s.title}" scheduled for ${Oe(e,"MMM d, yyyy")} at ${Oe(e,"h:mm a")} has been cancelled.`)}F({title:"Appointment deleted successfully"}),G()}catch(s){F({variant:"destructive",title:"Error",description:"Failed to delete appointment"})}})(s.id),className:"text-destructive",children:e.jsx($e,{className:"w-4 h-4"})})]})]})]})})};return j?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(Se,{className:"w-12 h-12 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(ye,{className:"w-8 h-8 text-primary"}),"Schedule"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your appointments and consultations"})]}),e.jsxs(P,{onClick:()=>Q(),children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"New Appointment"]})]}),e.jsxs(V,{className:"glass-effect",children:[e.jsx(H,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(P,{variant:"outline",size:"sm",onClick:()=>d(Gs(c,1)),children:e.jsx(Is,{className:"w-4 h-4"})}),e.jsx("h3",{className:"text-xl font-semibold min-w-[200px] text-center",children:Oe(c,"MMMM yyyy")}),e.jsx(P,{variant:"outline",size:"sm",onClick:()=>d(Ws(c,1)),children:e.jsx(fe,{className:"w-4 h-4"})})]}),e.jsx(P,{variant:"outline",size:"sm",onClick:()=>d(new Date),children:"Today"})]})}),e.jsx(K,{children:e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(s=>e.jsx("div",{className:"text-center font-semibold text-sm py-2",children:s},s)),(()=>{const e=Fs(c),s=zs(c);return Os({start:e,end:s})})().map(s=>{const t=J(s),a=Ls(s,o),l=qs(s);return e.jsxs("div",{onClick:()=>m(s),className:`min-h-[100px] p-2 border rounded-lg cursor-pointer transition-colors ${a?"border-primary bg-primary/10":"border-border hover:bg-muted/50"} ${l?"bg-primary/5":""}`,children:[e.jsx("div",{className:"text-sm font-semibold mb-1 "+(l?"text-primary":""),children:Oe(s,"d")}),e.jsxs("div",{className:"space-y-1",children:[t.slice(0,2).map(s=>e.jsx(Z,{appointment:s,compact:!0},s.id)),t.length>2&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["+",t.length-2," more"]})]})]},s.toISOString())})]})})]}),e.jsxs(V,{className:"glass-effect",children:[e.jsx(H,{children:e.jsxs(Y,{children:["Appointments for ",Oe(o,"EEEE, MMMM d, yyyy")]})}),e.jsx(K,{children:J(o).length>0?e.jsx("div",{className:"space-y-4",children:J(o).map(s=>e.jsx(Z,{appointment:s},s.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ye,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No appointments scheduled for this date"}),e.jsxs(P,{variant:"outline",onClick:()=>Q(null,o),className:"mt-4",children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Schedule Appointment"]})]})})]}),e.jsx(S,{open:x,onOpenChange:u,children:e.jsxs(M,{className:"glass-effect custom-scrollbar max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(A,{children:e.jsx($,{children:h?"Edit Appointment":"New Appointment"})}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Client *"}),e.jsxs("select",{value:q.client_id,onChange:e=>O({...q,client_id:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"",children:"Select a client"}),r.map(s=>e.jsxs("option",{value:s.id,children:[s.full_name," (",s.email,")"]},s.id))]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Title *"}),e.jsx(E,{value:q.title,onChange:e=>O({...q,title:e.target.value}),placeholder:"e.g., Initial Consultation"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Description"}),e.jsx(R,{value:q.description,onChange:e=>O({...q,description:e.target.value}),placeholder:"Brief description of the appointment",rows:3})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Date *"}),e.jsx(E,{type:"date",value:q.appointment_date,onChange:e=>O({...q,appointment_date:e.target.value}),className:"w-full min-w-0"})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Time *"}),e.jsx(E,{type:"time",value:q.appointment_time,onChange:e=>O({...q,appointment_time:e.target.value}),className:"w-full min-w-0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Duration (minutes)"}),e.jsx(E,{type:"number",min:"15",step:"15",value:q.duration_minutes,onChange:e=>O({...q,duration_minutes:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Type"}),e.jsx("select",{value:q.consultation_type,onChange:e=>O({...q,consultation_type:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[{value:"initial",label:"Initial Consultation"},{value:"follow_up",label:"Follow-up"},{value:"check_in",label:"Check-in"}].map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Status"}),e.jsx("select",{value:q.status,onChange:e=>O({...q,status:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:B.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Meeting Link (optional)"}),e.jsx(E,{value:q.meeting_link,onChange:e=>O({...q,meeting_link:e.target.value}),placeholder:"https://zoom.us/j/..."})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Notes"}),e.jsx(R,{value:q.notes,onChange:e=>O({...q,notes:e.target.value}),placeholder:"Additional notes about this appointment",rows:3})]})]})}),e.jsxs(T,{children:[e.jsx(P,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsx(P,{onClick:async()=>{if(q.client_id&&q.title&&q.appointment_date&&q.appointment_time){b(!0);try{const e=new Date(`${q.appointment_date}T${q.appointment_time}`),t={nutritionist_id:s.id,client_id:q.client_id,title:q.title,description:q.description,appointment_date:e.toISOString(),duration_minutes:parseInt(q.duration_minutes),consultation_type:q.consultation_type,meeting_link:q.meeting_link,status:q.status,notes:q.notes};r.find(e=>e.id===q.client_id);if(h){const{error:s}=await _.from("appointments").update(t).eq("id",h.id);if(s)throw s;await U(q.client_id,"appointment_updated",`Your appointment "${q.title}" has been updated to ${Oe(new Date(e),"MMM d, yyyy")} at ${Oe(new Date(e),"h:mm a")}`),F({title:"Appointment updated successfully"})}else{const{data:s,error:a}=await _.from("appointments").insert(t).select().single();if(a)throw a;await U(q.client_id,"appointment_scheduled",`You have a new appointment "${q.title}" scheduled for ${Oe(new Date(e),"MMM d, yyyy")} at ${Oe(new Date(e),"h:mm a")}`),F({title:"Appointment created successfully"})}u(!1),G()}catch(e){F({variant:"destructive",title:"Error",description:"Failed to save appointment"})}finally{b(!1)}}else F({variant:"destructive",title:"Error",description:"Please fill in all required fields"})},disabled:v,children:v?e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),"Save Appointment"]})})]})]})}),e.jsx(Ya,{appointment:I,isOpen:N,onClose:()=>{k(!1),L(null)}}),D&&I&&e.jsx(Ka,{appointment:I,onClose:()=>{z(!1),L(null)}})]})},Ja=()=>{var s,t,a;const{user:l,userProfile:i}=w(),{sendPushToUser:r}=C(),[n]=b(),[c,d]=g.useState([]),[o,m]=g.useState([]),[x,u]=g.useState(null),[h,p]=g.useState([]),[j,f]=g.useState(""),[v,N]=g.useState(""),[k,D]=g.useState(!0),[z,I]=g.useState(!1),[L,q]=g.useState(!1),[O,B]=g.useState(""),[G,W]=g.useState(""),[U]=g.useState(new Audio("data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuEzvLaizsIGmi77eamUBELTKXh8bllHAU2jdXyzn0vBSR2xe/glEILElyx6OyrWBQLRp3e8cFuJAUpgs/z3I4+CRhnvO7op1YSCEE=")),[Y,Q]=g.useState([]),[J,Z]=g.useState(!1),X=g.useRef(null),[ee,se]=g.useState(!1),[te,ae]=g.useState([{id:1,name:"Welcome Message",content:"Welcome to your personalized nutrition journey! I'm excited to work with you. Let's start by discussing your goals and preferences."},{id:2,name:"Weekly Check-in",content:"Hi! Just checking in on your progress this week. How are you feeling? Have you been able to follow the meal plan? Let me know if you have any questions!"},{id:3,name:"Meal Plan Ready",content:"Great news! Your personalized meal plan is ready. I've tailored it to your preferences and goals. Please take a look and let me know if you'd like any adjustments."},{id:4,name:"Appointment Reminder",content:"Just a friendly reminder about our upcoming appointment. Looking forward to discussing your progress!"},{id:5,name:"Encouragement",content:"I wanted to reach out and say you're doing amazing! Keep up the great work. Every healthy choice counts!"}]),[le,ie]=g.useState(null),[re,ne]=g.useState(""),[ce,de]=g.useState(""),[oe,me]=g.useState(!1),[xe,ue]=g.useState(""),[he,ge]=g.useState([]),[fe,ve]=g.useState("all");g.useEffect(()=>{if(ye(),_e(),null==l?void 0:l.id){const e=_.channel("nutritionist_messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`recipient_id=eq.${l.id}`},e=>{U.play().catch(e=>{}),F({title:"New Message",description:"You received a new message from a client"}),_e(),x&&e.new.sender_id===x.partnerId&&De(x)}).subscribe();return()=>{_.removeChannel(e)}}},[l]),g.useEffect(()=>{x&&(De(x),Pe(x))},[x]);const Ne=g.useRef(!1);g.useEffect(()=>{const e=n.get("conversation");if(e&&o.length>0&&!Ne.current){const s=o.find(s=>s.partnerId===e);s&&(Ne.current=!0,u(s))}},[o.length,n]);const ye=async()=>{try{const{data:e,error:s}=await _.from("user_profiles").select("id, full_name, email, profile_picture_url, tier").eq("role","user").order("full_name",{ascending:!0});if(s)throw s;d(e||[])}catch(e){}},_e=async()=>{D(!0);try{let e=_.from("messages").select("*").or(`sender_id.eq.${l.id},recipient_id.eq.${l.id}`).order("created_at",{ascending:!1});const{data:s,error:t}=await e;if(t)return m([]),void D(!1);if(s&&s.length>0){const e=new Set;s.forEach(s=>{s.sender_id&&e.add(s.sender_id),s.recipient_id&&e.add(s.recipient_id)});const{data:t,error:a}=await _.from("user_profiles").select("id, full_name, email, profile_picture_url").in("id",Array.from(e));if(!a&&t){const e=new Map(t.map(e=>[e.id,e])),a=s.map(s=>({...s,sender:e.get(s.sender_id),recipient:e.get(s.recipient_id)}));ke(a)}else ke(s)}else m([]),D(!1)}catch(e){m([]),D(!1)}},ke=e=>{try{const s=new Map;(e||[]).forEach(e=>{const t=e.sender_id===l.id?e.recipient_id:e.sender_id,a=e.sender_id===l.id?e.recipient:e.sender;s.has(t)||s.set(t,{partnerId:t,partner:a,lastMessage:e,unreadCount:0}),e.recipient_id!==l.id||e.is_read||s.get(t).unreadCount++}),m(Array.from(s.values()))}catch(s){m([])}finally{D(!1)}},De=async e=>{try{const s=e.partnerId,{data:t,error:a}=await _.from("messages").select("*").or(`and(sender_id.eq.${l.id},recipient_id.eq.${s}),and(sender_id.eq.${s},recipient_id.eq.${l.id})`).order("created_at",{ascending:!0});if(a)return void p([]);if(t&&t.length>0){const e=new Set([l.id,s]),{data:a,error:i}=await _.from("user_profiles").select("id, full_name, email, profile_picture_url").in("id",Array.from(e));if(!i&&a){const e=new Map(a.map(e=>[e.id,e])),s=t.map(s=>({...s,sender:e.get(s.sender_id),recipient:e.get(s.recipient_id)}));p(s)}else p(t)}else p([])}catch(s){p([])}},Pe=async e=>{try{const{error:s}=await _.from("messages").update({is_read:!0}).eq("sender_id",e.partnerId).eq("recipient_id",l.id).eq("is_read",!1);if(s)throw s;_e()}catch(s){}},Me=async e=>{const s=e.name.split(".").pop(),t=`${l.id}/${Date.now()}-${Math.random().toString(36).substring(7)}.${s}`,{data:a,error:i}=await _.storage.from("message-attachments").upload(t,e.file);if(i)throw i;const{data:r}=_.storage.from("message-attachments").getPublicUrl(t);return{name:e.name,url:r.publicUrl,type:e.type,size:e.size}},Ee=async()=>{if((j.trim()||0!==Y.length)&&x){I(!0),Z(Y.length>0);try{let s=[];if(Y.length>0)for(const l of Y)try{const e=await Me(l);s.push(e)}catch(e){}const{error:t}=await _.from("messages").insert({sender_id:l.id,recipient_id:x.partnerId,message_text:j.trim(),attachments:s.length>0?s:null,is_read:!1});if(t)throw t;const a=(null==i?void 0:i.full_name)||"Your Nutritionist",n=j.trim().substring(0,50)+(j.trim().length>50?"...":"");r(x.partnerId,`New message from ${a}`,n,{tag:"greenofig-message",data:{type:"message",url:"/app/messages"}}),f(""),Q([]),await De(x),await _e()}catch(s){F({variant:"destructive",title:"Error",description:"Failed to send message"})}finally{I(!1),Z(!1)}}},Re=()=>"all"===fe?c:c.filter(e=>e.tier===fe),Te=o.filter(e=>{var s,t,a,l;return(null==(t=null==(s=e.partner)?void 0:s.full_name)?void 0:t.toLowerCase().includes(v.toLowerCase()))||(null==(l=null==(a=e.partner)?void 0:a.email)?void 0:l.toLowerCase().includes(v.toLowerCase()))}),Fe=({conversation:s})=>{var t,a;return e.jsx("div",{onClick:()=>u(s),className:"p-4 border-b border-border cursor-pointer hover:bg-muted/50 transition-colors "+((null==x?void 0:x.partnerId)===s.partnerId?"bg-muted":""),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:(null==(t=s.partner)?void 0:t.profile_picture_url)?e.jsx("img",{src:s.partner.profile_picture_url,alt:s.partner.full_name,className:"w-12 h-12 rounded-full object-cover"}):e.jsx(we,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h4",{className:"font-semibold text-sm truncate",children:(null==(a=s.partner)?void 0:a.full_name)||"Unknown"}),e.jsx("span",{className:"text-xs text-muted-foreground flex-shrink-0 ml-2",children:Oe(new Date(s.lastMessage.created_at),"MMM d")})]}),e.jsx("p",{className:"text-sm truncate "+(s.unreadCount>0?"font-semibold":"text-muted-foreground"),children:s.lastMessage.attachments?"ðŸ“Ž Attachment":s.lastMessage.message_text}),s.unreadCount>0&&e.jsxs(y,{variant:"default",className:"mt-1",children:[s.unreadCount," new"]})]})]})})},ze=({message:s})=>{var t,a;const i=s.sender_id===l.id,r=s.attachments||[];return e.jsx("div",{className:`flex ${i?"justify-end":"justify-start"} mb-4`,children:e.jsxs("div",{className:"max-w-[70%] "+(i?"order-2":"order-1"),children:[!i&&e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center",children:(null==(t=s.sender)?void 0:t.profile_picture_url)?e.jsx("img",{src:s.sender.profile_picture_url,alt:s.sender.full_name,className:"w-6 h-6 rounded-full object-cover"}):e.jsx(we,{className:"w-3 h-3 text-primary"})}),e.jsx("span",{className:"text-xs text-muted-foreground",children:null==(a=s.sender)?void 0:a.full_name})]}),e.jsxs("div",{className:"rounded-lg p-3 "+(i?"bg-primary text-primary-foreground":"bg-muted"),children:[s.message_text&&e.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:s.message_text}),r.length>0&&e.jsx("div",{className:"mt-2 space-y-2 "+(s.message_text?"pt-2 border-t border-white/20":""),children:r.map((s,t)=>{var a;return e.jsx("div",{className:"flex items-center gap-2",children:(null==(a=s.type)?void 0:a.startsWith("image/"))?e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"block",children:e.jsx("img",{src:s.url,alt:s.name,className:"max-w-[200px] rounded border border-white/20"})}):e.jsxs("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-2 rounded "+(i?"bg-white/10 hover:bg-white/20":"bg-background hover:bg-muted"),children:[e.jsx(Ge,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs truncate max-w-[150px]",children:s.name}),e.jsx(as,{className:"w-3 h-3"})]})},t)})}),e.jsxs("div",{className:"flex items-center justify-end gap-1 mt-1 "+(i?"text-primary-foreground/70":"text-muted-foreground"),children:[e.jsx("span",{className:"text-xs",children:Oe(new Date(s.created_at),"h:mm a")}),i&&(s.is_read?e.jsx(Ks,{className:"w-3 h-3"}):e.jsx(je,{className:"w-3 h-3"}))]})]})]})})};return k?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(Se,{className:"w-12 h-12 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(pe,{className:"w-8 h-8 text-primary"}),"Messages",o.reduce((e,s)=>e+(s.unreadCount||0),0)>0&&e.jsxs(y,{variant:"destructive",className:"ml-2 text-sm",children:[o.reduce((e,s)=>e+(s.unreadCount||0),0)," unread"]})]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Communicate with your clients"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(P,{variant:"outline",onClick:()=>se(!0),children:[e.jsx(Us,{className:"w-4 h-4 mr-2"}),"Templates"]}),e.jsxs(P,{variant:"outline",onClick:()=>me(!0),children:[e.jsx(Vs,{className:"w-4 h-4 mr-2"}),"Broadcast"]}),e.jsxs(P,{onClick:()=>q(!0),children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"New Message"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(V,{className:"glass-effect lg:col-span-1",children:[e.jsx(H,{className:"pb-3",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(E,{placeholder:"Search conversations...",value:v,onChange:e=>N(e.target.value),className:"pl-10"})]})}),e.jsx(K,{className:"p-0",children:e.jsx("div",{className:"max-h-[600px] overflow-y-auto",children:Te.length>0?Te.map(s=>e.jsx(Fe,{conversation:s},s.partnerId)):e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx(pe,{className:"w-12 h-12 mx-auto text-muted-foreground mb-3 opacity-50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:v?"No conversations found":"No messages yet"}),e.jsxs(P,{variant:"outline",size:"sm",onClick:()=>q(!0),className:"mt-3",children:[e.jsx(Ce,{className:"w-4 h-4 mr-1"}),"Start a conversation"]})]})})})]}),e.jsx(V,{className:"glass-effect lg:col-span-2",children:x?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"border-b border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>u(null),className:"lg:hidden",children:e.jsx(Hs,{className:"w-4 h-4"})}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:(null==(s=x.partner)?void 0:s.profile_picture_url)?e.jsx("img",{src:x.partner.profile_picture_url,alt:x.partner.full_name,className:"w-10 h-10 rounded-full object-cover"}):e.jsx(we,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold",children:null==(t=x.partner)?void 0:t.full_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:null==(a=x.partner)?void 0:a.email})]}),e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>se(!0),children:e.jsx(Us,{className:"w-4 h-4"})})]})}),e.jsxs(K,{className:"p-0",children:[e.jsx("div",{className:"h-[400px] overflow-y-auto p-4",children:h.map(s=>e.jsx(ze,{message:s},s.id))}),Y.length>0&&e.jsx("div",{className:"px-4 py-2 border-t border-border bg-muted/50",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:Y.map((s,t)=>e.jsxs("div",{className:"flex items-center gap-2 bg-background p-2 rounded border",children:[s.preview?e.jsx("img",{src:s.preview,alt:s.name,className:"w-10 h-10 object-cover rounded"}):e.jsx(Ge,{className:"w-6 h-6 text-muted-foreground"}),e.jsx("span",{className:"text-xs truncate max-w-[100px]",children:s.name}),e.jsx(P,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>(e=>{Q(s=>{const t=[...s];return t[e].preview&&URL.revokeObjectURL(t[e].preview),t.splice(e,1),t})})(t),children:e.jsx(be,{className:"w-3 h-3"})})]},t))})}),e.jsxs("div",{className:"border-t border-border p-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{placeholder:"Type your message...",value:j,onChange:e=>f(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),Ee())},className:"min-h-[60px] resize-none"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("input",{type:"file",ref:X,onChange:async e=>{const s=Array.from(e.target.files);if(0===s.length)return;const t=["image/jpeg","image/png","image/gif","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"];for(const a of s){if(a.size>10485760){F({variant:"destructive",title:"File too large",description:`${a.name} exceeds 10MB limit`});continue}if(!t.includes(a.type)){F({variant:"destructive",title:"Invalid file type",description:`${a.name} is not a supported file type`});continue}const e=a.type.startsWith("image/")?URL.createObjectURL(a):null;Q(s=>[...s,{file:a,name:a.name,type:a.type,size:a.size,preview:e}])}e.target.value=""},multiple:!0,accept:"image/*,.pdf,.doc,.docx",className:"hidden"}),e.jsx(P,{variant:"outline",size:"icon",onClick:()=>{var e;return null==(e=X.current)?void 0:e.click()},title:"Attach file",children:e.jsx(Ys,{className:"w-4 h-4"})}),e.jsx(P,{onClick:Ee,disabled:!j.trim()&&0===Y.length||z,size:"icon",children:z?e.jsx(Se,{className:"w-4 h-4 animate-spin"}):e.jsx(hs,{className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Press Enter to send, Shift+Enter for new line"})]})]})]}):e.jsx(K,{className:"flex items-center justify-center h-[600px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(pe,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No conversation selected"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Choose a conversation from the list or start a new one"}),e.jsxs(P,{onClick:()=>q(!0),children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"New Message"]})]})})})]}),e.jsx(S,{open:L,onOpenChange:q,children:e.jsxs(M,{className:"glass-effect max-w-2xl",children:[e.jsx(A,{children:e.jsx($,{children:"New Message"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"To:"}),e.jsxs("select",{value:O,onChange:e=>B(e.target.value),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"",children:"Select a client"}),c.map(s=>e.jsxs("option",{value:s.id,children:[s.full_name," (",s.email,")"]},s.id))]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Message:"}),e.jsxs(P,{variant:"ghost",size:"sm",onClick:()=>se(!0),children:[e.jsx(Us,{className:"w-4 h-4 mr-1"}),"Use Template"]})]}),e.jsx(R,{value:G,onChange:e=>W(e.target.value),placeholder:"Type your message here...",rows:6})]})]}),e.jsxs(T,{children:[e.jsx(P,{variant:"outline",onClick:()=>q(!1),children:"Cancel"}),e.jsx(P,{onClick:async()=>{if(O&&G.trim()){I(!0);try{const{error:e}=await _.from("messages").insert({sender_id:l.id,recipient_id:O,message_text:G.trim(),is_read:!1});if(e)throw e;const s=(null==i?void 0:i.full_name)||"Your Nutritionist",t=G.trim().substring(0,50)+(G.trim().length>50?"...":"");r(O,`New message from ${s}`,t,{tag:"greenofig-message",data:{type:"message",url:"/app/messages"}}),F({title:"Message sent",description:"Your message has been sent successfully"}),q(!1),B(""),W(""),await _e()}catch(e){F({variant:"destructive",title:"Error",description:"Failed to send message"})}finally{I(!1)}}else F({variant:"destructive",title:"Error",description:"Please select a client and enter a message"})},disabled:z,children:z?e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(hs,{className:"w-4 h-4 mr-2"}),"Send Message"]})})]})]})}),e.jsx(S,{open:ee,onOpenChange:se,children:e.jsxs(M,{className:"glass-effect max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(A,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Us,{className:"w-5 h-5"}),"Message Templates"]})}),e.jsxs(Dt,{defaultValue:"use",children:[e.jsxs(Pt,{className:"grid w-full grid-cols-2",children:[e.jsx(Mt,{value:"use",children:"Use Template"}),e.jsx(Mt,{value:"manage",children:"Manage Templates"})]}),e.jsx(At,{value:"use",className:"space-y-3 mt-4",children:te.map(s=>e.jsx(V,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>(e=>{x?f(e.content):W(e.content),se(!1)})(s),children:e.jsxs(K,{className:"p-4",children:[e.jsx("h4",{className:"font-semibold text-sm mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.content})]})},s.id))}),e.jsxs(At,{value:"manage",className:"space-y-4 mt-4",children:[e.jsx(V,{children:e.jsxs(K,{className:"p-4 space-y-3",children:[e.jsx(E,{placeholder:"Template name...",value:re,onChange:e=>ne(e.target.value)}),e.jsx(R,{placeholder:"Template content...",value:ce,onChange:e=>de(e.target.value),rows:3}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(P,{onClick:()=>{re.trim()&&ce.trim()?(ae(le?e=>e.map(e=>e.id===le.id?{...e,name:re,content:ce}:e):e=>[...e,{id:Date.now(),name:re,content:ce}]),ie(null),ne(""),de(""),F({title:"Template saved"})):F({variant:"destructive",title:"Error",description:"Please fill in template name and content"})},className:"flex-1",children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),le?"Update":"Save"," Template"]}),le&&e.jsx(P,{variant:"outline",onClick:()=>{ie(null),ne(""),de("")},children:"Cancel"})]})]})}),e.jsx("div",{className:"space-y-2",children:te.map(s=>e.jsx(V,{children:e.jsxs(K,{className:"p-4 flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-sm",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:s.content})]}),e.jsxs("div",{className:"flex gap-1 ml-2",children:[e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>{ie(s),ne(s.name),de(s.content)},children:e.jsx(Ae,{className:"w-4 h-4"})}),e.jsx(P,{variant:"ghost",size:"sm",className:"text-destructive",onClick:()=>{return e=s.id,ae(s=>s.filter(s=>s.id!==e)),void F({title:"Template deleted"});var e},children:e.jsx($e,{className:"w-4 h-4"})})]})]})},s.id))})]})]})]})}),e.jsx(S,{open:oe,onOpenChange:me,children:e.jsxs(M,{className:"glass-effect max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(A,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Vs,{className:"w-5 h-5"}),"Broadcast Message"]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Message:"}),e.jsx(R,{value:xe,onChange:e=>ue(e.target.value),placeholder:"Type your broadcast message...",rows:4})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Select Recipients:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:fe,onChange:e=>{ve(e.target.value),ge([])},className:"text-sm px-2 py-1 border rounded",children:[e.jsx("option",{value:"all",children:"All Clients"}),e.jsx("option",{value:"Base",children:"Base Tier"}),e.jsx("option",{value:"Premium",children:"Premium Tier"}),e.jsx("option",{value:"Elite",children:"Elite Tier"})]}),e.jsx(P,{variant:"outline",size:"sm",onClick:()=>{const e=Re();ge(e.map(e=>e.id))},children:"Select All"}),e.jsx(P,{variant:"outline",size:"sm",onClick:()=>{ge([])},children:"Deselect All"})]})]}),e.jsx("div",{className:"border rounded-md max-h-[200px] overflow-y-auto",children:Re().map(s=>e.jsxs("div",{className:"flex items-center gap-3 p-3 border-b last:border-b-0 hover:bg-muted/50",children:[e.jsx($t,{checked:he.includes(s.id),onCheckedChange:()=>{return e=s.id,void ge(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e]);var e}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s.full_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.email})]}),e.jsx(y,{variant:"outline",className:"text-xs",children:s.tier||"Base"})]},s.id))}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:[he.length," client",1!==he.length?"s":""," selected"]})]})]}),e.jsxs(T,{children:[e.jsx(P,{variant:"outline",onClick:()=>me(!1),children:"Cancel"}),e.jsx(P,{onClick:async()=>{if(xe.trim()&&0!==he.length){I(!0);try{const e=he.map(e=>({sender_id:l.id,recipient_id:e,message_text:xe.trim(),is_read:!1})),{error:s}=await _.from("messages").insert(e);if(s)throw s;const t=(null==i?void 0:i.full_name)||"Your Nutritionist",a=xe.trim().substring(0,50)+(xe.trim().length>50?"...":"");for(const l of he)r(l,`Announcement from ${t}`,a,{tag:"greenofig-broadcast",data:{type:"message",url:"/app/messages"}});F({title:"Broadcast sent!",description:`Message sent to ${he.length} clients`}),me(!1),ue(""),ge([]),_e()}catch(e){F({variant:"destructive",title:"Error",description:"Failed to send broadcast"})}finally{I(!1)}}else F({variant:"destructive",title:"Error",description:"Please enter a message and select at least one client"})},disabled:z||0===he.length,children:z?e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(hs,{className:"w-4 h-4 mr-2"}),"Send to ",he.length," Client",1!==he.length?"s":""]})})]})]})})]})},Za=()=>{const{toast:s}=q(),[t,a]=g.useState(!0),[l,i]=g.useState(!1),[r,n]=g.useState("30"),[c,d]=g.useState({totalClients:0,activeClients:0,totalAppointments:0,completedAppointments:0,averageSuccessRate:0,totalRevenue:0}),[o,m]=g.useState([]),[x,u]=g.useState([]),[h,p]=g.useState([]),[j,f]=g.useState([]),[v,b]=g.useState([]),[N,y]=g.useState([]);g.useEffect(()=>{w()},[r]);const w=async()=>{a(!0);try{await Promise.all([k(),C(),S(),D(),M(),A(),$()])}catch(e){s({title:"Error",description:"Failed to load analytics data",variant:"destructive"})}finally{a(!1)}},k=async()=>{const e=new Date;e.setDate(e.getDate()-parseInt(r));const{data:s}=await _.from("user_profiles").select("id, role, created_at").eq("role","user"),t=(null==s?void 0:s.length)||0,a=(null==s?void 0:s.filter(s=>new Date(s.created_at)>=e).length)||0,{data:l}=await _.from("appointments").select("*").gte("appointment_date",e.toISOString()),i=(null==l?void 0:l.length)||0,n=(null==l?void 0:l.filter(e=>"completed"===e.status).length)||0,{data:c}=await _.from("client_progress").select("*").gte("date",e.toISOString()),o=(null==c?void 0:c.length)>0?c.filter(e=>e.weight_kg&&e.weight_kg>0).length/c.length*100:0;d({totalClients:t,activeClients:a,totalAppointments:i,completedAppointments:n,averageSuccessRate:Math.round(o),totalRevenue:75*i})},C=async()=>{const e=Qs(new Date,parseInt(r)),{data:s}=await _.from("client_progress").select("\n        *,\n        user_profiles!client_progress_user_id_fkey(full_name)\n      ").gte("date",e.toISOString()).order("date",{ascending:!0});if(s){const e=s.reduce((e,s)=>{const t=Oe(new Date(s.date),"MMM dd");return e[t]||(e[t]={date:t,totalWeight:0,count:0}),s.weight_kg&&(e[t].totalWeight+=s.weight_kg,e[t].count+=1),e},{}),t=Object.values(e).map(e=>({date:e.date,avgWeight:e.count>0?(e.totalWeight/e.count).toFixed(1):0}));m(t)}},S=async()=>{const e=Qs(new Date,parseInt(r)),{data:s}=await _.from("appointments").select("*").gte("appointment_date",e.toISOString()).order("appointment_date",{ascending:!0});if(s){const e=s.reduce((e,s)=>{const t=Oe(new Date(s.appointment_date),"MMM dd");return e[t]||(e[t]={date:t,scheduled:0,completed:0,cancelled:0}),"scheduled"===s.status&&(e[t].scheduled+=1),"completed"===s.status&&(e[t].completed+=1),"cancelled"===s.status&&(e[t].cancelled+=1),e},{});u(Object.values(e))}},D=async()=>{const{data:e}=await _.from("client_health_data").select("goals");if(e){const s=e.reduce((e,s)=>((s.goals||[]).forEach(s=>{e[s]=(e[s]||0)+1}),e),{}),t=Object.entries(s).map(([e,s])=>({name:e.replace("_"," ").toUpperCase(),value:s}));p(t)}},M=async()=>{const e=Qs(new Date,parseInt(r)),{data:s}=await _.from("habit_logs").select("\n        *,\n        client_habits!habit_logs_habit_id_fkey(habit_name)\n      ").gte("log_date",e.toISOString()).order("log_date",{ascending:!0});if(s){const e=s.reduce((e,s)=>{const t=Oe(new Date(s.log_date),"MMM dd");return e[t]||(e[t]={date:t,total:0,completed:0}),e[t].total+=1,s.completed&&(e[t].completed+=1),e},{}),t=Object.values(e).map(e=>({date:e.date,rate:e.total>0?Math.round(e.completed/e.total*100):0}));f(t)}},A=async()=>{const e=Qs(new Date,parseInt(r)),{data:s}=await _.from("client_progress").select("\n        user_id,\n        weight_kg,\n        date,\n        user_profiles!client_progress_user_id_fkey(full_name, email)\n      ").gte("date",e.toISOString()).order("date",{ascending:!0});if(s){const e=s.reduce((e,s)=>{var t,a;return e[s.user_id]||(e[s.user_id]={userId:s.user_id,name:(null==(t=s.user_profiles)?void 0:t.full_name)||"Unknown",email:(null==(a=s.user_profiles)?void 0:a.email)||"",weights:[]}),s.weight_kg&&e[s.user_id].weights.push(s.weight_kg),e},{}),t=Object.values(e).map(e=>{const s=e.weights;if(s.length<2)return null;const t=s[0],a=t-s[s.length-1],l=(a/t*100).toFixed(1);return{...e,weightChange:a.toFixed(1),percentChange:parseFloat(l)}}).filter(Boolean).sort((e,s)=>Math.abs(s.percentChange)-Math.abs(e.percentChange)).slice(0,5);b(t)}},$=async()=>{const e=Qs(new Date,parseInt(r)),{data:s}=await _.from("appointments").select("appointment_date, consultation_type").eq("status","completed").gte("appointment_date",e.toISOString()).order("appointment_date",{ascending:!0});if(s){const e=s.reduce((e,s)=>{const t=Oe(new Date(s.appointment_date),"MMM dd");e[t]||(e[t]={date:t,revenue:0});const a="initial"===s.consultation_type?100:"check_in"===s.consultation_type?50:75;return e[t].revenue+=a,e},{});y(Object.values(e))}},E=["hsl(142, 76%, 36%)","hsl(217, 91%, 60%)","hsl(38, 92%, 50%)","hsl(0, 84%, 60%)","hsl(258, 90%, 66%)","hsl(330, 81%, 60%)"];return t?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(se.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-foreground",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Track performance and client success metrics"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("select",{value:r,onChange:e=>n(e.target.value),className:"px-4 py-2 rounded-lg border border-border bg-card text-foreground whitespace-nowrap",children:[e.jsx("option",{value:"7",children:"Last 7 days"}),e.jsx("option",{value:"30",children:"Last 30 days"}),e.jsx("option",{value:"90",children:"Last 90 days"})]}),e.jsxs(P,{variant:"outline",onClick:async()=>{i(!0),await w(),i(!1),s({title:"Success",description:"Analytics data refreshed"})},disabled:l,className:"whitespace-nowrap",children:[e.jsx(ms,{className:"h-4 w-4 mr-2 flex-shrink-0 "+(l?"animate-spin":"")}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]}),e.jsxs(P,{onClick:()=>{s({title:"Export Started",description:"Generating analytics report..."})},className:"whitespace-nowrap",children:[e.jsx(as,{className:"h-4 w-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Export"})," Report"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(Xa,{icon:te,title:"Total Clients",value:c.totalClients,change:`+${c.activeClients} this period`,trend:"up",color:"blue"}),e.jsx(Xa,{icon:ye,title:"Appointments",value:c.totalAppointments,change:`${c.completedAppointments} completed`,trend:"up",color:"green"}),e.jsx(Xa,{icon:ae,title:"Success Rate",value:`${c.averageSuccessRate}%`,change:"Average client progress",trend:"up",color:"purple"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Average Client Progress"}),e.jsx(Fe,{className:"h-5 w-5 text-muted-foreground"})]}),e.jsx(ie,{width:"100%",height:300,children:e.jsxs(Js,{data:o,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorWeight",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"hsl(217, 91%, 60%)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"hsl(217, 91%, 60%)",stopOpacity:0})]})}),e.jsx(ne,{strokeDasharray:"3 3",className:"stroke-border"}),e.jsx(ce,{dataKey:"date",className:"stroke-muted-foreground"}),e.jsx(de,{className:"stroke-muted-foreground"}),e.jsx(oe,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--popover-foreground))"}}),e.jsx(Zs,{type:"monotone",dataKey:"avgWeight",stroke:"hsl(217, 91%, 60%)",fillOpacity:1,fill:"url(#colorWeight)"})]})})]}),e.jsxs(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Appointment Trends"}),e.jsx(Re,{className:"h-5 w-5 text-gray-400"})]}),e.jsx(ie,{width:"100%",height:300,children:e.jsxs(Xs,{data:x,children:[e.jsx(ne,{strokeDasharray:"3 3",className:"stroke-border"}),e.jsx(ce,{dataKey:"date",className:"stroke-muted-foreground"}),e.jsx(de,{className:"stroke-muted-foreground"}),e.jsx(oe,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--popover-foreground))"}}),e.jsx(me,{}),e.jsx(et,{dataKey:"scheduled",fill:"hsl(217, 91%, 60%)",name:"Scheduled"}),e.jsx(et,{dataKey:"completed",fill:"hsl(142, 76%, 36%)",name:"Completed"}),e.jsx(et,{dataKey:"cancelled",fill:"hsl(0, 84%, 60%)",name:"Cancelled"})]})})]}),e.jsxs(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Client Goals Distribution"}),e.jsx(st,{className:"h-5 w-5 text-gray-400"})]}),e.jsx(ie,{width:"100%",height:300,children:e.jsxs(ze,{children:[e.jsx(Ie,{data:h,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,percent:s})=>`${e} ${(100*s).toFixed(0)}%`,outerRadius:80,fill:"hsl(217, 91%, 60%)",dataKey:"value",children:h.map((s,t)=>e.jsx(Le,{fill:E[t%E.length]},`cell-${t}`))}),e.jsx(oe,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--popover-foreground))"}})]})})]}),e.jsxs(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Client Compliance Rate"}),e.jsx(ts,{className:"h-5 w-5 text-gray-400"})]}),e.jsx(ie,{width:"100%",height:300,children:e.jsxs(re,{data:j,children:[e.jsx(ne,{strokeDasharray:"3 3",className:"stroke-border"}),e.jsx(ce,{dataKey:"date",className:"stroke-muted-foreground"}),e.jsx(de,{className:"stroke-muted-foreground"}),e.jsx(oe,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--popover-foreground))"}}),e.jsx(xe,{type:"monotone",dataKey:"rate",stroke:"hsl(142, 76%, 36%)",strokeWidth:2,dot:{fill:"hsl(142, 76%, 36%)"}})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Top Performers"}),e.jsx(ts,{className:"h-5 w-5 text-yellow-500"})]}),0===v.length?e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No progress data available"}):e.jsx("div",{className:"space-y-4",children:v.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 text-primary font-bold",children:t+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold "+(s.weightChange>0?"text-destructive":"text-primary"),children:[s.weightChange>0?"+":"",s.weightChange," kg"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[Math.abs(s.percentChange),"% change"]})]})]},s.userId))})]}),e.jsxs(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Revenue Trends"}),e.jsx(le,{className:"h-5 w-5 text-green-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-3xl font-bold text-foreground",children:["$",c.totalRevenue.toLocaleString()]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total revenue this period"})]}),e.jsx(ie,{width:"100%",height:200,children:e.jsxs(Js,{data:N,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorRevenue",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"hsl(142, 76%, 36%)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"hsl(142, 76%, 36%)",stopOpacity:0})]})}),e.jsx(ne,{strokeDasharray:"3 3",className:"stroke-border"}),e.jsx(ce,{dataKey:"date",className:"stroke-muted-foreground"}),e.jsx(de,{className:"stroke-muted-foreground"}),e.jsx(oe,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--popover-foreground))"}}),e.jsx(Zs,{type:"monotone",dataKey:"revenue",stroke:"hsl(142, 76%, 36%)",fillOpacity:1,fill:"url(#colorRevenue)"})]})})]})]})]})},Xa=({icon:s,title:t,value:a,change:l,trend:i,color:r})=>e.jsx(se.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:t}),e.jsx("p",{className:"text-3xl font-bold text-card-foreground mb-2",children:a}),e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:["up"===i?e.jsx(ee,{className:"h-4 w-4 text-primary"}):e.jsx(Qe,{className:"h-4 w-4 text-destructive"}),e.jsx("span",{className:"up"===i?"text-primary":"text-destructive",children:l})]})]}),e.jsx("div",{className:`p-3 rounded-lg ${{blue:"bg-blue-500/10 text-blue-500",green:"bg-primary/10 text-primary",purple:"bg-violet-500/10 text-violet-500",red:"bg-destructive/10 text-destructive"}[r]}`,children:e.jsx(s,{className:"h-6 w-6"})})]})}),el=()=>{w();const[s,t]=g.useState(!0),[a,l]=g.useState(30),[i,r]=g.useState("");g.useState(null);const[n,c]=g.useState([]),[d,o]=g.useState({totalClients:0,activeClients:0,goalsAchieved:0,avgSuccessRate:0,totalWeightLoss:0,avgEngagement:0}),[m,x]=g.useState([]),[u,h]=g.useState([]),[p,j]=g.useState([]);g.useEffect(()=>{f()},[a]);const f=async()=>{t(!0);try{await Promise.all([v(),b(),N(),k(),C()])}catch(e){}finally{t(!1)}},v=async()=>{try{const{data:e,error:s}=await _.from("user_profiles").select("\n          id, full_name, email, tier, created_at,\n          goal_type, current_weight_kg, target_weight_kg\n        ").eq("role","user").order("full_name");if(s)throw s;const t=await Promise.all((e||[]).map(async e=>{var s,t,a;const{data:l}=await _.from("client_progress").select("*").eq("user_id",e.id).order("created_at",{ascending:!1}).limit(30),{data:i}=await _.from("client_goals").select("*").eq("client_id",e.id),r=l&&l.length>1?parseFloat((null==(s=l[l.length-1])?void 0:s.weight_kg)||0)-parseFloat((null==(t=l[0])?void 0:t.weight_kg)||0):0,n=(null==i?void 0:i.filter(e=>"completed"===e.status).length)||0,c=(null==i?void 0:i.length)||0,d=c>0?Math.round(n/c*100):0;return{...e,progress:l||[],goals:i||[],weightChange:r,successRate:d,completedGoals:n,totalGoals:c,lastActive:(null==(a=null==l?void 0:l[0])?void 0:a.created_at)||e.created_at}}));c(t)}catch(e){}},b=async()=>{try{const{data:e}=await _.from("user_profiles").select("id").eq("role","user"),s=(null==e?void 0:e.length)||0,t=new Date;t.setDate(t.getDate()-a);const{data:l}=await _.from("client_progress").select("user_id").gte("created_at",t.toISOString()),i=new Set(null==l?void 0:l.map(e=>e.user_id)).size,{data:r}=await _.from("client_goals").select("status"),n=(null==r?void 0:r.filter(e=>"completed"===e.status).length)||0,c=(null==r?void 0:r.length)||1,{data:d}=await _.from("client_progress").select("weight_kg, user_id").order("created_at",{ascending:!0});let m=0;const x={};null==d||d.forEach(e=>{x[e.user_id]?x[e.user_id].last=parseFloat(e.weight_kg):x[e.user_id]={first:parseFloat(e.weight_kg),last:parseFloat(e.weight_kg)}}),Object.values(x).forEach(e=>{const s=e.first-e.last;s>0&&(m+=s)}),o({totalClients:s,activeClients:i,goalsAchieved:n,avgSuccessRate:Math.round(n/c*100),totalWeightLoss:Math.round(10*m)/10,avgEngagement:s>0?Math.round(i/s*100):0})}catch(e){}},N=async()=>{try{const e=new Date;e.setDate(e.getDate()-a);const{data:s,error:t}=await _.from("client_progress").select("created_at, weight_kg").gte("created_at",e.toISOString()).order("created_at",{ascending:!0});if(t)throw t;const l={};(s||[]).forEach(e=>{const s=new Date(e.created_at),t=new Date(s);t.setDate(s.getDate()-s.getDay());const a=t.toISOString().split("T")[0];l[a]||(l[a]={weights:[],count:0}),l[a].weights.push(parseFloat(e.weight_kg)),l[a].count++});const i=Object.entries(l).map(([e,s])=>({week:new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"}),avgWeight:Math.round(s.weights.reduce((e,s)=>e+s,0)/s.weights.length*10)/10,entries:s.count}));x(i)}catch(e){}},k=async()=>{try{const{data:e,error:s}=await _.from("client_goals").select("goal_type, status");if(s)throw s;const t={};(e||[]).forEach(e=>{const s=e.goal_type||"Other";t[s]||(t[s]={total:0,completed:0}),t[s].total++,"completed"===e.status&&t[s].completed++});const a=Object.entries(t).map(([e,s])=>({name:e.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase()),total:s.total,completed:s.completed,rate:Math.round(s.completed/s.total*100)}));h(a)}catch(e){}},C=async()=>{try{const e=new Date;e.setDate(e.getDate()-a);const{data:s}=await _.from("client_progress").select("created_at").gte("created_at",e.toISOString()),{data:t}=await _.from("meals").select("created_at").gte("created_at",e.toISOString()),{data:l}=await _.from("messages").select("created_at").gte("created_at",e.toISOString()),i={},r=(e,s)=>{(e||[]).forEach(e=>{const t=new Date(e.created_at),a=new Date(t);a.setDate(t.getDate()-t.getDay());const l=a.toISOString().split("T")[0];i[l]||(i[l]={progress:0,meals:0,messages:0}),i[l][s]++})};r(s,"progress"),r(t,"meals"),r(l,"messages");const n=Object.entries(i).sort(([e],[s])=>new Date(e)-new Date(s)).map(([e,s])=>({week:new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"}),...s}));j(n)}catch(e){}},S=n.filter(e=>{var s,t;return(null==(s=e.full_name)?void 0:s.toLowerCase().includes(i.toLowerCase()))||(null==(t=e.email)?void 0:t.toLowerCase().includes(i.toLowerCase()))}),D=({title:s,value:t,subtitle:a,icon:l,trend:i,color:r="primary"})=>e.jsx(V,{children:e.jsxs(K,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s}),e.jsx("p",{className:"text-3xl font-bold mt-1",children:t}),a&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a})]}),e.jsx("div",{className:`p-3 rounded-full bg-${r}/10`,children:e.jsx(l,{className:`w-6 h-6 text-${r}`})})]}),void 0!==i&&e.jsxs("div",{className:"flex items-center mt-3 text-sm "+(i>0?"text-green-500":i<0?"text-red-500":"text-muted-foreground"),children:[i>0?e.jsx(tt,{className:"w-4 h-4 mr-1"}):i<0?e.jsx(at,{className:"w-4 h-4 mr-1"}):e.jsx(lt,{className:"w-4 h-4 mr-1"}),Math.abs(i),"% from last period"]})]})});return s?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(Se,{className:"w-12 h-12 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(ts,{className:"w-8 h-8 text-primary"}),"Client Success Dashboard"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Track client outcomes and engagement"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:a,onChange:e=>l(Number(e.target.value)),className:"px-3 py-2 border rounded-md bg-background",children:[e.jsx("option",{value:7,children:"Last 7 days"}),e.jsx("option",{value:30,children:"Last 30 days"}),e.jsx("option",{value:60,children:"Last 60 days"}),e.jsx("option",{value:90,children:"Last 90 days"})]}),e.jsxs(P,{variant:"outline",onClick:f,children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"Refresh"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(D,{title:"Total Clients",value:d.totalClients,icon:te,subtitle:`${d.activeClients} active`}),e.jsx(D,{title:"Goals Achieved",value:d.goalsAchieved,icon:ae,subtitle:`${d.avgSuccessRate}% success rate`}),e.jsx(D,{title:"Total Weight Loss",value:`${d.totalWeightLoss} kg`,icon:he,subtitle:"Across all clients"}),e.jsx(D,{title:"Client Engagement",value:`${d.avgEngagement}%`,icon:Re,subtitle:"Active in selected period"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(V,{children:[e.jsx(H,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),"Average Client Progress"]})}),e.jsx(K,{children:e.jsx(ie,{width:"100%",height:300,children:e.jsxs(re,{data:m,children:[e.jsx(ne,{strokeDasharray:"3 3"}),e.jsx(ce,{dataKey:"week"}),e.jsx(de,{}),e.jsx(oe,{}),e.jsx(me,{}),e.jsx(xe,{type:"monotone",dataKey:"avgWeight",stroke:"#10b981",strokeWidth:2,name:"Avg Weight (kg)"}),e.jsx(xe,{type:"monotone",dataKey:"entries",stroke:"#3b82f6",strokeWidth:2,name:"Log Entries"})]})})})]}),e.jsxs(V,{children:[e.jsx(H,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(st,{className:"w-5 h-5"}),"Goal Achievement by Type"]})}),e.jsx(K,{children:e.jsx(ie,{width:"100%",height:300,children:e.jsxs(Xs,{data:u,layout:"vertical",children:[e.jsx(ne,{strokeDasharray:"3 3"}),e.jsx(ce,{type:"number"}),e.jsx(de,{dataKey:"name",type:"category",width:100}),e.jsx(oe,{}),e.jsx(me,{}),e.jsx(et,{dataKey:"completed",fill:"#10b981",name:"Completed"}),e.jsx(et,{dataKey:"total",fill:"#e5e7eb",name:"Total"})]})})})]})]}),e.jsxs(V,{children:[e.jsx(H,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-5 h-5"}),"Client Engagement Over Time"]})}),e.jsx(K,{children:e.jsx(ie,{width:"100%",height:300,children:e.jsxs(Xs,{data:p,children:[e.jsx(ne,{strokeDasharray:"3 3"}),e.jsx(ce,{dataKey:"week"}),e.jsx(de,{}),e.jsx(oe,{}),e.jsx(me,{}),e.jsx(et,{dataKey:"progress",fill:"#10b981",name:"Progress Logs"}),e.jsx(et,{dataKey:"meals",fill:"#3b82f6",name:"Meal Logs"}),e.jsx(et,{dataKey:"messages",fill:"#f59e0b",name:"Messages"})]})})})]}),e.jsxs(V,{children:[e.jsx(H,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"w-5 h-5"}),"Client Leaderboard"]}),e.jsxs("div",{className:"relative w-64",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(E,{placeholder:"Search clients...",value:i,onChange:e=>r(e.target.value),className:"pl-10"})]})]})}),e.jsx(K,{children:e.jsx("div",{className:"space-y-3",children:S.sort((e,s)=>s.successRate-e.successRate).slice(0,10).map((s,t)=>e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-muted/50 rounded-lg hover:bg-muted transition-colors",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm "+(0===t?"bg-yellow-500 text-white":1===t?"bg-gray-400 text-white":2===t?"bg-amber-600 text-white":"bg-muted-foreground/20"),children:t+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold",children:s.full_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email})]}),e.jsx("div",{className:"text-right",children:e.jsx(y,{variant:"Elite"===s.tier?"default":"Premium"===s.tier?"secondary":"outline",children:s.tier||"Base"})}),e.jsxs("div",{className:"w-32",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{children:"Success"}),e.jsxs("span",{className:"font-semibold",children:[s.successRate,"%"]})]}),e.jsx(yt,{value:s.successRate,className:"h-2"})]}),e.jsxs("div",{className:"text-right w-24",children:[e.jsxs("p",{className:"text-sm font-semibold "+(s.weightChange<0?"text-green-500":s.weightChange>0?"text-red-500":""),children:[s.weightChange>0?"+":"",s.weightChange.toFixed(1)," kg"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Weight Change"})]}),e.jsxs("div",{className:"text-right w-20",children:[e.jsxs("p",{className:"text-sm font-semibold",children:[s.completedGoals,"/",s.totalGoals]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Goals"})]})]},s.id))})})]})]})},sl=()=>{var s,t,a,l,i,r,n,c,d,o,m,x;w();const[u,h]=g.useState(!0),[p,j]=g.useState(!1);g.useState(null);const[f,v]=g.useState({start:Oe(Fs(new Date),"yyyy-MM-dd"),end:Oe(zs(new Date),"yyyy-MM-dd")}),[b,N]=g.useState({clientProgress:[],revenue:[],appointments:[],retention:[]}),k=["#10b981","#3b82f6","#f59e0b","#ef4444","#8b5cf6"];g.useEffect(()=>{C()},[f]);const C=async()=>{h(!0);try{await Promise.all([S(),D(),M(),A()])}catch(e){}finally{h(!1)}},S=async()=>{try{const{data:e}=await _.from("client_progress").select("\n          *,\n          user:user_profiles!client_progress_user_id_fkey(full_name, email, tier)\n        ").gte("created_at",f.start).lte("created_at",f.end).order("created_at"),s={};(e||[]).forEach(e=>{const t=Oe(new Date(e.created_at),"MMM d");s[t]||(s[t]={date:t,entries:0,avgWeight:0,weights:[]}),s[t].entries++,s[t].weights.push(parseFloat(e.weight_kg||0))});const t=Object.values(s).map(e=>({...e,avgWeight:e.weights.length>0?Math.round(e.weights.reduce((e,s)=>e+s,0)/e.weights.length*10)/10:0}));N(e=>({...e,clientProgress:t}))}catch(e){}},D=async()=>{try{const{data:e}=await _.from("user_profiles").select("id, tier, created_at").eq("role","user").gte("created_at",f.start).lte("created_at",f.end),s={Base:0,Premium:29,Elite:59},t={};(e||[]).forEach(e=>{const a=Oe(new Date(e.created_at),"MMM yyyy");t[a]||(t[a]={month:a,revenue:0,newClients:0}),t[a].revenue+=s[e.tier]||0,t[a].newClients++});const{data:a}=await _.from("user_profiles").select("tier").eq("role","user"),l=(a||[]).reduce((e,t)=>e+(s[t.tier]||0),0);N(e=>({...e,revenue:{monthly:Object.values(t),recurring:l,tierBreakdown:[{name:"Base",value:(a||[]).filter(e=>"Base"===e.tier||!e.tier).length},{name:"Premium",value:(a||[]).filter(e=>"Premium"===e.tier).length},{name:"Elite",value:(a||[]).filter(e=>"Elite"===e.tier).length}]}}))}catch(e){}},M=async()=>{try{const{data:e}=await _.from("appointments").select("*").gte("date",f.start).lte("date",f.end),s={scheduled:0,completed:0,cancelled:0,no_show:0},t={};(e||[]).forEach(e=>{s[e.status]=(s[e.status]||0)+1;const a=e.consultation_type||"Other";t[a]=(t[a]||0)+1}),N(a=>({...a,appointments:{total:(null==e?void 0:e.length)||0,statusBreakdown:Object.entries(s).map(([e,s])=>({name:e,value:s})),typeBreakdown:Object.entries(t).map(([e,s])=>({name:e,value:s})),completionRate:(null==e?void 0:e.length)>0?Math.round(s.completed/e.length*100):0}}))}catch(e){}},A=async()=>{try{const{data:e}=await _.from("user_profiles").select("id, created_at").eq("role","user"),{data:s}=await _.from("client_progress").select("user_id, created_at").gte("created_at",Qs(new Date,30).toISOString()),t=new Set((s||[]).map(e=>e.user_id)),a=(null==e?void 0:e.length)||0,l=t.size,i=a>0?Math.round(l/a*100):0,r=[];for(let n=5;n>=0;n--){const s=Fs(Qs(new Date,30*n)),t=zs(s),a=Oe(s,"MMM"),i=(e||[]).filter(e=>new Date(e.created_at)<=t).length;r.push({month:a,clients:i,retention:i>0?Math.round(l/i*100):0})}N(e=>({...e,retention:{current:i,totalClients:a,activeClients:l,trend:r}}))}catch(e){}},$=()=>`\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <title>Client Progress Report - GreenoFig</title>\n      <style>\n        body { font-family: Arial, sans-serif; padding: 40px; }\n        h1 { color: #10b981; }\n        table { width: 100%; border-collapse: collapse; margin-top: 20px; }\n        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }\n        th { background-color: #f4f4f4; }\n        .footer { margin-top: 40px; text-align: center; color: #888; }\n      </style>\n    </head>\n    <body>\n      <h1>Client Progress Report</h1>\n      <p>Period: ${f.start} to ${f.end}</p>\n      <p>Generated: ${Oe(new Date,"PPP")}</p>\n\n      <h2>Summary</h2>\n      <p>Total Progress Entries: ${b.clientProgress.reduce((e,s)=>e+s.entries,0)}</p>\n\n      <h2>Daily Activity</h2>\n      <table>\n        <tr><th>Date</th><th>Entries</th><th>Avg Weight (kg)</th></tr>\n        ${b.clientProgress.map(e=>`\n          <tr><td>${e.date}</td><td>${e.entries}</td><td>${e.avgWeight}</td></tr>\n        `).join("")}\n      </table>\n\n      <div class="footer">\n        <p>GreenoFig Nutrition Platform - Confidential Report</p>\n      </div>\n    </body>\n    </html>\n  `,R=()=>{var e,s;return`\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <title>Revenue Report - GreenoFig</title>\n      <style>\n        body { font-family: Arial, sans-serif; padding: 40px; }\n        h1 { color: #10b981; }\n        .stat { background: #f4f4f4; padding: 20px; margin: 10px 0; border-radius: 8px; }\n        .stat h3 { margin: 0; color: #666; font-size: 14px; }\n        .stat p { margin: 5px 0 0; font-size: 24px; font-weight: bold; }\n        .footer { margin-top: 40px; text-align: center; color: #888; }\n      </style>\n    </head>\n    <body>\n      <h1>Revenue Report</h1>\n      <p>Period: ${f.start} to ${f.end}</p>\n      <p>Generated: ${Oe(new Date,"PPP")}</p>\n\n      <div class="stat">\n        <h3>Monthly Recurring Revenue</h3>\n        <p>$${(null==(e=b.revenue)?void 0:e.recurring)||0}</p>\n      </div>\n\n      <h2>Tier Distribution</h2>\n      ${((null==(s=b.revenue)?void 0:s.tierBreakdown)||[]).map(e=>`\n        <div class="stat">\n          <h3>${e.name} Tier</h3>\n          <p>${e.value} clients</p>\n        </div>\n      `).join("")}\n\n      <div class="footer">\n        <p>GreenoFig Nutrition Platform - Confidential Report</p>\n      </div>\n    </body>\n    </html>\n  `},T=()=>{var e,s,t;return`\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <title>Appointments Report - GreenoFig</title>\n      <style>\n        body { font-family: Arial, sans-serif; padding: 40px; }\n        h1 { color: #10b981; }\n        table { width: 100%; border-collapse: collapse; margin-top: 20px; }\n        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }\n        th { background-color: #f4f4f4; }\n        .footer { margin-top: 40px; text-align: center; color: #888; }\n      </style>\n    </head>\n    <body>\n      <h1>Appointments Report</h1>\n      <p>Period: ${f.start} to ${f.end}</p>\n      <p>Generated: ${Oe(new Date,"PPP")}</p>\n\n      <h2>Summary</h2>\n      <p>Total Appointments: ${(null==(e=b.appointments)?void 0:e.total)||0}</p>\n      <p>Completion Rate: ${(null==(s=b.appointments)?void 0:s.completionRate)||0}%</p>\n\n      <h2>Status Breakdown</h2>\n      <table>\n        <tr><th>Status</th><th>Count</th></tr>\n        ${((null==(t=b.appointments)?void 0:t.statusBreakdown)||[]).map(e=>`\n          <tr><td>${e.name}</td><td>${e.value}</td></tr>\n        `).join("")}\n      </table>\n\n      <div class="footer">\n        <p>GreenoFig Nutrition Platform - Confidential Report</p>\n      </div>\n    </body>\n    </html>\n  `},z=()=>{var e,s,t;return`\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <title>Client Retention Report - GreenoFig</title>\n      <style>\n        body { font-family: Arial, sans-serif; padding: 40px; }\n        h1 { color: #10b981; }\n        .stat { background: #f4f4f4; padding: 20px; margin: 10px 0; border-radius: 8px; }\n        .stat h3 { margin: 0; color: #666; font-size: 14px; }\n        .stat p { margin: 5px 0 0; font-size: 24px; font-weight: bold; }\n        .footer { margin-top: 40px; text-align: center; color: #888; }\n      </style>\n    </head>\n    <body>\n      <h1>Client Retention Report</h1>\n      <p>Generated: ${Oe(new Date,"PPP")}</p>\n\n      <div class="stat">\n        <h3>Current Retention Rate</h3>\n        <p>${(null==(e=b.retention)?void 0:e.current)||0}%</p>\n      </div>\n\n      <div class="stat">\n        <h3>Total Clients</h3>\n        <p>${(null==(s=b.retention)?void 0:s.totalClients)||0}</p>\n      </div>\n\n      <div class="stat">\n        <h3>Active Clients (30 days)</h3>\n        <p>${(null==(t=b.retention)?void 0:t.activeClients)||0}</p>\n      </div>\n\n      <div class="footer">\n        <p>GreenoFig Nutrition Platform - Confidential Report</p>\n      </div>\n    </body>\n    </html>\n  `},I=()=>{var e,s,t;return`\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <title>Summary Report - GreenoFig</title>\n      <style>\n        body { font-family: Arial, sans-serif; padding: 40px; }\n        h1 { color: #10b981; }\n        .section { margin: 30px 0; }\n        .stat { display: inline-block; background: #f4f4f4; padding: 20px; margin: 10px; border-radius: 8px; min-width: 150px; }\n        .footer { margin-top: 40px; text-align: center; color: #888; }\n      </style>\n    </head>\n    <body>\n      <h1>Summary Report</h1>\n      <p>Period: ${f.start} to ${f.end}</p>\n      <p>Generated: ${Oe(new Date,"PPP")}</p>\n\n      <div class="section">\n        <h2>Overview</h2>\n        <div class="stat">\n          <strong>Revenue</strong><br/>$${(null==(e=b.revenue)?void 0:e.recurring)||0}/mo\n        </div>\n        <div class="stat">\n          <strong>Retention</strong><br/>${(null==(s=b.retention)?void 0:s.current)||0}%\n        </div>\n        <div class="stat">\n          <strong>Appointments</strong><br/>${(null==(t=b.appointments)?void 0:t.total)||0}\n        </div>\n      </div>\n\n      <div class="footer">\n        <p>GreenoFig Nutrition Platform - Confidential Report</p>\n      </div>\n    </body>\n    </html>\n  `},L=[{id:"summary",title:"Summary Report",icon:Ge,description:"Overview of all metrics"},{id:"client-progress",title:"Client Progress",icon:ee,description:"Weight tracking and progress data"},{id:"revenue",title:"Revenue Report",icon:le,description:"Monthly revenue and tier breakdown"},{id:"appointments",title:"Appointments",icon:ye,description:"Appointment statistics and completion rates"},{id:"retention",title:"Client Retention",icon:te,description:"Retention rates and client activity"}];return u?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(Se,{className:"w-12 h-12 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(Ge,{className:"w-8 h-8 text-primary"}),"Reports Center"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Generate and export detailed reports"})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(E,{type:"date",value:f.start,onChange:e=>v(s=>({...s,start:e.target.value})),className:"w-40"}),e.jsx("span",{className:"text-muted-foreground",children:"to"}),e.jsx(E,{type:"date",value:f.end,onChange:e=>v(s=>({...s,end:e.target.value})),className:"w-40"}),e.jsx(P,{variant:"outline",onClick:C,children:e.jsx(ms,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:L.map(s=>e.jsx(V,{className:"cursor-pointer hover:border-primary transition-colors",onClick:()=>(async e=>{j(!0);try{let s="";switch(e){case"client-progress":s=$();break;case"revenue":s=R();break;case"appointments":s=T();break;case"retention":s=z();break;default:s=I()}const t=window.open("","_blank");t.document.write(s),t.document.close(),t.print(),F({title:"Report Generated",description:"Your report is ready for printing or saving as PDF"})}catch(s){F({variant:"destructive",title:"Error",description:"Failed to generate report"})}finally{j(!1)}})(s.id),children:e.jsxs(K,{className:"p-4 text-center",children:[e.jsx(s.icon,{className:"w-8 h-8 mx-auto mb-2 text-primary"}),e.jsx("h3",{className:"font-semibold text-sm",children:s.title}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.description}),e.jsxs(P,{size:"sm",variant:"outline",className:"mt-3",disabled:p,children:[p?e.jsx(Se,{className:"w-4 h-4 animate-spin"}):e.jsx(as,{className:"w-4 h-4 mr-1"}),"Export"]})]})},s.id))}),e.jsxs(Dt,{defaultValue:"progress",children:[e.jsxs(Pt,{children:[e.jsx(Mt,{value:"progress",children:"Client Progress"}),e.jsx(Mt,{value:"revenue",children:"Revenue"}),e.jsx(Mt,{value:"appointments",children:"Appointments"}),e.jsx(Mt,{value:"retention",children:"Retention"})]}),e.jsx(At,{value:"progress",children:e.jsxs(V,{children:[e.jsx(H,{children:e.jsx(Y,{children:"Client Progress Overview"})}),e.jsx(K,{children:e.jsx(ie,{width:"100%",height:300,children:e.jsxs(Xs,{data:b.clientProgress,children:[e.jsx(ne,{strokeDasharray:"3 3"}),e.jsx(ce,{dataKey:"date"}),e.jsx(de,{}),e.jsx(oe,{}),e.jsx(me,{}),e.jsx(et,{dataKey:"entries",fill:"#10b981",name:"Progress Entries"})]})})})]})}),e.jsx(At,{value:"revenue",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(V,{children:[e.jsx(H,{children:e.jsx(Y,{children:"Monthly Recurring Revenue"})}),e.jsxs(K,{children:[e.jsxs("div",{className:"text-4xl font-bold text-green-500 mb-4",children:["$",(null==(s=b.revenue)?void 0:s.recurring)||0,"/mo"]}),e.jsx(ie,{width:"100%",height:200,children:e.jsxs(ze,{children:[e.jsx(Ie,{data:(null==(t=b.revenue)?void 0:t.tierBreakdown)||[],cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,dataKey:"value",label:({name:e,value:s})=>`${e}: ${s}`,children:((null==(a=b.revenue)?void 0:a.tierBreakdown)||[]).map((s,t)=>e.jsx(Le,{fill:k[t%k.length]},`cell-${t}`))}),e.jsx(oe,{})]})})]})]}),e.jsxs(V,{children:[e.jsx(H,{children:e.jsx(Y,{children:"Tier Distribution"})}),e.jsx(K,{children:e.jsx("div",{className:"space-y-4",children:((null==(l=b.revenue)?void 0:l.tierBreakdown)||[]).map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 rounded",style:{backgroundColor:k[t]}}),e.jsx("span",{children:s.name})]}),e.jsxs(y,{variant:"outline",children:[s.value," clients"]})]},s.name))})})]})]})}),e.jsx(At,{value:"appointments",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(V,{children:[e.jsx(H,{children:e.jsx(Y,{children:"Appointment Status"})}),e.jsxs(K,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Completion Rate"}),e.jsxs("div",{className:"text-3xl font-bold",children:[(null==(i=b.appointments)?void 0:i.completionRate)||0,"%"]})]}),e.jsx(ie,{width:"100%",height:200,children:e.jsxs(ze,{children:[e.jsx(Ie,{data:(null==(r=b.appointments)?void 0:r.statusBreakdown)||[],cx:"50%",cy:"50%",outerRadius:80,dataKey:"value",label:!0,children:((null==(n=b.appointments)?void 0:n.statusBreakdown)||[]).map((s,t)=>e.jsx(Le,{fill:k[t%k.length]},`cell-${t}`))}),e.jsx(oe,{}),e.jsx(me,{})]})})]})]}),e.jsxs(V,{children:[e.jsx(H,{children:e.jsx(Y,{children:"By Type"})}),e.jsx(K,{children:e.jsx(ie,{width:"100%",height:250,children:e.jsxs(Xs,{data:(null==(c=b.appointments)?void 0:c.typeBreakdown)||[],layout:"vertical",children:[e.jsx(ne,{strokeDasharray:"3 3"}),e.jsx(ce,{type:"number"}),e.jsx(de,{dataKey:"name",type:"category",width:120}),e.jsx(oe,{}),e.jsx(et,{dataKey:"value",fill:"#3b82f6"})]})})})]})]})}),e.jsxs(At,{value:"retention",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(V,{children:e.jsxs(K,{className:"p-6 text-center",children:[e.jsx(Re,{className:"w-12 h-12 mx-auto mb-2 text-primary"}),e.jsxs("div",{className:"text-4xl font-bold",children:[(null==(d=b.retention)?void 0:d.current)||0,"%"]}),e.jsx("p",{className:"text-muted-foreground",children:"Current Retention Rate"})]})}),e.jsx(V,{children:e.jsxs(K,{className:"p-6 text-center",children:[e.jsx(te,{className:"w-12 h-12 mx-auto mb-2 text-blue-500"}),e.jsx("div",{className:"text-4xl font-bold",children:(null==(o=b.retention)?void 0:o.totalClients)||0}),e.jsx("p",{className:"text-muted-foreground",children:"Total Clients"})]})}),e.jsx(V,{children:e.jsxs(K,{className:"p-6 text-center",children:[e.jsx(ae,{className:"w-12 h-12 mx-auto mb-2 text-green-500"}),e.jsx("div",{className:"text-4xl font-bold",children:(null==(m=b.retention)?void 0:m.activeClients)||0}),e.jsx("p",{className:"text-muted-foreground",children:"Active (30 days)"})]})})]}),e.jsxs(V,{className:"mt-6",children:[e.jsx(H,{children:e.jsx(Y,{children:"Retention Trend"})}),e.jsx(K,{children:e.jsx(ie,{width:"100%",height:300,children:e.jsxs(re,{data:(null==(x=b.retention)?void 0:x.trend)||[],children:[e.jsx(ne,{strokeDasharray:"3 3"}),e.jsx(ce,{dataKey:"month"}),e.jsx(de,{}),e.jsx(oe,{}),e.jsx(me,{}),e.jsx(xe,{type:"monotone",dataKey:"clients",stroke:"#3b82f6",name:"Total Clients"}),e.jsx(xe,{type:"monotone",dataKey:"retention",stroke:"#10b981",name:"Retention %"})]})})})]})]})]})]})},tl=()=>{const{toast:s}=q(),[t,a]=g.useState(!0),[l,i]=g.useState([]),[r,n]=g.useState([]),[c,d]=g.useState(""),[o,m]=g.useState("all"),[x,u]=g.useState(null),[h,p]=g.useState(!1),[j,f]=g.useState(!1),[v,b]=g.useState({title:"",description:"",content:"",resource_type:"article",category:"nutrition",url:"",file_url:"",tags:[],is_public:!0}),[N,w]=g.useState(""),k=[{value:"all",label:"All Resources",icon:nt},{value:"nutrition",label:"Nutrition",icon:it},{value:"exercise",label:"Exercise",icon:it},{value:"wellness",label:"Wellness",icon:it},{value:"recipes",label:"Recipes",icon:it},{value:"guides",label:"Guides",icon:Ge}],C=[{value:"article",label:"Article",icon:Ge},{value:"video",label:"Video",icon:Ue},{value:"pdf",label:"PDF Document",icon:as},{value:"link",label:"External Link",icon:Es}];g.useEffect(()=>{D()},[]),g.useEffect(()=>{E()},[l,c,o]);const D=async()=>{a(!0);try{const{data:e,error:s}=await _.from("educational_resources").select("*").order("created_at",{ascending:!1});if(s)throw s;i(e||[])}catch(e){s({title:"Error",description:"Failed to load resources",variant:"destructive"})}finally{a(!1)}},E=()=>{let e=l;if("all"!==o&&(e=e.filter(e=>e.category===o)),c){const s=c.toLowerCase();e=e.filter(e=>{var t,a;return e.title.toLowerCase().includes(s)||(null==(t=e.description)?void 0:t.toLowerCase().includes(s))||(null==(a=e.tags)?void 0:a.some(e=>e.toLowerCase().includes(s)))})}n(e)},R=async e=>{s({title:"Share Link Copied",description:"Resource link copied to clipboard"})},F=()=>{N&&!v.tags.includes(N)&&(b({...v,tags:[...v.tags,N]}),w(""))},z=()=>{b({title:"",description:"",content:"",resource_type:"article",category:"nutrition",url:"",file_url:"",tags:[],is_public:!0}),u(null)},I=e=>{const s={article:"bg-blue-500/10 text-blue-600 dark:text-blue-400",video:"bg-purple-500/10 text-purple-600 dark:text-purple-400",pdf:"bg-red-500/10 text-red-600 dark:text-red-400",link:"bg-green-500/10 text-green-600 dark:text-green-400"};return s[e]||s.article};return t?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(se.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-foreground",children:"Resource Library"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage educational content and resources for clients"})]}),e.jsxs(P,{onClick:()=>{z(),p(!0)},children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Add Resource"]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Search resources...",value:c,onChange:e=>d(e.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border border-border bg-background text-foreground"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:k.map(s=>{const t=s.icon;return e.jsxs(P,{variant:o===s.value?"default":"outline",onClick:()=>m(s.value),className:"whitespace-nowrap",size:"sm",children:[e.jsx(t,{className:"h-4 w-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:s.label}),e.jsx("span",{className:"sm:hidden",children:s.label.split(" ")[0]})]},s.value)})})]}),0===r.length?e.jsxs(se.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-12 bg-card rounded-xl border border-border",children:[e.jsx(it,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No Resources Found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:c||"all"!==o?"Try adjusting your filters":"Get started by creating your first resource"}),e.jsxs(P,{onClick:()=>{z(),p(!0)},children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Add Resource"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map((t,a)=>{const l=(e=>{const s=C.find(s=>s.value===e);return s?s.icon:Ge})(t.resource_type);return e.jsxs(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*a},className:"bg-card rounded-xl shadow-lg border border-border overflow-hidden hover:shadow-xl transition-shadow",children:[e.jsx("div",{className:`p-4 ${I(t.resource_type)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(l,{className:"h-8 w-8"}),e.jsx(y,{variant:t.is_public?"default":"secondary",children:t.is_public?"Public":"Private"})]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2 line-clamp-2",children:t.title}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-3",children:t.description||"No description available"}),t.tags&&t.tags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[t.tags.slice(0,3).map((s,t)=>e.jsxs(y,{variant:"outline",className:"text-xs",children:[e.jsx(ss,{className:"h-3 w-3 mr-1"}),s]},t)),t.tags.length>3&&e.jsxs(y,{variant:"outline",className:"text-xs",children:["+",t.tags.length-3]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground mb-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Pe,{className:"h-3 w-3"}),Oe(new Date(t.created_at),"MMM dd, yyyy")]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ls,{className:"h-3 w-3"}),t.view_count||0," views"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(P,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>(async e=>{u(e),f(!0);try{await _.from("educational_resources").update({view_count:(e.view_count||0)+1}).eq("id",e.id)}catch(s){}})(t),children:[e.jsx(ls,{className:"h-4 w-4 mr-1"}),"View"]}),e.jsx(P,{size:"sm",variant:"outline",onClick:()=>(e=>{u(e),b({title:e.title,description:e.description||"",content:e.content||"",resource_type:e.resource_type,category:e.category,url:e.url||"",file_url:e.file_url||"",tags:e.tags||[],is_public:e.is_public}),p(!0)})(t),children:e.jsx(Ae,{className:"h-4 w-4"})}),e.jsx(P,{size:"sm",variant:"outline",onClick:()=>R(),children:e.jsx(rt,{className:"h-4 w-4"})}),e.jsx(P,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this resource?"))try{const{error:t}=await _.from("educational_resources").delete().eq("id",e);if(t)throw t;s({title:"Success",description:"Resource deleted successfully"}),D()}catch(t){s({title:"Error",description:"Failed to delete resource",variant:"destructive"})}})(t.id),children:e.jsx($e,{className:"h-4 w-4"})})]})]})]},t.id)})}),e.jsx(S,{open:h,onOpenChange:p,children:e.jsxs(M,{className:"glass-effect custom-scrollbar max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(A,{children:e.jsx($,{children:x?"Edit Resource":"Add New Resource"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Title *"}),e.jsx("input",{type:"text",value:v.title,onChange:e=>b({...v,title:e.target.value}),className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",placeholder:"Resource title"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Type *"}),e.jsx("select",{value:v.resource_type,onChange:e=>b({...v,resource_type:e.target.value}),className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",children:C.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Category"}),e.jsx("select",{value:v.category,onChange:e=>b({...v,category:e.target.value}),className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",children:k.filter(e=>"all"!==e.value).map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Description"}),e.jsx("textarea",{value:v.description,onChange:e=>b({...v,description:e.target.value}),rows:3,className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",placeholder:"Brief description"})]}),("link"===v.resource_type||"video"===v.resource_type)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"URL"}),e.jsx("input",{type:"url",value:v.url,onChange:e=>b({...v,url:e.target.value}),className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",placeholder:"https://example.com"})]}),"pdf"===v.resource_type&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"File URL"}),e.jsx("input",{type:"url",value:v.file_url,onChange:e=>b({...v,file_url:e.target.value}),className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",placeholder:"Upload file and paste URL"})]}),"article"===v.resource_type&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Content"}),e.jsx("textarea",{value:v.content,onChange:e=>b({...v,content:e.target.value}),rows:10,className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground font-mono text-sm",placeholder:"Write your article content here (supports Markdown)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Tags"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",value:N,onChange:e=>w(e.target.value),onKeyPress:e=>"Enter"===e.key&&(e.preventDefault(),F()),className:"flex-1 px-4 py-2 rounded-lg border border-border bg-background text-foreground",placeholder:"Add a tag and press Enter"}),e.jsx(P,{onClick:F,children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:v.tags.map((s,t)=>e.jsxs(y,{className:"flex items-center gap-1",children:[s,e.jsx(be,{className:"h-3 w-3 cursor-pointer",onClick:()=>{return e=s,void b({...v,tags:v.tags.filter(s=>s!==e)});var e}})]},t))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"is_public",checked:v.is_public,onChange:e=>b({...v,is_public:e.target.checked}),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"is_public",className:"text-sm font-medium text-foreground",children:"Make this resource public to all clients"})]})]}),e.jsxs(T,{children:[e.jsx(P,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsxs(P,{onClick:async()=>{if(v.title&&v.resource_type)try{const{data:{user:e}}=await _.auth.getUser(),t={...v,created_by:null==e?void 0:e.id,view_count:0};let a;if(x){const{data:e,error:l}=await _.from("educational_resources").update(t).eq("id",x.id).select().single();if(l)throw l;a=e,s({title:"Success",description:"Resource updated successfully"})}else{const{data:e,error:l}=await _.from("educational_resources").insert([t]).select().single();if(l)throw l;a=e,s({title:"Success",description:"Resource created successfully"})}p(!1),z(),D()}catch(e){s({title:"Error",description:"Failed to save resource",variant:"destructive"})}else s({title:"Validation Error",description:"Please fill in required fields",variant:"destructive"})},children:[x?"Update":"Create"," Resource"]})]})]})}),e.jsx(S,{open:j,onOpenChange:f,children:e.jsx(M,{className:"glass-effect custom-scrollbar max-w-3xl max-h-[90vh] overflow-y-auto",children:x&&e.jsxs(e.Fragment,{children:[e.jsx(A,{children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx($,{className:"text-2xl mb-2 text-foreground",children:x.title}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(y,{children:x.resource_type}),e.jsx(y,{variant:"outline",children:x.category}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:Oe(new Date(x.created_at),"MMMM dd, yyyy")}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[x.view_count||0," views"]})]})]})})}),e.jsxs("div",{className:"space-y-4",children:[x.description&&e.jsx("div",{children:e.jsx("p",{className:"text-muted-foreground",children:x.description})}),x.tags&&x.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:x.tags.map((s,t)=>e.jsxs(y,{variant:"outline",children:[e.jsx(ss,{className:"h-3 w-3 mr-1"}),s]},t))}),"article"===x.resource_type&&x.content&&e.jsx("div",{className:"prose dark:prose-invert max-w-none",children:e.jsx("div",{className:"whitespace-pre-wrap text-foreground",children:x.content})}),"link"===x.resource_type&&x.url&&e.jsx("div",{className:"p-4 bg-muted/50 rounded-lg",children:e.jsxs("a",{href:x.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-primary hover:underline",children:[e.jsx(Ts,{className:"h-4 w-4"}),"Open External Link"]})}),"video"===x.resource_type&&x.url&&e.jsx("div",{className:"aspect-video bg-muted rounded-lg flex items-center justify-center",children:e.jsxs("a",{href:x.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-primary hover:underline",children:[e.jsx(Ue,{className:"h-6 w-6"}),"Watch Video"]})}),"pdf"===x.resource_type&&x.file_url&&e.jsx("div",{className:"p-4 bg-muted/50 rounded-lg",children:e.jsxs("a",{href:x.file_url,download:!0,className:"flex items-center gap-2 text-primary hover:underline",children:[e.jsx(as,{className:"h-4 w-4"}),"Download PDF"]})})]}),e.jsxs(T,{children:[e.jsx(P,{variant:"outline",onClick:()=>f(!1),children:"Close"}),e.jsxs(P,{onClick:()=>R(),children:[e.jsx(rt,{className:"h-4 w-4 mr-2"}),"Share"]})]})]})})})]})},al=()=>{const{user:s,userProfile:t}=w(),[a,l]=g.useState(!0),[i,r]=g.useState(!1),[n,c]=g.useState("business"),[d,o]=g.useState({business_name:"",business_address:"",business_phone:"",license_number:"",specializations:[],consultation_duration_default:60,buffer_time_minutes:15,working_hours:{monday:{enabled:!0,start:"09:00",end:"17:00"},tuesday:{enabled:!0,start:"09:00",end:"17:00"},wednesday:{enabled:!0,start:"09:00",end:"17:00"},thursday:{enabled:!0,start:"09:00",end:"17:00"},friday:{enabled:!0,start:"09:00",end:"17:00"},saturday:{enabled:!1,start:"09:00",end:"13:00"},sunday:{enabled:!1,start:"09:00",end:"13:00"}},time_zone:Intl.DateTimeFormat().resolvedOptions().timeZone,booking_advance_days:30,hourly_rate:"",initial_consultation_fee:"",follow_up_fee:"",package_pricing:[],email_notifications:!0,sms_notifications:!1,appointment_reminders:!0,reminder_hours_before:24,brand_color:"#10b981",logo_url:"",custom_email_signature:""}),[m,x]=g.useState(""),[u,h]=g.useState({name:"",sessions:"",price:""});g.useEffect(()=>{p()},[s]);const p=async()=>{l(!0);try{const{data:e,error:t}=await _.from("nutritionist_settings").select("*").eq("nutritionist_id",s.id).single();if(t&&"PGRST116"!==t.code)throw t;e&&o({...d,...e,specializations:e.specializations||[],working_hours:e.working_hours||d.working_hours,package_pricing:e.package_pricing||[]})}catch(e){}finally{l(!1)}},j=async()=>{r(!0);try{const{data:e}=await _.from("nutritionist_settings").select("id").eq("nutritionist_id",s.id).single(),t={...d,nutritionist_id:s.id};if(e){const{error:e}=await _.from("nutritionist_settings").update(t).eq("nutritionist_id",s.id);if(e)throw e}else{const{error:e}=await _.from("nutritionist_settings").insert(t);if(e)throw e}F({title:"Settings saved",description:"Your settings have been updated successfully"})}catch(e){F({variant:"destructive",title:"Error",description:"Failed to save settings"})}finally{r(!1)}},f=()=>{m.trim()&&!d.specializations.includes(m.trim())&&(o({...d,specializations:[...d.specializations,m.trim()]}),x(""))},v=(e,s,t)=>{o({...d,working_hours:{...d.working_hours,[e]:{...d.working_hours[e],[s]:t}}})};return a?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(Se,{className:"w-12 h-12 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(ct,{className:"w-8 h-8 text-primary"}),"Settings"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your business settings and preferences"})]}),e.jsx(P,{onClick:j,disabled:i,children:i?e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),"Save Changes"]})})]}),e.jsxs(Dt,{value:n,onValueChange:c,children:[e.jsxs(Pt,{className:"grid w-full grid-cols-5",children:[e.jsx(Mt,{value:"business",children:"Business"}),e.jsx(Mt,{value:"availability",children:"Availability"}),e.jsx(Mt,{value:"pricing",children:"Pricing"}),e.jsx(Mt,{value:"notifications",children:"Notifications"}),e.jsx(Mt,{value:"branding",children:"Branding"})]}),e.jsx(At,{value:"business",className:"space-y-4",children:e.jsxs(V,{children:[e.jsxs(H,{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(dt,{className:"w-5 h-5"}),"Business Information"]}),e.jsx(Q,{children:"Manage your professional business details"})]}),e.jsxs(K,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Business Name"}),e.jsx(E,{value:d.business_name,onChange:e=>o({...d,business_name:e.target.value}),placeholder:"Your Nutrition Practice"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"License Number"}),e.jsx(E,{value:d.license_number,onChange:e=>o({...d,license_number:e.target.value}),placeholder:"License #"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Business Address"}),e.jsx(R,{value:d.business_address,onChange:e=>o({...d,business_address:e.target.value}),placeholder:"123 Main St, City, State, ZIP",rows:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Business Phone"}),e.jsx(E,{value:d.business_phone,onChange:e=>o({...d,business_phone:e.target.value}),placeholder:"+1 (555) 000-0000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Specializations"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(E,{value:m,onChange:e=>x(e.target.value),placeholder:"e.g., Weight Loss, Sports Nutrition",onKeyPress:e=>"Enter"===e.key&&f()}),e.jsx(P,{onClick:f,children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.specializations.map((s,t)=>e.jsxs("span",{className:"px-3 py-1 bg-primary/10 text-primary rounded-full text-sm flex items-center gap-2",children:[s,e.jsx("button",{onClick:()=>(e=>{o({...d,specializations:d.specializations.filter(s=>s!==e)})})(s),className:"text-primary/60 hover:text-primary",children:"Ã—"})]},t))})]})]})]})}),e.jsx(At,{value:"availability",className:"space-y-4",children:e.jsxs(V,{children:[e.jsxs(H,{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5"}),"Working Hours"]}),e.jsx(Q,{children:"Set your available hours for client bookings"})]}),e.jsxs(K,{className:"space-y-4",children:[["monday","tuesday","wednesday","thursday","friday","saturday","sunday"].map(s=>{var t,a,l,i;return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-32",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx(Lt,{checked:(null==(t=d.working_hours[s])?void 0:t.enabled)||!1,onCheckedChange:e=>v(s,"enabled",e)}),e.jsx("span",{className:"capitalize font-medium",children:s})]})}),(null==(a=d.working_hours[s])?void 0:a.enabled)&&e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(E,{type:"time",value:(null==(l=d.working_hours[s])?void 0:l.start)||"09:00",onChange:e=>v(s,"start",e.target.value),className:"w-32 min-w-0"}),e.jsx("span",{children:"to"}),e.jsx(E,{type:"time",value:(null==(i=d.working_hours[s])?void 0:i.end)||"17:00",onChange:e=>v(s,"end",e.target.value),className:"w-32 min-w-0"})]})]},s)}),e.jsxs("div",{className:"pt-4 border-t border-border grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Default Consultation Duration"}),e.jsxs("select",{value:d.consultation_duration_default,onChange:e=>o({...d,consultation_duration_default:parseInt(e.target.value)}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"30",children:"30 minutes"}),e.jsx("option",{value:"45",children:"45 minutes"}),e.jsx("option",{value:"60",children:"60 minutes"}),e.jsx("option",{value:"90",children:"90 minutes"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Buffer Time (minutes)"}),e.jsx(E,{type:"number",value:d.buffer_time_minutes,onChange:e=>o({...d,buffer_time_minutes:parseInt(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Booking Advance (days)"}),e.jsx(E,{type:"number",value:d.booking_advance_days,onChange:e=>o({...d,booking_advance_days:parseInt(e.target.value)})})]})]})]})]})}),e.jsx(At,{value:"pricing",className:"space-y-4",children:e.jsxs(V,{children:[e.jsxs(H,{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5"}),"Consultation Pricing"]}),e.jsx(Q,{children:"Set your consultation fees and package pricing"})]}),e.jsxs(K,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Hourly Rate"}),e.jsx(E,{type:"number",step:"0.01",value:d.hourly_rate,onChange:e=>o({...d,hourly_rate:e.target.value}),placeholder:"100.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Initial Consultation Fee"}),e.jsx(E,{type:"number",step:"0.01",value:d.initial_consultation_fee,onChange:e=>o({...d,initial_consultation_fee:e.target.value}),placeholder:"150.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Follow-up Fee"}),e.jsx(E,{type:"number",step:"0.01",value:d.follow_up_fee,onChange:e=>o({...d,follow_up_fee:e.target.value}),placeholder:"75.00"})]})]}),e.jsxs("div",{className:"pt-4 border-t border-border",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Package Pricing"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 mb-4",children:[e.jsx(E,{placeholder:"Package name",value:u.name,onChange:e=>h({...u,name:e.target.value})}),e.jsx(E,{type:"number",placeholder:"Sessions",value:u.sessions,onChange:e=>h({...u,sessions:e.target.value})}),e.jsx(E,{type:"number",step:"0.01",placeholder:"Price",value:u.price,onChange:e=>h({...u,price:e.target.value})}),e.jsx(P,{onClick:()=>{u.name&&u.sessions&&u.price&&(o({...d,package_pricing:[...d.package_pricing,{name:u.name,sessions:parseInt(u.sessions),price:parseFloat(u.price)}]}),h({name:"",sessions:"",price:""}))},children:"Add Package"})]}),d.package_pricing.length>0&&e.jsx("div",{className:"space-y-2",children:d.package_pricing.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.sessions," sessions â€¢ $",s.price]})]}),e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>(e=>{o({...d,package_pricing:d.package_pricing.filter((s,t)=>t!==e)})})(t),children:"Remove"})]},t))})]})]})]})}),e.jsx(At,{value:"notifications",className:"space-y-4",children:e.jsxs(V,{children:[e.jsxs(H,{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-5 h-5"}),"Notification Preferences"]}),e.jsx(Q,{children:"Manage how you receive notifications and reminders"})]}),e.jsxs(K,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Email Notifications"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive notifications via email"})]}),e.jsx(Lt,{checked:d.email_notifications,onCheckedChange:e=>o({...d,email_notifications:e})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"SMS Notifications"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive notifications via text message"})]}),e.jsx(Lt,{checked:d.sms_notifications,onCheckedChange:e=>o({...d,sms_notifications:e})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Appointment Reminders"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Send reminders for upcoming appointments"})]}),e.jsx(Lt,{checked:d.appointment_reminders,onCheckedChange:e=>o({...d,appointment_reminders:e})})]}),d.appointment_reminders&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Send reminders (hours before appointment)"}),e.jsx(E,{type:"number",value:d.reminder_hours_before,onChange:e=>o({...d,reminder_hours_before:parseInt(e.target.value)})})]})]})]})}),e.jsx(At,{value:"branding",className:"space-y-4",children:e.jsxs(V,{children:[e.jsxs(H,{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(ot,{className:"w-5 h-5"}),"Branding & Customization"]}),e.jsx(Q,{children:"Customize your brand appearance and communications"})]}),e.jsxs(K,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Brand Color"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{type:"color",value:d.brand_color,onChange:e=>o({...d,brand_color:e.target.value}),className:"w-20 h-10"}),e.jsx(E,{value:d.brand_color,onChange:e=>o({...d,brand_color:e.target.value}),placeholder:"#10b981"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Logo URL"}),e.jsx(E,{value:d.logo_url,onChange:e=>o({...d,logo_url:e.target.value}),placeholder:"https://example.com/logo.png"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Custom Email Signature"}),e.jsx(R,{value:d.custom_email_signature,onChange:e=>o({...d,custom_email_signature:e.target.value}),placeholder:"Best regards,\nYour Name\nCertified Nutritionist",rows:4})]})]})]})})]}),e.jsx("div",{className:"flex justify-end sticky bottom-4",children:e.jsx(P,{onClick:j,disabled:i,size:"lg",children:i?e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),"Save All Changes"]})})})]})},ll=O({}.VITE_STRIPE_PUBLISHABLE_KEY||"pk_test_..."),il=()=>{const{user:s,userProfile:t}=w(),[a,l]=g.useState(null),[i,r]=g.useState([]),[n,c]=g.useState(!0),[d,o]=g.useState(null),[m,x]=g.useState(!1),[u,h]=g.useState(!1),p=[{id:"base",name:"Base",price:9.99,priceId:"price_base_monthly",icon:J,color:"gray",features:["Basic meal plans","Weekly check-ins","Email support (24-48hr response)","Limited messaging (5/week)","Basic progress tracking","Recipe library access"]},{id:"premium",name:"Premium",price:19.99,priceId:"price_premium_monthly",icon:Z,color:"blue",popular:!0,features:["Everything in Base","Custom meal plans","Priority support (24-48hr)","Enhanced messaging (20/week)","Advanced analytics","Workout integration","Monthly progress reports","Meal prep guides"]},{id:"elite",name:"Elite",price:29.99,priceId:"price_elite_monthly",icon:X,color:"yellow",features:["Everything in Premium","Real-time messaging (unlimited)","Video consultations (2/month)","Priority support (same-day)","Personalized workout plans","24/7 AI coach access","Weekly progress calls","Custom supplement advice","VIP community access"]}];g.useEffect(()=>{j()},[s]);const j=async()=>{c(!0);try{const{data:e,error:t}=await _.from("subscriptions").select("*").eq("client_id",s.id).eq("status","active").single();if(t&&"PGRST116"!==t.code)throw t;l(e);const{data:a,error:i}=await _.from("payment_history").select("*").eq("client_id",s.id).order("created_at",{ascending:!1}).limit(10);if(i)throw i;r(a||[])}catch(e){}finally{c(!1)}};return n?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-8",children:[a&&e.jsxs(V,{children:[e.jsxs(H,{children:[e.jsx(Y,{children:"Current Subscription"}),e.jsx(Q,{children:"Manage your active subscription plan"})]}),e.jsxs(K,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(X,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg",children:[a.tier," Plan"]}),e.jsxs("p",{className:"text-sm text-text-secondary",children:["$",a.price_per_month,"/month"]})]})]}),e.jsx(y,{variant:"active"===a.status?"success":"secondary",children:a.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Next billing date"}),e.jsx("p",{className:"font-semibold",children:Oe(new Date(a.next_billing_date),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Billing period"}),e.jsx("p",{className:"font-semibold capitalize",children:a.billing_period})]})]}),a.cancel_at_period_end&&e.jsxs(qt,{variant:"destructive",className:"mb-4",children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsxs(Ot,{children:["Your subscription will end on ",Oe(new Date(a.current_period_end),"MMM dd, yyyy")]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{variant:"outline",onClick:async()=>{if(!a)return;if(confirm("Are you sure you want to cancel your subscription? You will lose access to premium features at the end of your billing period."))try{const{error:e}=await _.from("subscriptions").update({cancel_at_period_end:!0}).eq("id",a.id);if(e)throw e;alert("Subscription will be cancelled at the end of the current billing period."),await j()}catch(e){alert("Failed to cancel subscription. Please try again.")}},disabled:a.cancel_at_period_end,children:"Cancel Subscription"}),e.jsxs(P,{variant:"outline",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Update Payment Method"]})]})]})]}),(!a||a.cancel_at_period_end)&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Choose Your Plan"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:p.map(s=>{const t=s.icon,l=(null==a?void 0:a.tier)===s.name;return e.jsxs(V,{className:`relative ${s.popular?"border-primary border-2":""} ${l?"bg-primary/5":""}`,children:[s.popular&&e.jsx("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:e.jsx(y,{className:"bg-primary",children:"Most Popular"})}),e.jsx(H,{children:e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(t,{className:`w-8 h-8 text-${s.color}-500`}),e.jsxs("div",{children:[e.jsx(Y,{children:s.name}),e.jsxs(Q,{children:[e.jsxs("span",{className:"text-2xl font-bold text-foreground",children:["$",s.price]}),e.jsx("span",{className:"text-text-secondary",children:"/month"})]})]})]})}),e.jsxs(K,{children:[e.jsx("ul",{className:"space-y-3 mb-6",children:s.features.map((s,t)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(je,{className:"w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm",children:s})]},t))}),e.jsx(P,{className:"w-full",variant:s.popular?"default":"outline",onClick:()=>(async e=>{o(e),x(!0)})(s),disabled:l,children:l?"Current Plan":`Subscribe to ${s.name}`})]})]},s.id)})})]}),i.length>0&&e.jsxs(V,{children:[e.jsxs(H,{children:[e.jsx(Y,{children:"Payment History"}),e.jsx(Q,{children:"View your past transactions"})]}),e.jsx(K,{children:e.jsx("div",{className:"space-y-4",children:i.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center "+("succeeded"===s.status?"bg-green-100":"bg-red-100"),children:"succeeded"===s.status?e.jsx(je,{className:"w-5 h-5 text-green-600"}):e.jsx(be,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold",children:["$",s.amount]}),e.jsx("p",{className:"text-sm text-text-secondary",children:Oe(new Date(s.created_at),"MMM dd, yyyy")})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{variant:"succeeded"===s.status?"success":"destructive",children:s.status}),"succeeded"===s.status&&e.jsxs(P,{variant:"outline",size:"sm",onClick:()=>(async e=>{window.open(e,"_blank")})(s.stripe_invoice_id),children:[e.jsx(as,{className:"w-4 h-4 mr-2"}),"Invoice"]})]})]},s.id))})})]}),e.jsx(S,{open:m,onOpenChange:x,children:e.jsxs(M,{children:[e.jsxs(A,{children:[e.jsx($,{children:"Confirm Subscription"}),e.jsxs(L,{children:["You are about to subscribe to the ",null==d?void 0:d.name," plan"]})]}),d&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-semibold",children:[d.name," Plan"]}),e.jsxs("span",{className:"text-xl font-bold",children:["$",d.price,"/month"]})]}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Billed monthly â€¢ Cancel anytime"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold mb-2",children:"What you'll get:"}),e.jsx("ul",{className:"space-y-2",children:d.features.slice(0,5).map((s,t)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(je,{className:"w-4 h-4 text-green-500"}),s]},t))})]})]}),e.jsxs(T,{children:[e.jsx(P,{variant:"outline",onClick:()=>x(!1),disabled:u,children:"Cancel"}),e.jsx(P,{onClick:async()=>{if(d){h(!0);try{const e=await fetch("/api/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({priceId:d.priceId,userId:s.id,tier:d.name})}),{sessionId:t}=await e.json(),a=await ll,{error:l}=await a.redirectToCheckout({sessionId:t});l&&alert("Payment failed. Please try again.")}catch(e){alert("Failed to process payment. Please try again.")}finally{h(!1)}}},disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Proceed to Payment"]})})]})]})})]})},rl={Exercise:Re,Health:Ke,Medical:gt,Client:jt};function nl(){const{i18n:s}=k(),{user:t}=w(),{toast:a}=q(),l=s.language,i="ar"===l,[r,n]=g.useState(!0),[c,d]=g.useState([]),[o,m]=g.useState([]),[x,u]=g.useState({}),[h,p]=g.useState({}),[j,f]=g.useState(""),[v,b]=g.useState("all"),[N,C]=g.useState(!1),[D,R]=g.useState(null),[F,z]=g.useState(!1),[I,O]=g.useState({title:"",title_ar:"",expires_days:"",max_submissions:"",formLanguage:"en"}),[B,G]=g.useState("patients");g.useState({}),g.useEffect(()=>{(null==t?void 0:t.id)&&W()},[null==t?void 0:t.id]);const W=async()=>{try{const{data:e}=await _.from("public_form_links").select("*, form_template:form_templates(*)").eq("nutritionist_id",null==t?void 0:t.id).order("created_at",{ascending:!1});d(e||[]);const{data:s}=await _.from("external_form_submissions").select("*, form_template:form_templates(*), link:public_form_links(*)").eq("nutritionist_id",null==t?void 0:t.id).neq("status","draft").order("created_at",{ascending:!1});m(s||[])}catch(e){}finally{n(!1)}},U=()=>{const e={};return o.forEach(s=>{const t=s.submitter_email;e[t]||(e[t]={name:s.submitter_name,email:s.submitter_email,phone:s.submitter_phone,age:s.submitter_age,address:s.submitter_address,submissions:[],latestSubmission:s.created_at,hasNewSubmissions:!1}),e[t].submissions.push(s),"submitted"===s.status&&(e[t].hasNewSubmissions=!0),new Date(s.created_at)>new Date(e[t].latestSubmission)&&(e[t].latestSubmission=s.created_at)}),Object.entries(e).map(([e,s])=>({email:e,...s})).sort((e,s)=>new Date(s.latestSubmission)-new Date(e.latestSubmission))},V=U().filter(e=>{var s;const t=!j||e.name.toLowerCase().includes(j.toLowerCase())||e.email.toLowerCase().includes(j.toLowerCase())||(null==(s=e.phone)?void 0:s.includes(j)),a="all"===v||"new"===v&&e.hasNewSubmissions||"reviewed"===v&&!e.hasNewSubmissions;return t&&a}),H=async e=>{try{await _.from("external_form_submissions").update({status:"reviewed",reviewed_at:(new Date).toISOString(),reviewed_by:t.id}).eq("id",e),W(),R(null)}catch(s){}},Y=o.filter(e=>"submitted"===e.status).length,K=U().length,Q=c.filter(e=>e.is_active).length,Z=e=>{var s;return(null==(s=null==e?void 0:e.form_template)?void 0:s.sections)?[{name:e.form_template.name,name_ar:e.form_template.name_ar,icon:"ðŸ“‹",sections:e.form_template.sections}]:[]};return r?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(Se,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs("div",{className:i?"rtl":"ltr",dir:i?"rtl":"ltr",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-6",children:[{icon:te,value:K,label:i?"Ø§Ù„Ù…Ø±Ø¶Ù‰":"Patients",bgColor:"bg-blue-500/10",iconColor:"text-blue-600"},{icon:ns,value:Y,label:i?"Ø¬Ø¯ÙŠØ¯":"New",bgColor:"bg-yellow-500/10",iconColor:"text-yellow-600"},{icon:Es,value:c.length,label:i?"Ø§Ù„Ø±ÙˆØ§Ø¨Ø·":"Links",bgColor:"bg-purple-500/10",iconColor:"text-purple-600"},{icon:Rs,value:Q,label:i?"Ù†Ø´Ø·":"Active",bgColor:"bg-primary/10",iconColor:"text-primary"}].map((s,t)=>e.jsx("div",{className:"glass-effect rounded-xl p-3 border border-border/30",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-1.5 ${s.bgColor} rounded-lg`,children:e.jsx(s.icon,{className:`w-4 h-4 ${s.iconColor}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold text-foreground",children:s.value}),e.jsx("p",{className:"text-xs text-text-secondary",children:s.label})]})]})},t))}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-1 sm:pb-0",children:[e.jsxs("button",{onClick:()=>G("patients"),className:"flex items-center gap-1.5 px-3 py-2 sm:py-1.5 rounded-lg text-sm font-medium transition-colors whitespace-nowrap "+("patients"===B?"bg-primary/10 text-primary border border-primary/30":"text-text-secondary hover:bg-muted/50"),children:[e.jsx(te,{className:"w-4 h-4"}),i?"Ø§Ù„Ù…Ø±Ø¶Ù‰":"Patients",Y>0&&e.jsx(y,{variant:"destructive",className:"text-[10px] px-1.5",children:Y})]}),e.jsxs("button",{onClick:()=>G("links"),className:"flex items-center gap-1.5 px-3 py-2 sm:py-1.5 rounded-lg text-sm font-medium transition-colors whitespace-nowrap "+("links"===B?"bg-primary/10 text-primary border border-primary/30":"text-text-secondary hover:bg-muted/50"),children:[e.jsx(mt,{className:"w-4 h-4"}),i?"Ø§Ù„Ø±ÙˆØ§Ø¨Ø·":"Links",e.jsx(y,{variant:"secondary",className:"text-[10px] px-1.5",children:c.length})]})]}),e.jsxs(P,{onClick:()=>C(!0),className:"w-full sm:w-auto bg-gradient-to-r from-primary to-green-400 hover:opacity-90 text-primary-foreground",children:[e.jsx(Ce,{className:"w-4 h-4 mr-1"}),i?"Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯":"Create New Link"]})]}),"patients"===B&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3 flex-wrap items-center",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ze,{className:`absolute ${i?"right-3":"left-3"} top-1/2 transform -translate-y-1/2 w-4 h-4 text-text-secondary`}),e.jsx(E,{placeholder:i?"Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„...":"Search by name or email...",value:j,onChange:e=>f(e.target.value),className:(i?"pr-10":"pl-10")+" bg-card/50 border-border/30 h-9"})]})}),e.jsxs("select",{value:v,onChange:e=>b(e.target.value),className:"px-3 py-1.5 border border-primary/30 rounded-lg bg-primary/5 text-foreground text-sm h-9 focus:ring-2 focus:ring-primary/20 focus:border-primary",children:[e.jsx("option",{value:"all",children:i?"Ø§Ù„ÙƒÙ„":"All"}),e.jsx("option",{value:"new",children:i?"Ø¬Ø¯ÙŠØ¯":"New"}),e.jsx("option",{value:"reviewed",children:i?"ØªÙ…Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©":"Reviewed"})]})]}),0===V.length?e.jsxs("div",{className:"glass-effect rounded-xl text-center py-8 border border-border/30",children:[e.jsx(te,{className:"w-10 h-10 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-text-secondary text-sm",children:i?"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø±Ø¶Ù‰ Ø¨Ø¹Ø¯":"No patients yet"})]}):V.map(s=>{const r=h[s.email],n=s.submissions.filter(e=>"submitted"===e.status).length;return e.jsxs("div",{className:"glass-effect rounded-xl border border-border/30 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 cursor-pointer hover:bg-muted/30 transition-colors",onClick:()=>p(e=>({...e,[s.email]:!e[s.email]})),children:[e.jsx("div",{className:"flex items-center justify-center w-6",children:r?e.jsx(xt,{className:"w-4 h-4 text-primary"}):e.jsx(fe,{className:"w-4 h-4 text-text-secondary"})}),e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0 "+(s.hasNewSubmissions?"bg-gradient-to-br from-yellow-400 to-orange-500 text-white":"bg-primary/10 text-primary"),children:s.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-foreground truncate",children:s.name}),e.jsx("p",{className:"text-xs text-text-secondary truncate",children:s.email})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[n>0&&e.jsxs(y,{variant:"destructive",className:"text-[10px] px-1.5",children:[n," ",i?"Ø¬Ø¯ÙŠØ¯":"new"]}),e.jsxs(y,{variant:"secondary",className:"text-xs",children:[s.submissions.length," ",i?"Ù†Ù…ÙˆØ°Ø¬":"form(s)"]})]})]}),r&&e.jsxs("div",{className:"border-t border-border/20",children:[e.jsxs("div",{className:"p-3 bg-muted/10 flex flex-wrap items-center gap-3 text-xs text-text-secondary",children:[s.phone&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ys,{className:"w-3 h-3"}),s.phone]}),s.age&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"w-3 h-3"}),s.age," ",i?"Ø³Ù†Ø©":"years"]}),e.jsxs("div",{className:"flex gap-2 "+(i?"mr-auto":"ml-auto"),children:[e.jsxs(P,{size:"sm",variant:"ghost",onClick:e=>{e.stopPropagation(),window.open(`mailto:${s.email}`)},className:"h-7 px-2",children:[e.jsx(Be,{className:"w-3.5 h-3.5 mr-1"}),i?"Ø¥ÙŠÙ…ÙŠÙ„":"Email"]}),s.hasNewSubmissions&&e.jsxs(P,{size:"sm",onClick:e=>{e.stopPropagation(),(async s=>{try{await _.from("external_form_submissions").update({status:"reviewed",reviewed_at:(new Date).toISOString(),reviewed_by:t.id}).eq("nutritionist_id",t.id).eq("submitter_email",s).eq("status","submitted"),a({title:i?"ØªÙ…Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©":"Marked as Reviewed"}),W()}catch(e){}})(s.email)},className:"h-7 px-2 bg-gradient-to-r from-primary to-green-400 text-white",children:[e.jsx(Rs,{className:"w-3.5 h-3.5 mr-1"}),i?"Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙƒÙ„":"Review All"]})]})]}),e.jsx("div",{className:"divide-y divide-border/20",children:s.submissions.map(s=>{var t;const r=s.form_template,n=rl[null==(t=null==r?void 0:r.name)?void 0:t.split(" ")[0]]||Ge,c="submitted"===s.status;return e.jsxs("div",{className:"flex items-center justify-between p-2.5 hover:bg-muted/20 transition-colors cursor-pointer "+(c?"bg-yellow-500/5":""),onClick:e=>((e,s)=>{s.stopPropagation(),R(e)})(s,e),children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0 ml-6",children:[e.jsx("div",{className:"p-1.5 rounded-lg "+(c?"bg-yellow-500/10":"bg-primary/10"),children:e.jsx(n,{className:"w-3.5 h-3.5 "+(c?"text-yellow-600":"text-primary")})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-foreground truncate",children:i?(null==r?void 0:r.name_ar)||(null==r?void 0:r.name):(null==r?void 0:r.name)||"Forms"}),e.jsx("p",{className:"text-[10px] text-text-secondary",children:new Date(s.created_at).toLocaleDateString(l)})]})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[c&&e.jsx(P,{size:"sm",className:"h-7 w-7 p-0 bg-primary text-white",onClick:e=>{e.stopPropagation(),H(s.id)},children:e.jsx(Rs,{className:"w-3.5 h-3.5"})}),e.jsx(P,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-red-500 hover:text-red-600",onClick:e=>{e.stopPropagation(),(async s=>{if(window.confirm(i?"Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ØŸ":"Delete this submission?"))try{await _.from("external_form_submissions").delete().eq("id",s),a({title:i?"ØªÙ… Ø§Ù„Ø­Ø°Ù":"Deleted"}),W()}catch(e){}})(s.id)},children:e.jsx($e,{className:"w-3.5 h-3.5"})})]})]},s.id)})})]})]},s.email)})]}),"links"===B&&e.jsx("div",{className:"space-y-3",children:0===c.length?e.jsxs("div",{className:"glass-effect rounded-xl text-center py-8 border border-border/30",children:[e.jsx(mt,{className:"w-10 h-10 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-text-secondary text-sm mb-3",children:i?"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±ÙˆØ§Ø¨Ø· Ø¨Ø¹Ø¯":"No links yet"}),e.jsxs(P,{onClick:()=>C(!0),className:"bg-gradient-to-r from-primary to-green-400 hover:opacity-90 text-primary-foreground",children:[e.jsx(Ce,{className:"w-4 h-4 mr-1"}),i?"Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø·":"Create Link"]})]}):c.map(s=>{var t;const r=x[s.id],n=s.expires_at&&new Date(s.expires_at)<new Date,c=s.max_submissions&&s.current_submissions>=s.max_submissions,d=s.is_active&&!n&&!c,o=null==(t=s.description)?void 0:t.includes("Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©");return e.jsxs("div",{className:"glass-effect rounded-xl border border-border/30 overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 p-3 cursor-pointer hover:bg-muted/30 transition-colors",onClick:()=>u(e=>({...e,[s.id]:!e[s.id]})),children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center justify-center w-6 flex-shrink-0",children:r?e.jsx(xt,{className:"w-4 h-4 text-primary"}):e.jsx(fe,{className:"w-4 h-4 text-text-secondary"})}),e.jsx("div",{className:"p-2 rounded-lg flex-shrink-0 "+(d?"bg-primary/10":"bg-muted"),children:e.jsx(ut,{className:"w-4 h-4 "+(d?"text-primary":"text-muted-foreground")})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm font-medium text-foreground truncate flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"truncate",children:i?s.title_ar||s.title:s.title||"Patient Intake"}),e.jsx(y,{variant:"outline",className:"text-[10px] px-1 flex-shrink-0",children:o?"AR":"EN"})]}),e.jsxs("p",{className:"text-xs text-text-secondary font-mono truncate",children:["/",s.link_code]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 ml-9 sm:ml-0",children:[e.jsx(y,{className:"text-[10px] px-1.5 "+(s.is_active?n?"bg-red-500/10 text-red-600 border-red-500/30":c?"bg-yellow-500/10 text-yellow-600 border-yellow-500/30":"bg-primary/10 text-primary border-primary/30":"bg-muted text-muted-foreground"),children:s.is_active?n?i?"Ù…Ù†ØªÙ‡ÙŠ":"Expired":c?i?"Ù…Ù…ØªÙ„Ø¦":"Full":i?"Ù†Ø´Ø·":"Active":i?"Ù…Ø¹Ø·Ù„":"Inactive"}),e.jsx(y,{variant:"secondary",className:"text-xs",children:s.current_submissions||0})]})]}),r&&e.jsxs("div",{className:"border-t border-border/20 p-3 bg-muted/10",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 mb-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between sm:block",children:[e.jsx("span",{className:"text-text-secondary text-xs",children:i?"ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:":"Created:"}),e.jsx("p",{className:"font-medium text-xs sm:text-sm",children:new Date(s.created_at).toLocaleDateString(l)})]}),s.expires_at&&e.jsxs("div",{className:"flex justify-between sm:block",children:[e.jsx("span",{className:"text-text-secondary text-xs",children:i?"ÙŠÙ†ØªÙ‡ÙŠ ÙÙŠ:":"Expires:"}),e.jsx("p",{className:"font-medium text-xs sm:text-sm "+(n?"text-red-600":""),children:new Date(s.expires_at).toLocaleDateString(l)})]}),s.max_submissions&&e.jsxs("div",{className:"flex justify-between sm:block",children:[e.jsx("span",{className:"text-text-secondary text-xs",children:i?"Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰:":"Limit:"}),e.jsxs("p",{className:"font-medium text-xs sm:text-sm",children:[s.current_submissions||0,"/",s.max_submissions]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:flex sm:flex-wrap gap-2",children:[e.jsxs(P,{size:"sm",variant:"outline",onClick:e=>{e.stopPropagation(),(e=>{var s;const t=(null==(s=e.description)?void 0:s.includes("Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"))||e.title_ar===e.title?"?lang=ar":"?lang=en";navigator.clipboard.writeText(`${window.location.origin}/patientinfo/${e.link_code}${t}`),a({title:i?"ØªÙ… Ø§Ù„Ù†Ø³Ø®!":"Copied!"})})(s)},className:"h-9 sm:h-8 border-primary/30 text-primary text-xs sm:text-sm",children:[e.jsx(_s,{className:"w-3.5 h-3.5 mr-1"}),i?"Ù†Ø³Ø®":"Copy"]}),e.jsxs(P,{size:"sm",variant:"outline",onClick:e=>{e.stopPropagation(),window.open(`/patientinfo/${s.link_code}?lang=${o?"ar":"en"}`,"_blank")},className:"h-9 sm:h-8 text-xs sm:text-sm",children:[e.jsx(Ts,{className:"w-3.5 h-3.5 mr-1"}),i?"ÙØªØ­":"Open"]}),e.jsx(P,{size:"sm",variant:"outline",onClick:e=>{e.stopPropagation(),(async s=>{try{await _.from("public_form_links").update({is_active:!s.is_active}).eq("id",s.id),W()}catch(e){}})(s)},className:"h-9 sm:h-8 text-xs sm:text-sm",children:s.is_active?e.jsxs(e.Fragment,{children:[e.jsx(cs,{className:"w-3.5 h-3.5 mr-1"}),i?"ØªØ¹Ø·ÙŠÙ„":"Off"]}):e.jsxs(e.Fragment,{children:[e.jsx(Rs,{className:"w-3.5 h-3.5 mr-1"}),i?"ØªÙØ¹ÙŠÙ„":"On"]})}),e.jsxs(P,{size:"sm",variant:"ghost",onClick:e=>{e.stopPropagation(),(async s=>{if(window.confirm(i?"Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø·ØŸ":"Delete this link?"))try{await _.from("public_form_links").delete().eq("id",s),a({title:i?"ØªÙ… Ø§Ù„Ø­Ø°Ù":"Deleted"}),W()}catch(e){}})(s.id)},className:"h-9 sm:h-8 text-red-500 hover:text-red-600 hover:bg-red-50 text-xs sm:text-sm",children:[e.jsx($e,{className:"w-3.5 h-3.5 mr-1"}),i?"Ø­Ø°Ù":"Delete"]})]})]})]},s.id)})}),e.jsx(S,{open:N,onOpenChange:C,children:e.jsxs(M,{className:"max-w-sm sm:max-w-md",children:[e.jsxs(A,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(mt,{className:"w-5 h-5 text-primary"}),i?"Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯":"Create New Link"]}),e.jsx(L,{children:i?"Ø±Ø§Ø¨Ø· Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ù…Ø±Ø¶Ù‰":"Link for patient intake forms"})]}),e.jsxs("div",{className:"space-y-4 py-3",children:[e.jsxs("div",{className:"p-4 bg-gradient-to-r from-primary/10 to-green-400/10 rounded-xl border border-primary/20",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ht,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"font-medium text-sm",children:i?"Ù„ØºØ© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬":"Form Language"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium "+("en"===I.formLanguage?"text-primary":"text-muted-foreground"),children:"English"}),e.jsx(Lt,{checked:"ar"===I.formLanguage,onCheckedChange:e=>O({...I,formLanguage:e?"ar":"en"})}),e.jsx("span",{className:"text-sm font-medium "+("ar"===I.formLanguage?"text-primary":"text-muted-foreground"),children:"Ø¹Ø±Ø¨ÙŠ"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"ar"===I.formLanguage?"Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù„Ù„Ù…Ø±ÙŠØ¶":"The form will appear entirely in English for the patient"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",children:"ar"===I.formLanguage?"Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø§Ø¨Ø· (Ø¹Ø±Ø¨ÙŠ)":"Link Title (English)"}),e.jsx(E,{value:"ar"===I.formLanguage?I.title_ar:I.title,onChange:e=>O({...I,["ar"===I.formLanguage?"title_ar":"title"]:e.target.value}),placeholder:"ar"===I.formLanguage?"Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù‚Ø¨ÙˆÙ„":"Patient Intake",dir:"ar"===I.formLanguage?"rtl":"ltr",className:"h-9 bg-card/50 border-border/30"})]}),e.jsxs("div",{className:"p-3 bg-muted/30 rounded-xl border border-border/20",children:[e.jsxs("p",{className:"text-xs font-medium mb-2 flex items-center gap-1",children:[e.jsx(J,{className:"w-3.5 h-3.5 text-primary"}),"ar"===I.formLanguage?"ÙŠØªØ¶Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬:":"Form Includes:"]}),e.jsx("div",{className:"grid grid-cols-2 gap-1 text-xs text-text-secondary",children:("ar"===I.formLanguage?["Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶","ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†","Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ØµØ­ÙŠ","Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨ÙŠ"]:["Patient Info","Exercise History","Health History","Medical History"]).map((s,t)=>e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Rs,{className:"w-3 h-3 text-primary"}),s]},t))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",children:i?"ÙŠÙ†ØªÙ‡ÙŠ Ø¨Ø¹Ø¯ (Ø£ÙŠØ§Ù…)":"Expires after (days)"}),e.jsx(E,{type:"number",value:I.expires_days,onChange:e=>O({...I,expires_days:e.target.value}),placeholder:i?"Ø¨Ø¯ÙˆÙ† Ø­Ø¯":"No limit",className:"h-9 bg-card/50 border-border/30"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",children:i?"Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø§Øª":"Max submissions"}),e.jsx(E,{type:"number",value:I.max_submissions,onChange:e=>O({...I,max_submissions:e.target.value}),placeholder:i?"Ø¨Ø¯ÙˆÙ† Ø­Ø¯":"No limit",className:"h-9 bg-card/50 border-border/30"})]})]})]}),e.jsxs(T,{className:"gap-2",children:[e.jsx(P,{variant:"outline",onClick:()=>C(!1),children:i?"Ø¥Ù„ØºØ§Ø¡":"Cancel"}),e.jsxs(P,{onClick:async()=>{z(!0);try{const e=(()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let s="";for(let t=0;t<12;t++)s+=e.charAt(Math.floor(62*Math.random()));return s})(),s=I.expires_days?new Date(Date.now()+864e5*parseInt(I.expires_days)).toISOString():null,l="ar"===I.formLanguage,{error:r}=await _.from("public_form_links").insert({nutritionist_id:t.id,link_code:e,title:l?I.title_ar||"Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù‚Ø¨ÙˆÙ„":I.title||"Patient Intake Forms",title_ar:I.title_ar||"Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù‚Ø¨ÙˆÙ„",description:l?"Ù†Ù…Ø§Ø°Ø¬ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©":"Patient intake forms in English",description_ar:"Ù†Ù…Ø§Ø°Ø¬ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",form_language:I.formLanguage||"en",expires_at:s,max_submissions:I.max_submissions?parseInt(I.max_submissions):null});if(r)throw r;a({title:i?"ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­":"Link Created",description:l?"Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©":"Form will appear in English"}),C(!1),O({title:"",title_ar:"",expires_days:"",max_submissions:"",formLanguage:"en"}),W()}catch(e){a({title:i?"Ø®Ø·Ø£":"Error",description:e.message,variant:"destructive"})}finally{z(!1)}},disabled:F,className:"bg-gradient-to-r from-primary to-green-400 hover:opacity-90 text-primary-foreground",children:[F?e.jsx(Se,{className:"w-4 h-4 animate-spin mr-1"}):e.jsx(Ce,{className:"w-4 h-4 mr-1"}),i?"Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø§Ø¨Ø·":"Create Link"]})]})]})}),e.jsx(S,{open:!!D,onOpenChange:()=>R(null),children:e.jsxs(M,{className:"max-w-4xl w-[95vw] h-[95vh] flex flex-col p-0 gap-0",children:[e.jsx("div",{className:"p-4 border-b border-border/30 bg-card flex-shrink-0",children:e.jsxs(A,{className:"space-y-1",children:[e.jsxs($,{className:"flex items-center gap-2 text-lg",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(Ge,{className:"w-5 h-5 text-primary"})}),i?"Ø¬Ù…ÙŠØ¹ Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶":"All Patient Responses"]}),e.jsxs(L,{className:"text-sm",children:[null==D?void 0:D.submitter_name," - ",new Date(null==D?void 0:D.created_at).toLocaleDateString(l)]})]})}),D&&e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsxs("div",{className:"glass-effect rounded-xl p-4 border border-primary/30 bg-primary/5",children:[e.jsxs("h4",{className:"font-semibold text-sm mb-3 flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4 text-primary"}),i?"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶":"Patient Information"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-text-secondary text-xs block",children:i?"Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„":"Full Name"}),e.jsx("p",{className:"font-semibold text-foreground",children:D.submitter_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-secondary text-xs block",children:i?"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ":"Email"}),e.jsx("p",{className:"font-medium text-foreground truncate",children:D.submitter_email})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-secondary text-xs block",children:i?"Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ":"Phone"}),e.jsx("p",{className:"font-medium text-foreground",children:D.submitter_phone||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-secondary text-xs block",children:i?"Ø§Ù„Ø¹Ù…Ø±":"Age"}),e.jsx("p",{className:"font-medium text-foreground",children:D.submitter_age?`${D.submitter_age} ${i?"Ø³Ù†Ø©":"years"}`:"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-secondary text-xs block",children:i?"Ø§Ù„Ø¹Ù†ÙˆØ§Ù†":"Address"}),e.jsx("p",{className:"font-medium text-foreground",children:D.submitter_address||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-secondary text-xs block",children:i?"ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø±Ø³Ø§Ù„":"Submitted"}),e.jsx("p",{className:"font-medium text-foreground",children:new Date(D.created_at).toLocaleString(l)})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[Z(D).map((s,t)=>{var a;return e.jsx("div",{className:"space-y-3",children:null==(a=s.sections)?void 0:a.map((s,t)=>{var a;const l=D.responses||{};return e.jsxs("div",{className:"glass-effect rounded-xl border border-border/30 overflow-hidden",children:[e.jsx("div",{className:"p-3 bg-primary text-white",children:e.jsx("h5",{className:"font-semibold text-sm",children:i&&s.title_ar||s.title})}),e.jsx("div",{className:"p-3 space-y-1",children:null==(a=s.questions)?void 0:a.map((s,t)=>{const a=l[s.id],r=!0===a?i?"Ù†Ø¹Ù…":"Yes":!1===a?i?"Ù„Ø§":"No":Array.isArray(a)?a.join(", "):a||"â€”";return e.jsxs("div",{className:"flex justify-between items-start py-2 px-3 rounded-lg "+(!0===a?"bg-green-50":!1===a?"bg-red-50":"bg-muted/30"),children:[e.jsx("span",{className:"text-xs text-text-secondary flex-1 pr-3",children:i&&s.label_ar||s.label}),e.jsx("span",{className:"text-xs font-medium text-right max-w-[50%] break-words "+(!0===a?"text-green-600":!1===a?"text-red-500":"text-foreground"),children:r})]},t)})})]},t)})},t)}),(()=>{const s=new Set;Z(D).forEach(e=>{var t;return null==(t=e.sections)?void 0:t.forEach(e=>{var t;return null==(t=e.questions)?void 0:t.forEach(e=>s.add(e.id))})});const t=Object.entries(D.responses||{}).filter(([e])=>!s.has(e)&&"signature"!==e);return t.length>0?e.jsxs("div",{className:"glass-effect rounded-xl border border-border/30 overflow-hidden",children:[e.jsx("div",{className:"p-3 bg-muted/50",children:e.jsx("h5",{className:"font-semibold text-sm",children:i?"Ø¥Ø¬Ø§Ø¨Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©":"Additional Responses"})}),e.jsx("div",{className:"p-3 space-y-1",children:t.map(([s,t],a)=>{const l=!0===t?i?"Ù†Ø¹Ù…":"Yes":!1===t?i?"Ù„Ø§":"No":Array.isArray(t)?t.join(", "):t||"â€”";return e.jsxs("div",{className:"flex justify-between items-start py-2 px-3 rounded-lg "+(!0===t?"bg-green-50":!1===t?"bg-red-50":"bg-muted/30"),children:[e.jsx("span",{className:"text-xs text-text-secondary flex-1 pr-3 capitalize",children:s.replace(/_/g," ")}),e.jsx("span",{className:"text-xs font-medium text-foreground",children:l})]},a)})})]}):null})()]}),D.signature_data&&e.jsxs("div",{className:"glass-effect rounded-xl p-4 border border-border/30",children:[e.jsxs("h4",{className:"font-semibold text-sm mb-3 flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4 text-primary"}),i?"Ø§Ù„ØªÙˆÙ‚ÙŠØ¹":"Signature"]}),e.jsx("img",{src:D.signature_data,alt:"Signature",className:"max-w-[250px] h-auto border-2 border-border/30 rounded-xl bg-white p-2"})]})]}),e.jsx("div",{className:"p-4 border-t border-border/30 bg-card flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(P,{variant:"outline",size:"sm",onClick:()=>(async e=>{var s,t;try{const l=e.responses||{},r=Z(e),n="ar"==((null==(t=null==(s=e.link)?void 0:s.description)?void 0:t.includes("Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"))?"ar":"en");let c="";r.forEach(e=>{var s;null==(s=e.sections)||s.forEach(e=>{var s;const t=(null==(s=e.questions)?void 0:s.map(e=>{const s=l[e.id];let t=!0===s?n?"Ù†Ø¹Ù…":"Yes":!1===s?n?"Ù„Ø§":"No":Array.isArray(s)?s.join(", "):s||"â€”";return`<div class="q-row" style="background: ${!0===s?"#dcfce7":!1===s?"#fee2e2":"#f9fafb"}"><span class="q-label">${n&&e.label_ar||e.label}</span><span class="q-answer">${t}</span></div>`}).join(""))||"";c+=`\n            <div class="section">\n              <div class="section-head">${n&&e.title_ar||e.title}</div>\n              ${t}\n            </div>\n          `})});const d=new Set;r.forEach(e=>{var s;return null==(s=e.sections)?void 0:s.forEach(e=>{var s;return null==(s=e.questions)?void 0:s.forEach(e=>d.add(e.id))})});const o=Object.entries(l).filter(([e])=>!d.has(e)&&"signature"!==e);o.length>0&&(c+=`\n          <div class="section">\n            <div class="section-head">${n?"Ø¥Ø¬Ø§Ø¨Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©":"Additional Responses"}</div>\n            ${o.map(([e,s])=>{let t=!0===s?n?"Ù†Ø¹Ù…":"Yes":!1===s?n?"Ù„Ø§":"No":Array.isArray(s)?s.join(", "):s||"â€”";return`<div class="q-row" style="background: ${!0===s?"#dcfce7":!1===s?"#fee2e2":"#f9fafb"}"><span class="q-label">${e.replace(/_/g," ")}</span><span class="q-answer">${t}</span></div>`}).join("")}\n          </div>\n        `);const m=`\n        <!DOCTYPE html>\n        <html dir="${n?"rtl":"ltr"}">\n          <head>\n            <title>${e.submitter_name} - GreenoFig</title>\n            <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">\n            <style>\n              * { box-sizing: border-box; margin: 0; padding: 0; }\n              body { font-family: 'Inter', sans-serif; background: #fff; color: #1f2937; line-height: 1.6; direction: ${n?"rtl":"ltr"}; }\n\n              .header {\n                background: #fff;\n                padding: 30px 40px;\n                border-bottom: 3px solid #6BD55C;\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n              }\n              .logo-section { display: flex; align-items: center; gap: 15px; }\n              .logo {\n                width: 60px; height: 60px;\n                border-radius: 12px;\n                object-fit: contain;\n              }\n              .brand-text h1 {\n                font-size: 26px;\n                font-weight: 700;\n                color: #6BD55C;\n                margin: 0;\n                letter-spacing: -0.5px;\n                font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\n              }\n              .brand-text p { font-size: 13px; color: #6b7280; margin: 0; font-weight: 500; }\n              .doc-info { text-align: ${n?"left":"right"}; }\n              .doc-info h2 { font-size: 16px; color: #374151; margin: 0; }\n              .doc-info p { font-size: 12px; color: #6b7280; }\n\n              .content { padding: 30px 40px; }\n\n              .patient-card {\n                background: #f0fdf4;\n                border: 2px solid #6BD55C;\n                border-radius: 16px;\n                padding: 24px;\n                margin-bottom: 24px;\n              }\n              .patient-card h3 { font-size: 14px; color: #4CAF50; margin-bottom: 16px; font-weight: 600; }\n              .patient-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }\n              .patient-item { background: #fff; padding: 12px; border-radius: 8px; }\n              .patient-item label { font-size: 10px; color: #6b7280; text-transform: uppercase; font-weight: 600; display: block; }\n              .patient-item span { font-size: 14px; color: #1f2937; font-weight: 500; }\n\n              .section {\n                margin-bottom: 20px;\n                border: 1px solid #e5e7eb;\n                border-radius: 12px;\n                overflow: hidden;\n                page-break-inside: avoid;\n              }\n              .section-head {\n                background: #6BD55C;\n                color: white;\n                padding: 12px 20px;\n                font-size: 14px;\n                font-weight: 600;\n              }\n              .q-row {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 10px 20px;\n                border-bottom: 1px solid #e5e7eb;\n                font-size: 13px;\n              }\n              .q-row:last-child { border-bottom: none; }\n              .q-label { color: #4b5563; flex: 1; ${n?"padding-left":"padding-right"}: 20px; }\n              .q-answer { font-weight: 600; color: #1f2937; }\n\n              .signature-section {\n                margin-top: 24px;\n                padding: 20px;\n                border: 1px solid #e5e7eb;\n                border-radius: 12px;\n              }\n              .signature-section h4 { font-size: 14px; color: #374151; margin-bottom: 12px; }\n              .signature-section img { max-width: 250px; border: 2px solid #e5e7eb; border-radius: 8px; padding: 10px; background: #fff; }\n\n              .footer {\n                margin-top: 40px;\n                padding: 20px 40px;\n                background: #f9fafb;\n                border-top: 2px solid #6BD55C;\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n              }\n              .footer-logo { display: flex; align-items: center; gap: 10px; color: #6BD55C; font-weight: 600; }\n              .footer-text { font-size: 11px; color: #6b7280; }\n\n              @media print {\n                body { print-color-adjust: exact; -webkit-print-color-adjust: exact; }\n                .section { break-inside: avoid; }\n              }\n            </style>\n          </head>\n          <body>\n            <div class="header">\n              <div class="logo-section">\n                <img class="logo" src="https://greenofig.com/logo.png" alt="GreenoFig" onerror="this.style.display='none'" />\n                <div class="brand-text">\n                  <h1>GreenoFig</h1>\n                  <p>${n?"Ø´Ø±ÙŠÙƒÙƒ Ø§Ù„ØºØ°Ø§Ø¦ÙŠ Ø§Ù„Ø´Ø®ØµÙŠ":"Your Personal Nutrition Partner"}</p>\n                </div>\n              </div>\n              <div class="doc-info">\n                <h2>${n?"Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù‚Ø¨ÙˆÙ„":"Patient Intake Forms"}</h2>\n                <p>${new Date(e.created_at).toLocaleDateString()}</p>\n              </div>\n            </div>\n\n            <div class="content">\n              <div class="patient-card">\n                <h3>${n?"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶":"Patient Information"}</h3>\n                <div class="patient-grid">\n                  <div class="patient-item">\n                    <label>${n?"Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„":"Full Name"}</label>\n                    <span>${e.submitter_name}</span>\n                  </div>\n                  <div class="patient-item">\n                    <label>${n?"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ":"Email"}</label>\n                    <span>${e.submitter_email}</span>\n                  </div>\n                  <div class="patient-item">\n                    <label>${n?"Ø§Ù„Ù‡Ø§ØªÙ":"Phone"}</label>\n                    <span>${e.submitter_phone||"-"}</span>\n                  </div>\n                  <div class="patient-item">\n                    <label>${n?"Ø§Ù„Ø¹Ù…Ø±":"Age"}</label>\n                    <span>${e.submitter_age||"-"}</span>\n                  </div>\n                  <div class="patient-item">\n                    <label>${n?"Ø§Ù„Ø¹Ù†ÙˆØ§Ù†":"Address"}</label>\n                    <span>${e.submitter_address||"-"}</span>\n                  </div>\n                  <div class="patient-item">\n                    <label>${n?"ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø±Ø³Ø§Ù„":"Submitted"}</label>\n                    <span>${new Date(e.created_at).toLocaleDateString()}</span>\n                  </div>\n                </div>\n              </div>\n\n              ${c}\n\n              ${e.signature_data?`\n                <div class="signature-section">\n                  <h4>${n?"Ø§Ù„ØªÙˆÙ‚ÙŠØ¹":"Signature"}</h4>\n                  <img src="${e.signature_data}" alt="Signature" />\n                </div>\n              `:""}\n            </div>\n\n            <div class="footer">\n              <div class="footer-logo">\n                <img src="https://greenofig.com/logo.png" alt="GreenoFig" style="width: 24px; height: 24px; border-radius: 4px;" onerror="this.style.display='none'" />\n                <span style="font-weight: 600; color: #6BD55C;">GreenoFig</span>\n              </div>\n              <div class="footer-text">\n                ${n?"ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡":"Generated"} ${(new Date).toLocaleDateString()} | greenofig.com\n              </div>\n            </div>\n          </body>\n        </html>\n      `,x=window.open("","_blank");x.document.write(m),x.document.close(),x.focus(),setTimeout(()=>x.print(),400),a({title:i?"Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ PDF...":"Generating PDF..."})}catch(l){a({title:i?"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„":"Export failed",variant:"destructive"})}})(D),className:"border-primary/30 text-primary hover:bg-primary/10",children:[e.jsx(as,{className:"w-4 h-4 mr-1"}),"PDF"]}),e.jsxs(P,{variant:"outline",size:"sm",onClick:()=>(e=>{try{const s=e.responses||{},t=Z(e),l=[];l.push(["GreenoFig - Patient Intake Form Export"]),l.push(["Generated",(new Date).toLocaleString()]),l.push([]),l.push(["PATIENT INFORMATION"]),l.push(["Full Name",e.submitter_name]),l.push(["Email",e.submitter_email]),l.push(["Phone",e.submitter_phone||"-"]),l.push(["Age",e.submitter_age||"-"]),l.push(["Address",e.submitter_address||"-"]),l.push(["Submitted",new Date(e.created_at).toLocaleString()]),l.push([]),t.forEach(e=>{var t;null==(t=e.sections)||t.forEach(e=>{var t;l.push([`=== ${e.title} ===`]),null==(t=e.questions)||t.forEach(e=>{const t=s[e.id],a=!0===t?"Yes":!1===t?"No":Array.isArray(t)?t.join(", "):t||"-";l.push([e.label,a])}),l.push([])})});const r=l.map(e=>e.map(e=>`"${String(e).replace(/"/g,'""')}"`).join(",")).join("\n"),n=new Blob(["\ufeff"+r],{type:"text/csv;charset=utf-8;"}),c=URL.createObjectURL(n),d=document.createElement("a");d.href=c,d.download=`patient-${e.submitter_name.replace(/\s+/g,"-")}-${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(c),a({title:i?"ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù":"File downloaded"})}catch(s){a({title:i?"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„":"Export failed",variant:"destructive"})}})(D),className:"border-green-500/30 text-green-600 hover:bg-green-500/10",children:[e.jsx(pt,{className:"w-4 h-4 mr-1"}),"Excel"]})]}),e.jsxs("div",{className:"flex gap-2",children:["submitted"===(null==D?void 0:D.status)&&e.jsxs(P,{onClick:()=>H(D.id),className:"bg-gradient-to-r from-primary to-green-400 hover:opacity-90 text-primary-foreground",children:[e.jsx(Rs,{className:"w-4 h-4 mr-1"}),i?"ØªÙ… Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©":"Mark Reviewed"]}),e.jsx(P,{variant:"outline",onClick:()=>R(null),children:i?"Ø¥ØºÙ„Ø§Ù‚":"Close"})]})]})})]})})]})}const cl={pending:{label:"Pending",label_ar:"Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±",color:"bg-yellow-500/10 text-yellow-600 border-yellow-500/30",icon:Pe},in_progress:{label:"In Progress",label_ar:"Ù‚ÙŠØ¯ Ø§Ù„ØªÙ‚Ø¯Ù…",color:"bg-blue-500/10 text-blue-600 border-blue-500/30",icon:Pe},submitted:{label:"Submitted",label_ar:"ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„",color:"bg-primary/10 text-primary border-primary/30",icon:Rs},approved:{label:"Approved",label_ar:"ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©",color:"bg-emerald-500/10 text-emerald-600 border-emerald-500/30",icon:Rs},edit_requested:{label:"Edit Requested",label_ar:"Ø·Ù„Ø¨ ØªØ¹Ø¯ÙŠÙ„",color:"bg-orange-500/10 text-orange-600 border-orange-500/30",icon:Ds}},dl=[{value:"text",label:"Text",label_ar:"Ù†Øµ"},{value:"textarea",label:"Long Text",label_ar:"Ù†Øµ Ø·ÙˆÙŠÙ„"},{value:"yes_no",label:"Yes/No",label_ar:"Ù†Ø¹Ù…/Ù„Ø§"},{value:"select",label:"Dropdown",label_ar:"Ù‚Ø§Ø¦Ù…Ø© Ù…Ù†Ø³Ø¯Ù„Ø©"},{value:"multiselect",label:"Multi Select",label_ar:"ØªØ­Ø¯ÙŠØ¯ Ù…ØªØ¹Ø¯Ø¯"},{value:"date",label:"Date",label_ar:"ØªØ§Ø±ÙŠØ®"},{value:"number",label:"Number",label_ar:"Ø±Ù‚Ù…"},{value:"email",label:"Email",label_ar:"Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"},{value:"phone",label:"Phone",label_ar:"Ù‡Ø§ØªÙ"},{value:"signature",label:"Signature",label_ar:"ØªÙˆÙ‚ÙŠØ¹"}];function ol(){var s,t,a;const{t:l,i18n:i}=k(),{user:r}=w(),{sendPushToUser:n}=C(),c=i.language,d="ar"===c,[o,m]=g.useState("sent"),[x,u]=g.useState([]),[h,p]=g.useState([]),[j,f]=g.useState([]),[v,b]=g.useState([]),[N,D]=g.useState([]),[z,I]=g.useState(!0),[q,O]=g.useState(""),[G,W]=g.useState("all"),[U,V]=g.useState({}),[H,Y]=g.useState(!1),[K,Q]=g.useState(null),[J,Z]=g.useState([]),[X,se]=g.useState(!1),[ae,le]=g.useState(""),[ie,re]=g.useState(!1),[ne,ce]=g.useState(null),[de,oe]=g.useState(null),[me,xe]=g.useState(!1),[ue,he]=g.useState(null),[pe,ge]=g.useState(null),[je,ve]=g.useState(""),[be,Ne]=g.useState(null),[ye,we]=g.useState(""),[ke,De]=g.useState(null),[Me,Ae]=g.useState([]),[Re,Te]=g.useState(!1),[ze,Ie]=g.useState(null),[Le,qe]=g.useState({name:"",name_ar:"",description:"",description_ar:"",form_type:"custom",sections:[]}),[Oe,Be]=g.useState(!1),[We,Ue]=g.useState({}),Ve=e=>We[e]||(d?"ar":"en");g.useEffect(()=>{(null==r?void 0:r.id)&&Ye();const e=_.channel("nutritionist_forms_realtime").on("postgres_changes",{event:"*",schema:"public",table:"form_assignments"},Ye).on("postgres_changes",{event:"*",schema:"public",table:"form_responses"},Ye).on("postgres_changes",{event:"*",schema:"public",table:"form_edit_requests"},Ye).subscribe();return()=>e.unsubscribe()},[null==r?void 0:r.id]);const Ye=async()=>{if(null==r?void 0:r.id)try{const{data:e}=await _.from("form_templates").select("*").eq("is_active",!0).or("is_system_template.is.null,is_system_template.eq.false").or("is_default.is.null,is_default.eq.false").eq("created_by",r.id).order("created_at",{ascending:!1}),{data:s}=await _.from("form_templates").select("*").eq("is_system_template",!0).eq("is_active",!0).order("name");p(s||[]);const{data:t}=await _.from("form_assignments").select("*, form_template:form_templates(*), responses:form_responses(*)").order("created_at",{ascending:!1});if(t&&t.length>0){const e=[...new Set(t.map(e=>e.client_id))],{data:s}=await _.from("user_profiles").select("id, full_name, email, profile_picture_url").in("id",e),a=t.map(e=>({...e,client:(null==s?void 0:s.find(s=>s.id===e.client_id))||null}));f(a)}else f([]);const{data:a}=await _.from("user_profiles").select("id, full_name, email, profile_picture_url").eq("role","user").order("full_name"),{data:l}=await _.from("form_edit_requests").select("*, assignment:form_assignments(*, form_template:form_templates(*))").eq("status","pending");if(l&&l.length>0){const e=[...new Set(l.map(e=>e.client_id))],{data:s}=await _.from("user_profiles").select("id, full_name, email").in("id",e),t=l.map(e=>({...e,client:(null==s?void 0:s.find(s=>s.id===e.client_id))||null}));b(t)}else b([]);u(e||[]),D(a||[])}catch(e){}finally{I(!1)}},Ke=(e,s=!1,t=null)=>{const a="#6BD55C",l=e.sections||[],i=t?"ar"===t:d,r=l.map((e,s)=>{const t=i&&e.title_ar||e.title,l=(e.questions||[]).map((e,s)=>(e=>{const s=i&&e.label_ar||e.label,t=e.required?'<span style="color: #dc2626;">*</span>':"";if("yes_no"===e.type)return`\n          <tr>\n            <td style="padding: 8px 12px; border-bottom: 1px solid #e5e7eb; font-size: 11px; vertical-align: middle;">\n              ${s} ${t}\n            </td>\n            <td style="padding: 8px 12px; border-bottom: 1px solid #e5e7eb; width: 60px; text-align: center; vertical-align: middle;">\n              <div style="display: inline-flex; align-items: center; gap: 6px;">\n                <span style="display: inline-block; width: 14px; height: 14px; min-width: 14px; border: 2px solid #374151; border-radius: 3px; flex-shrink: 0;"></span>\n                <span style="font-size: 11px;">${i?"Ù†Ø¹Ù…":"Yes"}</span>\n              </div>\n            </td>\n            <td style="padding: 8px 12px; border-bottom: 1px solid #e5e7eb; width: 60px; text-align: center; vertical-align: middle;">\n              <div style="display: inline-flex; align-items: center; gap: 6px;">\n                <span style="display: inline-block; width: 14px; height: 14px; min-width: 14px; border: 2px solid #374151; border-radius: 3px; flex-shrink: 0;"></span>\n                <span style="font-size: 11px;">${i?"Ù„Ø§":"No"}</span>\n              </div>\n            </td>\n          </tr>\n        `;if(("multiselect"===e.type||"checkbox"===e.type)&&e.options)return`\n          <tr>\n            <td colspan="3" style="padding: 8px 12px; border-bottom: 1px solid #e5e7eb;">\n              <div style="font-size: 11px; margin-bottom: 6px; font-weight: 500;">${s} ${t}</div>\n              <div style="display: flex; flex-wrap: wrap; padding-left: 4px;">${(i&&e.options_ar?e.options_ar:e.options).map(e=>`\n          <label style="display: inline-flex; align-items: center; gap: 8px; margin: 4px 16px 4px 0; font-size: 11px; line-height: 1.4;">\n            <span style="display: inline-block; width: 14px; height: 14px; min-width: 14px; border: 2px solid #374151; border-radius: 3px; flex-shrink: 0;"></span>\n            <span>${"object"==typeof e?i&&e.label_ar||e.label:e}</span>\n          </label>\n        `).join("")}</div>\n            </td>\n          </tr>\n        `;if("select"===e.type&&e.options)return`\n          <tr>\n            <td colspan="3" style="padding: 8px 12px; border-bottom: 1px solid #e5e7eb;">\n              <div style="font-size: 11px; margin-bottom: 6px; font-weight: 500;">${s} ${t}</div>\n              <div style="display: flex; flex-wrap: wrap; padding-left: 4px;">${(i&&e.options_ar?e.options_ar:e.options).map(e=>`\n          <label style="display: inline-flex; align-items: center; gap: 8px; margin: 4px 16px 4px 0; font-size: 11px; line-height: 1.4;">\n            <span style="display: inline-block; width: 14px; height: 14px; min-width: 14px; border: 2px solid #374151; border-radius: 50%; flex-shrink: 0;"></span>\n            <span>${"object"==typeof e?i&&e.label_ar||e.label:e}</span>\n          </label>\n        `).join("")}</div>\n            </td>\n          </tr>\n        `;return"textarea"===e.type?`\n          <tr>\n            <td colspan="3" style="padding: 8px 12px; border-bottom: 1px solid #e5e7eb;">\n              <div style="font-size: 11px; margin-bottom: 6px; font-weight: 500;">${s} ${t}</div>\n              <div style="border-bottom: 1px solid #9ca3af; height: 16px; margin-bottom: 4px;"></div>\n              <div style="border-bottom: 1px solid #9ca3af; height: 16px;"></div>\n            </td>\n          </tr>\n        `:"signature"===e.type?`\n          <tr>\n            <td colspan="3" style="padding: 8px 12px; border-bottom: 1px solid #e5e7eb;">\n              <div style="font-size: 11px; margin-bottom: 6px; font-weight: 500;">${s} ${t}</div>\n              <div style="border: 1px solid #d1d5db; height: 45px; border-radius: 4px; background: #f9fafb;"></div>\n            </td>\n          </tr>\n        `:`\n        <tr>\n          <td colspan="3" style="padding: 8px 12px; border-bottom: 1px solid #e5e7eb;">\n            <div style="display: flex; align-items: center; gap: 8px;">\n              <span style="font-size: 11px; white-space: nowrap;">${s} ${t}</span>\n              <span style="flex: 1; border-bottom: 1px solid #9ca3af; height: 1px; min-width: 50px;"></span>\n            </div>\n          </td>\n        </tr>\n      `})(e)).join("");return`\n        <div class="section-wrapper" style="margin-bottom: 10px; page-break-inside: avoid; break-inside: avoid;">\n          <div style="background: linear-gradient(135deg, ${a}, #4ade80); color: white; padding: 6px 10px; font-weight: 600; font-size: 12px; border-radius: 4px 4px 0 0;">\n            ${t}\n          </div>\n          <table style="width: 100%; border-collapse: collapse; border: 1px solid #e5e7eb; border-top: none;">\n            <tbody>\n              ${l}\n            </tbody>\n          </table>\n        </div>\n      `}).join("");return`\n      <!DOCTYPE html>\n      <html dir="${i?"rtl":"ltr"}">\n      <head>\n        <meta charset="UTF-8">\n        <title></title>\n        <style>\n          @media print {\n            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; margin: 0; padding: 0; }\n            .no-print { display: none !important; }\n            @page { size: A4; margin: 10mm 10mm 10mm 10mm; }\n            .section-wrapper, .header-wrapper, .footer-wrapper { page-break-inside: avoid; break-inside: avoid; }\n            /* Hide browser header/footer when printing */\n            title { display: none; }\n          }\n          /* Remove page title from print */\n          @page { margin-top: 10mm; margin-bottom: 10mm; }\n          body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            margin: 0;\n            padding: 10px;\n            background: ${s?"white":"#f3f4f6"};\n            color: #1f2937;\n            direction: ${i?"rtl":"ltr"};\n          }\n          .container {\n            width: 100%;\n            max-width: 210mm;\n            margin: 0 auto;\n            background: white;\n            padding: 12mm 15mm;\n            border-radius: 0;\n            box-shadow: ${s?"none":"0 4px 20px rgba(0,0,0,0.1)"};\n            box-sizing: border-box;\n          }\n          .header-wrapper {\n            page-break-inside: avoid;\n            break-inside: avoid;\n          }\n          .header {\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n            border-bottom: 3px solid ${a};\n            padding-bottom: 15px;\n            margin-bottom: 15px;\n          }\n          .logo-section {\n            display: flex;\n            align-items: center;\n            gap: 10px;\n          }\n          .logo {\n            width: 45px;\n            height: 45px;\n            object-fit: contain;\n          }\n          .brand-name {\n            font-size: 22px;\n            font-weight: 700;\n            color: ${a};\n          }\n          .form-title {\n            font-size: 18px;\n            font-weight: 700;\n            color: #1f2937;\n            text-align: ${i?"left":"right"};\n          }\n          .info-row {\n            display: flex;\n            gap: 30px;\n            margin-bottom: 20px;\n            flex-wrap: wrap;\n            padding: 10px 0;\n          }\n          .info-field {\n            display: flex;\n            align-items: center;\n            gap: 10px;\n            flex: 1;\n            min-width: 200px;\n          }\n          .info-label {\n            font-weight: 700;\n            font-size: 12px;\n            white-space: nowrap;\n          }\n          .info-line {\n            flex: 1;\n            border-bottom: 2px solid #374151;\n            height: 1px;\n            min-width: 100px;\n          }\n          .footer-wrapper {\n            page-break-inside: avoid;\n            break-inside: avoid;\n            margin-top: 20px;\n          }\n          .signature-section {\n            padding-top: 15px;\n            border-top: 2px solid #e5e7eb;\n          }\n          .signature-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 40px;\n            margin-top: 15px;\n          }\n          .signature-box {\n            text-align: center;\n          }\n          .signature-line {\n            border-bottom: 2px solid #374151;\n            height: 50px;\n            margin-bottom: 8px;\n          }\n          .signature-label {\n            font-size: 12px;\n            font-weight: 600;\n            color: #374151;\n          }\n          .notes-section {\n            padding: 12px;\n            background: #f9fafb;\n            border: 1px solid #e5e7eb;\n            border-radius: 6px;\n            margin-bottom: 15px;\n          }\n          .notes-title {\n            font-weight: 700;\n            margin-bottom: 10px;\n            color: #374151;\n            font-size: 12px;\n          }\n          .notes-lines div {\n            border-bottom: 1px solid #d1d5db;\n            height: 22px;\n          }\n        </style>\n      </head>\n      <body>\n        <div class="container">\n          <div class="header-wrapper">\n            <div class="header">\n              <div class="logo-section">\n                <img class="logo" src="https://greenofig.com/logo.png" alt="GreenoFig" onerror="this.style.display='none'" />\n                <span class="brand-name">GreenoFig</span>\n              </div>\n              <div class="form-title">${i&&e.name_ar||e.name}</div>\n            </div>\n\n            <div class="info-row">\n              <div class="info-field">\n                <span class="info-label">${i?"Ø§Ù„Ø§Ø³Ù…:":"NAME:"}</span>\n                <span class="info-line"></span>\n              </div>\n              <div class="info-field">\n                <span class="info-label">${i?"Ø§Ù„ØªØ§Ø±ÙŠØ®:":"DATE:"}</span>\n                <span class="info-line"></span>\n              </div>\n            </div>\n          </div>\n\n          ${r}\n\n          <div class="footer-wrapper">\n            <div class="notes-section">\n              <div class="notes-title">${i?"Ù…Ù„Ø§Ø­Ø¸Ø§Øª:":"NOTES:"}</div>\n              <div class="notes-lines">\n                <div></div>\n                <div></div>\n                <div></div>\n              </div>\n            </div>\n\n            <div class="signature-section">\n              <div class="signature-grid">\n                <div class="signature-box">\n                  <div class="signature-line"></div>\n                  <div class="signature-label">${i?"Ø§Ù„ØªÙˆÙ‚ÙŠØ¹":"SIGNATURE"}</div>\n                </div>\n                <div class="signature-box">\n                  <div class="signature-line"></div>\n                  <div class="signature-label">${i?"ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø´Ø§Ù‡Ø¯":"WITNESS"}</div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </body>\n      </html>\n    `},Qe=async e=>{const s=e._lang||Ve(e.id),t="ar"===s,a=t&&e.name_ar||e.name;try{F({title:t?"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...":"Downloading...",description:t?"ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PDF":"Generating PDF file"});const[{default:l},{default:i}]=await Promise.all([B(()=>import("./jspdf.es.min-8244350b.js").then(e=>e.j),["assets/jspdf.es.min-8244350b.js","assets/index-6b8dec48.js","assets/vendor-ui-1f4695e3.js","assets/vendor-react-c35372bd.js","assets/vendor-utils-a892ab91.js","assets/vendor-editor-8f9f6f2d.js","assets/index-1a863d34.css"]),B(()=>import("./html2canvas.esm-6d434b9e.js"),[])]),r=document.createElement("div");r.style.position="absolute",r.style.left="-9999px",r.style.top="0",r.style.width="794px",r.style.background="white",r.innerHTML=Ke(e,!0,s),document.body.appendChild(r),await new Promise(e=>setTimeout(e,300));const n=r.querySelector(".container")||r,c=await i(n,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",logging:!1});document.body.removeChild(r);const d=new l("p","mm","a4"),o=210,m=297,x=5,u=c.width,h=c.height,p=(o-2*x)/u,g=h*p;if(g>m-2*x){const e=(m-2*x)/p;let s=0,t=0;for(;s<h;){t>0&&d.addPage();const a=h-s,l=Math.min(e,a),i=document.createElement("canvas");i.width=u,i.height=l;const r=i.getContext("2d");r.fillStyle="#ffffff",r.fillRect(0,0,i.width,i.height),r.drawImage(c,0,s,u,l,0,0,u,l),d.addImage(i.toDataURL("image/png"),"PNG",x,x,o-2*x,l*p),s+=e,t++}}else d.addImage(c.toDataURL("image/png"),"PNG",x,x,o-2*x,g);d.save(`${a.replace(/[^a-zA-Z0-9\u0600-\u06FF\s]/g,"_")}.pdf`),F({title:t?"ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„!":"Downloaded!",description:t?"ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù PDF Ø¨Ù†Ø¬Ø§Ø­":"PDF file downloaded successfully"})}catch(l){F({title:t?"Ø®Ø·Ø£":"Error",description:t?"ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PDF":"Failed to generate PDF",variant:"destructive"})}},Je=async(e,s=null)=>{try{const t=(()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let s="";for(let t=0;t<12;t++)s+=e.charAt(Math.floor(62*Math.random()));return s})(),a=s||Ve(e.id),{data:l,error:i}=await _.from("public_form_links").insert({nutritionist_id:r.id,form_template_id:e.id,link_code:t,title:e.name,title_ar:e.name_ar,is_active:!0,form_language:a}).select().single();if(i)throw i;const n=`${window.location.origin}/form/${t}`;return await navigator.clipboard.writeText(n),F({title:d?"ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø§Ø¨Ø·!":"Link Created!",description:d?`ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø© (${"ar"===a?"Ø¹Ø±Ø¨ÙŠ":"Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ"})`:`Link copied to clipboard (${"ar"===a?"Arabic":"English"})`}),n}catch(t){F({title:d?"Ø®Ø·Ø£":"Error",description:t.message,variant:"destructive"})}},Xe=()=>{Y(!1),Q(null),Z([]),le(""),re(!1)},es=async(e,s)=>{try{const t=v.find(s=>s.id===e);if(!t)return;await _.from("form_edit_requests").update({status:s?"approved":"denied",responded_by:r.id,responded_at:(new Date).toISOString()}).eq("id",e),await _.from("form_assignments").update({status:s?"in_progress":"submitted"}).eq("id",t.assignment_id),await _.from("notifications").insert({user_id:t.client_id,type:"edit_request_response",title:s?d?"ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø·Ù„Ø¨ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„":"Edit Request Approved":d?"ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„":"Edit Request Denied",message:s?d?"ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬":"You can now edit your form":d?"Ù„Ù… ÙŠØªÙ… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„":"Your edit request was not approved"}),Ye()}catch(t){}},ss=async e=>{try{await _.from("form_assignments").update({status:"approved",approved_at:(new Date).toISOString()}).eq("id",e);const s=j.find(s=>s.id===e);s&&await _.from("notifications").insert({user_id:s.client_id,type:"form_approved",title:d?"ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬":"Form Approved",message:d?"ØªÙ…Øª Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ ÙˆØ§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„ÙŠÙ‡":"Your form has been reviewed and approved"}),Ye()}catch(s){}},ts=(e,s,t)=>{qe(a=>{const l=[...a.sections];return l[e]={...l[e],[s]:t},{...a,sections:l}})},rs=(e,s,t,a)=>{qe(l=>{const i=[...l.sections];return i[e].questions[s]={...i[e].questions[s],[t]:a},{...l,sections:i}})},ns=j.filter(e=>{var s,t,a,l,i,r;const n=(null==(t=null==(s=e.client)?void 0:s.full_name)?void 0:t.toLowerCase().includes(q.toLowerCase()))||(null==(l=null==(a=e.client)?void 0:a.email)?void 0:l.toLowerCase().includes(q.toLowerCase()))||(null==(r=null==(i=e.form_template)?void 0:i.name)?void 0:r.toLowerCase().includes(q.toLowerCase())),c="all"===G||e.status===G;return n&&c}),ds={};ns.forEach(e=>{var s;const t=(null==(s=e.client)?void 0:s.id)||e.client_id;t&&(ds[t]||(ds[t]={client:e.client||{id:t,full_name:"Unknown",email:""},forms:[]}),ds[t].forms.push(e))});const os=Object.values(ds),xs={total:j.length,pending:j.filter(e=>"pending"===e.status).length,inProgress:j.filter(e=>"in_progress"===e.status).length,submitted:j.filter(e=>"submitted"===e.status).length,approved:j.filter(e=>"approved"===e.status).length,editRequests:v.length,completionRate:j.length>0?Math.round(j.filter(e=>["submitted","approved"].includes(e.status)).length/j.length*100):0},ps=j.filter(e=>e.due_date&&new Date(e.due_date)<new Date&&!["submitted","approved"].includes(e.status));return z?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(Se,{className:"w-8 h-8 animate-spin text-primary"})}):ne?e.jsxs("div",{className:"p-4",children:[e.jsx(P,{variant:"outline",onClick:()=>ce(null),className:"mb-4",children:d?"â† Ø§Ù„Ø¹ÙˆØ¯Ø©":"â† Back"}),e.jsx(Bt,{assignmentId:ne.id,formTemplate:ne.form_template,existingResponses:null==(t=null==(s=ne.responses)?void 0:s[0])?void 0:t.responses,readOnly:!0,onClose:()=>ce(null)})]}):e.jsxs("div",{className:"p-4 "+(d?"rtl":"ltr"),dir:d?"rtl":"ltr",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-2xl bg-primary/10",children:e.jsx(jt,{className:"w-7 h-7 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:d?"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ù…Ø§Ø°Ø¬":"Form Management"}),e.jsx("p",{className:"text-text-secondary mt-1",children:d?"Ø¥Ø±Ø³Ø§Ù„ ÙˆØªØªØ¨Ø¹ Ù†Ù…Ø§Ø°Ø¬ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡":"Send and track client intake forms"})]})]}),e.jsxs(P,{onClick:()=>{re(!1),Y(!0)},className:"bg-gradient-to-r from-primary to-green-400 hover:opacity-90 text-primary-foreground",children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),d?"Ø¥Ø±Ø³Ø§Ù„ Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø¯ÙŠØ¯":"Send New Form"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3 mb-6",children:[{icon:Ge,value:xs.total,label:d?"Ø¥Ø¬Ù…Ø§Ù„ÙŠ":"Total",bgColor:"bg-blue-500/10",iconColor:"text-blue-600"},{icon:Pe,value:xs.pending,label:d?"Ø§Ù†ØªØ¸Ø§Ø±":"Pending",bgColor:"bg-yellow-500/10",iconColor:"text-yellow-600"},{icon:ms,value:xs.inProgress,label:d?"Ù‚ÙŠØ¯ Ø§Ù„ØªÙ‚Ø¯Ù…":"In Progress",bgColor:"bg-blue-500/10",iconColor:"text-blue-600"},{icon:Rs,value:xs.submitted,label:d?"Ù…ÙØ±Ø³Ù„":"Submitted",bgColor:"bg-primary/10",iconColor:"text-primary"},{icon:ft,value:xs.approved,label:d?"Ù…ÙˆØ§ÙÙ‚":"Approved",bgColor:"bg-emerald-500/10",iconColor:"text-emerald-600"},{icon:ee,value:`${xs.completionRate}%`,label:d?"Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„":"Complete",bgColor:"bg-purple-500/10",iconColor:"text-purple-600"}].map((s,t)=>e.jsx("div",{className:"glass-effect rounded-xl p-3 border border-border/30",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-1.5 ${s.bgColor} rounded-lg`,children:e.jsx(s.icon,{className:`w-4 h-4 ${s.iconColor}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold text-foreground",children:s.value}),e.jsx("p",{className:"text-[10px] text-text-secondary",children:s.label})]})]})},t))}),ps.length>0&&e.jsxs("div",{className:"glass-effect rounded-xl mb-4 border border-red-500/30 bg-red-500/5 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600 mb-2",children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsx("span",{className:"font-semibold text-sm",children:d?`${ps.length} Ù†Ù…ÙˆØ°Ø¬ Ù…ØªØ£Ø®Ø±`:`${ps.length} Overdue Form(s)`})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[ps.slice(0,3).map(s=>{var t,a;return e.jsxs(y,{variant:"outline",className:"text-red-600 border-red-500/30 text-xs",children:[null==(t=s.client)?void 0:t.full_name," - ",null==(a=s.form_template)?void 0:a.name]},s.id)}),ps.length>3&&e.jsxs(y,{variant:"outline",className:"text-red-600 border-red-500/30 text-xs",children:["+",ps.length-3," ",d?"Ø£Ø®Ø±Ù‰":"more"]})]})]}),v.length>0&&e.jsxs("div",{className:"glass-effect rounded-xl mb-4 border border-orange-500/30 bg-orange-500/5",children:[e.jsx("div",{className:"p-3 border-b border-orange-500/20",children:e.jsxs("h3",{className:"font-semibold flex items-center gap-2 text-orange-600 text-sm",children:[e.jsx(Ee,{className:"w-4 h-4"}),d?"Ø·Ù„Ø¨Ø§Øª ØªØ¹Ø¯ÙŠÙ„ ØªØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø©":"Edit Requests Pending"," (",v.length,")"]})}),e.jsx("div",{className:"p-3 space-y-2",children:v.map(s=>{var t,a,l,i,r,n,c;return e.jsxs("div",{className:"flex items-center justify-between glass-effect p-2 rounded-lg border border-border/30",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm text-foreground truncate",children:null==(t=s.client)?void 0:t.full_name}),e.jsx("p",{className:"text-xs text-text-secondary truncate",children:d?(null==(l=null==(a=s.assignment)?void 0:a.form_template)?void 0:l.name_ar)||(null==(r=null==(i=s.assignment)?void 0:i.form_template)?void 0:r.name):null==(c=null==(n=s.assignment)?void 0:n.form_template)?void 0:c.name}),e.jsxs("p",{className:"text-[10px] text-text-secondary mt-0.5 truncate",children:[d?"Ø§Ù„Ø³Ø¨Ø¨:":"Reason:"," ",s.reason]})]}),e.jsxs("div",{className:"flex gap-1 flex-shrink-0",children:[e.jsx(P,{size:"sm",variant:"outline",onClick:()=>es(s.id,!1),className:"h-7 px-2",children:e.jsx(cs,{className:"w-3 h-3"})}),e.jsx(P,{size:"sm",className:"h-7 px-2 bg-gradient-to-r from-primary to-green-400 hover:opacity-90 text-primary-foreground",onClick:()=>es(s.id,!0),children:e.jsx(ft,{className:"w-3 h-3"})})]})]},s.id)})})]}),e.jsxs(Dt,{value:o,onValueChange:m,children:[e.jsxs(Pt,{className:"mb-4 flex-wrap h-auto gap-1",children:[e.jsxs(Mt,{value:"sent",className:"flex items-center gap-1.5 text-sm",children:[e.jsx(hs,{className:"w-3.5 h-3.5"}),d?"Ø§Ù„Ù…Ø±Ø³Ù„Ø©":"Sent",e.jsx(y,{variant:"secondary",className:"text-[10px] px-1",children:xs.total})]}),e.jsxs(Mt,{value:"submissions",className:"flex items-center gap-1.5 text-sm",children:[e.jsx(Rs,{className:"w-3.5 h-3.5"}),d?"Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©":"Received",xs.submitted>0&&e.jsx(y,{variant:"destructive",className:"text-[10px] px-1",children:xs.submitted})]}),e.jsxs(Mt,{value:"templates",className:"flex items-center gap-1.5 text-sm",children:[e.jsx(Ge,{className:"w-3.5 h-3.5"}),d?"Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨":"Templates"]}),e.jsxs(Mt,{value:"analytics",className:"flex items-center gap-1.5 text-sm",children:[e.jsx(Fe,{className:"w-3.5 h-3.5"}),d?"Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª":"Analytics"]})]}),e.jsxs(At,{value:"sent",children:[e.jsxs("div",{className:"flex gap-3 mb-4 flex-wrap items-center",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ze,{className:`absolute ${d?"right-3":"left-3"} top-1/2 transform -translate-y-1/2 w-4 h-4 text-text-secondary`}),e.jsx(E,{placeholder:d?"Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„...":"Search by name or email...",value:q,onChange:e=>O(e.target.value),className:(d?"pr-10":"pl-10")+" bg-card/50 border-border/30 h-9"})]})}),e.jsxs("select",{value:G,onChange:e=>W(e.target.value),className:"px-3 py-1.5 border border-primary/30 rounded-lg bg-primary/5 text-foreground text-sm h-9 focus:ring-2 focus:ring-primary/20 focus:border-primary",children:[e.jsx("option",{value:"all",children:d?"ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª":"All Status"}),e.jsx("option",{value:"pending",children:d?"Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±":"Pending"}),e.jsx("option",{value:"in_progress",children:d?"Ù‚ÙŠØ¯ Ø§Ù„ØªÙ‚Ø¯Ù…":"In Progress"}),e.jsx("option",{value:"submitted",children:d?"ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„":"Submitted"}),e.jsx("option",{value:"approved",children:d?"Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡":"Approved"})]}),os.length>0&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx(P,{variant:"outline",size:"sm",className:"h-9 px-2 text-xs",onClick:()=>{const e={};os.forEach(s=>{e[s.client.id]=!0}),V(e)},children:d?"ØªÙˆØ³ÙŠØ¹ Ø§Ù„ÙƒÙ„":"Expand All"}),e.jsx(P,{variant:"outline",size:"sm",className:"h-9 px-2 text-xs",onClick:()=>{V({})},children:d?"Ø·ÙŠ Ø§Ù„ÙƒÙ„":"Collapse All"})]})]}),e.jsx("div",{className:"space-y-2",children:0===os.length?e.jsxs("div",{className:"glass-effect rounded-xl text-center py-8 border border-border/30",children:[e.jsx(hs,{className:"w-10 h-10 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-text-secondary text-sm",children:d?"Ù„Ù… ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù†Ù…Ø§Ø°Ø¬ Ø¨Ø¹Ø¯":"No forms sent yet"}),e.jsxs(P,{size:"sm",className:"mt-3 bg-gradient-to-r from-primary to-green-400 hover:opacity-90 text-primary-foreground",onClick:()=>Y(!0),children:[e.jsx(Ce,{className:"w-3.5 h-3.5 mr-1"}),d?"Ø¥Ø±Ø³Ø§Ù„ Ø£ÙˆÙ„ Ù†Ù…ÙˆØ°Ø¬":"Send First Form"]})]}):os.map(s=>{var t;const a=U[s.client.id],l=s.forms.filter(e=>"pending"===e.status).length,i=s.forms.filter(e=>"submitted"===e.status).length;return e.jsxs("div",{className:"glass-effect rounded-xl border border-border/30 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 cursor-pointer hover:bg-muted/30 transition-colors",onClick:()=>{return e=s.client.id,void V(s=>({...s,[e]:!s[e]}));var e},children:[e.jsx("div",{className:"flex items-center justify-center w-6 flex-shrink-0",children:a?e.jsx(xt,{className:"w-4 h-4 text-primary"}):e.jsx(fe,{className:"w-4 h-4 text-text-secondary"})}),e.jsx("div",{className:"w-9 h-9 rounded-full bg-muted flex items-center justify-center overflow-hidden flex-shrink-0",children:s.client.profile_picture_url?e.jsx("img",{src:s.client.profile_picture_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-sm font-medium text-text-secondary",children:(null==(t=s.client.full_name)?void 0:t.charAt(0))||"?"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm text-foreground truncate",children:s.client.full_name}),e.jsx("p",{className:"text-xs text-text-secondary truncate",children:s.client.email})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[i>0&&e.jsxs(y,{variant:"destructive",className:"text-[10px] px-1.5",children:[i," ",d?"Ø¬Ø¯ÙŠØ¯":"new"]}),l>0&&e.jsxs(y,{className:"bg-yellow-500/10 text-yellow-600 border-yellow-500/30 text-[10px] px-1.5",children:[l," ",d?"Ø§Ù†ØªØ¸Ø§Ø±":"pending"]}),e.jsxs(y,{variant:"secondary",className:"text-xs",children:[s.forms.length," ",d?"Ù†Ù…ÙˆØ°Ø¬":"form(s)"]})]})]}),a&&e.jsx("div",{className:"border-t border-border/20 divide-y divide-border/20",children:s.forms.map(s=>{var t,a,l,i;const r=cl[s.status],o=r.icon,m=s.due_date&&new Date(s.due_date)<new Date&&!["submitted","approved"].includes(s.status);return e.jsxs("div",{className:"flex items-center justify-between p-2.5 hover:bg-muted/20 transition-colors "+(m?"bg-red-500/5":""),children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0 ml-6",children:[e.jsx("div",{className:"p-1.5 bg-primary/10 rounded-lg flex-shrink-0",children:e.jsx(Ge,{className:"w-3 h-3 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-foreground truncate",children:d?(null==(t=s.form_template)?void 0:t.name_ar)||(null==(a=s.form_template)?void 0:a.name):null==(l=s.form_template)?void 0:l.name}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap mt-0.5",children:[e.jsxs(y,{className:`${r.color} border text-[9px] px-1 py-0`,children:[e.jsx(o,{className:"w-2 h-2 mr-0.5"}),d?r.label_ar:r.label]}),e.jsx("span",{className:"text-[10px] text-text-secondary",children:new Date(s.created_at).toLocaleDateString(c)}),s.due_date&&e.jsxs("span",{className:"text-[10px] "+(m?"text-red-500 font-medium":"text-text-secondary"),children:[d?"Ù…ÙˆØ¹Ø¯:":"Due:"," ",new Date(s.due_date).toLocaleDateString(c)]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(null==(i=s.responses)?void 0:i.length)>0&&e.jsx(P,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:e=>{e.stopPropagation(),ce(s)},children:e.jsx(ls,{className:"w-3 h-3"})}),["pending","in_progress"].includes(s.status)&&e.jsxs(e.Fragment,{children:[e.jsx(P,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:e=>{e.stopPropagation(),Ne(s)},children:e.jsx(_e,{className:"w-3 h-3"})}),e.jsx(P,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:e=>{var t;e.stopPropagation(),ge(s),ve((null==(t=s.due_date)?void 0:t.split("T")[0])||"")},children:e.jsx(is,{className:"w-3 h-3"})})]}),e.jsx(P,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:e=>{var t;e.stopPropagation(),Q((t=s).form_template),Z([t.client_id]),re(!0),Y(!0)},children:e.jsx(_s,{className:"w-3 h-3"})}),"submitted"===s.status&&e.jsxs(P,{size:"sm",className:"h-6 px-2 bg-gradient-to-r from-primary to-green-400 hover:opacity-90 text-primary-foreground text-[10px]",onClick:e=>{e.stopPropagation(),ss(s.id)},children:[e.jsx(ft,{className:"w-3 h-3 mr-0.5"}),d?"Ù…ÙˆØ§ÙÙ‚Ø©":"Approve"]}),e.jsx(P,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-red-500 hover:text-red-600 hover:bg-red-50",onClick:e=>{e.stopPropagation(),window.confirm(d?"Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ Ø³ÙŠØªÙ… Ø¥Ø²Ø§Ù„ØªÙ‡ Ù…Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø£ÙŠØ¶Ø§Ù‹.":"Delete this form permanently? It will be removed from the client as well.")&&(async e=>{var s,t;try{const l=j.find(s=>s.id===e),i=null==l?void 0:l.client_id,r=(null==(s=null==l?void 0:l.form_template)?void 0:s.name)||"Form",c=(null==(t=null==l?void 0:l.form_template)?void 0:t.name_ar)||r,{error:o}=await _.from("form_responses").delete().eq("assignment_id",e),{error:m}=await _.from("form_edit_requests").delete().eq("assignment_id",e),{error:x}=await _.from("form_assignments").delete().eq("id",e);if(x)throw x;if(f(s=>s.filter(s=>s.id!==e)),i){await _.from("notifications").insert({user_id:i,type:"form_removed",title:d?"ØªÙ… Ø­Ø°Ù Ø§Ù„Ù†Ù…ÙˆØ°Ø¬":"Form Removed",message:d?`ØªÙ… Ø­Ø°Ù Ø§Ù„Ù†Ù…ÙˆØ°Ø¬: ${c}`:`The form "${r}" has been removed by your nutritionist`,is_read:!1});try{await n(i,{title:d?"ØªÙ… Ø­Ø°Ù Ø§Ù„Ù†Ù…ÙˆØ°Ø¬":"Form Removed",body:d?`ØªÙ… Ø­Ø°Ù Ø§Ù„Ù†Ù…ÙˆØ°Ø¬: ${c}`:`The form "${r}" has been removed by your nutritionist`,data:{type:"form_removed"}})}catch(a){}}F({title:d?"ØªÙ… Ø§Ù„Ø­Ø°Ù":"Form Deleted",description:d?"ØªÙ… Ø­Ø°Ù Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹":"Form has been permanently deleted"}),Ye()}catch(l){F({title:d?"Ø®Ø·Ø£":"Error",description:d?"ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ù†Ù…ÙˆØ°Ø¬":"Failed to delete form",variant:"destructive"}),Ye()}})(s.id)},children:e.jsx($e,{className:"w-3 h-3"})})]})]},s.id)})})]},s.client.id)})})]}),e.jsx(At,{value:"submissions",children:e.jsx("div",{className:"space-y-3",children:0===j.filter(e=>"submitted"===e.status).length?e.jsxs("div",{className:"glass-effect rounded-xl text-center py-8 border border-border/30",children:[e.jsx(Rs,{className:"w-10 h-10 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-text-secondary text-sm",children:d?"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ù…Ø§Ø°Ø¬ Ø¨Ø­Ø§Ø¬Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©":"No forms pending review"})]}):j.filter(e=>"submitted"===e.status).map(s=>{var t,a,l,i,r,n,o;return e.jsx("div",{className:"glass-effect rounded-xl p-3 border border-primary/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center overflow-hidden",children:(null==(t=s.client)?void 0:t.profile_picture_url)?e.jsx("img",{src:s.client.profile_picture_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-sm font-medium text-text-secondary",children:(null==(l=null==(a=s.client)?void 0:a.full_name)?void 0:l.charAt(0))||"?"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm text-foreground",children:null==(i=s.client)?void 0:i.full_name}),e.jsx("p",{className:"text-xs text-text-secondary",children:d?(null==(r=s.form_template)?void 0:r.name_ar)||(null==(n=s.form_template)?void 0:n.name):null==(o=s.form_template)?void 0:o.name}),e.jsxs("p",{className:"text-[10px] text-text-secondary mt-0.5",children:[d?"ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„:":"Submitted:"," ",new Date(s.submitted_at).toLocaleDateString(c)]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(P,{variant:"outline",size:"sm",onClick:()=>ce(s),className:"h-8",children:[e.jsx(ls,{className:"w-3.5 h-3.5 mr-1"}),d?"Ø¹Ø±Ø¶":"View"]}),e.jsxs(P,{size:"sm",className:"h-8 bg-gradient-to-r from-primary to-green-400 hover:opacity-90 text-primary-foreground",onClick:()=>ss(s.id),children:[e.jsx(ft,{className:"w-3.5 h-3.5 mr-1"}),d?"Ù…ÙˆØ§ÙÙ‚Ø©":"Approve"]})]})]})},s.id)})})}),e.jsxs(At,{value:"templates",children:[h.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-primary to-green-400 rounded-xl",children:e.jsx("img",{src:"/logo.png",alt:"GreenoFig",className:"w-5 h-5 object-contain",onError:e=>{e.target.style.display="none"}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-foreground",children:d?"Ù‚ÙˆØ§Ù„Ø¨ GreenoFig Ø§Ù„Ù…Ù‡Ù†ÙŠØ©":"GreenoFig Professional Templates"}),e.jsx("p",{className:"text-xs text-text-secondary",children:d?"Ù†Ù…Ø§Ø°Ø¬ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ØµØ­ÙŠØ© ÙˆÙ„ÙŠØ§Ù‚Ø© Ø¨Ø¯Ù†ÙŠØ© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…":"Ready-to-use health & fitness intake forms"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:h.map(s=>{var t,a;const l=Ve(s.id),i="ar"===l;return e.jsxs("div",{className:"glass-effect rounded-xl border-2 border-primary/20 hover:border-primary/40 transition-all p-3 sm:p-4 bg-gradient-to-br from-primary/5 to-transparent",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(y,{className:"text-[9px] sm:text-[10px] px-1.5 sm:px-2 py-0.5 bg-primary/10 text-primary border border-primary/30",children:"GreenoFig"}),e.jsxs("div",{className:"flex items-center gap-0.5 bg-muted/60 rounded-lg p-0.5",children:[e.jsx("button",{onClick:()=>Ue(e=>({...e,[s.id]:"en"})),className:"px-2 py-0.5 rounded text-[10px] sm:text-xs font-medium transition-all "+("en"===l?"bg-primary text-white shadow-sm":"text-text-secondary hover:text-foreground"),children:"EN"}),e.jsx("button",{onClick:()=>Ue(e=>({...e,[s.id]:"ar"})),className:"px-2 py-0.5 rounded text-[10px] sm:text-xs font-medium transition-all "+("ar"===l?"bg-primary text-white shadow-sm":"text-text-secondary hover:text-foreground"),children:"Ø¹Ø±Ø¨ÙŠ"})]})]}),e.jsx("h3",{className:"font-semibold text-sm sm:text-base text-foreground mb-1 line-clamp-1",children:i&&s.name_ar||s.name}),e.jsx("p",{className:"text-[11px] sm:text-xs text-text-secondary line-clamp-2 mb-3",children:i&&s.description_ar||s.description}),e.jsxs("div",{className:"flex items-center gap-3 text-[10px] sm:text-xs text-text-secondary mb-3 pb-3 border-b border-border/30",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(jt,{className:"w-3 h-3 text-primary/70"}),e.jsx("span",{className:"font-medium",children:(null==(t=s.sections)?void 0:t.length)||0})," ",i?"Ø£Ù‚Ø³Ø§Ù…":"sections"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ft,{className:"w-3 h-3 text-primary/70"}),e.jsx("span",{className:"font-medium",children:(null==(a=s.sections)?void 0:a.reduce((e,s)=>{var t;return e+((null==(t=s.questions)?void 0:t.length)||0)},0))||0})," ",i?"Ø³Ø¤Ø§Ù„":"questions"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsxs(P,{variant:"outline",size:"sm",className:"flex-1 h-8 text-[10px] sm:text-xs border-primary/30 hover:bg-primary/10 px-1.5 sm:px-2",onClick:()=>{he({...s,_previewLang:l}),xe(!0)},children:[e.jsx(ls,{className:"w-3 h-3 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:d?"Ù…Ø¹Ø§ÙŠÙ†Ø©":"Preview"})]}),e.jsxs(P,{variant:"outline",size:"sm",className:"flex-1 h-8 text-[10px] sm:text-xs border-primary/30 hover:bg-primary/10 px-1.5 sm:px-2",onClick:()=>Qe({...s,_lang:l}),children:[e.jsx(as,{className:"w-3 h-3 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:d?"ØªØ­Ù…ÙŠÙ„":"PDF"})]}),e.jsxs(P,{variant:"outline",size:"sm",className:"flex-1 h-8 text-[10px] sm:text-xs border-primary/30 hover:bg-primary/10 px-1.5 sm:px-2",onClick:()=>(e=>{const s=e._lang||Ve(e.id),t=Ke(e,!0,s),a=document.createElement("iframe");a.style.position="fixed",a.style.right="0",a.style.bottom="0",a.style.width="0",a.style.height="0",a.style.border="none",document.body.appendChild(a);const l=a.contentWindow.document;l.open(),l.write(t),l.close(),a.onload=()=>{setTimeout(()=>{a.contentWindow.focus(),a.contentWindow.print(),setTimeout(()=>{document.body.removeChild(a)},1e3)},300)}})({...s,_lang:l}),children:[e.jsx(us,{className:"w-3 h-3 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:d?"Ø·Ø¨Ø§Ø¹Ø©":"Print"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsxs(P,{variant:"outline",size:"sm",className:"flex-1 h-8 text-[10px] sm:text-xs border-primary/30 hover:bg-primary/10 px-1.5 sm:px-2",onClick:()=>Je(s,l),children:[e.jsx(mt,{className:"w-3 h-3 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:d?"Ø±Ø§Ø¨Ø·":"Link"})]}),e.jsxs(P,{size:"sm",className:"flex-1 h-8 text-[10px] sm:text-xs bg-gradient-to-r from-primary to-green-400 hover:opacity-90 text-primary-foreground px-1.5 sm:px-2",onClick:()=>{Ue(e=>({...e,[s.id]:l})),Q(s),Y(!0)},children:[e.jsx(hs,{className:"w-3 h-3 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:d?"Ø¥Ø±Ø³Ø§Ù„":"Send"})]})]})]})]},s.id)})})]}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-primary to-green-400 rounded-xl",children:e.jsx("img",{src:"/logo.png",alt:"GreenoFig",className:"w-5 h-5 object-contain",onError:e=>{e.target.style.display="none"}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-foreground",children:d?"Ù‚ÙˆØ§Ù„Ø¨ÙŠ Ø§Ù„Ù…Ø®ØµØµØ©":"My Custom Templates"}),e.jsx("p",{className:"text-xs text-text-secondary",children:d?"Ù†Ù…Ø§Ø°Ø¬Ùƒ Ø§Ù„Ø®Ø§ØµØ© Ù…Ø¹ Ø¹Ù„Ø§Ù…Ø© GreenoFig":"Your forms with GreenoFig branding"})]})]}),e.jsxs(P,{onClick:()=>{Ie(null),qe({name:"",name_ar:"",description:"",description_ar:"",form_type:"custom",sections:[{title:"",title_ar:"",questions:[]}]}),Te(!0)},className:"bg-gradient-to-r from-primary to-green-400 hover:opacity-90 text-primary-foreground",children:[e.jsx(Ce,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:d?"Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯":"Create Template"}),e.jsx("span",{className:"sm:hidden",children:d?"Ø¬Ø¯ÙŠØ¯":"New"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:0===x.length?e.jsxs("div",{className:"text-center py-8 text-text-secondary col-span-full",children:[e.jsx(Ge,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{className:"text-sm",children:d?"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ÙˆØ§Ù„Ø¨ Ù…Ø®ØµØµØ© Ø¨Ø¹Ø¯":"No custom templates yet"}),e.jsx("p",{className:"text-xs mt-1",children:d?"Ø£Ù†Ø´Ø¦ Ù‚Ø§Ù„Ø¨Ùƒ Ø§Ù„Ø®Ø§Øµ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ù‚ÙˆØ§Ù„Ø¨ GreenoFig Ø§Ù„Ø¬Ø§Ù‡Ø²Ø©":"Create your own or use GreenoFig templates above"})]}):x.map(s=>{var t,a;const l=Ve(s.id),i="ar"===l;return e.jsxs("div",{className:"glass-effect rounded-xl border-2 border-border/30 hover:border-primary/40 transition-all p-3 sm:p-4 bg-gradient-to-br from-muted/30 to-transparent",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(y,{className:"text-[9px] sm:text-[10px] px-1.5 sm:px-2 py-0.5 bg-primary/10 text-primary border border-primary/30",children:"GreenoFig"}),e.jsxs("div",{className:"flex items-center gap-0.5 bg-muted/60 rounded-lg p-0.5",children:[e.jsx("button",{onClick:()=>Ue(e=>({...e,[s.id]:"en"})),className:"px-2 py-0.5 rounded text-[10px] sm:text-xs font-medium transition-all "+("en"===l?"bg-primary text-white shadow-sm":"text-text-secondary hover:text-foreground"),children:"EN"}),e.jsx("button",{onClick:()=>Ue(e=>({...e,[s.id]:"ar"})),className:"px-2 py-0.5 rounded text-[10px] sm:text-xs font-medium transition-all "+("ar"===l?"bg-primary text-white shadow-sm":"text-text-secondary hover:text-foreground"),children:"Ø¹Ø±Ø¨ÙŠ"})]})]}),e.jsx("h3",{className:"font-semibold text-sm sm:text-base text-foreground mb-1 line-clamp-1",children:i&&s.name_ar||s.name}),e.jsx("p",{className:"text-[11px] sm:text-xs text-text-secondary line-clamp-2 mb-3",children:i&&s.description_ar||s.description}),e.jsxs("div",{className:"flex items-center gap-3 text-[10px] sm:text-xs text-text-secondary mb-3 pb-3 border-b border-border/30",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(jt,{className:"w-3 h-3 text-primary/70"}),e.jsx("span",{className:"font-medium",children:(null==(t=s.sections)?void 0:t.length)||0})," ",i?"Ø£Ù‚Ø³Ø§Ù…":"sections"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ft,{className:"w-3 h-3 text-primary/70"}),e.jsx("span",{className:"font-medium",children:(null==(a=s.sections)?void 0:a.reduce((e,s)=>{var t;return e+((null==(t=s.questions)?void 0:t.length)||0)},0))||0})," ",i?"Ø³Ø¤Ø§Ù„":"questions"]}),s.is_default&&e.jsx(y,{variant:"outline",className:"text-[9px] px-1 py-0 bg-primary/10 text-primary border-primary/30",children:i?"Ø§ÙØªØ±Ø§Ø¶ÙŠ":"Default"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsxs(P,{variant:"outline",size:"sm",className:"flex-1 h-8 text-[10px] sm:text-xs border-border/50 hover:bg-muted/50 px-1.5 sm:px-2",onClick:()=>oe(s),children:[e.jsx(ls,{className:"w-3 h-3 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:d?"Ù…Ø¹Ø§ÙŠÙ†Ø©":"Preview"})]}),!s.is_default&&e.jsxs(P,{variant:"outline",size:"sm",className:"h-8 text-[10px] sm:text-xs border-border/50 hover:bg-muted/50 px-1.5 sm:px-2",onClick:()=>(e=>{Ie(e),qe({name:e.name||"",name_ar:e.name_ar||"",description:e.description||"",description_ar:e.description_ar||"",form_type:e.form_type||"custom",sections:e.sections||[{title:"",title_ar:"",questions:[]}]}),Te(!0)})(s),children:[e.jsx(vt,{className:"w-3 h-3 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:d?"ØªØ¹Ø¯ÙŠÙ„":"Edit"})]}),e.jsxs(P,{variant:"outline",size:"sm",className:"flex-1 h-8 text-[10px] sm:text-xs border-primary/30 hover:bg-primary/10 px-1.5 sm:px-2",onClick:()=>Je(s,l),children:[e.jsx(mt,{className:"w-3 h-3 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:d?"Ø±Ø§Ø¨Ø·":"Link"})]}),e.jsxs(P,{size:"sm",className:"flex-1 h-8 text-[10px] sm:text-xs bg-gradient-to-r from-primary to-green-400 hover:opacity-90 text-primary-foreground px-1.5 sm:px-2",onClick:()=>{Ue(e=>({...e,[s.id]:l})),Q(s),Y(!0)},children:[e.jsx(hs,{className:"w-3 h-3 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:d?"Ø¥Ø±Ø³Ø§Ù„":"Send"})]}),!s.is_default&&e.jsx(P,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-red-500 hover:text-red-600 hover:bg-red-50 flex-shrink-0",onClick:()=>(async e=>{if(window.confirm(d?"Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø§Ù„Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ":"Permanently delete this template?"))try{const{error:s}=await _.from("form_templates").delete().eq("id",e).eq("is_system_template",!1);s&&await _.from("form_templates").update({is_active:!1}).eq("id",e),u(s=>s.filter(s=>s.id!==e)),p(s=>s.filter(s=>s.id!==e)),F({title:d?"ØªÙ… Ø§Ù„Ø­Ø°Ù":"Template Deleted",description:d?"ØªÙ… Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ù„Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹":"Template has been permanently deleted"}),Ye()}catch(s){F({title:d?"Ø®Ø·Ø£":"Error",description:d?"ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ù„Ø¨":"Failed to delete template",variant:"destructive"})}})(s.id),children:e.jsx($e,{className:"w-3.5 h-3.5"})})]})]},s.id)})})]}),e.jsx(At,{value:"analytics",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"glass-effect rounded-xl p-4 border border-border/30",children:[e.jsxs("h3",{className:"font-semibold text-foreground mb-3 flex items-center gap-2",children:[e.jsx(st,{className:"w-4 h-4 text-primary"}),d?"Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„":"Completion Rate"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"w-24 h-24 relative",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",viewBox:"0 0 36 36",children:[e.jsx("circle",{cx:"18",cy:"18",r:"16",fill:"none",stroke:"currentColor",strokeWidth:"3",className:"text-muted"}),e.jsx("circle",{cx:"18",cy:"18",r:"16",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeDasharray:`${xs.completionRate} 100`,className:"text-primary"})]}),e.jsxs("span",{className:"absolute inset-0 flex items-center justify-center text-xl font-bold text-foreground",children:[xs.completionRate,"%"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-emerald-500"}),e.jsxs("span",{className:"text-sm text-text-secondary",children:[d?"Ù…ÙƒØªÙ…Ù„":"Completed",": ",xs.submitted+xs.approved]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-yellow-500"}),e.jsxs("span",{className:"text-sm text-text-secondary",children:[d?"Ø§Ù†ØªØ¸Ø§Ø±":"Pending",": ",xs.pending+xs.inProgress]})]})]})]})]}),e.jsxs("div",{className:"glass-effect rounded-xl p-4 border border-border/30",children:[e.jsxs("h3",{className:"font-semibold text-foreground mb-3 flex items-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4 text-primary"}),d?"Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©":"Forms by Status"]}),e.jsx("div",{className:"space-y-2",children:[{label:d?"Ø§Ù†ØªØ¸Ø§Ø±":"Pending",count:xs.pending,color:"bg-yellow-500"},{label:d?"Ù‚ÙŠØ¯ Ø§Ù„ØªÙ‚Ø¯Ù…":"In Progress",count:xs.inProgress,color:"bg-blue-500"},{label:d?"Ù…ÙØ±Ø³Ù„":"Submitted",count:xs.submitted,color:"bg-primary"},{label:d?"Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡":"Approved",count:xs.approved,color:"bg-emerald-500"}].map(s=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs text-text-secondary w-20",children:s.label}),e.jsx("div",{className:"flex-1 h-4 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${s.color} rounded-full transition-all`,style:{width:(xs.total>0?s.count/xs.total*100:0)+"%"}})}),e.jsx("span",{className:"text-sm font-medium text-foreground w-8 text-right",children:s.count})]},s.label))})]}),e.jsxs("div",{className:"glass-effect rounded-xl p-4 border border-border/30 md:col-span-2",children:[e.jsxs("h3",{className:"font-semibold text-foreground mb-3 flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4 text-primary"}),d?"Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø£ÙƒØ«Ø± Ù†Ø´Ø§Ø·Ø§Ù‹":"Most Active Clients"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:os.slice(0,4).map(s=>{var t;return e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted/30 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-muted flex items-center justify-center overflow-hidden flex-shrink-0",children:s.client.profile_picture_url?e.jsx("img",{src:s.client.profile_picture_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-xs font-medium text-text-secondary",children:(null==(t=s.client.full_name)?void 0:t.charAt(0))||"?"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-foreground truncate",children:s.client.full_name}),e.jsxs("p",{className:"text-[10px] text-text-secondary",children:[s.forms.length," ",d?"Ù†Ù…ÙˆØ°Ø¬":"forms"]})]})]},s.client.id)})})]})]})})]}),e.jsx("div",{className:"mt-8",children:e.jsxs("div",{className:"glass-effect rounded-2xl border-2 border-primary/30 bg-gradient-to-r from-primary/5 to-transparent overflow-hidden",children:[e.jsx("div",{className:"p-4 sm:p-5 cursor-pointer hover:bg-primary/5 transition-all",onClick:()=>V(e=>({...e,"external-forms":!e["external-forms"]})),children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-start sm:items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"p-2.5 sm:p-3 bg-gradient-to-br from-primary to-green-400 rounded-xl shadow-lg flex-shrink-0",children:e.jsx(mt,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("h3",{className:"text-base sm:text-xl font-bold text-foreground",children:d?"Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©":"External Form Links"}),e.jsx(y,{className:"bg-primary/10 text-primary border border-primary/30 text-[10px] sm:text-xs px-1.5 sm:px-2",children:d?"Ù„Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ø¬Ø¯Ø¯":"New Patients"})]}),e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary mt-1 line-clamp-2 sm:line-clamp-1",children:d?"Ø£Ù†Ø´Ø¦ Ø±ÙˆØ§Ø¨Ø· Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ù„Ø¬Ù…Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ø¬Ø¯Ø¯ Ù‚Ø¨Ù„ Ø§Ù„Ù…ÙˆØ¹Ø¯":"Create shareable intake forms for new patients before their first appointment"})]})]}),e.jsxs("div",{className:"flex items-center justify-between sm:justify-end gap-2 sm:gap-3 ml-0 sm:ml-auto pl-10 sm:pl-0",children:[e.jsxs(P,{size:"sm",className:"flex-1 sm:flex-initial h-9 sm:h-8 bg-gradient-to-r from-primary to-green-400 hover:opacity-90 text-primary-foreground shadow-md text-xs sm:text-sm",onClick:e=>{e.stopPropagation(),V(e=>({...e,"external-forms":!0}))},children:[e.jsx(Ts,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1 sm:mr-1.5"}),d?"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±ÙˆØ§Ø¨Ø·":"Manage Links"]}),e.jsx("div",{className:"p-1.5 sm:p-2 rounded-lg transition-colors flex-shrink-0 "+(U["external-forms"]?"bg-primary/10":"bg-muted/50"),children:U["external-forms"]?e.jsx(xt,{className:"w-4 h-4 sm:w-5 sm:h-5 text-primary"}):e.jsx(fe,{className:"w-4 h-4 sm:w-5 sm:h-5 text-text-secondary"})})]})]})}),U["external-forms"]&&e.jsx("div",{className:"border-t border-primary/20 p-4 sm:p-5 bg-card/30",children:e.jsx(nl,{})})]})}),e.jsx(S,{open:H,onOpenChange:e=>!e&&Xe(),children:e.jsxs(M,{className:"max-w-sm sm:max-w-md",children:[e.jsxs(A,{className:"pb-2",children:[e.jsxs($,{className:"flex items-center gap-2 text-base",children:[e.jsx(hs,{className:"w-4 h-4 text-primary"}),ie?d?"Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ù†Ù…ÙˆØ°Ø¬":"Resend Form":d?"Ø¥Ø±Ø³Ø§Ù„ Ù†Ù…ÙˆØ°Ø¬":"Send Form"]}),K&&e.jsx(L,{className:"text-xs",children:d&&K.name_ar||K.name})]}),e.jsxs("div",{className:"space-y-3 py-2",children:[!K&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-foreground mb-1",children:d?"Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø§Ù„Ø¨":"Select Template"}),e.jsxs("select",{className:"w-full p-2 border border-primary/30 rounded-lg bg-primary/5 text-foreground text-sm focus:ring-2 focus:ring-primary/20",onChange:e=>Q(x.find(s=>s.id===e.target.value)),children:[e.jsx("option",{value:"",children:d?"Ø§Ø®ØªØ±...":"Select..."}),x.map(s=>e.jsx("option",{value:s.id,children:d&&s.name_ar||s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-foreground mb-1",children:d?"ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)":"Due Date (Optional)"}),e.jsx(E,{type:"date",value:ae,onChange:e=>le(e.target.value),min:(new Date).toISOString().split("T")[0],className:"bg-card/50 border-border/30 h-9 text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-foreground mb-1",children:[d?"Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡":"Select Clients"," (",J.length,")"]}),e.jsx("div",{className:"border border-border/30 rounded-lg max-h-40 overflow-auto",children:N.map(s=>{var t;return e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-muted/50 cursor-pointer border-b border-border/20 last:border-b-0 "+(J.includes(s.id)?"bg-primary/5":""),children:[e.jsx("input",{type:"checkbox",checked:J.includes(s.id),onChange:e=>{e.target.checked?Z([...J,s.id]):Z(J.filter(e=>e!==s.id))},className:"w-3.5 h-3.5 accent-primary"}),e.jsx("div",{className:"w-6 h-6 rounded-full bg-muted flex items-center justify-center overflow-hidden flex-shrink-0",children:s.profile_picture_url?e.jsx("img",{src:s.profile_picture_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-xs font-medium text-text-secondary",children:(null==(t=s.full_name)?void 0:t.charAt(0))||"?"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm text-foreground truncate block",children:s.full_name}),e.jsx("span",{className:"text-[10px] text-text-secondary truncate block",children:s.email})]})]},s.id)})}),e.jsx(P,{variant:"ghost",size:"sm",className:"mt-1 h-7 text-xs px-2",onClick:()=>{J.length===N.length?Z([]):Z(N.map(e=>e.id))},children:J.length===N.length?d?"Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒÙ„":"Deselect All":d?"ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„":"Select All"})]})]}),e.jsxs(T,{className:"pt-2 gap-2",children:[e.jsx(P,{variant:"outline",size:"sm",className:"h-9",onClick:Xe,children:d?"Ø¥Ù„ØºØ§Ø¡":"Cancel"}),e.jsxs(P,{size:"sm",className:"h-9 bg-gradient-to-r from-primary to-green-400 hover:opacity-90 text-primary-foreground",onClick:async()=>{if(K&&0!==J.length){se(!0);try{const s=Ve(K.id),t="ar"===s,a=J.map(e=>({form_template_id:K.id,client_id:e,nutritionist_id:r.id,is_required:!0,due_date:ae||null,status:"pending",form_language:s})),{error:l}=await _.from("form_assignments").insert(a);if(l)throw l;for(const i of J){await _.from("notifications").insert({user_id:i,type:"form_assigned",title:t?"Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø¯ÙŠØ¯":"New Form Assigned",message:t?`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø¯ÙŠØ¯ Ù„Ùƒ: ${K.name_ar||K.name}`:`You have a new form to complete: ${K.name}`,is_read:!1});try{await n(i,t?"Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø¯ÙŠØ¯":"New Form Assigned",t?`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø¯ÙŠØ¯ Ù„Ùƒ: ${K.name_ar||K.name}`:`You have a new form to complete: ${K.name}`,{tag:"form-assigned",data:{type:"form_assigned",url:"/app/forms"}})}catch(e){}}F({title:d?"ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­":"Form Sent Successfully",description:d?`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¥Ù„Ù‰ ${J.length} Ø¹Ù…ÙŠÙ„ (${"ar"===s?"Ø¹Ø±Ø¨ÙŠ":"Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ"})`:`Form sent to ${J.length} client(s) (${"ar"===s?"Arabic":"English"})`}),Xe(),Ye()}catch(s){F({title:d?"Ø®Ø·Ø£":"Error",description:d?"ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬":"Failed to send form",variant:"destructive"})}finally{se(!1)}}},disabled:!K||0===J.length||X,children:[X?e.jsx(Se,{className:"w-3.5 h-3.5 animate-spin mr-1"}):e.jsx(hs,{className:"w-3.5 h-3.5 mr-1"}),d?"Ø¥Ø±Ø³Ø§Ù„":"Send"]})]})]})}),e.jsx(S,{open:Re,onOpenChange:e=>{e||(Te(!1),Ie(null))},children:e.jsxs(M,{className:"max-w-2xl max-h-[85vh] overflow-y-auto",children:[e.jsx(A,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4 text-primary"}),ze?d?"ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø§Ù„Ø¨":"Edit Template":d?"Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯":"Create New Template"]})}),e.jsxs("div",{className:"space-y-4 py-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-foreground mb-1",children:[d?"Ø§Ø³Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)":"Form Name (English)"," *"]}),e.jsx(E,{value:Le.name,onChange:e=>qe(s=>({...s,name:e.target.value})),placeholder:"e.g., Health Assessment",className:"bg-card/50 border-border/30"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-foreground mb-1",children:d?"Ø§Ø³Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ (Ø¹Ø±Ø¨ÙŠ)":"Form Name (Arabic)"}),e.jsx(E,{value:Le.name_ar,onChange:e=>qe(s=>({...s,name_ar:e.target.value})),placeholder:"Ù…Ø«Ø§Ù„: ØªÙ‚ÙŠÙŠÙ… ØµØ­ÙŠ",className:"bg-card/50 border-border/30",dir:"rtl"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-foreground mb-1",children:d?"Ø§Ù„ÙˆØµÙ (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)":"Description (English)"}),e.jsx(R,{value:Le.description,onChange:e=>qe(s=>({...s,description:e.target.value})),placeholder:"Brief description...",className:"bg-card/50 border-border/30 min-h-[60px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-foreground mb-1",children:d?"Ø§Ù„ÙˆØµÙ (Ø¹Ø±Ø¨ÙŠ)":"Description (Arabic)"}),e.jsx(R,{value:Le.description_ar,onChange:e=>qe(s=>({...s,description_ar:e.target.value})),placeholder:"ÙˆØµÙ Ù…Ø®ØªØµØ±...",className:"bg-card/50 border-border/30 min-h-[60px]",dir:"rtl"})]})]}),e.jsxs("div",{className:"border-t border-border/30 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-medium text-foreground",children:d?"Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ÙˆØ§Ù„Ø£Ø³Ø¦Ù„Ø©":"Sections & Questions"}),e.jsxs(P,{size:"sm",variant:"outline",onClick:()=>{qe(e=>({...e,sections:[...e.sections,{title:"",title_ar:"",questions:[]}]}))},children:[e.jsx(Ce,{className:"w-3 h-3 mr-1"}),d?"Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù…":"Add Section"]})]}),e.jsx("div",{className:"space-y-4",children:Le.sections.map((s,t)=>e.jsxs("div",{className:"glass-effect rounded-lg p-3 border border-border/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(bt,{className:"w-4 h-4 text-text-secondary cursor-move"}),e.jsx(E,{value:s.title,onChange:e=>ts(t,"title",e.target.value),placeholder:d?"Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‚Ø³Ù… (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)":"Section Title (English)",className:"flex-1 h-8 text-sm bg-card/50 border-border/30"}),e.jsx(E,{value:s.title_ar||"",onChange:e=>ts(t,"title_ar",e.target.value),placeholder:d?"Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‚Ø³Ù… (Ø¹Ø±Ø¨ÙŠ)":"Section Title (Arabic)",className:"flex-1 h-8 text-sm bg-card/50 border-border/30",dir:"rtl"}),Le.sections.length>1&&e.jsx(P,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-red-500",onClick:()=>{return e=t,void qe(s=>({...s,sections:s.sections.filter((s,t)=>t!==e)}));var e},children:e.jsx($e,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"space-y-2 ml-6",children:[(s.questions||[]).map((s,a)=>e.jsxs("div",{className:"flex items-start gap-2 p-2 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{value:s.label,onChange:e=>rs(t,a,"label",e.target.value),placeholder:d?"Ø§Ù„Ø³Ø¤Ø§Ù„ (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)":"Question (English)",className:"flex-1 h-7 text-xs bg-card/50 border-border/30"}),e.jsx(E,{value:s.label_ar||"",onChange:e=>rs(t,a,"label_ar",e.target.value),placeholder:d?"Ø§Ù„Ø³Ø¤Ø§Ù„ (Ø¹Ø±Ø¨ÙŠ)":"Question (Arabic)",className:"flex-1 h-7 text-xs bg-card/50 border-border/30",dir:"rtl"})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("select",{value:s.type,onChange:e=>rs(t,a,"type",e.target.value),className:"h-7 text-xs px-2 border border-border/30 rounded bg-card/50 text-foreground",children:dl.map(s=>e.jsx("option",{value:s.value,children:d?s.label_ar:s.label},s.value))}),e.jsxs("label",{className:"flex items-center gap-1 text-xs text-text-secondary",children:[e.jsx("input",{type:"checkbox",checked:s.required,onChange:e=>rs(t,a,"required",e.target.checked),className:"w-3 h-3 accent-primary"}),d?"Ù…Ø·Ù„ÙˆØ¨":"Required"]}),["select","multiselect"].includes(s.type)&&e.jsx(E,{value:(s.options||[]).join(", "),onChange:e=>rs(t,a,"options",e.target.value.split(",").map(e=>e.trim())),placeholder:d?"Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª (Ù…ÙØµÙˆÙ„Ø© Ø¨ÙØ§ØµÙ„Ø©)":"Options (comma separated)",className:"flex-1 h-7 text-xs bg-card/50 border-border/30"})]})]}),e.jsx(P,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-red-500",onClick:()=>{return e=t,s=a,void qe(t=>{const a=[...t.sections];return a[e].questions=a[e].questions.filter((e,t)=>t!==s),{...t,sections:a}});var e,s},children:e.jsx($e,{className:"w-3 h-3"})})]},a)),e.jsxs(P,{size:"sm",variant:"ghost",className:"h-7 text-xs",onClick:()=>{return e=t,void qe(s=>{const t=[...s.sections];return t[e].questions=[...t[e].questions||[],{id:`q_${Date.now()}`,label:"",label_ar:"",type:"text",required:!1,options:[]}],{...s,sections:t}});var e},children:[e.jsx(Ce,{className:"w-3 h-3 mr-1"}),d?"Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„":"Add Question"]})]})]},t))})]})]}),e.jsxs(T,{children:[e.jsx(P,{variant:"outline",onClick:()=>{Te(!1),Ie(null)},children:d?"Ø¥Ù„ØºØ§Ø¡":"Cancel"}),e.jsxs(P,{onClick:async()=>{if(Le.name){Be(!0);try{const e={name:Le.name,name_ar:Le.name_ar||null,description:Le.description||null,description_ar:Le.description_ar||null,form_type:Le.form_type,sections:Le.sections,is_default:!1,is_active:!0,created_by:r.id};ze?(await _.from("form_templates").update({...e,updated_at:(new Date).toISOString()}).eq("id",ze.id),F({title:d?"ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«":"Template Updated",description:d?"ØªÙ… ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ù„Ø¨ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ù†Ø¬Ø§Ø­":"Form template has been updated"})):(await _.from("form_templates").insert(e),F({title:d?"ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡":"Template Created",description:d?"ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ù„Ø¨ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ù†Ø¬Ø§Ø­":"Form template has been created"})),Te(!1),Ie(null),Ye()}catch(e){F({title:d?"Ø®Ø·Ø£":"Error",description:d?"ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ù‚Ø§Ù„Ø¨":"Failed to save template",variant:"destructive"})}finally{Be(!1)}}else F({title:d?"Ø®Ø·Ø£":"Error",description:d?"ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬":"Please enter form name",variant:"destructive"})},disabled:Oe,className:"bg-gradient-to-r from-primary to-green-400 hover:opacity-90 text-primary-foreground",children:[Oe?e.jsx(Se,{className:"w-4 h-4 animate-spin mr-1"}):e.jsx(He,{className:"w-4 h-4 mr-1"}),ze?d?"ØªØ­Ø¯ÙŠØ«":"Update":d?"Ø­ÙØ¸":"Save"]})]})]})}),e.jsx(S,{open:!!pe,onOpenChange:e=>!e&&ge(null),children:e.jsxs(M,{className:"max-w-xs",children:[e.jsx(A,{children:e.jsxs($,{className:"flex items-center gap-2 text-base",children:[e.jsx(is,{className:"w-4 h-4 text-primary"}),d?"ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¹Ø¯":"Adjust Due Date"]})}),e.jsx("div",{className:"py-3",children:e.jsx(E,{type:"date",value:je,onChange:e=>ve(e.target.value),min:(new Date).toISOString().split("T")[0],className:"bg-card/50 border-border/30"})}),e.jsxs(T,{children:[e.jsx(P,{variant:"outline",size:"sm",onClick:()=>ge(null),children:d?"Ø¥Ù„ØºØ§Ø¡":"Cancel"}),e.jsx(P,{size:"sm",onClick:async()=>{var e,s,t;if(pe&&je)try{await _.from("form_assignments").update({due_date:je,updated_at:(new Date).toISOString()}).eq("id",pe.id),await _.from("notifications").insert({user_id:pe.client_id,type:"form_assigned",title:d?"ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬":"Form Due Date Updated",message:d?`ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ¹Ø¯ Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬: ${(null==(e=pe.form_template)?void 0:e.name_ar)||(null==(s=pe.form_template)?void 0:s.name)}`:`Due date updated for: ${null==(t=pe.form_template)?void 0:t.name}`,is_read:!1}),F({title:d?"ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«":"Due Date Updated",description:d?"ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ø¨Ù†Ø¬Ø§Ø­":"Due date has been updated"}),ge(null),ve(""),Ye()}catch(a){}},className:"bg-gradient-to-r from-primary to-green-400 hover:opacity-90 text-primary-foreground",children:d?"Ø­ÙØ¸":"Save"})]})]})}),e.jsx(S,{open:!!be,onOpenChange:e=>!e&&Ne(null),children:e.jsxs(M,{className:"max-w-sm",children:[e.jsx(A,{children:e.jsxs($,{className:"flex items-center gap-2 text-base",children:[e.jsx(_e,{className:"w-4 h-4 text-primary"}),d?"Ø¥Ø±Ø³Ø§Ù„ ØªØ°ÙƒÙŠØ±":"Send Reminder"]})}),e.jsx("div",{className:"py-3",children:e.jsx(R,{value:ye,onChange:e=>we(e.target.value),placeholder:d?"Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ°ÙƒÙŠØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)...":"Reminder message (optional)...",className:"bg-card/50 border-border/30 min-h-[80px]"})}),e.jsxs(T,{children:[e.jsx(P,{variant:"outline",size:"sm",onClick:()=>Ne(null),children:d?"Ø¥Ù„ØºØ§Ø¡":"Cancel"}),e.jsxs(P,{size:"sm",onClick:async()=>{var e,s,t;if(be)try{const l=ye.trim()||(d?`ØªØ°ÙƒÙŠØ±: ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ "${(null==(e=be.form_template)?void 0:e.name_ar)||(null==(s=be.form_template)?void 0:s.name)}"`:`Reminder: Please complete the form "${null==(t=be.form_template)?void 0:t.name}"`);await _.from("notifications").insert({user_id:be.client_id,type:"form_reminder",title:d?"ØªØ°ÙƒÙŠØ± Ø¨Ø§Ù„Ù†Ù…ÙˆØ°Ø¬":"Form Reminder",message:l,is_read:!1});try{await n(be.client_id,d?"ØªØ°ÙƒÙŠØ± Ø¨Ø§Ù„Ù†Ù…ÙˆØ°Ø¬":"Form Reminder",l,{tag:"form-reminder",data:{type:"form_reminder",url:"/app/forms"}})}catch(a){}F({title:d?"ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„":"Reminder Sent",description:d?"ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ°ÙƒÙŠØ± Ø¨Ù†Ø¬Ø§Ø­":"Reminder has been sent"}),Ne(null),we("")}catch(l){}},className:"bg-gradient-to-r from-primary to-green-400 hover:opacity-90 text-primary-foreground",children:[e.jsx(hs,{className:"w-3.5 h-3.5 mr-1"}),d?"Ø¥Ø±Ø³Ø§Ù„":"Send"]})]})]})}),e.jsx(S,{open:!!de,onOpenChange:e=>!e&&oe(null),children:e.jsxs(M,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(A,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ls,{className:"w-4 h-4 text-primary"}),d?"Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬":"Form Preview"]}),e.jsx(L,{children:de&&(d&&de.name_ar||de.name)})]}),de&&e.jsx("div",{className:"space-y-4 py-3",children:null==(a=de.sections)?void 0:a.map((s,t)=>{var a;return e.jsxs("div",{className:"glass-effect rounded-lg p-3 border border-border/30",children:[e.jsx("h4",{className:"font-medium text-foreground mb-2",children:d&&s.title_ar||s.title}),e.jsx("div",{className:"space-y-2",children:null==(a=s.questions)?void 0:a.map((s,t)=>e.jsxs("div",{className:"text-sm text-text-secondary",children:["â€¢ ",d&&s.label_ar||s.label,s.required&&e.jsx("span",{className:"text-red-500",children:"*"}),e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["(",s.type,")"]})]},t))})]},t)})}),e.jsxs(T,{children:[e.jsx(P,{variant:"outline",onClick:()=>oe(null),children:d?"Ø¥ØºÙ„Ø§Ù‚":"Close"}),e.jsxs(P,{onClick:()=>{Q(de),oe(null),Y(!0)},className:"bg-gradient-to-r from-primary to-green-400 hover:opacity-90 text-primary-foreground",children:[e.jsx(hs,{className:"w-3.5 h-3.5 mr-1"}),d?"Ø¥Ø±Ø³Ø§Ù„ Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬":"Send This Form"]})]})]})}),e.jsx(S,{open:me,onOpenChange:e=>{e||(xe(!1),he(null))},children:e.jsxs(M,{className:"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs(A,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-5 h-5 text-primary"}),d?"Ù…Ø¹Ø§ÙŠÙ†Ø© PDF":"PDF Preview"]}),e.jsx(L,{children:ue&&(d&&ue.name_ar||ue.name)})]}),ue&&e.jsx("div",{className:"flex-1 overflow-auto border rounded-lg bg-gray-100",children:e.jsx("iframe",{srcDoc:Ke(ue,!1,ue._previewLang||Ve(ue.id)),className:"w-full h-full min-h-[500px]",title:"PDF Preview",style:{border:"none"}})}),e.jsxs(T,{className:"flex-shrink-0 gap-2 sm:gap-2",children:[e.jsx(P,{variant:"outline",onClick:()=>{xe(!1),he(null)},children:d?"Ø¥ØºÙ„Ø§Ù‚":"Close"}),e.jsxs(P,{variant:"outline",onClick:()=>Qe(ue),children:[e.jsx(us,{className:"w-4 h-4 mr-2"}),d?"Ø·Ø¨Ø§Ø¹Ø©":"Print"]}),e.jsxs(P,{onClick:()=>{Q(ue),xe(!1),he(null),Y(!0)},className:"bg-gradient-to-r from-primary to-green-400 hover:opacity-90 text-primary-foreground",children:[e.jsx(hs,{className:"w-4 h-4 mr-2"}),d?"Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¹Ù…ÙŠÙ„":"Send to Client"]})]})]})}),e.jsx(S,{open:!!ke,onOpenChange:e=>!e&&De(null),children:e.jsxs(M,{className:"max-w-md max-h-[70vh] overflow-y-auto",children:[e.jsxs(A,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Nt,{className:"w-4 h-4 text-primary"}),d?"Ø³Ø¬Ù„ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬":"Form History"]}),e.jsx(L,{children:null==ke?void 0:ke.full_name})]}),e.jsx("div",{className:"space-y-2 py-3",children:0===Me.length?e.jsx("p",{className:"text-center text-text-secondary text-sm py-4",children:d?"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„":"No history found"}):Me.map(s=>{var t,a,l,i;const r=cl[s.status],n=r.icon;return e.jsx("div",{className:"glass-effect rounded-lg p-2.5 border border-border/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:d?(null==(t=s.form_template)?void 0:t.name_ar)||(null==(a=s.form_template)?void 0:a.name):null==(l=s.form_template)?void 0:l.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs(y,{className:`${r.color} border text-[9px] px-1 py-0`,children:[e.jsx(n,{className:"w-2 h-2 mr-0.5"}),d?r.label_ar:r.label]}),e.jsx("span",{className:"text-[10px] text-text-secondary",children:new Date(s.created_at).toLocaleDateString(c)})]})]}),(null==(i=s.responses)?void 0:i.length)>0&&e.jsx(P,{variant:"ghost",size:"sm",className:"h-6",onClick:()=>{De(null),ce(s)},children:e.jsx(ls,{className:"w-3 h-3"})})]})},s.id)})})]})})]})}const ml=({user:s})=>{const t=N(),[a,l]=g.useState("dashboard");g.useEffect(()=>{const e=t.pathname.split("/"),s=e[e.length-1];l("nutritionist"===s||""===s?"dashboard":s)},[t.pathname]);return e.jsx(W,{children:e.jsx(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:(()=>{switch(a){case"dashboard":default:return e.jsx(Xt,{user:s});case"clients":return e.jsx(Oa,{});case"onboarding":return e.jsx(Ba,{});case"goals":return e.jsx(Ga,{});case"meals":return e.jsx(Ha,{});case"schedule":return e.jsx(Qa,{});case"messages":return e.jsx(Ja,{});case"analytics":return e.jsx(Za,{});case"success":return e.jsx(el,{});case"reports":return e.jsx(sl,{});case"payments":return e.jsx(il,{});case"resources":return e.jsx(tl,{});case"blog":return e.jsx(U,{user:s});case"forms":return e.jsx(ol,{});case"settings":return e.jsx(al,{})}})()},a)})},xl=()=>{var s;const{userProfile:t}=w(),{t:a,i18n:l}=k(),i="ar"===l.language,r={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}},n=(null==(s=null==t?void 0:t.full_name)?void 0:s.split(" ")[0])||a("common.nutritionist","Nutritionist");return e.jsxs(e.Fragment,{children:[e.jsxs(G,{children:[e.jsxs("title",{children:[a("nutritionistDashboard.title","Nutritionist Dashboard")," - GreenoFig"]}),e.jsx("meta",{name:"description",content:a("nutritionistDashboard.subtitle","Manage your nutrition practice and clients")})]}),e.jsxs(se.div,{variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"visible",className:"space-y-8 "+(i?"text-right":"text-left"),dir:i?"rtl":"ltr",children:[e.jsxs(se.div,{variants:r,children:[e.jsx("h1",{className:"text-4xl font-bold",children:i?e.jsx(e.Fragment,{children:e.jsx("span",{className:"gradient-text",children:a("nutritionistDashboard.portal","Ø¨ÙˆØ§Ø¨Ø© Ø£Ø®ØµØ§Ø¦ÙŠ Ø§Ù„ØªØºØ°ÙŠØ©")})}):e.jsxs(e.Fragment,{children:["Nutritionist ",e.jsx("span",{className:"gradient-text",children:"Portal"})]})}),e.jsx("p",{className:"text-text-secondary mt-2",children:i?`Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${n}. Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù…Ù„Ø§Ø¦Ùƒ ÙˆÙ…Ù…Ø§Ø±Ø³ØªÙƒ Ù…Ù† Ù‡Ù†Ø§.`:`Welcome, ${n}. Manage your clients and practice from here.`})]}),e.jsx(se.div,{variants:r,children:e.jsx(ml,{user:t})})]})]})};export{xl as default};
