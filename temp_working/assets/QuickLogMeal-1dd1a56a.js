import{j as e}from"./vendor-ui-1f4695e3.js";import{r as a}from"./vendor-react-c35372bd.js";import{a as s,u as t,D as l,j as i,B as r,b as c,d as o,e as n,L as m,I as d,T as g,s as p,t as u}from"./index-6b8dec48.js";import{S as x,a as _,b as h,c as j,d as f}from"./select-2a07d39b.js";import{k as v}from"./vendor-utils-a892ab91.js";const b=({onSuccess:b})=>{const{userProfile:y}=s(),{t:k}=t(),[N,q]=a.useState(!1),[L,w]=a.useState(!1),[F,S]=a.useState({meal_type:"breakfast",meal_name:"",description:"",calories:"",protein_g:"",carbs_g:"",fats_g:"",date:(new Date).toISOString().split("T")[0]});return e.jsxs(l,{open:N,onOpenChange:q,children:[e.jsx(i,{asChild:!0,children:e.jsxs(r,{className:"w-full h-9 text-[10px] sm:text-xs",children:[e.jsx(v,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"truncate",children:k("quickLog.logMeal")})]})}),e.jsxs(c,{className:"glass-effect custom-scrollbar sm:max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsx(o,{children:e.jsx(n,{children:k("quickLog.logYourMeal")})}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),w(!0);try{const e={user_id:y.id,meal_type:F.meal_type,meal_name:F.meal_name,description:F.description,calories:F.calories?parseInt(F.calories):null,protein_g:F.protein_g?parseFloat(F.protein_g):null,carbs_g:F.carbs_g?parseFloat(F.carbs_g):null,fats_g:F.fats_g?parseFloat(F.fats_g):null,date:F.date},{error:a}=await p.from("meal_logs").insert(e);if(a)throw a;if(F.calories){const{data:e}=await p.from("daily_metrics").select("*").eq("user_id",y.id).eq("date",F.date).single(),a=((null==e?void 0:e.calories_consumed)||0)+parseInt(F.calories),s=((null==e?void 0:e.protein_g)||0)+(F.protein_g?parseFloat(F.protein_g):0),t=((null==e?void 0:e.carbs_g)||0)+(F.carbs_g?parseFloat(F.carbs_g):0),l=((null==e?void 0:e.fats_g)||0)+(F.fats_g?parseFloat(F.fats_g):0);e?await p.from("daily_metrics").update({calories_consumed:a,protein_g:s,carbs_g:t,fats_g:l}).eq("id",e.id):await p.from("daily_metrics").insert({user_id:y.id,date:F.date,calories_consumed:a,protein_g:s,carbs_g:t,fats_g:l})}await p.from("activity_feed").insert({user_id:y.id,activity_type:"logged_meal",activity_title:`Logged ${F.meal_type}`,activity_description:F.meal_name,metadata:{calories:F.calories?parseInt(F.calories):0}}),await p.rpc("update_user_streak",{p_user_id:y.id,p_streak_type:"meal_log",p_activity_date:F.date}),u({title:k("quickLog.mealLogged"),description:`${k("quickLog.successfullyLogged")} ${F.meal_name||F.meal_type}`}),S({meal_type:"breakfast",meal_name:"",description:"",calories:"",protein_g:"",carbs_g:"",fats_g:"",date:(new Date).toISOString().split("T")[0]}),q(!1),b&&b()}catch(a){u({title:k("common.error"),description:k("quickLog.errorLoggingMeal"),variant:"destructive"})}finally{w(!1)}},className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx(m,{htmlFor:"date",className:"text-sm sm:text-base",children:k("quickLog.date")}),e.jsx(d,{id:"date",type:"date",value:F.date,onChange:e=>S({...F,date:e.target.value}),max:(new Date).toISOString().split("T")[0],required:!0,className:"mt-1.5 w-full min-w-0"})]}),e.jsxs("div",{children:[e.jsxs(m,{htmlFor:"meal_type",className:"text-sm sm:text-base",children:[k("quickLog.mealType")," *"]}),e.jsxs(x,{value:F.meal_type,onValueChange:e=>S({...F,meal_type:e}),children:[e.jsx(_,{className:"h-12 mt-1.5 text-base",children:e.jsx(h,{})}),e.jsxs(j,{children:[e.jsx(f,{value:"breakfast",children:k("quickLog.breakfast")}),e.jsx(f,{value:"lunch",children:k("quickLog.lunch")}),e.jsx(f,{value:"dinner",children:k("quickLog.dinner")}),e.jsx(f,{value:"snack",children:k("quickLog.snack")})]})]})]}),e.jsxs("div",{children:[e.jsxs(m,{htmlFor:"meal_name",className:"text-sm sm:text-base",children:[k("quickLog.mealName")," *"]}),e.jsx(d,{id:"meal_name",placeholder:k("quickLog.mealNamePlaceholder"),value:F.meal_name,onChange:e=>S({...F,meal_name:e.target.value}),required:!0,className:"mt-1.5"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"description",className:"text-sm sm:text-base",children:k("quickLog.descriptionOptional")}),e.jsx(g,{id:"description",placeholder:k("quickLog.descriptionPlaceholder"),value:F.description,onChange:e=>S({...F,description:e.target.value}),rows:2,className:"mt-1.5 min-h-[44px] text-base"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"calories",className:"text-sm sm:text-base",children:k("quickLog.calories")}),e.jsx(d,{id:"calories",type:"number",placeholder:"500",value:F.calories,onChange:e=>S({...F,calories:e.target.value}),className:"mt-1.5"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"protein",className:"text-sm sm:text-base",children:k("quickLog.proteinG")}),e.jsx(d,{id:"protein",type:"number",step:"0.1",placeholder:"25",value:F.protein_g,onChange:e=>S({...F,protein_g:e.target.value}),className:"mt-1.5"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"carbs",className:"text-sm sm:text-base",children:k("quickLog.carbsG")}),e.jsx(d,{id:"carbs",type:"number",step:"0.1",placeholder:"50",value:F.carbs_g,onChange:e=>S({...F,carbs_g:e.target.value}),className:"mt-1.5"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"fats",className:"text-sm sm:text-base",children:k("quickLog.fatsG")}),e.jsx(d,{id:"fats",type:"number",step:"0.1",placeholder:"15",value:F.fats_g,onChange:e=>S({...F,fats_g:e.target.value}),className:"mt-1.5"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>q(!1),className:"flex-1 h-12 min-h-[44px] text-sm sm:text-base",children:k("quickLog.cancel")}),e.jsx(r,{type:"submit",disabled:L,className:"flex-1 h-12 min-h-[44px] text-sm sm:text-base",children:k(L?"quickLog.logging":"quickLog.logMeal")})]})]})]})]})};export{b as Q};
