import{j as e}from"./vendor-ui-1f4695e3.js";import{u as s,r as a}from"./vendor-react-c35372bd.js";import{u as t,a as l,s as n,g as r,B as i,t as c}from"./index-6b8dec48.js";import{C as o,a as d,b as m,c as x}from"./card-337a2a4f.js";import{T as p,a as u,b as h,c as f}from"./tabs-fb6868c7.js";import{L as j,C as b,c_ as g,c$ as N,d0 as w,m as _,U as v,a8 as y,V as C,aN as k,a6 as S,au as D,aQ as A,u as $,bT as L,g as U}from"./vendor-utils-a892ab91.js";const P={scheduled:{label:"Scheduled",label_ar:"مجدول",color:"bg-blue-500/10 text-blue-600 border-blue-500/30",icon:b},confirmed:{label:"Confirmed",label_ar:"مؤكد",color:"bg-green-500/10 text-green-600 border-green-500/30",icon:S},completed:{label:"Completed",label_ar:"مكتمل",color:"bg-emerald-500/10 text-emerald-600 border-emerald-500/30",icon:S},cancelled:{label:"Cancelled",label_ar:"ملغي",color:"bg-red-500/10 text-red-600 border-red-500/30",icon:k},no_show:{label:"No Show",label_ar:"لم يحضر",color:"bg-orange-500/10 text-orange-600 border-orange-500/30",icon:D},rescheduled:{label:"Rescheduled",label_ar:"أعيد جدولته",color:"bg-purple-500/10 text-purple-600 border-purple-500/30",icon:A}},M={video_call:{label:"Video Call",label_ar:"مكالمة فيديو",icon:C,color:"text-blue-500"},phone_call:{label:"Phone Call",label_ar:"مكالمة هاتفية",icon:$,color:"text-green-500"},in_person:{label:"In Person",label_ar:"حضوري",icon:L,color:"text-purple-500"},chat:{label:"Chat",label_ar:"محادثة",icon:U,color:"text-orange-500"}};function T(){const{t:S,i18n:D}=t(),{userProfile:A}=l(),$=s(),L="ar"===D.language,[U,T]=a.useState([]),[V,q]=a.useState(!0),[z,E]=a.useState("upcoming");a.useEffect(()=>{(null==A?void 0:A.id)&&B()},[null==A?void 0:A.id]);const B=async()=>{try{q(!0);const{data:e,error:s}=await n.from("appointments").select("\n          *,\n          nutritionist:user_profiles!appointments_nutritionist_id_fkey(id, full_name, profile_picture_url, email)\n        ").eq("client_id",A.id).order("appointment_date",{ascending:!0});if(s)throw s;T(e||[])}catch(e){}finally{q(!1)}},F=new Date,I=U.filter(e=>new Date(e.appointment_date)>=F&&!["cancelled","completed","no_show"].includes(e.status)),J=U.filter(e=>new Date(e.appointment_date)<F||["completed","no_show"].includes(e.status)),Q=U.filter(e=>"cancelled"===e.status),R=e=>new Date(e).toLocaleTimeString(L?"ar-SA":"en-US",{hour:"2-digit",minute:"2-digit"}),Y=({appointment:s})=>{var a,t;const l=P[s.status]||P.scheduled,o=M[s.type]||M.video_call,d=l.icon,m=o.icon,x=(e=>{const s=new Date(e)-F;return s>0&&s<18e5})(s.appointment_date)||new Date(s.appointment_date)<=F&&"completed"!==s.status,p=["scheduled","confirmed"].includes(s.status)&&new Date(s.appointment_date)>F;return e.jsx(_.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"glass-effect rounded-xl p-3 sm:p-4 border border-border/30 hover:border-primary/30 transition-all",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-muted flex items-center justify-center overflow-hidden flex-shrink-0",children:(null==(a=s.nutritionist)?void 0:a.profile_picture_url)?e.jsx("img",{src:s.nutritionist.profile_picture_url,alt:"",className:"w-full h-full object-cover"}):e.jsx(v,{className:"w-5 h-5 sm:w-6 sm:h-6 text-text-secondary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-foreground text-sm sm:text-base truncate",children:s.title||(L?"استشارة":"Consultation")}),e.jsxs("p",{className:"text-xs sm:text-sm text-text-secondary",children:[L?"مع":"with"," ",(null==(t=s.nutritionist)?void 0:t.full_name)||(L?"أخصائي التغذية":"Nutritionist")]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 mt-2",children:[e.jsxs(r,{variant:"outline",className:`${o.color} border-current/30 text-xs px-1.5 py-0.5`,children:[e.jsx(m,{className:"w-3 h-3 mr-0.5"}),e.jsx("span",{className:"hidden xs:inline",children:L?o.label_ar:o.label})]}),e.jsxs(r,{className:`${l.color} border text-xs px-1.5 py-0.5`,children:[e.jsx(d,{className:"w-3 h-3 mr-0.5"}),e.jsx("span",{className:"hidden xs:inline",children:L?l.label_ar:l.label})]})]})]})]}),e.jsxs("div",{className:"flex flex-col xs:flex-row xs:flex-wrap items-start xs:items-center gap-1 xs:gap-3 text-xs sm:text-sm bg-muted/30 rounded-lg p-2",children:[e.jsxs("span",{className:"flex items-center gap-1 text-text-secondary",children:[e.jsx(b,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:(u=s.appointment_date,new Date(u).toLocaleDateString(L?"ar-SA":"en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}))})]}),e.jsxs("span",{className:"flex items-center gap-1 text-text-secondary",children:[e.jsx(y,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0"}),R(s.appointment_date),s.duration_minutes&&` (${s.duration_minutes} ${L?"د":"m"})`]})]}),s.notes&&e.jsxs("p",{className:"text-xs text-text-secondary italic line-clamp-2",children:['"',s.notes,'"']}),(x||p)&&e.jsxs("div",{className:"flex gap-2 pt-1",children:[x&&"video_call"===s.type&&e.jsxs(i,{size:"sm",className:"flex-1 sm:flex-none bg-gradient-to-r from-primary to-green-400 hover:opacity-90 text-xs sm:text-sm h-9",onClick:()=>(e=>{e.meeting_link?window.open(e.meeting_link,"_blank"):e.room_id?$(`/call/${e.room_id}`):c({title:L?"رابط غير متوفر":"Link Not Available",description:L?"سيتم إرسال رابط الاجتماع قريباً":"Meeting link will be shared soon",variant:"destructive"})})(s),children:[e.jsx(C,{className:"w-4 h-4 mr-1"}),L?"انضم للمكالمة":"Join Call"]}),p&&e.jsxs(i,{variant:"outline",size:"sm",className:"flex-1 sm:flex-none text-red-500 hover:text-red-600 hover:bg-red-50 border-red-200 text-xs sm:text-sm h-9",onClick:()=>(async e=>{if(window.confirm(L?"هل تريد إلغاء هذا الموعد؟":"Are you sure you want to cancel this appointment?"))try{const{error:s}=await n.from("appointments").update({status:"cancelled"}).eq("id",e);if(s)throw s;c({title:L?"تم الإلغاء":"Appointment Cancelled",description:L?"تم إلغاء الموعد بنجاح":"Your appointment has been cancelled"}),B()}catch(s){c({title:L?"خطأ":"Error",description:L?"فشل إلغاء الموعد":"Failed to cancel appointment",variant:"destructive"})}})(s.id),children:[e.jsx(k,{className:"w-4 h-4 mr-1"}),L?"إلغاء":"Cancel"]})]})]})});var u};return V?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(j,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs(o,{className:"glass-effect border-border/30",children:[e.jsx(d,{children:e.jsxs(m,{className:"flex items-center gap-2 text-foreground",children:[e.jsx(b,{className:"w-5 h-5 text-primary"}),L?"مواعيدي":"My Appointments"]})}),e.jsx(x,{children:e.jsxs(p,{value:z,onValueChange:E,children:[e.jsxs(u,{className:"grid w-full grid-cols-3 mb-4",children:[e.jsxs(h,{value:"upcoming",className:"flex items-center gap-1",children:[e.jsx(g,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:L?"القادمة":"Upcoming"}),I.length>0&&e.jsx(r,{variant:"secondary",className:"ml-1 h-5 px-1.5 text-xs",children:I.length})]}),e.jsxs(h,{value:"past",className:"flex items-center gap-1",children:[e.jsx(N,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:L?"السابقة":"Past"})]}),e.jsxs(h,{value:"cancelled",className:"flex items-center gap-1",children:[e.jsx(w,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:L?"الملغاة":"Cancelled"})]})]}),e.jsx(f,{value:"upcoming",className:"space-y-3",children:0===I.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(g,{className:"w-12 h-12 mx-auto text-muted-foreground mb-3"}),e.jsx("p",{className:"text-text-secondary",children:L?"لا توجد مواعيد قادمة":"No upcoming appointments"})]}):I.map(s=>e.jsx(Y,{appointment:s},s.id))}),e.jsx(f,{value:"past",className:"space-y-3",children:0===J.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(N,{className:"w-12 h-12 mx-auto text-muted-foreground mb-3"}),e.jsx("p",{className:"text-text-secondary",children:L?"لا توجد مواعيد سابقة":"No past appointments"})]}):J.map(s=>e.jsx(Y,{appointment:s},s.id))}),e.jsx(f,{value:"cancelled",className:"space-y-3",children:0===Q.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(w,{className:"w-12 h-12 mx-auto text-muted-foreground mb-3"}),e.jsx("p",{className:"text-text-secondary",children:L?"لا توجد مواعيد ملغاة":"No cancelled appointments"})]}):Q.map(s=>e.jsx(Y,{appointment:s},s.id))})]})})]})}export{T as U};
