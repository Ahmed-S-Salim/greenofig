import{j as e}from"./vendor-ui-1f4695e3.js";import{r as s}from"./vendor-react-c35372bd.js";import{a as t,u as a,H as r,B as l,A as i,k as d,l as n,L as o,I as c,s as m,t as u}from"./index-6b8dec48.js";import{C as x,c as h,a as p,b as f,e as g}from"./card-337a2a4f.js";import{C as j}from"./checkbox-7ffa2cd8.js";import{L as b,m as v,U as N,as as w,c7 as y,p as _,aA as k,a as C,bR as P,aJ as S}from"./vendor-utils-a892ab91.js";import"./vendor-editor-8f9f6f2d.js";const A=()=>{var A,F,E,U;const{user:L,userProfile:$,refreshUserProfile:H}=t(),{t:q,i18n:I}=a(),M="ar"===I.language,[z,G]=s.useState(null),[W,B]=s.useState(!1),[D,R]=s.useState(!0),[Y,T]=s.useState(!1),[V,J]=s.useState(!1),K=s.useRef(null),[O,Q]=s.useState(!1),[X,Z]=s.useState(""),[ee,se]=s.useState(""),[te,ae]=s.useState(""),[re,le]=s.useState(!1),[ie,de]=s.useState(!1),[ne,oe]=s.useState(!1);s.useEffect(()=>{$&&(G({...$}),R(!1))},[$]);const ce=e=>{const{name:s,value:t}=e.target;G(e=>({...e,[s]:t}))},me=()=>{W&&K.current.click()};return D||!z?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(b,{className:"h-12 w-12 animate-spin text-primary"})}):e.jsxs(e.Fragment,{children:[e.jsxs(r,{children:[e.jsx("title",{children:"My Profile - GreenoFig"}),e.jsx("meta",{name:"description",content:"Manage your profile and settings."})]}),e.jsxs(v.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},initial:"hidden",animate:"visible",className:"max-w-4xl mx-auto space-y-8 "+(M?"text-right":"text-left"),dir:M?"rtl":"ltr",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 "+(M?"sm:flex-row-reverse":""),children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl font-bold",children:[q("profile.my","My")," ",e.jsx("span",{className:"gradient-text",children:q("profile.profile","Profile")})]}),e.jsx("p",{className:"text-text-secondary mt-2",children:q("profile.viewAndManage","View and manage your personal details.")})]}),e.jsx(l,{onClick:()=>B(!W),disabled:Y||V,className:M?"flex-row-reverse":"",children:W?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"h-4 w-4 "+(M?"ml-2":"mr-2")})," ",q("profile.viewProfile","View Profile")]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"h-4 w-4 "+(M?"ml-2":"mr-2")})," ",q("profile.editProfile","Edit Profile")]})})]}),e.jsx(x,{className:"glass-effect",children:e.jsx(h,{className:"p-6",children:W?e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!L)return;T(!0);const{id:s,created_at:t,updated_at:a,role:r,email:l,profile_picture_url:i,...d}=z,{error:n}=await m.from("user_profiles").update(d).eq("id",L.id);n?u({variant:"destructive",title:"Error updating profile",description:n.message}):(await H(),u({title:"Profile Updated!",description:"Your information has been successfully saved."}),B(!1)),T(!1)},className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"relative group",children:[e.jsxs(i,{className:"h-24 w-24 cursor-pointer",onClick:me,children:[e.jsx(d,{src:null==z?void 0:z.profile_picture_url,alt:null==z?void 0:z.full_name}),e.jsx(n,{className:"text-4xl",children:(null==(A=null==z?void 0:z.full_name)?void 0:A.split(" ").map(e=>e[0]).join(""))||"?"})]}),V?e.jsx("div",{className:"absolute inset-0 bg-background/80 flex items-center justify-center rounded-full",children:e.jsx(b,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center rounded-full opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer",onClick:me,children:e.jsx(y,{className:"h-8 w-8 text-white"})}),e.jsx("input",{type:"file",ref:K,onChange:async e=>{const s=e.target.files[0];if(!s||!L)return;J(!0);const t=s.name.split(".").pop(),a=`avatars/${`${L.id}.${t}`}`,{error:r}=await m.storage.from("user-assets").upload(a,s,{upsert:!0});if(r)return u({variant:"destructive",title:"Upload failed",description:r.message}),void J(!1);const{data:{publicUrl:l}}=m.storage.from("user-assets").getPublicUrl(a),i=`${l}?t=${(new Date).getTime()}`,{error:d}=await m.from("user_profiles").update({profile_picture_url:i}).eq("id",L.id);d?u({variant:"destructive",title:"Failed to save avatar",description:d.message}):(await H(),u({title:"Avatar updated!",description:"Your new profile picture is now live."})),J(!1)},accept:"image/png, image/jpeg",className:"hidden"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"full_name",className:"block text-sm font-medium text-text-primary",children:"Full Name"}),e.jsx("input",{type:"text",name:"full_name",id:"full_name",value:z.full_name||"",onChange:ce,className:"mt-1 block w-full bg-background border border-border rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-text-secondary",children:"Email"}),e.jsx("input",{type:"email",name:"email",id:"email",value:z.email||"",disabled:!0,className:"mt-1 block w-full bg-muted border-border rounded-md shadow-sm py-2 px-3 sm:text-sm cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"age",className:"block text-sm font-medium text-text-primary",children:"Age"}),e.jsx("input",{type:"number",name:"age",id:"age",value:z.age||"",onChange:ce,className:"mt-1 block w-full bg-background border border-border rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"height_cm",className:"block text-sm font-medium text-text-primary",children:"Height (cm)"}),e.jsx("input",{type:"number",name:"height_cm",id:"height_cm",value:z.height_cm||"",onChange:ce,className:"mt-1 block w-full bg-background border border-border rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"weight_kg",className:"block text-sm font-medium text-text-primary",children:"Weight (kg)"}),e.jsx("input",{type:"number",step:"0.1",name:"weight_kg",id:"weight_kg",value:z.weight_kg||"",onChange:ce,className:"mt-1 block w-full bg-background border border-border rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-text-primary mb-3 flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),"Health Goals"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[{id:"lose_weight",label:"Lose Weight"},{id:"build_muscle",label:"Build Muscle"},{id:"improve_endurance",label:"Improve Endurance"},{id:"eat_healthier",label:"Eat Healthier"},{id:"increase_energy",label:"Increase Energy"},{id:"reduce_stress",label:"Reduce Stress"},{id:"better_sleep",label:"Better Sleep"}].map(s=>e.jsxs("div",{className:"flex items-center space-x-2 p-3 rounded-lg border border-border hover:bg-muted/50 transition-colors",children:[e.jsx(j,{id:s.id,checked:(z.health_goals||[]).includes(s.id),onCheckedChange:()=>(e=>{const s=z.health_goals||[],t=s.includes(e)?s.filter(s=>s!==e):[...s,e];G(e=>({...e,health_goals:t}))})(s.id)}),e.jsx(o,{htmlFor:s.id,className:"text-sm font-medium cursor-pointer flex-1",children:s.label})]},s.id))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Select all that apply to personalize your experience"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(l,{type:"submit",disabled:Y||V,children:[Y?e.jsx(b,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(k,{className:"mr-2 h-4 w-4"}),"Save Changes"]})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs(i,{className:"h-24 w-24 border-2 border-primary",children:[e.jsx(d,{src:null==z?void 0:z.profile_picture_url,alt:null==z?void 0:z.full_name}),e.jsx(n,{className:"text-4xl",children:(null==(F=null==z?void 0:z.full_name)?void 0:F.split(" ").map(e=>e[0]).join(""))||"?"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-text-primary",children:z.full_name}),e.jsx("p",{className:"text-text-secondary",children:z.email}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize mt-1",children:z.role||"user"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-6 pt-6 border-t border-border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Age"}),e.jsx("p",{className:"text-lg font-semibold",children:z.age||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Gender"}),e.jsx("p",{className:"text-lg font-semibold capitalize",children:z.gender||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Height"}),e.jsx("p",{className:"text-lg font-semibold",children:z.height_cm?`${z.height_cm} cm`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Weight"}),e.jsx("p",{className:"text-lg font-semibold",children:z.weight_kg?`${z.weight_kg} kg`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Activity Level"}),e.jsx("p",{className:"text-lg font-semibold capitalize",children:(null==(E=z.activity_level)?void 0:E.replace("_"," "))||"N/A"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Health Goals"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(null==(U=z.health_goals)?void 0:U.length)>0?z.health_goals.map(s=>e.jsx("span",{className:"px-3 py-1 text-sm rounded-full bg-primary/10 text-primary font-medium",children:s},s)):e.jsx("p",{children:"No goals set."})})]})]})})}),e.jsxs(x,{className:"glass-effect",children:[e.jsxs(p,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5"}),"Change Password"]}),e.jsx(g,{children:"Update your password to keep your account secure"})]}),e.jsx(h,{children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),ee.length<8)u({variant:"destructive",title:"Password too short",description:"Password must be at least 8 characters long."});else if(ee===te){Q(!0);try{const{error:e}=await m.auth.signInWithPassword({email:L.email,password:X});if(e)return u({variant:"destructive",title:"Incorrect current password",description:"Please enter your correct current password."}),void Q(!1);const{error:s}=await m.auth.updateUser({password:ee});if(s)throw s;u({title:"Password updated successfully",description:"Your password has been changed."}),Z(""),se(""),ae("")}catch(s){u({variant:"destructive",title:"Error updating password",description:s.message})}finally{Q(!1)}}else u({variant:"destructive",title:"Passwords do not match",description:"Please make sure both passwords are the same."})},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{type:re?"text":"password",value:X,onChange:e=>Z(e.target.value),placeholder:"Enter current password",disabled:O,required:!0,className:"pr-10"}),e.jsx("button",{type:"button",onClick:()=>le(!re),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:re?e.jsx(P,{className:"w-4 h-4"}):e.jsx(S,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{type:ie?"text":"password",value:ee,onChange:e=>se(e.target.value),placeholder:"Enter new password",disabled:O,required:!0,minLength:8,className:"pr-10"}),e.jsx("button",{type:"button",onClick:()=>de(!ie),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:ie?e.jsx(P,{className:"w-4 h-4"}):e.jsx(S,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"At least 8 characters"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{type:ne?"text":"password",value:te,onChange:e=>ae(e.target.value),placeholder:"Confirm new password",disabled:O,required:!0,minLength:8,className:"pr-10"}),e.jsx("button",{type:"button",onClick:()=>oe(!ne),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:ne?e.jsx(P,{className:"w-4 h-4"}):e.jsx(S,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(l,{type:"submit",disabled:O,children:[O&&e.jsx(b,{className:"mr-2 h-4 w-4 animate-spin"}),O?"Updating...":"Update Password"]})})]})})]})]})]})};export{A as default};
