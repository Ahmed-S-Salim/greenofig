import{j as e}from"./vendor-ui-1f4695e3.js";import{r as t}from"./vendor-react-c35372bd.js";import{C as s}from"./card-337a2a4f.js";import{s as a,_ as n,a as i,D as l,b as r,d,e as o,f as c,L as x,T as m,B as u,t as h,z as p,w as y,C as j,E as g,F as v}from"./index-6b8dec48.js";import{T as f,a as b,b as N,c as w}from"./tabs-fb6868c7.js";import{i as _,O as S,au as F,F as C,aI as T,a6 as $,aN as D,q as z,aq as M,at as q}from"./vendor-utils-a892ab91.js";import"./vendor-editor-8f9f6f2d.js";let R=null;const P=async e=>{var t,s;try{const{data:i,error:l}=await a.from("invoices").select("\n        *,\n        subscription_plans (name, description),\n        payment_transactions (payment_method, payment_intent_id)\n      ").eq("id",e).single();if(l)throw l;if(!i)throw new Error("Invoice not found");const r=new(await(async()=>{if(!R){const e=(await n(()=>import("./jspdf.es.min-8244350b.js").then(e=>e.j),["assets/jspdf.es.min-8244350b.js","assets/index-6b8dec48.js","assets/vendor-ui-1f4695e3.js","assets/vendor-react-c35372bd.js","assets/vendor-utils-a892ab91.js","assets/vendor-editor-8f9f6f2d.js","assets/index-1a863d34.css"])).default;await n(()=>import("./jspdf.plugin.autotable-4de48128.js"),[]),R=e}return R})()),d=r.internal.pageSize.getWidth(),o=r.internal.pageSize.getHeight(),c=[34,197,94],x=[17,24,39],m=[156,163,175];r.setFontSize(24),r.setTextColor(...c),r.setFont(void 0,"bold"),r.text("GreenoFig",20,25),r.setFontSize(10),r.setTextColor(...m),r.setFont(void 0,"normal"),r.text("AI-Powered Health & Wellness",20,32),r.text("support@greenofig.com",20,37),r.setFontSize(20),r.setTextColor(...x),r.setFont(void 0,"bold"),r.text("INVOICE",d-20,25,{align:"right"}),r.setFontSize(10),r.setFont(void 0,"normal"),r.setTextColor(...x);let u=35;r.text(`Invoice #: ${i.invoice_number}`,d-20,u,{align:"right"}),u+=5,r.text(`Issue Date: ${_(new Date(i.issue_date),"MMM dd, yyyy")}`,d-20,u,{align:"right"}),u+=5,r.text(`Due Date: ${_(new Date(i.due_date),"MMM dd, yyyy")}`,d-20,u,{align:"right"}),u+=5;const h={draft:[156,163,175],sent:[59,130,246],paid:[34,197,94],void:[239,68,68],refunded:[251,146,60]},p=h[i.status]||h.draft;if(r.setFillColor(...p),r.setTextColor(255,255,255),r.roundedRect(d-50,u-3,30,6,2,2,"F"),r.text(i.status.toUpperCase(),d-35,u+1,{align:"center"}),u+=15,r.setDrawColor(...m),r.line(20,u,d-20,u),u+=10,r.setFontSize(12),r.setTextColor(...x),r.setFont(void 0,"bold"),r.text("Bill To:",20,u),u+=7,r.setFontSize(10),r.setFont(void 0,"normal"),r.text(i.billing_name||"Customer",20,u),i.billing_email&&(u+=5,r.text(i.billing_email,20,u)),i.billing_address&&Object.keys(i.billing_address).length>0){const e=i.billing_address;if(e.line1&&(u+=5,r.text(e.line1,20,u)),e.city||e.state||e.postal_code){u+=5;const t=[e.city,e.state,e.postal_code].filter(Boolean).join(", ");r.text(t,20,u)}e.country&&(u+=5,r.text(e.country,20,u))}u+=15;const y=[];if(i.line_items&&i.line_items.length>0)i.line_items.forEach(e=>{y.push([e.description||"Service",e.quantity||1,`$${(e.unit_price||0).toFixed(2)}`,`$${(e.amount||0).toFixed(2)}`])});else{const e=(null==(t=i.subscription_plans)?void 0:t.name)||"Subscription",a=(null==(s=i.subscription_plans)?void 0:s.description)||"";y.push([`${e}\n${a}`,1,`$${i.subtotal.toFixed(2)}`,`$${i.subtotal.toFixed(2)}`])}r.autoTable({startY:u,head:[["Description","Qty","Unit Price","Amount"]],body:y,theme:"striped",headStyles:{fillColor:c,textColor:[255,255,255],fontStyle:"bold",fontSize:10},bodyStyles:{fontSize:9,textColor:x},alternateRowStyles:{fillColor:[249,250,251]},columnStyles:{0:{cellWidth:90},1:{cellWidth:20,halign:"center"},2:{cellWidth:35,halign:"right"},3:{cellWidth:35,halign:"right"}},margin:{left:20,right:20}}),u=r.lastAutoTable.finalY+10;const j=d-80;if(r.setFontSize(10),r.setFont(void 0,"normal"),r.setTextColor(...x),r.text("Subtotal:",j,u),r.text(`$${i.subtotal.toFixed(2)}`,d-20,u,{align:"right"}),i.discount_amount>0&&(u+=6,r.setTextColor(...h.paid),r.text("Discount:",j,u),r.text(`-$${i.discount_amount.toFixed(2)}`,d-20,u,{align:"right"}),r.setTextColor(...x)),i.tax_amount>0&&(u+=6,r.text(`Tax (${i.tax_rate}%):`,j,u),r.text(`$${i.tax_amount.toFixed(2)}`,d-20,u,{align:"right"})),u+=2,r.setDrawColor(...m),r.line(j,u,d-20,u),u+=8,r.setFontSize(12),r.setFont(void 0,"bold"),r.text("Total:",j,u),r.text(`$${i.amount.toFixed(2)} ${i.currency}`,d-20,u,{align:"right"}),i.payment_transactions&&(u+=10,r.setFontSize(9),r.setFont(void 0,"normal"),r.setTextColor(...m),r.text(`Payment Method: ${i.payment_transactions.payment_method||"N/A"}`,j,u),i.payment_transactions.payment_intent_id&&(u+=4,r.text(`Transaction ID: ${i.payment_transactions.payment_intent_id}`,j,u))),i.notes){u+=15,r.setFontSize(10),r.setTextColor(...x),r.setFont(void 0,"bold"),r.text("Notes:",20,u),u+=5,r.setFont(void 0,"normal"),r.setFontSize(9);const e=r.splitTextToSize(i.notes,d-40);r.text(e,20,u)}const g=o-20;return r.setFontSize(8),r.setTextColor(...m),r.setFont(void 0,"italic"),r.text("Thank you for your business!",d/2,g,{align:"center"}),r.text("This is a computer-generated invoice.",d/2,g+4,{align:"center"}),r}catch(i){throw i}},E=({open:s,onOpenChange:a,transaction:n,onSuccess:y})=>{var j;const{user:g}=i(),[v,f]=t.useState(""),[b,N]=t.useState(""),[w,_]=t.useState(!1);if(!n)return null;return e.jsx(l,{open:s,onOpenChange:a,children:e.jsxs(r,{className:"glass-effect custom-scrollbar max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs(d,{children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5"}),"Request Refund"]}),e.jsx(c,{children:"Submit a refund request for this transaction. Our team will review it within 1-2 business days."})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),v.trim()){_(!0);try{await p({userId:g.id,paymentTransactionId:n.id,amount:n.amount,reason:v,refundType:"full",customerNotes:b.trim()||null}),h({title:"Refund Requested",description:"Your refund request has been submitted and is pending review"}),a(!1),f(""),N(""),y&&y()}catch(t){h({title:"Error",description:"Failed to submit refund request. Please try again.",variant:"destructive"})}finally{_(!1)}}else h({title:"Error",description:"Please select a reason for the refund",variant:"destructive"})},className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg border border-border",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Transaction Amount"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",n.amount]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Date"}),e.jsx("p",{className:"text-sm font-medium",children:new Date(n.created_at).toLocaleDateString()})]})]}),(null==(j=n.subscription_plans)?void 0:j.name)&&e.jsxs("p",{className:"text-sm text-text-secondary",children:["Plan: ",n.subscription_plans.name]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Reason for Refund *"}),e.jsxs("select",{value:v,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-primary min-h-[44px]",style:{fontSize:"16px"},required:!0,children:[e.jsx("option",{value:"",children:"Select a reason..."}),["Product not as described","Technical issues","Changed my mind","Found a better alternative","Too expensive","Not using the service","Billing error","Other"].map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Additional Notes (Optional)"}),e.jsx(m,{value:b,onChange:e=>N(e.target.value),placeholder:"Provide any additional details about your refund request...",rows:4,className:"resize-none"})]}),e.jsxs("div",{className:"flex gap-3 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:[e.jsx(F,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Please Note:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Refunds are reviewed within 1-2 business days"}),e.jsx("li",{children:"Refunds typically take 5-10 business days to appear in your account"}),e.jsx("li",{children:"Your subscription will be cancelled if the refund is approved"})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:w,className:"flex-1",children:"Cancel"}),e.jsx(u,{type:"submit",disabled:w,className:"flex-1",children:w?"Submitting...":"Submit Request"})]})]})]})})},I=()=>{const{user:n}=i(),[l,r]=t.useState([]),[d,o]=t.useState([]),[c,x]=t.useState([]),[m,p]=t.useState([]),[R,I]=t.useState(!0),[k,O]=t.useState(!1),[A,W]=t.useState(null);t.useEffect(()=>{n&&B()},[n]);const B=async()=>{I(!0);try{const e=await(async e=>{try{const{data:t,error:s}=await a.from("invoices").select("\n        *,\n        subscription_plans (name),\n        payment_transactions (status, payment_method)\n      ").eq("user_id",e).order("created_at",{ascending:!1});if(s)throw s;return t||[]}catch(t){return[]}})(n.id);r(e);const t=await y(n.id);o(t);const s=await j(n.id);x(s);const{data:i}=await a.from("payment_transactions").select("\n          *,\n          subscription_plans (name)\n        ").eq("user_id",n.id).order("created_at",{ascending:!1});p(i||[])}catch(e){h({title:"Error",description:"Failed to load billing information",variant:"destructive"})}finally{I(!1)}},L=async e=>{try{await(async e=>{try{const t=await P(e),{data:s}=await a.from("invoices").select("invoice_number").eq("id",e).single(),n=`${(null==s?void 0:s.invoice_number)||"invoice"}.pdf`;t.save(n)}catch(t){throw t}})(e),h({title:"Success",description:"Invoice downloaded successfully"})}catch(t){h({title:"Error",description:"Failed to download invoice",variant:"destructive"})}},V=({status:t})=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${{succeeded:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",failed:"bg-red-100 text-red-800",refunded:"bg-gray-100 text-gray-800",canceled:"bg-gray-100 text-gray-800",approved:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"}[t]||"bg-gray-100 text-gray-800"}`,children:t});return R?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full"})}):e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Billing & Invoices"}),e.jsx("p",{className:"text-text-secondary mt-1",children:"Manage your payments, invoices, and subscription"})]}),e.jsxs(f,{defaultValue:"invoices",children:[e.jsxs(b,{className:"grid w-full grid-cols-4",children:[e.jsx(N,{value:"invoices",children:"Invoices"}),e.jsx(N,{value:"transactions",children:"Transactions"}),e.jsx(N,{value:"payment-methods",children:"Payment Methods"}),e.jsx(N,{value:"refunds",children:"Refunds"})]}),e.jsx(w,{value:"invoices",className:"space-y-4",children:0===l.length?e.jsxs(s,{className:"p-12 text-center",children:[e.jsx(C,{className:"w-12 h-12 mx-auto text-text-secondary mb-4"}),e.jsx("p",{className:"text-text-secondary",children:"No invoices yet"})]}):e.jsx("div",{className:"space-y-3",children:l.map(t=>e.jsx(s,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-lg",children:e.jsx(C,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:t.invoice_number}),e.jsx("p",{className:"text-sm text-text-secondary",children:_(new Date(t.issue_date),"MMM dd, yyyy")})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold",children:["$",t.amount]}),e.jsx(V,{status:t.status})]}),e.jsxs(u,{onClick:()=>L(t.id),variant:"outline",size:"sm",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Download"]})]})]})},t.id))})}),e.jsx(w,{value:"transactions",className:"space-y-4",children:0===m.length?e.jsxs(s,{className:"p-12 text-center",children:[e.jsx(S,{className:"w-12 h-12 mx-auto text-text-secondary mb-4"}),e.jsx("p",{className:"text-text-secondary",children:"No transactions yet"})]}):e.jsx("div",{className:"space-y-3",children:m.map(t=>{var a;return e.jsx(s,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-lg "+("succeeded"===t.status?"bg-green-100":"failed"===t.status?"bg-red-100":"bg-gray-100"),children:"succeeded"===t.status?e.jsx($,{className:"w-6 h-6 text-green-600"}):"failed"===t.status?e.jsx(D,{className:"w-6 h-6 text-red-600"}):e.jsx(F,{className:"w-6 h-6 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:(null==(a=t.subscription_plans)?void 0:a.name)||"Payment"}),e.jsx("p",{className:"text-sm text-text-secondary",children:_(new Date(t.created_at),"MMM dd, yyyy")}),t.payment_intent_id&&e.jsxs("p",{className:"text-xs text-text-secondary mt-1",children:["ID: ",t.payment_intent_id]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold",children:["$",t.amount]}),e.jsx(V,{status:t.status})]}),"succeeded"===t.status&&!t.is_refunded&&e.jsx(u,{onClick:()=>(e=>{W(e),O(!0)})(t),variant:"outline",size:"sm",children:"Request Refund"})]})]})},t.id)})})}),e.jsx(w,{value:"payment-methods",className:"space-y-4",children:0===d.length?e.jsxs(s,{className:"p-12 text-center",children:[e.jsx(z,{className:"w-12 h-12 mx-auto text-text-secondary mb-4"}),e.jsx("p",{className:"text-text-secondary mb-4",children:"No payment methods added"}),e.jsxs(u,{children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Add Payment Method"]})]}):e.jsxs("div",{className:"space-y-3",children:[d.map(t=>{var a;return e.jsx(s,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-lg",children:e.jsx(z,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold",children:[null==(a=t.card_brand)?void 0:a.toUpperCase()," •••• ",t.card_last4]}),e.jsxs("p",{className:"text-sm text-text-secondary",children:["Expires ",t.card_exp_month,"/",t.card_exp_year]}),t.is_default&&e.jsx("span",{className:"text-xs bg-primary/20 text-primary px-2 py-0.5 rounded-full mt-1 inline-block",children:"Default"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[!t.is_default&&e.jsx(u,{onClick:()=>(async e=>{try{await g(n.id,e),await B(),h({title:"Success",description:"Default payment method updated"})}catch(t){h({title:"Error",description:"Failed to update payment method",variant:"destructive"})}})(t.id),variant:"outline",size:"sm",children:"Set as Default"}),e.jsx(u,{onClick:()=>(async e=>{try{await v(n.id,e),await B(),h({title:"Success",description:"Payment method removed"})}catch(t){h({title:"Error",description:"Failed to remove payment method",variant:"destructive"})}})(t.id),variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700",children:e.jsx(q,{className:"w-4 h-4"})})]})]})},t.id)}),e.jsxs(u,{className:"w-full",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Add New Payment Method"]})]})}),e.jsx(w,{value:"refunds",className:"space-y-4",children:0===c.length?e.jsxs(s,{className:"p-12 text-center",children:[e.jsx(S,{className:"w-12 h-12 mx-auto text-text-secondary mb-4"}),e.jsx("p",{className:"text-text-secondary",children:"No refund requests"})]}):e.jsx("div",{className:"space-y-3",children:c.map(t=>e.jsx(s,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-lg",children:e.jsx(S,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Refund Request"}),e.jsx("p",{className:"text-sm text-text-secondary",children:_(new Date(t.requested_at),"MMM dd, yyyy")}),t.reason&&e.jsxs("p",{className:"text-sm text-text-secondary mt-1",children:["Reason: ",t.reason]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold",children:["$",t.amount]}),e.jsx(V,{status:t.status}),"completed"===t.status&&t.completed_at&&e.jsxs("p",{className:"text-xs text-text-secondary mt-1",children:["Completed ",_(new Date(t.completed_at),"MMM dd")]})]})]})},t.id))})})]}),e.jsx(E,{open:k,onOpenChange:O,transaction:A,onSuccess:B})]})};export{I as default};
