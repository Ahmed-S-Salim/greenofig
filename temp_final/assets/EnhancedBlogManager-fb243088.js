var e=Object.defineProperty,s=(s,t,a)=>(((s,t,a)=>{t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a})(s,"symbol"!=typeof t?t+"":t,a),a);import{j as t}from"./vendor-ui-c5075e48.js";import{R as a,u as l,r as i}from"./vendor-react-c35372bd.js";import{B as r,s as n,t as c,I as d,a as o}from"./index-67d0fb94.js";import{C as m,a as x,b as h,c as u,e as p}from"./card-b68930bc.js";import{k as j,aH as g,L as f,a3 as v,F as N,u as b,ag as w,g as y,as as _,aa as C,bn as k,at as P,aV as S,a5 as D,w as E,i as M,Z as A,X as $,v as z,ah as V}from"./vendor-utils-7072100e.js";import{T,a as F,b as L,c as R}from"./tabs-eac78ff9.js";import{C as I}from"./checkbox-04380905.js";class q extends a.Component{constructor(e){super(e),s(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})}),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,s){this.setState({error:e,errorInfo:s})}render(){return this.state.hasError?t.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:t.jsxs(m,{className:"max-w-2xl w-full glass-effect",children:[t.jsx(x,{children:t.jsxs(h,{className:"flex items-center gap-3 text-2xl",children:[t.jsx(j,{className:"w-8 h-8 text-red-500"}),"Something Went Wrong"]})}),t.jsxs(u,{className:"space-y-4",children:[t.jsx("p",{className:"text-text-secondary",children:"We encountered an unexpected error. This has been logged and we'll look into it."}),this.state.error&&t.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-lg",children:t.jsx("p",{className:"font-mono text-sm text-red-400",children:this.state.error.toString()})}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs(r,{onClick:this.handleReset,className:"flex items-center gap-2",children:[t.jsx(g,{className:"w-4 h-4"}),"Try Again"]}),t.jsx(r,{variant:"outline",onClick:()=>{const e=window.location.hostname.includes("github.io")?"/greenofig":"";window.location.href=`${e}/app/admin`},children:"Go to Dashboard"})]}),!1]})]})}):this.props.children}}const B=({user:e})=>{const s=l(),[a,q]=i.useState([]),[B,W]=i.useState([]),[O,G]=i.useState([]),[H,K]=i.useState(""),[U,Z]=i.useState("all"),[J,Q]=i.useState("all"),[X,Y]=i.useState("all"),[ee,se]=i.useState(!0),[te,ae]=i.useState("posts"),[le,ie]=i.useState([]),[re,ne]=i.useState([]),[ce,de]=i.useState([]),[oe,me]=i.useState([]),[xe,he]=i.useState({totalPosts:0,publishedPosts:0,draftPosts:0,scheduledPosts:0,totalViews:0,totalComments:0,pendingComments:0,avgViewsPerPost:0});i.useEffect(()=>{ue(),pe(),je(),ge(),fe()},[]),i.useEffect(()=>{ve()},[H,U,J,X,a]);const ue=async()=>{se(!0);try{const{data:e,error:s}=await n.from("blog_posts").select("\n          *,\n          author:user_profiles!blog_posts_author_id_fkey(id, full_name, email)\n        ").order("created_at",{ascending:!1});if(s)throw s;q(e||[])}catch(e){c({variant:"destructive",title:"Error",description:"Failed to fetch blog posts"})}finally{se(!1)}},pe=async()=>{try{const{data:e,error:s}=await n.from("blog_categories").select("*").order("name",{ascending:!0});if(s)throw s;W(e||[])}catch(e){}},je=async()=>{try{const{data:e,error:s}=await n.from("user_profiles").select("id, full_name, email, role").in("role",["nutritionist","admin","super_admin"]).order("full_name",{ascending:!0});if(s)throw s;ne(e||[])}catch(e){}},ge=async()=>{try{const{data:e,error:s}=await n.from("blog_comments").select("\n          *,\n          blog_post:blog_posts(title, slug),\n          user:user_profiles(full_name)\n        ").order("created_at",{ascending:!1});if(s)throw s;de(e||[]),me((null==e?void 0:e.filter(e=>!e.is_approved))||[])}catch(e){}},fe=async()=>{try{const{data:e}=await n.from("blog_posts").select("status, view_count"),{data:s}=await n.from("blog_comments").select("is_approved");if(e){const t=e.reduce((e,s)=>e+(s.view_count||0),0),a={totalPosts:e.length,publishedPosts:e.filter(e=>"published"===e.status).length,draftPosts:e.filter(e=>"draft"===e.status).length,scheduledPosts:e.filter(e=>"scheduled"===e.status).length,totalViews:t,totalComments:(null==s?void 0:s.length)||0,pendingComments:(null==s?void 0:s.filter(e=>!e.is_approved).length)||0,avgViewsPerPost:e.length>0?Math.round(t/e.length):0};he(a)}}catch(e){}},ve=()=>{let e=a;H&&(e=e.filter(e=>{var s,t;return(null==(s=e.title)?void 0:s.toLowerCase().includes(H.toLowerCase()))||(null==(t=e.excerpt)?void 0:t.toLowerCase().includes(H.toLowerCase()))})),"all"!==U&&(e=e.filter(e=>e.status===U)),"all"!==J&&(e=e.filter(e=>e.author_id===J)),"all"!==X&&(e=e.filter(e=>e.category===X)),G(e)},Ne=async e=>{if(0!==le.length)try{switch(e){case"publish":await n.from("blog_posts").update({status:"published",published_at:(new Date).toISOString()}).in("id",le),c({title:`Published ${le.length} posts`});break;case"draft":await n.from("blog_posts").update({status:"draft"}).in("id",le),c({title:`Moved ${le.length} posts to draft`});break;case"archive":await n.from("blog_posts").update({status:"archived"}).in("id",le),c({title:`Archived ${le.length} posts`});break;case"delete":confirm(`Delete ${le.length} posts permanently?`)&&(await n.from("blog_posts").delete().in("id",le),c({title:`Deleted ${le.length} posts`}))}ie([]),ue(),fe()}catch(s){c({variant:"destructive",title:"Error",description:"Failed to perform bulk action"})}else c({variant:"destructive",title:"No posts selected",description:"Please select posts to perform bulk actions"})},be=({icon:e,title:s,value:a,change:l,color:i})=>t.jsx(m,{children:t.jsx(u,{className:"p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:s}),t.jsx("h3",{className:"text-3xl font-bold text-foreground",children:a}),l&&t.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400 mt-1 flex items-center gap-1",children:[t.jsx(D,{className:"w-4 h-4"}),l]})]}),t.jsx("div",{className:`p-4 rounded-full ${i||"bg-primary/10"}`,children:t.jsx(e,{className:"w-6 h-6 text-primary"})})]})})}),we=({post:a})=>{var l;const i=le.includes(a.id);return t.jsx(m,{className:"glass-effect hover:shadow-lg transition-all "+(i?"ring-2 ring-primary":""),children:t.jsxs(u,{className:"p-6",children:[t.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[t.jsx(I,{checked:i,onCheckedChange:()=>{return e=a.id,void ie(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e]);var e}}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-semibold text-lg mb-1",children:a.title}),t.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:a.excerpt||"No excerpt"})]}),t.jsx(o,{className:{draft:"bg-gray-500",published:"bg-green-500",scheduled:"bg-blue-500",archived:"bg-red-500"}[a.status],children:a.status})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4 text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(z,{className:"w-4 h-4 text-muted-foreground"}),t.jsx("span",{children:(null==(l=a.author)?void 0:l.full_name)||"Unknown"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(S,{className:"w-4 h-4 text-muted-foreground"}),t.jsxs("span",{children:[a.view_count||0," views"]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(E,{className:"w-4 h-4 text-muted-foreground"}),t.jsx("span",{children:a.published_at?M(new Date(a.published_at),"MMM d"):"Not published"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(w,{className:"w-4 h-4 text-muted-foreground"}),t.jsx("span",{children:a.focus_keyword||"No keyword"})]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(r,{variant:"outline",size:"sm",onClick:()=>{const t="nutritionist"===(null==e?void 0:e.role)?"nutritionist":"admin";s(`/app/${t}/blog/edit/${a.id}`)},className:"flex-1",children:[t.jsx(V,{className:"w-4 h-4 mr-1"}),"Edit"]}),t.jsx(r,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this post?"))try{const{error:s}=await n.from("blog_posts").delete().eq("id",e);if(s)throw s;c({title:"Post deleted successfully"}),ue(),fe()}catch(s){c({variant:"destructive",title:"Error",description:"Failed to delete post"})}})(a.id),className:"text-destructive",children:t.jsx(P,{className:"w-4 h-4"})}),"published"===a.status&&t.jsx(r,{variant:"outline",size:"sm",onClick:()=>{const e=window.location.hostname.includes("github.io")?"/greenofig":"";window.open(`${e}/blog/${a.slug}`,"_blank")},children:t.jsx(S,{className:"w-4 h-4"})})]})]})})};return ee?t.jsx("div",{className:"flex items-center justify-center h-96",children:t.jsx(f,{className:"w-12 h-12 animate-spin text-primary"})}):t.jsx("div",{className:"min-h-screen",children:t.jsxs("div",{className:"max-w-7xl mx-auto px-2 sm:px-4 lg:px-6 py-4 sm:py-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg sm:text-xl lg:text-2xl font-bold",children:"Blog Management"}),t.jsx("p",{className:"text-xs sm:text-sm text-text-secondary mt-1",children:"Manage all blog posts, categories, and comments"})]}),t.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[t.jsxs(r,{variant:"outline",size:"sm",onClick:ue,className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",children:[t.jsx(g,{className:"w-4 h-4 sm:mr-2"}),t.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]}),t.jsxs(r,{size:"sm",onClick:()=>{const t="nutritionist"===(null==e?void 0:e.role)?"nutritionist":"admin";s(`/app/${t}/blog/new`)},className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",children:[t.jsx(v,{className:"w-4 h-4 sm:mr-2"}),t.jsx("span",{className:"hidden sm:inline",children:"Create Post"}),t.jsx("span",{className:"inline sm:hidden",children:"New"})]})]})]}),t.jsxs(T,{value:te,onValueChange:ae,children:[t.jsx("div",{className:"flex justify-center mb-6",children:t.jsxs(F,{className:"w-full max-w-full overflow-x-auto flex-nowrap scrollbar-hide h-auto justify-start sm:justify-center px-1",children:[t.jsxs(L,{value:"posts",className:"flex-shrink-0 text-xs sm:text-sm px-2 sm:px-3 py-2",children:[t.jsx(N,{className:"w-3 h-3 sm:w-4 sm:h-4 sm:mr-1"}),t.jsx("span",{className:"hidden sm:inline",children:"Posts"}),t.jsx("span",{className:"inline sm:hidden",children:"Posts"}),t.jsxs("span",{className:"ml-1",children:["(",xe.totalPosts,")"]})]}),t.jsxs(L,{value:"analytics",className:"flex-shrink-0 text-xs sm:text-sm px-2 sm:px-3 py-2",children:[t.jsx(b,{className:"w-3 h-3 sm:w-4 sm:h-4 sm:mr-1"}),t.jsx("span",{className:"hidden sm:inline",children:"Analytics"}),t.jsx("span",{className:"inline sm:hidden",children:"Stats"})]}),t.jsxs(L,{value:"categories",className:"flex-shrink-0 text-xs sm:text-sm px-2 sm:px-3 py-2",children:[t.jsx(w,{className:"w-3 h-3 sm:w-4 sm:h-4 sm:mr-1"}),t.jsx("span",{className:"hidden sm:inline",children:"Categories"}),t.jsx("span",{className:"inline sm:hidden",children:"Cat"}),t.jsxs("span",{className:"ml-1",children:["(",B.length,")"]})]}),t.jsxs(L,{value:"comments",className:"flex-shrink-0 text-xs sm:text-sm px-2 sm:px-3 py-2",children:[t.jsx(y,{className:"w-3 h-3 sm:w-4 sm:h-4 sm:mr-1"}),t.jsx("span",{className:"hidden sm:inline",children:"Comments"}),t.jsx("span",{className:"inline sm:hidden",children:"Msgs"}),t.jsxs("span",{className:"ml-1",children:["(",xe.pendingComments,")"]})]})]})}),t.jsxs(R,{value:"posts",className:"space-y-4",children:[t.jsx(m,{className:"glass-effect",children:t.jsx(u,{className:"p-4",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(_,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),t.jsx(d,{placeholder:"Search posts...",value:H,onChange:e=>K(e.target.value),className:"pl-10"})]}),t.jsxs("select",{value:U,onChange:e=>Z(e.target.value),className:"px-3 py-2 bg-background border border-border rounded-md",children:[t.jsx("option",{value:"all",children:"All Status"}),t.jsx("option",{value:"published",children:"Published"}),t.jsx("option",{value:"draft",children:"Draft"}),t.jsx("option",{value:"scheduled",children:"Scheduled"}),t.jsx("option",{value:"archived",children:"Archived"})]}),t.jsxs("select",{value:J,onChange:e=>Q(e.target.value),className:"px-3 py-2 bg-background border border-border rounded-md",children:[t.jsx("option",{value:"all",children:"All Authors"}),re.map(e=>t.jsx("option",{value:e.id,children:e.full_name},e.id))]}),t.jsxs("select",{value:X,onChange:e=>Y(e.target.value),className:"px-3 py-2 bg-background border border-border rounded-md",children:[t.jsx("option",{value:"all",children:"All Categories"}),B.map(e=>t.jsx("option",{value:e.slug,children:e.name},e.id))]})]}),le.length>0&&t.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 p-3 bg-primary/10 rounded-lg",children:[t.jsxs("span",{className:"text-xs sm:text-sm font-medium",children:[le.length," selected"]}),t.jsxs("div",{className:"flex flex-wrap gap-2 w-full sm:w-auto sm:ml-auto",children:[t.jsxs(r,{size:"sm",variant:"outline",onClick:()=>Ne("publish"),className:"h-8 px-2 text-xs",children:[t.jsx(C,{className:"w-3 h-3 sm:w-4 sm:h-4 sm:mr-1"}),t.jsx("span",{className:"hidden sm:inline",children:"Publish"})]}),t.jsxs(r,{size:"sm",variant:"outline",onClick:()=>Ne("draft"),className:"h-8 px-2 text-xs",children:[t.jsx(N,{className:"w-3 h-3 sm:w-4 sm:h-4 sm:mr-1"}),t.jsx("span",{className:"hidden sm:inline",children:"Draft"})]}),t.jsxs(r,{size:"sm",variant:"outline",onClick:()=>Ne("archive"),className:"h-8 px-2 text-xs",children:[t.jsx(k,{className:"w-3 h-3 sm:w-4 sm:h-4 sm:mr-1"}),t.jsx("span",{className:"hidden sm:inline",children:"Archive"})]}),t.jsxs(r,{size:"sm",variant:"outline",onClick:()=>Ne("delete"),className:"h-8 px-2 text-xs text-destructive",children:[t.jsx(P,{className:"w-3 h-3 sm:w-4 sm:h-4 sm:mr-1"}),t.jsx("span",{className:"hidden sm:inline",children:"Delete"})]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(I,{checked:le.length===O.length&&O.length>0,onCheckedChange:()=>{le.length===O.length?ie([]):ie(O.map(e=>e.id))}}),t.jsxs("span",{className:"text-sm text-muted-foreground",children:["Select All (",O.length," posts)"]})]})]})})}),O.length>0?t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4",children:O.map(e=>t.jsx(we,{post:e},e.id))}):t.jsx(m,{className:"glass-effect",children:t.jsxs(u,{className:"p-12 text-center",children:[t.jsx(N,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No posts found"}),t.jsx("p",{className:"text-muted-foreground",children:H||"all"!==U?"Try adjusting your filters":"No blog posts yet"})]})})]}),t.jsxs(R,{value:"analytics",className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsx(be,{icon:N,title:"Total Posts",value:xe.totalPosts}),t.jsx(be,{icon:C,title:"Published",value:xe.publishedPosts}),t.jsx(be,{icon:S,title:"Total Views",value:xe.totalViews.toLocaleString()}),t.jsx(be,{icon:D,title:"Avg Views/Post",value:xe.avgViewsPerPost})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsx(be,{icon:N,title:"Drafts",value:xe.draftPosts}),t.jsx(be,{icon:E,title:"Scheduled",value:xe.scheduledPosts}),t.jsx(be,{icon:y,title:"Total Comments",value:xe.totalComments}),t.jsx(be,{icon:j,title:"Pending Comments",value:xe.pendingComments})]}),t.jsxs(m,{children:[t.jsx(x,{children:t.jsx(h,{children:"Top Performing Posts"})}),t.jsx(u,{children:t.jsx("div",{className:"space-y-3",children:a.filter(e=>"published"===e.status).sort((e,s)=>(s.view_count||0)-(e.view_count||0)).slice(0,10).map((e,s)=>{var a;return t.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 text-primary font-bold",children:s+1}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium",children:e.title}),t.jsx("p",{className:"text-sm text-muted-foreground",children:null==(a=e.author)?void 0:a.full_name})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"font-bold",children:e.view_count||0}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"views"})]})]},e.id)})})})]})]}),t.jsx(R,{value:"categories",className:"space-y-4",children:t.jsxs(m,{children:[t.jsxs(x,{children:[t.jsx(h,{children:"Blog Categories"}),t.jsx(p,{children:"Manage content categories"})]}),t.jsx(u,{children:t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4",children:B.map(e=>t.jsxs("div",{className:"p-4 bg-card border border-border rounded-lg",children:[t.jsx("h3",{className:"font-semibold mb-1",children:e.name}),t.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:e.description||"No description"}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("span",{className:"text-xs text-muted-foreground",children:[a.filter(s=>s.category===e.slug).length," posts"]}),t.jsx(o,{variant:"outline",children:e.slug})]})]},e.id))})})]})}),t.jsxs(R,{value:"comments",className:"space-y-4",children:[t.jsxs(m,{children:[t.jsxs(x,{children:[t.jsxs(h,{children:["Pending Comments (",oe.length,")"]}),t.jsx(p,{children:"Review and moderate comments"})]}),t.jsx(u,{children:oe.length>0?t.jsx("div",{className:"space-y-3",children:oe.map(e=>{var s,a;return t.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg",children:[t.jsxs("div",{className:"flex items-start justify-between mb-2",children:[t.jsxs("div",{children:[t.jsx("p",{className:"font-medium",children:e.author_name||(null==(s=e.user)?void 0:s.full_name)}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:['on "',null==(a=e.blog_post)?void 0:a.title,'"']})]}),t.jsx("span",{className:"text-xs text-muted-foreground",children:M(new Date(e.created_at),"MMM d, yyyy")})]}),t.jsx("p",{className:"text-sm mb-3",children:e.content}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(r,{size:"sm",onClick:()=>(async e=>{try{const{error:s}=await n.from("blog_comments").update({is_approved:!0}).eq("id",e);if(s)throw s;c({title:"Comment approved"}),ge(),fe()}catch(s){c({variant:"destructive",title:"Error",description:"Failed to approve comment"})}})(e.id),children:[t.jsx(A,{className:"w-4 h-4 mr-1"}),"Approve"]}),t.jsxs(r,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(confirm("Delete this comment?"))try{const{error:s}=await n.from("blog_comments").delete().eq("id",e);if(s)throw s;c({title:"Comment deleted"}),ge(),fe()}catch(s){c({variant:"destructive",title:"Error",description:"Failed to delete comment"})}})(e.id),children:[t.jsx($,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]},e.id)})}):t.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No pending comments"})})]}),t.jsxs(m,{children:[t.jsx(x,{children:t.jsx(h,{children:"Recent Comments"})}),t.jsx(u,{children:t.jsx("div",{className:"space-y-3",children:ce.filter(e=>e.is_approved).slice(0,10).map(e=>{var s,a;return t.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg",children:[t.jsxs("div",{className:"flex items-start justify-between mb-1",children:[t.jsx("p",{className:"font-medium text-sm",children:e.author_name||(null==(s=e.user)?void 0:s.full_name)}),t.jsx("span",{className:"text-xs text-muted-foreground",children:M(new Date(e.created_at),"MMM d")})]}),t.jsxs("p",{className:"text-sm text-muted-foreground mb-1",children:['on "',null==(a=e.blog_post)?void 0:a.title,'"']}),t.jsx("p",{className:"text-sm",children:e.content})]},e.id)})})})]})]})]})]})})};export{q as E,B as a};
