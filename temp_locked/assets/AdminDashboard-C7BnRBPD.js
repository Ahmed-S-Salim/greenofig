import{j as e,a4 as s,a5 as a,a6 as t,a7 as r}from"./vendor-ui-CAdTc8ma.js";import{a as i,u as l,h as n}from"./vendor-react-DYWoKpfz.js";import{s as c,t as o,B as d,L as m,I as x,T as h,c as u,u as p,A as g,a as j,b as f,e as v,d as y,H as N}from"./index-AtoPiNTv.js";import{a as w,E as b}from"./EnhancedBlogManager-CInowFod.js";import{C as _,c as C,a as k,b as S,e as A}from"./card-DObhyBOQ.js";import{n as P,K as F,u as E,y as T,m as I,as as M,bw as R,b3 as q,a8 as z,f as L,a1 as D,T as U,ao as O,J as $,k as G,ah as V,bx as B,af as W,r as H,o as Q,ab as Y,I as J,ad as K,al as X,ax as Z,N as ee,Z as se,by as ae,ar as te,bz as re,a7 as ie,an as le,v as ne,bA as ce,bi as oe,g as de,ae as me,ap as xe,bB as he,d as ue,bv as pe,h as ge,bC as je,bb as fe,p as ve,G as ye,bD as Ne,b as we,E as be,bt as _e,am as Ce,a9 as ke,i as Se,U as Ae,bE as Pe,P as Fe,bF as Ee,a as Te,bG as Ie,e as Me,bH as Re,bI as qe,az as ze,a6 as Le,bJ as De,bK as Ue,b4 as Oe,bL as $e,ac as Ge,w as Ve,aa as Be,s as We,aA as He,b0 as Qe,b6 as Ye,bM as Je,bN as Ke,bO as Xe,bP as Ze,bQ as es,bR as ss}from"./vendor-utils-7_dm-8Ld.js";import{D as as,b as ts,c as rs,d as is,e as ls,f as ns,a as cs}from"./dialog-DSKAuchR.js";import{C as os}from"./checkbox-DuXmcnMA.js";import{S as ds,a as ms,b as xs,c as hs,d as us}from"./select-Bp8Ho6UQ.js";import{T as ps,a as gs,b as js,c as fs}from"./tabs-W0guYPUx.js";import{D as vs,a as ys,b as Ns,e as ws,c as bs,d as _s}from"./dropdown-menu-L6LqwziZ.js";import{S as Cs}from"./switch-CvX_loKb.js";import ks from"./RevenueAnalyticsPage-yL14w6kJ.js";import"./vendor-editor-CURn2XBo.js";const Ss="super_admin",As="admin",Ps="content_editor",Fs="support_agent",Es="analyst",Ts="nutritionist",Is="user",Ms="customers:view",Rs="customers:edit",qs="customers:export",zs="subscriptions:view",Ls="subscriptions:edit",Ds="subscriptions:create",Us="payments:view",Os="payments:refund",$s="payments:export",Gs="revenue:view",Vs="revenue:export",Bs="analytics:view",Ws="analytics:export",Hs="blog:view",Qs="blog:create",Ys="blog:edit",Js="blog:delete",Ks="blog:publish",Xs="website:view",Zs="website:edit",ea="coupons:view",sa="coupons:create",aa="coupons:edit",ta="coupons:delete",ra="referrals:view",ia="referrals:manage",la="support:view",na="support:respond",ca="support:assign",oa="database:view",da="settings:view",ma="users:view_roles",xa={[Ss]:["*"],[As]:[Ms,Rs,qs,zs,Ls,Ds,Us,Os,$s,Gs,Vs,Bs,Ws,Hs,Qs,Ys,Js,Ks,Xs,Zs,ea,sa,aa,ta,ra,ia,la,na,ca,da,ma],[Ps]:[Hs,Qs,Ys,Ks,Xs,Zs,Bs],[Fs]:[Ms,la,na,zs],[Es]:[Bs,Ws,Gs,Vs,Ms,qs,zs,Us,$s],[Ts]:[Ms,la,na],[Is]:[]},ha=(e,s)=>{if(!e||!e.role)return!1;const a={dashboard:[Bs],analytics:[Bs],revenue:[Gs],customers:[Ms],subscriptions:[zs],payments:[Us],coupons:[ea],referrals:[ra],issues:[la],blog:[Hs],website:[Xs],studio:[oa]}[s];return!a||0===a.length||a.some(s=>((e,s)=>{if(!e||!e.role)return!1;const a=e.role,t=xa[a]||[];return!!t.includes("*")||t.includes(s)})(e,s))},ua=({user:s,onNavigate:a})=>{const[t,r]=i.useState({totalRevenue:0,monthlyRevenue:0,totalUsers:0,activeUsers:0,totalVisitors:0,conversionRate:0,growthRate:0}),[l,n]=i.useState([]),[o,d]=i.useState({sources:[],conversions:0,clickThroughRate:0}),[m,x]=i.useState({premium:0,pro:0,elite:0});i.useEffect(()=>{(async()=>{try{const{data:e,count:s}=await c.from("user_profiles").select("*",{count:"exact"}).order("created_at",{ascending:!1}),{data:a,error:t}=await c.from("subscriptions").select("*");t&&"PGRST116"===t.code&&console.log("Subscriptions table not yet created");let i=0,l=0;const o=(new Date).getMonth();if(a){const e={premium:0,pro:0,elite:0};a.forEach(s=>{const a="elite"===s.plan?29.99:"pro"===s.plan?19.99:9.99;i+=a;new Date(s.created_at).getMonth()===o&&(l+=a),"premium"===s.plan?e.premium++:"pro"===s.plan?e.pro++:"elite"===s.plan&&e.elite++}),x(e)}if(e){const t=e.filter(e=>e.is_active).length,c=s>0?((a?.length||0)/s*100).toFixed(1):0;r({totalUsers:s,activeUsers:t,totalRevenue:i,monthlyRevenue:l,totalVisitors:3.5*s,conversionRate:c,growthRate:t>0?(t/s*100).toFixed(1):0}),n(e.slice(0,5))}d({sources:[{name:"Organic Search",visitors:Math.floor(1.2*s),conversions:Math.floor(.4*s)},{name:"Social Media",visitors:Math.floor(.8*s),conversions:Math.floor(.25*s)},{name:"Direct",visitors:Math.floor(.6*s),conversions:Math.floor(.2*s)},{name:"Referral",visitors:Math.floor(.4*s),conversions:Math.floor(.15*s)}],conversions:a?.length||0,clickThroughRate:3.2})}catch(e){console.error("Error fetching dashboard stats:",e)}})()},[]);const h=[{title:"Total Visitors",value:Math.floor(t.totalVisitors),icon:P,gradient:"from-purple-500 to-indigo-500",change:`${t.growthRate}%`},{title:"Total Users",value:t.totalUsers,icon:F,gradient:"from-blue-500 to-cyan-500",change:`${t.conversionRate}% conversion`},{title:"Active Users",value:t.activeUsers,icon:E,gradient:"from-green-500 to-emerald-500",change:`${(t.activeUsers/t.totalUsers*100).toFixed(1)}% active`},{title:"Total Revenue",value:`$${t.totalRevenue.toFixed(2)}`,icon:T,gradient:"from-orange-500 to-red-500",change:`$${t.monthlyRevenue.toFixed(2)} this month`}],u=[{title:"Create Blog Post",description:"Write a new article",icon:M,action:()=>a?.("blog"),color:"from-blue-500 to-cyan-500"},{title:"Add Coupon Code",description:"Create discount code",icon:R,action:()=>a?.("coupons"),color:"from-purple-500 to-pink-500"},{title:"Manage Website",description:"Update site content",icon:q,action:()=>a?.("website"),color:"from-green-500 to-emerald-500"},{title:"View Support Tickets",description:"Check customer issues",icon:z,action:()=>a?.("issues"),color:"from-orange-500 to-red-500"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl lg:text-2xl font-bold",children:"Dashboard Overview"}),e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary mt-1",children:"Track key metrics and platform performance"})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:h.map((s,a)=>{const t=s.icon;return e.jsx(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*a},className:"glass-effect rounded-xl p-4 sm:p-6 shadow-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary",children:s.title}),e.jsx("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold",children:s.value}),e.jsx("p",{className:"text-xs sm:text-sm text-primary mt-1",children:s.change})]}),e.jsx(t,{className:"w-8 h-8"})]})},s.title)})}),e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:[e.jsx("h3",{className:"text-2xl font-bold mb-4",children:"Quick Actions"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:u.map((s,a)=>{const t=s.icon;return e.jsxs("button",{onClick:s.action,className:"glass-effect p-6 rounded-xl hover:scale-105 transition-all duration-200 text-left group",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg bg-gradient-to-br ${s.color} flex items-center justify-center mb-4 group-hover:scale-110 transition-transform`,children:e.jsx(t,{className:"w-6 h-6 text-white"})}),e.jsx("h4",{className:"text-base font-semibold mb-2",children:s.title}),e.jsx("p",{className:"text-sm text-text-secondary",children:s.description})]},s.title)})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"glass-effect rounded-xl p-4 sm:p-6 shadow-xl",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-primary"}),"Recent Users"]}),e.jsx("div",{className:"space-y-3",children:l.length>0?l.map((s,a)=>{const t=s.created_at?new Date(Date.now()-new Date(s.created_at)).getHours():0;return e.jsxs("div",{className:"flex items-start gap-2 sm:gap-3 p-2 sm:p-3 bg-muted/30 rounded-lg",children:[e.jsx("div",{className:"w-7 h-7 sm:w-8 sm:h-8 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xs font-bold text-primary",children:s.full_name?.[0]||"U"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium truncate",children:s.full_name||"User"}),e.jsxs("p",{className:"text-xs text-text-secondary",children:["signed up as ",s.role]})]}),e.jsx("span",{className:"text-xs text-text-secondary whitespace-nowrap",children:t>0?`${t}h ago`:"just now"})]},a)}):e.jsx("p",{className:"text-text-secondary text-xs sm:text-sm",children:"No recent activity"})})]}),e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"glass-effect rounded-xl p-4 sm:p-6 shadow-xl",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-primary"}),"Subscription Distribution"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-text-secondary",children:"Premium Plan"}),e.jsxs("span",{className:"text-sm font-semibold text-green-400",children:[m.premium," subscribers"]})]}),e.jsx("div",{className:"w-full bg-muted/30 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-400 h-2 rounded-full",style:{width:m.premium/Math.max(m.premium+m.pro+m.elite,1)*100+"%"}})}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"$9.99/month"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-text-secondary",children:"Pro Plan"}),e.jsxs("span",{className:"text-sm font-semibold text-blue-400",children:[m.pro," subscribers"]})]}),e.jsx("div",{className:"w-full bg-muted/30 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-400 h-2 rounded-full",style:{width:m.pro/Math.max(m.premium+m.pro+m.elite,1)*100+"%"}})}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"$19.99/month"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-text-secondary",children:"Elite Plan"}),e.jsxs("span",{className:"text-sm font-semibold text-purple-400",children:[m.elite," subscribers"]})]}),e.jsx("div",{className:"w-full bg-muted/30 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-indigo-400 h-2 rounded-full",style:{width:m.elite/Math.max(m.premium+m.pro+m.elite,1)*100+"%"}})}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"$29.99/month"})]}),e.jsx("div",{className:"pt-4 border-t border-border/50",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-semibold",children:"Total MRR"}),e.jsxs("span",{className:"text-lg font-bold text-primary",children:["$",t.monthlyRevenue.toFixed(2)]})]})})]})]})]}),e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"glass-effect rounded-xl p-4 sm:p-6 shadow-xl",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5 text-primary"}),"Marketing Analysis"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-text-secondary mb-3",children:"Traffic Sources"}),e.jsx("div",{className:"space-y-3",children:o.sources.map((s,a)=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsxs("span",{className:"text-text-secondary",children:[s.visitors," visitors"]})]}),e.jsx("div",{className:"w-full bg-muted/30 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-primary to-green-400 h-2 rounded-full",style:{width:s.conversions/s.visitors*100+"%"}})}),e.jsxs("p",{className:"text-xs text-text-secondary",children:[s.conversions," conversions (",(s.conversions/s.visitors*100).toFixed(1),"%)"]})]},a))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-text-secondary mb-3",children:"Key Metrics"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-text-secondary",children:"Conversion Rate"}),e.jsx(O,{className:"w-4 h-4 text-primary"})]}),e.jsxs("p",{className:"text-2xl font-bold",children:[t.conversionRate,"%"]}),e.jsx("p",{className:"text-xs text-green-400 mt-1",children:"+2.3% from last week"})]}),e.jsxs("div",{className:"p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-text-secondary",children:"Total Conversions"}),e.jsx(U,{className:"w-4 h-4 text-primary"})]}),e.jsx("p",{className:"text-2xl font-bold",children:o.conversions}),e.jsx("p",{className:"text-xs text-green-400 mt-1",children:"Active subscriptions"})]}),e.jsxs("div",{className:"p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-text-secondary",children:"Avg. Click-Through"}),e.jsx($,{className:"w-4 h-4 text-primary"})]}),e.jsxs("p",{className:"text-2xl font-bold",children:[o.clickThroughRate,"%"]}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Industry avg: 2.5%"})]})]})]})]})]})]})},pa=({user:s})=>{const[a,t]=i.useState(""),[r,l]=i.useState([]),[n,m]=i.useState([]),[x,h]=i.useState(""),[u,p]=i.useState({dateFrom:"",dateTo:"",search:""}),[g,j]=i.useState([]),[f,v]=i.useState(!0),[y,N]=i.useState(!1),w=i.useRef(null);i.useEffect(()=>{const e=e=>{w.current&&!w.current.contains(e.target)&&N(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const b=i.useCallback(async()=>{v(!0);try{const{data:s,error:a}=await c.rpc("get_all_tables");if(a||!s){console.error("Error fetching tables:",a);const s=["user_profiles","subscriptions","pricing_plans","features","site_content","blog_posts","ai_chat_messages","health_readings","health_devices","payment_transactions","workouts","exercises","meals","nutrition_plans"],r=[];for(const a of s)try{const{error:e}=await c.from(a).select("*").limit(0);e||r.push(a)}catch(e){}j(r),r.length>0&&t(r[0])}else{const e=s.map(e=>e.tablename||e.table_name).filter(Boolean);j(e),e.length>0&&t(e[0])}}catch(s){console.error("Error in fetchAllTables:",s);const e=["user_profiles","subscriptions"];j(e),t(e[0])}v(!1)},[]),_=i.useCallback(async()=>{if(!a)return;let e=c.from(a).select("*");const{data:s,error:t}=await e;t?(o({title:"Error fetching data",description:t.message,variant:"destructive"}),l([])):l(s)},[a]);i.useEffect(()=>{b();const e=localStorage.getItem("savedQueries");e&&m(JSON.parse(e))},[b]),i.useEffect(()=>{a&&_()},[a,_]);const C=e=>{if(!e||!e.length)return"";const s=Object.keys(e[0]),a=e.map(e=>s.map(s=>JSON.stringify(e[s]||"")).join(","));return[s.join(","),...a].join("\n")};return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs(I.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"glass-effect rounded-xl p-6 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-purple-400"}),"Saved Queries"]}),e.jsx("div",{className:"space-y-2",children:0===n.length?e.jsx("p",{className:"text-sm text-purple-300",children:"No saved queries yet"}):n.map(s=>e.jsxs("div",{className:"p-3 bg-white/5 rounded-lg border border-white/10 hover:bg-white/10 transition-all",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("button",{onClick:()=>(e=>{t(e.table),p(e.filters),h(e.query||""),o({title:"Query loaded! ðŸ“‚",description:`Loaded "${e.name}"`})})(s),className:"text-sm font-semibold text-white hover:text-purple-300 text-left flex-1",children:s.name}),e.jsx("button",{onClick:()=>(e=>{const s=n.filter(s=>s.id!==e);m(s),localStorage.setItem("savedQueries",JSON.stringify(s)),o({title:"Query deleted",description:"Saved query has been removed"})})(s.id),className:"text-red-400 hover:text-red-300",children:e.jsx(V,{className:"w-4 h-4"})})]}),e.jsxs("p",{className:"text-xs text-purple-400",children:["Table: ",s.table]})]},s.id))})]}),e.jsxs("div",{className:"lg:col-span-3 space-y-6",children:[e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"glass-effect rounded-xl p-6 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-purple-400"}),"Query Builder"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-purple-200 mb-2",children:"Select Table"}),e.jsxs("div",{className:"relative",ref:w,children:[e.jsxs("button",{onClick:()=>N(!y),disabled:f,className:"w-full px-4 py-3 bg-muted border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary flex items-center justify-between hover:bg-muted/80 transition-colors",children:[e.jsx("span",{className:"truncate",children:f?"Loading tables...":a||"Select a table"}),e.jsx(W,{className:"w-4 h-4 transition-transform "+(y?"rotate-180":"")})]}),e.jsx(H,{children:y&&g.length>0&&e.jsx(I.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.15},className:"absolute z-50 w-full mt-2 bg-card border border-border rounded-lg shadow-xl max-h-64 overflow-y-auto",children:g.map(s=>e.jsxs("button",{onClick:()=>{t(s),N(!1)},className:"w-full px-4 py-3 text-left hover:bg-primary/10 transition-colors flex items-center justify-between group "+(a===s?"bg-primary/20 text-primary":"text-foreground"),children:[e.jsx("span",{className:"truncate",children:s}),a===s&&e.jsx(Q,{className:"w-4 h-4 text-primary flex-shrink-0"})]},s))})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 sm:gap-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-purple-200 mb-1 sm:mb-2",children:"Date From"}),e.jsx("input",{type:"date",value:u.dateFrom,onChange:e=>p({...u,dateFrom:e.target.value}),className:"w-full h-10 px-3 py-2 bg-white/10 border border-white/20 rounded-2xl text-white focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm",style:{fontSize:"16px"}})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-purple-200 mb-1 sm:mb-2",children:"Date To"}),e.jsx("input",{type:"date",value:u.dateTo,onChange:e=>p({...u,dateTo:e.target.value}),className:"w-full h-10 px-3 py-2 bg-white/10 border border-white/20 rounded-2xl text-white focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm",style:{fontSize:"16px"}})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-purple-200 mb-1 sm:mb-2",children:"Search"}),e.jsx("input",{type:"text",value:u.search,onChange:e=>p({...u,search:e.target.value}),placeholder:"Search...",className:"w-full h-10 px-3 py-2 bg-white/10 border border-white/20 rounded-2xl text-white placeholder-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm",style:{fontSize:"16px"}})]})]}),"super_admin"===s?.role&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-purple-200 mb-2",children:"Custom SQL Query (Super Admin Only)"}),e.jsx("textarea",{value:x,onChange:e=>h(e.target.value),placeholder:"SELECT * FROM user_profiles WHERE...",className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500 font-mono text-sm",rows:4})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-center sm:justify-start",children:[e.jsxs(d,{onClick:async()=>{if("super_admin"!==s?.role&&x.trim()){const e=["DROP","DELETE","ALTER","TRUNCATE","UPDATE"],s=x.toUpperCase();if(e.some(e=>s.includes(e)))return void o({title:"Permission Denied",description:"Your role cannot run destructive/update queries.",variant:"destructive"})}if(x.trim())try{const{data:e,error:s}=await c.rpc("execute_sql",{sql:x});s?o({title:"Query Error",description:s.message,variant:"destructive"}):(l(e),o({title:"Custom query ran!",description:`Found ${e.length} results.`}))}catch(i){o({title:"RPC Error",description:"Ensure execute_sql function exists and is accessible.",variant:"destructive"})}else await _(),o({title:"Query ran!",description:`Found ${r.length} results.`});const e={id:Date.now().toString(),userId:s.id,action:x||`SELECT * FROM ${a}`,timestamp:(new Date).toISOString()},t=JSON.parse(localStorage.getItem("activityLogs")||"[]");t.push(e),localStorage.setItem("activityLogs",JSON.stringify(t))},className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Run Query"]}),e.jsxs(d,{onClick:()=>{const e=prompt("Enter a name for this query:");if(!e)return;const s={id:Date.now().toString(),name:e,table:a,filters:{...u},query:x,createdAt:(new Date).toISOString()},t=[...n,s];m(t),localStorage.setItem("savedQueries",JSON.stringify(t)),o({title:"Query saved! ðŸ’¾",description:`"${e}" has been saved`})},className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Save Query"]}),e.jsxs(d,{onClick:()=>{const e=C(r),s=new Blob([e],{type:"text/csv"}),t=window.URL.createObjectURL(s),i=document.createElement("a");i.href=t,i.download=`${a}_export_${Date.now()}.csv`,i.click(),o({title:"Export successful! ðŸ“¥",description:"Data has been downloaded as CSV"})},disabled:!r||0===r.length,className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Export CSV"]})]})]})]}),e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"glass-effect rounded-xl p-6 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4",children:["Query Results (",r?.length||0,")"]}),e.jsx("div",{className:"overflow-x-auto max-h-96",children:r&&0!==r.length?e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-white/10",children:Object.keys(r[0]).map(s=>e.jsx("th",{className:"text-left p-3 text-purple-300 font-semibold sticky top-0 bg-indigo-900/50 backdrop-blur-sm",children:s},s))})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:r.map((s,a)=>e.jsx("tr",{className:"hover:bg-white/5",children:Object.keys(r[0]).map(a=>e.jsx("td",{className:"p-3 text-white truncate max-w-xs",children:"object"==typeof s[a]?JSON.stringify(s[a]):String(s[a])},a))},a))})]}):e.jsx("p",{className:"text-purple-300 text-center py-8",children:"No results to display. Run a query to see data."})})]})]})]})},ga=({user:s})=>{const[a,t]=i.useState({totalUsers:0,activeUsers:0,totalWorkouts:0,totalMeals:0}),[r,l]=i.useState([]);i.useEffect(()=>{(async()=>{const{data:e,count:s,error:a}=await c.from("user_profiles").select("*",{count:"exact"});e&&t(a=>({...a,totalUsers:s,activeUsers:e.filter(e=>e.is_active).length}))})(),(async()=>{const e=JSON.parse(localStorage.getItem("activityLogs")||"[]");l(e)})()},[]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl lg:text-2xl font-bold",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary mt-1",children:"Monitor platform performance and user metrics"})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"glass-effect rounded-xl p-4 sm:p-6 shadow-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary",children:"Total Users"}),e.jsx("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold",children:a.totalUsers})]}),e.jsx(F,{className:"w-8 h-8"})]})}),e.jsx(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"glass-effect rounded-xl p-4 sm:p-6 shadow-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary",children:"Active Users"}),e.jsx("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold",children:a.activeUsers})]}),e.jsx(E,{className:"w-8 h-8"})]})}),e.jsx(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"glass-effect rounded-xl p-4 sm:p-6 shadow-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary",children:"Total Workouts"}),e.jsx("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold",children:a.totalWorkouts})]}),e.jsx($,{className:"w-8 h-8"})]})}),e.jsx(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"glass-effect rounded-xl p-4 sm:p-6 shadow-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary",children:"Total Meals Logged"}),e.jsx("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold",children:a.totalMeals})]}),e.jsx(L,{className:"w-8 h-8"})]})})]}),e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"glass-effect rounded-xl p-4 sm:p-5 lg:p-6 shadow-xl",children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold mb-4 sm:mb-6",children:"User Growth"}),e.jsx("div",{className:"h-64 flex items-end justify-between gap-4",children:[{month:"Jan",users:12},{month:"Feb",users:19},{month:"Mar",users:25},{month:"Apr",users:32},{month:"May",users:41},{month:"Jun",users:48}].map((s,a)=>e.jsxs(I.div,{initial:{height:0},animate:{height:s.users/50*100+"%"},transition:{duration:.5,delay:.5+.1*a},className:"flex-1 bg-gradient-to-t from-purple-500 to-indigo-500 rounded-t-lg relative group",children:[e.jsxs("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity bg-white/10 px-2 py-1 rounded text-xs whitespace-nowrap",children:[s.users," users"]}),e.jsx("div",{className:"absolute -bottom-6 left-1/2 -translate-x-1/2 text-xs text-text-secondary",children:s.month})]},s.month))})]}),e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"glass-effect rounded-xl p-4 sm:p-5 lg:p-6 shadow-xl",children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold mb-4",children:"Recent Activity Logs"}),e.jsxs("div",{className:"space-y-2",children:[r.slice(-5).reverse().map(s=>e.jsxs("div",{className:"p-3 bg-white/5 rounded-lg border border-white/10",children:[e.jsx("p",{className:"text-sm text-white font-mono",children:s.action}),e.jsxs("p",{className:"text-xs text-purple-400 mt-1",children:[new Date(s.timestamp).toLocaleString()," - User ID: ",s.userId]})]},s.id)),0===r.length&&e.jsx("p",{className:"text-text-secondary text-center py-4",children:"No activity logs yet"})]})]})]})},ja=[...["AI Personalized Plan","Basic Progress Tracking","Community Access","Smart Meal Logging","Workout Library & Planner","Adaptive Goal Setting","Lifestyle Habit Coaching","Recipe & Meal Suggestions"],...["All Base Features","Macronutrient Tracking","Wearable Device Sync","Custom Workout Builder","Advanced Analytics","Weekly & Monthly Reports","Priority Nutritionist Chat","Sleep Cycle Analysis","Grocery List Generator"],...["All Premium Features","Real-time Form Feedback","Biomarker Integration","1-on-1 Video Coaching (2/month)","Exclusive Challenges","Custom Meal Plans","Performance Optimization","Advanced Body Composition Analysis"],...["All Ultimate Features","Photo Food Recognition","Priority Support (24/7)","Doctor Consultations (2/month)","Unlimited Video Coaching","Personalized Supplement Plan","VIP Community Access","Concierge Service"]].filter((e,s,a)=>a.indexOf(e)===s),fa=({open:s,onOpenChange:a,onPlanAdded:t,editPlan:r=null})=>{const[l,n]=i.useState({name:"",description:"",price_monthly:"",price_yearly:"",is_popular:!1,is_active:!0,stripe_price_id:"",stripe_product_id:""}),[u,p]=i.useState([{type:"predefined",value:""}]),[g,j]=i.useState(!1);i.useEffect(()=>{if(r){n({name:r.name||"",description:r.description||"",price_monthly:r.price_monthly||"",price_yearly:r.price_yearly||"",is_popular:r.is_popular||!1,is_active:!1!==r.is_active,stripe_price_id:r.stripe_price_id||"",stripe_product_id:r.stripe_product_id||""});const e=r.features?.length>0?r.features.map(e=>({type:"predefined",value:e})):[{type:"predefined",value:""}];p(e)}else n({name:"",description:"",price_monthly:"",price_yearly:"",is_popular:!1,is_active:!0,stripe_price_id:"",stripe_product_id:""}),p([{type:"predefined",value:""}])},[r,s]);const f=e=>{const{name:s,value:a}=e.target;n(e=>({...e,[s]:a}))},v=(e,s)=>{n(a=>({...a,[e]:s}))},y=(e,s)=>{const a=[...u];a[e]={...a[e],value:s},p(a)},N=(e="predefined")=>{p([...u,{type:e,value:""}])};return e.jsx(as,{open:s,onOpenChange:a,children:e.jsxs(ts,{className:"glass-effect custom-scrollbar max-w-[95vw] sm:max-w-2xl lg:max-w-4xl xl:max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(rs,{children:[e.jsx(is,{className:"text-base sm:text-lg lg:text-xl",children:r?"Edit Plan":"Add New Subscription Plan"}),e.jsx(ls,{className:"text-sm",children:r?"Update the subscription plan details below.":"Create a new subscription plan for your customers."})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),j(!0);try{const e=u.map(e=>e.value).filter(e=>""!==e.trim());if(!l.name||!l.description||!l.price_monthly)return o({title:"Validation Error",description:"Please fill in all required fields (Name, Description, Monthly Price)",variant:"destructive"}),void j(!1);if(0===e.length)return o({title:"Validation Error",description:"Please add at least one feature",variant:"destructive"}),void j(!1);const s={name:l.name,description:l.description,price_monthly:parseFloat(l.price_monthly),price_yearly:l.price_yearly?parseFloat(l.price_yearly):null,features:e,is_popular:l.is_popular,is_active:l.is_active,stripe_price_id:l.stripe_price_id||null,stripe_product_id:l.stripe_product_id||null};let i;if(i=r?await c.from("subscription_plans").update(s).eq("id",r.id).select().single():await c.from("subscription_plans").insert([s]).select().single(),i.error)throw i.error;o({title:r?"Plan Updated!":"Plan Created!",description:`${l.name} has been ${r?"updated":"created"} successfully.`}),t(),a(!1)}catch(s){console.error("Error saving plan:",s),o({title:"Error",description:s.message||"Failed to save plan",variant:"destructive"})}finally{j(!1)}},className:"space-y-6 min-w-0 max-w-full",children:[e.jsxs("div",{className:"space-y-4 min-w-0",children:[e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsx(m,{htmlFor:"name",className:"text-sm",children:"Plan Name *"}),e.jsx(x,{id:"name",name:"name",value:l.name,onChange:f,placeholder:"e.g., Premium, Ultimate, Elite",className:"w-full min-w-0 text-base",style:{fontSize:"16px"},required:!0})]}),e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsx(m,{htmlFor:"description",className:"text-sm",children:"Description *"}),e.jsx(h,{id:"description",name:"description",value:l.description,onChange:f,placeholder:"Brief description of the plan",className:"w-full min-w-0 resize-none text-base",style:{fontSize:"16px"},rows:3,required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 min-w-0",children:[e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsx(m,{htmlFor:"price_monthly",className:"text-sm",children:"Monthly Price ($) *"}),e.jsx(x,{id:"price_monthly",name:"price_monthly",type:"number",step:"0.01",min:"0",value:l.price_monthly,onChange:f,placeholder:"9.99",className:"w-full min-w-0 text-base",style:{fontSize:"16px"},required:!0})]}),e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsx(m,{htmlFor:"price_yearly",className:"text-sm",children:"Yearly Price ($)"}),e.jsx(x,{id:"price_yearly",name:"price_yearly",type:"number",step:"0.01",min:"0",value:l.price_yearly,onChange:f,placeholder:"99.00",className:"w-full min-w-0 text-base",style:{fontSize:"16px"}})]})]}),e.jsxs("div",{className:"space-y-3 min-w-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2",children:[e.jsx(m,{className:"text-sm",children:"Features *"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(d,{type:"button",onClick:()=>N("predefined"),size:"sm",variant:"outline",className:"h-8 text-xs",children:[e.jsx(K,{className:"w-3 h-3 mr-1"}),"Add from List"]}),e.jsxs(d,{type:"button",onClick:()=>N("custom"),size:"sm",variant:"outline",className:"h-8 text-xs",children:[e.jsx(K,{className:"w-3 h-3 mr-1"}),"Custom Feature"]})]})]}),e.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto pr-2 min-w-0",children:u.map((s,a)=>e.jsxs("div",{className:"flex gap-2 items-start p-3 border border-green-500/30 rounded-lg bg-background/50 min-w-0",children:[e.jsxs("div",{className:"flex-grow space-y-2 min-w-0",children:["predefined"===s.type?e.jsxs(ds,{value:s.value,onValueChange:e=>y(a,e),children:[e.jsx(ms,{className:"w-full min-w-0 text-base",children:e.jsx(xs,{placeholder:"Select a feature..."})}),e.jsxs(hs,{className:"glass-effect max-h-[300px] max-w-[90vw]",children:[e.jsx(us,{value:"All Base Features",children:"All Base Features"}),e.jsx(us,{value:"All Premium Features",children:"All Premium Features"}),e.jsx(us,{value:"All Ultimate Features",children:"All Ultimate Features"}),ja.map(s=>e.jsx(us,{value:s,children:s},s))]})]}):e.jsx(x,{value:s.value,onChange:e=>y(a,e.target.value),placeholder:"Enter custom feature...",className:"w-full min-w-0 text-base",style:{fontSize:"16px"}}),e.jsx(d,{type:"button",onClick:()=>((e,s)=>{const a=[...u];a[e]={type:s,value:""},p(a)})(a,"predefined"===s.type?"custom":"predefined"),size:"sm",variant:"ghost",className:"text-xs h-6 px-2",children:"predefined"===s.type?"Switch to Custom":"Switch to List"})]}),u.length>1&&e.jsx(d,{type:"button",onClick:()=>(e=>{u.length>1&&p(u.filter((s,a)=>a!==e))})(a),variant:"ghost",size:"icon",className:"mt-1 flex-shrink-0 h-8 w-8",children:e.jsx(X,{className:"w-4 h-4"})})]},a))})]}),e.jsxs("div",{className:"space-y-4 border-t pt-4 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Stripe Integration (Optional)"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 min-w-0",children:[e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsx(m,{htmlFor:"stripe_price_id",className:"text-sm",children:"Stripe Price ID"}),e.jsx(x,{id:"stripe_price_id",name:"stripe_price_id",value:l.stripe_price_id,onChange:f,placeholder:"price_xxxxx",className:"w-full min-w-0 text-base",style:{fontSize:"16px"}})]}),e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsx(m,{htmlFor:"stripe_product_id",className:"text-sm",children:"Stripe Product ID"}),e.jsx(x,{id:"stripe_product_id",name:"stripe_product_id",value:l.stripe_product_id,onChange:f,placeholder:"prod_xxxxx",className:"w-full min-w-0 text-base",style:{fontSize:"16px"}})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t pt-4 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(os,{id:"is_popular",checked:l.is_popular,onCheckedChange:e=>v("is_popular",e),className:"mt-1"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(m,{htmlFor:"is_popular",className:"text-sm",children:"Mark as Popular"}),e.jsx("p",{className:"text-xs text-text-secondary",children:'Display a "Most Popular" badge'})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(os,{id:"is_active",checked:l.is_active,onCheckedChange:e=>v("is_active",e),className:"mt-1"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(m,{htmlFor:"is_active",className:"text-sm",children:"Active"}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Make this plan available to customers"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap justify-end gap-2 sm:gap-3 pt-4 border-t",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>a(!1),size:"sm",className:"h-9 px-3",children:"Cancel"}),e.jsx(d,{type:"submit",disabled:g,size:"sm",className:"h-9 px-3",children:g?"Saving...":r?"Update Plan":"Create Plan"})]})]})]})})},va=()=>{const[s,a]=i.useState([]),[t,r]=i.useState(!0),[l,n]=i.useState(!1),[m,x]=i.useState(null),[h,u]=i.useState({totalActive:0,newThisMonth:0,canceledThisMonth:0,upgrades:0,downgrades:0,trialConversions:0,paymentFailures:0});i.useEffect(()=>{(async()=>{r(!0);const{data:e,error:s}=await c.from("subscription_plans").select("*").order("price_monthly",{ascending:!0});s?o({title:"Error fetching plans",description:s.message,variant:"destructive"}):a(e),r(!1)})(),(async()=>{const e=new Date,s=new Date(e.getFullYear(),e.getMonth(),1),{data:a}=await c.from("user_subscriptions").select("*").eq("status","active"),{data:t}=await c.from("user_subscriptions").select("*").gte("created_at",s.toISOString()),{data:r}=await c.from("user_subscriptions").select("*").eq("status","canceled").gte("canceled_at",s.toISOString()),{data:i}=await c.from("payment_transactions").select("*").eq("status","failed").gte("created_at",s.toISOString());u({totalActive:a?.length||0,newThisMonth:t?.length||0,canceledThisMonth:r?.length||0,upgrades:0,downgrades:0,trialConversions:0,paymentFailures:i?.length||0})})()},[]);const p={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},g={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}};return e.jsxs(I.div,{variants:p,initial:"hidden",animate:"visible",className:"space-y-6",children:[e.jsxs(I.div,{variants:g,className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl lg:text-2xl font-bold",children:"Subscription Plans"}),e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary mt-1",children:"Manage subscription tiers and pricing"})]}),e.jsx("div",{className:"flex gap-2 ml-auto",children:e.jsxs(d,{onClick:()=>{x(null),n(!0)},size:"sm",className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Add New Plan"]})})]}),e.jsxs(I.div,{variants:g,className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary",children:"Active Subscriptions"}),e.jsx("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold",children:h.totalActive})]}),e.jsx(F,{className:"w-8 h-8 text-primary"})]})})}),e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary",children:"New This Month"}),e.jsx("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-green-400",children:h.newThisMonth})]}),e.jsx($,{className:"w-8 h-8 text-green-400"})]})})}),e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary",children:"Canceled This Month"}),e.jsx("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-red-400",children:h.canceledThisMonth})]}),e.jsx(Z,{className:"w-8 h-8 text-red-400"})]})})}),e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary",children:"Payment Failures"}),e.jsx("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-orange-400",children:h.paymentFailures})]}),e.jsx(ee,{className:"w-8 h-8 text-orange-400"})]})})})]}),t?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[...Array(4)].map((s,a)=>e.jsxs(_,{className:"glass-effect animate-pulse",children:[e.jsx(k,{children:e.jsx("div",{className:"h-8 bg-white/10 rounded w-3/4"})}),e.jsxs(C,{className:"space-y-4",children:[e.jsx("div",{className:"h-6 bg-white/10 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-white/10 rounded w-full"}),e.jsx("div",{className:"h-4 bg-white/10 rounded w-3/4"}),e.jsx("div",{className:"h-10 bg-white/10 rounded w-1/3 mt-4"})]})]},a))}):e.jsx(I.div,{variants:p,className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4",children:s.map(s=>{return e.jsx(I.div,{variants:g,children:e.jsxs(_,{className:"glass-effect h-full flex flex-col "+(s.is_popular?"border-purple-500 border-2":""),children:[s.is_popular&&e.jsx("div",{className:"text-center py-1 bg-purple-500 text-white font-bold text-sm",children:"Most Popular"}),e.jsx(k,{children:e.jsxs(S,{className:"flex items-center gap-3",children:[(a=s.name,a.toLowerCase().includes("pro")?e.jsx(se,{className:"w-6 h-6 text-yellow-400"}):a.toLowerCase().includes("enterprise")?e.jsx(ae,{className:"w-6 h-6 text-purple-400"}):e.jsx(te,{className:"w-6 h-6 text-green-400"})),e.jsx("span",{className:"text-2xl",children:s.name})]})}),e.jsxs(C,{className:"flex-grow flex flex-col",children:[e.jsxs("p",{className:"text-4xl font-bold mb-2",children:["$",s.price_monthly,e.jsx("span",{className:"text-lg font-normal text-text-secondary",children:"/month"})]}),e.jsx("p",{className:"text-text-secondary mb-4",children:s.description}),e.jsx("ul",{className:"space-y-2 mb-6 flex-grow",children:s.features?.map((s,a)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(se,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{children:s})]},a))}),e.jsx(d,{onClick:()=>(e=>{x(e),n(!0)})(s),variant:"secondary",children:"Edit Plan"})]})]})},s.id);var a})}),e.jsx(fa,{open:l,onOpenChange:n,onPlanAdded:async()=>{const{data:e,error:s}=await c.from("subscription_plans").select("*").order("price_monthly",{ascending:!0});s?o({title:"Error fetching plans",description:s.message,variant:"destructive"}):a(e)},editPlan:m})]})},ya=({isOpen:s,onClose:a,user:t,onOfferCreated:r})=>{const[l,n]=i.useState(!1),[u,p]=i.useState(null),[g,j]=i.useState({customPrice:"",discountPercentage:"",discountAmount:"",couponCode:"",subscriptionType:"premium",billingCycle:"monthly",trialDays:"0",features:{aiPersonalizedPlan:!0,basicProgressTracking:!0,communityAccess:!0,smartMealLogging:!0,workoutLibrary:!0,adaptiveGoalSetting:!0,lifestyleHabitCoaching:!0,recipeMealSuggestions:!0,macronutrientTracking:!1,wearableDeviceSync:!1,customWorkoutBuilder:!1,advancedAnalytics:!1,weeklyMonthlyReports:!1,priorityNutritionistChat:!1,sleepCycleAnalysis:!1,groceryListGenerator:!1,realtimeFormFeedback:!1,biomarkerIntegration:!1,oneOnOneVideoCoaching:!1,exclusiveChallenges:!1,photoFoodRecognition:!1,prioritySupport:!1,doctorConsultations:!1},featureLimits:{aiMessages:"100",workouts:"50",videoCoachingSessions:"0",doctorConsultations:"0"},hasPrioritySupport:!1,hasBetaAccess:!1,removeBranding:!1,notes:"",internalNotes:"",offerEndDate:"",paymentPlanType:"full",numberOfPayments:"2",paymentFrequency:"monthly"});i.useEffect(()=>{s&&t&&f()},[s,t]);const f=async()=>{const{data:e,error:s}=await c.from("custom_offers").select("*").eq("user_id",t.id).eq("is_active",!0).single();e&&(p(e),j({customPrice:e.custom_price||"",discountPercentage:e.discount_percentage||"",discountAmount:e.discount_amount||"",couponCode:e.coupon_code||"",subscriptionType:e.subscription_type||"premium",billingCycle:e.billing_cycle||"monthly",trialDays:e.trial_days||"0",features:e.features||g.features,featureLimits:e.feature_limits||g.featureLimits,hasPrioritySupport:e.has_priority_support||!1,hasBetaAccess:e.has_beta_access||!1,removeBranding:e.remove_branding||!1,notes:e.notes||"",internalNotes:e.internal_notes||"",offerEndDate:e.offer_end_date?new Date(e.offer_end_date).toISOString().split("T")[0]:"",paymentPlanType:e.payment_plan_type||"full",numberOfPayments:e.number_of_payments||"2",paymentFrequency:e.payment_frequency||"monthly"}))};return e.jsx(as,{open:s,onOpenChange:a,children:e.jsxs(ts,{className:"glass-effect custom-scrollbar max-w-[95vw] sm:max-w-4xl lg:max-w-5xl xl:max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsx(rs,{children:e.jsx(is,{className:"text-base sm:text-lg lg:text-xl",children:t?.bulk?`Create Bulk Offer for ${t.users?.length} Customers`:`${u?"Edit":"Create"} Custom Offer for ${t?.full_name}`})}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),n(!0);const s={custom_price:g.customPrice?parseFloat(g.customPrice):null,discount_percentage:g.discountPercentage?parseInt(g.discountPercentage):null,discount_amount:g.discountAmount?parseFloat(g.discountAmount):null,coupon_code:g.couponCode||null,subscription_type:g.subscriptionType,billing_cycle:g.billingCycle,trial_days:parseInt(g.trialDays),features:g.features,feature_limits:{aiMessages:parseInt(g.featureLimits.aiMessages),workouts:parseInt(g.featureLimits.workouts),videoCoachingSessions:parseInt(g.featureLimits.videoCoachingSessions),doctorConsultations:parseInt(g.featureLimits.doctorConsultations)},has_priority_support:g.hasPrioritySupport,has_beta_access:g.hasBetaAccess,remove_branding:g.removeBranding,notes:g.notes,internal_notes:g.internalNotes,offer_end_date:g.offerEndDate||null,payment_plan_type:g.paymentPlanType,number_of_payments:"full"!==g.paymentPlanType?parseInt(g.numberOfPayments):null,payment_frequency:"full"!==g.paymentPlanType?g.paymentFrequency:null,is_active:!0};let i;if(t?.bulk&&t?.users){const e=t.users.map(e=>({...s,user_id:e.id}));i=(await c.from("custom_offers").insert(e)).error,i||o({title:`Bulk offer created for ${t.users.length} customers!`})}else{const e={...s,user_id:t.id};if(u){i=(await c.from("custom_offers").update(e).eq("id",u.id)).error}else{i=(await c.from("custom_offers").insert(e)).error}i||o({title:"Custom offer saved successfully!"})}i?o({title:"Error saving offer",description:i.message,variant:"destructive"}):(r&&r(),a()),n(!1)},className:"space-y-6 lg:space-y-8 min-w-0 max-w-full",children:[e.jsxs("div",{className:"space-y-4 lg:space-y-5 min-w-0",children:[e.jsxs("h3",{className:"text-base sm:text-lg lg:text-xl font-semibold flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4 sm:w-5 sm:h-5 text-primary"}),"Pricing"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 min-w-0",children:[e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsx(m,{className:"text-sm",children:"Custom Price ($)"}),e.jsx(x,{type:"number",step:"0.01",value:g.customPrice,onChange:e=>j({...g,customPrice:e.target.value}),placeholder:"29.99",className:"glass-effect w-full min-w-0 text-base",style:{fontSize:"16px"}})]}),e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsx(m,{className:"text-sm",children:"Discount (%)"}),e.jsx(x,{type:"number",value:g.discountPercentage,onChange:e=>j({...g,discountPercentage:e.target.value}),placeholder:"20",className:"glass-effect w-full min-w-0 text-base",style:{fontSize:"16px"}})]}),e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsx(m,{className:"text-sm",children:"Discount Amount ($)"}),e.jsx(x,{type:"number",step:"0.01",value:g.discountAmount,onChange:e=>j({...g,discountAmount:e.target.value}),placeholder:"5.00",className:"glass-effect w-full min-w-0 text-base",style:{fontSize:"16px"}})]}),e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsx(m,{className:"text-sm",children:"Coupon Code (Optional)"}),e.jsx(x,{type:"text",value:g.couponCode,onChange:e=>j({...g,couponCode:e.target.value.toUpperCase()}),placeholder:"SUMMER2024",className:"glass-effect w-full min-w-0 text-base",style:{fontSize:"16px"}})]})]})]}),e.jsxs("div",{className:"space-y-4 lg:space-y-5 min-w-0",children:[e.jsxs("h3",{className:"text-base sm:text-lg lg:text-xl font-semibold flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 sm:w-5 sm:h-5 text-primary"}),"Subscription Details"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 min-w-0",children:[e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsx(m,{className:"text-sm",children:"Subscription Type"}),e.jsxs(ds,{value:g.subscriptionType,onValueChange:e=>j({...g,subscriptionType:e}),children:[e.jsx(ms,{className:"glass-effect w-full min-w-0 text-base",children:e.jsx(xs,{})}),e.jsxs(hs,{className:"glass-effect max-w-[90vw]",children:[e.jsx(us,{value:"premium",children:"Premium"}),e.jsx(us,{value:"pro",children:"Pro"}),e.jsx(us,{value:"elite",children:"Elite"}),e.jsx(us,{value:"custom",children:"Custom"})]})]})]}),e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsx(m,{className:"text-sm",children:"Billing Cycle"}),e.jsxs(ds,{value:g.billingCycle,onValueChange:e=>j({...g,billingCycle:e}),children:[e.jsx(ms,{className:"glass-effect w-full min-w-0 text-base",children:e.jsx(xs,{})}),e.jsxs(hs,{className:"glass-effect max-w-[90vw]",children:[e.jsx(us,{value:"monthly",children:"Monthly"}),e.jsx(us,{value:"quarterly",children:"Quarterly"}),e.jsx(us,{value:"annual",children:"Annual"}),e.jsx(us,{value:"lifetime",children:"Lifetime"})]})]})]}),e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsx(m,{className:"text-sm",children:"Trial Days"}),e.jsx(x,{type:"number",value:g.trialDays,onChange:e=>j({...g,trialDays:e.target.value}),className:"glass-effect w-full min-w-0 text-base",style:{fontSize:"16px"}})]})]}),e.jsxs("div",{className:"space-y-2 min-w-0 w-full",children:[e.jsx(m,{className:"text-sm",children:"Offer End Date (Optional)"}),e.jsx(x,{type:"date",value:g.offerEndDate,onChange:e=>j({...g,offerEndDate:e.target.value}),className:"glass-effect w-full min-w-0 text-base",style:{fontSize:"16px"}})]})]}),e.jsxs("div",{className:"space-y-4 lg:space-y-5",children:[e.jsxs("h3",{className:"text-lg lg:text-xl xl:text-2xl font-semibold flex items-center gap-2 lg:gap-3",children:[e.jsx(re,{className:"w-5 h-5 lg:w-6 lg:h-6 text-primary"}),"Features & Limits"]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6 lg:gap-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{className:"text-base font-semibold text-primary",children:"Base Features"}),e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.features.aiPersonalizedPlan,onCheckedChange:e=>j({...g,features:{...g.features,aiPersonalizedPlan:e}})}),e.jsx(m,{className:"cursor-pointer",children:"AI Personalized Plan"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.features.basicProgressTracking,onCheckedChange:e=>j({...g,features:{...g.features,basicProgressTracking:e}})}),e.jsx(m,{className:"cursor-pointer",children:"Basic Progress Tracking"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.features.communityAccess,onCheckedChange:e=>j({...g,features:{...g.features,communityAccess:e}})}),e.jsx(m,{className:"cursor-pointer",children:"Community Access"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.features.smartMealLogging,onCheckedChange:e=>j({...g,features:{...g.features,smartMealLogging:e}})}),e.jsx(m,{className:"cursor-pointer",children:"Smart Meal Logging"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.features.workoutLibrary,onCheckedChange:e=>j({...g,features:{...g.features,workoutLibrary:e}})}),e.jsx(m,{className:"cursor-pointer",children:"Workout Library & Planner"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.features.adaptiveGoalSetting,onCheckedChange:e=>j({...g,features:{...g.features,adaptiveGoalSetting:e}})}),e.jsx(m,{className:"cursor-pointer",children:"Adaptive Goal Setting"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.features.lifestyleHabitCoaching,onCheckedChange:e=>j({...g,features:{...g.features,lifestyleHabitCoaching:e}})}),e.jsx(m,{className:"cursor-pointer",children:"Lifestyle Habit Coaching"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.features.recipeMealSuggestions,onCheckedChange:e=>j({...g,features:{...g.features,recipeMealSuggestions:e}})}),e.jsx(m,{className:"cursor-pointer",children:"Recipe & Meal Suggestions"})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{className:"text-base font-semibold text-green-400",children:"Premium Features"}),e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.features.macronutrientTracking,onCheckedChange:e=>j({...g,features:{...g.features,macronutrientTracking:e}})}),e.jsx(m,{className:"cursor-pointer",children:"Macronutrient Tracking"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.features.wearableDeviceSync,onCheckedChange:e=>j({...g,features:{...g.features,wearableDeviceSync:e}})}),e.jsx(m,{className:"cursor-pointer",children:"Wearable Device Sync"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.features.customWorkoutBuilder,onCheckedChange:e=>j({...g,features:{...g.features,customWorkoutBuilder:e}})}),e.jsx(m,{className:"cursor-pointer",children:"Custom Workout Builder"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.features.advancedAnalytics,onCheckedChange:e=>j({...g,features:{...g.features,advancedAnalytics:e}})}),e.jsx(m,{className:"cursor-pointer",children:"Advanced Analytics"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.features.weeklyMonthlyReports,onCheckedChange:e=>j({...g,features:{...g.features,weeklyMonthlyReports:e}})}),e.jsx(m,{className:"cursor-pointer",children:"Weekly & Monthly Reports"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.features.priorityNutritionistChat,onCheckedChange:e=>j({...g,features:{...g.features,priorityNutritionistChat:e}})}),e.jsx(m,{className:"cursor-pointer",children:"Priority Nutritionist Chat"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.features.sleepCycleAnalysis,onCheckedChange:e=>j({...g,features:{...g.features,sleepCycleAnalysis:e}})}),e.jsx(m,{className:"cursor-pointer",children:"Sleep Cycle Analysis"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.features.groceryListGenerator,onCheckedChange:e=>j({...g,features:{...g.features,groceryListGenerator:e}})}),e.jsx(m,{className:"cursor-pointer",children:"Grocery List Generator"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{className:"text-base font-semibold text-blue-400",children:"Ultimate Features"}),e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.features.realtimeFormFeedback,onCheckedChange:e=>j({...g,features:{...g.features,realtimeFormFeedback:e}})}),e.jsx(m,{className:"cursor-pointer",children:"Real-time Form Feedback"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.features.biomarkerIntegration,onCheckedChange:e=>j({...g,features:{...g.features,biomarkerIntegration:e}})}),e.jsx(m,{className:"cursor-pointer",children:"Biomarker Integration"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.features.oneOnOneVideoCoaching,onCheckedChange:e=>j({...g,features:{...g.features,oneOnOneVideoCoaching:e}})}),e.jsx(m,{className:"cursor-pointer",children:"1-on-1 Video Coaching"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.features.exclusiveChallenges,onCheckedChange:e=>j({...g,features:{...g.features,exclusiveChallenges:e}})}),e.jsx(m,{className:"cursor-pointer",children:"Exclusive Challenges"})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{className:"text-base font-semibold text-purple-400",children:"Elite Features"}),e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.features.photoFoodRecognition,onCheckedChange:e=>j({...g,features:{...g.features,photoFoodRecognition:e}})}),e.jsx(m,{className:"cursor-pointer",children:"Photo Food Recognition"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.features.prioritySupport,onCheckedChange:e=>j({...g,features:{...g.features,prioritySupport:e}})}),e.jsx(m,{className:"cursor-pointer",children:"Priority Support"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.features.doctorConsultations,onCheckedChange:e=>j({...g,features:{...g.features,doctorConsultations:e}})}),e.jsx(m,{className:"cursor-pointer",children:"Doctor Consultations"})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{className:"text-base font-semibold",children:"Feature Limits"}),e.jsxs("div",{className:"space-y-3 mt-2",children:[e.jsxs("div",{children:[e.jsx(m,{className:"text-sm",children:"AI Messages Limit"}),e.jsx(x,{type:"number",value:g.featureLimits.aiMessages,onChange:e=>j({...g,featureLimits:{...g.featureLimits,aiMessages:e.target.value}}),className:"glass-effect"})]}),e.jsxs("div",{children:[e.jsx(m,{className:"text-sm",children:"Workouts Limit"}),e.jsx(x,{type:"number",value:g.featureLimits.workouts,onChange:e=>j({...g,featureLimits:{...g.featureLimits,workouts:e.target.value}}),className:"glass-effect"})]}),e.jsxs("div",{children:[e.jsx(m,{className:"text-sm",children:"Video Coaching Sessions"}),e.jsx(x,{type:"number",value:g.featureLimits.videoCoachingSessions,onChange:e=>j({...g,featureLimits:{...g.featureLimits,videoCoachingSessions:e.target.value}}),className:"glass-effect"})]}),e.jsxs("div",{children:[e.jsx(m,{className:"text-sm",children:"Doctor Consultations"}),e.jsx(x,{type:"number",value:g.featureLimits.doctorConsultations,onChange:e=>j({...g,featureLimits:{...g.featureLimits,doctorConsultations:e.target.value}}),className:"glass-effect"})]})]})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{children:"Special Perks"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.hasPrioritySupport,onCheckedChange:e=>j({...g,hasPrioritySupport:e})}),e.jsx(m,{className:"cursor-pointer",children:"Priority Support"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.hasBetaAccess,onCheckedChange:e=>j({...g,hasBetaAccess:e})}),e.jsx(m,{className:"cursor-pointer",children:"Beta Features Access"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:g.removeBranding,onCheckedChange:e=>j({...g,removeBranding:e})}),e.jsx(m,{className:"cursor-pointer",children:"Remove Branding"})]})]}),e.jsxs("div",{className:"space-y-4 lg:space-y-5 min-w-0",children:[e.jsxs("h3",{className:"text-base sm:text-lg lg:text-xl font-semibold flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4 sm:w-5 sm:h-5 text-primary"}),"Payment Plan"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 min-w-0",children:[e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsx(m,{className:"text-sm",children:"Payment Type"}),e.jsxs(ds,{value:g.paymentPlanType,onValueChange:e=>j({...g,paymentPlanType:e}),children:[e.jsx(ms,{className:"glass-effect w-full min-w-0 text-base",children:e.jsx(xs,{})}),e.jsxs(hs,{className:"glass-effect max-w-[90vw]",children:[e.jsx(us,{value:"full",children:"Full Payment"}),e.jsx(us,{value:"split_payment",children:"Split Payment"}),e.jsx(us,{value:"installment",children:"Installment Plan"}),e.jsx(us,{value:"pay_as_you_go",children:"Pay As You Go"})]})]})]}),"full"!==g.paymentPlanType&&"pay_as_you_go"!==g.paymentPlanType&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsx(m,{className:"text-sm",children:"Number of Payments"}),e.jsx(x,{type:"number",value:g.numberOfPayments,onChange:e=>j({...g,numberOfPayments:e.target.value}),className:"glass-effect w-full min-w-0 text-base",style:{fontSize:"16px"},min:"2"})]}),e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsx(m,{className:"text-sm",children:"Payment Frequency"}),e.jsxs(ds,{value:g.paymentFrequency,onValueChange:e=>j({...g,paymentFrequency:e}),children:[e.jsx(ms,{className:"glass-effect w-full min-w-0 text-base",children:e.jsx(xs,{})}),e.jsxs(hs,{className:"glass-effect max-w-[90vw]",children:[e.jsx(us,{value:"weekly",children:"Weekly"}),e.jsx(us,{value:"biweekly",children:"Bi-weekly"}),e.jsx(us,{value:"monthly",children:"Monthly"})]})]})]})]})]})]}),e.jsxs("div",{className:"space-y-4 min-w-0",children:[e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsx(m,{className:"text-sm",children:"Customer Notes (Visible to customer)"}),e.jsx(h,{value:g.notes,onChange:e=>j({...g,notes:e.target.value}),placeholder:"Special offer for being a loyal customer...",className:"glass-effect w-full min-w-0 resize-none text-base",style:{fontSize:"16px"},rows:3})]}),e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsx(m,{className:"text-sm",children:"Internal Notes (Admin only)"}),e.jsx(h,{value:g.internalNotes,onChange:e=>j({...g,internalNotes:e.target.value}),placeholder:"Notes for internal use...",className:"glass-effect w-full min-w-0 resize-none text-base",style:{fontSize:"16px"},rows:2})]})]}),e.jsxs(ns,{className:"flex flex-wrap gap-2 sm:gap-3",children:[e.jsx(d,{type:"button",variant:"outline",onClick:a,size:"sm",className:"h-9 px-3",children:"Cancel"}),e.jsx(d,{type:"submit",disabled:l,size:"sm",className:"h-9 px-3",children:l?"Saving...":u?"Update Offer":"Create Offer"})]})]})]})})},Na=s,wa=a,ba=i.forwardRef(({className:s,align:a="center",sideOffset:i=4,...l},n)=>e.jsx(t,{children:e.jsx(r,{ref:n,align:a,sideOffset:i,className:u("z-50 w-72 rounded-md border border-border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...l})}));ba.displayName=r.displayName;const _a=["ðŸ‘‹","ðŸ˜Š","ðŸ‘","â¤ï¸","ðŸŽ‰","ðŸ”¥","â­","âœ…","ðŸ’ª","ðŸ™Œ","ðŸ‘","ðŸŽŠ","ðŸ’¯","âœ¨","ðŸš€","ðŸŽ¯","ðŸ˜€","ðŸ˜ƒ","ðŸ˜„","ðŸ˜","ðŸ¤—","ðŸ¥³","ðŸ˜Ž","ðŸ¤©"],Ca=({isOpen:s,onClose:a,customer:t})=>{const{userProfile:r}=p(),[l,n]=i.useState([]),[m,h]=i.useState(""),[u,y]=i.useState(!1),[N,w]=i.useState(!1),b=i.useRef(null);i.useRef(null),i.useEffect(()=>{s&&t&&(_(),k())},[s,t]);i.useEffect(()=>{b.current?.scrollIntoView({behavior:"smooth"})},[l]);const _=async()=>{const{data:e,error:s}=await c.from("messages").select("*").or(`and(sender_id.eq.${r.id},recipient_id.eq.${t.id}),and(sender_id.eq.${t.id},recipient_id.eq.${r.id})`).order("created_at",{ascending:!0});s?s.message.includes("does not exist")||"42P01"===s.code?(o({title:"Chat Feature Not Set Up",description:"The messages table needs to be created in the database.",variant:"default"}),n([])):o({title:"Error loading messages",description:s.message,variant:"destructive"}):(n(e||[]),C())},C=async()=>{await c.from("messages").update({is_read:!0}).eq("recipient_id",r.id).eq("sender_id",t.id).eq("is_read",!1)},k=()=>{const e=c.channel("messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`sender_id=eq.${t.id}`},e=>{n(s=>[...s,e.new]),C()}).subscribe();return()=>{c.removeChannel(e)}},S=async(e,s="text",a={})=>{if(e&&e.preventDefault(),!m.trim()&&"text"===s)return;y(!0);const i={sender_id:r.id,recipient_id:t.id,message_text:m,sender_role:r.role,recipient_role:t.role,message_type:s,is_read:!1,...a},{error:l}=await c.from("messages").insert(i);l?o({title:"Error sending message",description:l.message,variant:"destructive"}):(n(e=>[...e,{...i,id:Date.now(),created_at:(new Date).toISOString()}]),h(""),"offer"===s||o({title:"Message sent",description:`Your message was delivered to ${t.full_name}`,duration:2e3})),y(!1)},A=async e=>{await S(null,"offer",{message_text:{discount_10:"ðŸŽ‰ Special offer for you! Get 10% off your next subscription renewal. Use code: LOYAL10",discount_20:"ðŸ”¥ Exclusive! 20% discount on all premium plans. Code: VIP20",free_month:"ðŸŽ As a valued customer, enjoy 1 month FREE on us! Auto-applied to your account.",upgrade:"â­ Upgrade to Premium and get 2 months for the price of 1!",trial:"âœ¨ Try our Elite plan FREE for 14 days - no credit card required!"}[e],offer_type:e}),o({title:"Offer Sent!",description:"The special offer has been sent to the customer."})},P=e=>{h({welcome:"Hi! ðŸ‘‹ Thanks for reaching out. How can I help you today?",thanks:"Thank you for contacting us! We appreciate your patience. ðŸ™",checking:"Let me check that for you right away... â³",resolved:"Great! I'm glad we could resolve that for you. âœ…",followup:"Is there anything else I can help you with today? ðŸ˜Š"}[e])},F=e=>e?e.split(" ").map(e=>e[0]).join("").toUpperCase():"U",E=s=>s.sender_id!==r.id?null:e.jsx("span",{className:"inline-flex items-center gap-1",children:s.is_read?e.jsx(me,{className:"w-3 h-3 text-blue-400"}):e.jsx(Q,{className:"w-3 h-3 text-text-secondary"})}),T=s=>{const a=s.sender_id===r.id;return"offer"===s.message_type?e.jsxs("div",{className:"p-3 rounded-lg border-2 border-primary/50 "+(a?"bg-primary/20 text-primary-foreground":"bg-primary/10 text-foreground"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx(v,{variant:"secondary",className:"text-xs",children:"Special Offer"})]}),e.jsx("p",{className:"text-sm",children:s.message_text})]}):e.jsx("div",{className:"p-3 rounded-lg "+(a?"bg-primary text-primary-foreground":"bg-muted text-foreground"),children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.message_text})})};return e.jsx(as,{open:s,onOpenChange:a,children:e.jsxs(ts,{className:"glass-effect max-w-md h-[600px] flex flex-col p-0",children:[e.jsx(rs,{className:"p-4 pb-3 border-b border-border",children:e.jsxs(is,{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(g,{className:"w-8 h-8",children:[e.jsx(j,{src:t?.profile_picture_url}),e.jsx(f,{className:"text-xs",children:F(t?.full_name)})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-semibold text-sm truncate",children:t?.full_name}),e.jsx("p",{className:"text-xs text-text-secondary truncate",children:t?.email})]})]}),e.jsxs("div",{className:"flex gap-1 flex-shrink-0",children:[e.jsxs(vs,{children:[e.jsx(ys,{asChild:!0,children:e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(re,{className:"w-4 h-4"})})}),e.jsxs(Ns,{align:"end",className:"glass-effect w-48",children:[e.jsx(ws,{className:"text-xs",children:"Send Offer"}),e.jsx(bs,{}),e.jsxs(_s,{onClick:()=>A("discount_10"),className:"text-xs",children:[e.jsx(te,{className:"w-3 h-3 mr-2"}),"10% Discount"]}),e.jsxs(_s,{onClick:()=>A("discount_20"),className:"text-xs",children:[e.jsx(te,{className:"w-3 h-3 mr-2"}),"20% VIP Discount"]}),e.jsxs(_s,{onClick:()=>A("free_month"),className:"text-xs",children:[e.jsx(re,{className:"w-3 h-3 mr-2"}),"1 Month Free"]}),e.jsxs(_s,{onClick:()=>A("upgrade"),className:"text-xs",children:[e.jsx(v,{className:"w-3 h-3 mr-2"}),"Premium Upgrade"]}),e.jsxs(_s,{onClick:()=>A("trial"),className:"text-xs",children:[e.jsx(ie,{className:"w-3 h-3 mr-2"}),"14-Day Trial"]})]})]}),e.jsxs(vs,{children:[e.jsx(ys,{asChild:!0,children:e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(le,{className:"w-4 h-4"})})}),e.jsxs(Ns,{align:"end",className:"glass-effect w-44",children:[e.jsx(ws,{className:"text-xs",children:"Quick Replies"}),e.jsx(bs,{}),e.jsx(_s,{onClick:()=>P("welcome"),className:"text-xs",children:"ðŸ‘‹ Welcome"}),e.jsx(_s,{onClick:()=>P("thanks"),className:"text-xs",children:"ðŸ™ Thank You"}),e.jsx(_s,{onClick:()=>P("checking"),className:"text-xs",children:"â³ Checking..."}),e.jsx(_s,{onClick:()=>P("resolved"),className:"text-xs",children:"âœ… Resolved"}),e.jsx(_s,{onClick:()=>P("followup"),className:"text-xs",children:"ðŸ˜Š Follow-up"})]})]})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 p-4 bg-muted/10 rounded-lg",children:[0===l.length?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-secondary",children:[e.jsx(ne,{className:"w-16 h-16 mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-semibold",children:"No messages yet"}),e.jsx("p",{className:"text-sm",children:"Start the conversation or send a quick offer!"})]}):l.map(s=>{const a=s.sender_id===r.id;return e.jsxs("div",{className:"flex gap-3 "+(a?"flex-row-reverse":"flex-row"),children:[e.jsx(g,{className:"w-8 h-8 flex-shrink-0",children:a?e.jsxs(e.Fragment,{children:[e.jsx(j,{src:r.profile_picture_url}),e.jsx(f,{className:"text-xs",children:F(r.full_name)})]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{src:t.profile_picture_url}),e.jsx(f,{className:"text-xs",children:F(t.full_name)})]})}),e.jsxs("div",{className:`max-w-[70%] ${a?"items-end":"items-start"} flex flex-col gap-1`,children:[T(s),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-text-secondary",children:new Date(s.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),E(s)]})]})]},s.id)}),e.jsx("div",{ref:b})]}),e.jsxs("form",{onSubmit:S,className:"flex gap-2 p-4 pt-3 border-t border-border",children:[e.jsxs("div",{className:"flex gap-2 flex-1",children:[e.jsxs(Na,{open:N,onOpenChange:w,children:[e.jsx(wa,{asChild:!0,children:e.jsx(d,{type:"button",variant:"ghost",size:"icon",className:"flex-shrink-0",children:e.jsx(ce,{className:"w-5 h-5"})})}),e.jsx(ba,{className:"glass-effect w-80 p-2",align:"start",children:e.jsx("div",{className:"grid grid-cols-8 gap-1",children:_a.map((s,a)=>e.jsx("button",{type:"button",onClick:()=>(e=>{h(s=>s+e),w(!1)})(s),className:"p-2 text-2xl hover:bg-muted rounded transition-colors",children:s},a))})})]}),e.jsx(d,{type:"button",variant:"ghost",size:"icon",className:"flex-shrink-0",onClick:()=>{o({title:"File Upload Coming Soon!",description:"File attachment feature will be available in the next update."})},children:e.jsx(oe,{className:"w-5 h-5"})}),e.jsx(x,{value:m,onChange:e=>h(e.target.value),placeholder:"Type your message...",className:"glass-effect flex-1",disabled:u})]}),e.jsx(d,{type:"submit",disabled:u||!m.trim(),className:"flex-shrink-0",children:e.jsx(de,{className:"w-4 h-4"})})]})]})})},ka=()=>{const[s,a]=i.useState([]),[t,r]=i.useState([]),[l,n]=i.useState([]),[m,h]=i.useState(!0),[u,p]=i.useState(""),[y,N]=i.useState(null),[w,b]=i.useState(!1),[k,S]=i.useState(!1),[A,M]=i.useState(null),[R,q]=i.useState(!1),[z,U]=i.useState(!1),[O,$]=i.useState(null),[G,B]=i.useState([]),[W,H]=i.useState(!1),[Q,Y]=i.useState([]),[X,Z]=i.useState([]),[ee,se]=i.useState(!1),[ae,te]=i.useState(!1),[le,ce]=i.useState({email:"",full_name:"",role:"user"}),[oe,de]=i.useState(!1),[me,be]=i.useState("all"),[_e,Ce]=i.useState("all"),[ke,Se]=i.useState("all"),[Ae,Pe]=i.useState(1),[Fe,Ee]=i.useState({total:0,active:0,withSubscription:0,newThisMonth:0}),Te=async()=>{h(!0);const{data:e,error:s}=await c.from("user_profiles").select("*").order("created_at",{ascending:!1}),{data:t,error:i}=await c.from("subscriptions").select("*");if(i&&"PGRST116"!==i.code&&console.error("Error fetching subscriptions:",i),s)o({title:"Error fetching users",description:s.message,variant:"destructive"});else{a(e||[]),r(t||[]);const s=new Date,i=s.getMonth(),l=s.getFullYear(),n=e?.filter(e=>e.is_active).length||0,c=e?.filter(e=>t?.some(s=>s.user_id===e.id)).length||0,o=e?.filter(e=>{const s=new Date(e.created_at);return s.getMonth()===i&&s.getFullYear()===l}).length||0;Ee({total:e?.length||0,active:n,withSubscription:c,newThisMonth:o})}h(!1)};i.useEffect(()=>{Te()},[]);const Ie=e=>t.find(s=>s.user_id===e);i.useEffect(()=>{let e=s.filter(e=>{const s=(e.full_name?.toLowerCase()||"").includes(u.toLowerCase())||(e.email?.toLowerCase()||"").includes(u.toLowerCase()),a="all"===me||e.role===me,t="all"===ke||"active"===ke&&e.is_active||"inactive"===ke&&!e.is_active,r=Ie(e.id);return s&&a&&t&&("all"===_e||"with"===_e&&r||"without"===_e&&!r)});n(e),Pe(1)},[u,s,t,me,ke,_e]);const Me=e=>e?e.split(" ").map(e=>e[0]).join("").toUpperCase():"U",Re=10*Ae,qe=Re-10,ze=l.slice(qe,Re),Le=Math.ceil(l.length/10),De=async(e,s)=>{const{error:a}=await c.from("user_profiles").update({role:s}).eq("id",e);a?o({title:"Failed to update role",description:a.message,variant:"destructive"}):(o({title:"User role updated successfully!"}),Te())},Ue=async e=>{N(e),b(!0),se(!0);try{const s=await(async(e,s=50)=>{const{data:a,error:t}=await c.from("activity_logs").select("\n      *,\n      user_profiles (full_name, email)\n    ").eq("user_id",e).order("created_at",{ascending:!1}).limit(s);return t?(console.error("Error fetching user activity logs:",t),[]):a||[]})(e.id,20);Y(s);const{data:a}=await c.from("payment_transactions").select("*").eq("user_id",e.id).order("created_at",{ascending:!1}).limit(10);Z(a||[])}catch(s){console.error("Error fetching user details:",s)}finally{se(!1)}},Oe={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}},$e={user:"secondary",nutritionist:"default",admin:"destructive",super_admin:"destructive"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold",children:Fe.total})]}),e.jsx(F,{className:"w-8 h-8 text-primary"})]})})}),e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Active Users"}),e.jsx("p",{className:"text-3xl font-bold text-green-400",children:Fe.active})]}),e.jsx(E,{className:"w-8 h-8 text-green-400"})]})})}),e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"With Subscription"}),e.jsx("p",{className:"text-3xl font-bold text-blue-400",children:Fe.withSubscription})]}),e.jsx(D,{className:"w-8 h-8 text-blue-400"})]})})}),e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"New This Month"}),e.jsx("p",{className:"text-3xl font-bold text-purple-400",children:Fe.newThisMonth})]}),e.jsx(L,{className:"w-8 h-8 text-purple-400"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl lg:text-2xl font-bold",children:"User Management"}),e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary mt-1",children:"Manage platform users and customer relationships"})]}),e.jsxs("div",{className:"flex gap-2 ml-auto",children:[W&&G.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{onClick:()=>{q(!0),$({bulk:!0,users:G})},variant:"default",size:"sm",className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Create Bulk Offer (",G.length,")"]}),e.jsx(d,{onClick:()=>{H(!1),B([])},variant:"outline",size:"sm",className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",children:"Cancel"})]}),!W&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{onClick:()=>H(!0),variant:"outline",size:"sm",className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Bulk Offers"]}),e.jsxs(d,{onClick:()=>{if(0===l.length)return void o({title:"No data to export",variant:"destructive"});const e=l.map(e=>{const s=Ie(e.id);return{Name:e.full_name||"N/A",Email:e.email,Role:e.role,Status:e.is_active?"Active":"Inactive",Subscription:s?s.plan:"None",Joined:new Date(e.created_at).toLocaleDateString()}}),s=[Object.keys(e[0]).join(","),...e.map(e=>Object.values(e).join(","))].join("\n"),a=new Blob([s],{type:"text/csv"}),t=window.URL.createObjectURL(a),r=document.createElement("a");r.href=t,r.download=`users_${Date.now()}.csv`,r.click(),o({title:"Export successful!",description:"User data downloaded as CSV"})},variant:"outline",size:"sm",className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Export CSV"]}),e.jsxs(d,{onClick:()=>te(!0),size:"sm",className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Create User"]})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(x,{placeholder:"Search users by name or email...",value:u,onChange:e=>p(e.target.value),className:"pl-10 glass-effect"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap gap-4",children:[e.jsxs(ds,{value:me,onValueChange:be,children:[e.jsxs(ms,{className:"w-full sm:w-[180px] glass-effect",children:[e.jsx(he,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1.5 sm:mr-2"}),e.jsx(xs,{placeholder:"Filter by role"})]}),e.jsxs(hs,{className:"glass-effect",children:[e.jsx(us,{value:"all",children:"All Roles"}),e.jsx(us,{value:"user",children:"User"}),e.jsx(us,{value:"nutritionist",children:"Nutritionist"}),e.jsx(us,{value:"admin",children:"Admin"}),e.jsx(us,{value:"super_admin",children:"Super Admin"})]})]}),e.jsxs(ds,{value:ke,onValueChange:Se,children:[e.jsxs(ms,{className:"w-full sm:w-[180px] glass-effect",children:[e.jsx(E,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1.5 sm:mr-2"}),e.jsx(xs,{placeholder:"Filter by status"})]}),e.jsxs(hs,{className:"glass-effect",children:[e.jsx(us,{value:"all",children:"All Status"}),e.jsx(us,{value:"active",children:"Active"}),e.jsx(us,{value:"inactive",children:"Inactive"})]})]}),e.jsxs(ds,{value:_e,onValueChange:Ce,children:[e.jsxs(ms,{className:"w-full sm:w-[180px] glass-effect",children:[e.jsx(D,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1.5 sm:mr-2"}),e.jsx(xs,{placeholder:"Filter by subscription"})]}),e.jsxs(hs,{className:"glass-effect",children:[e.jsx(us,{value:"all",children:"All Subscriptions"}),e.jsx(us,{value:"with",children:"With Subscription"}),e.jsx(us,{value:"without",children:"No Subscription"})]})]})]}),e.jsxs("div",{className:"text-sm text-text-secondary",children:["Showing ",ze.length," of ",l.length," users"]}),m?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((s,a)=>e.jsxs("div",{className:"glass-effect p-4 rounded-lg flex items-center gap-4 animate-pulse",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/10"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-white/10 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-white/10 rounded w-1/2"})]})]},a))}):e.jsxs(e.Fragment,{children:[e.jsxs(I.div,{variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},initial:"hidden",animate:"visible",className:"space-y-4",children:[ze.map(s=>{const a=Ie(s.id),t=G.some(e=>e.id===s.id);return e.jsx(I.div,{variants:Oe,children:e.jsx(_,{className:"glass-effect hover:bg-white/10 transition-colors "+(t?"ring-2 ring-primary":""),children:e.jsx(C,{className:"p-3 sm:p-4 lg:p-6",children:e.jsxs("div",{className:"flex items-start sm:items-center gap-2 sm:gap-3 lg:gap-4",children:[W&&e.jsx(os,{checked:t,onCheckedChange:e=>{B(e?[...G,s]:G.filter(e=>e.id!==s.id))}}),e.jsxs(g,{className:"w-10 h-10 sm:w-12 sm:h-12 flex-shrink-0",children:[e.jsx(j,{src:s.profile_picture_url,alt:s.full_name}),e.jsx(f,{className:"text-sm sm:text-base",children:Me(s.full_name)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2 mb-1",children:[e.jsx("p",{className:"font-bold text-sm sm:text-base truncate",children:s.full_name||"N/A"}),s.is_active?e.jsx(ue,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-green-400 flex-shrink-0"}):e.jsx(pe,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-red-400 flex-shrink-0"})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-text-secondary flex items-center gap-1.5 sm:gap-2 truncate",children:[e.jsx(ge,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.email})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-1.5",children:[e.jsx(v,{variant:$e[s.role]||"secondary",className:"capitalize text-xs",children:s.role?.replace("_"," ")}),a&&e.jsxs("p",{className:"text-xs text-primary flex items-center gap-1",children:[e.jsx(D,{className:"w-3 h-3"}),a.plan]})]}),e.jsxs("p",{className:"text-xs text-text-secondary mt-1",children:["Joined ",new Date(s.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-1 sm:gap-2 flex-shrink-0",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>Ue(s),title:"View Details",className:"h-9 w-9 p-0",children:e.jsx(P,{className:"w-4 h-4"})}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>{$(s),U(!0)},title:"Chat with Customer",className:"h-9 w-9 p-0 hidden sm:flex",children:e.jsx(ne,{className:"w-4 h-4"})}),e.jsxs(vs,{children:[e.jsx(ys,{asChild:!0,children:e.jsxs(d,{variant:"ghost",size:"icon",className:"h-9 w-9 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),"â€¢â€¢â€¢"]})}),e.jsxs(Ns,{align:"end",className:"glass-effect",children:[e.jsx(ws,{children:"Actions"}),e.jsx(bs,{}),e.jsxs(_s,{onClick:()=>{$(s),U(!0)},className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4"}),"Chat with Customer"]}),e.jsxs(_s,{onClick:()=>{$(s),q(!0)},className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Create Custom Offer"]}),e.jsx(bs,{}),e.jsx(ws,{children:"Change Role"}),e.jsx(_s,{onClick:()=>De(s.id,"user"),children:"User"}),e.jsx(_s,{onClick:()=>De(s.id,"nutritionist"),children:"Nutritionist"}),e.jsx(_s,{onClick:()=>De(s.id,"admin"),children:"Admin"}),e.jsx(bs,{}),e.jsxs(_s,{onClick:()=>(async(e,s)=>{const{error:a}=await c.from("user_profiles").update({is_active:!s}).eq("id",e);a?o({title:"Failed to update status",description:a.message,variant:"destructive"}):(o({title:s?"User suspended":"User activated"}),Te())})(s.id,s.is_active),className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4"}),s.is_active?"Suspend":"Activate"]}),e.jsxs(_s,{onClick:()=>{M(s),S(!0)},className:"flex items-center gap-2 text-red-400",children:[e.jsx(V,{className:"w-4 h-4"}),"Delete User"]})]})]})]})]})})})},s.id)}),0===l.length&&e.jsx("p",{className:"text-text-secondary text-center py-8",children:"No users found."})]}),Le>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-4 sm:mt-6",children:[e.jsx(d,{variant:"outline",size:"icon",onClick:()=>Pe(e=>Math.max(1,e-1)),disabled:1===Ae,className:"h-9 w-9 p-0",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-sm text-text-secondary px-4",children:["Page ",Ae," of ",Le]}),e.jsx(d,{variant:"outline",size:"icon",onClick:()=>Pe(e=>Math.min(Le,e+1)),disabled:Ae===Le,className:"h-9 w-9 p-0",children:e.jsx(ve,{className:"w-4 h-4"})})]})]}),e.jsx(as,{open:w,onOpenChange:b,children:e.jsxs(ts,{className:"glass-effect max-w-[95vw] sm:max-w-2xl lg:max-w-4xl xl:max-w-5xl max-h-[90vh] sm:max-h-[85vh] overflow-y-auto",children:[e.jsx(rs,{children:e.jsx(is,{children:"User Profile"})}),y&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(g,{className:"w-20 h-20",children:[e.jsx(j,{src:y.profile_picture_url}),e.jsx(f,{className:"text-2xl",children:Me(y.full_name)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:y.full_name}),e.jsxs("p",{className:"text-text-secondary flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4"}),y.email]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(v,{variant:y.is_active?"default":"destructive",children:y.is_active?"Active":"Inactive"}),e.jsx(v,{variant:"outline",className:"capitalize",children:y.role?.replace("_"," ")})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{size:"sm",className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",onClick:()=>{$(y),U(!0),b(!1)},children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Chat"]}),e.jsxs(d,{size:"sm",variant:"outline",className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",onClick:()=>{$(y),q(!0),b(!1)},children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Offer"]})]})]}),e.jsxs(ps,{defaultValue:"overview",className:"w-full",children:[e.jsxs(gs,{className:"grid w-full grid-cols-3",children:[e.jsx(js,{value:"overview",children:"Overview"}),e.jsx(js,{value:"activity",children:"Activity Timeline"}),e.jsx(js,{value:"payments",children:"Payment History"})]}),e.jsxs(fs,{value:"overview",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(L,{className:"w-4 h-4 text-primary"}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Joined"})]}),e.jsx("p",{className:"font-semibold",children:ye(new Date(y.created_at),"MMM dd, yyyy")})]}),e.jsxs("div",{className:"p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(D,{className:"w-4 h-4 text-primary"}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Subscription"})]}),e.jsx("p",{className:"font-semibold capitalize",children:Ie(y.id)?.plan||"None"})]}),e.jsxs("div",{className:"p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-primary"}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Payments"})]}),e.jsx("p",{className:"font-semibold",children:X.length})]}),e.jsxs("div",{className:"p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(T,{className:"w-4 h-4 text-primary"}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Total Spent"})]}),e.jsxs("p",{className:"font-semibold",children:["$",X.filter(e=>"succeeded"===e.status).reduce((e,s)=>e+parseFloat(s.amount||0),0).toFixed(2)]})]})]}),Ie(y.id)&&e.jsxs("div",{className:"p-4 bg-muted/30 rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Current Subscription"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-secondary",children:"Plan:"}),e.jsx("span",{className:"font-medium capitalize",children:Ie(y.id)?.plan})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-secondary",children:"Status:"}),e.jsx(v,{variant:"default",children:"Active"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-secondary",children:"Started:"}),e.jsx("span",{className:"font-medium",children:ye(new Date(Ie(y.id)?.created_at),"MMM dd, yyyy")})]})]})]})]}),e.jsx(fs,{value:"activity",className:"space-y-4",children:ee?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(we,{className:"w-8 h-8 animate-spin mx-auto text-primary"}),e.jsx("p",{className:"text-sm text-text-secondary mt-2",children:"Loading activity..."})]}):Q.length>0?e.jsx("div",{className:"space-y-3",children:Q.map((s,a)=>e.jsxs("div",{className:"flex gap-3 p-3 bg-muted/30 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center",children:e.jsx(E,{className:"w-4 h-4 text-primary"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium capitalize",children:s.activity_type.replace(/_/g," ")}),s.details&&Object.keys(s.details).length>0&&e.jsx("p",{className:"text-xs text-text-secondary truncate",children:JSON.stringify(s.details)}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(ie,{className:"w-3 h-3 text-text-secondary"}),e.jsx("p",{className:"text-xs text-text-secondary",children:ye(new Date(s.created_at),"MMM dd, yyyy HH:mm")})]})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(E,{className:"w-12 h-12 mx-auto text-text-secondary mb-2"}),e.jsx("p",{className:"text-text-secondary",children:"No activity recorded yet"})]})}),e.jsx(fs,{value:"payments",className:"space-y-4",children:ee?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(we,{className:"w-8 h-8 animate-spin mx-auto text-primary"}),e.jsx("p",{className:"text-sm text-text-secondary mt-2",children:"Loading payments..."})]}):X.length>0?e.jsx("div",{className:"space-y-3",children:X.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center "+("succeeded"===s.status?"bg-green-500/20":"failed"===s.status?"bg-red-500/20":"bg-yellow-500/20"),children:e.jsx(T,{className:"w-4 h-4 "+("succeeded"===s.status?"text-green-400":"failed"===s.status?"text-red-400":"text-yellow-400")})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["$",s.amount]}),e.jsx("p",{className:"text-xs text-text-secondary",children:ye(new Date(s.created_at),"MMM dd, yyyy HH:mm")})]})]}),e.jsx(v,{variant:"succeeded"===s.status?"default":"destructive",children:s.status})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(D,{className:"w-12 h-12 mx-auto text-text-secondary mb-2"}),e.jsx("p",{className:"text-text-secondary",children:"No payment history"})]})})]})]})]})}),e.jsx(as,{open:k,onOpenChange:S,children:e.jsxs(ts,{className:"glass-effect",children:[e.jsxs(rs,{children:[e.jsx(is,{children:"Delete User"}),e.jsxs(ls,{children:["Are you sure you want to delete ",A?.full_name,"? This action cannot be undone."]})]}),e.jsxs(ns,{children:[e.jsx(d,{size:"sm",className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",variant:"outline",onClick:()=>S(!1),children:"Cancel"}),e.jsx(d,{size:"sm",className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",variant:"destructive",onClick:async()=>{if(!A)return;const{error:e}=await c.from("user_profiles").delete().eq("id",A.id);e?o({title:"Failed to delete user",description:e.message,variant:"destructive"}):(o({title:"User deleted successfully"}),S(!1),M(null),Te())},children:"Delete"})]})]})}),e.jsx(as,{open:ae,onOpenChange:te,children:e.jsxs(ts,{children:[e.jsxs(rs,{children:[e.jsx(is,{children:"Create New User"}),e.jsx(ls,{children:"Create a new user account. They will receive an email to set their password."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Email"}),e.jsx(x,{placeholder:"user@example.com",value:le.email,onChange:e=>ce({...le,email:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Full Name"}),e.jsx(x,{placeholder:"John Doe",value:le.full_name,onChange:e=>ce({...le,full_name:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Role"}),e.jsxs(ds,{value:le.role,onValueChange:e=>ce({...le,role:e}),children:[e.jsx(ms,{children:e.jsx(xs,{})}),e.jsxs(hs,{children:[e.jsx(us,{value:"user",children:"User"}),e.jsx(us,{value:"nutritionist",children:"Nutritionist"}),e.jsx(us,{value:"admin",children:"Admin"}),e.jsx(us,{value:"super_admin",children:"Super Admin"})]})]})]})]}),e.jsxs(ns,{children:[e.jsx(d,{size:"sm",className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",variant:"outline",onClick:()=>te(!1),children:"Cancel"}),e.jsxs(d,{size:"sm",className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",onClick:async()=>{if(le.email&&le.full_name){de(!0);try{const e=Math.random().toString(36).slice(-12)+"A1!",{data:s,error:a}=await c.auth.signUp({email:le.email,password:e,options:{data:{full_name:le.full_name,role:le.role},emailRedirectTo:`${window.location.origin}/reset-password`}});if(a)throw a;if(await new Promise(e=>setTimeout(e,2e3)),"user"!==le.role){const{error:e}=await c.from("user_profiles").update({role:le.role}).eq("id",s.user.id);e&&console.error("Error updating role:",e)}o({title:"User created successfully",description:`${le.full_name} has been invited to set their password.`}),te(!1),ce({email:"",full_name:"",role:"user"}),Te()}catch(e){console.error("Error creating user:",e),o({variant:"destructive",title:"Error creating user",description:e.message})}finally{de(!1)}}else o({variant:"destructive",title:"Missing fields",description:"Please fill in email and full name"})},disabled:oe,children:[oe&&e.jsx(we,{className:"w-4 h-4 mr-2 animate-spin"}),"Create User"]})]})]})}),e.jsx(ya,{isOpen:R,onClose:()=>{q(!1),$(null)},user:O,onOfferCreated:()=>{Te()}}),e.jsx(Ca,{isOpen:z,onClose:()=>{U(!1),$(null)},customer:O})]})},Sa=()=>{const[s,a]=i.useState(null),[t,r]=i.useState(!0),[l,n]=i.useState(!1),[h,u]=i.useState(!1),[p,g]=i.useState(!1),[j,f]=i.useState({is_active:!1,is_test_mode:!0,public_key:"",secret_key:"",webhook_secret:""});i.useEffect(()=>{y()},[]);const y=async()=>{r(!0);const{data:e,error:s}=await c.from("payment_settings").select("*").eq("provider","stripe").single();s&&"PGRST116"!==s.code?o({title:"Error fetching settings",description:s.message,variant:"destructive"}):e&&(a(e),f({is_active:e.is_active||!1,is_test_mode:!1!==e.is_test_mode,public_key:e.public_key||"",secret_key:e.secret_key||"",webhook_secret:e.webhook_secret||""})),r(!1)},N=e=>{const{name:s,value:a}=e.target;f(e=>({...e,[s]:a}))},w=(e,s)=>{f(a=>({...a,[e]:s}))};return t?e.jsxs(_,{className:"glass-effect",children:[e.jsx(k,{children:e.jsx("div",{className:"h-8 bg-white/10 rounded w-1/3 animate-pulse"})}),e.jsx(C,{className:"space-y-4",children:[...Array(4)].map((s,a)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-white/10 rounded w-1/4 animate-pulse"}),e.jsx("div",{className:"h-10 bg-white/10 rounded w-full animate-pulse"})]},a))})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs(_,{className:"glass-effect",children:[e.jsx(k,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-6 h-6"}),"Stripe Payment Settings"]}),e.jsx(A,{className:"mt-2",children:"Configure your Stripe account to accept payments"})]}),j.is_active?e.jsx(v,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:"Active"}):e.jsx(v,{variant:"secondary",children:"Inactive"})]})}),e.jsxs(C,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border border-border bg-background/50",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"is_active",className:"text-base font-semibold",children:"Enable Stripe Payments"}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:"Accept payments through Stripe"})]}),e.jsx(os,{id:"is_active",checked:j.is_active,onCheckedChange:e=>w("is_active",e)})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border border-border bg-background/50",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"is_test_mode",className:"text-base font-semibold",children:"Test Mode"}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:"Use test API keys instead of live keys"})]}),e.jsx(os,{id:"is_test_mode",checked:j.is_test_mode,onCheckedChange:e=>w("is_test_mode",e)})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-border",children:[e.jsxs("div",{children:[e.jsxs(m,{htmlFor:"public_key",children:["Publishable Key ",j.is_test_mode?"(Test)":"(Live)"]}),e.jsx(x,{id:"public_key",name:"public_key",value:j.public_key,onChange:N,placeholder:j.is_test_mode?"pk_test_...":"pk_live_...",className:"mt-2 font-mono text-sm"}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Used on the client-side to create payment forms"})]}),e.jsxs("div",{children:[e.jsxs(m,{htmlFor:"secret_key",children:["Secret Key ",j.is_test_mode?"(Test)":"(Live)"]}),e.jsxs("div",{className:"relative mt-2",children:[e.jsx(x,{id:"secret_key",name:"secret_key",type:h?"text":"password",value:j.secret_key,onChange:N,placeholder:j.is_test_mode?"sk_test_...":"sk_live_...",className:"font-mono text-sm pr-10"}),e.jsx("button",{type:"button",onClick:()=>u(!h),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-secondary hover:text-text-primary",children:h?e.jsx(be,{className:"w-4 h-4"}):e.jsx(P,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Used server-side to process payments"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"webhook_secret",children:"Webhook Secret (Optional)"}),e.jsxs("div",{className:"relative mt-2",children:[e.jsx(x,{id:"webhook_secret",name:"webhook_secret",type:p?"text":"password",value:j.webhook_secret,onChange:N,placeholder:"whsec_...",className:"font-mono text-sm pr-10"}),e.jsx("button",{type:"button",onClick:()=>g(!p),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-secondary hover:text-text-primary",children:p?e.jsx(be,{className:"w-4 h-4"}):e.jsx(P,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Used to verify webhook events from Stripe"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-border",children:[e.jsxs(d,{onClick:async()=>{n(!0);try{const{error:e}=await c.from("payment_settings").upsert({provider:"stripe",is_active:j.is_active,is_test_mode:j.is_test_mode,public_key:j.public_key,secret_key:j.secret_key,webhook_secret:j.webhook_secret},{onConflict:"provider"});if(e)throw e;o({title:"Settings Saved!",description:"Stripe payment settings have been updated successfully."}),y()}catch(e){o({title:"Error",description:e.message||"Failed to save settings",variant:"destructive"})}finally{n(!1)}},disabled:l,className:"flex-1",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),l?"Saving...":"Save Settings"]}),e.jsxs(d,{onClick:async()=>{if(j.secret_key){o({title:"Testing Connection",description:"Verifying Stripe credentials..."});try{const e=j.secret_key.startsWith("sk_test_")||j.secret_key.startsWith("sk_live_");o(e?{title:"Connection Successful",description:"Stripe API key format is valid"}:{title:"Invalid Key Format",description:"Stripe secret key should start with sk_test_ or sk_live_",variant:"destructive"})}catch(e){o({title:"Connection Failed",description:e.message,variant:"destructive"})}}else o({title:"Missing Key",description:"Please enter a secret key first",variant:"destructive"})},variant:"outline",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Test Connection"]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-primary/10 border border-primary/20",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"How to get your Stripe API keys:"}),e.jsxs("ol",{className:"text-sm text-text-secondary space-y-1 list-decimal list-inside",children:[e.jsxs("li",{children:["Go to ",e.jsx("a",{href:"https://dashboard.stripe.com/apikeys",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"Stripe Dashboard"})]}),e.jsx("li",{children:"Navigate to Developers â†’ API keys"}),e.jsx("li",{children:"Copy your Publishable key and Secret key"}),e.jsx("li",{children:"For webhooks: Developers â†’ Webhooks â†’ Add endpoint"}),e.jsxs("li",{children:["Use this URL: ",e.jsxs("code",{className:"px-2 py-1 bg-background/50 rounded text-xs",children:[window.location.origin,"/api/webhooks/stripe"]})]})]})]})]})]})})},Aa=({data:s=[],columns:a=[],actions:t=null,emptyMessage:r="No data available"})=>0===s.length?e.jsx("div",{className:"text-center py-12 text-text-secondary",children:e.jsx("p",{children:r})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block w-full",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border",children:[a.map((s,a)=>e.jsx("th",{className:"text-left p-3 lg:p-4 text-sm lg:text-base font-semibold text-text-secondary",style:{minWidth:s.minWidth},children:s.header},a)),t&&e.jsx("th",{className:"text-right p-3 lg:p-4 text-sm lg:text-base font-semibold text-text-secondary min-w-[180px]",children:"Actions"})]})}),e.jsx("tbody",{children:s.map((s,r)=>e.jsxs("tr",{className:"border-b border-border hover:bg-muted/50 transition-colors",children:[a.map((a,t)=>e.jsx("td",{className:"p-3 lg:p-4 text-sm lg:text-base",children:a.render?a.render(s):s[a.accessor]},t)),t&&e.jsx("td",{className:"p-3 lg:p-4 text-right",children:e.jsx("div",{className:"flex items-center justify-end gap-2 flex-wrap",children:t(s)})})]},r))})]})})}),e.jsx("div",{className:"md:hidden space-y-4",children:s.map((s,r)=>e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[a.map((a,t)=>e.jsxs("div",{className:"flex justify-between items-start gap-4",children:[e.jsxs("span",{className:"text-sm font-medium text-text-secondary min-w-[100px]",children:[a.header,":"]}),e.jsx("span",{className:"text-sm text-foreground flex-1 text-right",children:a.render?a.render(s):s[a.accessor]})]},t)),t&&e.jsx("div",{className:"pt-3 border-t border-border flex items-center justify-end gap-2",children:t(s)})]})})},r))})]}),Pa=()=>{const[s,a]=i.useState([]),[t,r]=i.useState(!0),[l,n]=i.useState(!1),[m,h]=i.useState("all"),[u,p]=i.useState(""),[g,j]=i.useState({total:0,succeeded:0,pending:0,failed:0});i.useEffect(()=>{f()},[m]);const f=async()=>{r(!0);let e=c.from("payment_transactions").select("\n        *,\n        user_profiles (full_name, email)\n      ").order("created_at",{ascending:!1}).limit(100);"all"!==m&&(e=e.eq("status",m));const{data:s,error:t}=await e;t?o({title:"Error fetching payments",description:t.message,variant:"destructive"}):(a(s||[]),y(s||[])),r(!1)},y=e=>{const s=e.reduce((e,s)=>e+parseFloat(s.amount),0),a=e.filter(e=>"succeeded"===e.status).reduce((e,s)=>e+parseFloat(s.amount),0),t=e.filter(e=>"pending"===e.status).length,r=e.filter(e=>"failed"===e.status).length;j({total:s,succeeded:a,pending:t,failed:r})},N=s.filter(e=>{if(!u)return!0;const s=u.toLowerCase();return e.user_profiles?.full_name?.toLowerCase().includes(s)||e.user_profiles?.email?.toLowerCase().includes(s)||e.payment_intent_id?.toLowerCase().includes(s)});return l?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Payment Settings"}),e.jsx(d,{onClick:()=>n(!1),variant:"outline",children:"Back to Payments"})]}),e.jsx(Sa,{})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl lg:text-2xl font-bold",children:"Payment Transactions"}),e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary mt-1",children:"Track and manage payment transactions"})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary",children:"Total Revenue"}),e.jsxs("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold",children:["$",g.total.toFixed(2)]})]}),e.jsx(T,{className:"w-8 h-8 text-green-400"})]})})}),e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary",children:"Succeeded"}),e.jsxs("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold",children:["$",g.succeeded.toFixed(2)]})]}),e.jsx(ue,{className:"w-8 h-8 text-green-400"})]})})}),e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary",children:"Pending"}),e.jsx("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold",children:g.pending})]}),e.jsx(ie,{className:"w-8 h-8 text-yellow-400"})]})})}),e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary",children:"Failed"}),e.jsx("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold",children:g.failed})]}),e.jsx(pe,{className:"w-8 h-8 text-red-400"})]})})})]}),e.jsxs(_,{className:"glass-effect",children:[e.jsx(k,{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx(S,{className:"text-3xl font-bold",children:"Payment Transactions"}),e.jsxs("div",{className:"flex gap-2 ml-auto",children:[e.jsxs(d,{onClick:()=>n(!0),variant:"outline",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Settings"]}),e.jsxs(d,{onClick:f,variant:"outline",children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Refresh"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-text-secondary"}),e.jsx(x,{placeholder:"Search transactions...",value:u,onChange:e=>p(e.target.value),className:"pl-10"})]}),e.jsxs(ds,{value:m,onValueChange:h,children:[e.jsx(ms,{className:"w-full sm:w-[180px]",children:e.jsx(xs,{placeholder:"Filter by status"})}),e.jsxs(hs,{children:[e.jsx(us,{value:"all",children:"All Statuses"}),e.jsx(us,{value:"succeeded",children:"Succeeded"}),e.jsx(us,{value:"pending",children:"Pending"}),e.jsx(us,{value:"failed",children:"Failed"}),e.jsx(us,{value:"refunded",children:"Refunded"})]})]})]})]})}),e.jsx(C,{children:t?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((s,a)=>e.jsxs("div",{className:"p-4 rounded-lg flex items-center gap-4 animate-pulse bg-white/5",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-white/10 rounded w-1/3"}),e.jsx("div",{className:"h-4 bg-white/10 rounded w-1/2"})]}),e.jsx("div",{className:"h-6 bg-white/10 rounded w-1/6"}),e.jsx("div",{className:"h-6 bg-white/10 rounded w-1/6"})]},a))}):e.jsx(Aa,{data:N,columns:[{header:"Customer",accessor:"user_profiles",render:s=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:s.user_profiles?.full_name||"Unknown"}),e.jsx("div",{className:"text-xs text-text-secondary",children:s.user_profiles?.email||"No email"})]})},{header:"Amount",accessor:"amount",render:s=>e.jsxs("span",{className:"font-semibold text-base",children:["$",parseFloat(s.amount).toFixed(2)]})},{header:"Status",accessor:"status",render:s=>(s=>{switch(s){case"succeeded":return e.jsxs(v,{variant:"success",className:"bg-green-500/20 text-green-400 border-green-500/30",children:[e.jsx(ue,{className:"w-3 h-3 mr-1"}),"Succeeded"]});case"failed":return e.jsxs(v,{variant:"destructive",children:[e.jsx(pe,{className:"w-3 h-3 mr-1"}),"Failed"]});case"pending":return e.jsxs(v,{variant:"secondary",children:[e.jsx(ie,{className:"w-3 h-3 mr-1"}),"Pending"]});default:return e.jsx(v,{children:s})}})(s.status)},{header:"Date",accessor:"created_at",render:s=>e.jsx("span",{className:"text-sm text-text-secondary",children:new Date(s.created_at).toLocaleDateString()})}],emptyMessage:u?"No transactions match your search":"No payment transactions found."})})]})]})},Fa=({user:s})=>{const[a,t]=i.useState([]),[r,l]=i.useState([]),[n,m]=i.useState(!0),[u,p]=i.useState(null),[g,j]=i.useState([]),[f,y]=i.useState([]),[N,w]=i.useState(""),[b,A]=i.useState("all"),[P,F]=i.useState("all"),[E,T]=i.useState("all"),[I,M]=i.useState("all"),[R,q]=i.useState(null),[L,D]=i.useState(!1),[U,O]=i.useState(null),[G,V]=i.useState([]),[B,W]=i.useState(""),[Q,Y]=i.useState(!1),[J,K]=i.useState(!1),X=async()=>{m(!0);const{data:e,error:s}=await c.from("issues").select("*").order("created_at",{ascending:!1});if(s)return o({title:"Error fetching issues",description:s.message,variant:"destructive"}),void m(!1);const a=[...new Set([...e.map(e=>e.user_id),...e.filter(e=>e.assigned_to).map(e=>e.assigned_to)])].filter(Boolean);let r=[];if(a.length>0){const{data:e}=await c.from("user_profiles").select("id, full_name, email, profile_picture_url").in("id",a);r=e||[]}const i=e.map(e=>({...e,user_profiles:r.find(s=>s.id===e.user_id),assigned_user:e.assigned_to?r.find(s=>s.id===e.assigned_to):null}));t(i),l(i),m(!1)},Z=async e=>{K(!0);const{data:s}=await c.from("issue_comments").select("*").eq("issue_id",e).order("created_at",{ascending:!0}),a=[...new Set(s?.map(e=>e.user_id)||[])].filter(Boolean);let t=[];if(a.length>0){const{data:e}=await c.from("user_profiles").select("id, full_name, email, profile_picture_url").in("id",a);t=e||[]}const r=(s||[]).map(e=>({...e,user_profiles:t.find(s=>s.id===e.user_id)}));V(r),K(!1)};i.useEffect(()=>{X(),(async()=>{const{data:e,error:s}=await c.rpc("get_issue_statistics",{time_period:"all"});s?console.error("Error fetching statistics:",s):e&&e.length>0&&p(e[0])})(),(async()=>{const{data:e}=await c.from("issue_categories").select("*").eq("is_active",!0).order("display_order");e&&j(e)})(),(async()=>{const{data:e}=await c.from("user_profiles").select("id, full_name, email").in("role",["admin","super_admin"]);e&&y(e)})()},[]),i.useEffect(()=>{let e=a;N&&(e=e.filter(e=>e.subject?.toLowerCase().includes(N.toLowerCase())||e.user_profiles?.full_name?.toLowerCase().includes(N.toLowerCase())||e.user_profiles?.email?.toLowerCase().includes(N.toLowerCase()))),"all"!==b&&(e=e.filter(e=>e.status===b)),"all"!==P&&(e=e.filter(e=>e.priority===P)),"all"!==E&&(e=e.filter(e=>e.category===E)),"all"!==I&&(e="unassigned"===I?e.filter(e=>!e.assigned_to):"me"===I?e.filter(e=>e.assigned_to===s?.id):e.filter(e=>e.assigned_to===I)),l(e)},[N,b,P,E,I,a,s]);const ee=s=>{switch(s){case"open":return e.jsxs(v,{className:"bg-blue-500/20 text-blue-300 border-blue-500/30",children:[e.jsx(z,{className:"w-3 h-3 mr-1"}),"Open"]});case"in_progress":return e.jsxs(v,{className:"bg-yellow-500/20 text-yellow-300 border-yellow-500/30",children:[e.jsx(ie,{className:"w-3 h-3 mr-1"}),"In Progress"]});case"resolved":return e.jsxs(v,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:[e.jsx(ue,{className:"w-3 h-3 mr-1"}),"Resolved"]});case"closed":return e.jsx(v,{variant:"outline",children:"Closed"});default:return e.jsx(v,{children:s})}},se=s=>{switch(s){case"urgent":return e.jsxs(v,{className:"bg-red-500/20 text-red-300 border-red-500/30 animate-pulse",children:[e.jsx(ke,{className:"w-3 h-3 mr-1"}),"Urgent"]});case"high":return e.jsxs(v,{className:"bg-orange-500/20 text-orange-300 border-orange-500/30",children:[e.jsx(ke,{className:"w-3 h-3 mr-1"}),"High"]});case"medium":return e.jsx(v,{className:"bg-yellow-500/20 text-yellow-300 border-yellow-500/30",children:"Medium"});case"low":return e.jsx(v,{className:"bg-gray-500/20 text-gray-300 border-gray-500/30",children:"Low"});default:return e.jsx(v,{children:s})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl lg:text-2xl font-bold",children:"Customer Issues"}),e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary mt-1",children:"Track and resolve customer support tickets"})]})}),u&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary",children:"Total Issues"}),e.jsx("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold",children:u.total_issues||0})]}),e.jsx($,{className:"w-8 h-8 text-primary"})]})})}),e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary",children:"Open Issues"}),e.jsx("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-blue-400",children:u.open_issues||0})]}),e.jsx(z,{className:"w-8 h-8 text-blue-400"})]})})}),e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary",children:"Avg Response Time"}),e.jsx("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-green-400",children:u.avg_first_response_minutes?`${Math.round(u.avg_first_response_minutes)}m`:"N/A"})]}),e.jsx(ie,{className:"w-8 h-8 text-green-400"})]})})}),e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary",children:"Urgent Issues"}),e.jsx("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-red-400",children:u.urgent_issues||0})]}),e.jsx(ke,{className:"w-8 h-8 text-red-400"})]})})})]}),e.jsxs(_,{className:"glass-effect",children:[e.jsxs(k,{children:[e.jsx("div",{className:"flex flex-col gap-3 sm:gap-4",children:e.jsxs("div",{children:[e.jsx(S,{className:"text-lg sm:text-xl lg:text-2xl font-bold",children:"Customer Issues"}),e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary",children:"Track and resolve customer support tickets"})]})}),e.jsxs("div",{className:"flex flex-col gap-2 sm:gap-3 mt-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-3.5 h-3.5 sm:w-4 sm:h-4 text-text-secondary"}),e.jsx(x,{placeholder:"Search issues...",value:N,onChange:e=>w(e.target.value),className:"pl-9 sm:pl-10 text-xs sm:text-sm"})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2",children:[e.jsxs(ds,{value:b,onValueChange:A,children:[e.jsx(ms,{className:"w-full text-xs sm:text-sm",children:e.jsx(xs,{placeholder:"Status"})}),e.jsxs(hs,{children:[e.jsx(us,{value:"all",children:"All Status"}),e.jsx(us,{value:"open",children:"Open"}),e.jsx(us,{value:"in_progress",children:"In Progress"}),e.jsx(us,{value:"resolved",children:"Resolved"}),e.jsx(us,{value:"closed",children:"Closed"})]})]}),e.jsxs(ds,{value:P,onValueChange:F,children:[e.jsx(ms,{className:"w-full text-xs sm:text-sm",children:e.jsx(xs,{placeholder:"Priority"})}),e.jsxs(hs,{children:[e.jsx(us,{value:"all",children:"All Priority"}),e.jsx(us,{value:"urgent",children:"Urgent"}),e.jsx(us,{value:"high",children:"High"}),e.jsx(us,{value:"medium",children:"Medium"}),e.jsx(us,{value:"low",children:"Low"})]})]}),e.jsxs(ds,{value:E,onValueChange:T,children:[e.jsx(ms,{className:"w-full text-xs sm:text-sm",children:e.jsx(xs,{placeholder:"Category"})}),e.jsxs(hs,{children:[e.jsx(us,{value:"all",children:"All Categories"}),g.map(s=>e.jsx(us,{value:s.slug,children:s.name},s.id))]})]}),e.jsxs(ds,{value:I,onValueChange:M,children:[e.jsx(ms,{className:"w-full text-xs sm:text-sm col-span-2 sm:col-span-1",children:e.jsx(xs,{placeholder:"Assigned"})}),e.jsxs(hs,{children:[e.jsx(us,{value:"all",children:"All Assignments"}),e.jsx(us,{value:"unassigned",children:"Unassigned"}),e.jsx(us,{value:"me",children:"Assigned to Me"}),e.jsx(bs,{}),f.map(s=>e.jsx(us,{value:s.id,children:s.full_name},s.id))]})]})]})]})]}),e.jsx(C,{children:n?e.jsxs("div",{className:"flex justify-center items-center py-10",children:[e.jsx(we,{className:"h-6 w-6 sm:h-8 sm:w-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-3 sm:ml-4 text-sm sm:text-base",children:"Loading Issues..."})]}):e.jsx(Aa,{data:r,columns:[{header:"Priority",accessor:"priority",render:e=>se(e.priority)},{header:"Subject",accessor:"subject",render:s=>e.jsx("span",{className:"font-medium text-sm",children:s.subject})},{header:"Category",accessor:"category",render:s=>(s=>{const a=g.find(e=>e.slug===s);return a?e.jsx(v,{style:{backgroundColor:`${a.color}20`,color:a.color,borderColor:`${a.color}50`},children:a.name}):null})(s.category)},{header:"Customer",accessor:"user_profiles",render:s=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:s.user_profiles?.full_name||"N/A"}),e.jsx("div",{className:"text-xs text-text-secondary",children:s.user_profiles?.email||"N/A"})]})},{header:"Status",accessor:"status",render:e=>ee(e.status)},{header:"Last Updated",accessor:"updated_at",render:s=>e.jsx("span",{className:"text-sm text-text-secondary",children:new Date(s.updated_at).toLocaleDateString()})}],actions:s=>e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>(e=>{q(e),D(!0),Z(e.id)})(s),className:"h-8 px-2 sm:px-3",children:e.jsx(Se,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})}),emptyMessage:N||"all"!==b||"all"!==P||"all"!==E?"No issues match your filters":"No customer issues found. Great job!"})})]}),e.jsx(H,{children:L&&R&&e.jsx(as,{open:L,onOpenChange:D,children:e.jsxs(ts,{className:"max-w-4xl max-h-[90vh] overflow-y-auto glass-effect",children:[e.jsx(rs,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(is,{className:"text-2xl",children:R.subject}),e.jsxs(ls,{className:"mt-2",children:["Issue #",R.id.slice(0,8)," â€¢ Created ",new Date(R.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[se(R.priority),ee(R.status)]})]})}),e.jsxs("div",{className:"space-y-6 mt-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Description"}),e.jsx("p",{className:"text-text-secondary whitespace-pre-wrap",children:R.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Customer"}),e.jsxs("div",{className:"text-text-secondary",children:[e.jsx("p",{children:R.user_profiles?.full_name}),e.jsx("p",{className:"text-sm",children:R.user_profiles?.email})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Assigned To"}),e.jsxs(ds,{value:R.assigned_to||"unassigned",onValueChange:e=>(async(e,s)=>{const{error:a}=await c.from("issues").update({assigned_to:s}).eq("id",e);a?o({title:"Error assigning issue",description:a.message,variant:"destructive"}):(o({title:"Issue Assigned",description:"Issue has been assigned successfully"}),X())})(R.id,"unassigned"===e?null:e),children:[e.jsx(ms,{children:e.jsx(xs,{})}),e.jsxs(hs,{children:[e.jsx(us,{value:"unassigned",children:"Unassigned"}),f.map(s=>e.jsx(us,{value:s.id,children:s.full_name},s.id))]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5"}),"Conversation (",G.length,")"]}),J?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(we,{className:"w-6 h-6 animate-spin"})}):e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:G.map(s=>e.jsxs("div",{className:"p-4 rounded-lg "+(s.is_internal?"bg-yellow-500/10 border border-yellow-500/30":"bg-muted/20"),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:s.user_profiles?.full_name}),s.is_internal&&e.jsxs(v,{variant:"outline",className:"text-xs",children:[e.jsx(Pe,{className:"w-3 h-3 mr-1"}),"Internal Note"]})]}),e.jsx("span",{className:"text-xs text-text-secondary",children:new Date(s.created_at).toLocaleString()})]}),e.jsx("p",{className:"text-text-secondary whitespace-pre-wrap",children:s.comment_text})]},s.id))}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx(h,{placeholder:"Type your response or internal note...",value:B,onChange:e=>W(e.target.value),rows:3}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:Q,onChange:e=>Y(e.target.checked),className:"rounded"}),e.jsx("span",{className:"text-sm text-text-secondary",children:"Internal note (not visible to customer)"})]}),e.jsxs(d,{onClick:async()=>{if(!B.trim()||!R)return;const{error:e}=await c.from("issue_comments").insert({issue_id:R.id,user_id:s.id,comment_text:B,is_internal:Q});e?o({title:"Error adding comment",description:e.message,variant:"destructive"}):(o({title:"Comment Added",description:Q?"Internal note added":"Comment added"}),W(""),Y(!1),Z(R.id))},disabled:!B.trim(),children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),Q?"Add Note":"Send Reply"]})]})]})]})]})]})})})]})},Ea=()=>{const[s,a]=i.useState([]),[t,r]=i.useState(!0),[l,n]=i.useState(!1),[u,p]=i.useState(null),[g,j]=i.useState({category:"",category_icon:"",name:"",description:"",plan_tier:"",feature_icon:"",display_order:0}),f=async()=>{r(!0);const{data:e,error:s}=await c.from("features").select("*").order("display_order");s?o({title:"Error fetching features",description:s.message,variant:"destructive"}):a(e),r(!1)};i.useEffect(()=>{f()},[]);const v=e=>{const{name:s,value:a}=e.target;j(e=>({...e,[s]:a}))},y=(e=null)=>{p(e),j(e||{category:"",category_icon:"",name:"",description:"",plan_tier:"",feature_icon:"",display_order:0}),n(!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Manage Features"}),e.jsxs(d,{onClick:()=>y(),children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"New Feature"]})]}),e.jsx(as,{open:l,onOpenChange:n,children:e.jsxs(ts,{className:"glass-effect",children:[e.jsx(rs,{children:e.jsx(is,{children:u?"Edit Feature":"Create New Feature"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"category",children:"Category"}),e.jsx(x,{id:"category",name:"category",value:g.category,onChange:v})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"category_icon",children:"Category Icon"}),e.jsx(x,{id:"category_icon",name:"category_icon",value:g.category_icon||"",onChange:v,placeholder:"e.g. Heart"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"name",children:"Name"}),e.jsx(x,{id:"name",name:"name",value:g.name,onChange:v})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"description",children:"Description"}),e.jsx(h,{id:"description",name:"description",value:g.description,onChange:v})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"plan_tier",children:"Plan Tier"}),e.jsx(x,{id:"plan_tier",name:"plan_tier",value:g.plan_tier||"",onChange:v,placeholder:"e.g. Premium"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"feature_icon",children:"Feature Icon"}),e.jsx(x,{id:"feature_icon",name:"feature_icon",value:g.feature_icon||"",onChange:v,placeholder:"e.g. CheckCircle"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"display_order",children:"Display Order"}),e.jsx(x,{id:"display_order",name:"display_order",type:"number",value:g.display_order,onChange:v})]})]})]}),e.jsxs(ns,{children:[e.jsx(d,{variant:"outline",onClick:()=>n(!1),children:"Cancel"}),e.jsx(d,{onClick:async()=>{const{error:e}=await c.from("features").upsert(g);e?o({title:"Error saving feature",description:e.message,variant:"destructive"}):(o({title:`Feature ${u?"updated":"created"} successfully`}),f(),n(!1))},children:"Save"})]})]})}),e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-0",children:t?e.jsxs("div",{className:"flex justify-center items-center py-10",children:[e.jsx(we,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-4 text-lg",children:"Loading Features..."})]}):0===s.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(le,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium",children:"No features found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new feature."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("th",{className:"p-4",children:"Name"}),e.jsx("th",{className:"p-4",children:"Category"}),e.jsx("th",{className:"p-4",children:"Description"}),e.jsx("th",{className:"p-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{children:s.map(s=>e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5",children:[e.jsx("td",{className:"p-4 font-medium",children:s.name}),e.jsx("td",{className:"p-4 text-text-secondary",children:s.category}),e.jsx("td",{className:"p-4 text-text-secondary truncate max-w-sm",children:s.description}),e.jsx("td",{className:"p-4 text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>y(s),children:e.jsx(Fe,{className:"w-4 h-4"})}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>(async e=>{const{error:s}=await c.from("features").delete().eq("id",e);s?o({title:"Error deleting feature",description:s.message,variant:"destructive"}):(o({title:"Feature deleted successfully"}),f())})(s.id),className:"text-red-400 hover:text-red-500",children:e.jsx(V,{className:"w-4 h-4"})})]})})]},s.id))})]})})})})]})},Ta=()=>{const[s,a]=i.useState([]),[t,r]=i.useState(!0),[l,n]=i.useState(!1),[u,p]=i.useState(null),[g,j]=i.useState({id:null,name:"",description:"",price_monthly:0,price_yearly:0,is_popular:!1,is_active:!0,features:"",display_order:0}),f=async()=>{r(!0);const{data:e,error:s}=await c.from("subscription_plans").select("*").order("display_order");s?o({title:"Error fetching pricing plans",description:s.message,variant:"destructive"}):a(e),r(!1)};i.useEffect(()=>{f()},[]);const v=e=>{const{name:s,value:a,type:t,checked:r}=e.target;j(e=>({...e,[s]:"checkbox"===t?r:a}))},y=(e=null)=>{p(e),j(e?{...e,features:Array.isArray(e.features)?e.features.join("\n"):""}:{id:null,name:"",description:"",price_monthly:0,price_yearly:0,is_popular:!1,is_active:!0,features:"",display_order:0}),n(!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Manage Pricing Plans"}),e.jsxs(d,{onClick:()=>y(),children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"New Plan"]})]}),e.jsx(as,{open:l,onOpenChange:n,children:e.jsxs(ts,{className:"glass-effect",children:[e.jsx(rs,{children:e.jsx(is,{children:u?"Edit Plan":"Create New Plan"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"name",children:"Plan Name"}),e.jsx(x,{id:"name",name:"name",value:g.name,onChange:v})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"description",children:"Description"}),e.jsx(x,{id:"description",name:"description",value:g.description||"",onChange:v})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"price_monthly",children:"Monthly Price"}),e.jsx(x,{id:"price_monthly",name:"price_monthly",type:"number",value:g.price_monthly,onChange:v})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"price_yearly",children:"Yearly Price (per month)"}),e.jsx(x,{id:"price_yearly",name:"price_yearly",type:"number",value:g.price_yearly,onChange:v})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"features",children:"Features (one per line)"}),e.jsx(h,{id:"features",name:"features",value:g.features,onChange:e=>{j(s=>({...s,features:e.target.value}))},rows:8})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(os,{id:"is_popular",name:"is_popular",checked:g.is_popular,onCheckedChange:e=>j(s=>({...s,is_popular:e}))}),e.jsx(m,{htmlFor:"is_popular",children:"Most Popular"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(os,{id:"is_active",name:"is_active",checked:g.is_active,onCheckedChange:e=>j(s=>({...s,is_active:e}))}),e.jsx(m,{htmlFor:"is_active",children:"Active (shown on pricing page)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"display_order",children:"Display Order"}),e.jsx(x,{id:"display_order",name:"display_order",type:"number",value:g.display_order,onChange:v})]})]}),e.jsxs(ns,{children:[e.jsx(d,{variant:"outline",onClick:()=>n(!1),children:"Cancel"}),e.jsx(d,{onClick:async()=>{const e={...g,features:"string"==typeof g.features?g.features.split("\n").filter(e=>""!==e.trim()):[]};e.id||delete e.id;const{error:s}=await c.from("subscription_plans").upsert(e);s?(console.error("Save error:",s),o({title:"Error saving plan",description:s.message,variant:"destructive"})):(o({title:`Plan ${u?"updated":"created"} successfully`}),f(),n(!1))},children:"Save"})]})]})}),e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-0",children:t?e.jsxs("div",{className:"flex justify-center items-center py-10",children:[e.jsx(we,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-4 text-lg",children:"Loading Plans..."})]}):0===s.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(T,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium",children:"No plans found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new plan."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("th",{className:"p-4",children:"Name"}),e.jsx("th",{className:"p-4",children:"Monthly Price"}),e.jsx("th",{className:"p-4",children:"Yearly Price"}),e.jsx("th",{className:"p-4",children:"Popular"}),e.jsx("th",{className:"p-4",children:"Active"}),e.jsx("th",{className:"p-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{children:s.map(s=>e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5",children:[e.jsx("td",{className:"p-4 font-medium",children:s.name}),e.jsxs("td",{className:"p-4 text-text-secondary",children:["$",s.price_monthly]}),e.jsxs("td",{className:"p-4 text-text-secondary",children:["$",s.price_yearly]}),e.jsx("td",{className:"p-4",children:s.is_popular?"Yes":"No"}),e.jsx("td",{className:"p-4",children:s.is_active?e.jsx("span",{className:"text-green-400",children:"Yes"}):e.jsx("span",{className:"text-gray-500",children:"No"})}),e.jsx("td",{className:"p-4 text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>y(s),children:e.jsx(Fe,{className:"w-4 h-4"})}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>(async e=>{const{error:s}=await c.from("subscription_plans").delete().eq("id",e);s?o({title:"Error deleting plan",description:s.message,variant:"destructive"}):(o({title:"Plan deleted successfully"}),f())})(s.id),className:"text-red-400 hover:text-red-500",children:e.jsx(V,{className:"w-4 h-4"})})]})})]},s.id))})]})})})})]})},Ia=()=>{const[s,a]=i.useState([]),[t,r]=i.useState(!0),[l,n]=i.useState(null),[o,u]=i.useState(!1),p=async()=>{try{r(!0);const{data:e,error:s}=await c.from("homepage_content").select("*").order("section_order",{ascending:!0});if(s)throw s;a(e||[])}catch(e){console.error("Error fetching sections:",e),alert("Error loading homepage sections: "+e.message)}finally{r(!1)}};i.useEffect(()=>{p()},[]);return t?e.jsx("div",{className:"p-6",children:"Loading homepage sections..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Homepage Manager"}),e.jsx("p",{className:"text-text-secondary mt-1",children:"Manage hero sections, CTAs, and content blocks"})]}),e.jsxs(d,{size:"sm",className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",onClick:()=>{n({section_type:"hero",section_order:s.length,is_active:!0,title:"",subtitle:"",description:"",cta_text:"",cta_link:""}),u(!0)},children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Add Section"]})]}),e.jsx("div",{className:"grid gap-4",children:0===s.length?e.jsx(_,{children:e.jsx(C,{className:"p-6",children:e.jsx("p",{className:"text-center text-text-secondary",children:'No sections yet. Click "Add Section" to create one.'})})}):s.map(s=>e.jsxs(_,{className:s.is_active?"":"opacity-60",children:[e.jsx(k,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(S,{className:"flex items-center gap-2",children:[s.title,e.jsx("span",{className:"text-xs font-normal px-2 py-1 bg-primary/10 rounded",children:s.section_type}),!s.is_active&&e.jsx("span",{className:"text-xs font-normal px-2 py-1 bg-yellow-500/10 text-yellow-600 rounded",children:"Inactive"})]}),s.subtitle&&e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:s.subtitle})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{size:"sm",className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",variant:s.is_active?"outline":"default",onClick:()=>(async e=>{try{const{error:s}=await c.from("homepage_content").update({is_active:!e.is_active}).eq("id",e.id);if(s)throw s;p()}catch(s){console.error("Error toggling section:",s),alert("Error updating section: "+s.message)}})(s),children:s.is_active?"Hide":"Show"}),e.jsx(d,{size:"icon",className:"h-8 w-8 sm:h-9 sm:w-9 p-0",variant:"outline",onClick:()=>(e=>{n({...e}),u(!0)})(s),children:e.jsx(Ee,{className:"w-4 h-4"})}),e.jsx(d,{size:"icon",className:"h-8 w-8 sm:h-9 sm:w-9 p-0",variant:"destructive",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this section?"))try{const{error:s}=await c.from("homepage_content").delete().eq("id",e);if(s)throw s;p()}catch(s){console.error("Error deleting section:",s),alert("Error deleting section: "+s.message)}})(s.id),children:e.jsx(V,{className:"w-4 h-4"})})]})]})}),e.jsxs(C,{children:[s.description&&e.jsx("p",{className:"text-sm text-text-secondary mb-2",children:s.description}),s.cta_text&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium",children:"CTA:"}),e.jsx("span",{className:"text-primary",children:s.cta_text}),s.cta_link&&e.jsxs("span",{className:"text-text-secondary",children:["â†’ ",s.cta_link]})]})]})]},s.id))}),e.jsx(as,{open:o,onOpenChange:u,children:e.jsxs(ts,{className:"glass-effect max-w-2xl lg:max-w-4xl xl:max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsx(rs,{children:e.jsx(is,{children:l?.id?"Edit Section":"Create New Section"})}),l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Section Type"}),e.jsxs(ds,{value:l.section_type,onValueChange:e=>n({...l,section_type:e}),children:[e.jsx(ms,{className:"glass-effect",children:e.jsx(xs,{})}),e.jsxs(hs,{className:"glass-effect",children:[e.jsx(us,{value:"hero",children:"Hero"}),e.jsx(us,{value:"features",children:"Features"}),e.jsx(us,{value:"cta",children:"Call to Action"}),e.jsx(us,{value:"stats",children:"Statistics"}),e.jsx(us,{value:"process",children:"Process"})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Title *"}),e.jsx(x,{value:l.title,onChange:e=>n({...l,title:e.target.value}),placeholder:"Section title"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Subtitle"}),e.jsx(x,{value:l.subtitle||"",onChange:e=>n({...l,subtitle:e.target.value}),placeholder:"Section subtitle"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Description"}),e.jsx(h,{value:l.description||"",onChange:e=>n({...l,description:e.target.value}),placeholder:"Section description",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"CTA Button Text"}),e.jsx(x,{value:l.cta_text||"",onChange:e=>n({...l,cta_text:e.target.value}),placeholder:"Get Started"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"CTA Button Link"}),e.jsx(x,{value:l.cta_link||"",onChange:e=>n({...l,cta_link:e.target.value}),placeholder:"/signup"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Cs,{checked:l.is_active,onCheckedChange:e=>n({...l,is_active:e})}),e.jsx(m,{children:"Active (visible on website)"})]})]}),e.jsxs(ns,{children:[e.jsxs(d,{size:"sm",className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",variant:"outline",onClick:()=>u(!1),children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(d,{size:"sm",className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",onClick:async()=>{try{if(!l.title)return void alert("Title is required");if(l.id){const{error:e}=await c.from("homepage_content").update({section_type:l.section_type,title:l.title,subtitle:l.subtitle,description:l.description,cta_text:l.cta_text,cta_link:l.cta_link,is_active:l.is_active}).eq("id",l.id);if(e)throw e}else{const{error:e}=await c.from("homepage_content").insert([l]);if(e)throw e}u(!1),n(null),p()}catch(e){console.error("Error saving section:",e),alert("Error saving section: "+e.message)}},children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Save Section"]})]})]})})]})},Ma=()=>{const[s,a]=i.useState([]),[t,r]=i.useState(!0),[l,n]=i.useState(null),[o,u]=i.useState(!1),p=async()=>{try{r(!0);const{data:e,error:s}=await c.from("testimonials").select("*").order("display_order",{ascending:!0});if(s)throw s;a(e||[])}catch(e){console.error("Error fetching testimonials:",e),alert("Error loading testimonials: "+e.message)}finally{r(!1)}};i.useEffect(()=>{p()},[]);return t?e.jsx("div",{className:"p-6",children:"Loading testimonials..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl lg:text-2xl font-bold",children:"Testimonials Manager"}),e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary mt-1",children:"Manage customer reviews and testimonials"})]}),e.jsx("div",{className:"flex gap-2 ml-auto",children:e.jsxs(d,{onClick:()=>{n({customer_name:"",customer_title:"",customer_company:"",quote:"",rating:5,category:"general",is_featured:!1,is_approved:!0,is_verified:!1}),u(!0)},size:"sm",className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Add Testimonial"]})})]}),e.jsx("div",{className:"grid gap-4",children:0===s.length?e.jsx(_,{children:e.jsx(C,{className:"p-6",children:e.jsx("p",{className:"text-center text-text-secondary",children:'No testimonials yet. Click "Add Testimonial" to create one.'})})}):s.map(s=>e.jsxs(_,{className:s.is_approved?"":"opacity-60",children:[e.jsx(k,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(S,{className:"flex items-center gap-2",children:[s.customer_name,s.is_featured&&e.jsx("span",{className:"text-xs font-normal px-2 py-1 bg-yellow-500/10 text-yellow-600 rounded",children:"Featured"}),s.is_verified&&e.jsx("span",{className:"text-xs font-normal px-2 py-1 bg-green-500/10 text-green-600 rounded",children:"Verified"}),!s.is_approved&&e.jsx("span",{className:"text-xs font-normal px-2 py-1 bg-gray-500/10 text-gray-600 rounded",children:"Hidden"})]}),s.customer_title&&e.jsxs("p",{className:"text-sm text-text-secondary",children:[s.customer_title,s.customer_company&&` at ${s.customer_company}`]}),e.jsx("div",{className:"flex items-center gap-1 mt-1",children:[...Array(5)].map((a,t)=>e.jsx(Te,{className:"w-4 h-4 "+(t<s.rating?"fill-yellow-400 text-yellow-400":"text-gray-300")},t))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{size:"sm",className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",variant:s.is_featured?"default":"outline",onClick:()=>(async e=>{try{const{error:s}=await c.from("testimonials").update({is_featured:!e.is_featured}).eq("id",e.id);if(s)throw s;p()}catch(s){console.error("Error toggling featured:",s),alert("Error updating testimonial: "+s.message)}})(s),children:s.is_featured?"Unfeature":"Feature"}),e.jsx(d,{size:"icon",className:"h-8 w-8 sm:h-9 sm:w-9",variant:"outline",onClick:()=>(e=>{n({...e}),u(!0)})(s),children:e.jsx(Ee,{className:"w-4 h-4"})}),e.jsx(d,{size:"icon",className:"h-8 w-8 sm:h-9 sm:w-9",variant:"destructive",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this testimonial?"))try{const{error:s}=await c.from("testimonials").delete().eq("id",e);if(s)throw s;p()}catch(s){console.error("Error deleting testimonial:",s),alert("Error deleting testimonial: "+s.message)}})(s.id),children:e.jsx(V,{className:"w-4 h-4"})})]})]})}),e.jsxs(C,{children:[e.jsxs("p",{className:"italic text-text-secondary",children:['"',s.quote,'"']}),s.category&&e.jsxs("p",{className:"text-xs text-text-secondary mt-2",children:["Category: ",s.category]})]})]},s.id))}),e.jsx(as,{open:o,onOpenChange:u,children:e.jsxs(ts,{className:"glass-effect custom-scrollbar max-w-[95vw] sm:max-w-2xl lg:max-w-4xl xl:max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsx(rs,{children:e.jsx(is,{className:"text-base sm:text-lg lg:text-xl",children:l?.id?"Edit Testimonial":"Create New Testimonial"})}),l&&e.jsxs("div",{className:"space-y-4 min-w-0 max-w-full",children:[e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsx(m,{className:"text-sm",children:"Customer Name *"}),e.jsx(x,{value:l.customer_name,onChange:e=>n({...l,customer_name:e.target.value}),placeholder:"John Doe",className:"w-full min-w-0 text-base",style:{fontSize:"16px"}})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 min-w-0",children:[e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsx(m,{className:"text-sm",children:"Title/Role"}),e.jsx(x,{value:l.customer_title||"",onChange:e=>n({...l,customer_title:e.target.value}),placeholder:"CEO, Fitness Enthusiast, etc.",className:"w-full min-w-0 text-base",style:{fontSize:"16px"}})]}),e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsx(m,{className:"text-sm",children:"Company"}),e.jsx(x,{value:l.customer_company||"",onChange:e=>n({...l,customer_company:e.target.value}),placeholder:"Company Name",className:"w-full min-w-0 text-base",style:{fontSize:"16px"}})]})]}),e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsx(m,{className:"text-sm",children:"Quote *"}),e.jsx(h,{value:l.quote,onChange:e=>n({...l,quote:e.target.value}),placeholder:"Short testimonial quote...",className:"w-full min-w-0 resize-none text-base",style:{fontSize:"16px"},rows:3})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 min-w-0",children:[e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsx(m,{className:"text-sm",children:"Rating"}),e.jsxs(ds,{value:l.rating?.toString()||"5",onValueChange:e=>n({...l,rating:parseInt(e)}),children:[e.jsx(ms,{className:"glass-effect w-full min-w-0 text-base",children:e.jsx(xs,{})}),e.jsxs(hs,{className:"glass-effect max-w-[90vw]",children:[e.jsx(us,{value:"5",children:"5 Stars"}),e.jsx(us,{value:"4",children:"4 Stars"}),e.jsx(us,{value:"3",children:"3 Stars"}),e.jsx(us,{value:"2",children:"2 Stars"}),e.jsx(us,{value:"1",children:"1 Star"})]})]})]}),e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsx(m,{className:"text-sm",children:"Category"}),e.jsxs(ds,{value:l.category,onValueChange:e=>n({...l,category:e}),children:[e.jsx(ms,{className:"glass-effect w-full min-w-0 text-base",children:e.jsx(xs,{})}),e.jsxs(hs,{className:"glass-effect max-w-[90vw]",children:[e.jsx(us,{value:"general",children:"General"}),e.jsx(us,{value:"weight_loss",children:"Weight Loss"}),e.jsx(us,{value:"muscle_gain",children:"Muscle Gain"}),e.jsx(us,{value:"health",children:"Health"}),e.jsx(us,{value:"fitness",children:"Fitness"}),e.jsx(us,{value:"nutrition",children:"Nutrition"})]})]})]})]}),e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Cs,{checked:l.is_featured,onCheckedChange:e=>n({...l,is_featured:e})}),e.jsx(m,{className:"text-sm",children:"Featured (show on homepage)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Cs,{checked:l.is_verified,onCheckedChange:e=>n({...l,is_verified:e})}),e.jsx(m,{className:"text-sm",children:"Verified"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Cs,{checked:l.is_approved,onCheckedChange:e=>n({...l,is_approved:e})}),e.jsx(m,{className:"text-sm",children:"Approved (visible on website)"})]})]})]}),e.jsxs(ns,{className:"flex flex-wrap gap-2 sm:gap-3",children:[e.jsxs(d,{variant:"outline",onClick:()=>u(!1),size:"sm",className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(d,{onClick:async()=>{try{if(!l.customer_name||!l.quote)return void alert("Customer name and quote are required");if(l.id){const{error:e}=await c.from("testimonials").update({customer_name:l.customer_name,customer_title:l.customer_title,customer_company:l.customer_company,quote:l.quote,rating:l.rating,category:l.category,is_featured:l.is_featured,is_approved:l.is_approved,is_verified:l.is_verified}).eq("id",l.id);if(e)throw e}else{const{error:e}=await c.from("testimonials").insert([l]);if(e)throw e}u(!1),n(null),p()}catch(e){console.error("Error saving testimonial:",e),alert("Error saving testimonial: "+e.message)}},size:"sm",className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Save Testimonial"]})]})]})})]})},Ra=()=>{const[s,a]=i.useState(null),[t,r]=i.useState(!0),[l,n]=i.useState(!1),o=async()=>{try{r(!0);const{data:e,error:s}=await c.from("contact_info").select("*").eq("is_active",!0).single();if(s&&"PGRST116"!==s.code)throw s;a(e||{email:"",phone:"",address:"",city:"",state:"",country:"",postal_code:"",facebook_url:"",twitter_url:"",instagram_url:"",linkedin_url:"",youtube_url:"",tiktok_url:"",is_active:!0})}catch(e){console.error("Error fetching contact info:",e),alert("Error loading contact info: "+e.message)}finally{r(!1)}};i.useEffect(()=>{o()},[]);const h=(e,t)=>{a({...s,[e]:t})};return t?e.jsx("div",{className:"p-6",children:"Loading contact information..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Contact Information Manager"}),e.jsx("p",{className:"text-text-secondary mt-1",children:"Update contact details and social media links"})]}),e.jsxs(d,{onClick:async()=>{try{if(n(!0),s.id){const{error:e}=await c.from("contact_info").update({email:s.email,phone:s.phone,address:s.address,city:s.city,state:s.state,country:s.country,postal_code:s.postal_code,facebook_url:s.facebook_url,twitter_url:s.twitter_url,instagram_url:s.instagram_url,linkedin_url:s.linkedin_url,youtube_url:s.youtube_url,tiktok_url:s.tiktok_url}).eq("id",s.id);if(e)throw e}else{const{error:e}=await c.from("contact_info").insert([s]);if(e)throw e}alert("Contact information saved successfully!"),o()}catch(e){console.error("Error saving contact info:",e),alert("Error saving contact info: "+e.message)}finally{n(!1)}},disabled:l,children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),l?"Saving...":"Save Changes"]})]}),s&&e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(_,{children:[e.jsx(k,{children:e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5"}),"Contact Details"]})}),e.jsx(C,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Email Address"}),e.jsx(x,{type:"email",value:s.email||"",onChange:e=>h("email",e.target.value),placeholder:"support@example.com"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Phone Number"}),e.jsx(x,{type:"tel",value:s.phone||"",onChange:e=>h("phone",e.target.value),placeholder:"+1 (555) 123-4567"})]})]})})]}),e.jsxs(_,{children:[e.jsx(k,{children:e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5"}),"Physical Address"]})}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Street Address"}),e.jsx(x,{value:s.address||"",onChange:e=>h("address",e.target.value),placeholder:"123 Main Street"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"City"}),e.jsx(x,{value:s.city||"",onChange:e=>h("city",e.target.value),placeholder:"San Francisco"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"State/Province"}),e.jsx(x,{value:s.state||"",onChange:e=>h("state",e.target.value),placeholder:"CA"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Postal Code"}),e.jsx(x,{value:s.postal_code||"",onChange:e=>h("postal_code",e.target.value),placeholder:"94102"})]})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Country"}),e.jsx(x,{value:s.country||"",onChange:e=>h("country",e.target.value),placeholder:"USA"})]})]})]}),e.jsxs(_,{children:[e.jsx(k,{children:e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5"}),"Social Media Links"]})}),e.jsx(C,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Facebook URL"}),e.jsx(x,{type:"url",value:s.facebook_url||"",onChange:e=>h("facebook_url",e.target.value),placeholder:"https://facebook.com/yourpage"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Twitter/X URL"}),e.jsx(x,{type:"url",value:s.twitter_url||"",onChange:e=>h("twitter_url",e.target.value),placeholder:"https://twitter.com/yourhandle"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Instagram URL"}),e.jsx(x,{type:"url",value:s.instagram_url||"",onChange:e=>h("instagram_url",e.target.value),placeholder:"https://instagram.com/yourhandle"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"LinkedIn URL"}),e.jsx(x,{type:"url",value:s.linkedin_url||"",onChange:e=>h("linkedin_url",e.target.value),placeholder:"https://linkedin.com/company/yourcompany"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"YouTube URL"}),e.jsx(x,{type:"url",value:s.youtube_url||"",onChange:e=>h("youtube_url",e.target.value),placeholder:"https://youtube.com/@yourchannel"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"TikTok URL"}),e.jsx(x,{type:"url",value:s.tiktok_url||"",onChange:e=>h("tiktok_url",e.target.value),placeholder:"https://tiktok.com/@yourhandle"})]})]})})]})]})]})},qa=()=>{const[s,a]=i.useState([]),[t,r]=i.useState(!0),[l,n]=i.useState(null),[o,u]=i.useState(!1),p=async()=>{try{r(!0);const{data:e,error:s}=await c.from("seo_settings").select("*").order("page_path",{ascending:!0});if(s)throw s;a(e||[])}catch(e){console.error("Error fetching SEO settings:",e),alert("Error loading SEO settings: "+e.message)}finally{r(!1)}};i.useEffect(()=>{p()},[]);const g=(e,s)=>{n({...l,[e]:s})};return t?e.jsx("div",{className:"p-6",children:"Loading SEO settings..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"SEO Settings Manager"}),e.jsx("p",{className:"text-text-secondary mt-1",children:"Manage meta tags and SEO for each page"})]}),e.jsxs(d,{onClick:()=>{n({page_path:"/",page_name:"",meta_title:"",meta_description:"",og_title:"",og_description:"",og_image_url:"",twitter_title:"",twitter_description:"",twitter_image_url:"",canonical_url:"",robots_meta:"index,follow",sitemap_priority:.5,sitemap_changefreq:"weekly",is_active:!0}),u(!0)},children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Add Page SEO"]})]}),e.jsx("div",{className:"grid gap-4",children:0===s.length?e.jsx(_,{children:e.jsx(C,{className:"p-6",children:e.jsx("p",{className:"text-center text-text-secondary",children:'No SEO settings yet. Click "Add Page SEO" to create one.'})})}):s.map(s=>e.jsxs(_,{className:s.is_active?"":"opacity-60",children:[e.jsx(k,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(S,{className:"flex items-center gap-2",children:[s.page_name,e.jsx("span",{className:"text-xs font-normal px-2 py-1 bg-primary/10 rounded",children:s.page_path}),!s.is_active&&e.jsx("span",{className:"text-xs font-normal px-2 py-1 bg-gray-500/10 text-gray-600 rounded",children:"Inactive"})]}),s.meta_description&&e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:s.meta_description})]}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>(e=>{n({...e}),u(!0)})(s),children:e.jsx(Ee,{className:"w-4 h-4"})})]})}),e.jsx(C,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Meta Title:"}),e.jsx("p",{className:"text-text-secondary",children:s.meta_title||"Not set"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Sitemap Priority:"}),e.jsxs("p",{className:"text-text-secondary",children:[s.sitemap_priority," (",s.sitemap_changefreq,")"]})]})]})})]},s.id))}),e.jsx(as,{open:o,onOpenChange:u,children:e.jsxs(ts,{className:"glass-effect max-w-3xl lg:max-w-4xl xl:max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsx(rs,{children:e.jsx(is,{children:l?.id?"Edit SEO Settings":"Create New SEO Settings"})}),l&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold",children:"Page Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Page Path *"}),e.jsx(x,{value:l.page_path,onChange:e=>g("page_path",e.target.value),placeholder:"/about"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Page Name *"}),e.jsx(x,{value:l.page_name,onChange:e=>g("page_name",e.target.value),placeholder:"About Page"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold",children:"Meta Tags"}),e.jsxs("div",{children:[e.jsx(m,{children:"Meta Title"}),e.jsx(x,{value:l.meta_title||"",onChange:e=>g("meta_title",e.target.value),placeholder:"Page Title - Site Name"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Meta Description"}),e.jsx(h,{value:l.meta_description||"",onChange:e=>g("meta_description",e.target.value),placeholder:"Brief description of the page (150-160 characters)",rows:2})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold",children:"Open Graph (Facebook)"}),e.jsxs("div",{children:[e.jsx(m,{children:"OG Title"}),e.jsx(x,{value:l.og_title||"",onChange:e=>g("og_title",e.target.value),placeholder:"Title for social media sharing"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"OG Description"}),e.jsx(h,{value:l.og_description||"",onChange:e=>g("og_description",e.target.value),placeholder:"Description for social media sharing",rows:2})]}),e.jsxs("div",{children:[e.jsx(m,{children:"OG Image URL"}),e.jsx(x,{type:"url",value:l.og_image_url||"",onChange:e=>g("og_image_url",e.target.value),placeholder:"https://example.com/image.jpg"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold",children:"Twitter Card"}),e.jsxs("div",{children:[e.jsx(m,{children:"Twitter Title"}),e.jsx(x,{value:l.twitter_title||"",onChange:e=>g("twitter_title",e.target.value),placeholder:"Title for Twitter"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Twitter Description"}),e.jsx(h,{value:l.twitter_description||"",onChange:e=>g("twitter_description",e.target.value),placeholder:"Description for Twitter",rows:2})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Twitter Image URL"}),e.jsx(x,{type:"url",value:l.twitter_image_url||"",onChange:e=>g("twitter_image_url",e.target.value),placeholder:"https://example.com/image.jpg"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold",children:"Advanced Settings"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Canonical URL"}),e.jsx(x,{type:"url",value:l.canonical_url||"",onChange:e=>g("canonical_url",e.target.value),placeholder:"https://example.com/page"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Robots Meta"}),e.jsx(x,{value:l.robots_meta,onChange:e=>g("robots_meta",e.target.value),placeholder:"index,follow"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Sitemap Priority (0.0-1.0)"}),e.jsx(x,{type:"number",step:"0.1",min:"0",max:"1",value:l.sitemap_priority,onChange:e=>g("sitemap_priority",parseFloat(e.target.value))})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Change Frequency"}),e.jsxs("select",{className:"w-full border rounded px-3 py-2",value:l.sitemap_changefreq,onChange:e=>g("sitemap_changefreq",e.target.value),children:[e.jsx("option",{value:"always",children:"Always"}),e.jsx("option",{value:"hourly",children:"Hourly"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"yearly",children:"Yearly"}),e.jsx("option",{value:"never",children:"Never"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Cs,{checked:l.is_active,onCheckedChange:e=>g("is_active",e)}),e.jsx(m,{children:"Active"})]})]})]}),e.jsxs(ns,{children:[e.jsxs(d,{variant:"outline",onClick:()=>u(!1),children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(d,{onClick:async()=>{try{if(!l.page_path||!l.page_name)return void alert("Page path and name are required");if(l.id){const{error:e}=await c.from("seo_settings").update({page_path:l.page_path,page_name:l.page_name,meta_title:l.meta_title,meta_description:l.meta_description,og_title:l.og_title,og_description:l.og_description,og_image_url:l.og_image_url,twitter_title:l.twitter_title,twitter_description:l.twitter_description,twitter_image_url:l.twitter_image_url,canonical_url:l.canonical_url,robots_meta:l.robots_meta,sitemap_priority:l.sitemap_priority,sitemap_changefreq:l.sitemap_changefreq,is_active:l.is_active}).eq("id",l.id);if(e)throw e}else{const{error:e}=await c.from("seo_settings").insert([l]);if(e)throw e}u(!1),n(null),p()}catch(e){console.error("Error saving SEO settings:",e),alert("Error saving SEO settings: "+e.message)}},children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Save Settings"]})]})]})})]})},za=[{question:"What is GreenoFig and how does it work?",answer:"GreenoFig is an AI-powered health and wellness platform that creates personalized meal plans, workout routines, and provides 24/7 AI coaching. Simply complete our onboarding survey, and our AI will generate a customized plan based on your goals, dietary preferences, and fitness level."},{question:"How much does GreenoFig cost?",answer:"We offer three subscription tiers: Premium ($9.99/month), Pro ($19.99/month), and Elite ($29.99/month). All plans include access to personalized meal plans and workouts. Higher tiers unlock features like AI coach chat, wearable integration, and photo food recognition. Save 25% with annual billing!"},{question:"Can I cancel my subscription at any time?",answer:"Yes! You can cancel your GreenoFig subscription at any time from your account settings. There are no cancellation fees, and you'll continue to have access until the end of your current billing period."},{question:"Is GreenoFig suitable for people with dietary restrictions?",answer:"Absolutely! GreenoFig supports various dietary preferences including vegan, vegetarian, keto, paleo, gluten-free, dairy-free, and more. During onboarding, you can specify your dietary restrictions and food allergies, and our AI will create meal plans that fit your needs."},{question:"Do I need special equipment for the workout plans?",answer:"No special equipment is required! Our AI generates workout plans based on what you have available. During setup, you can specify if you have access to a gym, home equipment, or prefer bodyweight exercises only. The AI adapts accordingly."},{question:"How does the AI coach work?",answer:"Our AI coach (available in Pro and Elite plans) is available 24/7 to answer questions, provide motivation, and help you stay on track. You can chat about nutrition, workouts, progress, or general health questions. The AI learns from your interactions to provide increasingly personalized guidance."},{question:"Can I sync GreenoFig with my fitness tracker or smartwatch?",answer:"Yes! Pro and Elite plans include wearable integration. GreenoFig syncs with popular devices like Apple Watch, Fitbit, Garmin, and more. This allows us to track your activity, calories burned, and sleep patterns to optimize your personalized plan."},{question:"What makes GreenoFig different from other health apps?",answer:"GreenoFig combines advanced AI with comprehensive wellness features. Unlike basic calorie counters or generic workout apps, we provide hyper-personalized meal plans, adaptive workouts, 24/7 AI coaching, and real-time plan adjustments based on your progress. Everything is tailored specifically to you."},{question:"Is my health data secure and private?",answer:"Yes, your privacy is our top priority. We use industry-standard encryption to protect your data. We never sell your personal information to third parties. All health data is stored securely and used only to personalize your experience. See our Privacy Policy for full details."},{question:"How quickly will I see results?",answer:"Results vary based on your goals and commitment, but most users report feeling more energized within the first week and seeing physical changes within 2-4 weeks. Our AI tracks your progress and adjusts your plan to ensure steady, sustainable results. Consistency is key!"}],La=({pageKey:s,pageName:a})=>{const[t,r]=i.useState(null),[l,n]=i.useState(!0),u=i.useCallback(async()=>{n(!0);const{data:e,error:t}=await c.from("site_content").select("content").eq("page_key",s).single();t&&"PGRST116"!==t.code?o({title:`Error fetching ${a} content`,description:t.message,variant:"destructive"}):r("faq_page"===s?e?.content||{faqs:[]}:"privacy_policy"===s||"terms_of_service"===s?e?.content||{sections:[]}:"about_page"===s?e?.content||{title:"",description:"",sections:[]}:e?.content||{}),n(!1)},[s,a]);i.useEffect(()=>{u()},[u]);const p=(e,s,a)=>{const i=[...t.faqs];i[e][s]=a,r({...t,faqs:i})},g=(e,s)=>{r(a=>({...a,[e]:s}))},j=(e,s,a)=>{const i=[...t.sections||[]];i[e][s]=a,r({...t,sections:i})},f=()=>{r({...t,sections:[...t.sections||[],{title:"",content:""}]})},v=e=>{const s=(t.sections||[]).filter((s,a)=>a!==e);r({...t,sections:s})};return l?e.jsxs("div",{className:"flex items-center justify-center py-10",children:[e.jsx(we,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-4 text-lg",children:"Loading Content..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"faq_page"===s?"FAQ Page Manager":"about_page"===s?"About Us Page Manager":"privacy_policy"===s?"Privacy Policy Manager":"terms_of_service"===s?"Terms of Service Manager":`Manage ${a}`}),e.jsxs("div",{className:"flex gap-2",children:["faq_page"===s&&e.jsxs(d,{onClick:()=>{r({faqs:za}),o({title:"âœ… 10 Default FAQs loaded!",description:'âš ï¸ IMPORTANT: Click "Save Content" button now to store them in the database!',duration:1e4})},variant:"outline",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Load 10 Default FAQs"]}),e.jsx(d,{onClick:async()=>{console.log("Saving content:",{page_key:s,content:t});const{data:e,error:r}=await c.from("site_content").upsert({page_key:s,content:t},{onConflict:"page_key"}).select();r?(console.error("Save error:",r),o({title:`Error saving ${a} content`,description:`${r.message} (Code: ${r.code})`,variant:"destructive"})):(console.log("Save successful:",e),o({title:`${a} content saved successfully`}))},children:"Save Content"})]})]}),"about_page"===s&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(_,{className:"glass-effect p-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"about-title",children:"Page Title"}),e.jsx(x,{id:"about-title",value:t?.title||"",onChange:e=>g("title",e.target.value),placeholder:"e.g., About GreenoFig"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"about-description",children:"Page Description"}),e.jsx(h,{id:"about-description",value:t?.description||"",onChange:e=>g("description",e.target.value),rows:3,placeholder:"Brief description that appears below the title"})]})]}),e.jsx("div",{className:"glass-effect p-4 rounded-lg",children:e.jsxs("p",{className:"text-text-secondary",children:[e.jsx("strong",{children:"Total Sections:"})," ",t?.sections?.length||0]})}),t?.sections?.map((s,a)=>e.jsx(_,{className:"glass-effect",children:e.jsxs(C,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-lg font-bold text-primary",children:["Section #",a+1]}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>v(a),className:"text-red-400 hover:text-red-500",children:e.jsx(V,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:`about-section-title-${a}`,children:"Section Title"}),e.jsx(x,{id:`about-section-title-${a}`,value:s.title,onChange:e=>j(a,"title",e.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:`about-section-content-${a}`,children:"Section Content"}),e.jsx(h,{id:`about-section-content-${a}`,value:s.content,onChange:e=>j(a,"content",e.target.value),rows:6})]})]})},a)),e.jsxs(d,{onClick:f,variant:"outline",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Add Section"]})]}),"faq_page"===s&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"glass-effect p-4 rounded-lg",children:e.jsxs("p",{className:"text-text-secondary",children:[e.jsx("strong",{children:"Total FAQs:"})," ",t?.faqs?.length||0]})}),t?.faqs?.map((s,a)=>e.jsx(_,{className:"glass-effect",children:e.jsxs(C,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-lg font-bold text-primary",children:["FAQ #",a+1]}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>(e=>{const s=t.faqs.filter((s,a)=>a!==e);r({...t,faqs:s})})(a),className:"text-red-400 hover:text-red-500",children:e.jsx(V,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:`question-${a}`,children:"Question"}),e.jsx(x,{id:`question-${a}`,value:s.question,onChange:e=>p(a,"question",e.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:`answer-${a}`,children:"Answer"}),e.jsx(h,{id:`answer-${a}`,value:s.answer,onChange:e=>p(a,"answer",e.target.value),rows:4})]})]})},a)),e.jsxs(d,{onClick:()=>{r({...t,faqs:[...t.faqs||[],{question:"",answer:""}]})},variant:"outline",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Add FAQ"]})]}),("privacy_policy"===s||"terms_of_service"===s)&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"glass-effect p-4 rounded-lg",children:e.jsxs("p",{className:"text-text-secondary",children:[e.jsx("strong",{children:"Total Sections:"})," ",t?.sections?.length||0]})}),t?.sections?.map((s,a)=>e.jsx(_,{className:"glass-effect",children:e.jsxs(C,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-lg font-bold text-primary",children:["Section #",a+1]}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>v(a),className:"text-red-400 hover:text-red-500",children:e.jsx(V,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:`section-title-${a}`,children:"Section Title"}),e.jsx(x,{id:`section-title-${a}`,value:s.title,onChange:e=>j(a,"title",e.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:`section-content-${a}`,children:"Section Content"}),e.jsx(h,{id:`section-content-${a}`,value:s.content,onChange:e=>j(a,"content",e.target.value),rows:6})]})]})},a)),e.jsxs(d,{onClick:f,variant:"outline",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Add Section"]})]})]})},Da=()=>{const s=l();n();const[a,t]=i.useState("main"),[r,c]=i.useState(""),o={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},m={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}},x=e=>{c(e),t("siteContent")};return e.jsxs(I.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3},children:["main"!==a&&e.jsxs(d,{size:"sm",className:"h-9 px-3 text-sm",variant:"ghost",onClick:()=>t("main"),className:"mb-6",children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Back to Website Management"]}),(()=>{switch(a){case"features":return e.jsx(Ea,{});case"pricing":return e.jsx(Ta,{});case"homepage":return e.jsx(Ia,{});case"testimonials":return e.jsx(Ma,{});case"contact":return e.jsx(Ra,{});case"seo":return e.jsx(qa,{});case"siteContent":return e.jsx(La,{pageKey:r,pageName:`${r.charAt(0).toUpperCase()+r.slice(1)} Page`});default:return e.jsxs(I.div,{variants:o,initial:"hidden",animate:"visible",className:"space-y-6",children:[e.jsx(I.div,{variants:m,children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl lg:text-2xl font-bold",children:"Website Content Management"}),e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary mt-1",children:"Update content across your public-facing website pages."})]}),e.jsxs(d,{size:"sm",className:"h-9 px-3 text-sm",variant:"ghost",onClick:()=>s("/app/admin?tab=dashboard"),children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]})]})}),e.jsxs(I.div,{variants:m,className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4",children:[e.jsxs(_,{className:"glass-effect hover:border-primary/50 transition-colors",children:[e.jsx(k,{children:e.jsxs(S,{className:"flex items-center gap-3",children:[e.jsx(Re,{className:"w-6 h-6 text-primary"}),e.jsx("span",{children:"Homepage"})]})}),e.jsxs(C,{className:"p-4 sm:p-6",children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary mb-4",children:"Manage homepage sections, hero, CTAs, and content blocks."}),e.jsx(d,{size:"sm",className:"h-9 px-3 text-sm",onClick:()=>t("homepage"),children:"Manage Homepage"})]})]}),e.jsxs(_,{className:"glass-effect hover:border-primary/50 transition-colors",children:[e.jsx(k,{children:e.jsxs(S,{className:"flex items-center gap-3",children:[e.jsx(le,{className:"w-6 h-6 text-primary"}),e.jsx("span",{children:"Features Page"})]})}),e.jsxs(C,{className:"p-4 sm:p-6",children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary mb-4",children:"Manage the list of features displayed on the features page."}),e.jsx(d,{size:"sm",className:"h-9 px-3 text-sm",onClick:()=>t("features"),children:"Manage Features"})]})]}),e.jsxs(_,{className:"glass-effect hover:border-primary/50 transition-colors",children:[e.jsx(k,{children:e.jsxs(S,{className:"flex items-center gap-3",children:[e.jsx(T,{className:"w-6 h-6 text-primary"}),e.jsx("span",{children:"Pricing Page"})]})}),e.jsxs(C,{className:"p-4 sm:p-6",children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary mb-4",children:"Update pricing plans, features, and popular status."}),e.jsx(d,{size:"sm",className:"h-9 px-3 text-sm",onClick:()=>t("pricing"),children:"Manage Pricing"})]})]}),e.jsxs(_,{className:"glass-effect hover:border-primary/50 transition-colors",children:[e.jsx(k,{children:e.jsxs(S,{className:"flex items-center gap-3",children:[e.jsx(Se,{className:"w-6 h-6 text-primary"}),e.jsx("span",{children:"Testimonials"})]})}),e.jsxs(C,{className:"p-4 sm:p-6",children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary mb-4",children:"Manage customer reviews, ratings, and testimonials."}),e.jsx(d,{size:"sm",className:"h-9 px-3 text-sm",onClick:()=>t("testimonials"),children:"Manage Testimonials"})]})]}),e.jsxs(_,{className:"glass-effect hover:border-primary/50 transition-colors",children:[e.jsx(k,{children:e.jsxs(S,{className:"flex items-center gap-3",children:[e.jsx(qe,{className:"w-6 h-6 text-primary"}),e.jsx("span",{children:"Contact Info"})]})}),e.jsxs(C,{className:"p-4 sm:p-6",children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary mb-4",children:"Update contact details, social links, and business hours."}),e.jsx(d,{size:"sm",className:"h-9 px-3 text-sm",onClick:()=>t("contact"),children:"Manage Contact"})]})]}),e.jsxs(_,{className:"glass-effect hover:border-primary/50 transition-colors",children:[e.jsx(k,{children:e.jsxs(S,{className:"flex items-center gap-3",children:[e.jsx($,{className:"w-6 h-6 text-primary"}),e.jsx("span",{children:"SEO Settings"})]})}),e.jsxs(C,{className:"p-4 sm:p-6",children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary mb-4",children:"Manage meta tags, Open Graph, and SEO for all pages."}),e.jsx(d,{size:"sm",className:"h-9 px-3 text-sm",onClick:()=>t("seo"),children:"Manage SEO"})]})]}),e.jsxs(_,{className:"glass-effect hover:border-primary/50 transition-colors",children:[e.jsx(k,{children:e.jsxs(S,{className:"flex items-center gap-3",children:[e.jsx(ze,{className:"w-6 h-6 text-primary"}),e.jsx("span",{children:"About Page"})]})}),e.jsxs(C,{className:"p-4 sm:p-6",children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary mb-4",children:"Edit the content of the About Us page."}),e.jsx(d,{size:"sm",className:"h-9 px-3 text-sm",onClick:()=>x("about_page"),children:"Manage About Page"})]})]}),e.jsxs(_,{className:"glass-effect hover:border-primary/50 transition-colors",children:[e.jsx(k,{children:e.jsxs(S,{className:"flex items-center gap-3",children:[e.jsx(Le,{className:"w-6 h-6 text-primary"}),e.jsx("span",{children:"FAQ Page"})]})}),e.jsxs(C,{className:"p-4 sm:p-6",children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary mb-4",children:"Add, edit, or remove FAQ items."}),e.jsx(d,{size:"sm",className:"h-9 px-3 text-sm",onClick:()=>x("faq_page"),children:"Manage FAQs"})]})]}),e.jsxs(_,{className:"glass-effect hover:border-primary/50 transition-colors",children:[e.jsx(k,{children:e.jsxs(S,{className:"flex items-center gap-3",children:[e.jsx(De,{className:"w-6 h-6 text-primary"}),e.jsx("span",{children:"Privacy Policy"})]})}),e.jsxs(C,{className:"p-4 sm:p-6",children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary mb-4",children:"Edit Privacy Policy content and sections."}),e.jsx(d,{size:"sm",className:"h-9 px-3 text-sm",onClick:()=>x("privacy_policy"),children:"Manage Privacy Policy"})]})]}),e.jsxs(_,{className:"glass-effect hover:border-primary/50 transition-colors",children:[e.jsx(k,{children:e.jsxs(S,{className:"flex items-center gap-3",children:[e.jsx(Ue,{className:"w-6 h-6 text-primary"}),e.jsx("span",{children:"Terms of Service"})]})}),e.jsxs(C,{className:"p-4 sm:p-6",children:[e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary mb-4",children:"Edit Terms of Service content and sections."}),e.jsx(d,{size:"sm",className:"h-9 px-3 text-sm",onClick:()=>x("terms_of_service"),children:"Manage Terms of Service"})]})]})]})]})}})()]},a)},Ua=()=>{const[s,a]=i.useState([]),[t,r]=i.useState([]),[l,n]=i.useState(!0),[u,p]=i.useState(""),[g,j]=i.useState(!1),[f,y]=i.useState(null),[N,w]=i.useState({code:"",discountType:"percentage",discountValue:"",isRecurring:!1,maxUses:"",maxUsesPerUser:"1",minPurchaseAmount:"",applicablePlans:[],validFrom:(new Date).toISOString().split("T")[0],validUntil:"",description:"",internalNotes:""}),b=async()=>{n(!0);const{data:e,error:s}=await c.from("coupon_codes").select("*, coupon_redemptions(count)").order("created_at",{ascending:!1});s?o({title:"Error fetching coupons",description:s.message,variant:"destructive"}):a(e||[]),n(!1)};i.useEffect(()=>{b()},[]),i.useEffect(()=>{const e=s.filter(e=>e.code.toLowerCase().includes(u.toLowerCase())||e.description?.toLowerCase().includes(u.toLowerCase()));r(e)},[u,s]);const k=()=>{w({code:"",discountType:"percentage",discountValue:"",isRecurring:!1,maxUses:"",maxUsesPerUser:"1",minPurchaseAmount:"",applicablePlans:[],validFrom:(new Date).toISOString().split("T")[0],validUntil:"",description:"",internalNotes:""}),y(null)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl lg:text-2xl font-bold",children:"Coupon Codes"}),e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary mt-1",children:"Create and manage discount codes"})]}),e.jsx("div",{className:"flex gap-2 ml-auto",children:e.jsxs(d,{size:"sm",className:"h-9 px-3 text-sm",onClick:()=>{k(),j(!0)},children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"New Coupon"]})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(x,{placeholder:"Search coupons...",value:u,onChange:e=>p(e.target.value),className:"pl-10 glass-effect"})]}),l?e.jsx("div",{className:"text-center py-8",children:"Loading coupons..."}):e.jsxs("div",{className:"grid gap-4",children:[t.map(s=>e.jsx(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5 text-primary"}),e.jsx("code",{className:"text-xl font-bold",children:s.code})]}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>{return e=s.code,navigator.clipboard.writeText(e),void o({title:"Code copied to clipboard!"});var e},className:"h-9 w-9 p-0",children:e.jsx(Oe,{className:"w-4 h-4"})}),e.jsx(v,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"}),s.is_recurring&&e.jsx(v,{variant:"outline",children:"Recurring"})]}),s.description&&e.jsx("p",{className:"text-sm text-text-secondary mb-3",children:s.description}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:["percentage"===s.discount_type?e.jsx($e,{className:"w-4 h-4 text-green-400"}):e.jsx(T,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{children:"percentage"===s.discount_type?`${s.discount_value}% off`:`$${s.discount_value} off`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-blue-400"}),e.jsxs("span",{children:[s.current_uses,"/",s.max_uses||"âˆž"," uses"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-purple-400"}),e.jsx("span",{children:s.valid_until?`Until ${new Date(s.valid_until).toLocaleDateString()}`:"No expiry"})]}),s.min_purchase_amount&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4 text-yellow-400"}),e.jsxs("span",{children:["Min: $",s.min_purchase_amount]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>(async e=>{const{error:s}=await c.from("coupon_codes").update({is_active:!e.is_active}).eq("id",e.id);s?o({title:"Error updating coupon",description:s.message,variant:"destructive"}):(o({title:e.is_active?"Coupon deactivated":"Coupon activated"}),b())})(s),title:s.is_active?"Deactivate":"Activate",className:"h-9 w-9 p-0",children:s.is_active?e.jsx(ue,{className:"w-4 h-4 text-green-400"}):e.jsx(pe,{className:"w-4 h-4 text-gray-400"})}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>(e=>{y(e),w({code:e.code,discountType:e.discount_type,discountValue:e.discount_value.toString(),isRecurring:e.is_recurring,maxUses:e.max_uses?.toString()||"",maxUsesPerUser:e.max_uses_per_user.toString(),minPurchaseAmount:e.min_purchase_amount?.toString()||"",applicablePlans:e.applicable_plans||[],validFrom:e.valid_from?new Date(e.valid_from).toISOString().split("T")[0]:"",validUntil:e.valid_until?new Date(e.valid_until).toISOString().split("T")[0]:"",description:e.description||"",internalNotes:e.internal_notes||""}),j(!0)})(s),className:"h-9 w-9 p-0",children:e.jsx(Fe,{className:"w-4 h-4"})}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>(async e=>{const{error:s}=await c.from("coupon_codes").delete().eq("id",e);s?o({title:"Error deleting coupon",description:s.message,variant:"destructive"}):(o({title:"Coupon deleted successfully"}),b())})(s.id),className:"h-9 w-9 p-0",children:e.jsx(V,{className:"w-4 h-4 text-red-400"})})]})]})})})},s.id)),0===t.length&&e.jsx("p",{className:"text-text-secondary text-center py-8",children:"No coupons found"})]}),e.jsx(as,{open:g,onOpenChange:e=>{j(e),e||k()},children:e.jsxs(ts,{className:"glass-effect custom-scrollbar max-w-[95vw] sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(rs,{children:e.jsx(is,{className:"text-base sm:text-lg",children:f?"Edit Coupon":"Create New Coupon"})}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();const s={code:N.code.toUpperCase(),discount_type:N.discountType,discount_value:parseFloat(N.discountValue),is_recurring:N.isRecurring,max_uses:N.maxUses?parseInt(N.maxUses):null,max_uses_per_user:parseInt(N.maxUsesPerUser),min_purchase_amount:N.minPurchaseAmount?parseFloat(N.minPurchaseAmount):null,applicable_plans:N.applicablePlans.length>0?N.applicablePlans:null,valid_from:N.validFrom,valid_until:N.validUntil||null,description:N.description,internal_notes:N.internalNotes,is_active:!0};let a;if(f){a=(await c.from("coupon_codes").update(s).eq("id",f.id)).error}else{a=(await c.from("coupon_codes").insert(s)).error}a?o({title:"Error saving coupon",description:a.message,variant:"destructive"}):(o({title:f?"Coupon updated!":"Coupon created!"}),j(!1),k(),b())},className:"space-y-4 min-w-0 max-w-full",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 min-w-0",children:[e.jsxs("div",{className:"space-y-2 min-w-0 max-w-full overflow-hidden",children:[e.jsx(m,{className:"text-sm",children:"Coupon Code *"}),e.jsx(x,{value:N.code,onChange:e=>w({...N,code:e.target.value.toUpperCase()}),placeholder:"SUMMER2024",className:"glass-effect font-mono w-full min-w-0 max-w-full text-base",style:{fontSize:"16px"},required:!0})]}),e.jsxs("div",{className:"space-y-2 min-w-0 max-w-full overflow-hidden",children:[e.jsx(m,{className:"text-sm",children:"Discount Type *"}),e.jsxs(ds,{value:N.discountType,onValueChange:e=>w({...N,discountType:e}),children:[e.jsx(ms,{className:"glass-effect w-full min-w-0 max-w-full text-base",children:e.jsx(xs,{})}),e.jsxs(hs,{className:"glass-effect max-w-[90vw]",children:[e.jsx(us,{value:"percentage",children:"Percentage (%)"}),e.jsx(us,{value:"fixed_amount",children:"Fixed Amount ($)"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 min-w-0",children:[e.jsxs("div",{className:"space-y-2 min-w-0 max-w-full overflow-hidden",children:[e.jsx(m,{className:"text-sm",children:"Discount Value *"}),e.jsx(x,{type:"number",step:"0.01",value:N.discountValue,onChange:e=>w({...N,discountValue:e.target.value}),placeholder:"percentage"===N.discountType?"20":"10.00",className:"glass-effect w-full min-w-0 max-w-full text-base",style:{fontSize:"16px"},required:!0})]}),e.jsxs("div",{className:"space-y-2 min-w-0 max-w-full overflow-hidden",children:[e.jsx(m,{className:"text-sm",children:"Min Purchase Amount"}),e.jsx(x,{type:"number",step:"0.01",value:N.minPurchaseAmount,onChange:e=>w({...N,minPurchaseAmount:e.target.value}),placeholder:"50.00",className:"glass-effect w-full min-w-0 max-w-full text-base",style:{fontSize:"16px"}})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 min-w-0",children:[e.jsxs("div",{className:"space-y-2 min-w-0 max-w-full overflow-hidden",children:[e.jsx(m,{className:"text-sm",children:"Max Total Uses"}),e.jsx(x,{type:"number",value:N.maxUses,onChange:e=>w({...N,maxUses:e.target.value}),placeholder:"Unlimited",className:"glass-effect w-full min-w-0 max-w-full text-base",style:{fontSize:"16px"}})]}),e.jsxs("div",{className:"space-y-2 min-w-0 max-w-full overflow-hidden",children:[e.jsx(m,{className:"text-sm",children:"Max Uses Per User *"}),e.jsx(x,{type:"number",value:N.maxUsesPerUser,onChange:e=>w({...N,maxUsesPerUser:e.target.value}),className:"glass-effect w-full min-w-0 max-w-full text-base",style:{fontSize:"16px"},required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 min-w-0",children:[e.jsxs("div",{className:"space-y-2 min-w-0 max-w-full overflow-hidden",children:[e.jsx(m,{className:"text-sm",children:"Valid From"}),e.jsx("input",{type:"date",value:N.validFrom,onChange:e=>w({...N,validFrom:e.target.value}),className:"flex h-12 lg:h-14 w-full min-w-0 max-w-full rounded-2xl border border-input bg-background/50 backdrop-blur-sm px-4 lg:px-5 py-3 lg:py-3.5 text-base lg:text-lg text-foreground ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:border-primary disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200 hover:border-primary/50 glass-effect",style:{fontSize:"16px"}})]}),e.jsxs("div",{className:"space-y-2 min-w-0 max-w-full overflow-hidden",children:[e.jsx(m,{className:"text-sm",children:"Valid Until"}),e.jsx("input",{type:"date",value:N.validUntil,onChange:e=>w({...N,validUntil:e.target.value}),className:"flex h-12 lg:h-14 w-full min-w-0 max-w-full rounded-2xl border border-input bg-background/50 backdrop-blur-sm px-4 lg:px-5 py-3 lg:py-3.5 text-base lg:text-lg text-foreground ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:border-primary disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200 hover:border-primary/50 glass-effect",style:{fontSize:"16px"}})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:N.isRecurring,onCheckedChange:e=>w({...N,isRecurring:e})}),e.jsx(m,{className:"cursor-pointer text-sm",children:"Recurring Discount (applies to all future payments)"})]}),e.jsxs("div",{className:"space-y-2 min-w-0 max-w-full overflow-hidden",children:[e.jsx(m,{className:"text-sm",children:"Description (visible to customers)"}),e.jsx(h,{value:N.description,onChange:e=>w({...N,description:e.target.value}),placeholder:"Get 20% off your first month!",className:"glass-effect w-full min-w-0 max-w-full resize-none text-base",style:{fontSize:"16px"},rows:2})]}),e.jsxs("div",{className:"space-y-2 min-w-0 max-w-full overflow-hidden",children:[e.jsx(m,{className:"text-sm",children:"Internal Notes"}),e.jsx(h,{value:N.internalNotes,onChange:e=>w({...N,internalNotes:e.target.value}),placeholder:"Marketing campaign: Summer 2024",className:"glass-effect w-full min-w-0 max-w-full resize-none text-base",style:{fontSize:"16px"},rows:2})]}),e.jsxs(ns,{className:"flex flex-wrap gap-2 sm:gap-3",children:[e.jsx(d,{size:"sm",className:"h-9 px-3",type:"button",variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsx(d,{size:"sm",className:"h-9 px-3",type:"submit",children:f?"Update Coupon":"Create Coupon"})]})]})]})})]})},Oa=()=>{const[s,a]=i.useState([]),[t,r]=i.useState([]),[l,n]=i.useState(null),[h,u]=i.useState(!0),[p,y]=i.useState(""),[N,w]=i.useState(!1),[b,k]=i.useState("all"),[S,A]=i.useState({referrerRewardType:"credit",referrerRewardValue:"10.00",refereeRewardType:"discount_percentage",refereeRewardValue:"20.00",minRefereeSubscriptionMonths:"1"}),[P,E]=i.useState({totalReferrals:0,completedReferrals:0,pendingReferrals:0,totalRewardsGiven:0}),T=async()=>{u(!0);const{data:e,error:s}=await c.from("referrals").select("*").order("created_at",{ascending:!1});let t=[];if(e&&e.length>0){const s=[...new Set([...e.map(e=>e.referrer_id),...e.map(e=>e.referee_id)])],{data:a}=await c.from("user_profiles").select("id, full_name, email, profile_picture_url").in("id",s);t=e.map(e=>({...e,referrer:a?.find(s=>s.id===e.referrer_id),referee:a?.find(s=>s.id===e.referee_id)}))}const{data:r,error:i}=await c.from("referral_program").select("*").eq("is_active",!0).single();if(s)o({title:"Error fetching referrals",description:s.message,variant:"destructive"});else{a(t||[]);const e=t?.filter(e=>"completed"===e.status||"rewarded"===e.status).length||0,s=t?.filter(e=>"pending"===e.status).length||0;E({totalReferrals:t?.length||0,completedReferrals:e,pendingReferrals:s,totalRewardsGiven:2*e})}r&&(n(r),A({referrerRewardType:r.referrer_reward_type,referrerRewardValue:r.referrer_reward_value.toString(),refereeRewardType:r.referee_reward_type,refereeRewardValue:r.referee_reward_value.toString(),minRefereeSubscriptionMonths:r.min_referee_subscription_months.toString()})),u(!1)};i.useEffect(()=>{T()},[]),i.useEffect(()=>{let e=s;p&&(e=e.filter(e=>e.referrer?.full_name?.toLowerCase().includes(p.toLowerCase())||e.referrer?.email?.toLowerCase().includes(p.toLowerCase())||e.referee?.full_name?.toLowerCase().includes(p.toLowerCase())||e.referee?.email?.toLowerCase().includes(p.toLowerCase())||e.referral_code?.toLowerCase().includes(p.toLowerCase()))),"all"!==b&&(e=e.filter(e=>e.status===b)),r(e)},[p,b,s]);const M=s=>{const a={pending:{variant:"secondary",label:"Pending",icon:ie},completed:{variant:"default",label:"Completed",icon:ue},rewarded:{variant:"default",label:"Rewarded",icon:re}},t=a[s]||a.pending,r=t.icon;return e.jsxs(v,{variant:t.variant,className:"flex items-center gap-1",children:[e.jsx(r,{className:"w-3 h-3"}),t.label]})},R=e=>e?e.split(" ").map(e=>e[0]).join("").toUpperCase():"U";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Referral Program"}),e.jsx("p",{className:"text-text-secondary",children:"Track and manage customer referrals"})]}),e.jsxs(d,{onClick:()=>w(!0),className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4"}),"Program Settings"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Total Referrals"}),e.jsx("p",{className:"text-3xl font-bold",children:P.totalReferrals})]}),e.jsx(F,{className:"w-8 h-8 text-primary"})]})})}),e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Completed"}),e.jsx("p",{className:"text-3xl font-bold text-green-400",children:P.completedReferrals})]}),e.jsx(ue,{className:"w-8 h-8 text-green-400"})]})})}),e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Pending"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-400",children:P.pendingReferrals})]}),e.jsx(ie,{className:"w-8 h-8 text-yellow-400"})]})})}),e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Rewards Given"}),e.jsx("p",{className:"text-3xl font-bold text-purple-400",children:P.totalRewardsGiven})]}),e.jsx(Ge,{className:"w-8 h-8 text-purple-400"})]})})})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(x,{placeholder:"Search referrals...",value:p,onChange:e=>y(e.target.value),className:"pl-10 glass-effect"})]}),e.jsxs(ds,{value:b,onValueChange:k,children:[e.jsx(ms,{className:"w-[180px] glass-effect",children:e.jsx(xs,{placeholder:"Filter by status"})}),e.jsxs(hs,{className:"glass-effect",children:[e.jsx(us,{value:"all",children:"All Status"}),e.jsx(us,{value:"pending",children:"Pending"}),e.jsx(us,{value:"completed",children:"Completed"}),e.jsx(us,{value:"rewarded",children:"Rewarded"})]})]})]}),h?e.jsx("div",{className:"text-center py-8",children:"Loading referrals..."}):e.jsxs("div",{className:"space-y-4",children:[t.map(s=>e.jsx(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(g,{className:"w-10 h-10",children:[e.jsx(j,{src:s.referrer?.profile_picture_url}),e.jsx(f,{children:R(s.referrer?.full_name)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.referrer?.full_name}),e.jsx("p",{className:"text-xs text-text-secondary",children:s.referrer?.email})]})]}),e.jsx($,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(g,{className:"w-10 h-10",children:[e.jsx(j,{src:s.referee?.profile_picture_url}),e.jsx(f,{children:R(s.referee?.full_name)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.referee?.full_name}),e.jsx("p",{className:"text-xs text-text-secondary",children:s.referee?.email})]})]}),e.jsxs("div",{className:"ml-auto flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("code",{className:"text-sm font-mono bg-white/10 px-2 py-1 rounded",children:s.referral_code}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:new Date(s.created_at).toLocaleDateString()})]}),M(s.status)]})]}),"completed"===s.status&&!s.referrer_rewarded&&e.jsx(d,{size:"sm",onClick:()=>(async e=>{const{error:s}=await c.from("referrals").update({status:"rewarded",referrer_rewarded:!0,referee_rewarded:!0,referrer_rewarded_at:(new Date).toISOString(),referee_rewarded_at:(new Date).toISOString()}).eq("id",e);s?o({title:"Error updating referral",description:s.message,variant:"destructive"}):(o({title:"Referral marked as rewarded!"}),T())})(s.id),className:"ml-4",children:"Mark as Rewarded"})]})})})},s.id)),0===t.length&&e.jsx("p",{className:"text-text-secondary text-center py-8",children:"No referrals found"})]}),e.jsx(as,{open:N,onOpenChange:w,children:e.jsxs(ts,{className:"glass-effect max-w-2xl",children:[e.jsx(rs,{children:e.jsx(is,{children:"Referral Program Settings"})}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();const{error:s}=await c.from("referral_program").update({referrer_reward_type:S.referrerRewardType,referrer_reward_value:parseFloat(S.referrerRewardValue),referee_reward_type:S.refereeRewardType,referee_reward_value:parseFloat(S.refereeRewardValue),min_referee_subscription_months:parseInt(S.minRefereeSubscriptionMonths)}).eq("id",l.id);s?o({title:"Error updating settings",description:s.message,variant:"destructive"}):(o({title:"Referral program settings updated!"}),w(!1),T())},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Referrer Rewards"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Reward Type"}),e.jsxs(ds,{value:S.referrerRewardType,onValueChange:e=>A({...S,referrerRewardType:e}),children:[e.jsx(ms,{className:"glass-effect",children:e.jsx(xs,{})}),e.jsxs(hs,{className:"glass-effect",children:[e.jsx(us,{value:"credit",children:"Account Credit ($)"}),e.jsx(us,{value:"discount_percentage",children:"Discount (%)"}),e.jsx(us,{value:"free_months",children:"Free Months"})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Reward Value"}),e.jsx(x,{type:"number",step:"0.01",value:S.referrerRewardValue,onChange:e=>A({...S,referrerRewardValue:e.target.value}),className:"glass-effect",required:!0})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Referee Rewards"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Reward Type"}),e.jsxs(ds,{value:S.refereeRewardType,onValueChange:e=>A({...S,refereeRewardType:e}),children:[e.jsx(ms,{className:"glass-effect",children:e.jsx(xs,{})}),e.jsxs(hs,{className:"glass-effect",children:[e.jsx(us,{value:"credit",children:"Account Credit ($)"}),e.jsx(us,{value:"discount_percentage",children:"Discount (%)"}),e.jsx(us,{value:"free_months",children:"Free Months"})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Reward Value"}),e.jsx(x,{type:"number",step:"0.01",value:S.refereeRewardValue,onChange:e=>A({...S,refereeRewardValue:e.target.value}),className:"glass-effect",required:!0})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Minimum Subscription Months for Referee"}),e.jsx(x,{type:"number",value:S.minRefereeSubscriptionMonths,onChange:e=>A({...S,minRefereeSubscriptionMonths:e.target.value}),className:"glass-effect",required:!0}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Referee must maintain subscription for this many months before rewards are given"})]}),e.jsxs(ns,{children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsx(d,{type:"submit",children:"Update Settings"})]})]})]})})]})},$a=i.forwardRef(({className:s,...a},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:u("w-full caption-bottom text-sm",s),...a})}));$a.displayName="Table";const Ga=i.forwardRef(({className:s,...a},t)=>e.jsx("thead",{ref:t,className:u("[&_tr]:border-b",s),...a}));Ga.displayName="TableHeader";const Va=i.forwardRef(({className:s,...a},t)=>e.jsx("tbody",{ref:t,className:u("[&_tr:last-child]:border-0",s),...a}));Va.displayName="TableBody";i.forwardRef(({className:s,...a},t)=>e.jsx("tfoot",{ref:t,className:u("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...a})).displayName="TableFooter";const Ba=i.forwardRef(({className:s,...a},t)=>e.jsx("tr",{ref:t,className:u("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...a}));Ba.displayName="TableRow";const Wa=i.forwardRef(({className:s,...a},t)=>e.jsx("th",{ref:t,className:u("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...a}));Wa.displayName="TableHead";const Ha=i.forwardRef(({className:s,...a},t)=>e.jsx("td",{ref:t,className:u("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...a}));Ha.displayName="TableCell";i.forwardRef(({className:s,...a},t)=>e.jsx("caption",{ref:t,className:u("mt-4 text-sm text-muted-foreground",s),...a})).displayName="TableCaption";const Qa=({provider:s})=>{const{toast:a}=y(),[t,r]=i.useState(!1),[l,n]=i.useState({max_requests_per_user_per_day:50,max_requests_per_user_per_hour:10,enable_rate_limiting:!0,response_style:"balanced",response_length:"medium",enable_emojis:!0,language:"en",enable_content_filter:!0,prohibited_topics:[],medical_disclaimer:!0,require_user_consent:!1,welcome_message:"Hi! I'm your AI Health Coach. How can I help you today?",suggested_questions:["Give me a healthy breakfast idea","Suggest a quick 15-minute workout","How can I increase my energy levels?","What's a good way to de-stress?"],enable_typing_indicator:!0,enable_message_history:!0,webhook_url:"",enable_webhooks:!1,data_retention_days:90,enable_analytics:!0,fallback_response:"I'm having trouble responding right now. Please try again in a moment!",max_response_time_ms:1e4,enable_caching:!1,cache_duration_minutes:60,max_conversation_length:10,enable_context_memory:!0,conversation_timeout_minutes:30}),[o,u]=i.useState(""),[p,g]=i.useState("");i.useEffect(()=>{s?.id&&j()},[s]);const j=async()=>{if(!s?.id)return;const{data:e,error:a}=await c.from("ai_coach_settings").select("*").eq("id",s.id).single();e&&!a&&n(s=>({...s,...e,prohibited_topics:e.prohibited_topics||[],suggested_questions:e.suggested_questions||s.suggested_questions}))},f=async()=>{if(!s?.id)return void a({title:"Error",description:"No provider selected",variant:"destructive"});r(!0);const{error:e}=await c.from("ai_coach_settings").update(l).eq("id",s.id);a(e?{title:"Error",description:e.message,variant:"destructive"}:{title:"Success",description:"Advanced settings saved successfully"}),r(!1)},N=()=>{o.trim()&&(n(e=>({...e,prohibited_topics:[...e.prohibited_topics,o.trim()]})),u(""))},w=()=>{p.trim()&&(n(e=>({...e,suggested_questions:[...e.suggested_questions,p.trim()]})),g(""))};return s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(_e,{className:"h-6 w-6"}),"Advanced Settings"]}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:["Configure ",s.display_name," behavior and limits"]})]}),e.jsxs(d,{onClick:f,disabled:t,children:[t?e.jsx(Ve,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(G,{className:"h-4 w-4 mr-2"}),"Save All Settings"]})]}),e.jsxs(ps,{defaultValue:"rate-limiting",className:"w-full",children:[e.jsxs(gs,{className:"grid w-full grid-cols-6",children:[e.jsxs(js,{value:"rate-limiting",className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),"Rate Limits"]}),e.jsxs(js,{value:"quality",className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"h-4 w-4"}),"Quality"]}),e.jsxs(js,{value:"safety",className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-4 w-4"}),"Safety"]}),e.jsxs(js,{value:"ux",className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),"User Experience"]}),e.jsxs(js,{value:"performance",className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4"}),"Performance"]}),e.jsxs(js,{value:"integration",className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"Integration"]})]}),e.jsx(fs,{value:"rate-limiting",children:e.jsxs(_,{children:[e.jsxs(k,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5"}),"Rate Limiting & Usage Controls"]}),e.jsx(A,{children:"Prevent abuse and control API costs by limiting requests"})]}),e.jsxs(C,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-muted rounded-lg",children:[e.jsx(Cs,{id:"enable_rate_limiting",checked:l.enable_rate_limiting,onCheckedChange:e=>n(s=>({...s,enable_rate_limiting:e}))}),e.jsx(m,{htmlFor:"enable_rate_limiting",className:"cursor-pointer",children:"Enable rate limiting (recommended for production)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"max_per_day",children:"Max Requests Per User/Day"}),e.jsx(x,{id:"max_per_day",type:"number",value:l.max_requests_per_user_per_day,onChange:e=>n(s=>({...s,max_requests_per_user_per_day:parseInt(e.target.value)}))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Recommended: 50-100 for regular users"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"max_per_hour",children:"Max Requests Per User/Hour"}),e.jsx(x,{id:"max_per_hour",type:"number",value:l.max_requests_per_user_per_hour,onChange:e=>n(s=>({...s,max_requests_per_user_per_hour:parseInt(e.target.value)}))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Recommended: 10-20 to prevent spam"})]})]}),e.jsx("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-950 rounded-lg border border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ke,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400 shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-yellow-900 dark:text-yellow-100",children:"Rate Limiting Best Practices"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-yellow-800 dark:text-yellow-200",children:[e.jsx("li",{children:"â€¢ Start conservative (50/day) and increase based on usage"}),e.jsx("li",{children:"â€¢ Monitor API costs regularly"}),e.jsx("li",{children:"â€¢ Consider premium users with higher limits"}),e.jsx("li",{children:"â€¢ Track and alert on unusual spikes"})]})]})]})})]})]})}),e.jsx(fs,{value:"quality",children:e.jsxs(_,{children:[e.jsxs(k,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"h-5 w-5"}),"Response Quality & Style"]}),e.jsx(A,{children:"Control how the AI responds to users"})]}),e.jsx(C,{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"response_style",children:"Response Style"}),e.jsxs(ds,{value:l.response_style,onValueChange:e=>n(s=>({...s,response_style:e})),children:[e.jsx(ms,{children:e.jsx(xs,{})}),e.jsxs(hs,{children:[e.jsx(us,{value:"casual",children:"ðŸ˜Š Casual & Friendly"}),e.jsx(us,{value:"balanced",children:"âš–ï¸ Balanced (Recommended)"}),e.jsx(us,{value:"professional",children:"ðŸ‘” Professional"}),e.jsx(us,{value:"technical",children:"ðŸ”¬ Technical & Detailed"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"How formal or casual the AI should be"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"response_length",children:"Response Length"}),e.jsxs(ds,{value:l.response_length,onValueChange:e=>n(s=>({...s,response_length:e})),children:[e.jsx(ms,{children:e.jsx(xs,{})}),e.jsxs(hs,{children:[e.jsx(us,{value:"short",children:"ðŸ“ Short (50-100 words)"}),e.jsx(us,{value:"medium",children:"ðŸ“„ Medium (100-200 words)"}),e.jsx(us,{value:"long",children:"ðŸ“– Long (200-400 words)"}),e.jsx(us,{value:"comprehensive",children:"ðŸ“š Comprehensive (400+ words)"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Preferred response length"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"language",children:"Language"}),e.jsxs(ds,{value:l.language,onValueChange:e=>n(s=>({...s,language:e})),children:[e.jsx(ms,{children:e.jsx(xs,{})}),e.jsxs(hs,{children:[e.jsx(us,{value:"en",children:"ðŸ‡ºðŸ‡¸ English"}),e.jsx(us,{value:"es",children:"ðŸ‡ªðŸ‡¸ Spanish"}),e.jsx(us,{value:"fr",children:"ðŸ‡«ðŸ‡· French"}),e.jsx(us,{value:"de",children:"ðŸ‡©ðŸ‡ª German"}),e.jsx(us,{value:"ar",children:"ðŸ‡¸ðŸ‡¦ Arabic"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-muted rounded-lg",children:[e.jsx(Cs,{id:"enable_emojis",checked:l.enable_emojis,onCheckedChange:e=>n(s=>({...s,enable_emojis:e}))}),e.jsx(m,{htmlFor:"enable_emojis",className:"cursor-pointer",children:"Use emojis in responses ðŸ˜Š"})]})]})})]})}),e.jsx(fs,{value:"safety",children:e.jsxs(_,{children:[e.jsxs(k,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-5 w-5"}),"Safety & Moderation"]}),e.jsx(A,{children:"Control what topics the AI can discuss"})]}),e.jsxs(C,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-muted rounded-lg",children:[e.jsx(Cs,{id:"enable_content_filter",checked:l.enable_content_filter,onCheckedChange:e=>n(s=>({...s,enable_content_filter:e}))}),e.jsxs(m,{htmlFor:"enable_content_filter",className:"cursor-pointer",children:[e.jsx(Be,{className:"h-4 w-4 inline mr-1"}),"Enable content filtering"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-muted rounded-lg",children:[e.jsx(Cs,{id:"medical_disclaimer",checked:l.medical_disclaimer,onCheckedChange:e=>n(s=>({...s,medical_disclaimer:e}))}),e.jsxs(m,{htmlFor:"medical_disclaimer",className:"cursor-pointer",children:[e.jsx(ke,{className:"h-4 w-4 inline mr-1"}),"Show medical disclaimer"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Prohibited Topics"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{placeholder:"e.g., prescription drugs, surgery, etc.",value:o,onChange:e=>u(e.target.value),onKeyPress:e=>"Enter"===e.key&&N()}),e.jsx(d,{onClick:N,variant:"outline",children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:l.prohibited_topics.map((s,a)=>e.jsxs(v,{variant:"destructive",className:"cursor-pointer",onClick:()=>(e=>{n(s=>({...s,prohibited_topics:s.prohibited_topics.filter((s,a)=>a!==e)}))})(a),children:[s," Ã—"]},a))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Topics the AI should refuse to discuss (e.g., prescribing medication, diagnosing conditions)"})]}),e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-950 rounded-lg border border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(De,{className:"h-5 w-5 text-red-600 dark:text-red-400 shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-red-900 dark:text-red-100",children:"Safety Recommendations"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-red-800 dark:text-red-200",children:[e.jsx("li",{children:"â€¢ Always keep content filtering enabled"}),e.jsx("li",{children:"â€¢ Add prohibited topics for medical advice beyond general wellness"}),e.jsx("li",{children:"â€¢ Include disclaimer about consulting healthcare professionals"}),e.jsx("li",{children:"â€¢ Regularly review AI responses for quality and safety"})]})]})]})})]})]})}),e.jsx(fs,{value:"ux",children:e.jsxs(_,{children:[e.jsxs(k,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-5 w-5"}),"User Experience"]}),e.jsx(A,{children:"Customize the conversation experience"})]}),e.jsxs(C,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"welcome_message",children:"Welcome Message"}),e.jsx(h,{id:"welcome_message",value:l.welcome_message,onChange:e=>n(s=>({...s,welcome_message:e.target.value})),rows:3}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"First message users see when opening the AI Coach"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Suggested Questions"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{placeholder:"Add a suggested question...",value:p,onChange:e=>g(e.target.value),onKeyPress:e=>"Enter"===e.key&&w()}),e.jsx(d,{onClick:w,variant:"outline",children:"Add"})]}),e.jsx("div",{className:"space-y-2 mt-2",children:l.suggested_questions.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted rounded",children:[e.jsx("span",{className:"flex-1 text-sm",children:s}),e.jsx(d,{size:"sm",variant:"ghost",onClick:()=>(e=>{n(s=>({...s,suggested_questions:s.suggested_questions.filter((s,a)=>a!==e)}))})(a),children:"Ã—"})]},a))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-muted rounded-lg",children:[e.jsx(Cs,{id:"enable_typing_indicator",checked:l.enable_typing_indicator,onCheckedChange:e=>n(s=>({...s,enable_typing_indicator:e}))}),e.jsx(m,{htmlFor:"enable_typing_indicator",className:"cursor-pointer",children:"Show typing indicator"})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-muted rounded-lg",children:[e.jsx(Cs,{id:"enable_message_history",checked:l.enable_message_history,onCheckedChange:e=>n(s=>({...s,enable_message_history:e}))}),e.jsx(m,{htmlFor:"enable_message_history",className:"cursor-pointer",children:"Enable message history"})]})]})]})]})}),e.jsx(fs,{value:"performance",children:e.jsxs(_,{children:[e.jsxs(k,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Performance & Optimization"]}),e.jsx(A,{children:"Optimize AI response speed and reliability"})]}),e.jsxs(C,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"max_response_time",children:"Max Response Time (ms)"}),e.jsx(x,{id:"max_response_time",type:"number",value:l.max_response_time_ms,onChange:e=>n(s=>({...s,max_response_time_ms:parseInt(e.target.value)}))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Timeout if AI takes longer than this"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"conversation_length",children:"Max Conversation Length"}),e.jsx(x,{id:"conversation_length",type:"number",value:l.max_conversation_length,onChange:e=>n(s=>({...s,max_conversation_length:parseInt(e.target.value)}))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Number of messages to remember (context)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"conversation_timeout",children:"Conversation Timeout (minutes)"}),e.jsx(x,{id:"conversation_timeout",type:"number",value:l.conversation_timeout_minutes,onChange:e=>n(s=>({...s,conversation_timeout_minutes:parseInt(e.target.value)}))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Reset context after this period of inactivity"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-muted rounded-lg",children:[e.jsx(Cs,{id:"enable_caching",checked:l.enable_caching,onCheckedChange:e=>n(s=>({...s,enable_caching:e}))}),e.jsx(m,{htmlFor:"enable_caching",className:"cursor-pointer flex-1",children:"Enable response caching (faster, cheaper)"})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-muted rounded-lg",children:[e.jsx(Cs,{id:"enable_context_memory",checked:l.enable_context_memory,onCheckedChange:e=>n(s=>({...s,enable_context_memory:e}))}),e.jsx(m,{htmlFor:"enable_context_memory",className:"cursor-pointer flex-1",children:"Remember conversation context"})]})]}),l.enable_caching&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"cache_duration",children:"Cache Duration (minutes)"}),e.jsx(x,{id:"cache_duration",type:"number",value:l.cache_duration_minutes,onChange:e=>n(s=>({...s,cache_duration_minutes:parseInt(e.target.value)}))})]})]})]})}),e.jsx(fs,{value:"integration",children:e.jsxs(_,{children:[e.jsxs(k,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Integration & Data"]}),e.jsx(A,{children:"Connect with external services and manage data"})]}),e.jsxs(C,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"fallback_response",children:"Fallback Response (Error Message)"}),e.jsx(h,{id:"fallback_response",value:l.fallback_response,onChange:e=>n(s=>({...s,fallback_response:e.target.value})),rows:2}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Shown when AI fails to respond"})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-muted rounded-lg",children:[e.jsx(Cs,{id:"enable_webhooks",checked:l.enable_webhooks,onCheckedChange:e=>n(s=>({...s,enable_webhooks:e}))}),e.jsx(m,{htmlFor:"enable_webhooks",className:"cursor-pointer",children:"Enable webhooks for external integrations"})]}),l.enable_webhooks&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"webhook_url",children:"Webhook URL"}),e.jsx(x,{id:"webhook_url",type:"url",placeholder:"https://example.com/webhook",value:l.webhook_url,onChange:e=>n(s=>({...s,webhook_url:e.target.value}))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Receive notifications when users interact with AI"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"data_retention",children:"Data Retention (days)"}),e.jsx(x,{id:"data_retention",type:"number",value:l.data_retention_days,onChange:e=>n(s=>({...s,data_retention_days:parseInt(e.target.value)}))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"How long to keep conversation history"})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-muted rounded-lg",children:[e.jsx(Cs,{id:"enable_analytics",checked:l.enable_analytics,onCheckedChange:e=>n(s=>({...s,enable_analytics:e}))}),e.jsx(m,{htmlFor:"enable_analytics",className:"cursor-pointer",children:"Track usage analytics"})]})]}),e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-950 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-blue-900 dark:text-blue-100",children:"Analytics & Insights"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-blue-800 dark:text-blue-200",children:[e.jsx("li",{children:"â€¢ Track user engagement and satisfaction"}),e.jsx("li",{children:"â€¢ Monitor AI performance and response quality"}),e.jsx("li",{children:"â€¢ Identify popular questions and topics"}),e.jsx("li",{children:"â€¢ Optimize based on usage patterns"})]})]})]})})]})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(d,{onClick:f,disabled:t,size:"lg",children:[t?e.jsx(Ve,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(G,{className:"h-4 w-4 mr-2"}),"Save All Advanced Settings"]})})]}):e.jsx(_,{children:e.jsx(C,{className:"p-8",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(_e,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Select a provider to configure advanced settings"})]})})})},Ya=()=>{const{toast:s}=y(),[a,t]=i.useState([]),[r,l]=i.useState(!0),[n,o]=i.useState(!1),[u,p]=i.useState(null),[g,j]=i.useState(null),[f,N]=i.useState({provider:"gemini",api_key:"",model_name:"",temperature:.7,max_tokens:500,display_name:"",description:"",system_prompt:"",api_endpoint:"",is_active:!1}),w={gemini:{models:["gemini-2.5-flash","gemini-2.5-pro","gemini-2.0-flash","gemini-pro-latest"],default_model:"gemini-2.5-flash",default_system_prompt:"You are a friendly and knowledgeable health and wellness AI coach for GreeonFig. Provide personalized health advice, meal suggestions, workout tips, and motivation. Keep responses concise, friendly, and actionable. Use emojis occasionally to be engaging."},openai:{models:["gpt-4o","gpt-4-turbo","gpt-4","gpt-3.5-turbo"],default_model:"gpt-3.5-turbo",default_system_prompt:"You are a professional health and wellness coach specializing in nutrition, fitness, and holistic well-being. Provide evidence-based, personalized guidance while being warm and supportive."},claude:{models:["claude-3-5-sonnet-20241022","claude-3-opus-20240229","claude-3-sonnet-20240229","claude-3-haiku-20240307"],default_model:"claude-3-haiku-20240307",default_system_prompt:"You are an empathetic health coach with expertise in nutrition, exercise, and mental wellness. Offer practical, science-backed advice in a friendly, conversational tone."}};i.useEffect(()=>{b()},[]);const b=async()=>{l(!0);const{data:e,error:a}=await c.from("ai_coach_settings").select("*").order("created_at",{ascending:!1});a?s({title:"Error",description:"Failed to load AI settings",variant:"destructive"}):t(e||[]),l(!1)},P=()=>{p(null),N({provider:"gemini",api_key:"",model_name:"",temperature:.7,max_tokens:500,display_name:"",description:"",system_prompt:"",api_endpoint:"",is_active:!1})};return r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(we,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(Ve,{className:"h-8 w-8 text-primary"}),"AI Coach Settings"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Configure AI providers for the health coaching chatbot"})]}),e.jsxs(as,{open:n,onOpenChange:e=>{o(e),e||P()},children:[e.jsx(cs,{asChild:!0,children:e.jsxs(d,{className:"gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"Add AI Provider"]})}),e.jsxs(ts,{className:"glass-effect max-w-2xl lg:max-w-4xl xl:max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(rs,{children:[e.jsx(is,{children:u?"Edit AI Provider":"Add AI Provider"}),e.jsx(ls,{children:"Configure an AI provider for the health coaching feature"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"provider",children:"Provider *"}),e.jsxs(ds,{value:f.provider,onValueChange:e=>{const s=w[e];N(a=>({...a,provider:e,model_name:s?.default_model||"",system_prompt:s?.default_system_prompt||a.system_prompt,display_name:"custom"===e?"":`${e.charAt(0).toUpperCase()+e.slice(1)} AI Coach`,description:"custom"===e?"":`Powered by ${e.charAt(0).toUpperCase()+e.slice(1)} API`}))},children:[e.jsx(ms,{className:"glass-effect",children:e.jsx(xs,{})}),e.jsxs(hs,{className:"glass-effect",children:[e.jsx(us,{value:"gemini",children:"ðŸ”® Google Gemini"}),e.jsx(us,{value:"openai",children:"ðŸ¤– OpenAI (GPT)"}),e.jsx(us,{value:"claude",children:"ðŸ§  Anthropic Claude"}),e.jsx(us,{value:"custom",children:"âš™ï¸ Custom API"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"model_name",children:"Model"}),"custom"!==f.provider&&w[f.provider]?e.jsxs(ds,{value:f.model_name,onValueChange:e=>N(s=>({...s,model_name:e})),children:[e.jsx(ms,{children:e.jsx(xs,{})}),e.jsx(hs,{children:w[f.provider].models.map(s=>e.jsx(us,{value:s,children:s},s))})]}):e.jsx(x,{id:"model_name",value:f.model_name,onChange:e=>N(s=>({...s,model_name:e.target.value})),placeholder:"e.g., custom-model-v1"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"display_name",children:"Display Name *"}),e.jsx(x,{id:"display_name",value:f.display_name,onChange:e=>N(s=>({...s,display_name:e.target.value})),placeholder:"e.g., Gemini Health Coach"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"description",children:"Description"}),e.jsx(x,{id:"description",value:f.description,onChange:e=>N(s=>({...s,description:e.target.value})),placeholder:"Brief description of this AI provider"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"api_key",children:"API Key *"}),e.jsx(x,{id:"api_key",type:"password",value:f.api_key,onChange:e=>N(s=>({...s,api_key:e.target.value})),placeholder:"Enter your API key"})]}),"custom"===f.provider&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"api_endpoint",children:"API Endpoint *"}),e.jsx(x,{id:"api_endpoint",value:f.api_endpoint,onChange:e=>N(s=>({...s,api_endpoint:e.target.value})),placeholder:"https://api.example.com/v1/chat"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"temperature",children:"Temperature"}),e.jsx(x,{id:"temperature",type:"number",step:"0.1",min:"0",max:"2",value:f.temperature,onChange:e=>N(s=>({...s,temperature:parseFloat(e.target.value)}))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"0.0 = Focused, 1.0 = Balanced, 2.0 = Creative"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"max_tokens",children:"Max Tokens"}),e.jsx(x,{id:"max_tokens",type:"number",value:f.max_tokens,onChange:e=>N(s=>({...s,max_tokens:parseInt(e.target.value)}))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Max response length (~4 chars/token)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"system_prompt",children:"System Prompt"}),e.jsx(h,{id:"system_prompt",value:f.system_prompt,onChange:e=>N(s=>({...s,system_prompt:e.target.value})),placeholder:"Instructions for the AI coach's personality and behavior...",rows:5})]}),e.jsxs("div",{className:"flex items-center space-x-2 border rounded-lg p-4 bg-muted/30",children:[e.jsx(Cs,{id:"is_active",checked:f.is_active,onCheckedChange:e=>N(s=>({...s,is_active:e}))}),e.jsx(m,{htmlFor:"is_active",className:"cursor-pointer",children:"Set as active provider (only one can be active)"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(d,{variant:"outline",onClick:()=>{o(!1),P()},children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs(d,{onClick:async()=>{if(!f.api_key||!f.display_name)return void s({title:"Validation Error",description:"API Key and Display Name are required",variant:"destructive"});f.is_active&&await c.from("ai_coach_settings").update({is_active:!1}).neq("id",u?.id||"");const e={...f};let a;if(u){a=(await c.from("ai_coach_settings").update(e).eq("id",u.id)).error}else{a=(await c.from("ai_coach_settings").insert(e)).error}a?s({title:"Error",description:a.message,variant:"destructive"}):(s({title:"Success",description:`AI provider ${u?"updated":"added"} successfully`}),o(!1),P(),b())},children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Save Provider"]})]})]})]})]}),e.jsxs(_,{children:[e.jsxs(k,{children:[e.jsx(S,{children:"Configured AI Providers"}),e.jsx(A,{children:"Manage AI providers for the health coaching chatbot. Only one can be active at a time."})]}),e.jsx(C,{children:0===a.length?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(We,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No AI providers configured yet."}),e.jsx("p",{className:"text-sm",children:'Click "Add AI Provider" to get started.'})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs($a,{children:[e.jsx(Ga,{children:e.jsxs(Ba,{children:[e.jsx(Wa,{children:"Provider"}),e.jsx(Wa,{children:"Model"}),e.jsx(Wa,{children:"Temperature"}),e.jsx(Wa,{children:"Max Tokens"}),e.jsx(Wa,{children:"Status"}),e.jsx(Wa,{className:"text-right",children:"Actions"})]})}),e.jsx(Va,{children:e.jsx(H,{children:a.map(a=>{return e.jsxs(I.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"border-b",children:[e.jsx(Ha,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:(t=a.provider,{gemini:"ðŸ”®",openai:"ðŸ¤–",claude:"ðŸ§ ",custom:"âš™ï¸"}[t]||"ðŸ¤–")}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.description})]})]})}),e.jsx(Ha,{children:e.jsx("code",{className:"text-xs bg-muted px-2 py-1 rounded",children:a.model_name||"default"})}),e.jsx(Ha,{children:a.temperature}),e.jsx(Ha,{children:a.max_tokens}),e.jsx(Ha,{children:e.jsx(v,{variant:a.is_active?"default":"secondary",className:"gap-1",children:a.is_active?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-3 w-3"})," Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-3 w-3"})," Inactive"]})})}),e.jsx(Ha,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{size:"sm",variant:a.is_active?"secondary":"default",onClick:()=>(async(e,a)=>{a||await c.from("ai_coach_settings").update({is_active:!1}).neq("id",e);const{error:t}=await c.from("ai_coach_settings").update({is_active:!a}).eq("id",e);t?s({title:"Error",description:t.message,variant:"destructive"}):(s({title:"Success",description:"AI provider "+(a?"deactivated":"activated")}),b())})(a.id,a.is_active),children:a.is_active?"Deactivate":"Activate"}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>j(a),title:"Advanced Settings",children:e.jsx(_e,{className:"h-4 w-4"})}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>(e=>{p(e),N({provider:e.provider,api_key:e.api_key,model_name:e.model_name||"",temperature:e.temperature||.7,max_tokens:e.max_tokens||500,display_name:e.display_name,description:e.description||"",system_prompt:e.system_prompt||"",api_endpoint:e.api_endpoint||"",is_active:e.is_active}),o(!0)})(a),children:e.jsx(Fe,{className:"h-4 w-4"})}),e.jsx(d,{size:"sm",variant:"destructive",onClick:()=>(async e=>{if(!confirm("Are you sure you want to delete this AI provider?"))return;const{error:a}=await c.from("ai_coach_settings").delete().eq("id",e);a?s({title:"Error",description:a.message,variant:"destructive"}):(s({title:"Deleted",description:"AI provider removed successfully"}),b())})(a.id),children:e.jsx(V,{className:"h-4 w-4"})})]})})]},a.id);var t})})})]})})})]}),g&&e.jsxs("div",{className:"mt-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Advanced Configuration"}),e.jsxs(d,{variant:"outline",onClick:()=>j(null),children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Close Advanced Settings"]})]}),e.jsx(Qa,{provider:g})]}),e.jsxs(_,{className:"bg-blue-50 dark:bg-blue-950 border-blue-200 dark:border-blue-800",children:[e.jsx(k,{children:e.jsx(S,{className:"text-blue-900 dark:text-blue-100",children:"ðŸ’¡ Tips"})}),e.jsxs(C,{className:"space-y-2 text-sm text-blue-800 dark:text-blue-200",children:[e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"Gemini:"})," Fast, free tier available (60 req/min), great for development"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"OpenAI:"})," GPT-4 for best quality, GPT-3.5-turbo for cost-effectiveness"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"Claude:"})," Excellent for empathetic responses, good context handling"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"Temperature:"})," Lower (0.3-0.5) for consistent advice, higher (0.7-1.0) for varied responses"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"Max Tokens:"})," 500 = ~200 words, 1000 = ~400 words"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"System Prompt:"})," Customize the AI's personality and expertise area"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"Advanced Settings:"})," Click the âš™ï¸ Settings button to configure rate limits, safety, and more"]})]})]})]})},Ja=({user:s})=>{const[a,t]=i.useState([]),[r,l]=i.useState(!0),[n,m]=i.useState("all"),[x,h]=i.useState(null),[u,p]=i.useState(!1);i.useEffect(()=>{g()},[n]);const g=async()=>{l(!0);try{let e=c.from("error_logs").select("*").order("created_at",{ascending:!1}).limit(50);"all"!==n&&(e=e.eq("status",n));const{data:s,error:a}=await e;if(a)throw a;t(s||[])}catch(e){console.error("Error fetching error logs:",e),o({variant:"destructive",title:"Failed to fetch errors",description:e.message})}finally{l(!1)}},j=async e=>{h(e.id);try{o({title:"ðŸ¤– AI Analyzing...",description:"Analyzing error and generating fix suggestions..."});const s={rootCause:`Error in ${e.component_name||"unknown component"}: ${e.error_message}`,severity:e.severity||"medium",impact:"This error may affect user experience and should be addressed.",recommendedAction:"Review the error stack trace and apply the suggested fix below."};let a="";a=e.error_message.includes("undefined")?"// Add null check before accessing property\nif (variable && variable.property) {\n  // Safe to use variable.property\n}":e.error_message.includes("fetch")||e.error_message.includes("network")?"// Add error handling for network requests\ntry {\n  const response = await fetch(url);\n  if (!response.ok) throw new Error('Network error');\n  return await response.json();\n} catch (error) {\n  console.error('Fetch failed:', error);\n  // Handle error gracefully\n}":e.error_message.includes("permission")||e.error_message.includes("PGRST")?"// Check Supabase RLS policies\n// Ensure user has proper permissions in Supabase dashboard\n// Or add .single() for queries that should return one row":`// Review the error stack trace\n// ${e.error_stack?.split("\n")[0]||"No stack trace available"}\n// Add try-catch block around the failing code\ntry {\n  // Your code here\n} catch (error) {\n  console.error('Error:', error);\n  // Handle error appropriately\n}`;const{error:t}=await c.from("error_logs").update({ai_analysis:s,ai_fix_suggestion:a,ai_analyzed_at:(new Date).toISOString(),status:"analyzing"}).eq("id",e.id);if(t)throw t;o({title:"âœ… Analysis Complete",description:"AI has analyzed the error. Check the details."}),g()}catch(s){o({variant:"destructive",title:"AI Analysis Failed",description:s.message})}finally{h(null)}},f=async(e,a)=>{try{const t={status:a};"fixed"!==a&&"ignored"!==a||(t.resolved_at=(new Date).toISOString(),t.resolved_by=s.id);const{error:r}=await c.from("error_logs").update(t).eq("id",e);if(r)throw r;o({title:"Status Updated",description:`Error marked as ${a}`}),g()}catch(t){o({variant:"destructive",title:"Update Failed",description:t.message})}},y=[{header:"Error Message",accessor:"error_message",minWidth:"250px",render:s=>e.jsxs("div",{className:"max-w-[250px] md:max-w-[350px]",children:[e.jsx("p",{className:"font-medium text-sm line-clamp-2 break-words",children:s.error_message}),e.jsx("p",{className:"text-xs text-text-secondary mt-1 truncate",children:s.component_name})]})},{header:"Type",accessor:"error_type",render:s=>e.jsx(v,{variant:"outline",className:"text-xs whitespace-nowrap",children:s.error_type})},{header:"Severity",accessor:"severity",render:s=>(s=>{const a={low:"bg-blue-500/20 text-blue-400",medium:"bg-yellow-500/20 text-yellow-400",high:"bg-orange-500/20 text-orange-400",critical:"bg-red-500/20 text-red-400"};return e.jsx(v,{className:a[s]||a.medium,children:s})})(s.severity)},{header:"Status",accessor:"status",render:s=>(s=>{const a={open:"bg-red-500/20 text-red-400",analyzing:"bg-purple-500/20 text-purple-400",fixed:"bg-green-500/20 text-green-400",ignored:"bg-gray-500/20 text-gray-400"};return e.jsx(v,{className:a[s]||a.open,children:s})})(s.status)},{header:"Time",accessor:"created_at",render:s=>e.jsx("div",{className:"text-xs text-text-secondary whitespace-nowrap",children:new Date(s.created_at).toLocaleString()})}];return e.jsx("div",{className:"min-h-screen",children:e.jsxs("div",{className:"max-w-full mx-auto px-2 sm:px-4 lg:px-6 py-4 sm:py-6",children:[e.jsx("div",{className:"flex flex-col items-center sm:items-start gap-4 mb-6",children:e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsxs("h2",{className:"text-lg sm:text-xl lg:text-2xl font-bold flex items-center justify-center sm:justify-start gap-3",children:[e.jsx(Ve,{className:"w-5 h-5 sm:w-6 sm:h-6 lg:w-7 lg:h-7 text-primary"}),"AI Error Monitor"]}),e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary mt-1",children:"Monitor all application errors and let AI analyze & suggest fixes automatically"})]})}),e.jsxs(_,{className:"glass-effect border-primary/20 mb-6",children:[e.jsx(k,{className:"pb-3 px-3 sm:px-6 pt-3 sm:pt-6",children:e.jsxs(S,{className:"text-sm sm:text-base lg:text-lg flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 sm:w-5 sm:h-5 text-primary"}),"Quick Actions"]})}),e.jsx(C,{className:"px-3 sm:px-6 pb-3 sm:pb-6",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(d,{onClick:async()=>{p(!0);try{o({title:"ðŸ” Scanning Application...",description:"Running health checks and looking for potential errors..."});const a=[{name:"Database Connection",test:async()=>{const{error:e}=await c.from("user_profiles").select("id").limit(1);if(e)throw e}},{name:"Authentication System",test:async()=>{const{error:e}=await c.auth.getSession();if(e)throw e}},{name:"Storage Access",test:async()=>{try{const{data:e}=await c.storage.getBucket("avatars")}catch(e){}}}];let t=0;for(const r of a)try{await r.test()}catch(e){t++,await c.from("error_logs").insert({error_message:`Health Check Failed: ${r.name} - ${e.message}`,error_stack:e.stack,error_type:"health_check",component_name:r.name,severity:"medium",status:"open",user_id:s.id})}o({title:t>0?"âš ï¸ Issues Found":"âœ… Scan Complete",description:t>0?`Found ${t} potential issues. Check the error list.`:"No issues found. Application is healthy!"}),g()}catch(e){o({variant:"destructive",title:"Scan Failed",description:e.message})}finally{p(!1)}},disabled:u,size:"sm",className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm gap-1 sm:gap-2",children:[u?e.jsx(Ce,{className:"w-3 h-3 sm:w-4 sm:h-4 animate-spin"}):e.jsx(xe,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:u?"Scanning...":"Scan Application"}),e.jsx("span",{className:"inline sm:hidden",children:u?"Scan...":"Scan"})]}),e.jsxs(d,{onClick:async()=>{const e=a.filter(e=>"open"===e.status);if(0!==e.length){o({title:"ðŸ¤– Analyzing All Errors...",description:`Analyzing ${e.length} errors...`});for(const s of e)await j(s);o({title:"âœ… Batch Analysis Complete",description:`Analyzed ${e.length} errors successfully.`})}else o({title:"No Errors to Analyze",description:"All errors have been analyzed or resolved."})},disabled:x||0===a.filter(e=>"open"===e.status).length,variant:"secondary",size:"sm",className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm gap-1 sm:gap-2",children:[e.jsx(He,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Analyze All"}),e.jsx("span",{className:"inline sm:hidden",children:"AI"}),e.jsxs("span",{children:["(",a.filter(e=>"open"===e.status).length,")"]})]}),e.jsxs(d,{onClick:g,variant:"outline",size:"sm",className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm gap-1 sm:gap-2",children:[e.jsx(Ce,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]}),e.jsx("div",{className:"ml-auto hidden sm:flex gap-2",children:e.jsxs(v,{variant:"outline",className:"px-2 py-1 text-xs",children:["Last scan: ",u?"Running...":"Manual"]})})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-4 mb-6",children:[e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-3 sm:p-4 lg:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Total"}),e.jsx("p",{className:"text-lg sm:text-xl lg:text-2xl font-bold",children:a.length})]}),e.jsx(ee,{className:"w-6 h-6 sm:w-7 sm:h-7 lg:w-8 lg:h-8 text-red-500"})]})})}),e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-3 sm:p-4 lg:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Open"}),e.jsx("p",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-red-400",children:a.filter(e=>"open"===e.status).length})]}),e.jsx(ie,{className:"w-6 h-6 sm:w-7 sm:h-7 lg:w-8 lg:h-8 text-red-400"})]})})}),e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-3 sm:p-4 lg:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Fixed"}),e.jsx("p",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-green-400",children:a.filter(e=>"fixed"===e.status).length})]}),e.jsx(Q,{className:"w-6 h-6 sm:w-7 sm:h-7 lg:w-8 lg:h-8 text-green-400"})]})})}),e.jsx(_,{className:"glass-effect",children:e.jsx(C,{className:"p-3 sm:p-4 lg:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"AI"}),e.jsx("p",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-purple-400",children:a.filter(e=>e.ai_fix_suggestion).length})]}),e.jsx(He,{className:"w-6 h-6 sm:w-7 sm:h-7 lg:w-8 lg:h-8 text-purple-400"})]})})})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-6",children:[e.jsx(d,{size:"sm",variant:"all"===n?"default":"outline",onClick:()=>m("all"),className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",children:"All"}),e.jsx(d,{size:"sm",variant:"open"===n?"default":"outline",onClick:()=>m("open"),className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",children:"Open"}),e.jsx(d,{size:"sm",variant:"fixed"===n?"default":"outline",onClick:()=>m("fixed"),className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",children:"Fixed"}),e.jsx(d,{size:"sm",variant:"ignored"===n?"default":"outline",onClick:()=>m("ignored"),className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",children:"Ignored"}),e.jsxs(d,{size:"sm",variant:"outline",onClick:g,className:"ml-auto h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm gap-1 sm:gap-2",children:[e.jsx(Ce,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]})]}),e.jsxs(_,{className:"glass-effect",children:[e.jsx(k,{className:"px-3 sm:px-6 pt-3 sm:pt-6",children:e.jsxs(S,{className:"text-sm sm:text-base lg:text-lg flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Error Logs (",a.length,")"]})}),e.jsx(C,{className:"px-3 sm:px-6 pb-3 sm:pb-6",children:r?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ce,{className:"w-6 h-6 sm:w-8 sm:h-8 animate-spin mx-auto text-primary"}),e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary mt-2",children:"Loading errors..."})]}):e.jsx(Aa,{data:a,columns:y,actions:s=>e.jsxs("div",{className:"flex flex-wrap gap-1 sm:gap-2",children:["open"===s.status&&e.jsxs(d,{size:"sm",variant:"outline",className:"h-8 px-2 text-xs gap-1",onClick:()=>j(s),disabled:x===s.id,children:[x===s.id?e.jsx(Ce,{className:"w-3 h-3 animate-spin"}):e.jsx(He,{className:"w-3 h-3"}),e.jsx("span",{className:"hidden sm:inline",children:"AI Analyze"})]}),s.ai_fix_suggestion&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{size:"sm",variant:"secondary",className:"h-8 px-2 text-xs gap-1",onClick:()=>{window.open("","_blank","width=800,height=600").document.write(`\n                <html>\n                  <head>\n                    <title>AI Fix Suggestion - ${s.error_message.substring(0,50)}</title>\n                    <style>\n                      body {\n                        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n                        padding: 20px;\n                        background: #1a1a1a;\n                        color: #e0e0e0;\n                      }\n                      h2 { color: #4ade80; }\n                      pre {\n                        background: #2a2a2a;\n                        padding: 15px;\n                        border-radius: 8px;\n                        overflow-x: auto;\n                        border-left: 3px solid #4ade80;\n                      }\n                      code { color: #a5d6ff; }\n                      .section { margin: 20px 0; }\n                      .label { color: #9ca3af; font-size: 14px; }\n                    </style>\n                  </head>\n                  <body>\n                    <h2>ðŸ¤– AI Fix Suggestion</h2>\n                    <div class="section">\n                      <div class="label">Error:</div>\n                      <p><strong>${s.error_message}</strong></p>\n                    </div>\n                    <div class="section">\n                      <div class="label">Component:</div>\n                      <p>${s.component_name||"Unknown"}</p>\n                    </div>\n                    <div class="section">\n                      <div class="label">Suggested Fix:</div>\n                      <pre><code>${s.ai_fix_suggestion}</code></pre>\n                    </div>\n                    ${s.ai_analysis?`\n                    <div class="section">\n                      <div class="label">AI Analysis:</div>\n                      <p><strong>Root Cause:</strong> ${s.ai_analysis.rootCause||"N/A"}</p>\n                      <p><strong>Impact:</strong> ${s.ai_analysis.impact||"N/A"}</p>\n                      <p><strong>Recommended Action:</strong> ${s.ai_analysis.recommendedAction||"N/A"}</p>\n                    </div>\n                    `:""}\n                  </body>\n                </html>\n              `)},children:[e.jsx(Qe,{className:"w-3 h-3"}),e.jsx("span",{className:"hidden sm:inline",children:"View Fix"})]}),e.jsxs(d,{size:"sm",variant:"outline",className:"h-8 px-2 text-xs gap-1",onClick:()=>{const e=`\nAI Error Fix Suggestion\n=======================\n\nError: ${s.error_message}\nComponent: ${s.component_name||"Unknown"}\nType: ${s.error_type}\nSeverity: ${s.severity}\nTime: ${new Date(s.created_at).toLocaleString()}\n\nAI Analysis:\n${s.ai_analysis?`\nRoot Cause: ${s.ai_analysis.rootCause}\nImpact: ${s.ai_analysis.impact}\nRecommended Action: ${s.ai_analysis.recommendedAction}\n`:"Not analyzed yet"}\n\nSuggested Fix:\n--------------\n${s.ai_fix_suggestion}\n\nStack Trace:\n-----------\n${s.error_stack||"No stack trace available"}\n              `,a=new Blob([e],{type:"text/plain"}),t=URL.createObjectURL(a),r=document.createElement("a");r.href=t,r.download=`error-fix-${s.id.substring(0,8)}.txt`,r.click(),URL.revokeObjectURL(t),o({title:"ðŸ“¥ Downloaded",description:"Fix suggestion downloaded as text file"})},children:[e.jsx(J,{className:"w-3 h-3"}),e.jsx("span",{className:"hidden sm:inline",children:"Download"})]})]}),"fixed"!==s.status&&e.jsxs(d,{size:"sm",variant:"outline",className:"h-8 px-2 text-xs gap-1 text-green-500",onClick:()=>f(s.id,"fixed"),children:[e.jsx(Q,{className:"w-3 h-3"}),e.jsx("span",{className:"hidden sm:inline",children:"Mark Fixed"})]}),e.jsxs(d,{size:"sm",variant:"ghost",className:"h-8 px-2 text-xs gap-1 text-red-500",onClick:()=>f(s.id,"ignored"),children:[e.jsx(X,{className:"w-3 h-3"}),e.jsx("span",{className:"hidden sm:inline",children:"Ignore"})]})]}),emptyMessage:"No errors found. Great job!"})})]})]})})},Ka=({user:s})=>{const{toast:a}=y(),[t,r]=i.useState({messaging_enabled:!0,ai_auto_reply_enabled:!0,ai_auto_reply_message:"Thank you for your message! Our team has been notified and will get back to you shortly. In the meantime, feel free to check out our AI Health Coach for instant assistance! ðŸŒŸ"}),[l,n]=i.useState(!0),[o,u]=i.useState(!1),[p,g]=i.useState({totalConversations:0,unreadMessages:0,todayMessages:0,pendingLeads:0}),[j,f]=i.useState([]),[N,w]=i.useState(!1),[b,P]=i.useState(null),[E,T]=i.useState(!1),[I,M]=i.useState([]),[R,q]=i.useState(!1),[z,L]=i.useState("");i.useEffect(()=>{D(),U(),O(),B()},[]);const D=async()=>{try{n(!0);const{data:e,error:s}=await c.from("platform_settings").select("*").eq("key","messaging_config").single();if(s&&"PGRST116"!==s.code)throw s;e?.value&&r(e.value)}catch(e){console.error("Error loading messaging settings:",e)}finally{n(!1)}},U=async()=>{try{const{count:e,error:a}=await c.from("conversations").select("*",{count:"exact",head:!0});a&&console.error("Error loading conversations count:",a);const{count:t,error:r}=await c.from("messages").select("*",{count:"exact",head:!0}).eq("is_read",!1).neq("sender_id",s.id);r&&console.error("Error loading unread count:",r);const i=new Date;i.setHours(i.getHours()-24);const{count:l,error:n}=await c.from("messages").select("*",{count:"exact",head:!0}).gte("created_at",i.toISOString());n&&console.error("Error loading today messages:",n);const{count:o,error:d}=await c.from("visitor_inquiries").select("*",{count:"exact",head:!0}).eq("status","pending");d&&console.error("Error loading pending leads:",d),g({totalConversations:e||0,unreadMessages:t||0,todayMessages:l||0,pendingLeads:o||0})}catch(e){console.error("Error loading stats:",e)}},O=async()=>{try{w(!0);const{data:e,error:s}=await c.from("visitor_inquiries").select("*").order("created_at",{ascending:!1});if(s)throw s;f(e||[])}catch(e){console.error("Error loading leads:",e)}finally{w(!1)}},$=async(e,s)=>{try{const{error:t}=await c.from("visitor_inquiries").update({status:s,contacted_at:"contacted"===s?(new Date).toISOString():null}).eq("id",e);if(t)throw t;a({title:"Status Updated",description:`Lead marked as ${s}`}),O(),U()}catch(t){console.error("Error updating lead:",t),a({title:"Error",description:"Failed to update lead status",variant:"destructive"})}},B=async()=>{try{q(!0);const{data:e,error:s}=await c.from("user_profiles").select("id, full_name, email, role, messaging_disabled").eq("role","user").order("full_name");if(s)throw s;M(e||[])}catch(e){console.error("Error loading customers:",e)}finally{q(!1)}},W=(e,s)=>{r(a=>({...a,[e]:s}))},H=s=>{const a={pending:{color:"bg-yellow-500",label:"Pending"},contacted:{color:"bg-blue-500",label:"Contacted"},converted:{color:"bg-green-500",label:"Converted"},closed:{color:"bg-gray-500",label:"Closed"}},t=a[s]||a.pending;return e.jsx(v,{className:`${t.color} text-white`,children:t.label})};return l?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading settings..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl lg:text-2xl font-bold",children:"Messaging & Leads"}),e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary mt-1",children:"Manage customer messaging, auto-replies, and visitor inquiries"})]})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(_,{className:"border-l-4 border-l-blue-500",children:[e.jsxs(k,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(S,{className:"text-sm font-medium",children:"Conversations"}),e.jsx(F,{className:"h-4 w-4 text-blue-500"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold",children:p.totalConversations}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All time"})]})]}),e.jsxs(_,{className:"border-l-4 border-l-orange-500",children:[e.jsxs(k,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(S,{className:"text-sm font-medium",children:"Unread Messages"}),e.jsx(Ye,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold",children:p.unreadMessages}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Need response"})]})]}),e.jsxs(_,{className:"border-l-4 border-l-green-500",children:[e.jsxs(k,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(S,{className:"text-sm font-medium",children:"Today's Messages"}),e.jsx(Se,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold",children:p.todayMessages}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Last 24 hours"})]})]}),e.jsxs(_,{className:"border-l-4 border-l-purple-500",children:[e.jsxs(k,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(S,{className:"text-sm font-medium",children:"Pending Leads"}),e.jsx(ie,{className:"h-4 w-4 text-purple-500"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold",children:p.pendingLeads}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Awaiting contact"})]})]})]}),e.jsxs(ps,{defaultValue:"settings",className:"w-full",children:[e.jsxs(gs,{className:"grid w-full grid-cols-3 max-w-2xl",children:[e.jsxs(js,{value:"settings",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Settings"]}),e.jsxs(js,{value:"leads",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Leads (",j.length,")"]}),e.jsxs(js,{value:"customers",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Customer Access"]})]}),e.jsxs(fs,{value:"settings",className:"space-y-6 mt-6",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(d,{onClick:async()=>{try{u(!0);const{error:e}=await c.from("platform_settings").upsert({key:"messaging_config",value:t,updated_at:(new Date).toISOString()},{onConflict:"key"});if(e)throw e;a({title:"Settings Saved",description:"Messaging settings have been updated successfully."})}catch(e){console.error("Error saving settings:",e),a({title:"Error",description:"42P01"===e.code?"Please run the platform_settings migration first.":"Failed to save settings.",variant:"destructive"})}finally{u(!1)}},disabled:o,className:"gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),o?"Saving...":"Save Changes"]})}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(_,{children:[e.jsxs(k,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-5 w-5 text-primary"}),e.jsx(S,{children:"Customer Messaging"})]}),e.jsx(A,{children:"Enable or disable customer messaging feature"})]}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between space-x-2",children:[e.jsxs(m,{htmlFor:"messaging-enabled",className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium",children:"Enable Messaging"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Allow customers to send messages"})]}),e.jsx(Cs,{id:"messaging-enabled",checked:t.messaging_enabled,onCheckedChange:e=>W("messaging_enabled",e)})]}),!t.messaging_enabled&&e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"Customers won't be able to send new messages"})})]})]}),e.jsxs(_,{children:[e.jsxs(k,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-5 w-5 text-primary"}),e.jsx(S,{children:"AI Auto-Reply"})]}),e.jsx(A,{children:"Automatically respond to customer messages"})]}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between space-x-2",children:[e.jsxs(m,{htmlFor:"ai-auto-reply",className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium",children:"Enable Auto-Reply"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Send automatic response"})]}),e.jsx(Cs,{id:"ai-auto-reply",checked:t.ai_auto_reply_enabled,onCheckedChange:e=>W("ai_auto_reply_enabled",e),disabled:!t.messaging_enabled})]}),t.ai_auto_reply_enabled&&e.jsx("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-primary",children:"Team will still be notified of new messages"})})]})]})]}),t.ai_auto_reply_enabled&&e.jsxs(_,{children:[e.jsxs(k,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-5 w-5 text-primary"}),e.jsx(S,{children:"Auto-Reply Message"})]}),e.jsx(A,{children:"Customize the automatic reply message"})]}),e.jsx(C,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{htmlFor:"auto-reply-message",children:"Message"}),e.jsx(d,{type:"button",variant:"outline",size:"sm",onClick:async()=>{try{T(!0);const{data:e,error:s}=await c.functions.invoke("openai-chat",{body:{messages:[{role:"system",content:"You are a helpful assistant that generates professional, friendly auto-reply messages for a health and wellness platform called GreenoFig. Keep messages concise, warm, and encouraging."},{role:"user",content:"Generate a professional auto-reply message for customers who message our health and wellness platform. The message should: 1) Thank them for reaching out, 2) Let them know we'll respond soon, 3) Suggest they check out our AI Health Coach while waiting. Keep it under 50 words and include a friendly emoji."}]}});if(s)throw s;e?.response&&(W("ai_auto_reply_message",e.response),a({title:"AI Message Generated",description:"Auto-reply message has been generated successfully"}))}catch(e){console.error("Error generating AI reply:",e),a({title:"Error",description:"Failed to generate AI message. Using default.",variant:"destructive"})}finally{T(!1)}},disabled:E,className:"gap-2",children:E?e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"h-3 w-3 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ve,{className:"h-3 w-3"}),"Generate with AI"]})})]}),e.jsx(h,{id:"auto-reply-message",placeholder:"Enter your auto-reply message...",value:t.ai_auto_reply_message,onChange:e=>W("ai_auto_reply_message",e.target.value),rows:4,className:"resize-none"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Sent when a customer starts a new conversation"})]})})]})]}),e.jsx(fs,{value:"leads",className:"space-y-4 mt-6",children:N?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading leads..."})]}):0===j.length?e.jsx(_,{children:e.jsxs(C,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(ge,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Leads Yet"}),e.jsx("p",{className:"text-muted-foreground text-center",children:"Visitor inquiries will appear here when someone fills out the contact form"})]})}):e.jsx("div",{className:"grid gap-4",children:j.map(s=>e.jsxs(_,{className:"hover:shadow-md transition-shadow",children:[e.jsx(k,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(S,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ae,{className:"h-4 w-4"}),s.name]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ge,{className:"h-3 w-3"}),s.email]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"h-3 w-3"}),ye(new Date(s.created_at),"MMM d, yyyy h:mm a")]})]})]}),H(s.status)]})}),e.jsxs(C,{className:"space-y-3",children:[s.question&&e.jsxs("div",{className:"bg-muted p-3 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Question:"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.question})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:["pending"===s.status&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{size:"sm",onClick:()=>$(s.id,"contacted"),className:"gap-1",children:[e.jsx(ue,{className:"h-3 w-3"}),"Mark Contacted"]}),e.jsxs(d,{size:"sm",variant:"outline",onClick:()=>window.location.href=`mailto:${s.email}`,className:"gap-1",children:[e.jsx(ge,{className:"h-3 w-3"}),"Email"]})]}),"contacted"===s.status&&e.jsxs(d,{size:"sm",onClick:()=>$(s.id,"converted"),className:"gap-1 bg-green-600 hover:bg-green-700",children:[e.jsx(ue,{className:"h-3 w-3"}),"Mark Converted"]}),"closed"!==s.status&&e.jsxs(d,{size:"sm",variant:"outline",onClick:()=>$(s.id,"closed"),className:"gap-1",children:[e.jsx(pe,{className:"h-3 w-3"}),"Close"]}),e.jsxs(d,{size:"sm",variant:"destructive",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this lead?"))try{const{error:s}=await c.from("visitor_inquiries").delete().eq("id",e);if(s)throw s;a({title:"Lead Deleted",description:"The lead has been removed"}),O(),U(),P(null)}catch(s){console.error("Error deleting lead:",s),a({title:"Error",description:"Failed to delete lead",variant:"destructive"})}})(s.id),className:"gap-1 ml-auto",children:[e.jsx(V,{className:"h-3 w-3"}),"Delete"]})]})]})]},s.id))})}),e.jsx(fs,{value:"customers",className:"space-y-6 mt-6",children:e.jsxs(_,{children:[e.jsxs(k,{children:[e.jsx(S,{children:"Customer Messaging Access"}),e.jsx(A,{children:"Enable or disable messaging for individual customers. Customers with messaging disabled cannot send or receive messages."})]}),e.jsxs(C,{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(x,{placeholder:"Search customers by name or email...",value:z,onChange:e=>L(e.target.value),className:"max-w-md"})}),R?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading customers..."})]})}):0===I.length?e.jsxs("div",{className:"text-center py-12 border rounded-lg bg-muted/30",children:[e.jsx(F,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Customers Yet"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Customer accounts will appear here once users sign up"}),e.jsxs(d,{variant:"outline",size:"sm",onClick:B,children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Refresh List"]})]}):e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs($a,{children:[e.jsx(Ga,{children:e.jsxs(Ba,{className:"bg-muted/50",children:[e.jsx(Wa,{className:"font-semibold",children:"Customer Name"}),e.jsx(Wa,{className:"font-semibold",children:"Email"}),e.jsx(Wa,{className:"font-semibold",children:"Messaging Status"}),e.jsx(Wa,{className:"text-right font-semibold min-w-[140px]",children:"Actions"})]})}),e.jsx(Va,{children:I.filter(e=>e.full_name?.toLowerCase().includes(z.toLowerCase())||e.email?.toLowerCase().includes(z.toLowerCase())).map(s=>e.jsxs(Ba,{className:"hover:bg-muted/30",children:[e.jsx(Ha,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(Ae,{className:"h-4 w-4 text-primary"})}),s.full_name||"Unknown"]})}),e.jsx(Ha,{className:"text-muted-foreground",children:s.email}),e.jsx(Ha,{children:s.messaging_disabled?e.jsxs(v,{variant:"destructive",className:"gap-1.5 px-3 py-1",children:[e.jsx(pe,{className:"h-3.5 w-3.5"}),"Disabled"]}):e.jsxs(v,{variant:"default",className:"gap-1.5 px-3 py-1 bg-green-500 hover:bg-green-600",children:[e.jsx(ue,{className:"h-3.5 w-3.5"}),"Enabled"]})}),e.jsx(Ha,{className:"text-right",children:e.jsx(d,{size:"sm",variant:s.messaging_disabled?"default":"outline",onClick:()=>(async(e,s)=>{try{const{error:t}=await c.from("user_profiles").update({messaging_disabled:!s}).eq("id",e);if(t)throw t;a({title:"Updated",description:`Messaging ${s?"enabled":"disabled"} for customer`}),B()}catch(t){console.error("Error toggling customer messaging:",t),a({title:"Error",description:"Failed to update customer messaging settings",variant:"destructive"})}})(s.id,s.messaging_disabled),className:"gap-1.5 font-medium",children:s.messaging_disabled?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-4 w-4"}),"Enable"]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-4 w-4"}),"Disable"]})})})]},s.id))})]})}),0===I.filter(e=>e.full_name?.toLowerCase().includes(z.toLowerCase())||e.email?.toLowerCase().includes(z.toLowerCase())).length&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground border-t",children:[e.jsx(F,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-sm font-medium",children:"No customers match your search"}),e.jsx("p",{className:"text-xs mt-1",children:"Try a different search term"})]})]})]})]})})]})]})},Xa=({user:s})=>{const[a,t]=i.useState(""),[r,l]=i.useState(""),[n,h]=i.useState("general"),[u,p]=i.useState("guide"),[g,j]=i.useState("professional"),[f,y]=i.useState("2000"),[N,w]=i.useState(!1),[b,P]=i.useState(null),F=[{value:"guide",label:"Ultimate Guide",description:"Comprehensive how-to guides"},{value:"listicle",label:"Listicle",description:"Top 10, Best of lists"},{value:"comparison",label:"Comparison",description:"Product/method comparisons"},{value:"tutorial",label:"Tutorial",description:"Step-by-step instructions"},{value:"case-study",label:"Case Study",description:"Success stories & results"},{value:"faq",label:"FAQ",description:"Question & answer format"}],E=[{value:"general",label:"General Audience"},{value:"beginners",label:"Beginners"},{value:"fitness-enthusiasts",label:"Fitness Enthusiasts"},{value:"weight-loss",label:"Weight Loss Seekers"},{value:"muscle-building",label:"Muscle Builders"},{value:"busy-professionals",label:"Busy Professionals"}],T=[{value:"professional",label:"Professional"},{value:"friendly",label:"Friendly & Conversational"},{value:"motivational",label:"Motivational"},{value:"educational",label:"Educational"},{value:"casual",label:"Casual"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Ve,{className:"w-6 h-6 text-primary"}),"AI Blog Content Generator"]}),e.jsx("p",{className:"text-text-secondary mt-1",children:"Generate SEO-optimized blog posts instantly with AI. Perfect for ranking on Google!"})]}),e.jsxs(_,{children:[e.jsxs(k,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-5 h-5 text-primary"}),"Content Specifications"]}),e.jsx(A,{children:"Provide details about the blog post you want to create"})]}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"topic",children:"Blog Topic *"}),e.jsx(x,{id:"topic",placeholder:"e.g., How to Lose Weight with AI Health Coaching",value:a,onChange:e=>t(e.target.value),disabled:N})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"keywords",children:"Target Keywords (comma-separated)"}),e.jsx(x,{id:"keywords",placeholder:"e.g., ai health coach, weight loss, meal planning",value:r,onChange:e=>l(e.target.value),disabled:N})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"content-type",children:"Content Type"}),e.jsxs(ds,{value:u,onValueChange:p,disabled:N,children:[e.jsx(ms,{children:e.jsx(xs,{})}),e.jsx(hs,{children:F.map(s=>e.jsx(us,{value:s.value,children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.label}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.description})]})},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"audience",children:"Target Audience"}),e.jsxs(ds,{value:n,onValueChange:h,disabled:N,children:[e.jsx(ms,{children:e.jsx(xs,{})}),e.jsx(hs,{children:E.map(s=>e.jsx(us,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"tone",children:"Writing Tone"}),e.jsxs(ds,{value:g,onValueChange:j,disabled:N,children:[e.jsx(ms,{children:e.jsx(xs,{})}),e.jsx(hs,{children:T.map(s=>e.jsx(us,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"word-count",children:"Target Word Count"}),e.jsxs(ds,{value:f,onValueChange:y,disabled:N,children:[e.jsx(ms,{children:e.jsx(xs,{})}),e.jsxs(hs,{children:[e.jsx(us,{value:"1000",children:"1,000 words (5 min read)"}),e.jsx(us,{value:"1500",children:"1,500 words (7 min read)"}),e.jsx(us,{value:"2000",children:"2,000 words (10 min read)"}),e.jsx(us,{value:"2500",children:"2,500 words (12 min read)"}),e.jsx(us,{value:"3000",children:"3,000 words (15 min read)"})]})]})]})]}),e.jsx(d,{onClick:async()=>{if(a.trim()){w(!0);try{const s=`You are an expert SEO content writer specializing in health, wellness, nutrition, and fitness.\n\nCreate a comprehensive, SEO-optimized blog post with the following specifications:\n\n**Topic**: ${a}\n**Target Keywords**: ${r||"Derive from topic"}\n**Target Audience**: ${E.find(e=>e.value===n)?.label}\n**Content Type**: ${F.find(e=>e.value===u)?.label}\n**Tone**: ${T.find(e=>e.value===g)?.label}\n**Target Word Count**: ${f} words\n\n**Requirements**:\n1. Create a compelling, click-worthy headline (50-60 characters)\n2. Write an engaging meta description (150-160 characters)\n3. Start with a hook that grabs attention\n4. Use H2 and H3 headers for structure (include keywords naturally)\n5. Include actionable tips and practical advice\n6. Add internal linking suggestions (to other relevant topics)\n7. Include a call-to-action at the end\n8. Naturally integrate the target keywords throughout\n9. Write in ${T.find(e=>e.value===g)?.label.toLowerCase()} tone\n10. Make it valuable, informative, and engaging\n\n**Format the response as JSON**:\n{\n  "title": "SEO-optimized blog title",\n  "slug": "url-friendly-slug",\n  "metaDescription": "Compelling meta description",\n  "content": "Full blog post content in markdown format",\n  "excerpt": "2-3 sentence excerpt for previews",\n  "keywords": ["keyword1", "keyword2", "keyword3"],\n  "readingTime": "estimated reading time in minutes",\n  "seoScore": "estimated SEO score out of 100"\n}\n\nGenerate the blog post now.`,{data:t,error:i}=await c.functions.invoke("openai-chat",{body:{messages:[{role:"system",content:"You are an expert SEO content writer. Always respond with valid JSON as specified."},{role:"user",content:s}],model:"gpt-4",temperature:.7,max_tokens:4e3}});if(i)throw i;let l;try{const e=t.response.match(/\{[\s\S]*\}/);l=e?JSON.parse(e[0]):{title:a,slug:a.toLowerCase().replace(/[^a-z0-9]+/g,"-"),metaDescription:`Discover everything you need to know about ${a}`,content:t.response,excerpt:t.response.substring(0,200)+"...",keywords:r.split(",").map(e=>e.trim()).filter(Boolean),readingTime:Math.ceil(t.response.split(" ").length/200),seoScore:75}}catch(e){throw console.error("Error parsing AI response:",e),new Error("Failed to parse AI response")}P(l),o({title:"Blog Post Generated! âœ¨",description:`Created a ${l.readingTime}-minute read with SEO score: ${l.seoScore}/100`})}catch(s){console.error("Error generating blog post:",s),o({title:"Generation Failed",description:s.message||"Failed to generate blog post. Please try again.",variant:"destructive"})}finally{w(!1)}}else o({title:"Topic Required",description:"Please enter a blog topic",variant:"destructive"})},disabled:N,className:"w-full gap-2",size:"lg",children:N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Generating with AI..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ve,{className:"w-5 h-5"}),"Generate Blog Post"]})})]})]}),b&&e.jsxs(_,{children:[e.jsx(k,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-primary"}),"Generated Content"]}),e.jsx(A,{className:"mt-2",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(v,{variant:"outline",className:"gap-1",children:[e.jsx(U,{className:"w-3 h-3"}),"SEO Score: ",b.seoScore,"/100"]}),e.jsxs(v,{variant:"outline",className:"gap-1",children:[e.jsx($,{className:"w-3 h-3"}),b.readingTime," min read"]}),b.keywords.map(s=>e.jsx(v,{variant:"secondary",children:s},s))]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{size:"sm",variant:"outline",onClick:()=>{return e=b.content,navigator.clipboard.writeText(e),void o({title:"Copied!",description:"Content copied to clipboard"});var e},children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"Copy"]}),e.jsxs(d,{size:"sm",variant:"outline",onClick:()=>{if(!b)return;const e=`---\ntitle: ${b.title}\nslug: ${b.slug}\nmetaDescription: ${b.metaDescription}\nkeywords: ${b.keywords.join(", ")}\nreadingTime: ${b.readingTime} min\n---\n\n# ${b.title}\n\n${b.content}\n`,s=new Blob([e],{type:"text/markdown"}),a=URL.createObjectURL(s),t=document.createElement("a");t.href=a,t.download=`${b.slug}.md`,t.click(),URL.revokeObjectURL(a),o({title:"Downloaded",description:"Blog post downloaded as markdown file"})},children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Download"]}),e.jsxs(d,{size:"sm",onClick:async()=>{if(b)try{const{error:e}=await c.from("blog_posts").insert({title:b.title,slug:b.slug,content:b.content,excerpt:b.excerpt,meta_description:b.metaDescription,author_id:s.id,published:!1,created_at:(new Date).toISOString()});if(e)throw e;o({title:"Saved to Drafts",description:"Blog post has been saved. Edit and publish from the Blog Manager."})}catch(e){o({title:"Save Failed",description:e.message,variant:"destructive"})}},children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Save to Drafts"]})]})]})}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{className:"text-xs text-text-secondary",children:"TITLE"}),e.jsx("h3",{className:"text-2xl font-bold mt-1",children:b.title})]}),e.jsxs("div",{children:[e.jsx(m,{className:"text-xs text-text-secondary",children:"META DESCRIPTION"}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:b.metaDescription})]}),e.jsxs("div",{children:[e.jsx(m,{className:"text-xs text-text-secondary",children:"EXCERPT"}),e.jsx("p",{className:"text-sm mt-1",children:b.excerpt})]}),e.jsxs("div",{children:[e.jsx(m,{className:"text-xs text-text-secondary",children:"CONTENT PREVIEW"}),e.jsx("div",{className:"mt-2 p-4 bg-muted rounded-lg max-h-96 overflow-y-auto",children:e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",children:b.content.split("\n").map((s,a)=>e.jsx("p",{className:"mb-2",children:s},a))})})]})]})]}),e.jsxs(_,{className:"border-primary/30 bg-primary/5",children:[e.jsx(k,{children:e.jsx(S,{className:"text-lg",children:"SEO Tips for Maximum Impact"})}),e.jsx(C,{children:e.jsxs("ul",{className:"space-y-2 text-sm",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-1",children:"â€¢"}),e.jsx("span",{children:"Use the target keyword in the title, first paragraph, and headers"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-1",children:"â€¢"}),e.jsx("span",{children:"Add internal links to other relevant blog posts and pages"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-1",children:"â€¢"}),e.jsx("span",{children:"Include images with alt text containing your keywords"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-1",children:"â€¢"}),e.jsx("span",{children:"Publish consistently (3-5 posts per week) for best results"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-1",children:"â€¢"}),e.jsx("span",{children:"Share on social media and encourage engagement"})]})]})})]})]})},Za=({user:s})=>{const[a,t]=i.useState(!1),[r,l]=i.useState(3),[n,h]=i.useState("09:00"),[u,p]=i.useState(!1),[g,j]=i.useState([]),[f,y]=i.useState([]),[N,w]=i.useState(!1),[b,P]=i.useState(""),[F,E]=i.useState(""),[T,I]=i.useState(null);i.useEffect(()=>{M(),R(),q()},[]);const M=async()=>{try{const{data:e,error:s}=await c.from("platform_settings").select("*").eq("key","auto_blog_scheduler").single();if(s&&"PGRST116"!==s.code)throw s;if(e?.value){const s=e.value;t(s.enabled||!1),l(s.postsPerWeek||3),h(s.publishTime||"09:00"),p(s.autoPublish||!1),I(s)}}catch(e){console.error("Error loading scheduler config:",e)}},R=async()=>{try{const{data:e,error:s}=await c.from("blog_content_queue").select("*").eq("status","pending").order("created_at",{ascending:!0});if(s&&"PGRST116"!==s.code)return void console.error("Content queue table may not exist:",s);j(e||[])}catch(e){console.error("Error loading content queue:",e)}},q=async()=>{try{const{data:e,error:a}=await c.from("blog_posts").select("*").eq("author_id",s.id).order("created_at",{ascending:!1}).limit(10);if(a)throw a;y(e||[])}catch(e){console.error("Error loading generated posts:",e)}},z=()=>{const e=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],s=parseInt(r);if(0===s)return[];const a=Math.floor(7/s),t=[];for(let r=0;r<s;r++)t.push(e[r*a]);return t};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(se,{className:"w-6 h-6 text-primary"}),"Automated Blog Scheduler"]}),e.jsx("p",{className:"text-text-secondary mt-1",children:"Set it and forget it! Automatically generate and publish blog posts to rank on Google."})]}),e.jsxs(ps,{defaultValue:"settings",className:"w-full",children:[e.jsxs(gs,{className:"grid w-full grid-cols-3",children:[e.jsxs(js,{value:"settings",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Settings"]}),e.jsxs(js,{value:"queue",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Content Queue (",g.length,")"]}),e.jsxs(js,{value:"history",children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Generated (",f.length,")"]})]}),e.jsxs(fs,{value:"settings",className:"space-y-6",children:[e.jsxs(_,{children:[e.jsxs(k,{children:[e.jsx(S,{children:"Automation Settings"}),e.jsx(A,{children:"Configure how often and when blog posts should be generated"})]}),e.jsxs(C,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(m,{className:"text-base font-semibold",children:"Enable Auto-Blogging"}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Automatically generate and publish blog posts"})]}),e.jsx(Cs,{checked:a,onCheckedChange:t})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Posts Per Week"}),e.jsxs(ds,{value:r.toString(),onValueChange:l,children:[e.jsx(ms,{children:e.jsx(xs,{})}),e.jsxs(hs,{children:[e.jsx(us,{value:"1",children:"1 post per week"}),e.jsx(us,{value:"2",children:"2 posts per week"}),e.jsx(us,{value:"3",children:"3 posts per week (Recommended)"}),e.jsx(us,{value:"4",children:"4 posts per week"}),e.jsx(us,{value:"5",children:"5 posts per week"}),e.jsx(us,{value:"7",children:"Daily (7 posts per week)"})]})]}),e.jsxs("p",{className:"text-xs text-text-secondary",children:["Schedule: ",z().join(", ")," at ",n]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Publish Time (24-hour format)"}),e.jsx(x,{type:"time",value:n,onChange:e=>h(e.target.value)}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Best times for engagement: 9:00 AM or 2:00 PM"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(m,{className:"text-base font-semibold",children:"Auto-Publish"}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Publish immediately without review (or save as draft)"})]}),e.jsx(Cs,{checked:u,onCheckedChange:p})]}),e.jsx(d,{onClick:async()=>{try{const e={enabled:a,postsPerWeek:parseInt(r),publishTime:n,autoPublish:u,lastRun:T?.lastRun||null,totalGenerated:T?.totalGenerated||0,updatedAt:(new Date).toISOString()},{error:s}=await c.from("platform_settings").upsert({key:"auto_blog_scheduler",value:e,updated_at:(new Date).toISOString()},{onConflict:"key"});if(s)throw s;I(e),o({title:"Scheduler Updated",description:"Auto-blogging is now "+(a?"enabled":"disabled")})}catch(e){o({title:"Error",description:e.message,variant:"destructive"})}},className:"w-full",size:"lg",children:"Save Settings"})]})]}),e.jsxs(_,{className:"border-primary/30 bg-primary/5",children:[e.jsx(k,{children:e.jsx(S,{className:"text-lg",children:"Publishing Schedule Preview"})}),e.jsx(C,{children:e.jsx("div",{className:"space-y-2",children:a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-500",children:[e.jsx(Ke,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Scheduler is ACTIVE"})]}),e.jsxs("p",{className:"text-sm",children:[r," blog post",r>1?"s":""," will be generated every week"]}),e.jsxs("p",{className:"text-sm",children:["Publishing on: ",z().join(", ")]}),e.jsxs("p",{className:"text-sm",children:["Time: ",n]}),e.jsxs("p",{className:"text-sm",children:["Mode: ",u?"Auto-publish immediately":"Save as draft for review"]})]}):e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Xe,{className:"w-5 h-5"}),e.jsx("span",{children:"Scheduler is currently disabled"})]})})})]})]}),e.jsxs(fs,{value:"queue",className:"space-y-4",children:[e.jsxs(_,{children:[e.jsxs(k,{children:[e.jsx(S,{children:"Add Topics to Queue"}),e.jsx(A,{children:"Add blog topics that will be generated automatically"})]}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Blog Topic"}),e.jsx(x,{placeholder:"e.g., How to Lose Weight with AI Health Coaching",value:b,onChange:e=>P(e.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Target Keywords (comma-separated)"}),e.jsx(x,{placeholder:"e.g., ai health coach, weight loss, meal planning",value:F,onChange:e=>E(e.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{onClick:async()=>{if(b.trim())try{const{error:e}=await c.from("blog_content_queue").select("id").limit(1);if(e&&"42P01"===e.code)return void o({title:"Setting up Blog Queue",description:"Creating content queue table... Please run the migration first.",variant:"destructive"});const{error:s}=await c.from("blog_content_queue").insert({topic:b,keywords:F,status:"pending",created_at:(new Date).toISOString()});if(s)throw s;P(""),E(""),R(),o({title:"Topic Added",description:"Topic added to content queue"})}catch(e){o({title:"Error",description:e.message,variant:"destructive"})}else o({title:"Topic Required",description:"Please enter a blog topic",variant:"destructive"})},className:"flex-1",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Add to Queue"]}),e.jsxs(d,{onClick:async()=>{const e=[{topic:"The Ultimate Guide to AI Health Coaching",keywords:"ai health coach, ai coaching app, personalized health"},{topic:"How to Lose Weight with Personalized Meal Plans",keywords:"weight loss, meal planning, personalized nutrition"},{topic:"Complete Guide to Tracking Macros for Beginners",keywords:"macro tracking, macronutrients, calorie counting"},{topic:"Best Foods for Muscle Building and Recovery",keywords:"muscle building, protein foods, recovery nutrition"},{topic:"30-Day Fitness Challenge with AI Coaching",keywords:"fitness challenge, 30 day workout, ai fitness"},{topic:"Intermittent Fasting: A Complete Guide",keywords:"intermittent fasting, fasting benefits, weight loss"},{topic:"Sleep and Weight Loss: The Surprising Connection",keywords:"sleep quality, weight loss, health habits"},{topic:"How to Stay Motivated on Your Health Journey",keywords:"motivation, health goals, consistency"},{topic:"Understanding BMI and Body Composition",keywords:"bmi calculator, body composition, health metrics"},{topic:"Meal Prep for Busy Professionals",keywords:"meal prep, healthy eating, time management"}];try{for(const s of e)await c.from("blog_content_queue").insert({topic:s.topic,keywords:s.keywords,status:"pending",created_at:(new Date).toISOString()});R(),o({title:"Topics Added",description:`${e.length} topics added to queue`})}catch(s){o({title:"Error",description:s.message,variant:"destructive"})}},variant:"outline",children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),"Add 10 Topics"]})]})]})]}),e.jsxs(_,{children:[e.jsx(k,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(S,{children:["Content Queue (",g.length," topics)"]}),e.jsx(d,{size:"sm",variant:"outline",onClick:async()=>{if(0!==g.length){w(!0);try{const a=g[0],t=`You are an expert SEO content writer specializing in health, wellness, nutrition, and fitness.\n\nCreate a comprehensive, SEO-optimized blog post with the following specifications:\n\n**Topic**: ${a.topic}\n**Target Keywords**: ${a.keywords}\n**Target Audience**: Health-conscious individuals seeking AI-powered wellness solutions\n**Content Type**: Ultimate Guide\n**Tone**: Professional yet friendly\n**Target Word Count**: 2000 words\n\n**Requirements**:\n1. Create a compelling, click-worthy headline (50-60 characters)\n2. Write an engaging meta description (150-160 characters)\n3. Start with a hook that grabs attention\n4. Use H2 and H3 headers for structure (include keywords naturally)\n5. Include actionable tips and practical advice\n6. Add internal linking suggestions (to other relevant topics)\n7. Include a call-to-action at the end\n8. Naturally integrate the target keywords throughout\n9. Make it valuable, informative, and engaging\n\n**Format the response as JSON**:\n{\n  "title": "SEO-optimized blog title",\n  "slug": "url-friendly-slug",\n  "metaDescription": "Compelling meta description",\n  "content": "Full blog post content in markdown format",\n  "excerpt": "2-3 sentence excerpt for previews",\n  "keywords": ["keyword1", "keyword2", "keyword3"],\n  "readingTime": "estimated reading time in minutes",\n  "seoScore": "estimated SEO score out of 100"\n}\n\nGenerate the blog post now. Return ONLY the JSON object, no other text.`,r=await fetch("/api-generate-blog.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:t})});if(!r.ok)throw new Error(`Gemini API error: ${r.status}`);const i=await r.json();if(!i.candidates||!i.candidates[0])throw new Error("No content generated from Gemini");const l=i.candidates[0].content.parts[0].text;let n;try{const e=l.match(/```json\n([\s\S]*?)\n```/)||l.match(/\{[\s\S]*\}/);n=e?JSON.parse(e[1]||e[0]):{title:a.topic,slug:a.topic.toLowerCase().replace(/[^a-z0-9]+/g,"-"),metaDescription:`Discover everything you need to know about ${a.topic}`,content:l,excerpt:l.substring(0,200)+"...",keywords:a.keywords.split(",").map(e=>e.trim()),readingTime:Math.ceil(l.split(" ").length/200),seoScore:75}}catch(e){throw console.error("Error parsing Gemini response:",e),new Error("Failed to parse AI response")}const{error:d}=await c.from("blog_posts").insert({title:n.title,slug:n.slug,content:n.content,excerpt:n.excerpt,meta_description:n.metaDescription,author_id:s.id,status:u?"published":"draft",created_at:(new Date).toISOString(),published_at:u?(new Date).toISOString():null});if(d)throw d;await c.from("blog_content_queue").update({status:"generated",generated_at:(new Date).toISOString()}).eq("id",a.id),R(),q(),o({title:"Blog Post Generated!",description:`"${n.title}" has been ${u?"published":"saved as draft"}`})}catch(a){console.error("Error generating post:",a),o({title:"Generation Failed",description:a.message,variant:"destructive"})}finally{w(!1)}}else o({title:"Queue Empty",description:"Add topics to the queue first",variant:"destructive"})},disabled:N,children:N?e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"w-4 h-4 mr-2 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Generate Next"]})})]})}),e.jsx(C,{children:0===g.length?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(L,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No topics in queue"}),e.jsx("p",{className:"text-sm mt-1",children:"Add topics to start auto-generating content"})]}):e.jsx("div",{className:"space-y-3",children:g.map((s,a)=>e.jsxs("div",{className:"flex items-start gap-3 p-4 border rounded-lg hover:bg-muted/30",children:[e.jsxs(v,{variant:"outline",className:"mt-1",children:["#",a+1]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:s.topic}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Keywords: ",s.keywords]})]}),e.jsx(d,{size:"sm",variant:"ghost",onClick:()=>(async e=>{try{const{error:s}=await c.from("blog_content_queue").delete().eq("id",e);if(s)throw s;R(),o({title:"Removed",description:"Topic removed from queue"})}catch(s){o({title:"Error",description:s.message,variant:"destructive"})}})(s.id),children:e.jsx(V,{className:"w-4 h-4"})})]},s.id))})})]})]}),e.jsx(fs,{value:"history",className:"space-y-4",children:e.jsxs(_,{children:[e.jsxs(k,{children:[e.jsx(S,{children:"Recently Generated Posts"}),e.jsx(A,{children:"Last 10 blog posts generated by the auto-blogger"})]}),e.jsx(C,{children:0===f.length?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ue,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No posts generated yet"})]}):e.jsx("div",{className:"space-y-3",children:f.map(s=>e.jsx("div",{className:"p-4 border rounded-lg hover:bg-muted/30",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:new Date(s.created_at).toLocaleString()})]}),e.jsx(v,{variant:s.published?"default":"secondary",children:s.published?"Published":"Draft"})]})},s.id))})})]})})]})]})},et=({user:s})=>{const[a,t]=i.useState("posts");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Blog Management"}),e.jsx("p",{className:"text-text-secondary mt-1",children:"Manage blog posts, generate AI content, and automate publishing"})]}),e.jsxs(ps,{value:a,onValueChange:t,className:"w-full",children:[e.jsxs(gs,{className:"grid w-full grid-cols-3 mb-6",children:[e.jsxs(js,{value:"posts",className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Blog Posts"]}),e.jsxs(js,{value:"ai-writer",className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-4 h-4"}),"AI Writer"]}),e.jsxs(js,{value:"auto-scheduler",className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4"}),"Auto Scheduler"]})]}),e.jsx(fs,{value:"posts",className:"mt-0",children:e.jsx(w,{user:s})}),e.jsx(fs,{value:"ai-writer",className:"mt-0",children:e.jsx(Xa,{user:s})}),e.jsx(fs,{value:"auto-scheduler",className:"mt-0",children:e.jsx(Za,{user:s})})]})]})},st=({user:s})=>{const[a]=n(),[t,r]=i.useState("dashboard");i.useEffect(()=>{const e=a.get("tab");r(e||"dashboard")},[a]);const l=[{id:"dashboard",label:"Dashboard",icon:Ze},{id:"analytics",label:"Analytics",icon:O},{id:"revenue",label:"Revenue",icon:T},{id:"errors",label:"AI Errors",icon:es},{id:"customers",label:"User Management",icon:F},{id:"subscriptions",label:"Subscriptions",icon:D},{id:"payments",label:"Payments",icon:ss},{id:"coupons",label:"Coupons",icon:R},{id:"referrals",label:"Referrals",icon:re},{id:"issues",label:"Support",icon:z},{id:"messaging",label:"Messaging",icon:Se},{id:"blog",label:"Blog",icon:le},{id:"website",label:"Website",icon:q},{id:"ai-coach",label:"AI Coach",icon:We},{id:"studio",label:"Database",icon:B}];i.useMemo(()=>{if(!s||!s.role)return l;if("super_admin"===s.role||"admin"===s.role)return l;const e=((e,s)=>e&&e.role?s.filter(s=>ha(e,s.id)):[])(s,l);return 0===e.length?(console.warn("No accessible tabs found, showing all tabs as fallback"),l):e},[s]);return e.jsx("div",{className:"max-w-7xl xl:max-w-[1600px] 2xl:max-w-[1800px] mx-auto px-4 lg:px-6 xl:px-8",children:e.jsx(b,{children:e.jsx(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:(()=>{switch(t){case"dashboard":return e.jsx(ua,{user:s,onNavigate:r});case"analytics":return e.jsx(ga,{user:s});case"revenue":return e.jsx(ks,{});case"errors":return e.jsx(Ja,{user:s});case"studio":return e.jsx(pa,{user:s});case"customers":return e.jsx(ka,{user:s});case"subscriptions":return e.jsx(va,{user:s});case"payments":return e.jsx(Pa,{user:s});case"coupons":return e.jsx(Ua,{user:s});case"referrals":return e.jsx(Oa,{user:s});case"issues":return e.jsx(Fa,{user:s});case"messaging":return e.jsx(Ka,{user:s});case"blog":return e.jsx(et,{user:s});case"website":return e.jsx(Da,{user:s});case"ai-coach":return e.jsx(Ya,{user:s});default:return e.jsx(ua,{user:s})}})()},t)})})},at=()=>{const{userProfile:s}=p(),a={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}};return e.jsxs(e.Fragment,{children:[e.jsxs(N,{children:[e.jsx("title",{children:"Admin Dashboard - GreenoFig"}),e.jsx("meta",{name:"description",content:"Platform management and analytics."})]}),e.jsxs(I.div,{variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"visible",className:"space-y-8",children:[e.jsxs(I.div,{variants:a,children:[e.jsxs("h1",{className:"text-4xl font-bold",children:["Admin ",e.jsx("span",{className:"gradient-text",children:"Command Center"})]}),e.jsxs("p",{className:"text-text-secondary mt-2",children:["Welcome, ",s?.full_name?.split(" ")[0]||"Admin",". Manage your platform from here."]})]}),e.jsx(I.div,{variants:a,children:e.jsx(st,{user:s})})]})]})};export{at as default};
