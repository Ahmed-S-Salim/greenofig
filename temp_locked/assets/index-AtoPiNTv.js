const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/HomePage-bGtJwXA5.js","assets/vendor-ui-CAdTc8ma.js","assets/vendor-react-DYWoKpfz.js","assets/vendor-utils-7_dm-8Ld.js","assets/vendor-editor-CURn2XBo.js","assets/FeaturesPage-CH-j8m7d.js","assets/SiteLayout-BldEA76M.js","assets/OnboardingSurvey-CnRxse4o.js","assets/dialog-DSKAuchR.js","assets/PricingPage-D07bqDAk.js","assets/index-1v_AfJpO.js","assets/BlogPage-lUFncQvf.js","assets/card-DObhyBOQ.js","assets/tabs-W0guYPUx.js","assets/ReviewsPage-DhrhOlTA.js","assets/ContactPage--or61h1g.js","assets/FaqPage-DiiEw8hu.js","assets/AboutPage-CAy-ytq0.js","assets/UserDashboard-ji0jSkOT.js","assets/QuickLogMeal-YLW-OVB5.js","assets/select-Bp8Ho6UQ.js","assets/NutritionistDashboardV2-CPd21A2i.js","assets/EnhancedBlogManager-CInowFod.js","assets/checkbox-DuXmcnMA.js","assets/switch-CvX_loKb.js","assets/AdminDashboard-C7BnRBPD.js","assets/dropdown-menu-L6LqwziZ.js","assets/RevenueAnalyticsPage-yL14w6kJ.js","assets/ProfilePage-Co7ygh2F.js","assets/EnhancedBlogPostEditor-BC3LfLnl.js","assets/BlogTagsManager-DwhmEahY.js","assets/AiCoachPage-C4cElmHc.js","assets/SurveyPage-BjhCusO4.js","assets/BillingPage-pnafAO4f.js","assets/SupportPage-CaNQ0n9z.js","assets/ResetPasswordPage-l_0t77MT.js","assets/NutritionPageFunctional-B1VzO5k1.js","assets/FitnessPage-B91cXkYG.js","assets/ProgressPage-C-X84hAu.js","assets/MessagingCenter-BUw159R7.js","assets/PrivacyPolicyPage-ChgYPrho.js","assets/TermsOfServicePage-BUIlp8ao.js","assets/AdminFAQPage-vVwXIOjo.js","assets/DownloadPage-Dyb_Jtd6.js"])))=>i.map(i=>d[i]);
import{j as e,a8 as t,a9 as r,aa as s,ab as n,ac as i,ad as o,ae as a,af as l,ag as c,ah as u,ai as d,aj as h}from"./vendor-ui-CAdTc8ma.js";import{j as f,g as p,r as m,R as g,a as y,k as b,i as v,u as w,f as _,L as x,O as j,N as T,l as k,m as S,n as E,B as O}from"./vendor-react-DYWoKpfz.js";import{bS as N,bT as P,al as C,m as A,e as I,b as R,U as $,h as L,l as D,r as U,H as B,b6 as F,bU as M,bV as z,bW as H,w as q,i as V,g as W,G as J,a2 as G,ae as K,N as Y,az as Q,a9 as X,bX as Z,bJ as ee,bP as te,s as re,C as se,D as ne,ao as ie,K as oe,f as ae,an as le,bt as ce,y as ue,bQ as de,a1 as he,bR as fe,bw as pe,bz as me,a8 as ge,b3 as ye,bx as be,L as ve}from"./vendor-utils-7_dm-8Ld.js";import"./vendor-editor-CURn2XBo.js";function we(e,t){for(var r=0;r<t.length;r++){const s=t[r];if("string"!=typeof s&&!Array.isArray(s))for(const t in s)if("default"!==t&&!(t in e)){const r=Object.getOwnPropertyDescriptor(s,t);r&&Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:()=>s[t]})}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var _e,xe={};const je=p(function(){if(_e)return xe;_e=1;var e=f();return xe.createRoot=e.createRoot,xe.hydrateRoot=e.hydrateRoot,xe}()),Te={},ke=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),n=r?.nonce||r?.getAttribute("nonce");s=e(t.map(e=>{if((e=function(e){return"/"+e}(e))in Te)return;Te[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const s=document.createElement("link");return s.rel=t?"stylesheet":"modulepreload",t||(s.as="script"),s.crossOrigin="",s.href=e,n&&s.setAttribute("nonce",n),document.head.appendChild(s),t?new Promise((t,r)=>{s.addEventListener("load",t),s.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then(t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)})};var Se,Ee,Oe,Ne,Pe,Ce={exports:{}};function Ae(){if(Ee)return Se;Ee=1;return Se="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}function Ie(){if(Ne)return Oe;Ne=1;var e=Ae();function t(){}function r(){}return r.resetWarningCache=t,Oe=function(){function s(t,r,s,n,i,o){if(o!==e){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function n(){return s}s.isRequired=s;var i={array:s,bigint:s,bool:s,func:s,number:s,object:s,string:s,symbol:s,any:s,arrayOf:n,element:s,elementType:s,instanceOf:n,node:s,objectOf:n,oneOf:n,oneOfType:n,shape:n,exact:n,checkPropTypes:r,resetWarningCache:t};return i.PropTypes=i,i}}function Re(){return Pe||(Pe=1,Ce.exports=Ie()()),Ce.exports}const $e=p(Re());var Le,De;const Ue=p(function(){if(De)return Le;De=1;var e,t=m(),r=(e=t)&&"object"==typeof e&&"default"in e?e.default:e;function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var n=!("undefined"==typeof window||!window.document||!window.document.createElement);return Le=function(e,i,o){if("function"!=typeof e)throw new Error("Expected reducePropsToState to be a function.");if("function"!=typeof i)throw new Error("Expected handleStateChangeOnClient to be a function.");if(void 0!==o&&"function"!=typeof o)throw new Error("Expected mapStateOnServer to either be undefined or a function.");return function(a){if("function"!=typeof a)throw new Error("Expected WrappedComponent to be a React component.");var l,c=[];function u(){l=e(c.map(function(e){return e.props})),d.canUseDOM?i(l):o&&(l=o(l))}var d=function(e){var t,s;function n(){return e.apply(this,arguments)||this}s=e,(t=n).prototype=Object.create(s.prototype),t.prototype.constructor=t,t.__proto__=s,n.peek=function(){return l},n.rewind=function(){if(n.canUseDOM)throw new Error("You may only call rewind() on the server. Call peek() to read the current state.");var e=l;return l=void 0,c=[],e};var i=n.prototype;return i.UNSAFE_componentWillMount=function(){c.push(this),u()},i.componentDidUpdate=function(){u()},i.componentWillUnmount=function(){var e=c.indexOf(this);c.splice(e,1),u()},i.render=function(){return r.createElement(a,this.props)},n}(t.PureComponent);return s(d,"displayName","SideEffect("+function(e){return e.displayName||e.name||"Component"}(a)+")"),s(d,"canUseDOM",n),d}}}());var Be,Fe;const Me=p(function(){if(Fe)return Be;Fe=1;var e="undefined"!=typeof Element,t="function"==typeof Map,r="function"==typeof Set,s="function"==typeof ArrayBuffer&&!!ArrayBuffer.isView;function n(i,o){if(i===o)return!0;if(i&&o&&"object"==typeof i&&"object"==typeof o){if(i.constructor!==o.constructor)return!1;var a,l,c,u;if(Array.isArray(i)){if((a=i.length)!=o.length)return!1;for(l=a;0!==l--;)if(!n(i[l],o[l]))return!1;return!0}if(t&&i instanceof Map&&o instanceof Map){if(i.size!==o.size)return!1;for(u=i.entries();!(l=u.next()).done;)if(!o.has(l.value[0]))return!1;for(u=i.entries();!(l=u.next()).done;)if(!n(l.value[1],o.get(l.value[0])))return!1;return!0}if(r&&i instanceof Set&&o instanceof Set){if(i.size!==o.size)return!1;for(u=i.entries();!(l=u.next()).done;)if(!o.has(l.value[0]))return!1;return!0}if(s&&ArrayBuffer.isView(i)&&ArrayBuffer.isView(o)){if((a=i.length)!=o.length)return!1;for(l=a;0!==l--;)if(i[l]!==o[l])return!1;return!0}if(i.constructor===RegExp)return i.source===o.source&&i.flags===o.flags;if(i.valueOf!==Object.prototype.valueOf&&"function"==typeof i.valueOf&&"function"==typeof o.valueOf)return i.valueOf()===o.valueOf();if(i.toString!==Object.prototype.toString&&"function"==typeof i.toString&&"function"==typeof o.toString)return i.toString()===o.toString();if((a=(c=Object.keys(i)).length)!==Object.keys(o).length)return!1;for(l=a;0!==l--;)if(!Object.prototype.hasOwnProperty.call(o,c[l]))return!1;if(e&&i instanceof Element)return!1;for(l=a;0!==l--;)if(("_owner"!==c[l]&&"__v"!==c[l]&&"__o"!==c[l]||!i.$$typeof)&&!n(i[c[l]],o[c[l]]))return!1;return!0}return i!=i&&o!=o}return Be=function(e,t){try{return n(e,t)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}}}());
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var ze,He;const qe=p(function(){if(He)return ze;He=1;var e=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;return ze=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var s={};return"abcdefghijklmnopqrst".split("").forEach(function(e){s[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},s)).join("")}catch(n){return!1}}()?Object.assign:function(s,n){for(var i,o,a=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(s),l=1;l<arguments.length;l++){for(var c in i=Object(arguments[l]))t.call(i,c)&&(a[c]=i[c]);if(e){o=e(i);for(var u=0;u<o.length;u++)r.call(i,o[u])&&(a[o[u]]=i[o[u]])}}return a}}());var Ve="bodyAttributes",We="htmlAttributes",Je="titleAttributes",Ge={BASE:"base",BODY:"body",HEAD:"head",HTML:"html",LINK:"link",META:"meta",NOSCRIPT:"noscript",SCRIPT:"script",STYLE:"style",TITLE:"title"};Object.keys(Ge).map(function(e){return Ge[e]});var Ke,Ye,Qe,Xe,Ze="charset",et="cssText",tt="href",rt="http-equiv",st="innerHTML",nt="itemprop",it="name",ot="property",at="rel",lt="src",ct="target",ut={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},dt="defaultTitle",ht="defer",ft="encodeSpecialCharacters",pt="onChangeClientState",mt="titleTemplate",gt=Object.keys(ut).reduce(function(e,t){return e[ut[t]]=t,e},{}),yt=[Ge.NOSCRIPT,Ge.SCRIPT,Ge.STYLE],bt="data-react-helmet",vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wt=function(){function e(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,r,s){return r&&e(t.prototype,r),s&&e(t,s),t}}(),_t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},xt=function(e,t){var r={};for(var s in e)t.indexOf(s)>=0||Object.prototype.hasOwnProperty.call(e,s)&&(r[s]=e[s]);return r},jt=function(e){return!1===(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])?String(e):String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},Tt=function(e){var t=Nt(e,Ge.TITLE),r=Nt(e,mt);if(r&&t)return r.replace(/%s/g,function(){return Array.isArray(t)?t.join(""):t});var s=Nt(e,dt);return t||s||void 0},kt=function(e){return Nt(e,pt)||function(){}},St=function(e,t){return t.filter(function(t){return void 0!==t[e]}).map(function(t){return t[e]}).reduce(function(e,t){return _t({},e,t)},{})},Et=function(e,t){return t.filter(function(e){return void 0!==e[Ge.BASE]}).map(function(e){return e[Ge.BASE]}).reverse().reduce(function(t,r){if(!t.length)for(var s=Object.keys(r),n=0;n<s.length;n++){var i=s[n].toLowerCase();if(-1!==e.indexOf(i)&&r[i])return t.concat(r)}return t},[])},Ot=function(e,t,r){var s={};return r.filter(function(t){return!!Array.isArray(t[e])||(void 0!==t[e]&&Rt("Helmet: "+e+' should be of type "Array". Instead found type "'+vt(t[e])+'"'),!1)}).map(function(t){return t[e]}).reverse().reduce(function(e,r){var n={};r.filter(function(e){for(var r=void 0,i=Object.keys(e),o=0;o<i.length;o++){var a=i[o],l=a.toLowerCase();-1===t.indexOf(l)||r===at&&"canonical"===e[r].toLowerCase()||l===at&&"stylesheet"===e[l].toLowerCase()||(r=l),-1===t.indexOf(a)||a!==st&&a!==et&&a!==nt||(r=a)}if(!r||!e[r])return!1;var c=e[r].toLowerCase();return s[r]||(s[r]={}),n[r]||(n[r]={}),!s[r][c]&&(n[r][c]=!0,!0)}).reverse().forEach(function(t){return e.push(t)});for(var i=Object.keys(n),o=0;o<i.length;o++){var a=i[o],l=qe({},s[a],n[a]);s[a]=l}return e},[]).reverse()},Nt=function(e,t){for(var r=e.length-1;r>=0;r--){var s=e[r];if(s.hasOwnProperty(t))return s[t]}return null},Pt=(Ke=Date.now(),function(e){var t=Date.now();t-Ke>16?(Ke=t,e(t)):setTimeout(function(){Pt(e)},0)}),Ct=function(e){return clearTimeout(e)},At="undefined"!=typeof window?window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||Pt:global.requestAnimationFrame||Pt,It="undefined"!=typeof window?window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||Ct:global.cancelAnimationFrame||Ct,Rt=function(e){return console&&"function"==typeof console.warn&&console.warn(e)},$t=null,Lt=function(e,t){var r=e.baseTag,s=e.bodyAttributes,n=e.htmlAttributes,i=e.linkTags,o=e.metaTags,a=e.noscriptTags,l=e.onChangeClientState,c=e.scriptTags,u=e.styleTags,d=e.title,h=e.titleAttributes;Bt(Ge.BODY,s),Bt(Ge.HTML,n),Ut(d,h);var f={baseTag:Ft(Ge.BASE,r),linkTags:Ft(Ge.LINK,i),metaTags:Ft(Ge.META,o),noscriptTags:Ft(Ge.NOSCRIPT,a),scriptTags:Ft(Ge.SCRIPT,c),styleTags:Ft(Ge.STYLE,u)},p={},m={};Object.keys(f).forEach(function(e){var t=f[e],r=t.newTags,s=t.oldTags;r.length&&(p[e]=r),s.length&&(m[e]=f[e].oldTags)}),t&&t(),l(e,p,m)},Dt=function(e){return Array.isArray(e)?e.join(""):e},Ut=function(e,t){void 0!==e&&document.title!==e&&(document.title=Dt(e)),Bt(Ge.TITLE,t)},Bt=function(e,t){var r=document.getElementsByTagName(e)[0];if(r){for(var s=r.getAttribute(bt),n=s?s.split(","):[],i=[].concat(n),o=Object.keys(t),a=0;a<o.length;a++){var l=o[a],c=t[l]||"";r.getAttribute(l)!==c&&r.setAttribute(l,c),-1===n.indexOf(l)&&n.push(l);var u=i.indexOf(l);-1!==u&&i.splice(u,1)}for(var d=i.length-1;d>=0;d--)r.removeAttribute(i[d]);n.length===i.length?r.removeAttribute(bt):r.getAttribute(bt)!==o.join(",")&&r.setAttribute(bt,o.join(","))}},Ft=function(e,t){var r=document.head||document.querySelector(Ge.HEAD),s=r.querySelectorAll(e+"["+bt+"]"),n=Array.prototype.slice.call(s),i=[],o=void 0;return t&&t.length&&t.forEach(function(t){var r=document.createElement(e);for(var s in t)if(t.hasOwnProperty(s))if(s===st)r.innerHTML=t.innerHTML;else if(s===et)r.styleSheet?r.styleSheet.cssText=t.cssText:r.appendChild(document.createTextNode(t.cssText));else{var a=void 0===t[s]?"":t[s];r.setAttribute(s,a)}r.setAttribute(bt,"true"),n.some(function(e,t){return o=t,r.isEqualNode(e)})?n.splice(o,1):i.push(r)}),n.forEach(function(e){return e.parentNode.removeChild(e)}),i.forEach(function(e){return r.appendChild(e)}),{oldTags:n,newTags:i}},Mt=function(e){return Object.keys(e).reduce(function(t,r){var s=void 0!==e[r]?r+'="'+e[r]+'"':""+r;return t?t+" "+s:s},"")},zt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(e).reduce(function(t,r){return t[ut[r]||r]=e[r],t},t)},Ht=function(e,t,r){switch(e){case Ge.TITLE:return{toComponent:function(){return e=t.title,r=t.titleAttributes,(s={key:e})[bt]=!0,n=zt(r,s),[g.createElement(Ge.TITLE,n,e)];var e,r,s,n},toString:function(){return function(e,t,r,s){var n=Mt(r),i=Dt(t);return n?"<"+e+" "+bt+'="true" '+n+">"+jt(i,s)+"</"+e+">":"<"+e+" "+bt+'="true">'+jt(i,s)+"</"+e+">"}(e,t.title,t.titleAttributes,r)}};case Ve:case We:return{toComponent:function(){return zt(t)},toString:function(){return Mt(t)}};default:return{toComponent:function(){return function(e,t){return t.map(function(t,r){var s,n=((s={key:r})[bt]=!0,s);return Object.keys(t).forEach(function(e){var r=ut[e]||e;if(r===st||r===et){var s=t.innerHTML||t.cssText;n.dangerouslySetInnerHTML={__html:s}}else n[r]=t[e]}),g.createElement(e,n)})}(e,t)},toString:function(){return function(e,t,r){return t.reduce(function(t,s){var n=Object.keys(s).filter(function(e){return!(e===st||e===et)}).reduce(function(e,t){var n=void 0===s[t]?t:t+'="'+jt(s[t],r)+'"';return e?e+" "+n:n},""),i=s.innerHTML||s.cssText||"",o=-1===yt.indexOf(e);return t+"<"+e+" "+bt+'="true" '+n+(o?"/>":">"+i+"</"+e+">")},"")}(e,t,r)}}}},qt=function(e){var t=e.baseTag,r=e.bodyAttributes,s=e.encode,n=e.htmlAttributes,i=e.linkTags,o=e.metaTags,a=e.noscriptTags,l=e.scriptTags,c=e.styleTags,u=e.title,d=void 0===u?"":u,h=e.titleAttributes;return{base:Ht(Ge.BASE,t,s),bodyAttributes:Ht(Ve,r,s),htmlAttributes:Ht(We,n,s),link:Ht(Ge.LINK,i,s),meta:Ht(Ge.META,o,s),noscript:Ht(Ge.NOSCRIPT,a,s),script:Ht(Ge.SCRIPT,l,s),style:Ht(Ge.STYLE,c,s),title:Ht(Ge.TITLE,{title:d,titleAttributes:h},s)}},Vt=Ue(function(e){return{baseTag:Et([tt,ct],e),bodyAttributes:St(Ve,e),defer:Nt(e,ht),encode:Nt(e,ft),htmlAttributes:St(We,e),linkTags:Ot(Ge.LINK,[at,tt],e),metaTags:Ot(Ge.META,[it,Ze,rt,ot,nt],e),noscriptTags:Ot(Ge.NOSCRIPT,[st],e),onChangeClientState:kt(e),scriptTags:Ot(Ge.SCRIPT,[lt,st],e),styleTags:Ot(Ge.STYLE,[et],e),title:Tt(e),titleAttributes:St(Je,e)}},function(e){$t&&It($t),e.defer?$t=At(function(){Lt(e,function(){$t=null})}):(Lt(e),$t=null)},qt)(function(){return null}),Wt=(Ye=Vt,Xe=Qe=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.shouldComponentUpdate=function(e){return!Me(this.props,e)},t.prototype.mapNestedChildrenToProps=function(e,t){if(!t)return null;switch(e.type){case Ge.SCRIPT:case Ge.NOSCRIPT:return{innerHTML:t};case Ge.STYLE:return{cssText:t}}throw new Error("<"+e.type+" /> elements are self-closing and can not contain children. Refer to our API for more information.")},t.prototype.flattenArrayTypeChildren=function(e){var t,r=e.child,s=e.arrayTypeChildren,n=e.newChildProps,i=e.nestedChildren;return _t({},s,((t={})[r.type]=[].concat(s[r.type]||[],[_t({},n,this.mapNestedChildrenToProps(r,i))]),t))},t.prototype.mapObjectTypeChildren=function(e){var t,r,s=e.child,n=e.newProps,i=e.newChildProps,o=e.nestedChildren;switch(s.type){case Ge.TITLE:return _t({},n,((t={})[s.type]=o,t.titleAttributes=_t({},i),t));case Ge.BODY:return _t({},n,{bodyAttributes:_t({},i)});case Ge.HTML:return _t({},n,{htmlAttributes:_t({},i)})}return _t({},n,((r={})[s.type]=_t({},i),r))},t.prototype.mapArrayTypeChildrenToProps=function(e,t){var r=_t({},t);return Object.keys(e).forEach(function(t){var s;r=_t({},r,((s={})[t]=e[t],s))}),r},t.prototype.warnOnInvalidChildren=function(e,t){return!0},t.prototype.mapChildrenToProps=function(e,t){var r=this,s={};return g.Children.forEach(e,function(e){if(e&&e.props){var n=e.props,i=n.children,o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(e).reduce(function(t,r){return t[gt[r]||r]=e[r],t},t)}(xt(n,["children"]));switch(r.warnOnInvalidChildren(e,i),e.type){case Ge.LINK:case Ge.META:case Ge.NOSCRIPT:case Ge.SCRIPT:case Ge.STYLE:s=r.flattenArrayTypeChildren({child:e,arrayTypeChildren:s,newChildProps:o,nestedChildren:i});break;default:t=r.mapObjectTypeChildren({child:e,newProps:t,newChildProps:o,nestedChildren:i})}}}),t=this.mapArrayTypeChildrenToProps(s,t)},t.prototype.render=function(){var e=this.props,t=e.children,r=xt(e,["children"]),s=_t({},r);return t&&(s=this.mapChildrenToProps(t,s)),g.createElement(Ye,s)},wt(t,null,[{key:"canUseDOM",set:function(e){Ye.canUseDOM=e}}]),t}(g.Component),Qe.propTypes={base:$e.object,bodyAttributes:$e.object,children:$e.oneOfType([$e.arrayOf($e.node),$e.node]),defaultTitle:$e.string,defer:$e.bool,encodeSpecialCharacters:$e.bool,htmlAttributes:$e.object,link:$e.arrayOf($e.object),meta:$e.arrayOf($e.object),noscript:$e.arrayOf($e.object),onChangeClientState:$e.func,script:$e.arrayOf($e.object),style:$e.arrayOf($e.object),title:$e.string,titleAttributes:$e.object,titleTemplate:$e.string},Qe.defaultProps={defer:!0,encodeSpecialCharacters:!0},Qe.peek=Ye.peek,Qe.rewind=function(){var e=Ye.rewind();return e||(e=qt({baseTag:[],bodyAttributes:{},htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}})),e},Xe);function Jt(...e){return N(P(e))}Wt.renderStatic=Wt.rewind;const Gt=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,Kt=P,Yt=(e,t)=>r=>{var s;if(null==(null==t?void 0:t.variants))return Kt(e,null==r?void 0:r.class,null==r?void 0:r.className);const{variants:n,defaultVariants:i}=t,o=Object.keys(n).map(e=>{const t=null==r?void 0:r[e],s=null==i?void 0:i[e];if(null===t)return null;const o=Gt(t)||Gt(s);return n[e][o]}),a=r&&Object.entries(r).reduce((e,t)=>{let[r,s]=t;return void 0===s||(e[r]=s),e},{}),l=null==t||null===(s=t.compoundVariants)||void 0===s?void 0:s.reduce((e,t)=>{let{class:r,className:s,...n}=t;return Object.entries(n).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...i,...a}[t]):{...i,...a}[t]===r})?[...e,r,s]:e},[]);return Kt(e,o,l,null==r?void 0:r.class,null==r?void 0:r.className)},Qt=a,Xt=g.forwardRef(({className:r,...s},n)=>e.jsx(t,{ref:n,className:Jt("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",r),...s}));Xt.displayName=t.displayName;const Zt=Yt("data-[swipe=move]:transition-none group relative pointer-events-auto flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full data-[state=closed]:slide-out-to-right-full",{variants:{variant:{default:"bg-background border",destructive:"group destructive border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),er=g.forwardRef(({className:t,variant:s,...n},i)=>e.jsx(r,{ref:i,className:Jt(Zt({variant:s}),t),...n}));er.displayName=r.displayName;g.forwardRef(({className:t,...r},n)=>e.jsx(s,{ref:n,className:Jt("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-destructive/30 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...r})).displayName=s.displayName;const tr=g.forwardRef(({className:t,...r},s)=>e.jsx(n,{ref:s,className:Jt("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...r,children:e.jsx(C,{className:"h-4 w-4"})}));tr.displayName=n.displayName;const rr=g.forwardRef(({className:t,...r},s)=>e.jsx(i,{ref:s,className:Jt("text-sm font-semibold",t),...r}));rr.displayName=i.displayName;const sr=g.forwardRef(({className:t,...r},s)=>e.jsx(o,{ref:s,className:Jt("text-sm opacity-90",t),...r}));sr.displayName=o.displayName;let nr=0;const ir={state:{toasts:[]},listeners:[],getState:()=>ir.state,setState:e=>{ir.state="function"==typeof e?e(ir.state):{...ir.state,...e},ir.listeners.forEach(e=>e(ir.state))},subscribe:e=>(ir.listeners.push(e),()=>{ir.listeners=ir.listeners.filter(t=>t!==e)})},or=({...e})=>{const t=(nr=(nr+1)%Number.MAX_VALUE,nr.toString()),r=()=>ir.setState(e=>({...e,toasts:e.toasts.filter(e=>e.id!==t)}));return ir.setState(s=>({...s,toasts:[{...e,id:t,dismiss:r},...s.toasts].slice(0,1)})),{id:t,dismiss:r,update:e=>ir.setState(r=>({...r,toasts:r.toasts.map(r=>r.id===t?{...r,...e}:r)}))}};function ar(){const[e,t]=y.useState(ir.getState());return y.useEffect(()=>ir.subscribe(e=>{t(e)}),[]),y.useEffect(()=>{const t=[];return e.toasts.forEach(e=>{if(e.duration===1/0)return;const r=setTimeout(()=>{e.dismiss()},e.duration||5e3);t.push(r)}),()=>{t.forEach(e=>clearTimeout(e))}},[e.toasts]),{toast:or,toasts:e.toasts}}function lr(){const{toasts:t}=ar();return e.jsxs(Qt,{children:[t.map(({id:t,title:r,description:s,action:n,...i})=>e.jsxs(er,{...i,children:[e.jsxs("div",{className:"grid gap-1",children:[r&&e.jsx(rr,{children:r}),s&&e.jsx(sr,{children:s})]}),n,e.jsx(tr,{})]},t)),e.jsx(Xt,{})]})}class cr extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class ur extends cr{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class dr extends cr{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class hr extends cr{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var fr,pr;(pr=fr||(fr={})).Any="any",pr.ApNortheast1="ap-northeast-1",pr.ApNortheast2="ap-northeast-2",pr.ApSouth1="ap-south-1",pr.ApSoutheast1="ap-southeast-1",pr.ApSoutheast2="ap-southeast-2",pr.CaCentral1="ca-central-1",pr.EuCentral1="eu-central-1",pr.EuWest1="eu-west-1",pr.EuWest2="eu-west-2",pr.EuWest3="eu-west-3",pr.SaEast1="sa-east-1",pr.UsEast1="us-east-1",pr.UsWest1="us-west-1",pr.UsWest2="us-west-2";var mr=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};class gr{constructor(e,{headers:t={},customFetch:r,region:s=fr.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=(e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>ke(async()=>{const{default:e}=await Promise.resolve().then(()=>Nr);return{default:e}},void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)})(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return mr(this,arguments,void 0,function*(e,t={}){var r;try{const{headers:s,method:n,body:i,signal:o}=t;let a={},{region:l}=t;l||(l=this.region);const c=new URL(`${this.url}/${e}`);let u;l&&"any"!==l&&(a["x-region"]=l,c.searchParams.set("forceFunctionRegion",l)),i&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&("undefined"!=typeof Blob&&i instanceof Blob||i instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",u=i):"string"==typeof i?(a["Content-Type"]="text/plain",u=i):"undefined"!=typeof FormData&&i instanceof FormData?u=i:(a["Content-Type"]="application/json",u=JSON.stringify(i)));const d=yield this.fetch(c.toString(),{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:u,signal:o}).catch(e=>{if("AbortError"===e.name)throw e;throw new ur(e)}),h=d.headers.get("x-relay-error");if(h&&"true"===h)throw new dr(d);if(!d.ok)throw new hr(d);let f,p=(null!==(r=d.headers.get("Content-Type"))&&void 0!==r?r:"text/plain").split(";")[0].trim();return f="application/json"===p?yield d.json():"application/octet-stream"===p?yield d.blob():"text/event-stream"===p?d:"multipart/form-data"===p?yield d.formData():yield d.text(),{data:f,error:null,response:d}}catch(s){return s instanceof Error&&"AbortError"===s.name?{data:null,error:new ur(s)}:{data:null,error:s,response:s instanceof hr||s instanceof dr?s.context:void 0}}})}}var yr={},br={},vr={},wr={},_r={},xr={},jr=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();const Tr=jr.fetch,kr=jr.fetch.bind(jr),Sr=jr.Headers,Er=jr.Request,Or=jr.Response,Nr=Object.freeze(Object.defineProperty({__proto__:null,Headers:Sr,Request:Er,Response:Or,default:kr,fetch:Tr},Symbol.toStringTag,{value:"Module"})),Pr=b(Nr);var Cr,Ar,Ir,Rr,$r,Lr,Dr,Ur={};function Br(){if(Cr)return Ur;Cr=1,Object.defineProperty(Ur,"__esModule",{value:!0});class e extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}return Ur.default=e,Ur}function Fr(){if(Ar)return xr;Ar=1;var e=xr&&xr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(xr,"__esModule",{value:!0});const t=e(Pr),r=e(Br());return xr.default=class{constructor(e){var r,s;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!==(r=e.shouldThrowOnError)&&void 0!==r&&r,this.signal=e.signal,this.isMaybeSingle=null!==(s=e.isMaybeSingle)&&void 0!==s&&s,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=t.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{var t,s,n,i;let o=null,a=null,l=null,c=e.status,u=e.statusText;if(e.ok){if("HEAD"!==this.method){const r=await e.text();""===r||(a="text/csv"===this.headers.get("Accept")||this.headers.get("Accept")&&(null===(t=this.headers.get("Accept"))||void 0===t?void 0:t.includes("application/vnd.pgrst.plan+text"))?r:JSON.parse(r))}const r=null===(s=this.headers.get("Prefer"))||void 0===s?void 0:s.match(/count=(exact|planned|estimated)/),i=null===(n=e.headers.get("content-range"))||void 0===n?void 0:n.split("/");r&&i&&i.length>1&&(l=parseInt(i[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(a)&&(a.length>1?(o={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,l=null,c=406,u="Not Acceptable"):a=1===a.length?a[0]:null)}else{const t=await e.text();try{o=JSON.parse(t),Array.isArray(o)&&404===e.status&&(a=[],o=null,c=200,u="OK")}catch(d){404===e.status&&""===t?(c=204,u="No Content"):o={message:t}}if(o&&this.isMaybeSingle&&(null===(i=null==o?void 0:o.details)||void 0===i?void 0:i.includes("0 rows"))&&(o=null,c=200,u="OK"),o&&this.shouldThrowOnError)throw new r.default(o)}return{error:o,data:a,count:l,status:c,statusText:u}});return this.shouldThrowOnError||(s=s.catch(e=>{var t,r,s;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(r=null==e?void 0:e.stack)&&void 0!==r?r:""}`,hint:"",code:`${null!==(s=null==e?void 0:e.code)&&void 0!==s?s:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}returns(){return this}overrideTypes(){return this}},xr}function Mr(){if(Ir)return _r;Ir=1;var e=_r&&_r.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(_r,"__esModule",{value:!0});const t=e(Fr());class r extends t.default{select(e){let t=!1;const r=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s,referencedTable:n=s}={}){const i=n?`${n}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${void 0===r?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const s=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:s=r}={}){const n=void 0===s?"offset":`${s}.offset`,i=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(i,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:n=!1,format:i="text"}={}){var o;const a=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=null!==(o=this.headers.get("Accept"))&&void 0!==o?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${l}"; options=${a};`),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}}return _r.default=r,_r}function zr(){if(Rr)return wr;Rr=1;var e=wr&&wr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(wr,"__esModule",{value:!0});const t=e(Mr());class r extends t.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let n="";"plain"===s?n="pl":"phrase"===s?n="ph":"websearch"===s&&(n="w");const i=void 0===r?"":`(${r})`;return this.url.searchParams.append(e,`${n}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}}return wr.default=r,wr}function Hr(){if($r)return vr;$r=1;var e=vr&&vr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(vr,"__esModule",{value:!0});const t=e(zr());return vr.default=class{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=new Headers(t),this.schema=r,this.fetch=s}select(e,{head:r=!1,count:s}={}){const n=r?"HEAD":"GET";let i=!1;const o=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!i?"":('"'===e&&(i=!i),e)).join("");return this.url.searchParams.set("select",o),s&&this.headers.append("Prefer",`count=${s}`),new t.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:r,defaultToNull:s=!0}={}){var n;if(r&&this.headers.append("Prefer",`count=${r}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new t.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(n=this.fetch)&&void 0!==n?n:fetch})}upsert(e,{onConflict:r,ignoreDuplicates:s=!1,count:n,defaultToNull:i=!0}={}){var o;if(this.headers.append("Prefer",`resolution=${s?"ignore":"merge"}-duplicates`),void 0!==r&&this.url.searchParams.set("on_conflict",r),n&&this.headers.append("Prefer",`count=${n}`),i||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new t.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(o=this.fetch)&&void 0!==o?o:fetch})}update(e,{count:r}={}){var s;return r&&this.headers.append("Prefer",`count=${r}`),new t.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(s=this.fetch)&&void 0!==s?s:fetch})}delete({count:e}={}){var r;return e&&this.headers.append("Prefer",`count=${e}`),new t.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!==(r=this.fetch)&&void 0!==r?r:fetch})}},vr}const qr=p(function(){if(Dr)return yr;Dr=1;var e=yr&&yr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(yr,"__esModule",{value:!0}),yr.PostgrestError=yr.PostgrestBuilder=yr.PostgrestTransformBuilder=yr.PostgrestFilterBuilder=yr.PostgrestQueryBuilder=yr.PostgrestClient=void 0;const t=e(function(){if(Lr)return br;Lr=1;var e=br&&br.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(br,"__esModule",{value:!0});const t=e(Hr()),r=e(zr());class s{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=new Headers(t),this.schemaName=r,this.fetch=s}from(e){const r=new URL(`${this.url}/${e}`);return new t.default(r,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new s(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:n=!1,count:i}={}){var o;let a;const l=new URL(`${this.url}/rpc/${e}`);let c;s||n?(a=s?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{l.searchParams.append(e,t)})):(a="POST",c=t);const u=new Headers(this.headers);return i&&u.set("Prefer",`count=${i}`),new r.default({method:a,url:l,headers:u,schema:this.schemaName,body:c,fetch:null!==(o=this.fetch)&&void 0!==o?o:fetch})}}return br.default=s,br}());yr.PostgrestClient=t.default;const r=e(Hr());yr.PostgrestQueryBuilder=r.default;const s=e(zr());yr.PostgrestFilterBuilder=s.default;const n=e(Mr());yr.PostgrestTransformBuilder=n.default;const i=e(Fr());yr.PostgrestBuilder=i.default;const o=e(Br());return yr.PostgrestError=o.default,yr.default={PostgrestClient:t.default,PostgrestQueryBuilder:r.default,PostgrestFilterBuilder:s.default,PostgrestTransformBuilder:n.default,PostgrestBuilder:i.default,PostgrestError:o.default},yr}()),{PostgrestClient:Vr,PostgrestQueryBuilder:Wr,PostgrestFilterBuilder:Jr,PostgrestTransformBuilder:Gr,PostgrestBuilder:Kr,PostgrestError:Yr}=qr;class Qr{static detectEnvironment(){var e;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!=typeof global&&void 0!==global.WebSocket)return{type:"native",constructor:global.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if("undefined"!=typeof process){const e=process.versions;if(e&&e.node){const t=e.node,r=parseInt(t.replace(/^v/,"").split(".")[0]);return r>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`\n\nSuggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}}const Xr=1e4;var Zr,es,ts,rs,ss,ns,is,os,as,ls,cs;(es=Zr||(Zr={}))[es.connecting=0]="connecting",es[es.open=1]="open",es[es.closing=2]="closing",es[es.closed=3]="closed",(rs=ts||(ts={})).closed="closed",rs.errored="errored",rs.joined="joined",rs.joining="joining",rs.leaving="leaving",(ns=ss||(ss={})).close="phx_close",ns.error="phx_error",ns.join="phx_join",ns.reply="phx_reply",ns.leave="phx_leave",ns.access_token="access_token",(is||(is={})).websocket="websocket",(as=os||(os={})).Connecting="connecting",as.Open="open",as.Closing="closing",as.Closed="closed";class us{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),n=t.getUint8(2);let i=this.HEADER_LENGTH+2;const o=r.decode(e.slice(i,i+s));i+=s;const a=r.decode(e.slice(i,i+n));i+=n;return{ref:null,topic:o,event:a,payload:JSON.parse(r.decode(e.slice(i,e.byteLength)))}}}class ds{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(cs=ls||(ls={})).abstime="abstime",cs.bool="bool",cs.date="date",cs.daterange="daterange",cs.float4="float4",cs.float8="float8",cs.int2="int2",cs.int4="int4",cs.int4range="int4range",cs.int8="int8",cs.int8range="int8range",cs.json="json",cs.jsonb="jsonb",cs.money="money",cs.numeric="numeric",cs.oid="oid",cs.reltime="reltime",cs.text="text",cs.time="time",cs.timestamp="timestamp",cs.timestamptz="timestamptz",cs.timetz="timetz",cs.tsrange="tsrange",cs.tstzrange="tstzrange";const hs=(e,t,r={})=>{var s;const n=null!==(s=r.skipTypes)&&void 0!==s?s:[];return t?Object.keys(t).reduce((r,s)=>(r[s]=fs(s,e,t,n),r),{}):{}},fs=(e,t,r,s)=>{const n=t.find(t=>t.name===e),i=null==n?void 0:n.type,o=r[e];return i&&!s.includes(i)?ps(i,o):ms(o)},ps=(e,t)=>{if("_"===e.charAt(0)){const r=e.slice(1,e.length);return vs(t,r)}switch(e){case ls.bool:return gs(t);case ls.float4:case ls.float8:case ls.int2:case ls.int4:case ls.int8:case ls.numeric:case ls.oid:return ys(t);case ls.json:case ls.jsonb:return bs(t);case ls.timestamp:return ws(t);case ls.abstime:case ls.date:case ls.daterange:case ls.int4range:case ls.int8range:case ls.money:case ls.reltime:case ls.text:case ls.time:case ls.timestamptz:case ls.timetz:case ls.tsrange:case ls.tstzrange:default:return ms(t)}},ms=e=>e,gs=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},ys=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},bs=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},vs=(e,t)=>{if("string"!=typeof e)return e;const r=e.length-1,s=e[r];if("{"===e[0]&&"}"===s){let s;const i=e.slice(1,r);try{s=JSON.parse("["+i+"]")}catch(n){s=i?i.split(","):[]}return s.map(e=>ps(t,e))}return e},ws=e=>"string"==typeof e?e.replace(" ","T"):e,_s=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"};class xs{constructor(e,t,r={},s=1e4){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t(null===(r=this.receivedResp)||void 0===r?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var js,Ts,ks,Ss,Es,Os,Ns,Ps;(Ts=js||(js={})).SYNC="sync",Ts.JOIN="join",Ts.LEAVE="leave";class Cs{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},e=>{const{onJoin:t,onLeave:r,onSync:s}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Cs.syncState(this.state,e,t,r),this.pendingDiffs.forEach(e=>{this.state=Cs.syncDiff(this.state,e,t,r)}),this.pendingDiffs=[],s()}),this.channel._on(r.diff,{},e=>{const{onJoin:t,onLeave:r,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=Cs.syncDiff(this.state,e,t,r),s())}),this.onJoin((e,t,r)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:r})}),this.onLeave((e,t,r)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:r})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const n=this.cloneDeep(e),i=this.transformState(t),o={},a={};return this.map(n,(e,t)=>{i[e]||(a[e]=t)}),this.map(i,(e,t)=>{const r=n[e];if(r){const s=t.map(e=>e.presence_ref),n=r.map(e=>e.presence_ref),i=t.filter(e=>n.indexOf(e.presence_ref)<0),l=r.filter(e=>s.indexOf(e.presence_ref)<0);i.length>0&&(o[e]=i),l.length>0&&(a[e]=l)}else o[e]=t}),this.syncDiff(n,{joins:o,leaves:a},r,s)}static syncDiff(e,t,r,s){const{joins:n,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(n,(t,s)=>{var n;const i=null!==(n=e[t])&&void 0!==n?n:[];if(e[t]=this.cloneDeep(s),i.length>0){const r=e[t].map(e=>e.presence_ref),s=i.filter(e=>r.indexOf(e.presence_ref)<0);e[t].unshift(...s)}r(t,i,s)}),this.map(i,(t,r)=>{let n=e[t];if(!n)return;const i=r.map(e=>e.presence_ref);n=n.filter(e=>i.indexOf(e.presence_ref)<0),e[t]=n,s(t,n,r),0===n.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return t[r]="metas"in s?s.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(Ss=ks||(ks={})).ALL="*",Ss.INSERT="INSERT",Ss.UPDATE="UPDATE",Ss.DELETE="DELETE",(Os=Es||(Es={})).BROADCAST="broadcast",Os.PRESENCE="presence",Os.POSTGRES_CHANGES="postgres_changes",Os.SYSTEM="system",(Ps=Ns||(Ns={})).SUBSCRIBED="SUBSCRIBED",Ps.TIMED_OUT="TIMED_OUT",Ps.CLOSED="CLOSED",Ps.CHANNEL_ERROR="CHANNEL_ERROR";class As{constructor(e,t={config:{}},r){var s,n;if(this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=ts.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new xs(this,ss.join,this.params,this.timeout),this.rejoinTimer=new ds(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=ts.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=ts.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=ts.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=ts.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=ts.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ss.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new Cs(this),this.broadcastEndpointURL=_s(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null===(n=null===(s=this.params.config)||void 0===s?void 0:s.broadcast)||void 0===n?void 0:n.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var r,s,n;if(this.socket.isConnected()||this.socket.connect(),this.state==ts.closed){const{config:{broadcast:i,presence:o,private:a}}=this.params,l=null!==(s=null===(r=this.bindings.postgres_changes)||void 0===r?void 0:r.map(e=>e.filter))&&void 0!==s?s:[],c=!!this.bindings[Es.PRESENCE]&&this.bindings[Es.PRESENCE].length>0||!0===(null===(n=this.params.config.presence)||void 0===n?void 0:n.enabled),u={},d={broadcast:i,presence:Object.assign(Object.assign({},o),{enabled:c}),postgres_changes:l,private:a};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this._onError(t=>null==e?void 0:e(Ns.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(Ns.CLOSED)),this.updateJoinPayload(Object.assign({config:d},u)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:t})=>{var r;if(this.socket.setAuth(),void 0!==t){const s=this.bindings.postgres_changes,n=null!==(r=null==s?void 0:s.length)&&void 0!==r?r:0,i=[];for(let r=0;r<n;r++){const n=s[r],{filter:{event:o,schema:a,table:l,filter:c}}=n,u=t&&t[r];if(!u||u.event!==o||u.schema!==a||u.table!==l||u.filter!==c)return this.unsubscribe(),this.state=ts.errored,void(null==e||e(Ns.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));i.push(Object.assign(Object.assign({},n),{id:u.id}))}return this.bindings.postgres_changes=i,void(e&&e(Ns.SUBSCRIBED))}null==e||e(Ns.SUBSCRIBED)}).receive("error",t=>{this.state=ts.errored,null==e||e(Ns.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(Ns.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===ts.joined&&e===Es.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}async send(e,t={}){var r,s;if(this._canPush()||"broadcast"!==e.type)return new Promise(r=>{var s,n,i;const o=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(i=null===(n=null===(s=this.params)||void 0===s?void 0:s.config)||void 0===n?void 0:n.broadcast)||void 0===i?void 0:i.ack)||r("ok"),o.receive("ok",()=>r("ok")),o.receive("error",()=>r("error")),o.receive("timeout",()=>r("timed out"))});{const{event:i,payload:o}=e,a={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,a,null!==(r=t.timeout)&&void 0!==r?r:this.timeout);return await(null===(s=e.body)||void 0===s?void 0:s.cancel()),e.ok?"ok":"error"}catch(n){return"AbortError"===n.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=ts.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ss.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new xs(this,ss.leave,{},e),r.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{null==r||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=ts.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const s=new AbortController,n=setTimeout(()=>s.abort(),r),i=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(n),i}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new xs(this,e,t,r);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,n;const i=e.toLocaleLowerCase(),{close:o,error:a,leave:l,join:c}=ss;if(r&&[o,a,l,c].indexOf(i)>=0&&r!==this._joinRef())return;let u=this._onMessage(i,t,r);if(t&&!u)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?null===(s=this.bindings.postgres_changes)||void 0===s||s.filter(e=>{var t,r,s;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(s=null===(r=e.filter)||void 0===r?void 0:r.event)||void 0===s?void 0:s.toLocaleLowerCase())===i}).map(e=>e.callback(u,r)):null===(n=this.bindings[i])||void 0===n||n.filter(e=>{var r,s,n,o,a,l;if(["broadcast","presence","postgres_changes"].includes(i)){if("id"in e){const i=e.id,o=null===(r=e.filter)||void 0===r?void 0:r.event;return i&&(null===(s=t.ids)||void 0===s?void 0:s.includes(i))&&("*"===o||(null==o?void 0:o.toLocaleLowerCase())===(null===(n=t.data)||void 0===n?void 0:n.type.toLocaleLowerCase()))}{const r=null===(a=null===(o=null==e?void 0:e.filter)||void 0===o?void 0:o.event)||void 0===a?void 0:a.toLocaleLowerCase();return"*"===r||r===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===i}).map(e=>{if("object"==typeof u&&"ids"in u){const e=u.data,{schema:t,table:r,commit_timestamp:s,type:n,errors:i}=e,o={schema:t,table:r,commit_timestamp:s,eventType:n,new:{},old:{},errors:i};u=Object.assign(Object.assign({},o),this._getPayloadRecords(e))}e.callback(u,r)})}_isClosed(){return this.state===ts.closed}_isJoined(){return this.state===ts.joined}_isJoining(){return this.state===ts.joining}_isLeaving(){return this.state===ts.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),n={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(n):this.bindings[s]=[n],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(e=>{var s;return!((null===(s=e.type)||void 0===s?void 0:s.toLocaleLowerCase())===r&&As.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ss.close,{},e)}_onError(e){this._on(ss.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=ts.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=hs(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=hs(e.columns,e.old_record)),t}}const Is=()=>{},Rs=25e3,$s=10,Ls=100,Ds=[1e3,2e3,5e3,1e4];class Us{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Xr,this.transport=null,this.heartbeatIntervalMs=Rs,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Is,this.ref=0,this.reconnectTimer=null,this.logger=Is,this.conn=null,this.sendBuffer=[],this.serializer=new us,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>ke(async()=>{const{default:e}=await Promise.resolve().then(()=>Nr);return{default:e}},void 0).then(({default:t})=>t(...e)).catch(e=>{throw new Error(`Failed to load @supabase/node-fetch: ${e.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):fetch),(...e)=>t(...e)},!(null===(r=null==t?void 0:t.params)||void 0===r?void 0:r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${is.websocket}`,this.httpEndpoint=_s(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Qr.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;if(t.includes("Node.js"))throw new Error(`${t}\n\nTo use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })`);throw new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Zr.connecting:return os.Connecting;case Zr.open:return os.Open;case Zr.closing:return os.Closing;default:return os.Closed}}isConnected(){return this.connectionState()===os.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e,t={config:{}}){const r=`realtime:${e}`,s=this.getChannels().find(e=>e.topic===r);if(s)return s;{const r=new As(`realtime:${e}`,t,this);return this.channels.push(r),r}}push(e){const{topic:t,event:r,payload:s,ref:n}=e,i=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push",`${t} ${r} (${n})`,s),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}return this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},Ls)}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}else try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{if("phoenix"===e.topic&&"phx_reply"===e.event)try{this.heartbeatCallback("ok"===e.payload.status?"ok":"error")}catch(a){this.log("error","error in heartbeat callback",a)}e.ref&&e.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:t,event:r,payload:s,ref:n}=e,i=n?`(${n})`:"",o=s.status||"";this.log("receive",`${o} ${t} ${r} ${i}`.trim(),s),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(r,s,n)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(ss.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const r=e.match(/\?/)?"&":"?";return`${e}${r}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e,t=!1){this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;t=e||(this.accessToken?await this.accessToken():this.accessTokenValue),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{const r={access_token:t,version:"realtime-js/2.75.0"};t&&e.updateJoinPayload(r),e.joinedOnce&&e._isJoined()&&e._push(ss.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new ds(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},$s)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,s,n,i,o,a,l,c;if(this.transport=null!==(t=null==e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(r=null==e?void 0:e.timeout)&&void 0!==r?r:Xr,this.heartbeatIntervalMs=null!==(s=null==e?void 0:e.heartbeatIntervalMs)&&void 0!==s?s:Rs,this.worker=null!==(n=null==e?void 0:e.worker)&&void 0!==n&&n,this.accessToken=null!==(i=null==e?void 0:e.accessToken)&&void 0!==i?i:null,this.heartbeatCallback=null!==(o=null==e?void 0:e.heartbeatCallback)&&void 0!==o?o:Is,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(a=null==e?void 0:e.reconnectAfterMs)&&void 0!==a?a:e=>Ds[e-1]||1e4,this.encode=null!==(l=null==e?void 0:e.encode)&&void 0!==l?l:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(c=null==e?void 0:e.decode)&&void 0!==c?c:this.serializer.decode.bind(this.serializer),this.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null==e?void 0:e.workerUrl}}}class Bs extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Fs(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class Ms extends Bs{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class zs extends Bs{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Hs=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};const qs=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>ke(async()=>{const{default:e}=await Promise.resolve().then(()=>Nr);return{default:e}},void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},Vs=e=>{if(Array.isArray(e))return e.map(e=>Vs(e));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([e,r])=>{const s=e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[s]=Vs(r)}),t};var Ws=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};const Js=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Gs=(e,t,r)=>Ws(void 0,void 0,void 0,function*(){const s=yield Hs(void 0,void 0,void 0,function*(){return"undefined"==typeof Response?(yield ke(()=>Promise.resolve().then(()=>Nr),void 0)).Response:Response});e instanceof s&&!(null==r?void 0:r.noResolveJson)?e.json().then(r=>{const s=e.status||500,n=(null==r?void 0:r.statusCode)||s+"";t(new Ms(Js(r),s,n))}).catch(e=>{t(new zs(Js(e),e))}):t(new zs(Js(e),e))}),Ks=(e,t,r,s)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&s?((e=>{if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)})(s)?(n.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),n.body=JSON.stringify(s)):n.body=s,(null==t?void 0:t.duplex)&&(n.duplex=t.duplex),Object.assign(Object.assign({},n),r)):n};function Ys(e,t,r,s,n,i){return Ws(this,void 0,void 0,function*(){return new Promise((o,a)=>{e(r,Ks(t,s,n,i)).then(e=>{if(!e.ok)throw e;return(null==s?void 0:s.noResolveJson)?e:e.json()}).then(e=>o(e)).catch(e=>Gs(e,a,s))})})}function Qs(e,t,r,s){return Ws(this,void 0,void 0,function*(){return Ys(e,"GET",t,r,s)})}function Xs(e,t,r,s,n){return Ws(this,void 0,void 0,function*(){return Ys(e,"POST",t,s,n,r)})}function Zs(e,t,r,s,n){return Ws(this,void 0,void 0,function*(){return Ys(e,"PUT",t,s,n,r)})}function en(e,t,r,s,n){return Ws(this,void 0,void 0,function*(){return Ys(e,"DELETE",t,s,n,r)})}var tn=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};class rn{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return tn(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Fs(e))return{data:null,error:e};throw e}})}}var sn=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};class nn{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}asStream(){return new rn(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.execute().then(e,t)}execute(){return sn(this,void 0,void 0,function*(){try{const e=yield this.downloadFn();return{data:yield e.blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Fs(e))return{data:null,error:e};throw e}})}}var on=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};const an={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},ln={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class cn{constructor(e,t={},r,s){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=r,this.fetch=qs(s)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,r,s){return on(this,void 0,void 0,function*(){try{let n;const i=Object.assign(Object.assign({},ln),s);let o=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(i.upsert)});const a=i.metadata;"undefined"!=typeof Blob&&r instanceof Blob?(n=new FormData,n.append("cacheControl",i.cacheControl),a&&n.append("metadata",this.encodeMetadata(a)),n.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(n=r,n.append("cacheControl",i.cacheControl),a&&n.append("metadata",this.encodeMetadata(a))):(n=r,o["cache-control"]=`max-age=${i.cacheControl}`,o["content-type"]=i.contentType,a&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),(null==s?void 0:s.headers)&&(o=Object.assign(Object.assign({},o),s.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),u=yield("PUT"==e?Zs:Xs)(this.fetch,`${this.url}/object/${c}`,n,Object.assign({headers:o},(null==i?void 0:i.duplex)?{duplex:i.duplex}:{}));return{data:{path:l,id:u.Id,fullPath:u.Key},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Fs(n))return{data:null,error:n};throw n}})}upload(e,t,r){return on(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return on(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),i=this._getFinalPath(n),o=new URL(this.url+`/object/upload/sign/${i}`);o.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:ln.upsert},s),i=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&r instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(e=r,e.append("cacheControl",t.cacheControl)):(e=r,i["cache-control"]=`max-age=${t.cacheControl}`,i["content-type"]=t.contentType);return{data:{path:n,fullPath:(yield Zs(this.fetch,o.toString(),e,{headers:i})).Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Fs(a))return{data:null,error:a};throw a}})}createSignedUploadUrl(e,t){return on(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(s["x-upsert"]="true");const n=yield Xs(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),i=new URL(this.url+n.url),o=i.searchParams.get("token");if(!o)throw new Bs("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:o},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Fs(r))return{data:null,error:r};throw r}})}update(e,t,r){return on(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return on(this,void 0,void 0,function*(){try{return{data:yield Xs(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Fs(s))return{data:null,error:s};throw s}})}copy(e,t,r){return on(this,void 0,void 0,function*(){try{return{data:{path:(yield Xs(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Fs(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,r){return on(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),n=yield Xs(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},(null==r?void 0:r.transform)?{transform:r.transform}:{}),{headers:this.headers});const i=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${i}`)},{data:n,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Fs(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return on(this,void 0,void 0,function*(){try{const s=yield Xs(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return{data:s.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${n}`):null})),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Fs(s))return{data:null,error:s};throw s}})}download(e,t){const r=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",s=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),n=s?`?${s}`:"",i=this._getFinalPath(e);return new nn(()=>Qs(this.fetch,`${this.url}/${r}/${i}${n}`,{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}info(e){return on(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const e=yield Qs(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Vs(e),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Fs(r))return{data:null,error:r};throw r}})}exists(e){return on(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield function(e,t,r,s){return Ws(this,void 0,void 0,function*(){return Ys(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),s)})}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Fs(r)&&r instanceof zs){const e=r.originalError;if([400,404].includes(null==e?void 0:e.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],n=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==n&&s.push(n);const i=void 0!==(null==t?void 0:t.transform)?"render/image":"object",o=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==o&&s.push(o);let a=s.join("&");return""!==a&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${r}${a}`)}}}remove(e){return on(this,void 0,void 0,function*(){try{return{data:yield en(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Fs(t))return{data:null,error:t};throw t}})}list(e,t,r){return on(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},an),t),{prefix:e||""});return{data:yield Xs(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Fs(s))return{data:null,error:s};throw s}})}listV2(e,t){return on(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield Xs(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Fs(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const un={"X-Client-Info":"storage-js/2.75.0"};var dn=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};class hn{constructor(e,t={},r,s){this.shouldThrowOnError=!1;const n=new URL(e);if(null==s?void 0:s.useNewHostname){/supabase\.(co|in|red)$/.test(n.hostname)&&!n.hostname.includes("storage.supabase.")&&(n.hostname=n.hostname.replace("supabase.","storage.supabase."))}this.url=n.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},un),t),this.fetch=qs(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return dn(this,void 0,void 0,function*(){try{return{data:yield Qs(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Fs(e))return{data:null,error:e};throw e}})}getBucket(e){return dn(this,void 0,void 0,function*(){try{return{data:yield Qs(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Fs(t))return{data:null,error:t};throw t}})}createBucket(e){return dn(this,arguments,void 0,function*(e,t={public:!1}){try{return{data:yield Xs(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Fs(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return dn(this,void 0,void 0,function*(){try{return{data:yield Zs(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Fs(r))return{data:null,error:r};throw r}})}emptyBucket(e){return dn(this,void 0,void 0,function*(){try{return{data:yield Xs(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Fs(t))return{data:null,error:t};throw t}})}deleteBucket(e){return dn(this,void 0,void 0,function*(){try{return{data:yield en(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Fs(t))return{data:null,error:t};throw t}})}}class fn extends hn{constructor(e,t={},r,s){super(e,t,r,s)}from(e){return new cn(this.url,this.headers,e,this.fetch)}}const pn={"X-Client-Info":"supabase-js/2.30.0"};var mn,gn={exports:{}};var yn=(mn||(mn=1,function(e,t){var r,s="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==v&&v,n=function(){function e(){this.fetch=!1,this.DOMException=s.DOMException}return e.prototype=s,new e}();r=n,function(e){var t=void 0!==r&&r||"undefined"!=typeof self&&self||void 0!==v&&v||{},s="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,i="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(e){return!1}}(),o="FormData"in t,a="ArrayBuffer"in t;if(a)var l=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],c=ArrayBuffer.isView||function(e){return e&&l.indexOf(Object.prototype.toString.call(e))>-1};function u(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function d(e){return"string"!=typeof e&&(e=String(e)),e}function h(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function f(e){this.map={},e instanceof f?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){if(2!=e.length)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function p(e){if(!e._noBody)return e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function m(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function g(e){var t=new FileReader,r=m(t);return t.readAsArrayBuffer(e),r}function y(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:i&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:o&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:s&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():a&&i&&(t=e)&&DataView.prototype.isPrototypeOf(t)?(this._bodyArrayBuffer=y(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a&&(ArrayBuffer.prototype.isPrototypeOf(e)||c(e))?this._bodyArrayBuffer=y(e):this._bodyText=e=Object.prototype.toString.call(e):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):s&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},i&&(this.blob=function(){var e=p(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=p(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}if(i)return this.blob().then(g);throw new Error("could not read as ArrayBuffer")},this.text=function(){var e,t,r,s,n,i=p(this);if(i)return i;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=m(t),s=/charset=([A-Za-z0-9_-]+)/.exec(e.type),n=s?s[1]:"utf-8",t.readAsText(e,n),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),s=0;s<t.length;s++)r[s]=String.fromCharCode(t[s]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o&&(this.formData=function(){return this.text().then(x)}),this.json=function(){return this.text().then(JSON.parse)},this}f.prototype.append=function(e,t){e=u(e),t=d(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},f.prototype.delete=function(e){delete this.map[u(e)]},f.prototype.get=function(e){return e=u(e),this.has(e)?this.map[e]:null},f.prototype.has=function(e){return this.map.hasOwnProperty(u(e))},f.prototype.set=function(e,t){this.map[u(e)]=d(t)},f.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},f.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),h(e)},f.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),h(e)},f.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),h(e)},n&&(f.prototype[Symbol.iterator]=f.prototype.entries);var w=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function _(e,r){if(!(this instanceof _))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var s,n,i=(r=r||{}).body;if(e instanceof _){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,r.headers||(this.headers=new f(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=r.credentials||this.credentials||"same-origin",!r.headers&&this.headers||(this.headers=new f(r.headers)),this.method=(s=r.method||this.method||"GET",n=s.toUpperCase(),w.indexOf(n)>-1?n:s),this.mode=r.mode||this.mode||null,this.signal=r.signal||this.signal||function(){if("AbortController"in t)return(new AbortController).signal}(),this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(i),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==r.cache&&"no-cache"!==r.cache)){var o=/([?&])_=[^&]*/;o.test(this.url)?this.url=this.url.replace(o,"$1_="+(new Date).getTime()):this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}function x(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),s=r.shift().replace(/\+/g," "),n=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(s),decodeURIComponent(n))}}),t}function j(e,t){if(!(this instanceof j))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new f(t.headers),this.url=t.url||"",this._initBody(e)}_.prototype.clone=function(){return new _(this,{body:this._bodyInit})},b.call(_.prototype),b.call(j.prototype),j.prototype.clone=function(){return new j(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new f(this.headers),url:this.url})},j.error=function(){var e=new j(null,{status:200,statusText:""});return e.ok=!1,e.status=0,e.type="error",e};var T=[301,302,303,307,308];j.redirect=function(e,t){if(-1===T.indexOf(t))throw new RangeError("Invalid status code");return new j(null,{status:t,headers:{location:e}})},e.DOMException=t.DOMException;try{new e.DOMException}catch(S){e.DOMException=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},e.DOMException.prototype=Object.create(Error.prototype),e.DOMException.prototype.constructor=e.DOMException}function k(r,s){return new Promise(function(n,o){var l=new _(r,s);if(l.signal&&l.signal.aborted)return o(new e.DOMException("Aborted","AbortError"));var c=new XMLHttpRequest;function h(){c.abort()}if(c.onload=function(){var e,t,r={statusText:c.statusText,headers:(e=c.getAllResponseHeaders()||"",t=new f,e.replace(/\r?\n[\t ]+/g," ").split("\r").map(function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e}).forEach(function(e){var r=e.split(":"),s=r.shift().trim();if(s){var n=r.join(":").trim();try{t.append(s,n)}catch(i){console.warn("Response "+i.message)}}}),t)};0===l.url.indexOf("file://")&&(c.status<200||c.status>599)?r.status=200:r.status=c.status,r.url="responseURL"in c?c.responseURL:r.headers.get("X-Request-URL");var s="response"in c?c.response:c.responseText;setTimeout(function(){n(new j(s,r))},0)},c.onerror=function(){setTimeout(function(){o(new TypeError("Network request failed"))},0)},c.ontimeout=function(){setTimeout(function(){o(new TypeError("Network request timed out"))},0)},c.onabort=function(){setTimeout(function(){o(new e.DOMException("Aborted","AbortError"))},0)},c.open(l.method,function(e){try{return""===e&&t.location.href?t.location.href:e}catch(r){return e}}(l.url),!0),"include"===l.credentials?c.withCredentials=!0:"omit"===l.credentials&&(c.withCredentials=!1),"responseType"in c&&(i?c.responseType="blob":a&&(c.responseType="arraybuffer")),s&&"object"==typeof s.headers&&!(s.headers instanceof f||t.Headers&&s.headers instanceof t.Headers)){var p=[];Object.getOwnPropertyNames(s.headers).forEach(function(e){p.push(u(e)),c.setRequestHeader(e,d(s.headers[e]))}),l.headers.forEach(function(e,t){-1===p.indexOf(t)&&c.setRequestHeader(t,e)})}else l.headers.forEach(function(e,t){c.setRequestHeader(t,e)});l.signal&&(l.signal.addEventListener("abort",h),c.onreadystatechange=function(){4===c.readyState&&l.signal.removeEventListener("abort",h)}),c.send(void 0===l._bodyInit?null:l._bodyInit)})}k.polyfill=!0,t.fetch||(t.fetch=k,t.Headers=f,t.Request=_,t.Response=j),e.Headers=f,e.Request=_,e.Response=j,e.fetch=k,Object.defineProperty(e,"__esModule",{value:!0})}({}),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var i=s.fetch?s:n;(t=i.fetch).default=i.fetch,t.fetch=i.fetch,t.Headers=i.Headers,t.Request=i.Request,t.Response=i.Response,e.exports=t}(gn,gn.exports)),gn.exports);const bn=p(yn),vn=we({__proto__:null,default:bn},[yn]);var wn=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};const _n=(e,t,r)=>{const s=(e=>{let t;return t=e||("undefined"==typeof fetch?bn:fetch),(...e)=>t(...e)})(r),n="undefined"==typeof Headers?yn.Headers:Headers;return(r,i)=>wn(void 0,void 0,void 0,function*(){var o;const a=null!==(o=yield t())&&void 0!==o?o:e;let l=new n(null==i?void 0:i.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${a}`),s(r,Object.assign(Object.assign({},i),{headers:l}))})};const xn=()=>"undefined"!=typeof document,jn={tested:!1,writable:!1},Tn=()=>{if(!xn())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(t){return!1}if(jn.tested)return jn.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),jn.tested=!0,jn.writable=!0}catch(t){jn.tested=!0,jn.writable=!1}return jn.writable};function kn(e,t){var r;t||(t=(null===(r=null===window||void 0===window?void 0:window.location)||void 0===r?void 0:r.href)||""),e=e.replace(/[\[\]]/g,"\\$&");const s=new RegExp("[?&#]"+e+"(=([^&#]*)|&|#|$)").exec(t);return s?s[2]?decodeURIComponent(s[2].replace(/\+/g," ")):"":null}const Sn=e=>{let t;return t=e||("undefined"==typeof fetch?async(...e)=>await(await ke(async()=>{const{fetch:e}=await Promise.resolve().then(()=>vn);return{fetch:e}},void 0)).fetch(...e):fetch),(...e)=>t(...e)},En=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},On=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch(s){return r}},Nn=async(e,t)=>{await e.removeItem(t)};class Pn{constructor(){this.promise=new Pn.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function Cn(e){const t=e.split(".");if(3!==t.length)throw new Error("JWT is not valid: not a JWT structure");if(!/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(function(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let r,s,n,i,o,a,l,c="",u=0;for(e=e.replace("-","+").replace("_","/");u<e.length;)i=t.indexOf(e.charAt(u++)),o=t.indexOf(e.charAt(u++)),a=t.indexOf(e.charAt(u++)),l=t.indexOf(e.charAt(u++)),r=i<<2|o>>4,s=(15&o)<<4|a>>2,n=(3&a)<<6|l,c+=String.fromCharCode(r),64!=a&&0!=s&&(c+=String.fromCharCode(s)),64!=l&&0!=n&&(c+=String.fromCharCode(n));return c}(r))}function An(e){return("0"+e.toString(16)).substr(-2)}function In(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let r="";for(let s=0;s<56;s++)r+=e.charAt(Math.floor(Math.random()*t));return r}return crypto.getRandomValues(e),Array.from(e,An).join("")}async function Rn(e){if("undefined"==typeof crypto)return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(e=>String.fromCharCode(e)).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}Pn.promiseConstructor=Promise;const $n=/__stack_guard__([a-zA-Z0-9_-]+)__/;let Ln,Dn=!1;function Un(e){var t,r;let s;Ln();try{throw new Error}catch(i){s=i}const n=null!==(r=null===(t=s.stack)||void 0===t?void 0:t.split("\n"))&&void 0!==r?r:[];for(let o=0;o<n.length;o+=1){const t=n[o].match($n);if(t&&t[1]===e)return!0}return!1}async function Bn(e,t){await Ln();const r=`__stack_guard__${e}__`,s={[r]:async()=>await t()};return await s[r]()}Ln=async()=>{Dn||(Dn=!0,await Bn("ENV_CHECK",async()=>{const e=Un("ENV_CHECK");return e||console.warn("@supabase/gotrue-js: Stack guards not supported in this environment. Generally not an issue but may point to a very conservative transpilation environment (use ES2017 or above) that implements async/await with generators, or this is a JavaScript engine that does not support async/await stack traces."),e}))};class Fn extends Error{constructor(e,t){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t}}function Mn(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class zn extends Fn{constructor(e,t){super(e,t),this.name="AuthApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Hn extends Fn{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class qn extends Fn{constructor(e,t,r){super(e),this.name=t,this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Vn extends qn{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}}class Wn extends qn{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500)}}class Jn extends qn{constructor(e){super(e,"AuthInvalidCredentialsError",400)}}class Gn extends qn{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Kn extends qn{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Yn extends qn{constructor(e,t){super(e,"AuthRetryableFetchError",t)}}function Qn(e){return Mn(e)&&"AuthRetryableFetchError"===e.name}const Xn=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Zn=[502,503,504];async function ei(e){if(!("object"==typeof(t=e)&&null!==t&&"status"in t&&"ok"in t&&"json"in t&&"function"==typeof t.json))throw new Yn(Xn(e),0);var t;if(Zn.includes(e.status))throw new Yn(Xn(e),e.status);let r;try{r=await e.json()}catch(s){throw new Hn(Xn(s),s)}throw new zn(Xn(r),e.status||500)}async function ti(e,t,r,s){var n;const i=Object.assign({},null==s?void 0:s.headers);(null==s?void 0:s.jwt)&&(i.Authorization=`Bearer ${s.jwt}`);const o=null!==(n=null==s?void 0:s.query)&&void 0!==n?n:{};(null==s?void 0:s.redirectTo)&&(o.redirect_to=s.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await async function(e,t,r,s,n,i){const o=((e,t,r,s)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),r))})(t,s,n,i);let a;try{a=await e(r,o)}catch(l){throw console.error(l),new Yn(Xn(l),0)}a.ok||await ei(a);if(null==s?void 0:s.noResolveJson)return a;try{return await a.json()}catch(l){await ei(l)}}(e,t,r+a,{headers:i,noResolveJson:null==s?void 0:s.noResolveJson},{},null==s?void 0:s.body);return(null==s?void 0:s.xform)?null==s?void 0:s.xform(l):{data:Object.assign({},l),error:null}}function ri(e){var t;let r=null;var s;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(r=Object.assign({},e),r.expires_at=(s=e.expires_in,Math.round(Date.now()/1e3)+s));return{data:{session:r,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function si(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function ni(e){return{data:e,error:null}}function ii(e){const{action_link:t,email_otp:r,hashed_token:s,redirect_to:n,verification_type:i}=e,o=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r}(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:r,hashed_token:s,redirect_to:n,verification_type:i},user:Object.assign({},o)},error:null}}function oi(e){return e}class ai{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Sn(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await ti(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Mn(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await ti(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:si})}catch(r){if(Mn(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r}(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=null==r?void 0:r.newEmail,delete s.newEmail),await ti(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:ii,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(Mn(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await ti(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:si})}catch(t){if(Mn(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,n,i,o,a;try{const l={nextPage:null,lastPage:0,total:0},c=await ti(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==r?r:"",per_page:null!==(n=null===(s=null==e?void 0:e.perPage)||void 0===s?void 0:s.toString())&&void 0!==n?n:""},xform:oi});if(c.error)throw c.error;const u=await c.json(),d=null!==(i=c.headers.get("x-total-count"))&&void 0!==i?i:0,h=null!==(a=null===(o=c.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);l[`${r}Page`]=t}),l.total=parseInt(d)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(l){if(Mn(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){try{return await ti(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:si})}catch(t){if(Mn(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await ti(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:si})}catch(r){if(Mn(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){try{return await ti(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:si})}catch(r){if(Mn(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{const{data:t,error:r}=await ti(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:r}}catch(t){if(Mn(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await ti(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Mn(t))return{data:null,error:t};throw t}}}const li={"X-Client-Info":"gotrue-js/2.43.1"},ci={getItem:e=>Tn()?globalThis.localStorage.getItem(e):null,setItem:(e,t)=>{Tn()&&globalThis.localStorage.setItem(e,t)},removeItem:e=>{Tn()&&globalThis.localStorage.removeItem(e)}};!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const ui={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:li,flowType:"implicit",debug:!1},di=3e4;class hi{constructor(e){var t;this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.broadcastChannel=null,this.instanceID=hi.nextInstanceID,hi.nextInstanceID+=1,this.instanceID>0&&xn()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},ui),e);if(this.logDebugMessages=r.debug,this.inMemorySession=null,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.persistSession=r.persistSession,this.storage=r.storage||ci,this.admin=new ai({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=Sn(r.fetch),this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession&&this.storage===ci&&!Tn()&&console.warn("No storage option exists to persist the session, which may result in unexpected behavior when using auth.\n        If you want to set persistSession to true, please provide a storage option or you may set persistSession to false to disable this warning."),xn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}null===(t=this.broadcastChannel)||void 0===t||t.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&console.log(`GoTrueClient@${this.instanceID} ${(new Date).toISOString()}`,...e),this}initialize(){return this.initializePromise?this.initializePromise:this._initialize()}async _initialize(){if(this.initializePromise)throw new Error("Double call of #_initialize()");return this.initializePromise=Bn("_initialize",async()=>{try{const e=!!xn()&&await this._isPKCEFlow();if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:r}=await this._getSessionFromUrl(e);if(r)return this._debug("#_initialize()","error detecting session from URL",r),await this._removeSession(),{error:r};const{session:s,redirectType:n}=t;return this._debug("#_initialize()","detected session in URL",s,"redirect type",n),await this._saveSession(s),setTimeout(async()=>{"recovery"===n?await this._notifyAllSubscribers("PASSWORD_RECOVERY",s):await this._notifyAllSubscribers("SIGNED_IN",s)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return Mn(e)?{error:e}:{error:new Hn("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}),await this.initializePromise}async signUp(e){var t,r,s;try{let n;if(await this._removeSession(),"email"in e){const{email:r,password:s,options:i}=e;let o=null,a=null;if("pkce"===this.flowType){const e=In();await En(this.storage,`${this.storageKey}-code-verifier`,e),o=await Rn(e),a=e===o?"plain":"s256"}n=await ti(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==i?void 0:i.emailRedirectTo,body:{email:r,password:s,data:null!==(t=null==i?void 0:i.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:o,code_challenge_method:a},xform:ri})}else{if(!("phone"in e))throw new Jn("You must provide either an email or phone number and a password");{const{phone:t,password:i,options:o}=e;n=await ti(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:i,data:null!==(r=null==o?void 0:o.data)&&void 0!==r?r:{},channel:null!==(s=null==o?void 0:o.channel)&&void 0!==s?s:"sms",gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken}},xform:ri})}}const{data:i,error:o}=n;if(o||!i)return{data:{user:null,session:null},error:o};const a=i.session,l=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(n){if(Mn(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(e){try{let t;if(await this._removeSession(),"email"in e){const{email:r,password:s,options:n}=e;t=await ti(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:ri})}else{if(!("phone"in e))throw new Jn("You must provide either an email or phone number and a password");{const{phone:r,password:s,options:n}=e;t=await ti(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:ri})}}const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:r&&r.session&&r.user?(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:{user:r.user,session:r.session},error:s}):{data:{user:null,session:null},error:new Wn}}catch(t){if(Mn(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,n;return await this._removeSession(),await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(s=e.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:null===(n=e.options)||void 0===n?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){const t=await On(this.storage,`${this.storageKey}-code-verifier`),{data:r,error:s}=await ti(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:t},xform:ri});return await Nn(this.storage,`${this.storageKey}-code-verifier`),s?{data:{user:null,session:null},error:s}:r&&r.session&&r.user?(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:r,error:s}):{data:{user:null,session:null},error:new Wn}}async signInWithIdToken(e){await this._removeSession();try{const{options:t,provider:r,token:s,access_token:n,nonce:i}=e,o=await ti(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:n,nonce:i,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:ri}),{data:a,error:l}=o;return l?{data:{user:null,session:null},error:l}:a&&a.session&&a.user?(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:l}):{data:{user:null,session:null},error:new Wn}}catch(t){if(Mn(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,n,i;try{if(await this._removeSession(),"email"in e){const{email:s,options:n}=e;let i=null,o=null;if("pkce"===this.flowType){const e=In();await En(this.storage,`${this.storageKey}-code-verifier`,e),i=await Rn(e),o=e===i?"plain":"s256"}const{error:a}=await ti(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:s,data:null!==(t=null==n?void 0:n.data)&&void 0!==t?t:{},create_user:null===(r=null==n?void 0:n.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:i,code_challenge_method:o},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in e){const{phone:t,options:r}=e,{data:o,error:a}=await ti(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(s=null==r?void 0:r.data)&&void 0!==s?s:{},create_user:null===(n=null==r?void 0:r.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},channel:null!==(i=null==r?void 0:r.channel)&&void 0!==i?i:"sms"}});return{data:{user:null,session:null,messageId:null==o?void 0:o.message_id},error:a}}throw new Jn("You must provide either an email or phone number.")}catch(o){if(Mn(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,r;try{"email_change"!==e.type&&"phone_change"!==e.type&&await this._removeSession();const{data:s,error:n}=await ti(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:null===(t=e.options)||void 0===t?void 0:t.captchaToken}}),redirectTo:null===(r=e.options)||void 0===r?void 0:r.redirectTo,xform:ri});if(n)throw n;if(!s)throw new Error("An error occurred on token verification.");const i=s.session,o=s.user;return(null==i?void 0:i.access_token)&&(await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)),{data:{user:o,session:i},error:null}}catch(s){if(Mn(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{return await this._removeSession(),await ti(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==r?r:void 0}),(null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0}),headers:this.headers,xform:ni})}catch(n){if(Mn(n))return{data:null,error:n};throw n}}async reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new Vn;const{error:s}=await ti(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(Mn(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{"email_change"!=e.type&&"phone_change"!=e.type&&await this._removeSession();const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:n}=e,{error:i}=await ti(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:i}}if("phone"in e){const{phone:r,type:s,options:n}=e,{data:i,error:o}=await ti(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:o}}throw new Jn("You must provide either an email or phone number and a type")}catch(t){if(Mn(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return this._useSession(async e=>e)}async _useSession(e){return await Bn("_useSession",async()=>{const t=await this.__loadSession();return await e(t)})}async __loadSession(){if(this._debug("#__loadSession()","begin"),this.logDebugMessages&&!Un("_useSession"))throw new Error("Please use #_useSession()");Un("_initialize")||await this.initializePromise;try{let e=null;if(this.persistSession){const t=await On(this.storage,this.storageKey);this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession()))}else e=this.inMemorySession,this._debug("#getSession()","session from memory",e);if(!e)return{data:{session:null},error:null};const t=!!e.expires_at&&e.expires_at<=Date.now()/1e3;if(this._debug("#__loadSession()",`session has${t?"":" not"} expired`,"expires_at",e.expires_at),!t)return{data:{session:e},error:null};const{session:r,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){try{return await this._useSession(async t=>{var r,s;if(!e){const{data:n,error:i}=t;if(i)throw i;e=null!==(s=null===(r=n.session)||void 0===r?void 0:r.access_token)&&void 0!==s?s:void 0}return await ti(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:si})})}catch(t){if(Mn(t))return{data:{user:null},error:t};throw t}}async updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:n}=r;if(n)throw n;if(!s.session)throw new Vn;const i=s.session,{data:o,error:a}=await ti(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:e,jwt:i.access_token,xform:si});if(a)throw a;return i.user=o.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}})}catch(r){if(Mn(r))return{data:{user:null},error:r};throw r}}_decodeJWT(e){return Cn(e)}async setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Vn;const t=Date.now()/1e3;let r=t,s=!0,n=null;const i=Cn(e.access_token);if(i.exp&&(r=i.exp,s=r<=t),s){const{session:t,error:r}=await this._callRefreshToken(e.refresh_token);if(r)return{data:{user:null,session:null},error:r};if(!t)return{data:{user:null,session:null},error:null};n=t}else{const{data:s,error:i}=await this.getUser(e.access_token);if(i)throw i;n={access_token:e.access_token,refresh_token:e.refresh_token,user:s.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if(Mn(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:s,error:n}=t;if(n)throw n;e=null!==(r=s.session)&&void 0!==r?r:void 0}if(!(null==e?void 0:e.refresh_token))throw new Vn;const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(Mn(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromUrl(e){try{if(!xn())throw new Gn("No browser detected.");if("implicit"===this.flowType&&!this._isImplicitGrantFlow())throw new Gn("Not a valid implicit grant flow url.");if("pkce"==this.flowType&&!e)throw new Kn("Not a valid PKCE flow url.");if(e){const e=kn("code");if(!e)throw new Kn("No code detected.");const{data:t,error:r}=await this.exchangeCodeForSession(e);if(r)throw r;if(!t.session)throw new Kn("No session detected.");let s=new URL(window.location.href);return s.searchParams.delete("code"),window.history.replaceState(window.history.state,"",s.toString()),{data:{session:t.session,redirectType:null},error:null}}const t=kn("error_description");if(t){const e=kn("error_code");if(!e)throw new Gn("No error_code detected.");const r=kn("error");if(!r)throw new Gn("No error detected.");throw new Gn(t,{error:r,code:e})}const r=kn("provider_token"),s=kn("provider_refresh_token"),n=kn("access_token");if(!n)throw new Gn("No access_token detected.");const i=kn("expires_in");if(!i)throw new Gn("No expires_in detected.");const o=kn("refresh_token");if(!o)throw new Gn("No refresh_token detected.");const a=kn("token_type");if(!a)throw new Gn("No token_type detected.");const l=Math.round(Date.now()/1e3)+parseInt(i),{data:c,error:u}=await this.getUser(n);if(u)throw u;const d=c.user,h={provider_token:r,provider_refresh_token:s,access_token:n,expires_in:parseInt(i),expires_at:l,refresh_token:o,token_type:a,user:d},f=kn("type");return window.location.hash="",this._debug("#_getSessionFromUrl()","clearing window.location.hash"),{data:{session:h,redirectType:f},error:null}}catch(t){if(Mn(t))return{data:{session:null,redirectType:null},error:t};throw t}}_isImplicitGrantFlow(){return xn()&&(Boolean(kn("access_token"))||Boolean(kn("error_description")))}async _isPKCEFlow(){const e=await On(this.storage,`${this.storageKey}-code-verifier`);return Boolean(kn("code"))&&Boolean(e)}async signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n)return{error:n};const i=null===(r=s.session)||void 0===r?void 0:r.access_token;if(i){const{error:t}=await this.admin.signOut(i,e);if(t&&(!function(e){return Mn(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status))return{error:t}}return"others"!==e&&(await this._removeSession(),await Nn(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),this._emitInitialSession(t),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:s},error:n}=t;if(n)throw n;await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(n){await(null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;if("pkce"===this.flowType){const e=In();await En(this.storage,`${this.storageKey}-code-verifier`,e),r=await Rn(e),s=e===r?"plain":"s256"}try{return await ti(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(Mn(n))return{data:null,error:n};throw n}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await(r=async r=>{var s;return await(s=200*r,new Promise(e=>{setTimeout(()=>e(null),s)})),this._debug(t,"refreshing attempt",r),await ti(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ri})},s=(e,t,r)=>r&&r.error&&Qn(r.error)&&Date.now()+200*(e+1)-n<di,new Promise((e,t)=>{(async()=>{for(let i=0;i<1/0;i++)try{const t=await r(i);if(!s(i,null,t))return void e(t)}catch(n){if(!s(i,n))return void t(n)}})()}))}catch(n){if(this._debug(t,"error",n),Mn(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}var r,s}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),xn()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await On(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r))return this._debug(t,"session is not valid"),void(null!==r&&await this._removeSession());const s=Math.round(Date.now()/1e3),n=(null!==(e=r.expires_at)&&void 0!==e?e:1/0)<s+10;if(this._debug(t,`session has${n?"":" not"} expired with margin of 10s`),n){if(this.autoRefreshToken&&r.refresh_token){const{error:e}=await this._callRefreshToken(r.refresh_token);e&&(console.error(e),Qn(e)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){return this._debug(t,"error",r),void console.error(r)}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new Vn;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Pn;const{data:t,error:r}=await this._refreshAccessToken(e);if(r)throw r;if(!t.session)throw new Vn;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const s={session:t.session,error:null};return this.refreshingDeferred.resolve(s),s}catch(n){if(this._debug(s,"error",n),Mn(n)){const e={session:null,error:n};return null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(r=this.refreshingDeferred)||void 0===r||r.reject(n),n}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const s=[],n=Array.from(this.stateChangeEmitters.values()).map(async r=>{try{await r.callback(e,t)}catch(n){s.push(n)}});if(await Promise.all(n),s.length>0){for(let e=0;e<s.length;e+=1)console.error(s[e]);throw s[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.persistSession||(this.inMemorySession=e),this.persistSession&&e.expires_at&&await this._persistSession(e)}_persistSession(e){return this._debug("#_persistSession()",e),En(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),this.persistSession?await Nn(this.storage,this.storageKey):this.inMemorySession=null}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&xn()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),di);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),await this._autoRefreshTokenTick()}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{const t=Date.now();try{return await this._useSession(async e=>{const{data:{session:r}}=e;if(!r||!r.refresh_token||!r.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const s=Math.floor((1e3*r.expires_at-t)/di);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),s<=3&&await this._callRefreshToken(r.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!xn()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){this._debug(`#_onVisibilityChanged(${e})`,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(e||(await this.initializePromise,await this._recoverAndRefresh(),this._debug("#_onVisibilityChanged()","finished waiting for initialize, _recoverAndRefresh")),this.autoRefreshToken&&this._startAutoRefresh()):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t){const r=[`provider=${encodeURIComponent(e)}`];if((null==t?void 0:t.redirectTo)&&r.push(`redirect_to=${encodeURIComponent(t.redirectTo)}`),(null==t?void 0:t.scopes)&&r.push(`scopes=${encodeURIComponent(t.scopes)}`),"pkce"===this.flowType){const e=In();await En(this.storage,`${this.storageKey}-code-verifier`,e);const t=await Rn(e),s=e===t?"plain":"s256";this._debug("PKCE","code verifier",`${e.substring(0,5)}...`,"code challenge",t,"method",s);const n=new URLSearchParams({code_challenge:`${encodeURIComponent(t)}`,code_challenge_method:`${encodeURIComponent(s)}`});r.push(n.toString())}if(null==t?void 0:t.queryParams){const e=new URLSearchParams(t.queryParams);r.push(e.toString())}return`${this.url}/authorize?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;return n?{data:null,error:n}:await ti(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token})})}catch(t){if(Mn(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:n,error:i}=t;if(i)return{data:null,error:i};const{data:o,error:a}=await ti(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:null===(r=null==n?void 0:n.session)||void 0===r?void 0:r.access_token});return a?{data:null,error:a}:((null===(s=null==o?void 0:o.totp)||void 0===s?void 0:s.qr_code)&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})})}catch(t){if(Mn(t))return{data:null,error:t};throw t}}async _verify(e){try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n)return{data:null,error:n};const{data:i,error:o}=await ti(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:o})})}catch(t){if(Mn(t))return{data:null,error:t};throw t}}async _challenge(e){try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;return n?{data:null,error:n}:await ti(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token})})}catch(t){if(Mn(t))return{data:null,error:t};throw t}}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(null==e?void 0:e.factors)||[],s=r.filter(e=>"totp"===e.factor_type&&"verified"===e.status);return{data:{all:r,totp:s},error:null}}async _getAuthenticatorAssuranceLevel(){return await this._useSession(async e=>{var t,r;const{data:{session:s},error:n}=e;if(n)return{data:null,error:n};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const i=this._decodeJWT(s.access_token);let o=null;i.aal&&(o=i.aal);let a=o;(null!==(r=null===(t=s.user.factors)||void 0===t?void 0:t.filter(e=>"verified"===e.status))&&void 0!==r?r:[]).length>0&&(a="aal2");return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:i.amr||[]},error:null}})}}hi.nextInstanceID=0;class fi extends hi{constructor(e){super(e)}}var pi=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};const mi={headers:pn},gi={schema:"public"},yi={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},bi={};class vi{constructor(e,t,r){var s,n,i,o,a,l,c,u;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const d=e.replace(/\/$/,"");this.realtimeUrl=`${d}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${d}/auth/v1`,this.storageUrl=`${d}/storage/v1`,this.functionsUrl=`${d}/functions/v1`;const h=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,f=function(e,t){const{db:r,auth:s,realtime:n,global:i}=e,{db:o,auth:a,realtime:l,global:c}=t;return{db:Object.assign(Object.assign({},o),r),auth:Object.assign(Object.assign({},a),s),realtime:Object.assign(Object.assign({},l),n),global:Object.assign(Object.assign({},c),i)}}(null!=r?r:{},{db:gi,realtime:bi,auth:Object.assign(Object.assign({},yi),{storageKey:h}),global:mi});this.storageKey=null!==(n=null===(s=f.auth)||void 0===s?void 0:s.storageKey)&&void 0!==n?n:"",this.headers=null!==(o=null===(i=f.global)||void 0===i?void 0:i.headers)&&void 0!==o?o:{},this.auth=this._initSupabaseAuthClient(null!==(a=f.auth)&&void 0!==a?a:{},this.headers,null===(l=f.global)||void 0===l?void 0:l.fetch),this.fetch=_n(t,this._getAccessToken.bind(this),null===(c=f.global)||void 0===c?void 0:c.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},f.realtime)),this.rest=new Vr(`${d}/rest/v1`,{headers:this.headers,schema:null===(u=f.db)||void 0===u?void 0:u.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new gr(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new fn(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}rpc(e,t={},r){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return pi(this,void 0,void 0,function*(){const{data:r}=yield this.auth.getSession();return null!==(t=null===(e=r.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:n,flowType:i,debug:o},a,l){const c={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new fi({url:this.authUrl,headers:Object.assign(Object.assign({},c),a),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:i,debug:o,fetch:l})}_initRealtimeClient(e){return new Us(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,r){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===r?"SIGNED_OUT"===e&&(this.realtime.setAuth(this.supabaseKey),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):(this.realtime.setAuth(null!=r?r:null),this.changedAccessToken=r)}}const wi=(_i="https://xdzoikocriuvgkoenjqk.supabase.co",xi="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhkem9pa29jcml1dmdrb2VuanFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAzMzg2NzUsImV4cCI6MjA3NTkxNDY3NX0.hh2GkNEdFHI9wlPfM6-oDraPz-s-zS1HlJpSTElQxHc",ji={auth:{storage:window.localStorage,storageKey:"greenofig-auth",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce"},realtime:{params:{eventsPerSecond:10}},global:{headers:{"X-Client-Info":"greenofig-web"}}},new vi(_i,xi,ji));var _i,xi,ji;const Ti=y.createContext(null),ki=({children:t})=>{const[r,s]=y.useState(null),[n,i]=y.useState(null),[o,a]=y.useState(!0),{toast:l}=ar(),c=y.useCallback(async e=>{if(!e)return i(null),null;try{let{data:t,error:r}=await wi.from("user_profiles").select("*").eq("id",e.id).single();if(r&&"PGRST116"===r.code){const r=e.user_metadata?.full_name||e.user_metadata?.name||e.email?.split("@")[0]||"User",s=e.user_metadata?.avatar_url||e.user_metadata?.picture,{data:n,error:i}=await wi.from("user_profiles").insert({id:e.id,full_name:r,email:e.email,role:"user",profile_picture_url:s}).select().single();if(i)throw i;t=n}else if(r)throw r;return i(t),t}catch(t){return console.error("Error fetching profile:",t),l({variant:"destructive",title:"Error",description:"Could not load profile. Please refresh the page."}),null}},[l]),u=y.useCallback(()=>r?c(r):Promise.resolve(null),[r,c]);y.useEffect(()=>{(async()=>{a(!0);const{data:{session:e}}=await wi.auth.getSession();s(e?.user??null),e?.user&&await c(e.user),a(!1)})();const{data:e}=wi.auth.onAuthStateChange(async(e,t)=>{const r=t?.user??null;if(s(r),"SIGNED_IN"===e&&window.location.search.includes("code=")){const e=new URL(window.location.href);return e.searchParams.delete("code"),void(window.location.href=e.toString())}r?await c(r):i(null),a(!1)});return()=>{e?.subscription?.unsubscribe()}},[c]);const d=y.useCallback(async e=>{const{data:t,error:r}=await wi.auth.signInWithPassword(e);if(r)return l({variant:"destructive",title:"Login Failed",description:r.message}),{error:r};console.log("Login successful, user:",t.user);const n=await c(t.user);return console.log("Fetched profile:",n),s(t.user),i(n),l({title:"Login Successful",description:`Welcome back${n?.full_name?", "+n.full_name:""}!`}),{error:null,profile:n}},[c,l]),h=y.useCallback(async()=>{a(!0);const e=`${window.location.origin}/app`,{error:t}=await wi.auth.signInWithOAuth({provider:"google",options:{redirectTo:e}});t&&(a(!1),l({variant:"destructive",title:"Google Sign-In Failed",description:t.message}))},[l]),f=y.useCallback(async e=>{const{email:t,password:r,full_name:n}=e;let o="user";t.endsWith("@greenofig.com")&&(t.startsWith("nutritionist@")?o="nutritionist":t.startsWith("admin@")?o="admin":t.startsWith("superadmin@")&&(o="super_admin"));const{data:a,error:u}=await wi.auth.signUp({email:t,password:r,options:{data:{full_name:n,role:o}}});if(u)return l({variant:"destructive",title:"Sign Up Failed",description:u.message}),{user:null,error:u};const{data:d,error:h}=await wi.auth.signInWithPassword({email:t,password:r});if(h)return l({variant:"destructive",title:"Sign-in after sign-up failed.",description:h.message}),{user:null,error:h};await new Promise(e=>setTimeout(e,1500)),"user"!==o&&await wi.from("user_profiles").update({role:o}).eq("id",d.user.id);const f=await c(d.user);return s(d.user),i(f),{user:d.user,error:null,profile:f}},[c,l]),p=y.useCallback(async()=>{a(!0);try{await wi.auth.signOut(),s(null),i(null),localStorage.clear(),sessionStorage.clear(),l({title:"Signed Out",description:"You have been successfully signed out."})}catch(e){console.error("SignOut error:",e)}window.location.replace("/home")},[l]),m=y.useMemo(()=>({user:r,userProfile:n,loading:o,signIn:d,signInWithGoogle:h,signUp:f,signOut:p,refreshUserProfile:u}),[r,n,o,d,h,f,p,u]);return e.jsx(Ti.Provider,{value:m,children:t})},Si=()=>{const e=y.useContext(Ti);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e},Ei="/assets/Remove%20background%20project-DdcfZIGG.png",Oi=Yt("inline-flex items-center justify-center whitespace-nowrap rounded-lg text-sm font-semibold ring-offset-background transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 active:scale-95",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 hover:shadow-lg hover:shadow-primary/20",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 hover:shadow-lg hover:shadow-destructive/20",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground hover:border-primary/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 hover:shadow-md",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline focus-visible:ring-offset-0"},size:{default:"h-9 px-3 text-sm",sm:"h-9 px-3 text-sm",lg:"h-11 px-4 text-base",icon:"h-9 w-9 p-0"}},defaultVariants:{variant:"default",size:"sm"}}),Ni=y.forwardRef(({className:t,variant:r,size:s,asChild:n=!1,...i},o)=>{const a=n?l:"button";return e.jsx(a,{className:Jt(Oi({variant:r,size:s,className:t})),ref:o,type:"button"!==a||i.type?i.type:"button",...i})});Ni.displayName="Button";const Pi=t=>e.jsxs("svg",{viewBox:"0 0 48 48",...t,children:[e.jsx("path",{fill:"#FFC107",d:"M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12s5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"}),e.jsx("path",{fill:"#FF3D00",d:"M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"}),e.jsx("path",{fill:"#4CAF50",d:"M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.222,0-9.651-3.356-11.303-8H6.306C9.656,39.663,16.318,44,24,44z"}),e.jsx("path",{fill:"#1976D2",d:"M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571l6.19,5.238C44.572,34.046,48,27.461,48,20C48,17.222,47.113,14.69,45.54,12.591L39.9,18.335C42.128,20.45,43.611,20.083,43.611,20.083z"})]}),Ci=({logoUrl:t,initialIsLogin:r=!0})=>{const{signIn:s,signUp:n,signInWithGoogle:i,user:o,userProfile:a}=Si(),l=w(),c=_(),[u,d]=y.useState(r),[h,f]=y.useState(""),[p,m]=y.useState(""),[g,b]=y.useState(""),[v,j]=y.useState(!1),[T,k]=y.useState(!1),[S,E]=y.useState(null);y.useEffect(()=>{c.state?.selectedPlan&&E(c.state.selectedPlan)},[c.state]),y.useEffect(()=>{d("/login"===c.pathname)},[c.pathname]);return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-background touch-auto",children:e.jsx(A.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"w-full max-w-md",children:e.jsxs("div",{className:"glass-effect rounded-2xl p-4 sm:p-8 shadow-2xl",children:[e.jsxs("button",{onClick:()=>l(-1),className:"flex items-center gap-2 text-text-secondary hover:text-primary transition-colors mb-4 group",children:[e.jsx(I,{className:"w-5 h-5 group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{className:"text-sm font-medium",children:"Back"})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx(x,{to:"/home",className:"inline-block mb-4",children:e.jsx(A.div,{animate:{scale:[1,1.1,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.jsx("img",{src:t,alt:"GreenoFig Logo",className:"w-20 h-20"})})}),e.jsx("h1",{className:"text-4xl font-bold gradient-text mb-2",children:"GreenoFig"}),e.jsx("p",{className:"text-text-secondary",children:"Your Personal Wellness Companion"}),S&&!u&&e.jsxs("div",{className:"mt-4 bg-primary/10 text-primary font-semibold p-2 rounded-lg",children:["Signing up for the ",e.jsx("span",{className:"font-bold",children:S})," plan"]})]}),e.jsxs(Ni,{variant:"outline",className:"w-full py-3 min-h-[44px] rounded-lg shadow-lg flex items-center justify-center gap-2 touch-manipulation active:scale-95 transition-transform",onClick:async()=>{v||T||(k(!0),await i(),setTimeout(()=>k(!1),5e3))},disabled:T||v,type:"button",children:[T?e.jsx(R,{className:"h-5 w-5 animate-spin"}):e.jsx(Pi,{className:"w-5 h-5"}),e.jsxs("span",{children:["Sign ",u?"in":"up"," with Google"]})]}),e.jsxs("div",{className:"my-4 flex items-center",children:[e.jsx("div",{className:"flex-grow border-t border-border"}),e.jsx("span",{className:"flex-shrink mx-4 text-xs text-text-secondary uppercase",children:"Or continue with"}),e.jsx("div",{className:"flex-grow border-t border-border"})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!v&&!T)if(h&&p&&(u||g))if(j(!0),u){const{error:e,profile:t}=await s({email:h,password:p});if(!e&&t){const e=t.role;let r="/app/user";return"admin"===e||"super_admin"===e?r="/app/admin":"nutritionist"===e&&(r="/app/nutritionist"),void l(r,{replace:!0,state:{skipLoading:!0}})}j(!1)}else{const{user:e,error:t,profile:r}=await n({email:h,password:p,full_name:g});if(!t&&e&&r){or({title:"Account created! ",description:"Welcome! Let's get you set up."});const e=r.role;let t="/app/user";return"admin"===e||"super_admin"===e?t="/app/admin":"nutritionist"===e&&(t="/app/nutritionist"),void l(t,{replace:!0,state:{skipLoading:!0}})}j(!1)}else or({title:"Missing fields",description:"Please fill in all required fields",variant:"destructive"})},className:"space-y-4",children:[!u&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-primary"}),e.jsx("input",{type:"text",value:g,onChange:e=>b(e.target.value),className:"w-full pl-10 pr-4 py-3 min-h-[44px] bg-background border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring touch-manipulation",style:{fontSize:"16px"},placeholder:"John Doe",disabled:v||T,required:!0,autoComplete:"name"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-primary"}),e.jsx("input",{type:"email",value:h,onChange:e=>f(e.target.value),className:"w-full pl-10 pr-4 py-3 min-h-[44px] bg-background border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring touch-manipulation",style:{fontSize:"16px"},placeholder:"you@example.com",disabled:v||T,required:!0,autoComplete:"email",inputMode:"email"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-primary"}),e.jsx("input",{type:"password",value:p,onChange:e=>m(e.target.value),className:"w-full pl-10 pr-4 py-3 min-h-[44px] bg-background border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring touch-manipulation",style:{fontSize:"16px"},placeholder:"",disabled:v||T,required:!0,autoComplete:u?"current-password":"new-password"})]})]}),e.jsxs(Ni,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground font-semibold py-3 min-h-[44px] rounded-lg shadow-lg touch-manipulation active:scale-95 transition-transform",disabled:v||T,children:[v&&e.jsx(R,{className:"mr-2 h-4 w-4 animate-spin"}),v?"Processing...":u?"Login":"Sign Up"]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>{v||T||l(u?"/signup":"/login")},type:"button",className:"text-text-secondary hover:text-primary transition-colors disabled:opacity-50 min-h-[44px] py-2 px-4 touch-manipulation",disabled:v||T,children:u?"Don't have an account? Sign up":"Already have an account? Login"})})]})})})},Ai=y.forwardRef(({className:t,...r},s)=>e.jsx(c,{ref:s,className:Jt("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...r}));Ai.displayName=c.displayName;const Ii=y.forwardRef(({className:t,...r},s)=>e.jsx(u,{ref:s,className:Jt("aspect-square h-full w-full",t),...r}));Ii.displayName=u.displayName;const Ri=y.forwardRef(({className:t,...r},s)=>e.jsx(d,{ref:s,className:Jt("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...r}));Ri.displayName=d.displayName;const $i=Yt("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"text-foreground hover:bg-accent"}},defaultVariants:{variant:"default"}});function Li({className:t,variant:r,...s}){return e.jsx("div",{className:Jt($i({variant:r}),t),...s})}const Di=y.forwardRef(({className:t,...r},s)=>e.jsx("textarea",{className:Jt("flex min-h-[120px] w-full rounded-2xl border border-input bg-background/50 backdrop-blur-sm px-4 py-3 text-base text-foreground ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:border-primary disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200 hover:border-primary/50 resize-y",t),style:{fontSize:"16px"},ref:s,"aria-invalid":r["aria-invalid"],...r}));Di.displayName="Textarea";const Ui=y.forwardRef(({className:t,type:r,...s},n)=>e.jsx("input",{type:r,className:Jt("flex h-12 lg:h-14 w-full min-w-0 max-w-full rounded-2xl border border-input bg-background/50 backdrop-blur-sm px-4 lg:px-5 py-3 lg:py-3.5 text-base lg:text-lg text-foreground ring-offset-background file:border-0 file:bg-transparent file:text-base lg:file:text-lg file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:border-primary disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200 hover:border-primary/50",t),style:{fontSize:"16px"},ref:n,"aria-invalid":s["aria-invalid"],...s}));Ui.displayName="Input";const Bi=Yt("text-sm font-semibold text-foreground mb-2 block tracking-wide leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Fi=y.forwardRef(({className:t,...r},s)=>e.jsx(h,{ref:s,className:Jt(Bi(),t),...r}));Fi.displayName=h.displayName;const Mi=()=>{const{userProfile:t,user:r}=Si(),{toast:s}=ar(),[n,i]=y.useState(!1),[o,a]=y.useState(!1),[l,c]=y.useState("ai"),[u,d]=y.useState([]),[h,f]=y.useState(""),[p,m]=y.useState(!1),[g,b]=y.useState(!1),[v,w]=y.useState([]),[_,x]=y.useState(null),[j,T]=y.useState([]),[k,S]=y.useState(0),[E,O]=y.useState(!0),[N,P]=y.useState(window.innerHeight),[R,$]=y.useState(()=>localStorage.getItem("chatButtonPosition")||"right"),[D,G]=y.useState(!1),[K,Y]=y.useState(""),[Q,X]=y.useState(""),[Z,ee]=y.useState(""),[te,re]=y.useState(!1),[se,ne]=y.useState(!1),[ie,oe]=y.useState([]),[ae,le]=y.useState(""),ce=y.useRef(null),ue=y.useRef(null),de=y.useRef(null),he=!r;y.useEffect(()=>{const e=new(window.AudioContext||window.webkitAudioContext);return de.current=e,()=>{e&&"closed"!==e.state&&e.close()}},[]),y.useEffect(()=>{const e=()=>{window.visualViewport?P(window.visualViewport.height):P(window.innerHeight)};return window.visualViewport?(window.visualViewport.addEventListener("resize",e),window.visualViewport.addEventListener("scroll",e)):window.addEventListener("resize",e),()=>{window.visualViewport?(window.visualViewport.removeEventListener("resize",e),window.visualViewport.removeEventListener("scroll",e)):window.removeEventListener("resize",e)}},[]);y.useEffect(()=>{if(r?.id&&t?.role){fe();const e=wi.channel("messages-changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},e=>{if(e.new.recipient_id===r.id||e.new.sender_id===r.id){if(fe(),_){const r=t?.role;let s=!1;s="nutritionist"===r||"admin"===r||"super_admin"===r?e.new.sender_id===_||e.new.recipient_id===_:e.new.conversation_id===_,s&&pe(_)}e.new.recipient_id===r.id&&e.new.sender_id!==r.id&&((()=>{if(E&&de.current)try{const e=de.current.createOscillator(),t=de.current.createGain();e.connect(t),t.connect(de.current.destination),e.frequency.value=800,e.type="sine",t.gain.setValueAtTime(.3,de.current.currentTime),t.gain.exponentialRampToValueAtTime(.01,de.current.currentTime+.3),e.start(de.current.currentTime),e.stop(de.current.currentTime+.3)}catch(e){console.error("Error playing notification sound:",e)}})(),s({title:" New Message",description:"You have received a new message",duration:3e3}))}}).subscribe();return()=>{wi.removeChannel(e)}}},[r?.id,t?.role,_]);const fe=async()=>{if(r?.id)try{const e=t?.role;let s;s="nutritionist"===e||"admin"===e||"super_admin"===e?wi.from("messages").select("\n            *,\n            sender:user_profiles!messages_sender_id_fkey(id, full_name, email, profile_picture_url),\n            recipient:user_profiles!messages_recipient_id_fkey(id, full_name, email, profile_picture_url)\n          ").or(`sender_id.eq.${r.id},recipient_id.eq.${r.id}`).order("created_at",{ascending:!1}):wi.from("conversations").select("\n            *,\n            nutritionist:nutritionist_id (\n              id,\n              full_name,\n              email,\n              profile_picture_url\n            )\n          ").eq("user_id",r.id).order("last_message_at",{ascending:!1});const{data:n,error:i}=await s;if(i)throw i;if("nutritionist"===e||"admin"===e||"super_admin"===e){const e=new Map;n?.forEach(t=>{if(!t||!t.sender_id||!t.recipient_id)return;const s=t.sender_id===r.id?t.recipient_id:t.sender_id,n=t.sender_id===r.id?t.recipient||{}:t.sender||{};if(n&&n.id)if(e.has(s)){const n=e.get(s);new Date(t.created_at)>new Date(n.lastMessage.created_at)&&(n.lastMessage=t),t.recipient_id!==r.id||t.is_read||n.unreadCount++}else e.set(s,{id:s,partner:n,lastMessage:t,unreadCount:t.recipient_id!==r.id||t.is_read?0:1})}),w(Array.from(e.values())),S(Array.from(e.values()).reduce((e,t)=>e+t.unreadCount,0))}else w(n||[]),S(n?.reduce((e,t)=>e+(t.unread_count||0),0)||0)}catch(e){console.error("Error fetching conversations:",e)}},pe=async e=>{try{const s=t?.role;let n;n="nutritionist"===s||"admin"===s||"super_admin"===s?wi.from("messages").select("*").or(`and(sender_id.eq.${r.id},recipient_id.eq.${e}),and(sender_id.eq.${e},recipient_id.eq.${r.id})`).order("created_at",{ascending:!0}):wi.from("messages").select("*").eq("conversation_id",e).order("created_at",{ascending:!0});const{data:i,error:o}=await n;if(o)throw o;T(i||[]),"nutritionist"===s||"admin"===s||"super_admin"===s?await wi.from("messages").update({is_read:!0}).eq("recipient_id",r.id).eq("sender_id",e):await wi.from("messages").update({is_read:!0}).eq("conversation_id",e).eq("recipient_id",r.id),fe()}catch(s){console.error("Error fetching messages:",s)}},me=(()=>{if(he)return["What features does GreenoFig offer?","Tell me about the pricing plans","I'd like to speak with someone from your team"];const e=t?.role;return"admin"===e||"super_admin"===e?["Show me platform analytics overview","What are the best practices for user engagement?","Help me analyze subscription trends"]:"nutritionist"===e?["Suggest evidence-based nutrition strategies","Help me create a client meal plan template","What are current nutrition research trends?"]:["Give me a healthy breakfast idea","Suggest a quick 15-minute workout","How can I improve my sleep quality?"]})();y.useEffect(()=>{const e=setTimeout(()=>b(!0),3e3),t=setTimeout(()=>b(!1),8e3);return()=>{clearTimeout(e),clearTimeout(t)}},[]),y.useEffect(()=>{const e=e=>{ue.current&&!ue.current.contains(e.target)&&n&&i(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[n]);y.useEffect(()=>{ce.current?.scrollIntoView({behavior:"smooth"})},[u,j]),y.useEffect(()=>{if(n&&0===u.length&&"ai"===l){let e="";if(he)e="Hi there!  Welcome to GreenoFig! I'm your Website Assistant. I can help answer questions about our platform, features, pricing, and how we can support your health journey. If you'd like to speak with our team, just let me know!";else{const r=t?.role;e="admin"===r||"super_admin"===r?`Hi ${t?.full_name?.split(" ")[0]||"Admin"}!  I'm your AI Business Assistant. I can help with analytics, strategies, and platform insights.`:"nutritionist"===r?`Hi ${t?.full_name?.split(" ")[0]||"there"}!  I'm your AI Nutrition Assistant. I can help with evidence-based strategies, client plans, and research.`:`Hi ${t?.full_name?.split(" ")[0]||"there"}!  I'm your AI Health Coach. How can I help you today?`}const r={id:Date.now(),text:e,sender:"ai"};d([r])}},[n,he,t,l]);const ge=async(e,n)=>{if(e&&e.preventDefault(),"messages"===l)return void(async()=>{if(!h.trim()||!_)return;const e=h.trim();f("");try{const s=t?.role,n={message_text:e,sender_id:r.id,is_read:!1,created_at:(new Date).toISOString()};"nutritionist"===s||"admin"===s||"super_admin"===s?n.recipient_id=_:(n.conversation_id=_,n.recipient_id=v.find(e=>e.id===_)?.nutritionist?.id);const{error:i}=await wi.from("messages").insert([n]);if(i)throw i}catch(n){console.error("Error sending message:",n),s({title:"Error",description:"Failed to send message",variant:"destructive"})}})();const i=n||h;if(!i.trim()||p)return;const o={...{text:i,sender:"user",user_id:r?.id},id:Date.now(),created_at:(new Date).toISOString()},a=[...u,o];d(a),f(""),m(!0);try{if(he&&(i.toLowerCase().includes("talk to someone")||i.toLowerCase().includes("speak with")||i.toLowerCase().includes("contact")||i.toLowerCase().includes("representative")||i.toLowerCase().includes("human")||i.toLowerCase().includes("real person")||i.toLowerCase().includes("team member"))){const e={text:"I'd be happy to connect you with our team! Please provide your name and email address, and someone from our team will reach out to you shortly.",sender:"ai",id:Date.now()+1};return d(t=>[...t,e]),G(!0),void m(!1)}const{data:e,error:s}=await wi.functions.invoke("ai-coach-memory",{body:JSON.stringify({messages:a.slice(-10),userProfile:he?{isVisitor:!0,role:"visitor",systemPrompt:"You are a helpful Website Assistant for GreenoFig, an AI-powered health and wellness platform. You can ONLY answer questions about: the website features, pricing plans, how the platform works, subscription details, privacy and security, payment methods, and general information about our services. If asked about personal health advice, meal plans, or fitness routines, politely explain that users need to sign up to access our AI Health Coach. Keep responses friendly, concise, and focused on helping visitors understand our platform."}:{...t,isAdmin:"admin"===t?.role||"super_admin"===t?.role,isNutritionist:"nutritionist"===t?.role}})});if(s)throw s;const n={text:e.reply,sender:"ai",user_id:r?.id,id:Date.now()+1,created_at:(new Date).toISOString()};d(e=>[...e,n])}catch(c){console.error("AI Coach error:",c);const e={text:"I'm having trouble connecting right now. Please try again! ",sender:"ai",id:Date.now()+1};d(t=>[...t,e]),s({title:"Error",description:"Failed to get AI response. Please try again.",variant:"destructive"})}finally{m(!1)}},ye=e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),ge())},be=()=>{i(!n),a(!1)};return e.jsxs("div",{ref:ue,children:[e.jsx(U,{children:!n&&e.jsxs(A.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1,[R]:16},exit:{scale:0,opacity:0},transition:{type:"spring",stiffness:500,damping:30,mass:.8},className:"fixed bottom-6 z-[9999]",style:{[R]:"16px"},children:[e.jsx(U,{children:g&&e.jsxs(A.div,{initial:{opacity:0,x:"right"===R?20:-20,scale:.8},animate:{opacity:1,x:0,scale:1},exit:{opacity:0,x:"right"===R?20:-20,scale:.8},className:"absolute bottom-20 bg-card rounded-lg shadow-xl p-3 w-56 border border-primary/20 "+("right"===R?"right-0":"left-0"),children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(B,{className:"h-5 w-5 text-primary shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-card-foreground",children:"Need help?"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Chat with AI Coach or message your nutritionist!"})]})]}),e.jsx("div",{className:"absolute -bottom-2 w-4 h-4 bg-card border-r border-b border-primary/20 transform rotate-45 "+("right"===R?"right-6":"left-6")})]})}),e.jsxs(A.div,{drag:"x",dragConstraints:{left:-(window.innerWidth-96),right:window.innerWidth-96},dragElastic:.1,dragMomentum:!1,onDragEnd:(e,t)=>{const r=window.innerWidth,s=e.target.getBoundingClientRect(),n=s.left+s.width/2<r/2?"left":"right";$(n),localStorage.setItem("chatButtonPosition",n)},onClick:be,whileHover:{scale:1.05},whileTap:{scale:.95},className:"h-16 w-16 rounded-full shadow-2xl cursor-grab active:cursor-grabbing relative bg-gradient-to-br from-primary to-green-400 touch-none select-none",children:[k>0&&e.jsx(A.div,{initial:{scale:0},animate:{scale:1},className:"absolute -top-1 -right-1 h-6 w-6 rounded-full bg-red-500 flex items-center justify-center text-white text-xs font-bold shadow-lg z-10",children:k>9?"9+":k}),e.jsx(A.div,{animate:{boxShadow:["0 0 10px hsl(var(--primary) / 0.3)","0 0 20px hsl(var(--primary) / 0.4)","0 0 10px hsl(var(--primary) / 0.3)"]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:"absolute inset-0 rounded-full"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-2",children:e.jsx("img",{src:Ei,alt:"GreenoFig AI Coach",className:"h-12 w-12 object-contain drop-shadow-lg",style:{filter:"brightness(0.75) contrast(1.15)"}})})]})]})}),e.jsx(U,{children:n&&e.jsxs(A.div,{initial:{opacity:0,y:50,scale:.9},animate:{opacity:1,y:0,scale:1,[R]:16},exit:{opacity:0,y:50,scale:.9},transition:{type:"spring",stiffness:300,damping:30},className:"fixed w-[calc(100vw-32px)] max-w-[320px] md:max-w-[340px] bg-card rounded-2xl shadow-2xl z-[9999] border border-border overflow-hidden flex flex-col",style:{[R]:"16px",bottom:"16px",height:o?"60px":"auto",maxHeight:o?"60px":"550px"},children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary to-green-400 p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0 overflow-hidden",children:[e.jsx("div",{className:"rounded-full bg-white/20 flex items-center justify-center overflow-hidden flex-shrink-0 "+(o?"h-8 w-8":"h-10 w-10"),children:e.jsx("img",{src:Ei,alt:"GreenoFig",className:"rounded-full object-cover "+(o?"h-6 w-6":"h-8 w-8")})}),e.jsxs("div",{className:"flex-1 min-w-0 overflow-hidden",children:[e.jsx("h3",{className:"font-semibold text-white text-sm truncate whitespace-nowrap",children:he?"Website Assistant":"ai"===l?"AI Health Coach":"Messages"}),!o&&e.jsx("p",{className:"text-xs text-white/80 truncate whitespace-nowrap",children:he?"Ask me about GreenoFig!":"ai"===l?p?"Thinking...":"Online":`${v.length} conversations`})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ni,{variant:"ghost",size:"sm",onClick:()=>O(!E),className:"h-8 w-8 p-0 text-white hover:bg-white/20",title:E?"Mute notifications":"Unmute notifications",children:E?e.jsx(F,{className:"h-4 w-4"}):e.jsx(M,{className:"h-4 w-4"})}),e.jsx(Ni,{variant:"ghost",size:"sm",onClick:()=>{a(!o)},className:"h-8 w-8 p-0 text-white hover:bg-white/20",children:o?e.jsx(z,{className:"h-4 w-4"}):e.jsx(H,{className:"h-4 w-4"})}),e.jsx(Ni,{variant:"ghost",size:"sm",onClick:be,className:"h-8 w-8 p-0 text-white hover:bg-white/20",children:e.jsx(C,{className:"h-4 w-4"})})]})]}),!o&&!he&&e.jsxs("div",{className:"flex border-b border-border bg-muted/30",children:[e.jsxs("button",{onClick:()=>c("ai"),className:"flex-1 py-3 px-4 flex items-center justify-center gap-2 font-medium text-sm transition-all "+("ai"===l?"bg-background text-primary border-b-2 border-primary":"text-muted-foreground hover:text-foreground hover:bg-muted/50"),children:[e.jsx(q,{className:"h-4 w-4"}),"AI Coach"]}),e.jsxs("button",{onClick:()=>c("messages"),className:"flex-1 py-3 px-4 flex items-center justify-center gap-2 font-medium text-sm transition-all relative "+("messages"===l?"bg-background text-primary border-b-2 border-primary":"text-muted-foreground hover:text-foreground hover:bg-muted/50"),children:[e.jsx(V,{className:"h-4 w-4"}),"Messages",k>0&&e.jsx(Li,{variant:"destructive",className:"h-5 min-w-[20px] px-1.5 text-[10px]",children:k>9?"9+":k})]})]}),!o&&"ai"===l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-muted/30",style:{maxHeight:"320px"},children:[e.jsx(U,{children:u.map((t,r)=>e.jsx(A.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex "+("user"===t.sender?"justify-end":"justify-start"),children:e.jsx("div",{className:"max-w-[85%] rounded-xl px-3 py-2.5 shadow-sm "+("user"===t.sender?"bg-gradient-to-br from-primary to-green-400 text-primary-foreground":"bg-card border border-border text-card-foreground"),children:e.jsx("p",{className:"text-[13px] leading-relaxed whitespace-pre-wrap break-words",children:t.text})})},t.id||r))}),p&&e.jsx(A.div,{initial:{opacity:0},animate:{opacity:1},className:"flex justify-start",children:e.jsx("div",{className:"bg-muted rounded-xl px-4 py-3 shadow-sm",children:e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 bg-primary/60 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-2 h-2 bg-primary/60 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-2 h-2 bg-primary/60 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})}),e.jsx("div",{ref:ce})]}),u.length<=1&&!p&&!D&&e.jsx("div",{className:"px-3 pb-2 pt-1",children:e.jsx("div",{className:"space-y-2",children:me.map((t,r)=>e.jsx(A.button,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{delay:.1*r},onClick:e=>ge(e,t),className:"w-full p-2 bg-muted hover:bg-accent rounded-lg text-left text-xs transition-colors",children:t},r))})}),e.jsx("div",{className:"p-4 bg-card border-t border-border",children:D?e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),Q.trim()&&K.trim()){re(!0);try{const{error:e}=await wi.from("visitor_inquiries").insert([{name:K,email:Q,question:Z||h,conversation_history:JSON.stringify(u),status:"pending",created_at:(new Date).toISOString()}]);if(e)throw e;s({title:"Thank you!",description:"Our team will get back to you shortly via email."});const t={id:Date.now(),text:`Thank you, ${K}! I've forwarded your information to our team. Someone will reach out to you at ${Q} shortly. Is there anything else I can help you with about our website?`,sender:"ai"};d(e=>[...e,t]),G(!1),Y(""),X(""),ee("")}catch(t){console.error("Error submitting lead:",t),s({title:"Error",description:"Failed to submit your information. Please try again or email us directly at support@greenofig.com",variant:"destructive"})}finally{re(!1)}}else s({title:"Missing Information",description:"Please provide your name and email",variant:"destructive"})},className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(Fi,{htmlFor:"visitor-name",className:"text-xs font-medium",children:"Name *"}),e.jsx(Ui,{id:"visitor-name",type:"text",value:K,onChange:e=>Y(e.target.value),placeholder:"Your name",className:"mt-1 text-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx(Fi,{htmlFor:"visitor-email",className:"text-xs font-medium",children:"Email *"}),e.jsx(Ui,{id:"visitor-email",type:"email",value:Q,onChange:e=>X(e.target.value),placeholder:"your@email.com",className:"mt-1 text-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx(Fi,{htmlFor:"visitor-question",className:"text-xs font-medium",children:"Question (Optional)"}),e.jsx(Di,{id:"visitor-question",value:Z,onChange:e=>ee(e.target.value),placeholder:"Tell us how we can help...",className:"mt-1 text-sm resize-none",rows:2})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ni,{type:"button",variant:"outline",onClick:()=>G(!1),className:"flex-1",disabled:te,children:"Cancel"}),e.jsx(Ni,{type:"submit",disabled:te,className:"flex-1 bg-gradient-to-br from-primary to-green-400",children:te?"Sending...":"Submit"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:ge,className:"flex gap-3 items-end",children:[e.jsx(Di,{value:h,onChange:e=>f(e.target.value),onKeyPress:ye,placeholder:he?"Ask about our platform...":"Ask me anything...",className:"flex-1 min-h-[48px] max-h-[120px] resize-none text-sm bg-background border-input focus:border-ring focus:ring-2 focus:ring-primary/20 rounded-lg p-3",rows:2}),e.jsx(Ni,{type:"submit",disabled:!h.trim()||p,size:"icon",className:"h-12 w-12 bg-gradient-to-br from-primary to-green-400 hover:from-primary/90 hover:to-green-400/90 shrink-0 shadow-md transition-all",children:e.jsx(W,{className:"h-5 w-5"})})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-2 text-center",children:"Press Enter to send  Shift+Enter for new line"})]})})]}),!o&&"messages"===l&&e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[!_&&!se&&("admin"===t?.role||"super_admin"===t?.role||"nutritionist"===t?.role)&&e.jsx("div",{className:"p-3 border-b border-border",children:e.jsxs(Ni,{onClick:()=>{ne(!0),(async()=>{try{const{data:e,error:t}=await wi.from("user_profiles").select("id, full_name, email, profile_picture_url, role").neq("id",r.id).order("full_name");if(t)throw t;oe(e||[])}catch(e){console.error("Error fetching users:",e)}})()},className:"w-full bg-gradient-to-br from-primary to-green-400",size:"sm",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"New Message"]})}),se&&e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ni,{variant:"ghost",size:"sm",onClick:()=>{ne(!1),le("")},className:"h-8 w-8 p-0",title:"Back to conversations",children:e.jsx(I,{className:"h-4 w-4"})}),e.jsx("h3",{className:"text-sm font-semibold",children:"Select User to Message"})]}),e.jsx(Ui,{placeholder:"Search users...",value:ae,onChange:e=>le(e.target.value),className:"text-sm"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto divide-y divide-border",children:ie.filter(e=>e.full_name?.toLowerCase().includes(ae.toLowerCase())||e.email?.toLowerCase().includes(ae.toLowerCase())).map(t=>e.jsxs(A.button,{onClick:()=>{return e=t.id,x(e),ne(!1),le(""),void pe(e);var e},className:"w-full p-3 hover:bg-muted/50 transition-colors text-left flex items-center gap-3",whileHover:{backgroundColor:"rgba(0,0,0,0.02)"},children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:t.profile_picture_url?e.jsx("img",{src:t.profile_picture_url,alt:t.full_name,className:"h-full w-full rounded-full object-cover"}):e.jsx("span",{className:"text-sm font-semibold text-primary",children:t.full_name?.charAt(0)||"?"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground truncate",children:t.full_name||"Unknown"}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:t.email})]}),e.jsx(Li,{variant:"outline",className:"text-[10px]",children:t.role})]},t.id))})]}),!_&&!se&&e.jsx("div",{className:"flex-1 overflow-y-auto",children:0===v.length?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-6 text-center",children:[e.jsx(V,{className:"h-12 w-12 text-muted-foreground mb-3"}),e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"No conversations yet"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Start chatting with your ","user"===t?.role?"nutritionist":"clients","!"]})]}):e.jsx("div",{className:"divide-y divide-border",children:v.map(t=>{const r=t.partner||t.nutritionist,s=t.lastMessage||{message_text:t.last_message,created_at:t.last_message_at},n=t.unreadCount||t.unread_count||0;return e.jsxs(A.button,{onClick:()=>{return e=t.id,x(e),void pe(e);var e},className:"w-full p-3 hover:bg-muted/50 transition-colors text-left flex items-start gap-3",whileHover:{backgroundColor:"rgba(0,0,0,0.02)"},children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:r?.profile_picture_url?e.jsx("img",{src:r.profile_picture_url,alt:r.full_name,className:"h-full w-full rounded-full object-cover"}):e.jsx("span",{className:"text-sm font-semibold text-primary",children:r?.full_name?.charAt(0)||"?"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground truncate",children:r?.full_name||"Unknown"}),s?.created_at&&e.jsx("span",{className:"text-[10px] text-muted-foreground whitespace-nowrap ml-2",children:J(new Date(s.created_at),"MMM d")})]}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s?.message_text||"No messages yet"})]}),n>0&&e.jsx(Li,{variant:"destructive",className:"h-5 min-w-[20px] px-1.5 text-[10px] flex-shrink-0",children:n})]},t.id)})})}),_&&e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"p-3 border-b border-border flex items-center gap-3 bg-muted/30",children:[e.jsx(Ni,{variant:"ghost",size:"sm",onClick:()=>{x(null),T([])},className:"h-8 w-8 p-0",title:"Back to conversations",children:e.jsx(I,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm font-semibold",children:v.find(e=>e.id===_)?.partner?.full_name||v.find(e=>e.id===_)?.nutritionist?.full_name||"Conversation"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-2 bg-muted/30",style:{maxHeight:"320px"},children:[j.map(t=>e.jsx(A.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex "+(t.sender_id===r.id?"justify-end":"justify-start"),children:e.jsxs("div",{className:"max-w-[85%] rounded-xl px-3 py-2 shadow-sm "+(t.sender_id===r.id?"bg-gradient-to-br from-primary to-green-400 text-primary-foreground":"bg-card border border-border text-card-foreground"),children:[e.jsx("p",{className:"text-[13px] leading-relaxed whitespace-pre-wrap break-words",children:t.message_text}),e.jsx("span",{className:"text-[10px] opacity-70 mt-1 block",children:J(new Date(t.created_at),"h:mm a")})]})},t.id)),e.jsx("div",{ref:ce})]}),e.jsx("div",{className:"p-4 bg-card border-t border-border",children:e.jsxs("form",{onSubmit:ge,className:"flex gap-3 items-end",children:[e.jsx(Di,{value:h,onChange:e=>f(e.target.value),onKeyPress:ye,placeholder:"Type a message...",className:"flex-1 min-h-[48px] max-h-[120px] resize-none text-sm bg-background border-input focus:border-ring focus:ring-2 focus:ring-primary/20 rounded-lg p-3",rows:2}),e.jsx(Ni,{type:"submit",disabled:!h.trim(),size:"icon",className:"h-12 w-12 bg-gradient-to-br from-primary to-green-400 hover:from-primary/90 hover:to-green-400/90 shrink-0 shadow-md transition-all",children:e.jsx(W,{className:"h-5 w-5"})})]})})]})]})]})})]})},zi=({targetId:t="main-content"})=>{const[r,s]=y.useState(!1);y.useEffect(()=>{document.getElementById(t)||window;const e=t?document.getElementById(t):null,r=()=>{e?e.scrollTop>300?s(!0):s(!1):window.pageYOffset>300?s(!0):s(!1)};return e?e.addEventListener("scroll",r):window.addEventListener("scroll",r),()=>{e?e.removeEventListener("scroll",r):window.removeEventListener("scroll",r)}},[t]);return e.jsx(U,{children:r&&e.jsx(A.div,{initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:20},className:"fixed bottom-6 left-1/2 -translate-x-1/2 md:left-6 md:translate-x-0 z-40",children:e.jsx(Ni,{onClick:()=>{const e=t?document.getElementById(t):null;e?e.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"})},size:"icon",className:"h-12 w-12 rounded-full shadow-lg bg-primary/60 hover:bg-primary/80 backdrop-blur-sm text-primary-foreground border border-primary/20","aria-label":"Scroll to top",children:e.jsx(G,{className:"h-5 w-5"})})})})},Hi=({user:t})=>{const[r,s]=y.useState([]),[n,i]=y.useState(0),[o,a]=y.useState(!1),[l,c]=y.useState(!1),u=y.useRef(null),d=w(),{toast:h}=ar();y.useEffect(()=>{const e=e=>{u.current&&!u.current.contains(e.target)&&a(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const f=async()=>{if(t?.id){c(!0);try{const{data:e,error:r}=await wi.from("notifications").select("*").eq("user_id",t.id).order("created_at",{ascending:!1}).limit(20);if(r)throw r;s(e||[]),i(e?.filter(e=>!e.is_read).length||0)}catch(e){console.error("Error loading notifications:",e)}finally{c(!1)}}};y.useEffect(()=>{if(!t?.id)return;f();const e=wi.channel("notifications").on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:`user_id=eq.${t.id}`},e=>{console.log("Notification update:",e),f()}).subscribe();return()=>{wi.removeChannel(e)}},[t?.id]);const p=(t,r)=>{const s="urgent"===r?"text-red-400":"high"===r?"text-orange-400":"text-blue-400";switch(t){case"blog_generated":case"new_user":case"user_login":case"nutritionist_login":return e.jsx(Q,{className:`w-5 h-5 ${s}`});case"queue_low":case"queue_empty":return e.jsx(X,{className:"w-5 h-5 text-yellow-400"});case"system_alert":return e.jsx(Y,{className:"w-5 h-5 text-red-400"});default:return e.jsx(F,{className:`w-5 h-5 ${s}`})}},m=e=>{const t=Math.floor((new Date-new Date(e))/1e3);if(t<60)return"Just now";const r=Math.floor(t/60);if(r<60)return`${r}m ago`;const s=Math.floor(r/60);if(s<24)return`${s}h ago`;return`${Math.floor(s/24)}d ago`};return e.jsxs("div",{className:"relative",ref:u,children:[e.jsxs("button",{onClick:()=>a(!o),className:"relative p-2 rounded-full hover:bg-accent transition-colors","aria-label":"Notifications",children:[e.jsx(F,{className:"w-6 h-6 text-foreground"}),n>0&&e.jsx("span",{className:"absolute top-0 right-0 flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-red-500 rounded-full",children:n>9?"9+":n})]}),o&&e.jsxs("div",{className:"absolute right-0 mt-2 w-96 bg-background border border-border rounded-2xl shadow-2xl z-50 max-h-[600px] overflow-hidden flex flex-col glass-effect",children:[e.jsxs("div",{className:"p-4 border-b border-border flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Notifications"}),e.jsx("div",{className:"flex items-center gap-2",children:n>0&&e.jsxs("button",{onClick:async()=>{try{const{error:e}=await wi.from("notifications").update({is_read:!0,read_at:(new Date).toISOString()}).eq("user_id",t.id).eq("is_read",!1);if(e)throw e;s(e=>e.map(e=>({...e,is_read:!0}))),i(0),h({title:"All notifications marked as read"})}catch(e){console.error("Error marking all as read:",e),h({title:"Error",description:"Failed to mark notifications as read",variant:"destructive"})}},className:"text-sm text-primary hover:underline flex items-center gap-1",children:[e.jsx(K,{className:"w-4 h-4"}),"Mark all read"]})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:l?e.jsx("div",{className:"p-8 text-center text-text-secondary",children:"Loading notifications..."}):0===r.length?e.jsxs("div",{className:"p-8 text-center text-text-secondary",children:[e.jsx(F,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No notifications yet"})]}):e.jsx("div",{className:"divide-y divide-border",children:r.map(t=>e.jsx("div",{className:"p-4 hover:bg-accent/50 transition-colors cursor-pointer "+(t.is_read?"":"bg-accent/20"),onClick:()=>(async(e,t)=>{try{const{error:r}=await wi.from("notifications").update({is_read:!0,read_at:(new Date).toISOString()}).eq("id",e);if(r)throw r;s(t=>t.map(t=>t.id===e?{...t,is_read:!0}:t)),i(e=>Math.max(0,e-1)),t&&(d(t),a(!1))}catch(r){console.error("Error marking notification as read:",r)}})(t.id,t.action_url),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:p(t.type,t.priority)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-foreground",children:t.title}),e.jsx("button",{onClick:e=>{e.stopPropagation(),(async e=>{try{const{error:t}=await wi.from("notifications").delete().eq("id",e);if(t)throw t;s(t=>t.filter(t=>t.id!==e))}catch(t){console.error("Error deleting notification:",t)}})(t.id)},className:"text-text-secondary hover:text-red-400 flex-shrink-0",children:e.jsx(C,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-sm text-text-secondary mt-1 line-clamp-2",children:t.message}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("span",{className:"text-xs text-text-secondary",children:m(t.created_at)}),!t.is_read&&e.jsx("span",{className:"w-2 h-2 bg-primary rounded-full"})]})]})]})},t.id))})}),r.length>0&&e.jsx("div",{className:"p-3 border-t border-border",children:e.jsx(Ni,{variant:"ghost",size:"sm",className:"w-full",onClick:()=>{d("/app/notifications"),a(!1)},children:"View all notifications"})})]})]})},qi=({logoUrl:t})=>{const{userProfile:r,signOut:s}=Si();w();const n=_(),[i,o]=y.useState(!1),[a,l]=y.useState(0);y.useEffect(()=>{if(r?.id){c();try{const e=wi.channel("conversations-changes").on("postgres_changes",{event:"*",schema:"public",table:"conversations",filter:"user"===r.role?`user_id=eq.${r.id}`:`nutritionist_id=eq.${r.id}`},()=>{c()}).subscribe(e=>{"CHANNEL_ERROR"===e&&console.warn("Realtime subscription error - will use polling instead")});return()=>{try{wi.removeChannel(e)}catch(t){}}}catch(e){console.warn("Realtime not available, using polling only:",e.message);const t=setInterval(c,3e4);return()=>clearInterval(t)}}},[r?.id]);const c=async()=>{if(r?.id)try{if("user"===r.role){const{data:e,error:t}=await wi.rpc("get_unread_message_count",{p_user_id:r.id});t||l(e||0)}else if(["nutritionist","admin","super_admin"].includes(r.role)){const{data:e,error:t}=await wi.rpc("get_nutritionist_unread_count",{p_nutritionist_id:r.id});t||l(e||0)}}catch(e){console.error("Error fetching unread count:",e)}},u=async()=>{await s()},d=[{icon:te,label:"Dashboard",path:"/app/user"},{icon:re,label:"AI Coach",path:"/app/ai-coach"},{icon:se,label:"Nutrition",path:"/app/nutrition"},{icon:ne,label:"Fitness",path:"/app/fitness"},{icon:ie,label:"Progress",path:"/app/progress"},{icon:L,label:"Messages",path:"/app/messages"},{icon:V,label:"Support",path:"/app/support"}],h=[{icon:te,label:"Dashboard",path:"/app/nutritionist?tab=dashboard"},{icon:oe,label:"Clients",path:"/app/nutritionist?tab=clients"},{icon:se,label:"Meal Plans",path:"/app/nutritionist?tab=meals"},{icon:ae,label:"Schedule",path:"/app/nutritionist?tab=schedule"},{icon:V,label:"Messages",path:"/app/nutritionist?tab=messages"},{icon:ie,label:"Analytics",path:"/app/nutritionist?tab=analytics"},{icon:le,label:"Resources",path:"/app/nutritionist?tab=resources"},{icon:le,label:"Blog",path:"/app/nutritionist?tab=blog"},{icon:ce,label:"Settings",path:"/app/nutritionist?tab=settings"}],f=[{icon:te,label:"Dashboard",path:"/app/admin"},{icon:ie,label:"Analytics",path:"/app/admin?tab=analytics"},{icon:ue,label:"Revenue",path:"/app/admin?tab=revenue"},{icon:de,label:"AI Errors",path:"/app/admin?tab=errors"},{icon:oe,label:"User Management",path:"/app/admin?tab=customers"},{icon:he,label:"Subscriptions",path:"/app/admin?tab=subscriptions"},{icon:fe,label:"Payments",path:"/app/admin?tab=payments"},{icon:pe,label:"Coupons",path:"/app/admin?tab=coupons"},{icon:me,label:"Referrals",path:"/app/admin?tab=referrals"},{icon:ge,label:"Support",path:"/app/admin?tab=issues"},{icon:V,label:"Messaging",path:"/app/admin?tab=messaging"},{icon:le,label:"Blog",path:"/app/admin?tab=blog"},{icon:ye,label:"Website",path:"/app/admin?tab=website"},{icon:re,label:"AI Coach",path:"/app/admin?tab=ai-coach"},{icon:be,label:"Database",path:"/app/admin?tab=studio"}],p=(()=>{switch(r?.role){case"admin":case"super_admin":return f;case"nutritionist":return h;default:return d}})(),m=({link:t,isActive:r})=>{const[s,n]=y.useState(!1),l="/app/messages"===t.path&&a>0;return e.jsxs(T,{to:t.path,end:!0,onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),className:`flex items-center gap-2 px-2 py-2 sm:py-1.5 rounded-md transition-all duration-200 text-sm sm:text-xs font-medium border min-h-[44px] sm:min-h-0 ${r||s?"bg-gradient-to-r from-primary to-green-400 text-primary-foreground border-primary/30":"bg-transparent text-muted-foreground border-transparent hover:border-primary/30"} ${s?"translate-x-1":"translate-x-0"}`,onClick:()=>i&&o(!1),children:[e.jsx(t.icon,{className:"w-4 h-4 sm:w-3.5 sm:h-3.5 flex-shrink-0"}),e.jsx("span",{className:"flex-1 truncate",children:t.label}),l&&e.jsx(Li,{className:"bg-red-500 text-white text-xs px-1.5 py-0.5 min-w-[20px] h-5 sm:h-4 flex items-center justify-center",children:a>99?"99+":a})]})},g=()=>{return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"p-3 sm:p-2.5 border-b border-border flex items-center gap-2",children:e.jsxs(x,{to:"/home",className:"flex items-center gap-1.5",children:[e.jsx("img",{src:t,alt:"GreenoFig Logo",className:"w-7 h-7 sm:w-6 sm:h-6"}),e.jsx("span",{className:"text-base sm:text-sm font-bold gradient-text",children:"GreenoFig"})]})}),e.jsx("nav",{className:"flex-1 p-2 space-y-0.5 overflow-y-auto",children:p.map(t=>{let r=!1;return r=t.path.includes("?")?n.pathname+n.search===t.path:"/app/admin"===t.path?n.pathname===t.path&&!n.search:n.pathname===t.path,e.jsx(m,{link:t,isActive:r},t.path)})}),e.jsxs("div",{className:"p-3 border-t border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs(Ai,{className:"w-9 h-9 sm:w-8 sm:h-8",children:[e.jsx(Ii,{src:r?.profile_picture_url}),e.jsx(Ri,{className:"text-xs sm:text-[10px]",children:(s=r?.full_name,s?s.split(" ").map(e=>e[0]).join("").toUpperCase():"?")})]}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsx("p",{className:"text-sm sm:text-xs font-semibold truncate",children:r?.full_name}),e.jsx("p",{className:"text-xs sm:text-[10px] text-text-secondary truncate",children:r?.email})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(T,{to:"/app/profile",className:({isActive:e})=>"flex items-center gap-3 px-3 py-2.5 sm:py-2 rounded-lg transition-colors text-sm font-medium min-h-[44px] sm:min-h-0 "+(e?"bg-muted text-foreground":"text-text-secondary hover:bg-muted hover:text-foreground"),onClick:()=>i&&o(!1),children:[e.jsx($,{className:"w-4 h-4"}),"Profile"]}),e.jsxs("button",{onClick:u,className:"w-full flex items-center gap-3 px-3 py-2.5 sm:py-2 rounded-lg transition-colors text-sm font-medium text-text-secondary hover:bg-muted hover:text-foreground min-h-[44px] sm:min-h-0",children:[e.jsx(ve,{className:"w-4 h-4"}),"Sign Out"]})]})]})]});var s};return e.jsxs("div",{className:"flex h-screen bg-background text-foreground overflow-hidden",children:[e.jsx("aside",{className:"hidden lg:block w-64 bg-card border-r border-border flex-shrink-0",children:e.jsx(g,{})}),e.jsx(U,{children:i&&e.jsxs(e.Fragment,{children:[e.jsx(A.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-40 lg:hidden",onClick:()=>o(!1)}),e.jsx(A.aside,{variants:{open:{x:0,transition:{type:"spring",stiffness:300,damping:30}},closed:{x:"-100%",transition:{type:"spring",stiffness:300,damping:30}}},initial:"closed",animate:"open",exit:"closed",className:"fixed top-0 left-0 h-full w-72 sm:w-64 bg-card z-50 lg:hidden shadow-2xl",children:e.jsx(g,{})})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden min-w-0",children:[e.jsxs("header",{className:"sticky top-0 z-30 flex items-center justify-between lg:justify-end h-14 sm:h-16 px-4 border-b border-border bg-card/95 backdrop-blur supports-[backdrop-filter]:bg-card/60 flex-shrink-0",children:[e.jsx(Ni,{variant:"ghost",size:"icon",className:"lg:hidden min-h-[44px] min-w-[44px]",onClick:()=>o(!0),children:e.jsx(Z,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx(Hi,{user:r}),"admin"===r?.role||"super_admin"===r?.role?e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 text-xs sm:text-sm font-semibold text-primary",children:[e.jsx(ee,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Admin Mode"}),e.jsx("span",{className:"sm:hidden",children:"Admin"})]}):null]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 sm:p-6 lg:p-8",id:"main-content",children:e.jsx(j,{})})]}),e.jsx(Mi,{}),e.jsx(zi,{targetId:"main-content"})]})},Vi=()=>{const{pathname:e}=_();return y.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"instant"})},[e]),null},Wi=y.lazy(()=>ke(()=>import("./HomePage-bGtJwXA5.js"),__vite__mapDeps([0,1,2,3,4]))),Ji=y.lazy(()=>ke(()=>import("./FeaturesPage-CH-j8m7d.js"),__vite__mapDeps([5,1,2,3,4,6,7,8]))),Gi=y.lazy(()=>ke(()=>import("./PricingPage-D07bqDAk.js"),__vite__mapDeps([9,1,2,6,7,8,3,4,10]))),Ki=y.lazy(()=>ke(()=>import("./BlogPage-lUFncQvf.js"),__vite__mapDeps([11,1,2,12,13,6,7,8,3,4]))),Yi=y.lazy(()=>ke(()=>import("./ReviewsPage-DhrhOlTA.js"),__vite__mapDeps([14,1,2,6,7,8,3,4,12]))),Qi=y.lazy(()=>ke(()=>import("./ContactPage--or61h1g.js"),__vite__mapDeps([15,1,2,6,7,8,3,4]))),Xi=y.lazy(()=>ke(()=>import("./FaqPage-DiiEw8hu.js"),__vite__mapDeps([16,1,2,6,7,8,3,4]))),Zi=y.lazy(()=>ke(()=>import("./AboutPage-CAy-ytq0.js"),__vite__mapDeps([17,1,2,6,7,8,3,4]))),eo=y.lazy(()=>ke(()=>import("./UserDashboard-ji0jSkOT.js"),__vite__mapDeps([18,1,2,12,8,3,4,19,20,13]))),to=y.lazy(()=>ke(()=>import("./NutritionistDashboardV2-CPd21A2i.js"),__vite__mapDeps([21,1,2,22,12,3,4,13,23,8,24]))),ro=y.lazy(()=>ke(()=>import("./AdminDashboard-C7BnRBPD.js"),__vite__mapDeps([25,1,2,22,12,3,4,13,23,8,20,26,24,27]))),so=y.lazy(()=>ke(()=>import("./OnboardingSurvey-CnRxse4o.js").then(e=>e.a),__vite__mapDeps([7,1,2,8,3,4]))),no=y.lazy(()=>ke(()=>import("./ProfilePage-Co7ygh2F.js"),__vite__mapDeps([28,1,2,12,23,3,4]))),io=y.lazy(()=>ke(()=>import("./EnhancedBlogPostEditor-BC3LfLnl.js"),__vite__mapDeps([29,1,2,12,24,13,20,3,4,26,8]))),oo=y.lazy(()=>ke(()=>import("./BlogTagsManager-DwhmEahY.js"),__vite__mapDeps([30,1,2,12,13,8,3,4]))),ao=y.lazy(()=>ke(()=>import("./AiCoachPage-C4cElmHc.js"),__vite__mapDeps([31,1,2,3,4]))),lo=y.lazy(()=>ke(()=>import("./SurveyPage-BjhCusO4.js"),__vite__mapDeps([32,1,2,3,4]))),co=y.lazy(()=>ke(()=>import("./RevenueAnalyticsPage-yL14w6kJ.js"),__vite__mapDeps([27,1,2,12,13,3,4]))),uo=y.lazy(()=>ke(()=>import("./BillingPage-pnafAO4f.js").then(e=>e.B),__vite__mapDeps([33,1,2,12,13,3,4,10,8]))),ho=y.lazy(()=>ke(()=>import("./SupportPage-CaNQ0n9z.js"),__vite__mapDeps([34,1,2,12,20,3,4,13]))),fo=y.lazy(()=>ke(()=>import("./ResetPasswordPage-l_0t77MT.js"),__vite__mapDeps([35,1,2,3,4]))),po=y.lazy(()=>ke(()=>import("./NutritionPageFunctional-B1VzO5k1.js"),__vite__mapDeps([36,1,2,19,8,3,4,20]))),mo=y.lazy(()=>ke(()=>import("./FitnessPage-B91cXkYG.js"),__vite__mapDeps([37,1,2,3,4]))),go=y.lazy(()=>ke(()=>import("./ProgressPage-C-X84hAu.js"),__vite__mapDeps([38,1,2,3,4]))),yo=y.lazy(()=>ke(()=>import("./MessagingCenter-BUw159R7.js"),__vite__mapDeps([39,1,2,12,20,3,4,8]))),bo=y.lazy(()=>ke(()=>import("./PrivacyPolicyPage-ChgYPrho.js"),__vite__mapDeps([40,1,2,6,7,8,3,4]))),vo=y.lazy(()=>ke(()=>import("./TermsOfServicePage-BUIlp8ao.js"),__vite__mapDeps([41,1,2,6,7,8,3,4]))),wo=y.lazy(()=>ke(()=>import("./AdminFAQPage-vVwXIOjo.js"),__vite__mapDeps([42,1,2,12,3,4]))),_o=y.lazy(()=>ke(()=>import("./DownloadPage-Dyb_Jtd6.js"),__vite__mapDeps([43,1,2,6,7,8,3,4]))),xo=()=>e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsx("img",{src:Ei,alt:"GreenoFig Logo",className:"w-24 h-24 animate-pulse"})}),jo=({children:t})=>{const{user:r,userProfile:s,loading:n}=Si(),i=_();return r&&s?t:n&&!r?e.jsx(xo,{}):r?t:e.jsx(E,{to:"/login",state:{from:i},replace:!0})},To=({children:t})=>{const{user:r,userProfile:s,loading:n}=Si();return n&&!r?e.jsx(xo,{}):"admin"!==s?.role&&"super_admin"!==s?.role?e.jsx(E,{to:"/app",replace:!0}):t},ko=({children:t})=>{const{user:r,userProfile:s,loading:n}=Si();return console.log("BlogEditorRoute - loading:",n,"userProfile:",s),n&&!r?(console.log("BlogEditorRoute: Still loading auth..."),e.jsx(xo,{})):["admin","super_admin","nutritionist"].includes(s?.role)?(console.log("BlogEditorRoute: Access granted for role:",s.role),t):(console.log("BlogEditorRoute: Access denied, role:",s?.role,"redirecting to /app"),e.jsx(E,{to:"/app",replace:!0}))},So=()=>{const{user:t,userProfile:r,loading:s}=Si();if(s||t&&!r)return e.jsx(xo,{});if(!t)return e.jsx(E,{to:"/login",replace:!0});if(!r)return e.jsx(E,{to:"/login",replace:!0});const n=r.role;let i="/app/user";return"admin"===n||"super_admin"===n?i="/app/admin":"nutritionist"===n&&(i="/app/nutritionist"),e.jsx(E,{to:i,replace:!0})},Eo=()=>{const{user:t,loading:r}=Si();return r?e.jsx(xo,{}):t?e.jsx(E,{to:"/app",replace:!0}):e.jsx(E,{to:"/home",replace:!0})};function Oo(){const t=_();return e.jsxs(e.Fragment,{children:[e.jsx(Vi,{}),e.jsxs(Wt,{children:[e.jsx("title",{children:"GreenoFig - AI-Powered Health & Wellness"}),e.jsx("meta",{name:"description",content:"Your AI-Powered Health Companion. Achieve your wellness goals with personalized nutrition, fitness, and lifestyle coaching."})]}),e.jsx(y.Suspense,{fallback:e.jsx(xo,{}),children:e.jsx(U,{mode:"wait",children:e.jsxs(k,{location:t,children:[e.jsx(S,{path:"/login",element:e.jsx(Ci,{logoUrl:Ei})}),e.jsx(S,{path:"/signup",element:e.jsx(Ci,{logoUrl:Ei,initialIsLogin:!1})}),e.jsx(S,{path:"/reset-password",element:e.jsx(fo,{})}),e.jsxs(S,{path:"/app",element:e.jsx(jo,{children:e.jsx(qi,{logoUrl:Ei})}),children:[e.jsx(S,{index:!0,element:e.jsx(So,{})}),e.jsx(S,{path:"user",element:e.jsx(eo,{logoUrl:Ei})}),e.jsx(S,{path:"nutritionist",element:e.jsx(to,{logoUrl:Ei})}),e.jsx(S,{path:"admin",element:e.jsx(ro,{logoUrl:Ei})}),e.jsx(S,{path:"profile",element:e.jsx(no,{logoUrl:Ei})}),e.jsx(S,{path:"billing",element:e.jsx(uo,{})}),e.jsx(S,{path:"support",element:e.jsx(ho,{})}),e.jsx(S,{path:"ai-coach",element:e.jsx(ao,{})}),e.jsx(S,{path:"nutrition",element:e.jsx(po,{})}),e.jsx(S,{path:"fitness",element:e.jsx(mo,{})}),e.jsx(S,{path:"progress",element:e.jsx(go,{})}),e.jsx(S,{path:"messages",element:e.jsx(yo,{})}),e.jsx(S,{path:"admin/blog/new",element:e.jsx(ko,{children:e.jsx(io,{logoUrl:Ei})})}),e.jsx(S,{path:"admin/blog/edit/:postId",element:e.jsx(ko,{children:e.jsx(io,{logoUrl:Ei})})}),e.jsx(S,{path:"admin/blog/tags",element:e.jsx(To,{children:e.jsx(oo,{logoUrl:Ei})})}),e.jsx(S,{path:"nutritionist/blog/new",element:e.jsx(ko,{children:e.jsx(io,{logoUrl:Ei})})}),e.jsx(S,{path:"nutritionist/blog/edit/:postId",element:e.jsx(ko,{children:e.jsx(io,{logoUrl:Ei})})}),e.jsx(S,{path:"admin/faq",element:e.jsx(To,{children:e.jsx(wo,{})})}),e.jsx(S,{path:"admin/revenue",element:e.jsx(To,{children:e.jsx(co,{})})})]}),e.jsx(S,{path:"/onboarding",element:e.jsx(jo,{children:e.jsx(so,{logoUrl:Ei})})}),e.jsx(S,{path:"/survey",element:e.jsx(lo,{logoUrl:Ei})}),e.jsx(S,{path:"/home",element:e.jsx(Wi,{logoUrl:Ei})}),e.jsx(S,{path:"/features",element:e.jsx(Ji,{logoUrl:Ei})}),e.jsx(S,{path:"/pricing",element:e.jsx(Gi,{logoUrl:Ei})}),e.jsx(S,{path:"/download",element:e.jsx(_o,{logoUrl:Ei})}),e.jsx(S,{path:"/blog",element:e.jsx(Ki,{logoUrl:Ei})}),e.jsx(S,{path:"/blog/:postId",element:e.jsx(Ki,{logoUrl:Ei})}),e.jsx(S,{path:"/reviews",element:e.jsx(Yi,{logoUrl:Ei})}),e.jsx(S,{path:"/contact",element:e.jsx(Qi,{logoUrl:Ei})}),e.jsx(S,{path:"/faq",element:e.jsx(Xi,{logoUrl:Ei})}),e.jsx(S,{path:"/about",element:e.jsx(Zi,{logoUrl:Ei})}),e.jsx(S,{path:"/privacy-policy",element:e.jsx(bo,{logoUrl:Ei})}),e.jsx(S,{path:"/terms-of-service",element:e.jsx(vo,{logoUrl:Ei})}),e.jsx(S,{path:"/",element:e.jsx(Eo,{})}),e.jsx(S,{path:"/*",element:e.jsx(E,{to:"/home",replace:!0})})]},t.pathname)})}),e.jsx(lr,{})]})}const No=new class{constructor(){this.isInitialized=!1}init(){this.isInitialized||(window.onerror=(e,t,r,s,n)=>(this.logError({message:e.toString(),stack:n?.stack,type:"runtime_error",url:window.location.href,source:t,line:r,column:s}),!1),window.addEventListener("unhandledrejection",e=>{this.logError({message:`Unhandled Promise Rejection: ${e.reason}`,stack:e.reason?.stack,type:"promise_rejection",url:window.location.href})}),this.isInitialized=!0,console.log(" Error Logger initialized"))}async logError({message:e,stack:t="",type:r="unknown",componentName:s="unknown",severity:n="medium",url:i=window.location.href,source:o="",line:a=null,column:l=null,userId:c=null}){try{if(!c){const{data:{user:e}}=await wi.auth.getUser();c=e?.id||null}const u={error_message:e,error_stack:t,error_type:r,component_name:s,user_id:c,user_agent:navigator.userAgent,url:i,severity:n,status:"open",source_file:o,line_number:a,column_number:l,browser_info:{language:navigator.language,platform:navigator.platform,screen:{width:window.screen.width,height:window.screen.height}}},{error:d}=await wi.from("error_logs").insert([u]);d?console.error("Failed to log error to Supabase:",d):console.log("Error logged to database:",e)}catch(u){console.error("Error in errorLogger:",u)}}log(e,t="unknown",r="medium"){this.logError({message:e.message||e.toString(),stack:e.stack,type:"manual_log",componentName:t,severity:r})}};var Po;"undefined"!=typeof window&&No.init(),No.init(),je.createRoot(document.getElementById("root")).render(e.jsx(g.StrictMode,{children:e.jsx(ki,{children:e.jsx(O,{children:e.jsx(Oo,{})})})})),(Po=e=>{const{name:t,value:r,id:s}=e})&&Po instanceof Function&&ke(async()=>{const{getCLS:e,getFID:t,getFCP:r,getLCP:s,getTTFB:n}=await Promise.resolve().then(()=>Co);return{getCLS:e,getFID:t,getFCP:r,getLCP:s,getTTFB:n}},void 0).then(({getCLS:e,getFID:t,getFCP:r,getLCP:s,getTTFB:n})=>{e(Po),t(Po),r(Po),s(Po),n(Po)}).catch(()=>{}),"serviceWorker"in navigator&&(window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{console.log("Service Worker registered:",e.scope),setInterval(()=>{e.update()},3e4)}).catch(e=>{console.log("Service Worker registration failed:",e)})}),navigator.serviceWorker.addEventListener("message",e=>{e.data&&"CACHE_UPDATED"===e.data.type&&(console.log("Cache updated, reloading page for fresh content..."),setTimeout(()=>{window.location.reload()},1e3))}));const Co=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{Ai as A,Ni as B,Mi as F,Wt as H,Ui as I,Fi as L,Di as T,ke as _,Ii as a,Ri as b,Jt as c,ar as d,Li as e,zi as f,Oi as g,Ei as l,wi as s,or as t,Si as u};
