import{j as e}from"./vendor-ui-8934955f.js";import{r as s}from"./vendor-react-c35372bd.js";import{D as a,a as r,b as l,c as t,d as i}from"./dialog-f70f7e7c.js";import{a as n,b as c,B as o,t as d,s as m}from"./index-05934966.js";import{z as x,Z as h,L as u,a as p}from"./vendor-utils-1c9b7ece.js";const y=({open:y,onOpenChange:j,plan:f,billingCycle:b="monthly"})=>{var g,N;const{user:w}=n(),[v,C]=s.useState(!1);if(!f)return null;const P="yearly"===b?f.price_yearly:f.price_monthly;"yearly"===b?f.price_yearly:f.price_monthly;const k="yearly"===b?12*f.price_monthly-f.price_yearly:0;return e.jsx(a,{open:y,onOpenChange:j,children:e.jsxs(r,{className:"glass-effect custom-scrollbar max-w-[95vw] sm:max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs(l,{children:[e.jsxs(t,{className:"flex items-center gap-2 text-base sm:text-lg",children:[e.jsx(x,{className:"w-4 h-4 sm:w-5 sm:h-5","aria-hidden":"true"}),"Checkout"]}),e.jsx(i,{className:"text-sm",children:"Complete your subscription purchase"})]}),e.jsxs("div",{className:"space-y-6 min-w-0 max-w-full",children:[e.jsxs("div",{className:"p-4 rounded-lg border border-border bg-background/50",role:"region","aria-label":"Plan summary",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-2 mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-bold",children:f.name}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:f.description})]}),f.is_popular&&e.jsx(c,{className:"bg-primary/20 text-primary self-start",children:"Popular"})]}),e.jsxs("div",{className:"space-y-2 pt-4 border-t border-border",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Billing Cycle:"}),e.jsx("span",{className:"font-semibold capitalize",children:b})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Price:"}),e.jsxs("span",{className:"font-semibold",children:["$",P.toFixed(2),"/","yearly"===b?"year":"month"]})]}),"yearly"===b&&k>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-400",children:[e.jsx("span",{children:"You Save:"}),e.jsxs("span",{className:"font-semibold",children:["$",k.toFixed(2),"/year"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"What's included:"}),e.jsxs("ul",{className:"space-y-2",children:[null==(g=f.features)?void 0:g.slice(0,5).map((s,a)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(h,{className:"w-4 h-4 text-green-400 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:s})]},a)),(null==(N=f.features)?void 0:N.length)>5&&e.jsxs("li",{className:"text-sm text-text-secondary",children:["+ ",f.features.length-5," more features"]})]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-primary/10 border border-primary/20",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold",children:"Total Due Today:"}),e.jsxs("span",{className:"text-2xl font-bold",children:["$",P.toFixed(2)]})]}),"yearly"===b&&e.jsxs("p",{className:"text-xs text-text-secondary mt-2",children:["Billed annually ($",(P/12).toFixed(2),"/month)"]})]}),e.jsxs("div",{className:"space-y-3 min-w-0",children:[e.jsx(o,{onClick:async()=>{var e,s;if(w){C(!0);try{const{data:{session:e}}=await m.auth.getSession();if(!e)throw new Error("Authentication session not found");const{data:s,error:a}=await m.functions.invoke("create-checkout-session",{body:{planId:f.id,billingCycle:b,successUrl:`${window.location.origin}/app/user?payment=success`,cancelUrl:`${window.location.origin}/pricing?payment=cancelled`}});if(a)throw a;if(!(null==s?void 0:s.url))throw new Error("No checkout URL returned");window.location.href=s.url}catch(a){let r="An error occurred during checkout";(null==(e=a.message)?void 0:e.includes("not configured"))||(null==(s=a.message)?void 0:s.includes("STRIPE_SECRET_KEY"))?r="Payment system is not configured yet. Please contact support.":a.message&&(r=a.message),d({title:"Payment Failed",description:r,variant:"destructive"}),C(!1)}}else d({title:"Not Logged In",description:"Please log in to purchase a subscription",variant:"destructive"})},disabled:v,className:"w-full min-w-0 h-11 sm:h-12 text-base","aria-label":v?"Processing payment":"Complete purchase",children:v?e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"w-4 h-4 mr-2 animate-spin","aria-hidden":"true"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Complete Purchase"]})}),e.jsx(o,{onClick:()=>j(!1),disabled:v,variant:"outline",className:"w-full min-w-0 h-11 sm:h-12 text-base","aria-label":"Cancel checkout",children:"Cancel"})]}),e.jsxs("div",{className:"text-center text-xs text-text-secondary",role:"note",children:[e.jsx(p,{className:"w-3 h-3 inline mr-1","aria-hidden":"true"}),"Secure payment powered by Stripe"]})]})]})})};export{y as C};
