import{j as e}from"./vendor-ui-8934955f.js";import{r as t}from"./vendor-react-c35372bd.js";import{C as s}from"./card-5ef2c077.js";import{s as a,_ as n,a as i,L as r,T as l,B as d,t as o,r as c,m as x,p as m,q as u,v as h}from"./index-05934966.js";import{T as p,a as y,b as j,c as g}from"./tabs-2a9eaf96.js";import{i as v,x as f,ai as b,F as N,aP as w,R as _,at as S,z as F,au as C,aA as T}from"./vendor-utils-1c9b7ece.js";import{D as $,a as D,b as z,c as M,d as R}from"./dialog-f70f7e7c.js";import"./vendor-editor-7586347a.js";let q=null;const P=async e=>{var t,s;try{const{data:i,error:r}=await a.from("invoices").select("\n        *,\n        subscription_plans (name, description),\n        payment_transactions (payment_method, payment_intent_id)\n      ").eq("id",e).single();if(r)throw r;if(!i)throw new Error("Invoice not found");const l=new(await(async()=>{if(!q){const e=(await n(()=>import("./jspdf.es.min-65ebe7c7.js").then(e=>e.j),["assets/jspdf.es.min-65ebe7c7.js","assets/index-05934966.js","assets/vendor-ui-8934955f.js","assets/vendor-react-c35372bd.js","assets/vendor-utils-1c9b7ece.js","assets/vendor-editor-7586347a.js","assets/index-4c36fa54.css"])).default;await n(()=>import("./jspdf.plugin.autotable-4de48128.js"),[]),q=e}return q})()),d=l.internal.pageSize.getWidth(),o=l.internal.pageSize.getHeight(),c=[34,197,94],x=[17,24,39],m=[156,163,175];l.setFontSize(24),l.setTextColor(...c),l.setFont(void 0,"bold"),l.text("GreenoFig",20,25),l.setFontSize(10),l.setTextColor(...m),l.setFont(void 0,"normal"),l.text("AI-Powered Health & Wellness",20,32),l.text("support@greenofig.com",20,37),l.setFontSize(20),l.setTextColor(...x),l.setFont(void 0,"bold"),l.text("INVOICE",d-20,25,{align:"right"}),l.setFontSize(10),l.setFont(void 0,"normal"),l.setTextColor(...x);let u=35;l.text(`Invoice #: ${i.invoice_number}`,d-20,u,{align:"right"}),u+=5,l.text(`Issue Date: ${v(new Date(i.issue_date),"MMM dd, yyyy")}`,d-20,u,{align:"right"}),u+=5,l.text(`Due Date: ${v(new Date(i.due_date),"MMM dd, yyyy")}`,d-20,u,{align:"right"}),u+=5;const h={draft:[156,163,175],sent:[59,130,246],paid:[34,197,94],void:[239,68,68],refunded:[251,146,60]},p=h[i.status]||h.draft;if(l.setFillColor(...p),l.setTextColor(255,255,255),l.roundedRect(d-50,u-3,30,6,2,2,"F"),l.text(i.status.toUpperCase(),d-35,u+1,{align:"center"}),u+=15,l.setDrawColor(...m),l.line(20,u,d-20,u),u+=10,l.setFontSize(12),l.setTextColor(...x),l.setFont(void 0,"bold"),l.text("Bill To:",20,u),u+=7,l.setFontSize(10),l.setFont(void 0,"normal"),l.text(i.billing_name||"Customer",20,u),i.billing_email&&(u+=5,l.text(i.billing_email,20,u)),i.billing_address&&Object.keys(i.billing_address).length>0){const e=i.billing_address;if(e.line1&&(u+=5,l.text(e.line1,20,u)),e.city||e.state||e.postal_code){u+=5;const t=[e.city,e.state,e.postal_code].filter(Boolean).join(", ");l.text(t,20,u)}e.country&&(u+=5,l.text(e.country,20,u))}u+=15;const y=[];if(i.line_items&&i.line_items.length>0)i.line_items.forEach(e=>{y.push([e.description||"Service",e.quantity||1,`$${(e.unit_price||0).toFixed(2)}`,`$${(e.amount||0).toFixed(2)}`])});else{const e=(null==(t=i.subscription_plans)?void 0:t.name)||"Subscription",a=(null==(s=i.subscription_plans)?void 0:s.description)||"";y.push([`${e}\n${a}`,1,`$${i.subtotal.toFixed(2)}`,`$${i.subtotal.toFixed(2)}`])}l.autoTable({startY:u,head:[["Description","Qty","Unit Price","Amount"]],body:y,theme:"striped",headStyles:{fillColor:c,textColor:[255,255,255],fontStyle:"bold",fontSize:10},bodyStyles:{fontSize:9,textColor:x},alternateRowStyles:{fillColor:[249,250,251]},columnStyles:{0:{cellWidth:90},1:{cellWidth:20,halign:"center"},2:{cellWidth:35,halign:"right"},3:{cellWidth:35,halign:"right"}},margin:{left:20,right:20}}),u=l.lastAutoTable.finalY+10;const j=d-80;if(l.setFontSize(10),l.setFont(void 0,"normal"),l.setTextColor(...x),l.text("Subtotal:",j,u),l.text(`$${i.subtotal.toFixed(2)}`,d-20,u,{align:"right"}),i.discount_amount>0&&(u+=6,l.setTextColor(...h.paid),l.text("Discount:",j,u),l.text(`-$${i.discount_amount.toFixed(2)}`,d-20,u,{align:"right"}),l.setTextColor(...x)),i.tax_amount>0&&(u+=6,l.text(`Tax (${i.tax_rate}%):`,j,u),l.text(`$${i.tax_amount.toFixed(2)}`,d-20,u,{align:"right"})),u+=2,l.setDrawColor(...m),l.line(j,u,d-20,u),u+=8,l.setFontSize(12),l.setFont(void 0,"bold"),l.text("Total:",j,u),l.text(`$${i.amount.toFixed(2)} ${i.currency}`,d-20,u,{align:"right"}),i.payment_transactions&&(u+=10,l.setFontSize(9),l.setFont(void 0,"normal"),l.setTextColor(...m),l.text(`Payment Method: ${i.payment_transactions.payment_method||"N/A"}`,j,u),i.payment_transactions.payment_intent_id&&(u+=4,l.text(`Transaction ID: ${i.payment_transactions.payment_intent_id}`,j,u))),i.notes){u+=15,l.setFontSize(10),l.setTextColor(...x),l.setFont(void 0,"bold"),l.text("Notes:",20,u),u+=5,l.setFont(void 0,"normal"),l.setFontSize(9);const e=l.splitTextToSize(i.notes,d-40);l.text(e,20,u)}const g=o-20;return l.setFontSize(8),l.setTextColor(...m),l.setFont(void 0,"italic"),l.text("Thank you for your business!",d/2,g,{align:"center"}),l.text("This is a computer-generated invoice.",d/2,g+4,{align:"center"}),l}catch(i){throw i}},E=({open:s,onOpenChange:a,transaction:n,onSuccess:x})=>{var m;const{user:u}=i(),[h,p]=t.useState(""),[y,j]=t.useState(""),[g,v]=t.useState(!1);if(!n)return null;return e.jsx($,{open:s,onOpenChange:a,children:e.jsxs(D,{className:"glass-effect custom-scrollbar max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs(z,{children:[e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5"}),"Request Refund"]}),e.jsx(R,{children:"Submit a refund request for this transaction. Our team will review it within 1-2 business days."})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),h.trim()){v(!0);try{await c({userId:u.id,paymentTransactionId:n.id,amount:n.amount,reason:h,refundType:"full",customerNotes:y.trim()||null}),o({title:"Refund Requested",description:"Your refund request has been submitted and is pending review"}),a(!1),p(""),j(""),x&&x()}catch(t){o({title:"Error",description:"Failed to submit refund request. Please try again.",variant:"destructive"})}finally{v(!1)}}else o({title:"Error",description:"Please select a reason for the refund",variant:"destructive"})},className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg border border-border",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Transaction Amount"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",n.amount]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Date"}),e.jsx("p",{className:"text-sm font-medium",children:new Date(n.created_at).toLocaleDateString()})]})]}),(null==(m=n.subscription_plans)?void 0:m.name)&&e.jsxs("p",{className:"text-sm text-text-secondary",children:["Plan: ",n.subscription_plans.name]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Reason for Refund *"}),e.jsxs("select",{value:h,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-primary min-h-[44px]",style:{fontSize:"16px"},required:!0,children:[e.jsx("option",{value:"",children:"Select a reason..."}),["Product not as described","Technical issues","Changed my mind","Found a better alternative","Too expensive","Not using the service","Billing error","Other"].map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Additional Notes (Optional)"}),e.jsx(l,{value:y,onChange:e=>j(e.target.value),placeholder:"Provide any additional details about your refund request...",rows:4,className:"resize-none"})]}),e.jsxs("div",{className:"flex gap-3 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:[e.jsx(b,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Please Note:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Refunds are reviewed within 1-2 business days"}),e.jsx("li",{children:"Refunds typically take 5-10 business days to appear in your account"}),e.jsx("li",{children:"Your subscription will be cancelled if the refund is approved"})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:g,className:"flex-1",children:"Cancel"}),e.jsx(d,{type:"submit",disabled:g,className:"flex-1",children:g?"Submitting...":"Submit Request"})]})]})]})})},I=()=>{const{user:n}=i(),[r,l]=t.useState([]),[c,$]=t.useState([]),[D,z]=t.useState([]),[M,R]=t.useState([]),[q,I]=t.useState(!0),[k,A]=t.useState(!1),[O,W]=t.useState(null);t.useEffect(()=>{n&&B()},[n]);const B=async()=>{I(!0);try{const e=await(async e=>{try{const{data:t,error:s}=await a.from("invoices").select("\n        *,\n        subscription_plans (name),\n        payment_transactions (status, payment_method)\n      ").eq("user_id",e).order("created_at",{ascending:!1});if(s)throw s;return t||[]}catch(t){return[]}})(n.id);l(e);const t=await x(n.id);$(t);const s=await m(n.id);z(s);const{data:i}=await a.from("payment_transactions").select("\n          *,\n          subscription_plans (name)\n        ").eq("user_id",n.id).order("created_at",{ascending:!1});R(i||[])}catch(e){o({title:"Error",description:"Failed to load billing information",variant:"destructive"})}finally{I(!1)}},L=async e=>{try{await(async e=>{try{const t=await P(e),{data:s}=await a.from("invoices").select("invoice_number").eq("id",e).single(),n=`${(null==s?void 0:s.invoice_number)||"invoice"}.pdf`;t.save(n)}catch(t){throw t}})(e),o({title:"Success",description:"Invoice downloaded successfully"})}catch(t){o({title:"Error",description:"Failed to download invoice",variant:"destructive"})}},V=({status:t})=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${{succeeded:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",failed:"bg-red-100 text-red-800",refunded:"bg-gray-100 text-gray-800",canceled:"bg-gray-100 text-gray-800",approved:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"}[t]||"bg-gray-100 text-gray-800"}`,children:t});return q?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full"})}):e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Billing & Invoices"}),e.jsx("p",{className:"text-text-secondary mt-1",children:"Manage your payments, invoices, and subscription"})]}),e.jsxs(p,{defaultValue:"invoices",children:[e.jsxs(y,{className:"grid w-full grid-cols-4",children:[e.jsx(j,{value:"invoices",children:"Invoices"}),e.jsx(j,{value:"transactions",children:"Transactions"}),e.jsx(j,{value:"payment-methods",children:"Payment Methods"}),e.jsx(j,{value:"refunds",children:"Refunds"})]}),e.jsx(g,{value:"invoices",className:"space-y-4",children:0===r.length?e.jsxs(s,{className:"p-12 text-center",children:[e.jsx(N,{className:"w-12 h-12 mx-auto text-text-secondary mb-4"}),e.jsx("p",{className:"text-text-secondary",children:"No invoices yet"})]}):e.jsx("div",{className:"space-y-3",children:r.map(t=>e.jsx(s,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-lg",children:e.jsx(N,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:t.invoice_number}),e.jsx("p",{className:"text-sm text-text-secondary",children:v(new Date(t.issue_date),"MMM dd, yyyy")})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold",children:["$",t.amount]}),e.jsx(V,{status:t.status})]}),e.jsxs(d,{onClick:()=>L(t.id),variant:"outline",size:"sm",children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Download"]})]})]})},t.id))})}),e.jsx(g,{value:"transactions",className:"space-y-4",children:0===M.length?e.jsxs(s,{className:"p-12 text-center",children:[e.jsx(f,{className:"w-12 h-12 mx-auto text-text-secondary mb-4"}),e.jsx("p",{className:"text-text-secondary",children:"No transactions yet"})]}):e.jsx("div",{className:"space-y-3",children:M.map(t=>{var a;return e.jsx(s,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-lg "+("succeeded"===t.status?"bg-green-100":"failed"===t.status?"bg-red-100":"bg-gray-100"),children:"succeeded"===t.status?e.jsx(_,{className:"w-6 h-6 text-green-600"}):"failed"===t.status?e.jsx(S,{className:"w-6 h-6 text-red-600"}):e.jsx(b,{className:"w-6 h-6 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:(null==(a=t.subscription_plans)?void 0:a.name)||"Payment"}),e.jsx("p",{className:"text-sm text-text-secondary",children:v(new Date(t.created_at),"MMM dd, yyyy")}),t.payment_intent_id&&e.jsxs("p",{className:"text-xs text-text-secondary mt-1",children:["ID: ",t.payment_intent_id]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold",children:["$",t.amount]}),e.jsx(V,{status:t.status})]}),"succeeded"===t.status&&!t.is_refunded&&e.jsx(d,{onClick:()=>(e=>{W(e),A(!0)})(t),variant:"outline",size:"sm",children:"Request Refund"})]})]})},t.id)})})}),e.jsx(g,{value:"payment-methods",className:"space-y-4",children:0===c.length?e.jsxs(s,{className:"p-12 text-center",children:[e.jsx(F,{className:"w-12 h-12 mx-auto text-text-secondary mb-4"}),e.jsx("p",{className:"text-text-secondary mb-4",children:"No payment methods added"}),e.jsxs(d,{children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Add Payment Method"]})]}):e.jsxs("div",{className:"space-y-3",children:[c.map(t=>{var a;return e.jsx(s,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-lg",children:e.jsx(F,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold",children:[null==(a=t.card_brand)?void 0:a.toUpperCase()," •••• ",t.card_last4]}),e.jsxs("p",{className:"text-sm text-text-secondary",children:["Expires ",t.card_exp_month,"/",t.card_exp_year]}),t.is_default&&e.jsx("span",{className:"text-xs bg-primary/20 text-primary px-2 py-0.5 rounded-full mt-1 inline-block",children:"Default"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[!t.is_default&&e.jsx(d,{onClick:()=>(async e=>{try{await u(n.id,e),await B(),o({title:"Success",description:"Default payment method updated"})}catch(t){o({title:"Error",description:"Failed to update payment method",variant:"destructive"})}})(t.id),variant:"outline",size:"sm",children:"Set as Default"}),e.jsx(d,{onClick:()=>(async e=>{try{await h(n.id,e),await B(),o({title:"Success",description:"Payment method removed"})}catch(t){o({title:"Error",description:"Failed to remove payment method",variant:"destructive"})}})(t.id),variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700",children:e.jsx(T,{className:"w-4 h-4"})})]})]})},t.id)}),e.jsxs(d,{className:"w-full",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Add New Payment Method"]})]})}),e.jsx(g,{value:"refunds",className:"space-y-4",children:0===D.length?e.jsxs(s,{className:"p-12 text-center",children:[e.jsx(f,{className:"w-12 h-12 mx-auto text-text-secondary mb-4"}),e.jsx("p",{className:"text-text-secondary",children:"No refund requests"})]}):e.jsx("div",{className:"space-y-3",children:D.map(t=>e.jsx(s,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-lg",children:e.jsx(f,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Refund Request"}),e.jsx("p",{className:"text-sm text-text-secondary",children:v(new Date(t.requested_at),"MMM dd, yyyy")}),t.reason&&e.jsxs("p",{className:"text-sm text-text-secondary mt-1",children:["Reason: ",t.reason]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold",children:["$",t.amount]}),e.jsx(V,{status:t.status}),"completed"===t.status&&t.completed_at&&e.jsxs("p",{className:"text-xs text-text-secondary mt-1",children:["Completed ",v(new Date(t.completed_at),"MMM dd")]})]})]})},t.id))})})]}),e.jsx(E,{open:k,onOpenChange:A,transaction:O,onSuccess:B})]})};export{I as default};
