import{j as e}from"./vendor-ui-8934955f.js";import{f as t,r,u as n,R as s}from"./vendor-react-c35372bd.js";import{j as i,c as a,B as o,a as l,L as c,I as d,s as u,t as h,T as f,k as p,m,b as g,n as x,d as y,u as v,H as w}from"./index-05934966.js";import{C as _,a as b,b as N,c as j,e as C}from"./card-5ef2c077.js";import{D as A,e as S,a as E,b as I,c as T,d as D}from"./dialog-f70f7e7c.js";import{_ as O,X as R,O as k,G as M,bx as P,by as B,bz as F,bA as L,bB as U,D as V,bC as H,bD as G,au as W,bE as z,a3 as X,al as Y,S as q,ax as K,k as Z,bd as $,ai as Q,ba as J,aj as ee,br as te,L as re,z as ne,x as se,v as ie,Z as ae,at as oe,bF as le,bG as ce,R as de,bH as ue,ao as he,bI as fe,aO as pe,bJ as me,bK as ge,ad as xe,H as ye,aV as ve,u as we,aB as _e,a5 as be,af as Ne,ag as je,ah as Ce,aa as Ae,ab as Se,a6 as Ee,a7 as Ie,a8 as Te,a9 as De,ac as Oe,aS as Re,aT as ke,a4 as Me,bL as Pe,T as Be,az as Fe,aA as Le,av as Ue,V as Ve,B as He,ay as Ge,bM as We,d as ze,bN as Xe,bO as Ye,aR as qe,bP as Ke,bQ as Ze,aQ as $e,F as Qe,aP as Je,bR as et,bS as tt,bT as rt,bU as nt,bV as st,b8 as it,b9 as at,M as ot,bW as lt,ak as ct,g as dt,bX as ut,U as ht,bl as ft,a2 as pt,b as mt,m as gt,bg as xt,a as yt,b4 as vt,ae as wt,as as _t,bY as bt,bZ as Nt,b_ as jt}from"./vendor-utils-1c9b7ece.js";import{Q as Ct}from"./QuickLogMeal-f5a50606.js";import{S as At,a as St,b as Et,c as It,d as Tt}from"./select-b96110db.js";import{T as Dt,a as Ot,b as Rt,c as kt}from"./tabs-2a9eaf96.js";import{A as Mt,a as Pt,b as Bt,c as Ft,d as Lt,e as Ut,f as Vt,g as Ht}from"./alert-dialog-a0463d92.js";import{A as Gt}from"./AdContainer-25659e4c.js";import{A as Wt,a as zt,P as Xt}from"./progress-4bfc6d82.js";import{S as Yt}from"./switch-6cba4f79.js";import qt from"./MessagingCenter-0ba46e90.js";import{C as Kt}from"./checkbox-50f8b8bc.js";const Zt=({placementName:n="after_ai_generation",onClose:s,showAfterSeconds:l=0,forceCountdown:c=3,className:d=""})=>{const u=t(),{hasAds:h,fetchCampaignForPlacement:f,trackImpression:p,trackClick:m,dismissAd:g}=i(),[x,y]=r.useState(null),[v,w]=r.useState(null),[_,b]=r.useState(!1),[N,j]=r.useState(c),[C,A]=r.useState(0===c),[S,E]=r.useState(!0),I=r.useRef(null);r.useEffect(()=>((async()=>{if(!h)return E(!1),void(s&&s());const e=await f(n);y(e),E(!1),e?setTimeout(()=>b(!0),1e3*l):s&&s()})(),()=>{I.current&&clearInterval(I.current)}),[h,n,f,l,s]),r.useEffect(()=>{if(!_||!x||v)return;(async()=>{const e=await p(x.id,x.placement_id,u.pathname);w(e)})(),c>0&&(I.current=setInterval(()=>{j(e=>e<=1?(clearInterval(I.current),A(!0),0):e-1)},1e3))},[_,x,v,p,u.pathname,c]);const T=async()=>{C&&(x&&await g(x.id),b(!1),s&&s())};return h&&!S&&x&&_?e.jsx("div",{className:a("fixed inset-0 z-[9999] flex items-center justify-center","bg-black/80 backdrop-blur-sm","animate-in fade-in duration-300",d),children:e.jsxs("div",{className:"relative w-full max-w-2xl mx-4",children:[e.jsxs("div",{className:"absolute -top-12 right-0 flex items-center gap-2",children:[!C&&e.jsxs("div",{className:"flex items-center gap-1 text-white/80 text-sm",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsxs("span",{children:["Close in ",N,"s"]})]}),e.jsxs("button",{onClick:T,disabled:!C,className:a("flex items-center gap-1 px-3 py-1.5 rounded-lg transition-all",C?"bg-white/20 hover:bg-white/30 text-white cursor-pointer":"bg-white/10 text-white/50 cursor-not-allowed"),children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Close"})]})]}),e.jsxs("div",{className:"bg-card rounded-2xl shadow-2xl overflow-hidden",style:{backgroundColor:x.background_color||void 0,color:x.text_color||void 0},children:[e.jsx("div",{className:"bg-primary/10 px-4 py-2 border-b border-border",children:e.jsx("span",{className:"text-xs uppercase tracking-wider text-primary font-medium",children:"Sponsored Content"})}),e.jsxs("div",{className:"p-8",children:[x.image_url&&e.jsx("div",{className:"mb-6",children:e.jsx("img",{src:x.image_url,alt:x.title,className:"w-full h-48 object-cover rounded-xl"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-3",children:x.title}),x.subtitle&&e.jsx("p",{className:"text-lg text-text-secondary mb-4",children:x.subtitle}),x.body_text&&e.jsx("p",{className:"text-base text-text-secondary mb-6 max-w-lg mx-auto",children:x.body_text}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs(o,{size:"lg",onClick:async()=>{x&&(await m(x.id,null==v?void 0:v.id,u.pathname),x.cta_url&&(x.cta_url.startsWith("/")?window.location.href=x.cta_url:window.open(x.cta_url,"_blank","noopener,noreferrer")))},className:"bg-primary hover:bg-primary/90 gap-2 px-8",children:[x.cta_text,e.jsx(k,{className:"w-5 h-5"})]}),C&&e.jsx(o,{size:"lg",variant:"outline",onClick:T,className:"px-8",children:"Continue to App"})]})]}),x.advertiser_name&&e.jsx("div",{className:"mt-6 pt-4 border-t border-border text-center",children:e.jsxs("span",{className:"text-xs text-text-secondary",children:["Advertisement by ",x.advertiser_name]})})]})]})]})}):null},$t=({placementName:n="rewarded_video",onClose:s,onRewardEarned:l,rewardDescription:c="Get +1 bonus AI message",className:d=""})=>{const u=t(),{hasAds:h,fetchCampaignForPlacement:f,trackImpression:p,trackClick:m}=i(),[g,x]=r.useState(null),[y,v]=r.useState(null),[w,_]=r.useState(!1),[b,N]=r.useState(!0),[j,C]=r.useState(!1),[A,S]=r.useState(!0),[E,I]=r.useState(0),[T,D]=r.useState(0),[k,U]=r.useState(!1),[V,H]=r.useState(!1),G=r.useRef(null),W=r.useRef(null);r.useEffect(()=>((async()=>{if(!h)return void N(!1);const e=await f(n);x(e),N(!1),e&&_(!0)})(),()=>{W.current&&clearInterval(W.current)}),[h,n,f]),r.useEffect(()=>{if(!w||!g||y)return;(async()=>{const e=await p(g.id,g.placement_id,u.pathname);v(e)})()},[w,g,y,p,u.pathname]);const z=()=>{if(!G.current)return;const e=G.current,t=e.currentTime/e.duration*100;I(t),D(Math.ceil(e.duration-e.currentTime)),t>=95&&!k&&(U(!0),W.current&&clearInterval(W.current))};return h&&!b&&g&&w?e.jsx("div",{className:a("fixed inset-0 z-[9999] flex items-center justify-center","bg-black/90 backdrop-blur-sm","animate-in fade-in duration-300",d),children:e.jsxs("div",{className:"relative w-full max-w-4xl mx-4",children:[e.jsxs("div",{className:"absolute -top-16 left-0 right-0 flex items-center justify-between text-white",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-yellow-400"}),e.jsx("span",{className:"font-medium",children:c})]}),!k&&T>0&&e.jsxs("div",{className:"flex items-center gap-1 text-white/80",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsxs("span",{children:[T,"s remaining"]})]})]}),e.jsxs("div",{className:"relative bg-black rounded-2xl overflow-hidden shadow-2xl",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 bg-gradient-to-b from-black/60 to-transparent p-4 z-10",children:e.jsx("span",{className:"text-xs uppercase tracking-wider text-white/80 font-medium",children:"Sponsored Video â€¢ Watch to Earn Reward"})}),g.video_url?e.jsx("video",{ref:G,src:g.video_url,className:"w-full aspect-video",muted:A,playsInline:!0,onEnded:()=>{C(!1),U(!0),W.current&&clearInterval(W.current)},onTimeUpdate:z}):e.jsx("div",{className:"w-full aspect-video bg-gradient-to-br from-primary/20 to-green-500/20 flex items-center justify-center",children:g.image_url?e.jsx("img",{src:g.image_url,alt:g.title,className:"w-full h-full object-cover"}):e.jsxs("div",{className:"text-center p-8",children:[e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:g.title}),e.jsx("p",{className:"text-white/80",children:g.subtitle})]})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-white/20",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-100",style:{width:`${E}%`}})}),e.jsxs("div",{className:"absolute bottom-4 left-4 right-4 flex items-center justify-between z-10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[!j&&!k&&e.jsxs(o,{size:"lg",onClick:async()=>{if(G.current)try{const e=G.current.play();void 0!==e&&await e,C(!0),W.current=setInterval(()=>{G.current&&z()},100)}catch(e){C(!1)}},className:"bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white gap-2",children:[e.jsx(P,{className:"w-5 h-5"}),"Play Video"]}),j&&e.jsx("button",{onClick:async()=>{if(G.current)if(j)G.current.pause(),C(!1);else try{const e=G.current.play();void 0!==e&&await e,C(!0)}catch(e){C(!1)}},className:"p-3 bg-white/20 hover:bg-white/30 backdrop-blur-sm rounded-full text-white transition-colors",children:j?e.jsx(B,{className:"w-5 h-5"}):e.jsx(P,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>{G.current&&(G.current.muted=!A,S(!A))},className:"p-3 bg-white/20 hover:bg-white/30 backdrop-blur-sm rounded-full text-white transition-colors",children:A?e.jsx(F,{className:"w-5 h-5"}):e.jsx(L,{className:"w-5 h-5"})})]}),k&&!V&&e.jsxs(o,{size:"lg",onClick:async()=>{k&&!V&&(g&&await m(g.id,null==y?void 0:y.id,u.pathname),H(!0),l&&l())},className:"bg-yellow-500 hover:bg-yellow-600 text-black font-bold gap-2 animate-pulse",children:[e.jsx(M,{className:"w-5 h-5"}),"Claim Your Reward!"]}),V&&e.jsx("div",{className:"bg-green-500/90 text-white px-6 py-3 rounded-lg font-bold",children:"âœ“ Reward Claimed!"})]})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsx("div",{className:"text-white/60 text-sm",children:g.advertiser_name&&e.jsxs("span",{children:["Ad by ",g.advertiser_name]})}),e.jsxs(o,{variant:"ghost",onClick:()=>{W.current&&clearInterval(W.current),_(!1),s&&s(V)},className:"text-white/80 hover:text-white hover:bg-white/10",children:[k?"Close":"Skip (No Reward)",e.jsx(R,{className:"w-4 h-4 ml-2"})]})]})]})}):null},Qt=({onSuccess:t})=>{const{userProfile:n}=l(),[s,i]=r.useState(!1),[a,f]=r.useState(!1),[p,m]=r.useState({weight_kg:(null==n?void 0:n.weight_kg)||"",body_fat_percentage:"",date:(new Date).toISOString().split("T")[0]});return e.jsxs(A,{open:s,onOpenChange:i,children:[e.jsx(S,{asChild:!0,children:e.jsxs(o,{className:"w-full h-12 min-h-[44px] text-sm sm:text-base",children:[e.jsx(U,{className:"w-4 h-4 sm:w-5 sm:h-5 mr-2"}),e.jsx("span",{className:"truncate",children:"Log Weight"})]})}),e.jsxs(E,{className:"glass-effect custom-scrollbar sm:max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsx(I,{children:e.jsx(T,{children:"Log Your Weight"})}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),f(!0);try{const e=p.date,{data:r}=await u.from("daily_metrics").select("*").eq("user_id",n.id).eq("date",e).single();if(r){const{error:e}=await u.from("daily_metrics").update({weight_kg:parseFloat(p.weight_kg),body_fat_percentage:p.body_fat_percentage?parseFloat(p.body_fat_percentage):null}).eq("id",r.id);if(e)throw e}else{const{error:t}=await u.from("daily_metrics").insert({user_id:n.id,date:e,weight_kg:parseFloat(p.weight_kg),body_fat_percentage:p.body_fat_percentage?parseFloat(p.body_fat_percentage):null});if(t)throw t}await u.from("user_profiles").update({weight_kg:parseFloat(p.weight_kg)}).eq("id",n.id),await u.from("activity_feed").insert({user_id:n.id,activity_type:"weight_update",activity_title:"Weight Updated",activity_description:`Logged weight: ${p.weight_kg} kg`,metadata:{weight_kg:parseFloat(p.weight_kg)}}),await u.rpc("update_user_streak",{p_user_id:n.id,p_streak_type:"weight_log",p_activity_date:e}),h({title:"Weight Logged!",description:`Successfully logged ${p.weight_kg} kg`}),i(!1),t&&t()}catch(r){h({title:"Error",description:"Failed to log weight. Please try again.",variant:"destructive"})}finally{f(!1)}},className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx(c,{htmlFor:"date",className:"text-sm sm:text-base",children:"Date"}),e.jsx(d,{id:"date",type:"date",value:p.date,onChange:e=>m({...p,date:e.target.value}),max:(new Date).toISOString().split("T")[0],required:!0,className:"mt-1.5 w-full min-w-0"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"weight",className:"text-sm sm:text-base",children:"Weight (kg) *"}),e.jsx(d,{id:"weight",type:"number",step:"0.1",placeholder:"70.5",value:p.weight_kg,onChange:e=>m({...p,weight_kg:e.target.value}),required:!0,className:"mt-1.5"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"body_fat",className:"text-sm sm:text-base",children:"Body Fat % (optional)"}),e.jsx(d,{id:"body_fat",type:"number",step:"0.1",placeholder:"18.5",value:p.body_fat_percentage,onChange:e=>m({...p,body_fat_percentage:e.target.value}),className:"mt-1.5"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>i(!1),className:"flex-1 h-12 min-h-[44px] text-sm sm:text-base",children:"Cancel"}),e.jsx(o,{type:"submit",disabled:a,className:"flex-1 h-12 min-h-[44px] text-sm sm:text-base",children:a?"Logging...":"Log Weight"})]})]})]})]})},Jt=({onSuccess:t})=>{const{userProfile:n}=l(),[s,i]=r.useState(!1),[a,p]=r.useState(!1),[m,g]=r.useState({workout_name:"",workout_type:"cardio",duration_minutes:"",calories_burned:"",intensity:"moderate",notes:"",feeling:"good",date:(new Date).toISOString().split("T")[0]});return e.jsxs(A,{open:s,onOpenChange:i,children:[e.jsx(S,{asChild:!0,children:e.jsxs(o,{className:"w-full",children:[e.jsx(V,{className:"w-10 h-10 mr-2",strokeWidth:3}),"Log Workout"]})}),e.jsxs(E,{className:"glass-effect custom-scrollbar sm:max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsx(I,{children:e.jsx(T,{children:"Log Your Workout"})}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),p(!0);try{const e={user_id:n.id,workout_name:m.workout_name,workout_type:m.workout_type,duration_minutes:parseInt(m.duration_minutes),calories_burned:m.calories_burned?parseInt(m.calories_burned):null,intensity:m.intensity,notes:m.notes,feeling:m.feeling,date:m.date},{error:r}=await u.from("workout_logs").insert(e);if(r)throw r;const{data:s}=await u.from("daily_metrics").select("*").eq("user_id",n.id).eq("date",m.date).single(),a=((null==s?void 0:s.calories_burned)||0)+(m.calories_burned?parseInt(m.calories_burned):0),o=((null==s?void 0:s.active_minutes)||0)+parseInt(m.duration_minutes);s?await u.from("daily_metrics").update({calories_burned:a,active_minutes:o}).eq("id",s.id):await u.from("daily_metrics").insert({user_id:n.id,date:m.date,calories_burned:a,active_minutes:o}),await u.from("activity_feed").insert({user_id:n.id,activity_type:"completed_workout",activity_title:"Completed Workout",activity_description:m.workout_name,metadata:{duration:parseInt(m.duration_minutes),calories:m.calories_burned?parseInt(m.calories_burned):0}}),await u.rpc("update_user_streak",{p_user_id:n.id,p_streak_type:"workout",p_activity_date:m.date}),h({title:"Workout Logged!",description:`Great job completing ${m.workout_name}!`}),g({workout_name:"",workout_type:"cardio",duration_minutes:"",calories_burned:"",intensity:"moderate",notes:"",feeling:"good",date:(new Date).toISOString().split("T")[0]}),i(!1),t&&t()}catch(r){h({title:"Error",description:"Failed to log workout. Please try again.",variant:"destructive"})}finally{p(!1)}},className:"space-y-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx(c,{htmlFor:"date",children:"Date"}),e.jsx(d,{id:"date",type:"date",value:m.date,onChange:e=>g({...m,date:e.target.value}),max:(new Date).toISOString().split("T")[0],required:!0,className:"w-full min-w-0"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"workout_name",children:"Workout Name *"}),e.jsx(d,{id:"workout_name",placeholder:"e.g., Morning Run",value:m.workout_name,onChange:e=>g({...m,workout_name:e.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"workout_type",children:"Workout Type *"}),e.jsxs(At,{value:m.workout_type,onValueChange:e=>g({...m,workout_type:e}),children:[e.jsx(St,{children:e.jsx(Et,{})}),e.jsxs(It,{children:[e.jsx(Tt,{value:"cardio",children:"Cardio"}),e.jsx(Tt,{value:"strength",children:"Strength Training"}),e.jsx(Tt,{value:"yoga",children:"Yoga"}),e.jsx(Tt,{value:"sports",children:"Sports"}),e.jsx(Tt,{value:"hiit",children:"HIIT"}),e.jsx(Tt,{value:"pilates",children:"Pilates"}),e.jsx(Tt,{value:"swimming",children:"Swimming"}),e.jsx(Tt,{value:"cycling",children:"Cycling"}),e.jsx(Tt,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"duration",children:"Duration (minutes) *"}),e.jsx(d,{id:"duration",type:"number",placeholder:"30",value:m.duration_minutes,onChange:e=>g({...m,duration_minutes:e.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"calories",children:"Calories Burned"}),e.jsx(d,{id:"calories",type:"number",placeholder:"300",value:m.calories_burned,onChange:e=>g({...m,calories_burned:e.target.value})})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"intensity",children:"Intensity *"}),e.jsxs(At,{value:m.intensity,onValueChange:e=>g({...m,intensity:e}),children:[e.jsx(St,{children:e.jsx(Et,{})}),e.jsxs(It,{children:[e.jsx(Tt,{value:"light",children:"Light"}),e.jsx(Tt,{value:"moderate",children:"Moderate"}),e.jsx(Tt,{value:"intense",children:"Intense"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"feeling",children:"How did you feel?"}),e.jsxs(At,{value:m.feeling,onValueChange:e=>g({...m,feeling:e}),children:[e.jsx(St,{children:e.jsx(Et,{})}),e.jsxs(It,{children:[e.jsx(Tt,{value:"exhausted",children:"Exhausted"}),e.jsx(Tt,{value:"tired",children:"Tired"}),e.jsx(Tt,{value:"good",children:"Good"}),e.jsx(Tt,{value:"energized",children:"Energized"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"notes",children:"Notes (optional)"}),e.jsx(f,{id:"notes",placeholder:"How was your workout?",value:m.notes,onChange:e=>g({...m,notes:e.target.value}),rows:2})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>i(!1),className:"flex-1",children:"Cancel"}),e.jsx(o,{type:"submit",disabled:a,className:"flex-1",children:a?"Logging...":"Log Workout"})]})]})]})]})},er=({onSuccess:t})=>{const{userProfile:n}=l(),[s,i]=r.useState(0),[a,c]=r.useState(!1),d=250;r.useEffect(()=>{(null==n?void 0:n.id)&&f()},[null==n?void 0:n.id]);const f=async()=>{try{const e=(new Date).toISOString().split("T")[0],{data:t}=await u.from("daily_metrics").select("water_ml").eq("user_id",n.id).eq("date",e).single();t&&i(t.water_ml||0)}catch(e){}},p=async e=>{c(!0);try{const r=Math.max(0,s+e),a=(new Date).toISOString().split("T")[0],{data:o}=await u.from("daily_metrics").select("*").eq("user_id",n.id).eq("date",a).single();o?await u.from("daily_metrics").update({water_ml:r}).eq("id",o.id):await u.from("daily_metrics").insert({user_id:n.id,date:a,water_ml:r}),i(r),e>0&&(await u.from("activity_feed").insert({user_id:n.id,activity_type:"water_intake",activity_title:"Water Logged",activity_description:`Added ${e}ml of water`,metadata:{water_ml:e}}),await u.rpc("update_user_streak",{p_user_id:n.id,p_streak_type:"water_intake",p_activity_date:a})),t&&t()}catch(r){h({title:"Error",description:"Failed to update water intake.",variant:"destructive"})}finally{c(!1)}},m=Math.min(s/2e3*100,100),g=Math.floor(s/d);return e.jsxs(_,{className:"glass-effect h-full",children:[e.jsx(b,{className:"pb-2",children:e.jsxs(N,{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-blue-500"}),"Water Intake"]})}),e.jsxs(j,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-500",children:[s,"ml"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["/ ",2e3,"ml"]}),e.jsxs("div",{className:"text-xs text-muted-foreground ml-auto",children:[g," glasses"]})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-3",children:e.jsx("div",{className:"bg-blue-500 h-3 rounded-full transition-all duration-300 flex items-center justify-end pr-2",style:{width:`${m}%`},children:m>15&&e.jsxs("span",{className:"text-[10px] font-semibold text-white",children:[Math.round(m),"%"]})})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>p(-250),disabled:a||0===s,children:[e.jsx(G,{className:"w-4 h-4 mr-1"}),"Remove"]}),e.jsxs(o,{size:"sm",onClick:()=>p(d),disabled:a,className:"bg-blue-500 hover:bg-blue-600",children:[e.jsx(W,{className:"w-4 h-4 mr-1"}),"Add Glass"]})]}),e.jsxs("div",{className:"text-xs text-center text-muted-foreground pt-1",children:["1 glass = ",d,"ml"]})]})]})},tr=({onSuccess:t})=>{const{userProfile:n}=l(),[s,i]=r.useState(!1),[a,f]=r.useState(!1),[p,m]=r.useState({sleep_hours:"",sleep_quality:"good",date:new Date(Date.now()-864e5).toISOString().split("T")[0]});return e.jsxs(A,{open:s,onOpenChange:i,children:[e.jsx(S,{asChild:!0,children:e.jsxs(o,{className:"w-full",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Log Sleep"]})}),e.jsxs(E,{className:"glass-effect custom-scrollbar sm:max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsx(I,{children:e.jsx(T,{children:"Log Your Sleep"})}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),f(!0);try{const{data:e}=await u.from("daily_metrics").select("*").eq("user_id",n.id).eq("date",p.date).single();e?await u.from("daily_metrics").update({sleep_hours:parseFloat(p.sleep_hours),sleep_quality:p.sleep_quality}).eq("id",e.id):await u.from("daily_metrics").insert({user_id:n.id,date:p.date,sleep_hours:parseFloat(p.sleep_hours),sleep_quality:p.sleep_quality}),await u.from("activity_feed").insert({user_id:n.id,activity_type:"sleep_log",activity_title:"Sleep Logged",activity_description:`${p.sleep_hours}h of ${p.sleep_quality} sleep`,metadata:{hours:parseFloat(p.sleep_hours),quality:p.sleep_quality}}),h({title:"Sleep Logged!",description:`Logged ${p.sleep_hours} hours of sleep`}),m({sleep_hours:"",sleep_quality:"good",date:new Date(Date.now()-864e5).toISOString().split("T")[0]}),i(!1),t&&t()}catch(r){h({title:"Error",description:"Failed to log sleep. Please try again.",variant:"destructive"})}finally{f(!1)}},className:"space-y-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx(c,{htmlFor:"date",children:"Night of"}),e.jsx(d,{id:"date",type:"date",value:p.date,onChange:e=>m({...p,date:e.target.value}),max:(new Date).toISOString().split("T")[0],required:!0,className:"w-full min-w-0"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Select the night you went to bed"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"sleep_hours",children:"Hours of Sleep *"}),e.jsx(d,{id:"sleep_hours",type:"number",step:"0.5",placeholder:"7.5",value:p.sleep_hours,onChange:e=>m({...p,sleep_hours:e.target.value}),min:"0",max:"24",required:!0})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"sleep_quality",children:"Sleep Quality"}),e.jsxs(At,{value:p.sleep_quality,onValueChange:e=>m({...p,sleep_quality:e}),children:[e.jsx(St,{children:e.jsx(Et,{})}),e.jsxs(It,{children:[e.jsx(Tt,{value:"poor",children:"Poor ðŸ˜´"}),e.jsx(Tt,{value:"fair",children:"Fair ðŸ˜"}),e.jsx(Tt,{value:"good",children:"Good ðŸ˜Š"}),e.jsx(Tt,{value:"excellent",children:"Excellent ðŸŒŸ"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>i(!1),className:"flex-1",children:"Cancel"}),e.jsx(o,{type:"submit",disabled:a,className:"flex-1",children:a?"Logging...":"Log Sleep"})]})]})]})]})},rr=()=>{const{userProfile:t}=l(),[n,s]=r.useState([]),[i,a]=r.useState([]),[o,c]=r.useState([]),[d,h]=r.useState(!0),[f,p]=r.useState("7");r.useEffect(()=>{(null==t?void 0:t.id)&&m()},[null==t?void 0:t.id,f]);const m=async()=>{try{const e=new Date;e.setDate(e.getDate()-parseInt(f));const r=e.toISOString().split("T")[0],{data:n}=await u.from("daily_metrics").select("*").eq("user_id",t.id).gte("date",r).order("date",{ascending:!0});n&&(s(n.filter(e=>e.weight_kg).map(e=>({date:e.date,value:e.weight_kg}))),a(n.map(e=>({date:e.date,burned:e.calories_burned||0,consumed:e.calories_consumed||0}))),c(n.filter(e=>e.sleep_hours).map(e=>({date:e.date,value:e.sleep_hours,quality:e.sleep_quality})))),h(!1)}catch(e){h(!1)}},g=(t,r,n="",s="primary")=>{var i,a,o;if(0===t.length)return e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e.jsx("p",{children:"No data yet for the selected period"})});const l=Math.max(...t.map(e=>e.value||0)),c=Math.min(...t.map(e=>e.value||0)),d=l-c,u=(e=>{if(e.length<2)return{trend:"neutral",percent:0};const t=e.slice(-Math.min(3,e.length)),r=e.slice(0,Math.min(3,e.length)),n=t.reduce((e,t)=>e+t.value,0)/t.length,s=r.reduce((e,t)=>e+t.value,0)/r.length,i=(n-s)/s*100;return{trend:i>2?"up":i<-2?"down":"neutral",percent:Math.abs(i).toFixed(1)}})(t);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-3xl font-bold",children:[(null==(a=null==(i=t[t.length-1])?void 0:i.value)?void 0:a.toFixed(1))||"N/A",(null==(o=t[t.length-1])?void 0:o.value)&&n]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Latest ",r]})]}),e.jsxs("div",{className:"flex items-center gap-2 "+("up"===u.trend?"text-green-500":"down"===u.trend?"text-red-500":"text-muted-foreground"),children:["up"===u.trend&&e.jsx(X,{className:"w-5 h-5"}),"down"===u.trend&&e.jsx(Y,{className:"w-5 h-5"}),"neutral"===u.trend&&e.jsx(G,{className:"w-5 h-5"}),e.jsxs("span",{className:"text-sm font-semibold",children:[u.percent,"%"]})]})]}),e.jsx("div",{className:"space-y-2",children:t.map((t,r)=>{var s;const i=d>0?(t.value-c)/d*100:50;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground w-20",children:new Date(t.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsxs("div",{className:"flex-1 h-8 bg-muted rounded-full overflow-hidden relative",children:[e.jsx("div",{className:"h-full bg-gradient-to-r from-primary to-green-400 rounded-full transition-all duration-300",style:{width:`${Math.max(i,5)}%`}}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-end pr-3",children:e.jsxs("span",{className:"text-xs font-medium",children:[null==(s=t.value)?void 0:s.toFixed(1),n]})})]})]},r)})}),t.length>1&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 pt-4 border-t",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-sm font-semibold",children:[l.toFixed(1),n]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Highest"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-sm font-semibold",children:[(t.reduce((e,t)=>e+t.value,0)/t.length).toFixed(1),n]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Average"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-sm font-semibold",children:[c.toFixed(1),n]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Lowest"})]})]})]})};return d?e.jsx(_,{className:"glass-effect",children:e.jsx(j,{className:"p-8 text-center text-muted-foreground",children:"Loading progress data..."})}):e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(N,{className:"text-xl font-bold",children:"Progress Tracking"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>p("7"),className:"px-3 py-1 rounded text-sm "+("7"===f?"bg-primary text-primary-foreground":"bg-muted"),children:"7D"}),e.jsx("button",{onClick:()=>p("30"),className:"px-3 py-1 rounded text-sm "+("30"===f?"bg-primary text-primary-foreground":"bg-muted"),children:"30D"}),e.jsx("button",{onClick:()=>p("90"),className:"px-3 py-1 rounded text-sm "+("90"===f?"bg-primary text-primary-foreground":"bg-muted"),children:"90D"})]})]})}),e.jsx(j,{children:e.jsxs(Dt,{defaultValue:"weight",children:[e.jsxs(Ot,{className:"grid w-full grid-cols-3",children:[e.jsx(Rt,{value:"weight",children:"Weight"}),e.jsx(Rt,{value:"calories",children:"Calories"}),e.jsx(Rt,{value:"sleep",children:"Sleep"})]}),e.jsx(kt,{value:"weight",className:"mt-6",children:g(n,"weight"," kg")}),e.jsx(kt,{value:"calories",className:"mt-6",children:0===i.length?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e.jsx("p",{children:"No calorie data yet for the selected period"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-muted rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-500",children:Math.round(i.reduce((e,t)=>e+t.consumed,0)/i.length)}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Avg Consumed"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-500",children:Math.round(i.reduce((e,t)=>e+t.burned,0)/i.length)}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Avg Burned"})]})]}),e.jsx("div",{className:"space-y-2",children:i.map((t,r)=>{const n=Math.max(t.consumed,t.burned,2e3);return e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(t.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs",children:"Consumed"}),e.jsx("span",{className:"text-xs font-semibold",children:t.consumed})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-red-500 rounded-full",style:{width:t.consumed/n*100+"%"}})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs",children:"Burned"}),e.jsx("span",{className:"text-xs font-semibold",children:t.burned})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 rounded-full",style:{width:t.burned/n*100+"%"}})})]})]})]},r)})})]})}),e.jsx(kt,{value:"sleep",className:"mt-6",children:g(o,"sleep"," hrs")})]})})]})},nr=({onSuccess:t})=>{var n;const{userProfile:s}=l(),[i,a]=r.useState(!1),[f,p]=r.useState(!1),[m,g]=r.useState(1),[x,y]=r.useState({plan_type:"daily",target_calories:"",dietary_preferences:"",meals_per_day:"3",allergies:"",cuisine_preference:"",cooking_time:"moderate"}),[v,w]=r.useState(null);return e.jsxs(A,{open:i,onOpenChange:a,children:[e.jsx(S,{asChild:!0,children:e.jsxs(o,{className:"w-full",size:"lg",children:[e.jsx(q,{className:"w-5 h-5 mr-2"}),"Generate AI Meal Plan"]})}),e.jsxs(E,{className:"glass-effect custom-scrollbar max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(I,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-6 h-6 text-primary"}),"AI Meal Plan Generator"]})}),1===m?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"plan_type",children:"Plan Type"}),e.jsxs(At,{value:x.plan_type,onValueChange:e=>y({...x,plan_type:e}),children:[e.jsx(St,{children:e.jsx(Et,{})}),e.jsxs(It,{children:[e.jsx(Tt,{value:"daily",children:"Daily Plan"}),e.jsx(Tt,{value:"weekly",children:"Weekly Plan"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"target_calories",children:"Target Calories"}),e.jsx(d,{id:"target_calories",type:"number",placeholder:(null==s?void 0:s.target_calories)||"2000",value:x.target_calories,onChange:e=>y({...x,target_calories:e.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"meals_per_day",children:"Meals per Day"}),e.jsxs(At,{value:x.meals_per_day,onValueChange:e=>y({...x,meals_per_day:e}),children:[e.jsx(St,{children:e.jsx(Et,{})}),e.jsxs(It,{children:[e.jsx(Tt,{value:"2",children:"2 Meals"}),e.jsx(Tt,{value:"3",children:"3 Meals"}),e.jsx(Tt,{value:"4",children:"4 Meals"}),e.jsx(Tt,{value:"5",children:"5 Meals"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"cooking_time",children:"Cooking Time"}),e.jsxs(At,{value:x.cooking_time,onValueChange:e=>y({...x,cooking_time:e}),children:[e.jsx(St,{children:e.jsx(Et,{})}),e.jsxs(It,{children:[e.jsx(Tt,{value:"quick",children:"Quick (15-20 min)"}),e.jsx(Tt,{value:"moderate",children:"Moderate (30-40 min)"}),e.jsx(Tt,{value:"extended",children:"Extended (1+ hour)"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"dietary_preferences",children:"Dietary Preferences"}),e.jsx(d,{id:"dietary_preferences",placeholder:(null==(n=null==s?void 0:s.dietary_restrictions)?void 0:n.join(", "))||"e.g., Vegetarian, Low-carb, Keto",value:x.dietary_preferences,onChange:e=>y({...x,dietary_preferences:e.target.value})})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"allergies",children:"Allergies/Restrictions"}),e.jsx(d,{id:"allergies",placeholder:"e.g., Nuts, Dairy, Gluten",value:x.allergies,onChange:e=>y({...x,allergies:e.target.value})})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"cuisine_preference",children:"Cuisine Preference (optional)"}),e.jsx(d,{id:"cuisine_preference",placeholder:"e.g., Mediterranean, Asian, American",value:x.cuisine_preference,onChange:e=>y({...x,cuisine_preference:e.target.value})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>a(!1),className:"flex-1",children:"Cancel"}),e.jsx(o,{onClick:async()=>{var e,t;p(!0);try{const r=`Create a ${x.plan_type} meal plan for a person with the following requirements:\n- Target Calories: ${x.target_calories||(null==s?void 0:s.target_calories)||2e3} kcal\n- Dietary Preferences: ${x.dietary_preferences||(null==(e=null==s?void 0:s.dietary_restrictions)?void 0:e.join(", "))||"None"}\n- Meals per Day: ${x.meals_per_day}\n- Allergies/Restrictions: ${x.allergies||"None"}\n- Cuisine Preference: ${x.cuisine_preference||"Any"}\n- Cooking Time: ${x.cooking_time}\n- Health Goals: ${(null==(t=null==s?void 0:s.health_goals)?void 0:t.join(", "))||"General wellness"}\n\nPlease provide detailed meal suggestions with ingredients, portions, and nutritional breakdown for each meal.`,n=sr(x,s),{data:i,error:a}=await u.from("ai_meal_plans").insert({user_id:s.id,plan_name:`${x.plan_type} Meal Plan - ${(new Date).toLocaleDateString()}`,plan_type:x.plan_type,target_date:(new Date).toISOString().split("T")[0],target_calories:parseInt(x.target_calories||2e3),meals:n.meals,ai_prompt:r,ai_model:"gpt-4",status:"active"}).select().single();if(a)throw a;w(n),g(2),h({title:"Meal Plan Generated!",description:"Your personalized meal plan is ready"})}catch(r){h({title:"Error",description:"Failed to generate meal plan. Please try again.",variant:"destructive"})}finally{p(!1)}},disabled:f,className:"flex-1",children:f?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-4 h-4 mr-2 animate-pulse"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Generate Plan"]})})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-primary/10 rounded-lg border border-primary/20",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Your Personalized Meal Plan"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Calories"}),e.jsx("div",{className:"font-semibold",children:null==v?void 0:v.totalCalories})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Protein"}),e.jsxs("div",{className:"font-semibold",children:[null==v?void 0:v.totalProtein,"g"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Carbs"}),e.jsxs("div",{className:"font-semibold",children:[null==v?void 0:v.totalCarbs,"g"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Fats"}),e.jsxs("div",{className:"font-semibold",children:[null==v?void 0:v.totalFats,"g"]})]})]})]}),e.jsx("div",{className:"space-y-4",children:null==v?void 0:v.meals.map((t,r)=>e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-primary"}),e.jsx("h4",{className:"font-semibold capitalize",children:t.type})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t.calories," kcal"]})]}),e.jsx("h5",{className:"font-medium",children:t.name}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:t.description}),e.jsxs("div",{className:"flex gap-4 mt-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["P: ",t.protein,"g"]}),e.jsxs("span",{children:["C: ",t.carbs,"g"]}),e.jsxs("span",{children:["F: ",t.fats,"g"]})]}),t.ingredients&&e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsx("strong",{children:"Ingredients:"})," ",t.ingredients]})]},r))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>g(1),className:"flex-1",children:"Regenerate"}),e.jsx(o,{onClick:async()=>{p(!0);try{const e=(new Date).toISOString().split("T")[0];for(const t of v.meals)await u.from("meal_logs").insert({user_id:s.id,meal_type:t.type.toLowerCase(),meal_name:t.name,description:t.description,calories:t.calories,protein_g:t.protein,carbs_g:t.carbs,fats_g:t.fats,date:e,ai_generated:!0}),await u.from("activity_feed").insert({user_id:s.id,activity_type:"ai_meal_plan",activity_title:"AI Meal Plan Created",activity_description:`Generated ${v.meals.length} meal suggestions`,metadata:{meal_count:v.meals.length}});h({title:"Meals Saved!",description:"Your meal plan has been added to today's log"}),a(!1),g(1),w(null),t&&t()}catch(e){h({title:"Error",description:"Failed to save meals. Please try again.",variant:"destructive"})}finally{p(!1)}},disabled:f,className:"flex-1",children:f?"Saving...":"Save to Today"})]})]})]})]})},sr=(e,t)=>{const r=parseInt(e.target_calories||2e3),n=parseInt(e.meals_per_day),s=Math.floor(r/n),i=["breakfast","lunch","dinner","snack"],a=[],o={breakfast:[{name:"Greek Yogurt Bowl",desc:"Greek yogurt with berries, granola, and honey",ingredients:"Greek yogurt, mixed berries, granola, honey, almonds"},{name:"Avocado Toast",desc:"Whole grain toast with mashed avocado and poached eggs",ingredients:"Whole grain bread, avocado, eggs, cherry tomatoes, olive oil"},{name:"Protein Smoothie",desc:"Banana, protein powder, spinach, and almond milk",ingredients:"Banana, protein powder, spinach, almond milk, peanut butter"}],lunch:[{name:"Grilled Chicken Salad",desc:"Mixed greens with grilled chicken, quinoa, and vinaigrette",ingredients:"Chicken breast, mixed greens, quinoa, cherry tomatoes, cucumber, olive oil"},{name:"Salmon Bowl",desc:"Brown rice with baked salmon, edamame, and avocado",ingredients:"Salmon fillet, brown rice, edamame, avocado, sesame seeds, soy sauce"},{name:"Turkey Wrap",desc:"Whole wheat wrap with turkey, hummus, and veggies",ingredients:"Whole wheat tortilla, turkey breast, hummus, lettuce, tomato, cucumber"}],dinner:[{name:"Stir-Fry Chicken",desc:"Chicken with colorful vegetables and brown rice",ingredients:"Chicken breast, broccoli, bell peppers, carrots, brown rice, soy sauce"},{name:"Baked Cod",desc:"Lemon herb cod with roasted vegetables",ingredients:"Cod fillet, lemon, herbs, sweet potato, asparagus, olive oil"},{name:"Lean Beef & Quinoa",desc:"Seasoned lean beef with quinoa and steamed broccoli",ingredients:"Lean beef, quinoa, broccoli, garlic, spices"}],snack:[{name:"Apple & Almond Butter",desc:"Sliced apple with natural almond butter",ingredients:"Apple, almond butter"},{name:"Protein Bar",desc:"High-protein, low-sugar protein bar",ingredients:"Protein bar"},{name:"Mixed Nuts",desc:"Handful of mixed nuts and dried fruit",ingredients:"Almonds, cashews, dried cranberries"}]};for(let l=0;l<n;l++){const e=i[l%4],t=o[e],r=t[Math.floor(Math.random()*t.length)];a.push({type:e,name:r.name,description:r.desc,ingredients:r.ingredients,calories:s+Math.floor(100*Math.random()-50),protein:Math.floor(.3*s/4),carbs:Math.floor(.4*s/4),fats:Math.floor(.3*s/9)})}return{meals:a,totalCalories:a.reduce((e,t)=>e+t.calories,0),totalProtein:a.reduce((e,t)=>e+t.protein,0),totalCarbs:a.reduce((e,t)=>e+t.carbs,0),totalFats:a.reduce((e,t)=>e+t.fats,0)}},ir=({onSuccess:t})=>{const{userProfile:n}=l(),[s,i]=r.useState(!1),[a,d]=r.useState(!1),[f,p]=r.useState(1),[m,g]=r.useState({plan_type:"daily",fitness_level:"intermediate",workout_duration:"30",equipment:"bodyweight",focus_area:"full_body",intensity:"moderate"}),[x,y]=r.useState(null);return e.jsxs(A,{open:s,onOpenChange:i,children:[e.jsx(S,{asChild:!0,children:e.jsxs(o,{className:"w-full",size:"lg",variant:"outline",children:[e.jsx(q,{className:"w-5 h-5 mr-2"}),"Generate AI Workout"]})}),e.jsxs(E,{className:"glass-effect custom-scrollbar max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(I,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-6 h-6 text-primary"}),"AI Workout Planner"]})}),1===f?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"plan_type",children:"Plan Type"}),e.jsxs(At,{value:m.plan_type,onValueChange:e=>g({...m,plan_type:e}),children:[e.jsx(St,{children:e.jsx(Et,{})}),e.jsxs(It,{children:[e.jsx(Tt,{value:"daily",children:"Single Workout"}),e.jsx(Tt,{value:"weekly",children:"Weekly Program"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"fitness_level",children:"Fitness Level"}),e.jsxs(At,{value:m.fitness_level,onValueChange:e=>g({...m,fitness_level:e}),children:[e.jsx(St,{children:e.jsx(Et,{})}),e.jsxs(It,{children:[e.jsx(Tt,{value:"beginner",children:"Beginner"}),e.jsx(Tt,{value:"intermediate",children:"Intermediate"}),e.jsx(Tt,{value:"advanced",children:"Advanced"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"duration",children:"Duration (minutes)"}),e.jsxs(At,{value:m.workout_duration,onValueChange:e=>g({...m,workout_duration:e}),children:[e.jsx(St,{children:e.jsx(Et,{})}),e.jsxs(It,{children:[e.jsx(Tt,{value:"15",children:"15 minutes"}),e.jsx(Tt,{value:"30",children:"30 minutes"}),e.jsx(Tt,{value:"45",children:"45 minutes"}),e.jsx(Tt,{value:"60",children:"60 minutes"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"intensity",children:"Intensity"}),e.jsxs(At,{value:m.intensity,onValueChange:e=>g({...m,intensity:e}),children:[e.jsx(St,{children:e.jsx(Et,{})}),e.jsxs(It,{children:[e.jsx(Tt,{value:"light",children:"Light"}),e.jsx(Tt,{value:"moderate",children:"Moderate"}),e.jsx(Tt,{value:"intense",children:"Intense"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"equipment",children:"Available Equipment"}),e.jsxs(At,{value:m.equipment,onValueChange:e=>g({...m,equipment:e}),children:[e.jsx(St,{children:e.jsx(Et,{})}),e.jsxs(It,{children:[e.jsx(Tt,{value:"bodyweight",children:"Bodyweight Only"}),e.jsx(Tt,{value:"dumbbells",children:"Dumbbells"}),e.jsx(Tt,{value:"gym",children:"Full Gym Access"}),e.jsx(Tt,{value:"home",children:"Home Equipment (bands, weights)"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"focus_area",children:"Focus Area"}),e.jsxs(At,{value:m.focus_area,onValueChange:e=>g({...m,focus_area:e}),children:[e.jsx(St,{children:e.jsx(Et,{})}),e.jsxs(It,{children:[e.jsx(Tt,{value:"full_body",children:"Full Body"}),e.jsx(Tt,{value:"upper_body",children:"Upper Body"}),e.jsx(Tt,{value:"lower_body",children:"Lower Body"}),e.jsx(Tt,{value:"core",children:"Core & Abs"}),e.jsx(Tt,{value:"cardio",children:"Cardio"}),e.jsx(Tt,{value:"flexibility",children:"Flexibility & Mobility"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>i(!1),className:"flex-1",children:"Cancel"}),e.jsx(o,{onClick:async()=>{var e;d(!0);try{const t=`Create a ${m.plan_type} workout plan with:\n- Fitness Level: ${m.fitness_level}\n- Duration: ${m.workout_duration} minutes\n- Equipment: ${m.equipment}\n- Focus Area: ${m.focus_area}\n- Intensity: ${m.intensity}\n- Health Goals: ${(null==(e=null==n?void 0:n.health_goals)?void 0:e.join(", "))||"General fitness"}\n\nProvide detailed exercises with sets, reps, and instructions.`,r=ar(m,n),{data:s,error:i}=await u.from("ai_workout_plans").insert({user_id:n.id,plan_name:`${m.focus_area} Workout - ${(new Date).toLocaleDateString()}`,plan_type:m.plan_type,target_date:(new Date).toISOString().split("T")[0],difficulty:m.fitness_level,workouts:r.workouts,ai_prompt:t,ai_model:"gpt-4",status:"active"}).select().single();if(i)throw i;y(r),p(2),h({title:"Workout Plan Generated!",description:"Your personalized workout is ready"})}catch(t){h({title:"Error",description:"Failed to generate workout. Please try again.",variant:"destructive"})}finally{d(!1)}},disabled:a,className:"flex-1",children:a?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-4 h-4 mr-2 animate-pulse"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Generate Workout"]})})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-primary/10 rounded-lg border border-primary/20",children:[e.jsx("h3",{className:"font-semibold mb-2",children:null==x?void 0:x.name}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Duration"}),e.jsxs("div",{className:"font-semibold",children:[null==x?void 0:x.totalDuration," min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Exercises"}),e.jsx("div",{className:"font-semibold",children:null==x?void 0:x.workouts.length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Est. Calories"}),e.jsx("div",{className:"font-semibold",children:null==x?void 0:x.estimatedCalories})]})]})]}),e.jsx("div",{className:"space-y-3",children:null==x?void 0:x.workouts.map((t,r)=>e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4 text-primary"}),e.jsx("h4",{className:"font-semibold",children:t.name})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t.sets,"x",t.reps]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.instructions}),t.rest&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Rest: ",t.rest,"s"]})]},r))}),e.jsxs("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-lg text-sm",children:[e.jsx("strong",{children:"ðŸ’¡ Pro Tip:"})," Remember to warm up for 5 minutes before starting and cool down with stretching afterwards!"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>p(1),className:"flex-1",children:"Regenerate"}),e.jsx(o,{onClick:async()=>{d(!0);try{const e=(new Date).toISOString().split("T")[0];await u.from("workout_logs").insert({user_id:n.id,workout_name:x.name,workout_type:m.focus_area,duration_minutes:x.totalDuration,calories_burned:x.estimatedCalories,intensity:m.intensity,exercises:x.workouts,date:e,ai_generated:!0,notes:"AI Generated Workout"}),await u.from("activity_feed").insert({user_id:n.id,activity_type:"ai_workout_plan",activity_title:"AI Workout Plan Created",activity_description:x.name,metadata:{exercises:x.workouts.length}}),h({title:"Workout Saved!",description:"Your workout has been added to today's log"}),i(!1),p(1),y(null),t&&t()}catch(e){h({title:"Error",description:"Failed to save workout. Please try again.",variant:"destructive"})}finally{d(!1)}},disabled:a,className:"flex-1",children:a?"Saving...":"Save Workout"})]})]})]})]})},ar=(e,t)=>{const r={full_body:[{name:"Push-ups",sets:3,reps:12,instructions:"Keep body straight, lower until chest nearly touches floor",rest:60},{name:"Squats",sets:3,reps:15,instructions:"Feet shoulder-width apart, lower until thighs parallel to ground",rest:60},{name:"Plank",sets:3,reps:"30s",instructions:"Hold body straight in plank position",rest:45},{name:"Lunges",sets:3,reps:"10 each",instructions:"Step forward, lower back knee toward floor",rest:60},{name:"Mountain Climbers",sets:3,reps:20,instructions:"Bring knees to chest alternately in plank position",rest:45}],upper_body:[{name:"Push-ups",sets:4,reps:12,instructions:"Standard push-up form",rest:60},{name:"Dips",sets:3,reps:10,instructions:"Use chair or parallel bars",rest:60},{name:"Pike Push-ups",sets:3,reps:8,instructions:"Hips up, head down between arms",rest:60},{name:"Arm Circles",sets:2,reps:30,instructions:"Small to large circles, both directions",rest:30}],lower_body:[{name:"Squats",sets:4,reps:15,instructions:"Bodyweight squats, full range of motion",rest:60},{name:"Lunges",sets:3,reps:"12 each",instructions:"Alternating forward lunges",rest:60},{name:"Glute Bridges",sets:3,reps:15,instructions:"Lift hips, squeeze glutes at top",rest:45},{name:"Calf Raises",sets:3,reps:20,instructions:"Rise up on toes, slow descent",rest:45}],core:[{name:"Plank",sets:3,reps:"45s",instructions:"Hold strong plank position",rest:45},{name:"Bicycle Crunches",sets:3,reps:20,instructions:"Bring opposite elbow to knee",rest:45},{name:"Russian Twists",sets:3,reps:30,instructions:"Rotate torso side to side",rest:45},{name:"Leg Raises",sets:3,reps:12,instructions:"Lift legs up, control descent",rest:60}],cardio:[{name:"Jumping Jacks",sets:3,reps:30,instructions:"Full range jumping jacks",rest:30},{name:"High Knees",sets:3,reps:40,instructions:"Run in place with high knees",rest:30},{name:"Burpees",sets:3,reps:10,instructions:"Full burpee with jump",rest:60},{name:"Mountain Climbers",sets:3,reps:30,instructions:"Fast-paced mountain climbers",rest:45}]},n=r[e.focus_area]||r.full_body,s=parseInt(e.workout_duration),i="intense"===e.intensity?10:"moderate"===e.intensity?7:5;return{name:`${e.focus_area.replace("_"," ").toUpperCase()} ${e.intensity} Workout`,workouts:n.slice(0,Math.floor(s/5)),totalDuration:s,estimatedCalories:s*i}},or=()=>{const{userProfile:t}=l(),[n,s]=r.useState([]),[i,a]=r.useState(!0);r.useEffect(()=>{(null==t?void 0:t.id)&&o()},[null==t?void 0:t.id]);const o=async()=>{try{const e=(new Date).toISOString().split("T")[0],r=new Date;r.setDate(r.getDate()-7);const n=r.toISOString().split("T")[0],{data:i}=await u.from("daily_metrics").select("*").eq("user_id",t.id).gte("date",n).order("date",{ascending:!0}),{data:o}=await u.from("daily_metrics").select("*").eq("user_id",t.id).eq("date",e).single(),{data:l}=await u.from("workout_logs").select("*").eq("user_id",t.id).gte("date",n),{data:d}=await u.from("meal_logs").select("*").eq("user_id",t.id).gte("date",n),h=c(i||[],o,l||[],d||[],t);s(h),a(!1)}catch(e){a(!1)}},c=(e,t,r,n,s)=>{var i,a;const o=[],l=e.filter(e=>e.weight_kg);if(l.length>=2){const e=l[0].weight_kg,t=l[l.length-1].weight_kg-e;Math.abs(t)>.5&&o.push({type:t<0?"success":"info",icon:X,title:t<0?"Weight Loss Progress":"Weight Gain",message:`You've ${t<0?"lost":"gained"} ${Math.abs(t).toFixed(1)}kg this week. ${t<0?"Great work! Keep it up!":"This might be muscle gain if you're strength training."}`})}if(t){const e=t.calories_consumed||0;t.calories_burned;const r=s.target_calories||2e3;e<.8*r?o.push({type:"warning",icon:Q,title:"Low Calorie Intake",message:`You've consumed ${e} calories today, which is below your goal of ${r}. Consider adding a healthy snack!`}):e>1.2*r&&o.push({type:"info",icon:J,title:"High Calorie Day",message:`You've consumed ${e} calories today. If this was planned, great! Otherwise, try balancing tomorrow.`})}if(t){const e=t.water_ml||0;e<1500?o.push({type:"warning",icon:Q,title:"Hydration Reminder",message:`You've had ${e}ml of water today. Aim for at least 2000ml for optimal hydration!`}):e>=2e3&&o.push({type:"success",icon:ee,title:"Great Hydration!",message:`You've hit your water goal with ${e}ml today. Keep up the excellent hydration!`})}const c=e.filter(e=>e.sleep_hours);if(c.length>=3){const e=c.reduce((e,t)=>e+t.sleep_hours,0)/c.length;e<6.5?o.push({type:"warning",icon:Q,title:"Insufficient Sleep",message:`Your average sleep is ${e.toFixed(1)} hours. Aim for 7-9 hours for better recovery and health.`}):e>=7&&e<=9&&o.push({type:"success",icon:ee,title:"Excellent Sleep Pattern",message:`You're averaging ${e.toFixed(1)} hours of sleep. This is optimal for recovery and performance!`})}if(0===r.length?o.push({type:"info",icon:J,title:"Time to Move",message:"No workouts logged this week. Even a 15-minute walk can make a difference! Try our AI workout generator."}):r.length>=3&&o.push({type:"success",icon:ee,title:"Active Week!",message:`You've completed ${r.length} workouts this week. You're crushing your fitness goals!`}),0===n.length&&o.push({type:"info",icon:J,title:"Start Tracking Meals",message:"Logging your meals helps you stay accountable and reach your nutrition goals faster."}),null==(i=s.health_goals)?void 0:i.includes("lose_weight")){(consumed||0)-(burned||0)>0&&t&&o.push({type:"info",icon:J,title:"Calorie Deficit",message:"To lose weight, aim to burn more calories than you consume. Consider adding a workout or reducing portion sizes."})}if(null==(a=s.health_goals)?void 0:a.includes("build_muscle")){const t=1.6*(s.weight_kg||70),r=e.reduce((e,t)=>e+(t.protein_g||0),0)/Math.max(e.length,1);r<.8*t&&o.push({type:"info",icon:J,title:"Increase Protein Intake",message:`For muscle building, aim for ${t.toFixed(0)}g of protein daily. You're averaging ${r.toFixed(0)}g.`})}return 0===o.length&&o.push({type:"success",icon:ee,title:"Looking Good!",message:"Keep logging your data to get personalized insights and track your progress effectively."}),o.slice(0,5)},d=e=>{switch(e){case"success":return"text-green-500";case"warning":return"text-yellow-500";case"info":return"text-blue-500";default:return"text-muted-foreground"}},h=e=>{switch(e){case"success":return"bg-green-500/10 border-green-500/20";case"warning":return"bg-yellow-500/10 border-yellow-500/20";case"info":return"bg-blue-500/10 border-blue-500/20";default:return"bg-muted border-border"}};return i?e.jsx(_,{className:"glass-effect",children:e.jsx(j,{className:"p-8 text-center text-muted-foreground",children:"Analyzing your data..."})}):e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsxs(N,{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5 text-primary"}),"Personalized Insights"]})}),e.jsx(j,{className:"space-y-3",children:n.map((t,r)=>{const n=t.icon;return e.jsx("div",{className:`p-4 rounded-lg border ${h(t.type)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(n,{className:`w-5 h-5 flex-shrink-0 mt-0.5 ${d(t.type)}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold mb-1",children:t.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.message})]})]})},r)})})]})},lr=()=>{const{user:t}=l(),[n,s]=r.useState(null),[i,a]=r.useState([]),[c,d]=r.useState(!0),[u,f]=r.useState(!1),[y,v]=r.useState(!1);r.useEffect(()=>{t&&w()},[t]);const w=async()=>{try{d(!0);const[e,r]=await Promise.all([p(t.id),m(t.id)]);s(e),a(r)}catch(e){h({title:"Error",description:"Failed to load subscription data",variant:"destructive"})}finally{d(!1)}},b=e=>e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A";if(c)return e.jsx(_,{className:"p-8",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(re,{className:"w-8 h-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-3 text-lg",children:"Loading subscription..."})]})});if(!n)return e.jsx(_,{className:"p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ne,{className:"w-16 h-16 mx-auto text-text-secondary mb-4"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"No Active Subscription"}),e.jsx("p",{className:"text-text-secondary mb-6",children:"Subscribe to a plan to unlock all features and benefits."}),e.jsx(o,{onClick:()=>window.location.href="/pricing",children:"View Plans"})]})});const N=n.subscription_plans;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(_,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold mb-2",children:N.name}),e.jsx("p",{className:"text-text-secondary",children:N.description})]}),(t=>{const r={active:{variant:"default",label:"Active",color:"bg-green-500"},past_due:{variant:"destructive",label:"Past Due",color:"bg-red-500"},canceled:{variant:"secondary",label:"Canceled",color:"bg-gray-500"},paused:{variant:"secondary",label:"Paused",color:"bg-yellow-500"}},n=r[t]||r.canceled;return e.jsx(g,{className:n.color,children:n.label})})(n.status)]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(se,{className:"w-5 h-5 text-primary mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Billing Amount"}),e.jsxs("p",{className:"text-lg font-semibold",children:["$","yearly"===n.billing_cycle?N.price_yearly:N.price_monthly,e.jsxs("span",{className:"text-sm font-normal text-text-secondary",children:["/","yearly"===n.billing_cycle?"year":"month"]})]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ie,{className:"w-5 h-5 text-primary mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Next Billing Date"}),e.jsx("p",{className:"text-lg font-semibold",children:b(n.current_period_end)})]})]})]}),N.features&&N.features.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Included Features"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-2",children:N.features.map((t,r)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-green-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:t})]},r))})]}),n.cancel_at_period_end&&e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-lg mb-6",children:[e.jsx(Q,{className:"w-5 h-5 text-yellow-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-yellow-500",children:"Subscription Ending"}),e.jsxs("p",{className:"text-sm text-text-secondary",children:["Your subscription will end on ",b(n.current_period_end)]})]})]}),"active"===n.status&&!n.cancel_at_period_end&&e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(o,{variant:"outline",onClick:()=>window.location.href="/pricing",children:"Upgrade Plan"}),e.jsxs(o,{variant:"ghost",onClick:()=>v(!0),className:"text-red-500 hover:text-red-600 hover:bg-red-500/10",children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Cancel Subscription"]})]})]}),i.length>0&&e.jsxs(_,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Payment Methods"}),e.jsx("div",{className:"space-y-3",children:i.map(t=>{var r;return e.jsxs("div",{className:"flex items-center justify-between p-4 border border-border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ne,{className:"w-5 h-5 text-text-secondary"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold",children:[null==(r=t.card_brand)?void 0:r.toUpperCase()," â€¢â€¢â€¢â€¢ ",t.card_last4]}),e.jsxs("p",{className:"text-sm text-text-secondary",children:["Expires ",t.card_exp_month,"/",t.card_exp_year]})]})]}),t.is_default&&e.jsx(g,{variant:"outline",children:"Default"})]},t.id)})})]}),e.jsx(Mt,{open:y,onOpenChange:v,children:e.jsxs(Pt,{children:[e.jsxs(Bt,{children:[e.jsx(Ft,{children:"Cancel Subscription?"}),e.jsxs(Lt,{children:["Are you sure you want to cancel your subscription? You will continue to have access until ",b(null==n?void 0:n.current_period_end),", but your subscription will not renew after that date."]})]}),e.jsxs(Ut,{children:[e.jsx(Vt,{children:"Keep Subscription"}),e.jsx(Ht,{onClick:async()=>{try{f(!0),await x(t.id),h({title:"Subscription Canceled",description:"Your subscription will remain active until the end of the current billing period."}),v(!1),await w()}catch(e){h({title:"Error",description:"Failed to cancel subscription",variant:"destructive"})}finally{f(!1)}},disabled:u,className:"bg-red-500 hover:bg-red-600",children:u?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-4 h-4 mr-2 animate-spin"}),"Canceling..."]}):"Yes, Cancel"})]})]})})]})},cr=({onDismiss:t,position:r="top"})=>{const s=n(),{hasAds:i}=y();if(!i)return null;return e.jsx("div",{className:"relative bg-gradient-to-r from-primary/10 to-green-500/10 border-l-4 border-primary p-4 "+("top"===r?"mb-6":"mt-6"),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx(q,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-sm mb-1",children:"Upgrade to Premium for an Ad-Free Experience!"}),e.jsx("p",{className:"text-xs text-text-secondary mb-2",children:"Get unlimited meal plans, AI workouts, advanced analytics, and remove all ads."}),e.jsx(o,{size:"sm",onClick:()=>{s("/pricing")},className:"bg-primary hover:bg-primary/90 text-xs h-8",children:"Upgrade Now - Save 25% on Yearly"})]})]}),t&&e.jsx("button",{onClick:t,className:"text-text-secondary hover:text-foreground transition-colors","aria-label":"Dismiss ad",children:e.jsx(R,{className:"w-4 h-4"})})]})})},dr=()=>{const{userProfile:t}=l(),{hasAccess:n}=y(),[s,i]=r.useState(null),[a,c]=r.useState(null),[d,f]=r.useState(!1),[p,m]=r.useState(null),g=r.useRef(null),x=r.useRef(null),v=e=>{const t=e.target.files[0];if(!t)return;if(!t.type.startsWith("image/"))return void h({title:"Invalid File",description:"Please select an image file (JPG, PNG, etc.)",variant:"destructive"});if(t.size>5242880)return void h({title:"File Too Large",description:"Please select an image smaller than 5MB",variant:"destructive"});i(t);const r=new FileReader;r.onloadend=()=>{c(r.result)},r.readAsDataURL(t)};return n("photoRecognition")?e.jsxs(_,{className:"glass-effect",children:[e.jsxs(b,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5"}),"ðŸ“¸ AI Photo Food Recognition"]}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Snap a photo of your meal and let AI identify and log it automatically"})]}),e.jsxs(j,{className:"space-y-4",children:[!a&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(o,{variant:"outline",className:"h-32 flex flex-col gap-2",onClick:()=>{var e;return null==(e=x.current)?void 0:e.click()},children:[e.jsx(le,{className:"h-8 w-8"}),e.jsx("span",{children:"Take Photo"})]}),e.jsxs(o,{variant:"outline",className:"h-32 flex flex-col gap-2",onClick:()=>{var e;return null==(e=g.current)?void 0:e.click()},children:[e.jsx(ce,{className:"h-8 w-8"}),e.jsx("span",{children:"Upload Photo"})]})]}),e.jsx("input",{ref:g,type:"file",accept:"image/*",className:"hidden",onChange:v}),e.jsx("input",{ref:x,type:"file",accept:"image/*",capture:"environment",className:"hidden",onChange:v}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:a,alt:"Food preview",className:"w-full h-64 object-cover rounded-lg"}),e.jsxs(o,{variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:()=>{c(null),i(null),m(null)},children:[e.jsx(oe,{className:"h-4 w-4 mr-1"}),"Remove"]})]}),!p&&e.jsx(o,{onClick:async()=>{if(s){f(!0),m(null);try{const e=await new Promise(e=>{const t=new FileReader;t.onloadend=()=>e(t.result),t.readAsDataURL(s)}),{data:t,error:r}=await u.functions.invoke("analyze-food-photo",{body:{image:e}});if(r)throw r;m(t),h({title:"Analysis Complete!",description:`Detected: ${t.foodItems.map(e=>e.name).join(", ")}`})}catch(e){h({title:"Analysis Failed",description:e.message||"Unable to analyze the food image. Please try again.",variant:"destructive"})}finally{f(!1)}}else h({title:"No Image Selected",description:"Please select or capture a photo first",variant:"destructive"})},disabled:d,className:"w-full",children:d?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"mr-2 h-4 w-4 animate-spin"}),"Analyzing Food..."]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Analyze Food"]})})]}),p&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(de,{className:"h-5 w-5"}),e.jsx("span",{className:"font-semibold",children:"Food Detected!"})]}),e.jsx("div",{className:"space-y-3",children:p.foodItems.map((t,r)=>e.jsxs("div",{className:"p-3 bg-background/50 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:t.name}),e.jsxs("p",{className:"text-sm text-text-secondary",children:["Portion: ",t.portion]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-bold text-primary",children:[t.nutrition.calories," cal"]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-text-secondary",children:"Protein: "}),e.jsxs("span",{className:"font-medium",children:[t.nutrition.protein,"g"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-secondary",children:"Carbs: "}),e.jsxs("span",{className:"font-medium",children:[t.nutrition.carbs,"g"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-secondary",children:"Fats: "}),e.jsxs("span",{className:"font-medium",children:[t.nutrition.fats,"g"]})]})]})]},r))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{onClick:async()=>{if(p)try{const e=p.foodItems.reduce((e,t)=>({calories:e.calories+t.nutrition.calories,protein:e.protein+t.nutrition.protein,carbs:e.carbs+t.nutrition.carbs,fats:e.fats+t.nutrition.fats}),{calories:0,protein:0,carbs:0,fats:0}),{error:r}=await u.from("daily_metrics").upsert({user_id:t.id,date:(new Date).toISOString().split("T")[0],meals:p.foodItems.map(e=>({name:e.name,portion:e.portion,calories:e.nutrition.calories,protein:e.nutrition.protein,carbs:e.nutrition.carbs,fats:e.nutrition.fats,photo_url:a,logged_at:(new Date).toISOString()})),calories_consumed:e.calories,protein_g:e.protein,carbs_g:e.carbs,fats_g:e.fats},{onConflict:"user_id,date"});if(r)throw r;h({title:"Meal Logged Successfully!",description:`Added ${e.calories} calories to your daily intake`}),i(null),c(null),m(null)}catch(e){h({title:"Logging Failed",description:e.message||"Unable to log the meal. Please try again.",variant:"destructive"})}},className:"flex-1",children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),"Log This Meal"]}),e.jsx(o,{variant:"outline",onClick:()=>{c(null),i(null),m(null)},children:"Cancel"})]}),p.confidence&&e.jsxs("p",{className:"text-xs text-text-secondary text-center",children:["Confidence: ",Math.round(100*p.confidence),"%"]})]}),!a&&e.jsx("div",{className:"mt-4 p-3 bg-primary/5 rounded-lg",children:e.jsxs("p",{className:"text-xs text-text-secondary",children:[e.jsx("strong",{children:"ðŸ’¡ Tips for best results:"}),e.jsx("br",{}),"â€¢ Take photos in good lighting",e.jsx("br",{}),"â€¢ Show the entire meal clearly",e.jsx("br",{}),"â€¢ Include common utensils for size reference",e.jsx("br",{}),"â€¢ Avoid blurry or dark images"]})})]})]}):e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5"}),"Photo Food Recognition"]})}),e.jsx(j,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"mx-auto w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mb-4",children:e.jsx(le,{className:"h-8 w-8 text-primary"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Elite Feature"}),e.jsx("p",{className:"text-text-secondary mb-4",children:"Photo food recognition is available for Elite plan subscribers. Upgrade to instantly log meals by taking photos!"}),e.jsx(o,{onClick:()=>window.location.href="/pricing",children:"Upgrade to Elite"})]})})]})};var ur,hr,fr,pr,mr=(ur=function(e,t){return(ur=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}ur(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),gr=function(e){function t(t,r){var n,s,i,a=this.constructor,o=e.call(this,t,r)||this;return Object.defineProperty(o,"name",{value:a.name,enumerable:!1,configurable:!0}),n=o,s=a.prototype,(i=Object.setPrototypeOf)?i(n,s):n.__proto__=s,function(e,t){void 0===t&&(t=e.constructor);var r=Error.captureStackTrace;r&&r(e,t)}(o),o}return mr(t,e),t}(Error),xr=globalThis&&globalThis.__extends||(hr=function(e,t){return(hr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}hr(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),yr=function(e){function t(t){void 0===t&&(t=void 0);var r=e.call(this,t)||this;return r.message=t,r}return xr(t,e),t.prototype.getKind=function(){return this.constructor.kind},t.kind="Exception",t}(gr),vr=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),wr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vr(t,e),t.kind="ArgumentException",t}(yr),_r=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),br=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _r(t,e),t.kind="IllegalArgumentException",t}(yr),Nr=function(){function e(e){if(this.binarizer=e,null===e)throw new br("Binarizer must be non-null.")}return e.prototype.getWidth=function(){return this.binarizer.getWidth()},e.prototype.getHeight=function(){return this.binarizer.getHeight()},e.prototype.getBlackRow=function(e,t){return this.binarizer.getBlackRow(e,t)},e.prototype.getBlackMatrix=function(){return null!==this.matrix&&void 0!==this.matrix||(this.matrix=this.binarizer.getBlackMatrix()),this.matrix},e.prototype.isCropSupported=function(){return this.binarizer.getLuminanceSource().isCropSupported()},e.prototype.crop=function(t,r,n,s){var i=this.binarizer.getLuminanceSource().crop(t,r,n,s);return new e(this.binarizer.createBinarizer(i))},e.prototype.isRotateSupported=function(){return this.binarizer.getLuminanceSource().isRotateSupported()},e.prototype.rotateCounterClockwise=function(){var t=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new e(this.binarizer.createBinarizer(t))},e.prototype.rotateCounterClockwise45=function(){var t=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new e(this.binarizer.createBinarizer(t))},e.prototype.toString=function(){try{return this.getBlackMatrix().toString()}catch(e){return""}},e}(),jr=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Cr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return jr(t,e),t.getChecksumInstance=function(){return new t},t.kind="ChecksumException",t}(yr),Ar=function(){function e(e){this.source=e}return e.prototype.getLuminanceSource=function(){return this.source},e.prototype.getWidth=function(){return this.source.getWidth()},e.prototype.getHeight=function(){return this.source.getHeight()},e}(),Sr=function(){function e(){}return e.arraycopy=function(e,t,r,n,s){for(;s--;)r[n++]=e[t++]},e.currentTimeMillis=function(){return Date.now()},e}(),Er=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ir=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Er(t,e),t.kind="IndexOutOfBoundsException",t}(yr),Tr=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Dr=function(e){function t(t,r){void 0===t&&(t=void 0),void 0===r&&(r=void 0);var n=e.call(this,r)||this;return n.index=t,n.message=r,n}return Tr(t,e),t.kind="ArrayIndexOutOfBoundsException",t}(Ir),Or=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Rr=function(){function e(){}return e.fill=function(e,t){for(var r=0,n=e.length;r<n;r++)e[r]=t},e.fillWithin=function(t,r,n,s){e.rangeCheck(t.length,r,n);for(var i=r;i<n;i++)t[i]=s},e.rangeCheck=function(e,t,r){if(t>r)throw new br("fromIndex("+t+") > toIndex("+r+")");if(t<0)throw new Dr(t);if(r>e)throw new Dr(r)},e.asList=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e},e.create=function(e,t,r){return Array.from({length:e}).map(function(e){return Array.from({length:t}).fill(r)})},e.createInt32Array=function(e,t,r){return Array.from({length:e}).map(function(e){return Int32Array.from({length:t}).fill(r)})},e.equals=function(e,t){if(!e)return!1;if(!t)return!1;if(!e.length)return!1;if(!t.length)return!1;if(e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0},e.hashCode=function(e){var t,r;if(null===e)return 0;var n=1;try{for(var s=Or(e),i=s.next();!i.done;i=s.next()){n=31*n+i.value}}catch(a){t={error:a}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return n},e.fillUint8Array=function(e,t){for(var r=0;r!==e.length;r++)e[r]=t},e.copyOf=function(e,t){return e.slice(0,t)},e.copyOfUint8Array=function(e,t){if(e.length<=t){var r=new Uint8Array(t);return r.set(e),r}return e.slice(0,t)},e.copyOfRange=function(e,t,r){var n=r-t,s=new Int32Array(n);return Sr.arraycopy(e,t,s,0,n),s},e.binarySearch=function(t,r,n){void 0===n&&(n=e.numberComparator);for(var s=0,i=t.length-1;s<=i;){var a=i+s>>1,o=n(r,t[a]);if(o>0)s=a+1;else{if(!(o<0))return a;i=a-1}}return-s-1},e.numberComparator=function(e,t){return e-t},e}(),kr=function(){function e(){}return e.numberOfTrailingZeros=function(e){var t;if(0===e)return 32;var r=31;return 0!==(t=e<<16)&&(r-=16,e=t),0!==(t=e<<8)&&(r-=8,e=t),0!==(t=e<<4)&&(r-=4,e=t),0!==(t=e<<2)&&(r-=2,e=t),r-(e<<1>>>31)},e.numberOfLeadingZeros=function(e){if(0===e)return 32;var t=1;return e>>>16==0&&(t+=16,e<<=16),e>>>24==0&&(t+=8,e<<=8),e>>>28==0&&(t+=4,e<<=4),e>>>30==0&&(t+=2,e<<=2),t-=e>>>31},e.toHexString=function(e){return e.toString(16)},e.toBinaryString=function(e){return String(parseInt(String(e),2))},e.bitCount=function(e){return e=(e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135,e+=e>>>8,63&(e+=e>>>16)},e.truncDivision=function(e,t){return Math.trunc(e/t)},e.parseInt=function(e,t){return void 0===t&&(t=void 0),parseInt(e,t)},e.MIN_VALUE_32_BITS=-2147483648,e.MAX_VALUE=Number.MAX_SAFE_INTEGER,e}(),Mr=function(){function e(t,r){void 0===t?(this.size=0,this.bits=new Int32Array(1)):(this.size=t,this.bits=null==r?e.makeArray(t):r)}return e.prototype.getSize=function(){return this.size},e.prototype.getSizeInBytes=function(){return Math.floor((this.size+7)/8)},e.prototype.ensureCapacity=function(t){if(t>32*this.bits.length){var r=e.makeArray(t);Sr.arraycopy(this.bits,0,r,0,this.bits.length),this.bits=r}},e.prototype.get=function(e){return!!(this.bits[Math.floor(e/32)]&1<<(31&e))},e.prototype.set=function(e){this.bits[Math.floor(e/32)]|=1<<(31&e)},e.prototype.flip=function(e){this.bits[Math.floor(e/32)]^=1<<(31&e)},e.prototype.getNextSet=function(e){var t=this.size;if(e>=t)return t;var r=this.bits,n=Math.floor(e/32),s=r[n];s&=~((1<<(31&e))-1);for(var i=r.length;0===s;){if(++n===i)return t;s=r[n]}var a=32*n+kr.numberOfTrailingZeros(s);return a>t?t:a},e.prototype.getNextUnset=function(e){var t=this.size;if(e>=t)return t;var r=this.bits,n=Math.floor(e/32),s=~r[n];s&=~((1<<(31&e))-1);for(var i=r.length;0===s;){if(++n===i)return t;s=~r[n]}var a=32*n+kr.numberOfTrailingZeros(s);return a>t?t:a},e.prototype.setBulk=function(e,t){this.bits[Math.floor(e/32)]=t},e.prototype.setRange=function(e,t){if(t<e||e<0||t>this.size)throw new br;if(t!==e){t--;for(var r=Math.floor(e/32),n=Math.floor(t/32),s=this.bits,i=r;i<=n;i++){var a=(2<<(i<n?31:31&t))-(1<<(i>r?0:31&e));s[i]|=a}}},e.prototype.clear=function(){for(var e=this.bits.length,t=this.bits,r=0;r<e;r++)t[r]=0},e.prototype.isRange=function(e,t,r){if(t<e||e<0||t>this.size)throw new br;if(t===e)return!0;t--;for(var n=Math.floor(e/32),s=Math.floor(t/32),i=this.bits,a=n;a<=s;a++){var o=(2<<(a<s?31:31&t))-(1<<(a>n?0:31&e))&4294967295;if((i[a]&o)!==(r?o:0))return!1}return!0},e.prototype.appendBit=function(e){this.ensureCapacity(this.size+1),e&&(this.bits[Math.floor(this.size/32)]|=1<<(31&this.size)),this.size++},e.prototype.appendBits=function(e,t){if(t<0||t>32)throw new br("Num bits must be between 0 and 32");this.ensureCapacity(this.size+t);for(var r=t;r>0;r--)this.appendBit(1==(e>>r-1&1))},e.prototype.appendBitArray=function(e){var t=e.size;this.ensureCapacity(this.size+t);for(var r=0;r<t;r++)this.appendBit(e.get(r))},e.prototype.xor=function(e){if(this.size!==e.size)throw new br("Sizes don't match");for(var t=this.bits,r=0,n=t.length;r<n;r++)t[r]^=e.bits[r]},e.prototype.toBytes=function(e,t,r,n){for(var s=0;s<n;s++){for(var i=0,a=0;a<8;a++)this.get(e)&&(i|=1<<7-a),e++;t[r+s]=i}},e.prototype.getBitArray=function(){return this.bits},e.prototype.reverse=function(){for(var e=new Int32Array(this.bits.length),t=Math.floor((this.size-1)/32),r=t+1,n=this.bits,s=0;s<r;s++){var i=n[s];i=(i=(i=(i=(i=i>>1&1431655765|(1431655765&i)<<1)>>2&858993459|(858993459&i)<<2)>>4&252645135|(252645135&i)<<4)>>8&16711935|(16711935&i)<<8)>>16&65535|(65535&i)<<16,e[t-s]=i}if(this.size!==32*r){var a=32*r-this.size,o=e[0]>>>a;for(s=1;s<r;s++){var l=e[s];o|=l<<32-a,e[s-1]=o,o=l>>>a}e[r-1]=o}this.bits=e},e.makeArray=function(e){return new Int32Array(Math.floor((e+31)/32))},e.prototype.equals=function(t){if(!(t instanceof e))return!1;var r=t;return this.size===r.size&&Rr.equals(this.bits,r.bits)},e.prototype.hashCode=function(){return 31*this.size+Rr.hashCode(this.bits)},e.prototype.toString=function(){for(var e="",t=0,r=this.size;t<r;t++)7&t||(e+=" "),e+=this.get(t)?"X":".";return e},e.prototype.clone=function(){return new e(this.size,this.bits.slice())},e.prototype.toArray=function(){for(var e=[],t=0,r=this.size;t<r;t++)e.push(this.get(t));return e},e}();(pr=fr||(fr={}))[pr.OTHER=0]="OTHER",pr[pr.PURE_BARCODE=1]="PURE_BARCODE",pr[pr.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",pr[pr.TRY_HARDER=3]="TRY_HARDER",pr[pr.CHARACTER_SET=4]="CHARACTER_SET",pr[pr.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",pr[pr.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",pr[pr.ENABLE_CODE_39_EXTENDED_MODE=7]="ENABLE_CODE_39_EXTENDED_MODE",pr[pr.ASSUME_GS1=8]="ASSUME_GS1",pr[pr.RETURN_CODABAR_START_END=9]="RETURN_CODABAR_START_END",pr[pr.NEED_RESULT_POINT_CALLBACK=10]="NEED_RESULT_POINT_CALLBACK",pr[pr.ALLOWED_EAN_EXTENSIONS=11]="ALLOWED_EAN_EXTENSIONS";const Pr=fr;var Br,Fr,Lr=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ur=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Lr(t,e),t.getFormatInstance=function(){return new t},t.kind="FormatException",t}(yr),Vr=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};(Fr=Br||(Br={}))[Fr.Cp437=0]="Cp437",Fr[Fr.ISO8859_1=1]="ISO8859_1",Fr[Fr.ISO8859_2=2]="ISO8859_2",Fr[Fr.ISO8859_3=3]="ISO8859_3",Fr[Fr.ISO8859_4=4]="ISO8859_4",Fr[Fr.ISO8859_5=5]="ISO8859_5",Fr[Fr.ISO8859_6=6]="ISO8859_6",Fr[Fr.ISO8859_7=7]="ISO8859_7",Fr[Fr.ISO8859_8=8]="ISO8859_8",Fr[Fr.ISO8859_9=9]="ISO8859_9",Fr[Fr.ISO8859_10=10]="ISO8859_10",Fr[Fr.ISO8859_11=11]="ISO8859_11",Fr[Fr.ISO8859_13=12]="ISO8859_13",Fr[Fr.ISO8859_14=13]="ISO8859_14",Fr[Fr.ISO8859_15=14]="ISO8859_15",Fr[Fr.ISO8859_16=15]="ISO8859_16",Fr[Fr.SJIS=16]="SJIS",Fr[Fr.Cp1250=17]="Cp1250",Fr[Fr.Cp1251=18]="Cp1251",Fr[Fr.Cp1252=19]="Cp1252",Fr[Fr.Cp1256=20]="Cp1256",Fr[Fr.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",Fr[Fr.UTF8=22]="UTF8",Fr[Fr.ASCII=23]="ASCII",Fr[Fr.Big5=24]="Big5",Fr[Fr.GB18030=25]="GB18030",Fr[Fr.EUC_KR=26]="EUC_KR";var Hr,Gr,Wr=function(){function e(t,r,n){for(var s,i,a=[],o=3;o<arguments.length;o++)a[o-3]=arguments[o];this.valueIdentifier=t,this.name=n,this.values="number"==typeof r?Int32Array.from([r]):r,this.otherEncodingNames=a,e.VALUE_IDENTIFIER_TO_ECI.set(t,this),e.NAME_TO_ECI.set(n,this);for(var l=this.values,c=0,d=l.length;c!==d;c++){var u=l[c];e.VALUES_TO_ECI.set(u,this)}try{for(var h=Vr(a),f=h.next();!f.done;f=h.next()){var p=f.value;e.NAME_TO_ECI.set(p,this)}}catch(m){s={error:m}}finally{try{f&&!f.done&&(i=h.return)&&i.call(h)}finally{if(s)throw s.error}}}return e.prototype.getValueIdentifier=function(){return this.valueIdentifier},e.prototype.getName=function(){return this.name},e.prototype.getValue=function(){return this.values[0]},e.getCharacterSetECIByValue=function(t){if(t<0||t>=900)throw new Ur("incorect value");var r=e.VALUES_TO_ECI.get(t);if(void 0===r)throw new Ur("incorect value");return r},e.getCharacterSetECIByName=function(t){var r=e.NAME_TO_ECI.get(t);if(void 0===r)throw new Ur("incorect value");return r},e.prototype.equals=function(t){if(!(t instanceof e))return!1;var r=t;return this.getName()===r.getName()},e.VALUE_IDENTIFIER_TO_ECI=new Map,e.VALUES_TO_ECI=new Map,e.NAME_TO_ECI=new Map,e.Cp437=new e(Br.Cp437,Int32Array.from([0,2]),"Cp437"),e.ISO8859_1=new e(Br.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),e.ISO8859_2=new e(Br.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),e.ISO8859_3=new e(Br.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),e.ISO8859_4=new e(Br.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),e.ISO8859_5=new e(Br.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),e.ISO8859_6=new e(Br.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),e.ISO8859_7=new e(Br.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),e.ISO8859_8=new e(Br.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),e.ISO8859_9=new e(Br.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),e.ISO8859_10=new e(Br.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),e.ISO8859_11=new e(Br.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),e.ISO8859_13=new e(Br.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),e.ISO8859_14=new e(Br.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),e.ISO8859_15=new e(Br.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),e.ISO8859_16=new e(Br.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),e.SJIS=new e(Br.SJIS,20,"SJIS","Shift_JIS"),e.Cp1250=new e(Br.Cp1250,21,"Cp1250","windows-1250"),e.Cp1251=new e(Br.Cp1251,22,"Cp1251","windows-1251"),e.Cp1252=new e(Br.Cp1252,23,"Cp1252","windows-1252"),e.Cp1256=new e(Br.Cp1256,24,"Cp1256","windows-1256"),e.UnicodeBigUnmarked=new e(Br.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),e.UTF8=new e(Br.UTF8,26,"UTF8","UTF-8"),e.ASCII=new e(Br.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),e.Big5=new e(Br.Big5,28,"Big5"),e.GB18030=new e(Br.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),e.EUC_KR=new e(Br.EUC_KR,30,"EUC_KR","EUC-KR"),e}(),zr=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Xr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return zr(t,e),t.kind="UnsupportedOperationException",t}(yr),Yr=function(){function e(){}return e.decode=function(e,t){var r=this.encodingName(t);return this.customDecoder?this.customDecoder(e,r):"undefined"==typeof TextDecoder||this.shouldDecodeOnFallback(r)?this.decodeFallback(e,r):new TextDecoder(r).decode(e)},e.shouldDecodeOnFallback=function(t){return!e.isBrowser()&&"ISO-8859-1"===t},e.encode=function(e,t){var r=this.encodingName(t);return this.customEncoder?this.customEncoder(e,r):"undefined"==typeof TextEncoder?this.encodeFallback(e):(new TextEncoder).encode(e)},e.isBrowser=function(){return"undefined"!=typeof window&&"[object Window]"==={}.toString.call(window)},e.encodingName=function(e){return"string"==typeof e?e:e.getName()},e.encodingCharacterSet=function(e){return e instanceof Wr?e:Wr.getCharacterSetECIByName(e)},e.decodeFallback=function(t,r){var n=this.encodingCharacterSet(r);if(e.isDecodeFallbackSupported(n)){for(var s="",i=0,a=t.length;i<a;i++){var o=t[i].toString(16);o.length<2&&(o="0"+o),s+="%"+o}return decodeURIComponent(s)}if(n.equals(Wr.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(t.buffer));throw new Xr("Encoding "+this.encodingName(r)+" not supported by fallback.")},e.isDecodeFallbackSupported=function(e){return e.equals(Wr.UTF8)||e.equals(Wr.ISO8859_1)||e.equals(Wr.ASCII)},e.encodeFallback=function(e){for(var t=btoa(unescape(encodeURIComponent(e))).split(""),r=[],n=0;n<t.length;n++)r.push(t[n].charCodeAt(0));return new Uint8Array(r)},e}(),qr=function(){function e(){}return e.castAsNonUtf8Char=function(e,t){void 0===t&&(t=null);var r=t?t.getName():this.ISO88591;return Yr.decode(new Uint8Array([e]),r)},e.guessEncoding=function(t,r){if(null!=r&&void 0!==r.get(Pr.CHARACTER_SET))return r.get(Pr.CHARACTER_SET).toString();for(var n=t.length,s=!0,i=!0,a=!0,o=0,l=0,c=0,d=0,u=0,h=0,f=0,p=0,m=0,g=0,x=0,y=t.length>3&&239===t[0]&&187===t[1]&&191===t[2],v=0;v<n&&(s||i||a);v++){var w=255&t[v];a&&(o>0?128&w?o--:a=!1:128&w&&(64&w?(o++,32&w?(o++,16&w?(o++,8&w?a=!1:d++):c++):l++):a=!1)),s&&(w>127&&w<160?s=!1:w>159&&(w<192||215===w||247===w)&&x++),i&&(u>0?w<64||127===w||w>252?i=!1:u--:128===w||160===w||w>239?i=!1:w>160&&w<224?(h++,p=0,++f>m&&(m=f)):w>127?(u++,f=0,++p>g&&(g=p)):(f=0,p=0))}return a&&o>0&&(a=!1),i&&u>0&&(i=!1),a&&(y||l+c+d>0)?e.UTF8:i&&(e.ASSUME_SHIFT_JIS||m>=3||g>=3)?e.SHIFT_JIS:s&&i?2===m&&2===h||10*x>=n?e.SHIFT_JIS:e.ISO88591:s?e.ISO88591:i?e.SHIFT_JIS:a?e.UTF8:e.PLATFORM_DEFAULT_ENCODING},e.format=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=-1;return e.replace(/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g,function(e,r,s,i,a,o){if("%%"===e)return"%";if(void 0!==t[++n]){e=i?parseInt(i.substr(1)):void 0;var l,c=a?parseInt(a.substr(1)):void 0;switch(o){case"s":l=t[n];break;case"c":l=t[n][0];break;case"f":l=parseFloat(t[n]).toFixed(e);break;case"p":l=parseFloat(t[n]).toPrecision(e);break;case"e":l=parseFloat(t[n]).toExponential(e);break;case"x":l=parseInt(t[n]).toString(c||16);break;case"d":l=parseFloat(parseInt(t[n],c||10).toPrecision(e)).toFixed(0)}l="object"==typeof l?JSON.stringify(l):(+l).toString(c);for(var d=parseInt(s),u=s&&s[0]+""=="0"?"0":" ";l.length<d;)l=void 0!==r?l+u:u+l;return l}})},e.getBytes=function(e,t){return Yr.encode(e,t)},e.getCharCode=function(e,t){return void 0===t&&(t=0),e.charCodeAt(t)},e.getCharAt=function(e){return String.fromCharCode(e)},e.SHIFT_JIS=Wr.SJIS.getName(),e.GB2312="GB2312",e.ISO88591=Wr.ISO8859_1.getName(),e.EUC_JP="EUC_JP",e.UTF8=Wr.UTF8.getName(),e.PLATFORM_DEFAULT_ENCODING=e.UTF8,e.ASSUME_SHIFT_JIS=!1,e}(),Kr=function(){function e(e){void 0===e&&(e=""),this.value=e}return e.prototype.enableDecoding=function(e){return this.encoding=e,this},e.prototype.append=function(e){return"string"==typeof e?this.value+=e.toString():this.encoding?this.value+=qr.castAsNonUtf8Char(e,this.encoding):this.value+=String.fromCharCode(e),this},e.prototype.appendChars=function(e,t,r){for(var n=t;t<t+r;n++)this.append(e[n]);return this},e.prototype.length=function(){return this.value.length},e.prototype.charAt=function(e){return this.value.charAt(e)},e.prototype.deleteCharAt=function(e){this.value=this.value.substr(0,e)+this.value.substring(e+1)},e.prototype.setCharAt=function(e,t){this.value=this.value.substr(0,e)+t+this.value.substr(e+1)},e.prototype.substring=function(e,t){return this.value.substring(e,t)},e.prototype.setLengthToZero=function(){this.value=""},e.prototype.toString=function(){return this.value},e.prototype.insert=function(e,t){this.value=this.value.substring(0,e)+t+this.value.substring(e)},e}(),Zr=function(){function e(e,t,r,n){if(this.width=e,this.height=t,this.rowSize=r,this.bits=n,null==t&&(t=e),this.height=t,e<1||t<1)throw new br("Both dimensions must be greater than 0");null==r&&(r=Math.floor((e+31)/32)),this.rowSize=r,null==n&&(this.bits=new Int32Array(this.rowSize*this.height))}return e.parseFromBooleanArray=function(t){for(var r=t.length,n=t[0].length,s=new e(n,r),i=0;i<r;i++)for(var a=t[i],o=0;o<n;o++)a[o]&&s.set(o,i);return s},e.parseFromString=function(t,r,n){if(null===t)throw new br("stringRepresentation cannot be null");for(var s=new Array(t.length),i=0,a=0,o=-1,l=0,c=0;c<t.length;)if("\n"===t.charAt(c)||"\r"===t.charAt(c)){if(i>a){if(-1===o)o=i-a;else if(i-a!==o)throw new br("row lengths do not match");a=i,l++}c++}else if(t.substring(c,c+r.length)===r)c+=r.length,s[i]=!0,i++;else{if(t.substring(c,c+n.length)!==n)throw new br("illegal character encountered: "+t.substring(c));c+=n.length,s[i]=!1,i++}if(i>a){if(-1===o)o=i-a;else if(i-a!==o)throw new br("row lengths do not match");l++}for(var d=new e(o,l),u=0;u<i;u++)s[u]&&d.set(Math.floor(u%o),Math.floor(u/o));return d},e.prototype.get=function(e,t){var r=t*this.rowSize+Math.floor(e/32);return!!(this.bits[r]>>>(31&e)&1)},e.prototype.set=function(e,t){var r=t*this.rowSize+Math.floor(e/32);this.bits[r]|=1<<(31&e)&4294967295},e.prototype.unset=function(e,t){var r=t*this.rowSize+Math.floor(e/32);this.bits[r]&=~(1<<(31&e)&4294967295)},e.prototype.flip=function(e,t){var r=t*this.rowSize+Math.floor(e/32);this.bits[r]^=1<<(31&e)&4294967295},e.prototype.xor=function(e){if(this.width!==e.getWidth()||this.height!==e.getHeight()||this.rowSize!==e.getRowSize())throw new br("input matrix dimensions do not match");for(var t=new Mr(Math.floor(this.width/32)+1),r=this.rowSize,n=this.bits,s=0,i=this.height;s<i;s++)for(var a=s*r,o=e.getRow(s,t).getBitArray(),l=0;l<r;l++)n[a+l]^=o[l]},e.prototype.clear=function(){for(var e=this.bits,t=e.length,r=0;r<t;r++)e[r]=0},e.prototype.setRegion=function(e,t,r,n){if(t<0||e<0)throw new br("Left and top must be nonnegative");if(n<1||r<1)throw new br("Height and width must be at least 1");var s=e+r,i=t+n;if(i>this.height||s>this.width)throw new br("The region must fit inside the matrix");for(var a=this.rowSize,o=this.bits,l=t;l<i;l++)for(var c=l*a,d=e;d<s;d++)o[c+Math.floor(d/32)]|=1<<(31&d)&4294967295},e.prototype.getRow=function(e,t){null==t||t.getSize()<this.width?t=new Mr(this.width):t.clear();for(var r=this.rowSize,n=this.bits,s=e*r,i=0;i<r;i++)t.setBulk(32*i,n[s+i]);return t},e.prototype.setRow=function(e,t){Sr.arraycopy(t.getBitArray(),0,this.bits,e*this.rowSize,this.rowSize)},e.prototype.rotate180=function(){for(var e=this.getWidth(),t=this.getHeight(),r=new Mr(e),n=new Mr(e),s=0,i=Math.floor((t+1)/2);s<i;s++)r=this.getRow(s,r),n=this.getRow(t-1-s,n),r.reverse(),n.reverse(),this.setRow(s,n),this.setRow(t-1-s,r)},e.prototype.getEnclosingRectangle=function(){for(var e=this.width,t=this.height,r=this.rowSize,n=this.bits,s=e,i=t,a=-1,o=-1,l=0;l<t;l++)for(var c=0;c<r;c++){var d=n[l*r+c];if(0!==d){if(l<i&&(i=l),l>o&&(o=l),32*c<s){for(var u=0;!(d<<31-u&4294967295);)u++;32*c+u<s&&(s=32*c+u)}if(32*c+31>a){for(u=31;d>>>u===0;)u--;32*c+u>a&&(a=32*c+u)}}}return a<s||o<i?null:Int32Array.from([s,i,a-s+1,o-i+1])},e.prototype.getTopLeftOnBit=function(){for(var e=this.rowSize,t=this.bits,r=0;r<t.length&&0===t[r];)r++;if(r===t.length)return null;for(var n=r/e,s=r%e*32,i=t[r],a=0;!(i<<31-a&4294967295);)a++;return s+=a,Int32Array.from([s,n])},e.prototype.getBottomRightOnBit=function(){for(var e=this.rowSize,t=this.bits,r=t.length-1;r>=0&&0===t[r];)r--;if(r<0)return null;for(var n=Math.floor(r/e),s=32*Math.floor(r%e),i=t[r],a=31;i>>>a===0;)a--;return s+=a,Int32Array.from([s,n])},e.prototype.getWidth=function(){return this.width},e.prototype.getHeight=function(){return this.height},e.prototype.getRowSize=function(){return this.rowSize},e.prototype.equals=function(t){if(!(t instanceof e))return!1;var r=t;return this.width===r.width&&this.height===r.height&&this.rowSize===r.rowSize&&Rr.equals(this.bits,r.bits)},e.prototype.hashCode=function(){var e=this.width;return e=31*(e=31*(e=31*(e=31*e+this.width)+this.height)+this.rowSize)+Rr.hashCode(this.bits)},e.prototype.toString=function(e,t,r){return void 0===e&&(e="X "),void 0===t&&(t="  "),void 0===r&&(r="\n"),this.buildToString(e,t,r)},e.prototype.buildToString=function(e,t,r){for(var n=new Kr,s=0,i=this.height;s<i;s++){for(var a=0,o=this.width;a<o;a++)n.append(this.get(a,s)?e:t);n.append(r)}return n.toString()},e.prototype.clone=function(){return new e(this.width,this.height,this.rowSize,this.bits.slice())},e}(),$r=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Qr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $r(t,e),t.getNotFoundInstance=function(){return new t},t.kind="NotFoundException",t}(yr),Jr=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),en=function(e){function t(r){var n=e.call(this,r)||this;return n.luminances=t.EMPTY,n.buckets=new Int32Array(t.LUMINANCE_BUCKETS),n}return Jr(t,e),t.prototype.getBlackRow=function(e,r){var n=this.getLuminanceSource(),s=n.getWidth();null==r||r.getSize()<s?r=new Mr(s):r.clear(),this.initArrays(s);for(var i=n.getRow(e,this.luminances),a=this.buckets,o=0;o<s;o++)a[(255&i[o])>>t.LUMINANCE_SHIFT]++;var l=t.estimateBlackPoint(a);if(s<3)for(o=0;o<s;o++)(255&i[o])<l&&r.set(o);else{var c=255&i[0],d=255&i[1];for(o=1;o<s-1;o++){var u=255&i[o+1];(4*d-c-u)/2<l&&r.set(o),c=d,d=u}}return r},t.prototype.getBlackMatrix=function(){var e=this.getLuminanceSource(),r=e.getWidth(),n=e.getHeight(),s=new Zr(r,n);this.initArrays(r);for(var i=this.buckets,a=1;a<5;a++)for(var o=Math.floor(n*a/5),l=e.getRow(o,this.luminances),c=Math.floor(4*r/5),d=Math.floor(r/5);d<c;d++){i[(255&l[d])>>t.LUMINANCE_SHIFT]++}var u=t.estimateBlackPoint(i),h=e.getMatrix();for(a=0;a<n;a++){var f=a*r;for(d=0;d<r;d++){(255&h[f+d])<u&&s.set(d,a)}}return s},t.prototype.createBinarizer=function(e){return new t(e)},t.prototype.initArrays=function(e){this.luminances.length<e&&(this.luminances=new Uint8ClampedArray(e));for(var r=this.buckets,n=0;n<t.LUMINANCE_BUCKETS;n++)r[n]=0},t.estimateBlackPoint=function(e){for(var r=e.length,n=0,s=0,i=0,a=0;a<r;a++)e[a]>i&&(s=a,i=e[a]),e[a]>n&&(n=e[a]);var o=0,l=0;for(a=0;a<r;a++){var c=a-s;(f=e[a]*c*c)>l&&(o=a,l=f)}if(s>o){var d=s;s=o,o=d}if(o-s<=r/16)throw new Qr;var u=o-1,h=-1;for(a=o-1;a>s;a--){var f,p=a-s;(f=p*p*(o-a)*(n-e[a]))>h&&(u=a,h=f)}return u<<t.LUMINANCE_SHIFT},t.LUMINANCE_BITS=5,t.LUMINANCE_SHIFT=8-t.LUMINANCE_BITS,t.LUMINANCE_BUCKETS=1<<t.LUMINANCE_BITS,t.EMPTY=Uint8ClampedArray.from([0]),t}(Ar),tn=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),rn=function(e){function t(t){var r=e.call(this,t)||this;return r.matrix=null,r}return tn(t,e),t.prototype.getBlackMatrix=function(){if(null!==this.matrix)return this.matrix;var r=this.getLuminanceSource(),n=r.getWidth(),s=r.getHeight();if(n>=t.MINIMUM_DIMENSION&&s>=t.MINIMUM_DIMENSION){var i=r.getMatrix(),a=n>>t.BLOCK_SIZE_POWER;0!==(n&t.BLOCK_SIZE_MASK)&&a++;var o=s>>t.BLOCK_SIZE_POWER;0!==(s&t.BLOCK_SIZE_MASK)&&o++;var l=t.calculateBlackPoints(i,a,o,n,s),c=new Zr(n,s);t.calculateThresholdForBlock(i,a,o,n,s,l,c),this.matrix=c}else this.matrix=e.prototype.getBlackMatrix.call(this);return this.matrix},t.prototype.createBinarizer=function(e){return new t(e)},t.calculateThresholdForBlock=function(e,r,n,s,i,a,o){for(var l=i-t.BLOCK_SIZE,c=s-t.BLOCK_SIZE,d=0;d<n;d++){var u=d<<t.BLOCK_SIZE_POWER;u>l&&(u=l);for(var h=t.cap(d,2,n-3),f=0;f<r;f++){var p=f<<t.BLOCK_SIZE_POWER;p>c&&(p=c);for(var m=t.cap(f,2,r-3),g=0,x=-2;x<=2;x++){var y=a[h+x];g+=y[m-2]+y[m-1]+y[m]+y[m+1]+y[m+2]}var v=g/25;t.thresholdBlock(e,p,u,v,s,o)}}},t.cap=function(e,t,r){return e<t?t:e>r?r:e},t.thresholdBlock=function(e,r,n,s,i,a){for(var o=0,l=n*i+r;o<t.BLOCK_SIZE;o++,l+=i)for(var c=0;c<t.BLOCK_SIZE;c++)(255&e[l+c])<=s&&a.set(r+c,n+o)},t.calculateBlackPoints=function(e,r,n,s,i){for(var a=i-t.BLOCK_SIZE,o=s-t.BLOCK_SIZE,l=new Array(n),c=0;c<n;c++){l[c]=new Int32Array(r);var d=c<<t.BLOCK_SIZE_POWER;d>a&&(d=a);for(var u=0;u<r;u++){var h=u<<t.BLOCK_SIZE_POWER;h>o&&(h=o);for(var f=0,p=255,m=0,g=0,x=d*s+h;g<t.BLOCK_SIZE;g++,x+=s){for(var y=0;y<t.BLOCK_SIZE;y++){var v=255&e[x+y];f+=v,v<p&&(p=v),v>m&&(m=v)}if(m-p>t.MIN_DYNAMIC_RANGE)for(g++,x+=s;g<t.BLOCK_SIZE;g++,x+=s)for(y=0;y<t.BLOCK_SIZE;y++)f+=255&e[x+y]}var w=f>>2*t.BLOCK_SIZE_POWER;if(m-p<=t.MIN_DYNAMIC_RANGE&&(w=p/2,c>0&&u>0)){var _=(l[c-1][u]+2*l[c][u-1]+l[c-1][u-1])/4;p<_&&(w=_)}l[c][u]=w}}return l},t.BLOCK_SIZE_POWER=3,t.BLOCK_SIZE=1<<t.BLOCK_SIZE_POWER,t.BLOCK_SIZE_MASK=t.BLOCK_SIZE-1,t.MINIMUM_DIMENSION=5*t.BLOCK_SIZE,t.MIN_DYNAMIC_RANGE=24,t}(en),nn=function(){function e(e,t){this.width=e,this.height=t}return e.prototype.getWidth=function(){return this.width},e.prototype.getHeight=function(){return this.height},e.prototype.isCropSupported=function(){return!1},e.prototype.crop=function(e,t,r,n){throw new Xr("This luminance source does not support cropping.")},e.prototype.isRotateSupported=function(){return!1},e.prototype.rotateCounterClockwise=function(){throw new Xr("This luminance source does not support rotation by 90 degrees.")},e.prototype.rotateCounterClockwise45=function(){throw new Xr("This luminance source does not support rotation by 45 degrees.")},e.prototype.toString=function(){for(var e=new Uint8ClampedArray(this.width),t=new Kr,r=0;r<this.height;r++){for(var n=this.getRow(r,e),s=0;s<this.width;s++){var i=255&n[s],a=void 0;a=i<64?"#":i<128?"+":i<192?".":" ",t.append(a)}t.append("\n")}return t.toString()},e}(),sn=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),an=function(e){function t(t){var r=e.call(this,t.getWidth(),t.getHeight())||this;return r.delegate=t,r}return sn(t,e),t.prototype.getRow=function(e,t){for(var r=this.delegate.getRow(e,t),n=this.getWidth(),s=0;s<n;s++)r[s]=255-(255&r[s]);return r},t.prototype.getMatrix=function(){for(var e=this.delegate.getMatrix(),t=this.getWidth()*this.getHeight(),r=new Uint8ClampedArray(t),n=0;n<t;n++)r[n]=255-(255&e[n]);return r},t.prototype.isCropSupported=function(){return this.delegate.isCropSupported()},t.prototype.crop=function(e,r,n,s){return new t(this.delegate.crop(e,r,n,s))},t.prototype.isRotateSupported=function(){return this.delegate.isRotateSupported()},t.prototype.invert=function(){return this.delegate},t.prototype.rotateCounterClockwise=function(){return new t(this.delegate.rotateCounterClockwise())},t.prototype.rotateCounterClockwise45=function(){return new t(this.delegate.rotateCounterClockwise45())},t}(nn),on=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ln=function(e){function t(r,n){void 0===n&&(n=!1);var s=e.call(this,r.width,r.height)||this;return s.canvas=r,s.tempCanvasElement=null,s.buffer=t.makeBufferFromCanvasImageData(r,n),s}return on(t,e),t.makeBufferFromCanvasImageData=function(e,r){void 0===r&&(r=!1);var n=e.getContext("2d").getImageData(0,0,e.width,e.height);return t.toGrayscaleBuffer(n.data,e.width,e.height,r)},t.toGrayscaleBuffer=function(e,r,n,s){void 0===s&&(s=!1);var i=new Uint8ClampedArray(r*n);if(t.FRAME_INDEX=!t.FRAME_INDEX,t.FRAME_INDEX||!s)for(var a=0,o=0,l=e.length;a<l;a+=4,o++){var c=void 0;if(0===e[a+3])c=255;else c=306*e[a]+601*e[a+1]+117*e[a+2]+512>>10;i[o]=c}else{a=0,o=0;for(var d=e.length;a<d;a+=4,o++){c=void 0;if(0===e[a+3])c=255;else c=306*e[a]+601*e[a+1]+117*e[a+2]+512>>10;i[o]=255-c}}return i},t.prototype.getRow=function(e,t){if(e<0||e>=this.getHeight())throw new br("Requested row is outside the image: "+e);var r=this.getWidth(),n=e*r;return null===t?t=this.buffer.slice(n,n+r):(t.length<r&&(t=new Uint8ClampedArray(r)),t.set(this.buffer.slice(n,n+r))),t},t.prototype.getMatrix=function(){return this.buffer},t.prototype.isCropSupported=function(){return!0},t.prototype.crop=function(t,r,n,s){return e.prototype.crop.call(this,t,r,n,s),this},t.prototype.isRotateSupported=function(){return!0},t.prototype.rotateCounterClockwise=function(){return this.rotate(-90),this},t.prototype.rotateCounterClockwise45=function(){return this.rotate(-45),this},t.prototype.getTempCanvasElement=function(){if(null===this.tempCanvasElement){var e=this.canvas.ownerDocument.createElement("canvas");e.width=this.canvas.width,e.height=this.canvas.height,this.tempCanvasElement=e}return this.tempCanvasElement},t.prototype.rotate=function(e){var r=this.getTempCanvasElement(),n=r.getContext("2d"),s=e*t.DEGREE_TO_RADIANS,i=this.canvas.width,a=this.canvas.height,o=Math.ceil(Math.abs(Math.cos(s))*i+Math.abs(Math.sin(s))*a),l=Math.ceil(Math.abs(Math.sin(s))*i+Math.abs(Math.cos(s))*a);return r.width=o,r.height=l,n.translate(o/2,l/2),n.rotate(s),n.drawImage(this.canvas,i/-2,a/-2),this.buffer=t.makeBufferFromCanvasImageData(r),this},t.prototype.invert=function(){return new an(this)},t.DEGREE_TO_RADIANS=Math.PI/180,t.FRAME_INDEX=!0,t}(nn),cn=function(){function e(e,t,r){this.deviceId=e,this.label=t,this.kind="videoinput",this.groupId=r||void 0}return e.prototype.toJSON=function(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}},e}(),dn=globalThis&&globalThis.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(s,i){function a(e){try{l(n.next(e))}catch(t){i(t)}}function o(e){try{l(n.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,o)}l((n=n.apply(e,t||[])).next())})},un=globalThis&&globalThis.__generator||function(e,t){var r,n,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(s=2&i[0]?n.return:i[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,i[1])).done)return s;switch(n=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(s=a.trys,(s=s.length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){a.label=i[1];break}if(6===i[0]&&a.label<s[1]){a.label=s[1],s=i;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(i);break}s[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(o){i=[6,o],n=0}finally{r=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},hn=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},fn=function(){function e(e,t,r){void 0===t&&(t=500),this.reader=e,this.timeBetweenScansMillis=t,this._hints=r,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}return Object.defineProperty(e.prototype,"hasNavigator",{get:function(){return"undefined"!=typeof navigator},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isMediaDevicesSuported",{get:function(){return this.hasNavigator&&!!navigator.mediaDevices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canEnumerateDevices",{get:function(){return!(!this.isMediaDevicesSuported||!navigator.mediaDevices.enumerateDevices)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"timeBetweenDecodingAttempts",{get:function(){return this._timeBetweenDecodingAttempts},set:function(e){this._timeBetweenDecodingAttempts=e<0?0:e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hints",{get:function(){return this._hints},set:function(e){this._hints=e||null},enumerable:!1,configurable:!0}),e.prototype.listVideoInputDevices=function(){return dn(this,void 0,void 0,function(){var e,t,r,n,s,i,a,o,l,c,d,u;return un(this,function(h){switch(h.label){case 0:if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");return[4,navigator.mediaDevices.enumerateDevices()];case 1:e=h.sent(),t=[];try{for(r=hn(e),n=r.next();!n.done;n=r.next())s=n.value,"videoinput"===(i="video"===s.kind?"videoinput":s.kind)&&(a=s.deviceId||s.id,o=s.label||"Video device "+(t.length+1),l=s.groupId,c={deviceId:a,label:o,kind:i,groupId:l},t.push(c))}catch(f){d={error:f}}finally{try{n&&!n.done&&(u=r.return)&&u.call(r)}finally{if(d)throw d.error}}return[2,t]}})})},e.prototype.getVideoInputDevices=function(){return dn(this,void 0,void 0,function(){return un(this,function(e){switch(e.label){case 0:return[4,this.listVideoInputDevices()];case 1:return[2,e.sent().map(function(e){return new cn(e.deviceId,e.label)})]}})})},e.prototype.findDeviceById=function(e){return dn(this,void 0,void 0,function(){var t;return un(this,function(r){switch(r.label){case 0:return[4,this.listVideoInputDevices()];case 1:return(t=r.sent())?[2,t.find(function(t){return t.deviceId===e})]:[2,null]}})})},e.prototype.decodeFromInputVideoDevice=function(e,t){return dn(this,void 0,void 0,function(){return un(this,function(r){switch(r.label){case 0:return[4,this.decodeOnceFromVideoDevice(e,t)];case 1:return[2,r.sent()]}})})},e.prototype.decodeOnceFromVideoDevice=function(e,t){return dn(this,void 0,void 0,function(){var r;return un(this,function(n){switch(n.label){case 0:return this.reset(),r={video:e?{deviceId:{exact:e}}:{facingMode:"environment"}},[4,this.decodeOnceFromConstraints(r,t)];case 1:return[2,n.sent()]}})})},e.prototype.decodeOnceFromConstraints=function(e,t){return dn(this,void 0,void 0,function(){var r;return un(this,function(n){switch(n.label){case 0:return[4,navigator.mediaDevices.getUserMedia(e)];case 1:return r=n.sent(),[4,this.decodeOnceFromStream(r,t)];case 2:return[2,n.sent()]}})})},e.prototype.decodeOnceFromStream=function(e,t){return dn(this,void 0,void 0,function(){var r;return un(this,function(n){switch(n.label){case 0:return this.reset(),[4,this.attachStreamToVideo(e,t)];case 1:return r=n.sent(),[4,this.decodeOnce(r)];case 2:return[2,n.sent()]}})})},e.prototype.decodeFromInputVideoDeviceContinuously=function(e,t,r){return dn(this,void 0,void 0,function(){return un(this,function(n){switch(n.label){case 0:return[4,this.decodeFromVideoDevice(e,t,r)];case 1:return[2,n.sent()]}})})},e.prototype.decodeFromVideoDevice=function(e,t,r){return dn(this,void 0,void 0,function(){var n;return un(this,function(s){switch(s.label){case 0:return n={video:e?{deviceId:{exact:e}}:{facingMode:"environment"}},[4,this.decodeFromConstraints(n,t,r)];case 1:return[2,s.sent()]}})})},e.prototype.decodeFromConstraints=function(e,t,r){return dn(this,void 0,void 0,function(){var n;return un(this,function(s){switch(s.label){case 0:return[4,navigator.mediaDevices.getUserMedia(e)];case 1:return n=s.sent(),[4,this.decodeFromStream(n,t,r)];case 2:return[2,s.sent()]}})})},e.prototype.decodeFromStream=function(e,t,r){return dn(this,void 0,void 0,function(){var n;return un(this,function(s){switch(s.label){case 0:return this.reset(),[4,this.attachStreamToVideo(e,t)];case 1:return n=s.sent(),[4,this.decodeContinuously(n,r)];case 2:return[2,s.sent()]}})})},e.prototype.stopAsyncDecode=function(){this._stopAsyncDecode=!0},e.prototype.stopContinuousDecode=function(){this._stopContinuousDecode=!0},e.prototype.attachStreamToVideo=function(e,t){return dn(this,void 0,void 0,function(){var r;return un(this,function(n){switch(n.label){case 0:return r=this.prepareVideoElement(t),this.addVideoSource(r,e),this.videoElement=r,this.stream=e,[4,this.playVideoOnLoadAsync(r)];case 1:return n.sent(),[2,r]}})})},e.prototype.playVideoOnLoadAsync=function(e){var t=this;return new Promise(function(r,n){return t.playVideoOnLoad(e,function(){return r()})})},e.prototype.playVideoOnLoad=function(e,t){var r=this;this.videoEndedListener=function(){return r.stopStreams()},this.videoCanPlayListener=function(){return r.tryPlayVideo(e)},e.addEventListener("ended",this.videoEndedListener),e.addEventListener("canplay",this.videoCanPlayListener),e.addEventListener("playing",t),this.tryPlayVideo(e)},e.prototype.isVideoPlaying=function(e){return e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2},e.prototype.tryPlayVideo=function(e){return dn(this,void 0,void 0,function(){return un(this,function(t){switch(t.label){case 0:if(this.isVideoPlaying(e))return[2];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,e.play()];case 2:case 3:return t.sent(),[3,4];case 4:return[2]}})})},e.prototype.getMediaElement=function(e,t){var r=document.getElementById(e);if(!r)throw new wr("element with id '"+e+"' not found");if(r.nodeName.toLowerCase()!==t.toLowerCase())throw new wr("element with id '"+e+"' must be an "+t+" element");return r},e.prototype.decodeFromImage=function(e,t){if(!e&&!t)throw new wr("either imageElement with a src set or an url must be provided");return t&&!e?this.decodeFromImageUrl(t):this.decodeFromImageElement(e)},e.prototype.decodeFromVideo=function(e,t){if(!e&&!t)throw new wr("Either an element with a src set or an URL must be provided");return t&&!e?this.decodeFromVideoUrl(t):this.decodeFromVideoElement(e)},e.prototype.decodeFromVideoContinuously=function(e,t,r){if(void 0===e&&void 0===t)throw new wr("Either an element with a src set or an URL must be provided");return t&&!e?this.decodeFromVideoUrlContinuously(t,r):this.decodeFromVideoElementContinuously(e,r)},e.prototype.decodeFromImageElement=function(e){if(!e)throw new wr("An image element must be provided.");this.reset();var t=this.prepareImageElement(e);return this.imageElement=t,this.isImageLoaded(t)?this.decodeOnce(t,!1,!0):this._decodeOnLoadImage(t)},e.prototype.decodeFromVideoElement=function(e){var t=this._decodeFromVideoElementSetup(e);return this._decodeOnLoadVideo(t)},e.prototype.decodeFromVideoElementContinuously=function(e,t){var r=this._decodeFromVideoElementSetup(e);return this._decodeOnLoadVideoContinuously(r,t)},e.prototype._decodeFromVideoElementSetup=function(e){if(!e)throw new wr("A video element must be provided.");this.reset();var t=this.prepareVideoElement(e);return this.videoElement=t,t},e.prototype.decodeFromImageUrl=function(e){if(!e)throw new wr("An URL must be provided.");this.reset();var t=this.prepareImageElement();this.imageElement=t;var r=this._decodeOnLoadImage(t);return t.src=e,r},e.prototype.decodeFromVideoUrl=function(e){if(!e)throw new wr("An URL must be provided.");this.reset();var t=this.prepareVideoElement(),r=this.decodeFromVideoElement(t);return t.src=e,r},e.prototype.decodeFromVideoUrlContinuously=function(e,t){if(!e)throw new wr("An URL must be provided.");this.reset();var r=this.prepareVideoElement(),n=this.decodeFromVideoElementContinuously(r,t);return r.src=e,n},e.prototype._decodeOnLoadImage=function(e){var t=this;return new Promise(function(r,n){t.imageLoadedListener=function(){return t.decodeOnce(e,!1,!0).then(r,n)},e.addEventListener("load",t.imageLoadedListener)})},e.prototype._decodeOnLoadVideo=function(e){return dn(this,void 0,void 0,function(){return un(this,function(t){switch(t.label){case 0:return[4,this.playVideoOnLoadAsync(e)];case 1:return t.sent(),[4,this.decodeOnce(e)];case 2:return[2,t.sent()]}})})},e.prototype._decodeOnLoadVideoContinuously=function(e,t){return dn(this,void 0,void 0,function(){return un(this,function(r){switch(r.label){case 0:return[4,this.playVideoOnLoadAsync(e)];case 1:return r.sent(),this.decodeContinuously(e,t),[2]}})})},e.prototype.isImageLoaded=function(e){return!!e.complete&&0!==e.naturalWidth},e.prototype.prepareImageElement=function(e){var t;return void 0===e&&((t=document.createElement("img")).width=200,t.height=200),"string"==typeof e&&(t=this.getMediaElement(e,"img")),e instanceof HTMLImageElement&&(t=e),t},e.prototype.prepareVideoElement=function(e){var t;return e||"undefined"==typeof document||((t=document.createElement("video")).width=200,t.height=200),"string"==typeof e&&(t=this.getMediaElement(e,"video")),e instanceof HTMLVideoElement&&(t=e),t.setAttribute("autoplay","true"),t.setAttribute("muted","true"),t.setAttribute("playsinline","true"),t},e.prototype.decodeOnce=function(e,t,r){var n=this;void 0===t&&(t=!0),void 0===r&&(r=!0),this._stopAsyncDecode=!1;var s=function(i,a){if(n._stopAsyncDecode)return a(new Qr("Video stream has ended before any code could be detected.")),void(n._stopAsyncDecode=void 0);try{i(n.decode(e))}catch(o){if(t&&o instanceof Qr||(o instanceof Cr||o instanceof Ur)&&r)return setTimeout(s,n._timeBetweenDecodingAttempts,i,a);a(o)}};return new Promise(function(e,t){return s(e,t)})},e.prototype.decodeContinuously=function(e,t){var r=this;this._stopContinuousDecode=!1;var n=function(){if(r._stopContinuousDecode)r._stopContinuousDecode=void 0;else try{var s=r.decode(e);t(s,null),setTimeout(n,r.timeBetweenScansMillis)}catch(i){t(null,i),(i instanceof Cr||i instanceof Ur||i instanceof Qr)&&setTimeout(n,r._timeBetweenDecodingAttempts)}};n()},e.prototype.decode=function(e){var t=this.createBinaryBitmap(e);return this.decodeBitmap(t)},e.prototype.createBinaryBitmap=function(e){this.getCaptureCanvasContext(e);var t=!1;e instanceof HTMLVideoElement?(this.drawFrameOnCanvas(e),t=!0):this.drawImageOnCanvas(e);var r=this.getCaptureCanvas(e),n=new ln(r,t),s=new rn(n);return new Nr(s)},e.prototype.getCaptureCanvasContext=function(e){if(!this.captureCanvasContext){var t=this.getCaptureCanvas(e),r=void 0;try{r=t.getContext("2d",{willReadFrequently:!0})}catch(n){r=t.getContext("2d")}this.captureCanvasContext=r}return this.captureCanvasContext},e.prototype.getCaptureCanvas=function(e){if(!this.captureCanvas){var t=this.createCaptureCanvas(e);this.captureCanvas=t}return this.captureCanvas},e.prototype.drawFrameOnCanvas=function(e,t,r){void 0===t&&(t={sx:0,sy:0,sWidth:e.videoWidth,sHeight:e.videoHeight,dx:0,dy:0,dWidth:e.videoWidth,dHeight:e.videoHeight}),void 0===r&&(r=this.captureCanvasContext),r.drawImage(e,t.sx,t.sy,t.sWidth,t.sHeight,t.dx,t.dy,t.dWidth,t.dHeight)},e.prototype.drawImageOnCanvas=function(e,t,r){void 0===t&&(t={sx:0,sy:0,sWidth:e.naturalWidth,sHeight:e.naturalHeight,dx:0,dy:0,dWidth:e.naturalWidth,dHeight:e.naturalHeight}),void 0===r&&(r=this.captureCanvasContext),r.drawImage(e,t.sx,t.sy,t.sWidth,t.sHeight,t.dx,t.dy,t.dWidth,t.dHeight)},e.prototype.decodeBitmap=function(e){return this.reader.decode(e,this._hints)},e.prototype.createCaptureCanvas=function(e){if("undefined"==typeof document)return this._destroyCaptureCanvas(),null;var t,r,n=document.createElement("canvas");return void 0!==e&&(e instanceof HTMLVideoElement?(t=e.videoWidth,r=e.videoHeight):e instanceof HTMLImageElement&&(t=e.naturalWidth||e.width,r=e.naturalHeight||e.height)),n.style.width=t+"px",n.style.height=r+"px",n.width=t,n.height=r,n},e.prototype.stopStreams=function(){this.stream&&(this.stream.getVideoTracks().forEach(function(e){return e.stop()}),this.stream=void 0),!1===this._stopAsyncDecode&&this.stopAsyncDecode(),!1===this._stopContinuousDecode&&this.stopContinuousDecode()},e.prototype.reset=function(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()},e.prototype._destroyVideoElement=function(){this.videoElement&&(void 0!==this.videoEndedListener&&this.videoElement.removeEventListener("ended",this.videoEndedListener),void 0!==this.videoPlayingEventListener&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),void 0!==this.videoCanPlayListener&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)},e.prototype._destroyImageElement=function(){this.imageElement&&(void 0!==this.imageLoadedListener&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)},e.prototype._destroyCaptureCanvas=function(){this.captureCanvasContext=void 0,this.captureCanvas=void 0},e.prototype.addVideoSource=function(e,t){try{e.srcObject=t}catch(r){e.src=URL.createObjectURL(t)}},e.prototype.cleanVideoSource=function(e){try{e.srcObject=null}catch(t){e.src=""}this.videoElement.removeAttribute("src")},e}(),pn=function(){function e(e,t,r,n,s,i){void 0===r&&(r=null==t?0:8*t.length),void 0===i&&(i=Sr.currentTimeMillis()),this.text=e,this.rawBytes=t,this.numBits=r,this.resultPoints=n,this.format=s,this.timestamp=i,this.text=e,this.rawBytes=t,this.numBits=null==r?null==t?0:8*t.length:r,this.resultPoints=n,this.format=s,this.resultMetadata=null,this.timestamp=null==i?Sr.currentTimeMillis():i}return e.prototype.getText=function(){return this.text},e.prototype.getRawBytes=function(){return this.rawBytes},e.prototype.getNumBits=function(){return this.numBits},e.prototype.getResultPoints=function(){return this.resultPoints},e.prototype.getBarcodeFormat=function(){return this.format},e.prototype.getResultMetadata=function(){return this.resultMetadata},e.prototype.putMetadata=function(e,t){null===this.resultMetadata&&(this.resultMetadata=new Map),this.resultMetadata.set(e,t)},e.prototype.putAllMetadata=function(e){null!==e&&(null===this.resultMetadata?this.resultMetadata=e:this.resultMetadata=new Map(e))},e.prototype.addResultPoints=function(e){var t=this.resultPoints;if(null===t)this.resultPoints=e;else if(null!==e&&e.length>0){var r=new Array(t.length+e.length);Sr.arraycopy(t,0,r,0,t.length),Sr.arraycopy(e,0,r,t.length,e.length),this.resultPoints=r}},e.prototype.getTimestamp=function(){return this.timestamp},e.prototype.toString=function(){return this.text},e}();(Gr=Hr||(Hr={}))[Gr.AZTEC=0]="AZTEC",Gr[Gr.CODABAR=1]="CODABAR",Gr[Gr.CODE_39=2]="CODE_39",Gr[Gr.CODE_93=3]="CODE_93",Gr[Gr.CODE_128=4]="CODE_128",Gr[Gr.DATA_MATRIX=5]="DATA_MATRIX",Gr[Gr.EAN_8=6]="EAN_8",Gr[Gr.EAN_13=7]="EAN_13",Gr[Gr.ITF=8]="ITF",Gr[Gr.MAXICODE=9]="MAXICODE",Gr[Gr.PDF_417=10]="PDF_417",Gr[Gr.QR_CODE=11]="QR_CODE",Gr[Gr.RSS_14=12]="RSS_14",Gr[Gr.RSS_EXPANDED=13]="RSS_EXPANDED",Gr[Gr.UPC_A=14]="UPC_A",Gr[Gr.UPC_E=15]="UPC_E",Gr[Gr.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION";const mn=Hr;var gn,xn;(xn=gn||(gn={}))[xn.OTHER=0]="OTHER",xn[xn.ORIENTATION=1]="ORIENTATION",xn[xn.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",xn[xn.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",xn[xn.ISSUE_NUMBER=4]="ISSUE_NUMBER",xn[xn.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",xn[xn.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",xn[xn.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",xn[xn.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",xn[xn.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",xn[xn.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY";const yn=gn;var vn,wn,_n=function(){function e(e,t,r,n,s,i){void 0===s&&(s=-1),void 0===i&&(i=-1),this.rawBytes=e,this.text=t,this.byteSegments=r,this.ecLevel=n,this.structuredAppendSequenceNumber=s,this.structuredAppendParity=i,this.numBits=null==e?0:8*e.length}return e.prototype.getRawBytes=function(){return this.rawBytes},e.prototype.getNumBits=function(){return this.numBits},e.prototype.setNumBits=function(e){this.numBits=e},e.prototype.getText=function(){return this.text},e.prototype.getByteSegments=function(){return this.byteSegments},e.prototype.getECLevel=function(){return this.ecLevel},e.prototype.getErrorsCorrected=function(){return this.errorsCorrected},e.prototype.setErrorsCorrected=function(e){this.errorsCorrected=e},e.prototype.getErasures=function(){return this.erasures},e.prototype.setErasures=function(e){this.erasures=e},e.prototype.getOther=function(){return this.other},e.prototype.setOther=function(e){this.other=e},e.prototype.hasStructuredAppend=function(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0},e.prototype.getStructuredAppendParity=function(){return this.structuredAppendParity},e.prototype.getStructuredAppendSequenceNumber=function(){return this.structuredAppendSequenceNumber},e}(),bn=function(){function e(){}return e.prototype.exp=function(e){return this.expTable[e]},e.prototype.log=function(e){if(0===e)throw new br;return this.logTable[e]},e.addOrSubtract=function(e,t){return e^t},e}(),Nn=function(){function e(e,t){if(0===t.length)throw new br;this.field=e;var r=t.length;if(r>1&&0===t[0]){for(var n=1;n<r&&0===t[n];)n++;n===r?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(r-n),Sr.arraycopy(t,n,this.coefficients,0,this.coefficients.length))}else this.coefficients=t}return e.prototype.getCoefficients=function(){return this.coefficients},e.prototype.getDegree=function(){return this.coefficients.length-1},e.prototype.isZero=function(){return 0===this.coefficients[0]},e.prototype.getCoefficient=function(e){return this.coefficients[this.coefficients.length-1-e]},e.prototype.evaluateAt=function(e){if(0===e)return this.getCoefficient(0);var t,r=this.coefficients;if(1===e){t=0;for(var n=0,s=r.length;n!==s;n++){var i=r[n];t=bn.addOrSubtract(t,i)}return t}t=r[0];var a=r.length,o=this.field;for(n=1;n<a;n++)t=bn.addOrSubtract(o.multiply(e,t),r[n]);return t},e.prototype.addOrSubtract=function(t){if(!this.field.equals(t.field))throw new br("GenericGFPolys do not have same GenericGF field");if(this.isZero())return t;if(t.isZero())return this;var r=this.coefficients,n=t.coefficients;if(r.length>n.length){var s=r;r=n,n=s}var i=new Int32Array(n.length),a=n.length-r.length;Sr.arraycopy(n,0,i,0,a);for(var o=a;o<n.length;o++)i[o]=bn.addOrSubtract(r[o-a],n[o]);return new e(this.field,i)},e.prototype.multiply=function(t){if(!this.field.equals(t.field))throw new br("GenericGFPolys do not have same GenericGF field");if(this.isZero()||t.isZero())return this.field.getZero();for(var r=this.coefficients,n=r.length,s=t.coefficients,i=s.length,a=new Int32Array(n+i-1),o=this.field,l=0;l<n;l++)for(var c=r[l],d=0;d<i;d++)a[l+d]=bn.addOrSubtract(a[l+d],o.multiply(c,s[d]));return new e(o,a)},e.prototype.multiplyScalar=function(t){if(0===t)return this.field.getZero();if(1===t)return this;for(var r=this.coefficients.length,n=this.field,s=new Int32Array(r),i=this.coefficients,a=0;a<r;a++)s[a]=n.multiply(i[a],t);return new e(n,s)},e.prototype.multiplyByMonomial=function(t,r){if(t<0)throw new br;if(0===r)return this.field.getZero();for(var n=this.coefficients,s=n.length,i=new Int32Array(s+t),a=this.field,o=0;o<s;o++)i[o]=a.multiply(n[o],r);return new e(a,i)},e.prototype.divide=function(e){if(!this.field.equals(e.field))throw new br("GenericGFPolys do not have same GenericGF field");if(e.isZero())throw new br("Divide by 0");for(var t=this.field,r=t.getZero(),n=this,s=e.getCoefficient(e.getDegree()),i=t.inverse(s);n.getDegree()>=e.getDegree()&&!n.isZero();){var a=n.getDegree()-e.getDegree(),o=t.multiply(n.getCoefficient(n.getDegree()),i),l=e.multiplyByMonomial(a,o),c=t.buildMonomial(a,o);r=r.addOrSubtract(c),n=n.addOrSubtract(l)}return[r,n]},e.prototype.toString=function(){for(var e="",t=this.getDegree();t>=0;t--){var r=this.getCoefficient(t);if(0!==r){if(r<0?(e+=" - ",r=-r):e.length>0&&(e+=" + "),0===t||1!==r){var n=this.field.log(r);0===n?e+="1":1===n?e+="a":(e+="a^",e+=n)}0!==t&&(1===t?e+="x":(e+="x^",e+=t))}}return e},e}(),jn=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Cn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return jn(t,e),t.kind="ArithmeticException",t}(yr),An=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Sn=function(e){function t(t,r,n){var s=e.call(this)||this;s.primitive=t,s.size=r,s.generatorBase=n;for(var i=new Int32Array(r),a=1,o=0;o<r;o++)i[o]=a,(a*=2)>=r&&(a^=t,a&=r-1);s.expTable=i;var l=new Int32Array(r);for(o=0;o<r-1;o++)l[i[o]]=o;return s.logTable=l,s.zero=new Nn(s,Int32Array.from([0])),s.one=new Nn(s,Int32Array.from([1])),s}return An(t,e),t.prototype.getZero=function(){return this.zero},t.prototype.getOne=function(){return this.one},t.prototype.buildMonomial=function(e,t){if(e<0)throw new br;if(0===t)return this.zero;var r=new Int32Array(e+1);return r[0]=t,new Nn(this,r)},t.prototype.inverse=function(e){if(0===e)throw new Cn;return this.expTable[this.size-this.logTable[e]-1]},t.prototype.multiply=function(e,t){return 0===e||0===t?0:this.expTable[(this.logTable[e]+this.logTable[t])%(this.size-1)]},t.prototype.getSize=function(){return this.size},t.prototype.getGeneratorBase=function(){return this.generatorBase},t.prototype.toString=function(){return"GF(0x"+kr.toHexString(this.primitive)+","+this.size+")"},t.prototype.equals=function(e){return e===this},t.AZTEC_DATA_12=new t(4201,4096,1),t.AZTEC_DATA_10=new t(1033,1024,1),t.AZTEC_DATA_6=new t(67,64,1),t.AZTEC_PARAM=new t(19,16,1),t.QR_CODE_FIELD_256=new t(285,256,0),t.DATA_MATRIX_FIELD_256=new t(301,256,1),t.AZTEC_DATA_8=t.DATA_MATRIX_FIELD_256,t.MAXICODE_FIELD_64=t.AZTEC_DATA_6,t}(bn),En=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),In=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return En(t,e),t.kind="ReedSolomonException",t}(yr),Tn=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Dn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Tn(t,e),t.kind="IllegalStateException",t}(yr),On=function(){function e(e){this.field=e}return e.prototype.decode=function(e,t){for(var r=this.field,n=new Nn(r,e),s=new Int32Array(t),i=!0,a=0;a<t;a++){var o=n.evaluateAt(r.exp(a+r.getGeneratorBase()));s[s.length-1-a]=o,0!==o&&(i=!1)}if(!i){var l=new Nn(r,s),c=this.runEuclideanAlgorithm(r.buildMonomial(t,1),l,t),d=c[0],u=c[1],h=this.findErrorLocations(d),f=this.findErrorMagnitudes(u,h);for(a=0;a<h.length;a++){var p=e.length-1-r.log(h[a]);if(p<0)throw new In("Bad error location");e[p]=Sn.addOrSubtract(e[p],f[a])}}},e.prototype.runEuclideanAlgorithm=function(e,t,r){if(e.getDegree()<t.getDegree()){var n=e;e=t,t=n}for(var s=this.field,i=e,a=t,o=s.getZero(),l=s.getOne();a.getDegree()>=(r/2|0);){var c=i,d=o;if(o=l,(i=a).isZero())throw new In("r_{i-1} was zero");a=c;for(var u=s.getZero(),h=i.getCoefficient(i.getDegree()),f=s.inverse(h);a.getDegree()>=i.getDegree()&&!a.isZero();){var p=a.getDegree()-i.getDegree(),m=s.multiply(a.getCoefficient(a.getDegree()),f);u=u.addOrSubtract(s.buildMonomial(p,m)),a=a.addOrSubtract(i.multiplyByMonomial(p,m))}if(l=u.multiply(o).addOrSubtract(d),a.getDegree()>=i.getDegree())throw new Dn("Division algorithm failed to reduce polynomial?")}var g=l.getCoefficient(0);if(0===g)throw new In("sigmaTilde(0) was zero");var x=s.inverse(g);return[l.multiplyScalar(x),a.multiplyScalar(x)]},e.prototype.findErrorLocations=function(e){var t=e.getDegree();if(1===t)return Int32Array.from([e.getCoefficient(1)]);for(var r=new Int32Array(t),n=0,s=this.field,i=1;i<s.getSize()&&n<t;i++)0===e.evaluateAt(i)&&(r[n]=s.inverse(i),n++);if(n!==t)throw new In("Error locator degree does not match number of roots");return r},e.prototype.findErrorMagnitudes=function(e,t){for(var r=t.length,n=new Int32Array(r),s=this.field,i=0;i<r;i++){for(var a=s.inverse(t[i]),o=1,l=0;l<r;l++)if(i!==l){var c=s.multiply(t[l],a),d=1&c?-2&c:1|c;o=s.multiply(o,d)}n[i]=s.multiply(e.evaluateAt(a),s.inverse(o)),0!==s.getGeneratorBase()&&(n[i]=s.multiply(n[i],a))}return n},e}();(wn=vn||(vn={}))[wn.UPPER=0]="UPPER",wn[wn.LOWER=1]="LOWER",wn[wn.MIXED=2]="MIXED",wn[wn.DIGIT=3]="DIGIT",wn[wn.PUNCT=4]="PUNCT",wn[wn.BINARY=5]="BINARY";var Rn=function(){function e(){}return e.prototype.decode=function(t){this.ddata=t;var r=t.getBits(),n=this.extractBits(r),s=this.correctBits(n),i=e.convertBoolArrayToByteArray(s),a=e.getEncodedData(s),o=new _n(i,a,null,null);return o.setNumBits(s.length),o},e.highLevelDecode=function(e){return this.getEncodedData(e)},e.getEncodedData=function(t){for(var r=t.length,n=vn.UPPER,s=vn.UPPER,i="",a=0;a<r;)if(s===vn.BINARY){if(r-a<5)break;var o=e.readCode(t,a,5);if(a+=5,0===o){if(r-a<11)break;o=e.readCode(t,a,11)+31,a+=11}for(var l=0;l<o;l++){if(r-a<8){a=r;break}var c=e.readCode(t,a,8);i+=qr.castAsNonUtf8Char(c),a+=8}s=n}else{var d=s===vn.DIGIT?4:5;if(r-a<d)break;c=e.readCode(t,a,d);a+=d;var u=e.getCharacter(s,c);u.startsWith("CTRL_")?(n=s,s=e.getTable(u.charAt(5)),"L"===u.charAt(6)&&(n=s)):(i+=u,s=n)}return i},e.getTable=function(e){switch(e){case"L":return vn.LOWER;case"P":return vn.PUNCT;case"M":return vn.MIXED;case"D":return vn.DIGIT;case"B":return vn.BINARY;default:return vn.UPPER}},e.getCharacter=function(t,r){switch(t){case vn.UPPER:return e.UPPER_TABLE[r];case vn.LOWER:return e.LOWER_TABLE[r];case vn.MIXED:return e.MIXED_TABLE[r];case vn.PUNCT:return e.PUNCT_TABLE[r];case vn.DIGIT:return e.DIGIT_TABLE[r];default:throw new Dn("Bad table")}},e.prototype.correctBits=function(t){var r,n;this.ddata.getNbLayers()<=2?(n=6,r=Sn.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(n=8,r=Sn.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(n=10,r=Sn.AZTEC_DATA_10):(n=12,r=Sn.AZTEC_DATA_12);var s=this.ddata.getNbDatablocks(),i=t.length/n;if(i<s)throw new Ur;for(var a=t.length%n,o=new Int32Array(i),l=0;l<i;l++,a+=n)o[l]=e.readCode(t,a,n);try{new On(r).decode(o,i-s)}catch(m){throw new Ur(m)}var c=(1<<n)-1,d=0;for(l=0;l<s;l++){if(0===(f=o[l])||f===c)throw new Ur;1!==f&&f!==c-1||d++}var u=new Array(s*n-d),h=0;for(l=0;l<s;l++){var f;if(1===(f=o[l])||f===c-1)u.fill(f>1,h,h+n-1),h+=n-1;else for(var p=n-1;p>=0;--p)u[h++]=!!(f&1<<p)}return u},e.prototype.extractBits=function(e){var t=this.ddata.isCompact(),r=this.ddata.getNbLayers(),n=(t?11:14)+4*r,s=new Int32Array(n),i=new Array(this.totalBitsInLayer(r,t));if(t)for(var a=0;a<s.length;a++)s[a]=a;else{var o=n+1+2*kr.truncDivision(kr.truncDivision(n,2)-1,15),l=n/2,c=kr.truncDivision(o,2);for(a=0;a<l;a++){var d=a+kr.truncDivision(a,15);s[l-a-1]=c-d-1,s[l+a]=c+d+1}}a=0;for(var u=0;a<r;a++){for(var h=4*(r-a)+(t?9:12),f=2*a,p=n-1-f,m=0;m<h;m++)for(var g=2*m,x=0;x<2;x++)i[u+g+x]=e.get(s[f+x],s[f+m]),i[u+2*h+g+x]=e.get(s[f+m],s[p-x]),i[u+4*h+g+x]=e.get(s[p-x],s[p-m]),i[u+6*h+g+x]=e.get(s[p-m],s[f+x]);u+=8*h}return i},e.readCode=function(e,t,r){for(var n=0,s=t;s<t+r;s++)n<<=1,e[s]&&(n|=1);return n},e.readByte=function(t,r){var n=t.length-r;return n>=8?e.readCode(t,r,8):e.readCode(t,r,n)<<8-n},e.convertBoolArrayToByteArray=function(t){for(var r=new Uint8Array((t.length+7)/8),n=0;n<r.length;n++)r[n]=e.readByte(t,8*n);return r},e.prototype.totalBitsInLayer=function(e,t){return((t?88:112)+16*e)*e},e.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],e.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],e.MIXED_TABLE=["CTRL_PS"," ","","","","","","","","\b","\t","\n","\v","\f","\r","","","","","","@","\\","^","_","`","|","~","","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],e.PUNCT_TABLE=["","\r","\r\n",". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],e.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"],e}(),kn=function(){function e(){}return e.round=function(e){return isNaN(e)?0:e<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:e>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:e+(e<0?-.5:.5)|0},e.distance=function(e,t,r,n){var s=e-r,i=t-n;return Math.sqrt(s*s+i*i)},e.sum=function(e){for(var t=0,r=0,n=e.length;r!==n;r++){t+=e[r]}return t},e}(),Mn=function(){function e(){}return e.floatToIntBits=function(e){return e},e.MAX_VALUE=Number.MAX_SAFE_INTEGER,e}(),Pn=function(){function e(e,t){this.x=e,this.y=t}return e.prototype.getX=function(){return this.x},e.prototype.getY=function(){return this.y},e.prototype.equals=function(t){if(t instanceof e){var r=t;return this.x===r.x&&this.y===r.y}return!1},e.prototype.hashCode=function(){return 31*Mn.floatToIntBits(this.x)+Mn.floatToIntBits(this.y)},e.prototype.toString=function(){return"("+this.x+","+this.y+")"},e.orderBestPatterns=function(e){var t,r,n,s=this.distance(e[0],e[1]),i=this.distance(e[1],e[2]),a=this.distance(e[0],e[2]);if(i>=s&&i>=a?(r=e[0],t=e[1],n=e[2]):a>=i&&a>=s?(r=e[1],t=e[0],n=e[2]):(r=e[2],t=e[0],n=e[1]),this.crossProductZ(t,r,n)<0){var o=t;t=n,n=o}e[0]=t,e[1]=r,e[2]=n},e.distance=function(e,t){return kn.distance(e.x,e.y,t.x,t.y)},e.crossProductZ=function(e,t,r){var n=t.x,s=t.y;return(r.x-n)*(e.y-s)-(r.y-s)*(e.x-n)},e}(),Bn=function(){function e(e,t){this.bits=e,this.points=t}return e.prototype.getBits=function(){return this.bits},e.prototype.getPoints=function(){return this.points},e}(),Fn=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ln=function(e){function t(t,r,n,s,i){var a=e.call(this,t,r)||this;return a.compact=n,a.nbDatablocks=s,a.nbLayers=i,a}return Fn(t,e),t.prototype.getNbLayers=function(){return this.nbLayers},t.prototype.getNbDatablocks=function(){return this.nbDatablocks},t.prototype.isCompact=function(){return this.compact},t}(Bn),Un=function(){function e(t,r,n,s){this.image=t,this.height=t.getHeight(),this.width=t.getWidth(),null==r&&(r=e.INIT_SIZE),null==n&&(n=t.getWidth()/2|0),null==s&&(s=t.getHeight()/2|0);var i=r/2|0;if(this.leftInit=n-i,this.rightInit=n+i,this.upInit=s-i,this.downInit=s+i,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new Qr}return e.prototype.detect=function(){for(var e=this.leftInit,t=this.rightInit,r=this.upInit,n=this.downInit,s=!1,i=!0,a=!1,o=!1,l=!1,c=!1,d=!1,u=this.width,h=this.height;i;){i=!1;for(var f=!0;(f||!o)&&t<u;)(f=this.containsBlackPoint(r,n,t,!1))?(t++,i=!0,o=!0):o||t++;if(t>=u){s=!0;break}for(var p=!0;(p||!l)&&n<h;)(p=this.containsBlackPoint(e,t,n,!0))?(n++,i=!0,l=!0):l||n++;if(n>=h){s=!0;break}for(var m=!0;(m||!c)&&e>=0;)(m=this.containsBlackPoint(r,n,e,!1))?(e--,i=!0,c=!0):c||e--;if(e<0){s=!0;break}for(var g=!0;(g||!d)&&r>=0;)(g=this.containsBlackPoint(e,t,r,!0))?(r--,i=!0,d=!0):d||r--;if(r<0){s=!0;break}i&&(a=!0)}if(!s&&a){for(var x=t-e,y=null,v=1;null===y&&v<x;v++)y=this.getBlackPointOnSegment(e,n-v,e+v,n);if(null==y)throw new Qr;var w=null;for(v=1;null===w&&v<x;v++)w=this.getBlackPointOnSegment(e,r+v,e+v,r);if(null==w)throw new Qr;var _=null;for(v=1;null===_&&v<x;v++)_=this.getBlackPointOnSegment(t,r+v,t-v,r);if(null==_)throw new Qr;var b=null;for(v=1;null===b&&v<x;v++)b=this.getBlackPointOnSegment(t,n-v,t-v,n);if(null==b)throw new Qr;return this.centerEdges(b,y,_,w)}throw new Qr},e.prototype.getBlackPointOnSegment=function(e,t,r,n){for(var s=kn.round(kn.distance(e,t,r,n)),i=(r-e)/s,a=(n-t)/s,o=this.image,l=0;l<s;l++){var c=kn.round(e+l*i),d=kn.round(t+l*a);if(o.get(c,d))return new Pn(c,d)}return null},e.prototype.centerEdges=function(t,r,n,s){var i=t.getX(),a=t.getY(),o=r.getX(),l=r.getY(),c=n.getX(),d=n.getY(),u=s.getX(),h=s.getY(),f=e.CORR;return i<this.width/2?[new Pn(u-f,h+f),new Pn(o+f,l+f),new Pn(c-f,d-f),new Pn(i+f,a-f)]:[new Pn(u+f,h+f),new Pn(o+f,l-f),new Pn(c-f,d+f),new Pn(i-f,a-f)]},e.prototype.containsBlackPoint=function(e,t,r,n){var s=this.image;if(n){for(var i=e;i<=t;i++)if(s.get(i,r))return!0}else for(var a=e;a<=t;a++)if(s.get(r,a))return!0;return!1},e.INIT_SIZE=10,e.CORR=1,e}(),Vn=function(){function e(){}return e.checkAndNudgePoints=function(e,t){for(var r=e.getWidth(),n=e.getHeight(),s=!0,i=0;i<t.length&&s;i+=2){var a=Math.floor(t[i]),o=Math.floor(t[i+1]);if(a<-1||a>r||o<-1||o>n)throw new Qr;s=!1,-1===a?(t[i]=0,s=!0):a===r&&(t[i]=r-1,s=!0),-1===o?(t[i+1]=0,s=!0):o===n&&(t[i+1]=n-1,s=!0)}s=!0;for(i=t.length-2;i>=0&&s;i-=2){a=Math.floor(t[i]),o=Math.floor(t[i+1]);if(a<-1||a>r||o<-1||o>n)throw new Qr;s=!1,-1===a?(t[i]=0,s=!0):a===r&&(t[i]=r-1,s=!0),-1===o?(t[i+1]=0,s=!0):o===n&&(t[i+1]=n-1,s=!0)}},e}(),Hn=function(){function e(e,t,r,n,s,i,a,o,l){this.a11=e,this.a21=t,this.a31=r,this.a12=n,this.a22=s,this.a32=i,this.a13=a,this.a23=o,this.a33=l}return e.quadrilateralToQuadrilateral=function(t,r,n,s,i,a,o,l,c,d,u,h,f,p,m,g){var x=e.quadrilateralToSquare(t,r,n,s,i,a,o,l);return e.squareToQuadrilateral(c,d,u,h,f,p,m,g).times(x)},e.prototype.transformPoints=function(e){for(var t=e.length,r=this.a11,n=this.a12,s=this.a13,i=this.a21,a=this.a22,o=this.a23,l=this.a31,c=this.a32,d=this.a33,u=0;u<t;u+=2){var h=e[u],f=e[u+1],p=s*h+o*f+d;e[u]=(r*h+i*f+l)/p,e[u+1]=(n*h+a*f+c)/p}},e.prototype.transformPointsWithValues=function(e,t){for(var r=this.a11,n=this.a12,s=this.a13,i=this.a21,a=this.a22,o=this.a23,l=this.a31,c=this.a32,d=this.a33,u=e.length,h=0;h<u;h++){var f=e[h],p=t[h],m=s*f+o*p+d;e[h]=(r*f+i*p+l)/m,t[h]=(n*f+a*p+c)/m}},e.squareToQuadrilateral=function(t,r,n,s,i,a,o,l){var c=t-n+i-o,d=r-s+a-l;if(0===c&&0===d)return new e(n-t,i-n,t,s-r,a-s,r,0,0,1);var u=n-i,h=o-i,f=s-a,p=l-a,m=u*p-h*f,g=(c*p-h*d)/m,x=(u*d-c*f)/m;return new e(n-t+g*n,o-t+x*o,t,s-r+g*s,l-r+x*l,r,g,x,1)},e.quadrilateralToSquare=function(t,r,n,s,i,a,o,l){return e.squareToQuadrilateral(t,r,n,s,i,a,o,l).buildAdjoint()},e.prototype.buildAdjoint=function(){return new e(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)},e.prototype.times=function(t){return new e(this.a11*t.a11+this.a21*t.a12+this.a31*t.a13,this.a11*t.a21+this.a21*t.a22+this.a31*t.a23,this.a11*t.a31+this.a21*t.a32+this.a31*t.a33,this.a12*t.a11+this.a22*t.a12+this.a32*t.a13,this.a12*t.a21+this.a22*t.a22+this.a32*t.a23,this.a12*t.a31+this.a22*t.a32+this.a32*t.a33,this.a13*t.a11+this.a23*t.a12+this.a33*t.a13,this.a13*t.a21+this.a23*t.a22+this.a33*t.a23,this.a13*t.a31+this.a23*t.a32+this.a33*t.a33)},e}(),Gn=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Wn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Gn(t,e),t.prototype.sampleGrid=function(e,t,r,n,s,i,a,o,l,c,d,u,h,f,p,m,g,x,y){var v=Hn.quadrilateralToQuadrilateral(n,s,i,a,o,l,c,d,u,h,f,p,m,g,x,y);return this.sampleGridWithTransform(e,t,r,v)},t.prototype.sampleGridWithTransform=function(e,t,r,n){if(t<=0||r<=0)throw new Qr;for(var s=new Zr(t,r),i=new Float32Array(2*t),a=0;a<r;a++){for(var o=i.length,l=a+.5,c=0;c<o;c+=2)i[c]=c/2+.5,i[c+1]=l;n.transformPoints(i),Vn.checkAndNudgePoints(e,i);try{for(c=0;c<o;c+=2)e.get(Math.floor(i[c]),Math.floor(i[c+1]))&&s.set(c/2,a)}catch(d){throw new Qr}}return s},t}(Vn),zn=function(){function e(){}return e.setGridSampler=function(t){e.gridSampler=t},e.getInstance=function(){return e.gridSampler},e.gridSampler=new Wn,e}(),Xn=function(){function e(e,t){this.x=e,this.y=t}return e.prototype.toResultPoint=function(){return new Pn(this.getX(),this.getY())},e.prototype.getX=function(){return this.x},e.prototype.getY=function(){return this.y},e}(),Yn=function(){function e(e){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=e}return e.prototype.detect=function(){return this.detectMirror(!1)},e.prototype.detectMirror=function(e){var t=this.getMatrixCenter(),r=this.getBullsEyeCorners(t);if(e){var n=r[0];r[0]=r[2],r[2]=n}this.extractParameters(r);var s=this.sampleGrid(this.image,r[this.shift%4],r[(this.shift+1)%4],r[(this.shift+2)%4],r[(this.shift+3)%4]),i=this.getMatrixCornerPoints(r);return new Ln(s,i,this.compact,this.nbDataBlocks,this.nbLayers)},e.prototype.extractParameters=function(e){if(!(this.isValidPoint(e[0])&&this.isValidPoint(e[1])&&this.isValidPoint(e[2])&&this.isValidPoint(e[3])))throw new Qr;var t=2*this.nbCenterLayers,r=new Int32Array([this.sampleLine(e[0],e[1],t),this.sampleLine(e[1],e[2],t),this.sampleLine(e[2],e[3],t),this.sampleLine(e[3],e[0],t)]);this.shift=this.getRotation(r,t);for(var n=0,s=0;s<4;s++){var i=r[(this.shift+s)%4];this.compact?(n<<=7,n+=i>>1&127):(n<<=10,n+=(i>>2&992)+(i>>1&31))}var a=this.getCorrectedParameterData(n,this.compact);this.compact?(this.nbLayers=1+(a>>6),this.nbDataBlocks=1+(63&a)):(this.nbLayers=1+(a>>11),this.nbDataBlocks=1+(2047&a))},e.prototype.getRotation=function(e,t){var r=0;e.forEach(function(e,n,s){r=(r<<3)+((e>>t-2<<1)+(1&e))}),r=((1&r)<<11)+(r>>1);for(var n=0;n<4;n++)if(kr.bitCount(r^this.EXPECTED_CORNER_BITS[n])<=2)return n;throw new Qr},e.prototype.getCorrectedParameterData=function(e,t){var r,n;t?(r=7,n=2):(r=10,n=4);for(var s=r-n,i=new Int32Array(r),a=r-1;a>=0;--a)i[a]=15&e,e>>=4;try{new On(Sn.AZTEC_PARAM).decode(i,s)}catch(l){throw new Qr}var o=0;for(a=0;a<n;a++)o=(o<<4)+i[a];return o},e.prototype.getBullsEyeCorners=function(e){var t=e,r=e,n=e,s=e,i=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){var a=this.getFirstDifferent(t,i,1,-1),o=this.getFirstDifferent(r,i,1,1),l=this.getFirstDifferent(n,i,-1,1),c=this.getFirstDifferent(s,i,-1,-1);if(this.nbCenterLayers>2){var d=this.distancePoint(c,a)*this.nbCenterLayers/(this.distancePoint(s,t)*(this.nbCenterLayers+2));if(d<.75||d>1.25||!this.isWhiteOrBlackRectangle(a,o,l,c))break}t=a,r=o,n=l,s=c,i=!i}if(5!==this.nbCenterLayers&&7!==this.nbCenterLayers)throw new Qr;this.compact=5===this.nbCenterLayers;var u=new Pn(t.getX()+.5,t.getY()-.5),h=new Pn(r.getX()+.5,r.getY()+.5),f=new Pn(n.getX()-.5,n.getY()+.5),p=new Pn(s.getX()-.5,s.getY()-.5);return this.expandSquare([u,h,f,p],2*this.nbCenterLayers-3,2*this.nbCenterLayers)},e.prototype.getMatrixCenter=function(){var e,t,r,n;try{e=(l=new Un(this.image).detect())[0],t=l[1],r=l[2],n=l[3]}catch(c){var s=this.image.getWidth()/2,i=this.image.getHeight()/2;e=this.getFirstDifferent(new Xn(s+7,i-7),!1,1,-1).toResultPoint(),t=this.getFirstDifferent(new Xn(s+7,i+7),!1,1,1).toResultPoint(),r=this.getFirstDifferent(new Xn(s-7,i+7),!1,-1,1).toResultPoint(),n=this.getFirstDifferent(new Xn(s-7,i-7),!1,-1,-1).toResultPoint()}var a=kn.round((e.getX()+n.getX()+t.getX()+r.getX())/4),o=kn.round((e.getY()+n.getY()+t.getY()+r.getY())/4);try{var l;e=(l=new Un(this.image,15,a,o).detect())[0],t=l[1],r=l[2],n=l[3]}catch(c){e=this.getFirstDifferent(new Xn(a+7,o-7),!1,1,-1).toResultPoint(),t=this.getFirstDifferent(new Xn(a+7,o+7),!1,1,1).toResultPoint(),r=this.getFirstDifferent(new Xn(a-7,o+7),!1,-1,1).toResultPoint(),n=this.getFirstDifferent(new Xn(a-7,o-7),!1,-1,-1).toResultPoint()}return a=kn.round((e.getX()+n.getX()+t.getX()+r.getX())/4),o=kn.round((e.getY()+n.getY()+t.getY()+r.getY())/4),new Xn(a,o)},e.prototype.getMatrixCornerPoints=function(e){return this.expandSquare(e,2*this.nbCenterLayers,this.getDimension())},e.prototype.sampleGrid=function(e,t,r,n,s){var i=zn.getInstance(),a=this.getDimension(),o=a/2-this.nbCenterLayers,l=a/2+this.nbCenterLayers;return i.sampleGrid(e,a,a,o,o,l,o,l,l,o,l,t.getX(),t.getY(),r.getX(),r.getY(),n.getX(),n.getY(),s.getX(),s.getY())},e.prototype.sampleLine=function(e,t,r){for(var n=0,s=this.distanceResultPoint(e,t),i=s/r,a=e.getX(),o=e.getY(),l=i*(t.getX()-e.getX())/s,c=i*(t.getY()-e.getY())/s,d=0;d<r;d++)this.image.get(kn.round(a+d*l),kn.round(o+d*c))&&(n|=1<<r-d-1);return n},e.prototype.isWhiteOrBlackRectangle=function(e,t,r,n){e=new Xn(e.getX()-3,e.getY()+3),t=new Xn(t.getX()-3,t.getY()-3),r=new Xn(r.getX()+3,r.getY()-3),n=new Xn(n.getX()+3,n.getY()+3);var s=this.getColor(n,e);if(0===s)return!1;var i=this.getColor(e,t);return i===s&&((i=this.getColor(t,r))===s&&(i=this.getColor(r,n))===s)},e.prototype.getColor=function(e,t){for(var r=this.distancePoint(e,t),n=(t.getX()-e.getX())/r,s=(t.getY()-e.getY())/r,i=0,a=e.getX(),o=e.getY(),l=this.image.get(e.getX(),e.getY()),c=Math.ceil(r),d=0;d<c;d++)a+=n,o+=s,this.image.get(kn.round(a),kn.round(o))!==l&&i++;var u=i/r;return u>.1&&u<.9?0:u<=.1===l?1:-1},e.prototype.getFirstDifferent=function(e,t,r,n){for(var s=e.getX()+r,i=e.getY()+n;this.isValid(s,i)&&this.image.get(s,i)===t;)s+=r,i+=n;for(s-=r,i-=n;this.isValid(s,i)&&this.image.get(s,i)===t;)s+=r;for(s-=r;this.isValid(s,i)&&this.image.get(s,i)===t;)i+=n;return new Xn(s,i-=n)},e.prototype.expandSquare=function(e,t,r){var n=r/(2*t),s=e[0].getX()-e[2].getX(),i=e[0].getY()-e[2].getY(),a=(e[0].getX()+e[2].getX())/2,o=(e[0].getY()+e[2].getY())/2,l=new Pn(a+n*s,o+n*i),c=new Pn(a-n*s,o-n*i);return s=e[1].getX()-e[3].getX(),i=e[1].getY()-e[3].getY(),a=(e[1].getX()+e[3].getX())/2,o=(e[1].getY()+e[3].getY())/2,[l,new Pn(a+n*s,o+n*i),c,new Pn(a-n*s,o-n*i)]},e.prototype.isValid=function(e,t){return e>=0&&e<this.image.getWidth()&&t>0&&t<this.image.getHeight()},e.prototype.isValidPoint=function(e){var t=kn.round(e.getX()),r=kn.round(e.getY());return this.isValid(t,r)},e.prototype.distancePoint=function(e,t){return kn.distance(e.getX(),e.getY(),t.getX(),t.getY())},e.prototype.distanceResultPoint=function(e,t){return kn.distance(e.getX(),e.getY(),t.getX(),t.getY())},e.prototype.getDimension=function(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(kr.truncDivision(this.nbLayers-4,8)+1)+15},e}(),qn=function(){function e(){}return e.prototype.decode=function(e,t){void 0===t&&(t=null);var r=null,n=new Yn(e.getBlackMatrix()),s=null,i=null;try{s=(a=n.detectMirror(!1)).getPoints(),this.reportFoundResultPoints(t,s),i=(new Rn).decode(a)}catch(d){r=d}if(null==i)try{var a;s=(a=n.detectMirror(!0)).getPoints(),this.reportFoundResultPoints(t,s),i=(new Rn).decode(a)}catch(d){if(null!=r)throw r;throw d}var o=new pn(i.getText(),i.getRawBytes(),i.getNumBits(),s,mn.AZTEC,Sr.currentTimeMillis()),l=i.getByteSegments();null!=l&&o.putMetadata(yn.BYTE_SEGMENTS,l);var c=i.getECLevel();return null!=c&&o.putMetadata(yn.ERROR_CORRECTION_LEVEL,c),o},e.prototype.reportFoundResultPoints=function(e,t){if(null!=e){var r=e.get(Pr.NEED_RESULT_POINT_CALLBACK);null!=r&&t.forEach(function(e,t,n){r.foundPossibleResultPoint(e)})}},e.prototype.reset=function(){},e}(),Kn=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();!function(e){function t(t){return void 0===t&&(t=500),e.call(this,new qn,t)||this}Kn(t,e)}(fn);var Zn=function(){function e(){}return e.prototype.decode=function(e,t){try{return this.doDecode(e,t)}catch(c){if(t&&!0===t.get(Pr.TRY_HARDER)&&e.isRotateSupported()){var r=e.rotateCounterClockwise(),n=this.doDecode(r,t),s=n.getResultMetadata(),i=270;null!==s&&!0===s.get(yn.ORIENTATION)&&(i+=s.get(yn.ORIENTATION)%360),n.putMetadata(yn.ORIENTATION,i);var a=n.getResultPoints();if(null!==a)for(var o=r.getHeight(),l=0;l<a.length;l++)a[l]=new Pn(o-a[l].getY()-1,a[l].getX());return n}throw new Qr}},e.prototype.reset=function(){},e.prototype.doDecode=function(e,t){var r,n=e.getWidth(),s=e.getHeight(),i=new Mr(n),a=t&&!0===t.get(Pr.TRY_HARDER),o=Math.max(1,s>>(a?8:5));r=a?s:15;for(var l=Math.trunc(s/2),c=0;c<r;c++){var d=Math.trunc((c+1)/2),u=l+o*(!(1&c)?d:-d);if(u<0||u>=s)break;try{i=e.getBlackRow(u,i)}catch(g){continue}for(var h=function(e){if(1===e&&(i.reverse(),t&&!0===t.get(Pr.NEED_RESULT_POINT_CALLBACK))){var r=new Map;t.forEach(function(e,t){return r.set(t,e)}),r.delete(Pr.NEED_RESULT_POINT_CALLBACK),t=r}try{var s=f.decodeRow(u,i,t);if(1===e){s.putMetadata(yn.ORIENTATION,180);var a=s.getResultPoints();null!==a&&(a[0]=new Pn(n-a[0].getX()-1,a[0].getY()),a[1]=new Pn(n-a[1].getX()-1,a[1].getY()))}return{value:s}}catch(o){}},f=this,p=0;p<2;p++){var m=h(p);if("object"==typeof m)return m.value}}throw new Qr},e.recordPattern=function(e,t,r){for(var n=r.length,s=0;s<n;s++)r[s]=0;var i=e.getSize();if(t>=i)throw new Qr;for(var a=!e.get(t),o=0,l=t;l<i;){if(e.get(l)!==a)r[o]++;else{if(++o===n)break;r[o]=1,a=!a}l++}if(o!==n&&(o!==n-1||l!==i))throw new Qr},e.recordPatternInReverse=function(t,r,n){for(var s=n.length,i=t.get(r);r>0&&s>=0;)t.get(--r)!==i&&(s--,i=!i);if(s>=0)throw new Qr;e.recordPattern(t,r+1,n)},e.patternMatchVariance=function(e,t,r){for(var n=e.length,s=0,i=0,a=0;a<n;a++)s+=e[a],i+=t[a];if(s<i)return Number.POSITIVE_INFINITY;var o=s/i;r*=o;for(var l=0,c=0;c<n;c++){var d=e[c],u=t[c]*o,h=d>u?d-u:u-d;if(h>r)return Number.POSITIVE_INFINITY;l+=h}return l/s},e}(),$n=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Qn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $n(t,e),t.findStartPattern=function(e){for(var r=e.getSize(),n=e.getNextSet(0),s=0,i=Int32Array.from([0,0,0,0,0,0]),a=n,o=!1,l=n;l<r;l++)if(e.get(l)!==o)i[s]++;else{if(5===s){for(var c=t.MAX_AVG_VARIANCE,d=-1,u=t.CODE_START_A;u<=t.CODE_START_C;u++){var h=Zn.patternMatchVariance(i,t.CODE_PATTERNS[u],t.MAX_INDIVIDUAL_VARIANCE);h<c&&(c=h,d=u)}if(d>=0&&e.isRange(Math.max(0,a-(l-a)/2),a,!1))return Int32Array.from([a,l,d]);a+=i[0]+i[1],(i=i.slice(2,i.length))[s-1]=0,i[s]=0,s--}else s++;i[s]=1,o=!o}throw new Qr},t.decodeCode=function(e,r,n){Zn.recordPattern(e,n,r);for(var s=t.MAX_AVG_VARIANCE,i=-1,a=0;a<t.CODE_PATTERNS.length;a++){var o=t.CODE_PATTERNS[a],l=this.patternMatchVariance(r,o,t.MAX_INDIVIDUAL_VARIANCE);l<s&&(s=l,i=a)}if(i>=0)return i;throw new Qr},t.prototype.decodeRow=function(e,r,n){var s,i=n&&!0===n.get(Pr.ASSUME_GS1),a=t.findStartPattern(r),o=a[2],l=0,c=new Uint8Array(20);switch(c[l++]=o,o){case t.CODE_START_A:s=t.CODE_CODE_A;break;case t.CODE_START_B:s=t.CODE_CODE_B;break;case t.CODE_START_C:s=t.CODE_CODE_C;break;default:throw new Ur}for(var d=!1,u=!1,h="",f=a[0],p=a[1],m=Int32Array.from([0,0,0,0,0,0]),g=0,x=0,y=o,v=0,w=!0,_=!1,b=!1;!d;){var N=u;switch(u=!1,g=x,x=t.decodeCode(r,m,p),c[l++]=x,x!==t.CODE_STOP&&(w=!0),x!==t.CODE_STOP&&(y+=++v*x),f=p,p+=m.reduce(function(e,t){return e+t},0),x){case t.CODE_START_A:case t.CODE_START_B:case t.CODE_START_C:throw new Ur}switch(s){case t.CODE_CODE_A:if(x<64)h+=b===_?String.fromCharCode(" ".charCodeAt(0)+x):String.fromCharCode(" ".charCodeAt(0)+x+128),b=!1;else if(x<96)h+=b===_?String.fromCharCode(x-64):String.fromCharCode(x+64),b=!1;else switch(x!==t.CODE_STOP&&(w=!1),x){case t.CODE_FNC_1:i&&(0===h.length?h+="]C1":h+=String.fromCharCode(29));break;case t.CODE_FNC_2:case t.CODE_FNC_3:break;case t.CODE_FNC_4_A:!_&&b?(_=!0,b=!1):_&&b?(_=!1,b=!1):b=!0;break;case t.CODE_SHIFT:u=!0,s=t.CODE_CODE_B;break;case t.CODE_CODE_B:s=t.CODE_CODE_B;break;case t.CODE_CODE_C:s=t.CODE_CODE_C;break;case t.CODE_STOP:d=!0}break;case t.CODE_CODE_B:if(x<96)h+=b===_?String.fromCharCode(" ".charCodeAt(0)+x):String.fromCharCode(" ".charCodeAt(0)+x+128),b=!1;else switch(x!==t.CODE_STOP&&(w=!1),x){case t.CODE_FNC_1:i&&(0===h.length?h+="]C1":h+=String.fromCharCode(29));break;case t.CODE_FNC_2:case t.CODE_FNC_3:break;case t.CODE_FNC_4_B:!_&&b?(_=!0,b=!1):_&&b?(_=!1,b=!1):b=!0;break;case t.CODE_SHIFT:u=!0,s=t.CODE_CODE_A;break;case t.CODE_CODE_A:s=t.CODE_CODE_A;break;case t.CODE_CODE_C:s=t.CODE_CODE_C;break;case t.CODE_STOP:d=!0}break;case t.CODE_CODE_C:if(x<100)x<10&&(h+="0"),h+=x;else switch(x!==t.CODE_STOP&&(w=!1),x){case t.CODE_FNC_1:i&&(0===h.length?h+="]C1":h+=String.fromCharCode(29));break;case t.CODE_CODE_A:s=t.CODE_CODE_A;break;case t.CODE_CODE_B:s=t.CODE_CODE_B;break;case t.CODE_STOP:d=!0}}N&&(s=s===t.CODE_CODE_A?t.CODE_CODE_B:t.CODE_CODE_A)}var j=p-f;if(p=r.getNextUnset(p),!r.isRange(p,Math.min(r.getSize(),p+(p-f)/2),!1))throw new Qr;if((y-=v*g)%103!==g)throw new Cr;var C=h.length;if(0===C)throw new Qr;C>0&&w&&(h=s===t.CODE_CODE_C?h.substring(0,C-2):h.substring(0,C-1));for(var A=(a[1]+a[0])/2,S=f+j/2,E=c.length,I=new Uint8Array(E),T=0;T<E;T++)I[T]=c[T];var D=[new Pn(A,e),new Pn(S,e)];return new pn(h,I,0,D,mn.CODE_128,(new Date).getTime())},t.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],t.MAX_AVG_VARIANCE=.25,t.MAX_INDIVIDUAL_VARIANCE=.7,t.CODE_SHIFT=98,t.CODE_CODE_C=99,t.CODE_CODE_B=100,t.CODE_CODE_A=101,t.CODE_FNC_1=102,t.CODE_FNC_2=97,t.CODE_FNC_3=96,t.CODE_FNC_4_A=101,t.CODE_FNC_4_B=100,t.CODE_START_A=103,t.CODE_START_B=104,t.CODE_START_C=105,t.CODE_STOP=106,t}(Zn),Jn=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),es=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ts=function(e){function t(t,r){void 0===t&&(t=!1),void 0===r&&(r=!1);var n=e.call(this)||this;return n.usingCheckDigit=t,n.extendedMode=r,n.decodeRowResult="",n.counters=new Int32Array(9),n}return Jn(t,e),t.prototype.decodeRow=function(e,r,n){var s,i,a,o,l=this.counters;l.fill(0),this.decodeRowResult="";var c,d,u=t.findAsteriskPattern(r,l),h=r.getNextSet(u[1]),f=r.getSize();do{t.recordPattern(r,h,l);var p=t.toNarrowWidePattern(l);if(p<0)throw new Qr;c=t.patternToChar(p),this.decodeRowResult+=c,d=h;try{for(var m=(s=void 0,es(l)),g=m.next();!g.done;g=m.next()){h+=g.value}}catch(A){s={error:A}}finally{try{g&&!g.done&&(i=m.return)&&i.call(m)}finally{if(s)throw s.error}}h=r.getNextSet(h)}while("*"!==c);this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);var x,y=0;try{for(var v=es(l),w=v.next();!w.done;w=v.next()){y+=w.value}}catch(S){a={error:S}}finally{try{w&&!w.done&&(o=v.return)&&o.call(v)}finally{if(a)throw a.error}}if(h!==f&&2*(h-d-y)<y)throw new Qr;if(this.usingCheckDigit){for(var _=this.decodeRowResult.length-1,b=0,N=0;N<_;N++)b+=t.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(N));if(this.decodeRowResult.charAt(_)!==t.ALPHABET_STRING.charAt(b%43))throw new Cr;this.decodeRowResult=this.decodeRowResult.substring(0,_)}if(0===this.decodeRowResult.length)throw new Qr;x=this.extendedMode?t.decodeExtended(this.decodeRowResult):this.decodeRowResult;var j=(u[1]+u[0])/2,C=d+y/2;return new pn(x,null,0,[new Pn(j,e),new Pn(C,e)],mn.CODE_39,(new Date).getTime())},t.findAsteriskPattern=function(e,r){for(var n=e.getSize(),s=e.getNextSet(0),i=0,a=s,o=!1,l=r.length,c=s;c<n;c++)if(e.get(c)!==o)r[i]++;else{if(i===l-1){if(this.toNarrowWidePattern(r)===t.ASTERISK_ENCODING&&e.isRange(Math.max(0,a-Math.floor((c-a)/2)),a,!1))return[a,c];a+=r[0]+r[1],r.copyWithin(0,2,2+i-1),r[i-1]=0,r[i]=0,i--}else i++;r[i]=1,o=!o}throw new Qr},t.toNarrowWidePattern=function(e){var t,r,n,s=e.length,i=0;do{var a=2147483647;try{for(var o=(t=void 0,es(e)),l=o.next();!l.done;l=o.next()){(h=l.value)<a&&h>i&&(a=h)}}catch(f){t={error:f}}finally{try{l&&!l.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}i=a,n=0;for(var c=0,d=0,u=0;u<s;u++){(h=e[u])>i&&(d|=1<<s-1-u,n++,c+=h)}if(3===n){for(u=0;u<s&&n>0;u++){var h;if((h=e[u])>i&&(n--,2*h>=c))return-1}return d}}while(n>3);return-1},t.patternToChar=function(e){for(var r=0;r<t.CHARACTER_ENCODINGS.length;r++)if(t.CHARACTER_ENCODINGS[r]===e)return t.ALPHABET_STRING.charAt(r);if(e===t.ASTERISK_ENCODING)return"*";throw new Qr},t.decodeExtended=function(e){for(var t=e.length,r="",n=0;n<t;n++){var s=e.charAt(n);if("+"===s||"$"===s||"%"===s||"/"===s){var i=e.charAt(n+1),a="\0";switch(s){case"+":if(!(i>="A"&&i<="Z"))throw new Ur;a=String.fromCharCode(i.charCodeAt(0)+32);break;case"$":if(!(i>="A"&&i<="Z"))throw new Ur;a=String.fromCharCode(i.charCodeAt(0)-64);break;case"%":if(i>="A"&&i<="E")a=String.fromCharCode(i.charCodeAt(0)-38);else if(i>="F"&&i<="J")a=String.fromCharCode(i.charCodeAt(0)-11);else if(i>="K"&&i<="O")a=String.fromCharCode(i.charCodeAt(0)+16);else if(i>="P"&&i<="T")a=String.fromCharCode(i.charCodeAt(0)+43);else if("U"===i)a="\0";else if("V"===i)a="@";else if("W"===i)a="`";else{if("X"!==i&&"Y"!==i&&"Z"!==i)throw new Ur;a=""}break;case"/":if(i>="A"&&i<="O")a=String.fromCharCode(i.charCodeAt(0)-32);else{if("Z"!==i)throw new Ur;a=":"}}r+=a,n++}else r+=s}return r},t.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",t.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],t.ASTERISK_ENCODING=148,t}(Zn),rs=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ns=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ss=function(e){function t(){var t=e.call(this)||this;return t.decodeRowResult="",t.counters=new Int32Array(6),t}return rs(t,e),t.prototype.decodeRow=function(e,r,n){var s,i,a,o,l,c,d=this.findAsteriskPattern(r),u=r.getNextSet(d[1]),h=r.getSize(),f=this.counters;f.fill(0),this.decodeRowResult="";do{t.recordPattern(r,u,f);var p=this.toPattern(f);if(p<0)throw new Qr;l=this.patternToChar(p),this.decodeRowResult+=l,c=u;try{for(var m=(s=void 0,ns(f)),g=m.next();!g.done;g=m.next()){u+=g.value}}catch(N){s={error:N}}finally{try{g&&!g.done&&(i=m.return)&&i.call(m)}finally{if(s)throw s.error}}u=r.getNextSet(u)}while("*"!==l);this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);var x=0;try{for(var y=ns(f),v=y.next();!v.done;v=y.next()){x+=v.value}}catch(j){a={error:j}}finally{try{v&&!v.done&&(o=y.return)&&o.call(y)}finally{if(a)throw a.error}}if(u===h||!r.get(u))throw new Qr;if(this.decodeRowResult.length<2)throw new Qr;this.checkChecksums(this.decodeRowResult),this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-2);var w=this.decodeExtended(this.decodeRowResult),_=(d[1]+d[0])/2,b=c+x/2;return new pn(w,null,0,[new Pn(_,e),new Pn(b,e)],mn.CODE_93,(new Date).getTime())},t.prototype.findAsteriskPattern=function(e){var r=e.getSize(),n=e.getNextSet(0);this.counters.fill(0);for(var s=this.counters,i=n,a=!1,o=s.length,l=0,c=n;c<r;c++)if(e.get(c)!==a)s[l]++;else{if(l===o-1){if(this.toPattern(s)===t.ASTERISK_ENCODING)return new Int32Array([i,c]);i+=s[0]+s[1],s.copyWithin(0,2,2+l-1),s[l-1]=0,s[l]=0,l--}else l++;s[l]=1,a=!a}throw new Qr},t.prototype.toPattern=function(e){var t,r,n=0;try{for(var s=ns(e),i=s.next();!i.done;i=s.next()){n+=i.value}}catch(u){t={error:u}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}for(var a=0,o=e.length,l=0;l<o;l++){var c=Math.round(9*e[l]/n);if(c<1||c>4)return-1;if(1&l)a<<=c;else for(var d=0;d<c;d++)a=a<<1|1}return a},t.prototype.patternToChar=function(e){for(var r=0;r<t.CHARACTER_ENCODINGS.length;r++)if(t.CHARACTER_ENCODINGS[r]===e)return t.ALPHABET_STRING.charAt(r);throw new Qr},t.prototype.decodeExtended=function(e){for(var t=e.length,r="",n=0;n<t;n++){var s=e.charAt(n);if(s>="a"&&s<="d"){if(n>=t-1)throw new Ur;var i=e.charAt(n+1),a="\0";switch(s){case"d":if(!(i>="A"&&i<="Z"))throw new Ur;a=String.fromCharCode(i.charCodeAt(0)+32);break;case"a":if(!(i>="A"&&i<="Z"))throw new Ur;a=String.fromCharCode(i.charCodeAt(0)-64);break;case"b":if(i>="A"&&i<="E")a=String.fromCharCode(i.charCodeAt(0)-38);else if(i>="F"&&i<="J")a=String.fromCharCode(i.charCodeAt(0)-11);else if(i>="K"&&i<="O")a=String.fromCharCode(i.charCodeAt(0)+16);else if(i>="P"&&i<="T")a=String.fromCharCode(i.charCodeAt(0)+43);else if("U"===i)a="\0";else if("V"===i)a="@";else if("W"===i)a="`";else{if(!(i>="X"&&i<="Z"))throw new Ur;a=String.fromCharCode(127)}break;case"c":if(i>="A"&&i<="O")a=String.fromCharCode(i.charCodeAt(0)-32);else{if("Z"!==i)throw new Ur;a=":"}}r+=a,n++}else r+=s}return r},t.prototype.checkChecksums=function(e){var t=e.length;this.checkOneChecksum(e,t-2,20),this.checkOneChecksum(e,t-1,15)},t.prototype.checkOneChecksum=function(e,r,n){for(var s=1,i=0,a=r-1;a>=0;a--)i+=s*t.ALPHABET_STRING.indexOf(e.charAt(a)),++s>n&&(s=1);if(e.charAt(r)!==t.ALPHABET_STRING[i%47])throw new Cr},t.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%abcd*",t.CHARACTER_ENCODINGS=[276,328,324,322,296,292,290,336,274,266,424,420,418,404,402,394,360,356,354,308,282,344,332,326,300,278,436,434,428,422,406,410,364,358,310,314,302,468,466,458,366,374,430,294,474,470,306,350],t.ASTERISK_ENCODING=t.CHARACTER_ENCODINGS[47],t}(Zn),is=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),as=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},os=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.narrowLineWidth=-1,t}return is(t,e),t.prototype.decodeRow=function(e,r,n){var s,i,a=this.decodeStart(r),o=this.decodeEnd(r),l=new Kr;t.decodeMiddle(r,a[1],o[0],l);var c=l.toString(),d=null;null!=n&&(d=n.get(Pr.ALLOWED_LENGTHS)),null==d&&(d=t.DEFAULT_ALLOWED_LENGTHS);var u=c.length,h=!1,f=0;try{for(var p=as(d),m=p.next();!m.done;m=p.next()){var g=m.value;if(u===g){h=!0;break}g>f&&(f=g)}}catch(y){s={error:y}}finally{try{m&&!m.done&&(i=p.return)&&i.call(p)}finally{if(s)throw s.error}}if(!h&&u>f&&(h=!0),!h)throw new Ur;var x=[new Pn(a[1],e),new Pn(o[0],e)];return new pn(c,null,0,x,mn.ITF,(new Date).getTime())},t.decodeMiddle=function(e,r,n,s){var i=new Int32Array(10),a=new Int32Array(5),o=new Int32Array(5);for(i.fill(0),a.fill(0),o.fill(0);r<n;){Zn.recordPattern(e,r,i);for(var l=0;l<5;l++){var c=2*l;a[l]=i[c],o[l]=i[c+1]}var d=t.decodeDigit(a);s.append(d.toString()),d=this.decodeDigit(o),s.append(d.toString()),i.forEach(function(e){r+=e})}},t.prototype.decodeStart=function(e){var r=t.skipWhiteSpace(e),n=t.findGuardPattern(e,r,t.START_PATTERN);return this.narrowLineWidth=(n[1]-n[0])/4,this.validateQuietZone(e,n[0]),n},t.prototype.validateQuietZone=function(e,t){var r=10*this.narrowLineWidth;r=r<t?r:t;for(var n=t-1;r>0&&n>=0&&!e.get(n);n--)r--;if(0!==r)throw new Qr},t.skipWhiteSpace=function(e){var t=e.getSize(),r=e.getNextSet(0);if(r===t)throw new Qr;return r},t.prototype.decodeEnd=function(e){e.reverse();try{var r=t.skipWhiteSpace(e),n=void 0;try{n=t.findGuardPattern(e,r,t.END_PATTERN_REVERSED[0])}catch(i){i instanceof Qr&&(n=t.findGuardPattern(e,r,t.END_PATTERN_REVERSED[1]))}this.validateQuietZone(e,n[0]);var s=n[0];return n[0]=e.getSize()-n[1],n[1]=e.getSize()-s,n}finally{e.reverse()}},t.findGuardPattern=function(e,r,n){var s=n.length,i=new Int32Array(s),a=e.getSize(),o=!1,l=0,c=r;i.fill(0);for(var d=r;d<a;d++)if(e.get(d)!==o)i[l]++;else{if(l===s-1){if(Zn.patternMatchVariance(i,n,t.MAX_INDIVIDUAL_VARIANCE)<t.MAX_AVG_VARIANCE)return[c,d];c+=i[0]+i[1],Sr.arraycopy(i,2,i,0,l-1),i[l-1]=0,i[l]=0,l--}else l++;i[l]=1,o=!o}throw new Qr},t.decodeDigit=function(e){for(var r=t.MAX_AVG_VARIANCE,n=-1,s=t.PATTERNS.length,i=0;i<s;i++){var a=t.PATTERNS[i],o=Zn.patternMatchVariance(e,a,t.MAX_INDIVIDUAL_VARIANCE);o<r?(r=o,n=i):o===r&&(n=-1)}if(n>=0)return n%10;throw new Qr},t.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],t.MAX_AVG_VARIANCE=.38,t.MAX_INDIVIDUAL_VARIANCE=.5,t.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],t.START_PATTERN=Int32Array.from([1,1,1,1]),t.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])],t}(Zn),ls=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),cs=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.decodeRowStringBuffer="",t}return ls(t,e),t.findStartGuardPattern=function(e){for(var r,n=!1,s=0,i=Int32Array.from([0,0,0]);!n;){i=Int32Array.from([0,0,0]);var a=(r=t.findGuardPattern(e,s,!1,this.START_END_PATTERN,i))[0],o=a-((s=r[1])-a);o>=0&&(n=e.isRange(o,a,!1))}return r},t.checkChecksum=function(e){return t.checkStandardUPCEANChecksum(e)},t.checkStandardUPCEANChecksum=function(e){var r=e.length;if(0===r)return!1;var n=parseInt(e.charAt(r-1),10);return t.getStandardUPCEANChecksum(e.substring(0,r-1))===n},t.getStandardUPCEANChecksum=function(e){for(var t=e.length,r=0,n=t-1;n>=0;n-=2){if((s=e.charAt(n).charCodeAt(0)-"0".charCodeAt(0))<0||s>9)throw new Ur;r+=s}r*=3;for(n=t-2;n>=0;n-=2){var s;if((s=e.charAt(n).charCodeAt(0)-"0".charCodeAt(0))<0||s>9)throw new Ur;r+=s}return(1e3-r)%10},t.decodeEnd=function(e,r){return t.findGuardPattern(e,r,!1,t.START_END_PATTERN,new Int32Array(t.START_END_PATTERN.length).fill(0))},t.findGuardPatternWithoutCounters=function(e,t,r,n){return this.findGuardPattern(e,t,r,n,new Int32Array(n.length))},t.findGuardPattern=function(e,r,n,s,i){for(var a=e.getSize(),o=0,l=r=n?e.getNextUnset(r):e.getNextSet(r),c=s.length,d=n,u=r;u<a;u++)if(e.get(u)!==d)i[o]++;else{if(o===c-1){if(Zn.patternMatchVariance(i,s,t.MAX_INDIVIDUAL_VARIANCE)<t.MAX_AVG_VARIANCE)return Int32Array.from([l,u]);l+=i[0]+i[1];for(var h=i.slice(2,i.length),f=0;f<o-1;f++)i[f]=h[f];i[o-1]=0,i[o]=0,o--}else o++;i[o]=1,d=!d}throw new Qr},t.decodeDigit=function(e,r,n,s){this.recordPattern(e,n,r);for(var i=this.MAX_AVG_VARIANCE,a=-1,o=s.length,l=0;l<o;l++){var c=s[l],d=Zn.patternMatchVariance(r,c,t.MAX_INDIVIDUAL_VARIANCE);d<i&&(i=d,a=l)}if(a>=0)return a;throw new Qr},t.MAX_AVG_VARIANCE=.48,t.MAX_INDIVIDUAL_VARIANCE=.7,t.START_END_PATTERN=Int32Array.from([1,1,1]),t.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),t.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),t.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])],t}(Zn),ds=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},us=function(){function e(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}return e.prototype.decodeRow=function(t,r,n){var s=this.decodeRowStringBuffer,i=this.decodeMiddle(r,n,s),a=s.toString(),o=e.parseExtensionString(a),l=[new Pn((n[0]+n[1])/2,t),new Pn(i,t)],c=new pn(a,null,0,l,mn.UPC_EAN_EXTENSION,(new Date).getTime());return null!=o&&c.putAllMetadata(o),c},e.prototype.decodeMiddle=function(t,r,n){var s,i,a=this.decodeMiddleCounters;a[0]=0,a[1]=0,a[2]=0,a[3]=0;for(var o=t.getSize(),l=r[1],c=0,d=0;d<5&&l<o;d++){var u=cs.decodeDigit(t,a,l,cs.L_AND_G_PATTERNS);n+=String.fromCharCode("0".charCodeAt(0)+u%10);try{for(var h=(s=void 0,ds(a)),f=h.next();!f.done;f=h.next()){l+=f.value}}catch(m){s={error:m}}finally{try{f&&!f.done&&(i=h.return)&&i.call(h)}finally{if(s)throw s.error}}u>=10&&(c|=1<<4-d),4!==d&&(l=t.getNextSet(l),l=t.getNextUnset(l))}if(5!==n.length)throw new Qr;var p=this.determineCheckDigit(c);if(e.extensionChecksum(n.toString())!==p)throw new Qr;return l},e.extensionChecksum=function(e){for(var t=e.length,r=0,n=t-2;n>=0;n-=2)r+=e.charAt(n).charCodeAt(0)-"0".charCodeAt(0);r*=3;for(n=t-1;n>=0;n-=2)r+=e.charAt(n).charCodeAt(0)-"0".charCodeAt(0);return(r*=3)%10},e.prototype.determineCheckDigit=function(e){for(var t=0;t<10;t++)if(e===this.CHECK_DIGIT_ENCODINGS[t])return t;throw new Qr},e.parseExtensionString=function(t){if(5!==t.length)return null;var r=e.parseExtension5String(t);return null==r?null:new Map([[yn.SUGGESTED_PRICE,r]])},e.parseExtension5String=function(e){var t;switch(e.charAt(0)){case"0":t="Â£";break;case"5":t="$";break;case"9":switch(e){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}t="";break;default:t=""}var r=parseInt(e.substring(1)),n=r%100;return t+(r/100).toString()+"."+(n<10?"0"+n:n.toString())},e}(),hs=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},fs=function(){function e(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}return e.prototype.decodeRow=function(t,r,n){var s=this.decodeRowStringBuffer,i=this.decodeMiddle(r,n,s),a=s.toString(),o=e.parseExtensionString(a),l=[new Pn((n[0]+n[1])/2,t),new Pn(i,t)],c=new pn(a,null,0,l,mn.UPC_EAN_EXTENSION,(new Date).getTime());return null!=o&&c.putAllMetadata(o),c},e.prototype.decodeMiddle=function(e,t,r){var n,s,i=this.decodeMiddleCounters;i[0]=0,i[1]=0,i[2]=0,i[3]=0;for(var a=e.getSize(),o=t[1],l=0,c=0;c<2&&o<a;c++){var d=cs.decodeDigit(e,i,o,cs.L_AND_G_PATTERNS);r+=String.fromCharCode("0".charCodeAt(0)+d%10);try{for(var u=(n=void 0,hs(i)),h=u.next();!h.done;h=u.next()){o+=h.value}}catch(f){n={error:f}}finally{try{h&&!h.done&&(s=u.return)&&s.call(u)}finally{if(n)throw n.error}}d>=10&&(l|=1<<1-c),1!==c&&(o=e.getNextSet(o),o=e.getNextUnset(o))}if(2!==r.length)throw new Qr;if(parseInt(r.toString())%4!==l)throw new Qr;return o},e.parseExtensionString=function(e){return 2!==e.length?null:new Map([[yn.ISSUE_NUMBER,parseInt(e)]])},e}(),ps=function(){function e(){}return e.decodeRow=function(e,t,r){var n=cs.findGuardPattern(t,r,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return(new us).decodeRow(e,t,n)}catch(s){return(new fs).decodeRow(e,t,n)}},e.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]),e}(),ms=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),gs=function(e){function t(){var r=e.call(this)||this;r.decodeRowStringBuffer="",t.L_AND_G_PATTERNS=t.L_PATTERNS.map(function(e){return Int32Array.from(e)});for(var n=10;n<20;n++){for(var s=t.L_PATTERNS[n-10],i=new Int32Array(s.length),a=0;a<s.length;a++)i[a]=s[s.length-a-1];t.L_AND_G_PATTERNS[n]=i}return r}return ms(t,e),t.prototype.decodeRow=function(e,r,n){var s=t.findStartGuardPattern(r),i=null==n?null:n.get(Pr.NEED_RESULT_POINT_CALLBACK);if(null!=i){var a=new Pn((s[0]+s[1])/2,e);i.foundPossibleResultPoint(a)}var o=this.decodeMiddle(r,s,this.decodeRowStringBuffer),l=o.rowOffset,c=o.resultString;if(null!=i){var d=new Pn(l,e);i.foundPossibleResultPoint(d)}var u=t.decodeEnd(r,l);if(null!=i){var h=new Pn((u[0]+u[1])/2,e);i.foundPossibleResultPoint(h)}var f=u[1],p=f+(f-u[0]);if(p>=r.getSize()||!r.isRange(f,p,!1))throw new Qr;var m=c.toString();if(m.length<8)throw new Ur;if(!t.checkChecksum(m))throw new Cr;var g=(s[1]+s[0])/2,x=(u[1]+u[0])/2,y=this.getBarcodeFormat(),v=[new Pn(g,e),new Pn(x,e)],w=new pn(m,null,0,v,y,(new Date).getTime()),_=0;try{var b=ps.decodeRow(e,r,u[1]);w.putMetadata(yn.UPC_EAN_EXTENSION,b.getText()),w.putAllMetadata(b.getResultMetadata()),w.addResultPoints(b.getResultPoints()),_=b.getText().length}catch(A){}var N=null==n?null:n.get(Pr.ALLOWED_EAN_EXTENSIONS);if(null!=N){var j=!1;for(var C in N)if(_.toString()===C){j=!0;break}if(!j)throw new Qr}return y===mn.EAN_13||mn.UPC_A,w},t.checkChecksum=function(e){return t.checkStandardUPCEANChecksum(e)},t.checkStandardUPCEANChecksum=function(e){var r=e.length;if(0===r)return!1;var n=parseInt(e.charAt(r-1),10);return t.getStandardUPCEANChecksum(e.substring(0,r-1))===n},t.getStandardUPCEANChecksum=function(e){for(var t=e.length,r=0,n=t-1;n>=0;n-=2){if((s=e.charAt(n).charCodeAt(0)-"0".charCodeAt(0))<0||s>9)throw new Ur;r+=s}r*=3;for(n=t-2;n>=0;n-=2){var s;if((s=e.charAt(n).charCodeAt(0)-"0".charCodeAt(0))<0||s>9)throw new Ur;r+=s}return(1e3-r)%10},t.decodeEnd=function(e,r){return t.findGuardPattern(e,r,!1,t.START_END_PATTERN,new Int32Array(t.START_END_PATTERN.length).fill(0))},t}(cs),xs=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ys=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},vs=function(e){function t(){var t=e.call(this)||this;return t.decodeMiddleCounters=Int32Array.from([0,0,0,0]),t}return xs(t,e),t.prototype.decodeMiddle=function(e,r,n){var s,i,a,o,l=this.decodeMiddleCounters;l[0]=0,l[1]=0,l[2]=0,l[3]=0;for(var c=e.getSize(),d=r[1],u=0,h=0;h<6&&d<c;h++){var f=gs.decodeDigit(e,l,d,gs.L_AND_G_PATTERNS);n+=String.fromCharCode("0".charCodeAt(0)+f%10);try{for(var p=(s=void 0,ys(l)),m=p.next();!m.done;m=p.next()){d+=m.value}}catch(y){s={error:y}}finally{try{m&&!m.done&&(i=p.return)&&i.call(p)}finally{if(s)throw s.error}}f>=10&&(u|=1<<5-h)}n=t.determineFirstDigit(n,u),d=gs.findGuardPattern(e,d,!0,gs.MIDDLE_PATTERN,new Int32Array(gs.MIDDLE_PATTERN.length).fill(0))[1];for(h=0;h<6&&d<c;h++){f=gs.decodeDigit(e,l,d,gs.L_PATTERNS);n+=String.fromCharCode("0".charCodeAt(0)+f);try{for(var g=(a=void 0,ys(l)),x=g.next();!x.done;x=g.next()){d+=x.value}}catch(v){a={error:v}}finally{try{x&&!x.done&&(o=g.return)&&o.call(g)}finally{if(a)throw a.error}}}return{rowOffset:d,resultString:n}},t.prototype.getBarcodeFormat=function(){return mn.EAN_13},t.determineFirstDigit=function(e,t){for(var r=0;r<10;r++)if(t===this.FIRST_DIGIT_ENCODINGS[r])return e=String.fromCharCode("0".charCodeAt(0)+r)+e;throw new Qr},t.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26],t}(gs),ws=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),_s=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},bs=function(e){function t(){var t=e.call(this)||this;return t.decodeMiddleCounters=Int32Array.from([0,0,0,0]),t}return ws(t,e),t.prototype.decodeMiddle=function(e,t,r){var n,s,i,a,o=this.decodeMiddleCounters;o[0]=0,o[1]=0,o[2]=0,o[3]=0;for(var l=e.getSize(),c=t[1],d=0;d<4&&c<l;d++){var u=gs.decodeDigit(e,o,c,gs.L_PATTERNS);r+=String.fromCharCode("0".charCodeAt(0)+u);try{for(var h=(n=void 0,_s(o)),f=h.next();!f.done;f=h.next()){c+=f.value}}catch(g){n={error:g}}finally{try{f&&!f.done&&(s=h.return)&&s.call(h)}finally{if(n)throw n.error}}}c=gs.findGuardPattern(e,c,!0,gs.MIDDLE_PATTERN,new Int32Array(gs.MIDDLE_PATTERN.length).fill(0))[1];for(d=0;d<4&&c<l;d++){u=gs.decodeDigit(e,o,c,gs.L_PATTERNS);r+=String.fromCharCode("0".charCodeAt(0)+u);try{for(var p=(i=void 0,_s(o)),m=p.next();!m.done;m=p.next()){c+=m.value}}catch(x){i={error:x}}finally{try{m&&!m.done&&(a=p.return)&&a.call(p)}finally{if(i)throw i.error}}}return{rowOffset:c,resultString:r}},t.prototype.getBarcodeFormat=function(){return mn.EAN_8},t}(gs),Ns=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),js=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ean13Reader=new vs,t}return Ns(t,e),t.prototype.getBarcodeFormat=function(){return mn.UPC_A},t.prototype.decode=function(e,t){return this.maybeReturnResult(this.ean13Reader.decode(e))},t.prototype.decodeRow=function(e,t,r){return this.maybeReturnResult(this.ean13Reader.decodeRow(e,t,r))},t.prototype.decodeMiddle=function(e,t,r){return this.ean13Reader.decodeMiddle(e,t,r)},t.prototype.maybeReturnResult=function(e){var t=e.getText();if("0"===t.charAt(0)){var r=new pn(t.substring(1),null,null,e.getResultPoints(),mn.UPC_A);return null!=e.getResultMetadata()&&r.putAllMetadata(e.getResultMetadata()),r}throw new Qr},t.prototype.reset=function(){this.ean13Reader.reset()},t}(gs),Cs=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),As=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ss=function(e){function t(){var t=e.call(this)||this;return t.decodeMiddleCounters=new Int32Array(4),t}return Cs(t,e),t.prototype.decodeMiddle=function(e,r,n){var s,i,a=this.decodeMiddleCounters.map(function(e){return e});a[0]=0,a[1]=0,a[2]=0,a[3]=0;for(var o=e.getSize(),l=r[1],c=0,d=0;d<6&&l<o;d++){var u=t.decodeDigit(e,a,l,t.L_AND_G_PATTERNS);n+=String.fromCharCode("0".charCodeAt(0)+u%10);try{for(var h=(s=void 0,As(a)),f=h.next();!f.done;f=h.next()){l+=f.value}}catch(p){s={error:p}}finally{try{f&&!f.done&&(i=h.return)&&i.call(h)}finally{if(s)throw s.error}}u>=10&&(c|=1<<5-d)}return t.determineNumSysAndCheckDigit(new Kr(n),c),l},t.prototype.decodeEnd=function(e,r){return t.findGuardPatternWithoutCounters(e,r,!0,t.MIDDLE_END_PATTERN)},t.prototype.checkChecksum=function(e){return gs.checkChecksum(t.convertUPCEtoUPCA(e))},t.determineNumSysAndCheckDigit=function(e,t){for(var r=0;r<=1;r++)for(var n=0;n<10;n++)if(t===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[r][n])return e.insert(0,"0"+r),void e.append("0"+n);throw Qr.getNotFoundInstance()},t.prototype.getBarcodeFormat=function(){return mn.UPC_E},t.convertUPCEtoUPCA=function(e){var t=e.slice(1,7).split("").map(function(e){return e.charCodeAt(0)}),r=new Kr;r.append(e.charAt(0));var n=t[5];switch(n){case 0:case 1:case 2:r.appendChars(t,0,2),r.append(n),r.append("0000"),r.appendChars(t,2,3);break;case 3:r.appendChars(t,0,3),r.append("00000"),r.appendChars(t,3,2);break;case 4:r.appendChars(t,0,4),r.append("00000"),r.append(t[4]);break;default:r.appendChars(t,0,5),r.append("0000"),r.append(n)}return e.length>=8&&r.append(e.charAt(7)),r.toString()},t.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),t.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,1])],t}(gs),Es=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Is=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ts=function(e){function t(t){var r=e.call(this)||this,n=null==t?null:t.get(Pr.POSSIBLE_FORMATS),s=[];return null!=n&&(n.indexOf(mn.EAN_13)>-1&&s.push(new vs),n.indexOf(mn.UPC_A)>-1&&s.push(new js),n.indexOf(mn.EAN_8)>-1&&s.push(new bs),n.indexOf(mn.UPC_E)>-1&&s.push(new Ss)),0===s.length&&(s.push(new vs),s.push(new js),s.push(new bs),s.push(new Ss)),r.readers=s,r}return Es(t,e),t.prototype.decodeRow=function(e,t,r){var n,s;try{for(var i=Is(this.readers),a=i.next();!a.done;a=i.next()){var o=a.value;try{var l=o.decodeRow(e,t,r),c=l.getBarcodeFormat()===mn.EAN_13&&"0"===l.getText().charAt(0),d=null==r?null:r.get(Pr.POSSIBLE_FORMATS),u=null==d||d.includes(mn.UPC_A);if(c&&u){var h=l.getRawBytes(),f=new pn(l.getText().substring(1),h,h?h.length:null,l.getResultPoints(),mn.UPC_A);return f.putAllMetadata(l.getResultMetadata()),f}return l}catch(p){}}}catch(m){n={error:m}}finally{try{a&&!a.done&&(s=i.return)&&s.call(i)}finally{if(n)throw n.error}}throw new Qr},t.prototype.reset=function(){var e,t;try{for(var r=Is(this.readers),n=r.next();!n.done;n=r.next()){n.value.reset()}}catch(s){e={error:s}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t}(Zn),Ds=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Os=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.CODA_BAR_CHAR_SET={nnnnnww:"0",nnnnwwn:"1",nnnwnnw:"2",wwnnnnn:"3",nnwnnwn:"4",wnnnnwn:"5",nwnnnnw:"6",nwnnwnn:"7",nwwnnnn:"8",wnnwnnn:"9",nnnwwnn:"-",nnwwnnn:"$",wnnnwnw:":",wnwnnnw:"/",wnwnwnn:".",nnwwwww:"+",nnwwnwn:"A",nwnwnnw:"B",nnnwnww:"C",nnnwwwn:"D"},t}return Ds(t,e),t.prototype.decodeRow=function(e,t,r){var n=this.getValidRowData(t);if(!n)throw new Qr;var s=this.codaBarDecodeRow(n.row);if(!s)throw new Qr;return new pn(s,null,0,[new Pn(n.left,e),new Pn(n.right,e)],mn.CODABAR,(new Date).getTime())},t.prototype.getValidRowData=function(e){var t=e.toArray(),r=t.indexOf(!0);if(-1===r)return null;var n=t.lastIndexOf(!0);if(n<=r)return null;for(var s=[],i=(t=t.slice(r,n+1))[0],a=1,o=1;o<t.length;o++)t[o]===i?a++:(i=t[o],s.push(a),a=1);return s.push(a),s.length<23&&(s.length+1)%8!=0?null:{row:s,left:r,right:n}},t.prototype.codaBarDecodeRow=function(e){for(var t=[],r=Math.ceil(e.reduce(function(e,t){return(e+t)/2},0));e.length>0;){var n=e.splice(0,8).splice(0,7).map(function(e){return e<r?"n":"w"}).join("");if(void 0===this.CODA_BAR_CHAR_SET[n])return null;t.push(this.CODA_BAR_CHAR_SET[n])}var s=t.join("");return this.validCodaBarString(s)?s:null},t.prototype.validCodaBarString=function(e){return/^[A-D].{1,}[A-D]$/.test(e)},t}(Zn),Rs=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ks=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ms=function(e){function t(){var t=e.call(this)||this;return t.decodeFinderCounters=new Int32Array(4),t.dataCharacterCounters=new Int32Array(8),t.oddRoundingErrors=new Array(4),t.evenRoundingErrors=new Array(4),t.oddCounts=new Array(t.dataCharacterCounters.length/2),t.evenCounts=new Array(t.dataCharacterCounters.length/2),t}return Rs(t,e),t.prototype.getDecodeFinderCounters=function(){return this.decodeFinderCounters},t.prototype.getDataCharacterCounters=function(){return this.dataCharacterCounters},t.prototype.getOddRoundingErrors=function(){return this.oddRoundingErrors},t.prototype.getEvenRoundingErrors=function(){return this.evenRoundingErrors},t.prototype.getOddCounts=function(){return this.oddCounts},t.prototype.getEvenCounts=function(){return this.evenCounts},t.prototype.parseFinderValue=function(e,r){for(var n=0;n<r.length;n++)if(Zn.patternMatchVariance(e,r[n],t.MAX_INDIVIDUAL_VARIANCE)<t.MAX_AVG_VARIANCE)return n;throw new Qr},t.count=function(e){return kn.sum(new Int32Array(e))},t.increment=function(e,t){for(var r=0,n=t[0],s=1;s<e.length;s++)t[s]>n&&(n=t[s],r=s);e[r]++},t.decrement=function(e,t){for(var r=0,n=t[0],s=1;s<e.length;s++)t[s]<n&&(n=t[s],r=s);e[r]--},t.isFinderPattern=function(e){var r,n,s=e[0]+e[1],i=s/(s+e[2]+e[3]);if(i>=t.MIN_FINDER_PATTERN_RATIO&&i<=t.MAX_FINDER_PATTERN_RATIO){var a=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;try{for(var l=ks(e),c=l.next();!c.done;c=l.next()){var d=c.value;d>o&&(o=d),d<a&&(a=d)}}catch(u){r={error:u}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}return o<10*a}return!1},t.MAX_AVG_VARIANCE=.2,t.MAX_INDIVIDUAL_VARIANCE=.45,t.MIN_FINDER_PATTERN_RATIO=9.5/12,t.MAX_FINDER_PATTERN_RATIO=12.5/14,t}(Zn),Ps=function(){function e(e,t){this.value=e,this.checksumPortion=t}return e.prototype.getValue=function(){return this.value},e.prototype.getChecksumPortion=function(){return this.checksumPortion},e.prototype.toString=function(){return this.value+"("+this.checksumPortion+")"},e.prototype.equals=function(t){if(!(t instanceof e))return!1;var r=t;return this.value===r.value&&this.checksumPortion===r.checksumPortion},e.prototype.hashCode=function(){return this.value^this.checksumPortion},e}(),Bs=function(){function e(e,t,r,n,s){this.value=e,this.startEnd=t,this.value=e,this.startEnd=t,this.resultPoints=new Array,this.resultPoints.push(new Pn(r,s)),this.resultPoints.push(new Pn(n,s))}return e.prototype.getValue=function(){return this.value},e.prototype.getStartEnd=function(){return this.startEnd},e.prototype.getResultPoints=function(){return this.resultPoints},e.prototype.equals=function(t){if(!(t instanceof e))return!1;var r=t;return this.value===r.value},e.prototype.hashCode=function(){return this.value},e}(),Fs=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ls=function(){function e(){}return e.getRSSvalue=function(t,r,n){var s,i,a=0;try{for(var o=Fs(t),l=o.next();!l.done;l=o.next()){a+=l.value}}catch(x){s={error:x}}finally{try{l&&!l.done&&(i=o.return)&&i.call(o)}finally{if(s)throw s.error}}for(var c=0,d=0,u=t.length,h=0;h<u-1;h++){var f=void 0;for(f=1,d|=1<<h;f<t[h];f++,d&=~(1<<h)){var p=e.combins(a-f-1,u-h-2);if(n&&0===d&&a-f-(u-h-1)>=u-h-1&&(p-=e.combins(a-f-(u-h),u-h-2)),u-h-1>1){for(var m=0,g=a-f-(u-h-2);g>r;g--)m+=e.combins(a-f-g-1,u-h-3);p-=m*(u-1-h)}else a-f>r&&p--;c+=p}a-=f}return c},e.combins=function(e,t){var r,n;e-t>t?(n=t,r=e-t):(n=e-t,r=t);for(var s=1,i=1,a=e;a>r;a--)s*=a,i<=n&&(s/=i,i++);for(;i<=n;)s/=i,i++;return s},e}(),Us=function(){function e(){}return e.buildBitArray=function(e){var t=2*e.length-1;null==e[e.length-1].getRightChar()&&(t-=1);for(var r=new Mr(12*t),n=0,s=e[0].getRightChar().getValue(),i=11;i>=0;--i)s&1<<i&&r.set(n),n++;for(i=1;i<e.length;++i){for(var a=e[i],o=a.getLeftChar().getValue(),l=11;l>=0;--l)o&1<<l&&r.set(n),n++;if(null!==a.getRightChar()){var c=a.getRightChar().getValue();for(l=11;l>=0;--l)c&1<<l&&r.set(n),n++}}return r},e}(),Vs=function(){function e(e,t){t?this.decodedInformation=null:(this.finished=e,this.decodedInformation=t)}return e.prototype.getDecodedInformation=function(){return this.decodedInformation},e.prototype.isFinished=function(){return this.finished},e}(),Hs=function(){function e(e){this.newPosition=e}return e.prototype.getNewPosition=function(){return this.newPosition},e}(),Gs=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ws=function(e){function t(t,r){var n=e.call(this,t)||this;return n.value=r,n}return Gs(t,e),t.prototype.getValue=function(){return this.value},t.prototype.isFNC1=function(){return this.value===t.FNC1},t.FNC1="$",t}(Hs),zs=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Xs=function(e){function t(t,r,n){var s=e.call(this,t)||this;return n?(s.remaining=!0,s.remainingValue=s.remainingValue):(s.remaining=!1,s.remainingValue=0),s.newString=r,s}return zs(t,e),t.prototype.getNewString=function(){return this.newString},t.prototype.isRemaining=function(){return this.remaining},t.prototype.getRemainingValue=function(){return this.remainingValue},t}(Hs),Ys=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),qs=function(e){function t(t,r,n){var s=e.call(this,t)||this;if(r<0||r>10||n<0||n>10)throw new Ur;return s.firstDigit=r,s.secondDigit=n,s}return Ys(t,e),t.prototype.getFirstDigit=function(){return this.firstDigit},t.prototype.getSecondDigit=function(){return this.secondDigit},t.prototype.getValue=function(){return 10*this.firstDigit+this.secondDigit},t.prototype.isFirstDigitFNC1=function(){return this.firstDigit===t.FNC1},t.prototype.isSecondDigitFNC1=function(){return this.secondDigit===t.FNC1},t.prototype.isAnyFNC1=function(){return this.firstDigit===t.FNC1||this.secondDigit===t.FNC1},t.FNC1=10,t}(Hs),Ks=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Zs=function(){function e(){}return e.parseFieldsInGeneralPurpose=function(t){var r,n,s,i,a,o,l,c;if(!t)return null;if(t.length<2)throw new Qr;var d=t.substring(0,2);try{for(var u=Ks(e.TWO_DIGIT_DATA_LENGTH),h=u.next();!h.done;h=u.next()){if((_=h.value)[0]===d)return _[1]===e.VARIABLE_LENGTH?e.processVariableAI(2,_[2],t):e.processFixedAI(2,_[1],t)}}catch(b){r={error:b}}finally{try{h&&!h.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}if(t.length<3)throw new Qr;var f=t.substring(0,3);try{for(var p=Ks(e.THREE_DIGIT_DATA_LENGTH),m=p.next();!m.done;m=p.next()){if((_=m.value)[0]===f)return _[1]===e.VARIABLE_LENGTH?e.processVariableAI(3,_[2],t):e.processFixedAI(3,_[1],t)}}catch(N){s={error:N}}finally{try{m&&!m.done&&(i=p.return)&&i.call(p)}finally{if(s)throw s.error}}try{for(var g=Ks(e.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH),x=g.next();!x.done;x=g.next()){if((_=x.value)[0]===f)return _[1]===e.VARIABLE_LENGTH?e.processVariableAI(4,_[2],t):e.processFixedAI(4,_[1],t)}}catch(j){a={error:j}}finally{try{x&&!x.done&&(o=g.return)&&o.call(g)}finally{if(a)throw a.error}}if(t.length<4)throw new Qr;var y=t.substring(0,4);try{for(var v=Ks(e.FOUR_DIGIT_DATA_LENGTH),w=v.next();!w.done;w=v.next()){var _;if((_=w.value)[0]===y)return _[1]===e.VARIABLE_LENGTH?e.processVariableAI(4,_[2],t):e.processFixedAI(4,_[1],t)}}catch(C){l={error:C}}finally{try{w&&!w.done&&(c=v.return)&&c.call(v)}finally{if(l)throw l.error}}throw new Qr},e.processFixedAI=function(t,r,n){if(n.length<t)throw new Qr;var s=n.substring(0,t);if(n.length<t+r)throw new Qr;var i=n.substring(t,t+r),a=n.substring(t+r),o="("+s+")"+i,l=e.parseFieldsInGeneralPurpose(a);return null==l?o:o+l},e.processVariableAI=function(t,r,n){var s,i=n.substring(0,t);s=n.length<t+r?n.length:t+r;var a=n.substring(t,s),o=n.substring(s),l="("+i+")"+a,c=e.parseFieldsInGeneralPurpose(o);return null==c?l:l+c},e.VARIABLE_LENGTH=[],e.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",e.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",e.VARIABLE_LENGTH,20],["22",e.VARIABLE_LENGTH,29],["30",e.VARIABLE_LENGTH,8],["37",e.VARIABLE_LENGTH,8],["90",e.VARIABLE_LENGTH,30],["91",e.VARIABLE_LENGTH,30],["92",e.VARIABLE_LENGTH,30],["93",e.VARIABLE_LENGTH,30],["94",e.VARIABLE_LENGTH,30],["95",e.VARIABLE_LENGTH,30],["96",e.VARIABLE_LENGTH,30],["97",e.VARIABLE_LENGTH,3],["98",e.VARIABLE_LENGTH,30],["99",e.VARIABLE_LENGTH,30]],e.THREE_DIGIT_DATA_LENGTH=[["240",e.VARIABLE_LENGTH,30],["241",e.VARIABLE_LENGTH,30],["242",e.VARIABLE_LENGTH,6],["250",e.VARIABLE_LENGTH,30],["251",e.VARIABLE_LENGTH,30],["253",e.VARIABLE_LENGTH,17],["254",e.VARIABLE_LENGTH,20],["400",e.VARIABLE_LENGTH,30],["401",e.VARIABLE_LENGTH,30],["402",17],["403",e.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",e.VARIABLE_LENGTH,20],["421",e.VARIABLE_LENGTH,15],["422",3],["423",e.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],e.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",e.VARIABLE_LENGTH,15],["391",e.VARIABLE_LENGTH,18],["392",e.VARIABLE_LENGTH,15],["393",e.VARIABLE_LENGTH,18],["703",e.VARIABLE_LENGTH,30]],e.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",e.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",e.VARIABLE_LENGTH,20],["8003",e.VARIABLE_LENGTH,30],["8004",e.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",e.VARIABLE_LENGTH,30],["8008",e.VARIABLE_LENGTH,12],["8018",18],["8020",e.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",e.VARIABLE_LENGTH,70],["8200",e.VARIABLE_LENGTH,70]],e}(),$s=function(){function e(e){this.buffer=new Kr,this.information=e}return e.prototype.decodeAllCodes=function(e,t){for(var r=t,n=null;;){var s=this.decodeGeneralPurposeField(r,n),i=Zs.parseFieldsInGeneralPurpose(s.getNewString());if(null!=i&&e.append(i),n=s.isRemaining()?""+s.getRemainingValue():null,r===s.getNewPosition())break;r=s.getNewPosition()}return e.toString()},e.prototype.isStillNumeric=function(e){if(e+7>this.information.getSize())return e+4<=this.information.getSize();for(var t=e;t<e+3;++t)if(this.information.get(t))return!0;return this.information.get(e+3)},e.prototype.decodeNumeric=function(e){if(e+7>this.information.getSize()){var t=this.extractNumericValueFromBitArray(e,4);return new qs(this.information.getSize(),0===t?qs.FNC1:t-1,qs.FNC1)}var r=this.extractNumericValueFromBitArray(e,7);return new qs(e+7,(r-8)/11,(r-8)%11)},e.prototype.extractNumericValueFromBitArray=function(t,r){return e.extractNumericValueFromBitArray(this.information,t,r)},e.extractNumericValueFromBitArray=function(e,t,r){for(var n=0,s=0;s<r;++s)e.get(t+s)&&(n|=1<<r-s-1);return n},e.prototype.decodeGeneralPurposeField=function(e,t){this.buffer.setLengthToZero(),null!=t&&this.buffer.append(t),this.current.setPosition(e);var r=this.parseBlocks();return null!=r&&r.isRemaining()?new Xs(this.current.getPosition(),this.buffer.toString(),r.getRemainingValue()):new Xs(this.current.getPosition(),this.buffer.toString())},e.prototype.parseBlocks=function(){var e,t;do{var r=this.current.getPosition();if(e=this.current.isAlpha()?(t=this.parseAlphaBlock()).isFinished():this.current.isIsoIec646()?(t=this.parseIsoIec646Block()).isFinished():(t=this.parseNumericBlock()).isFinished(),!(r!==this.current.getPosition())&&!e)break}while(!e);return t.getDecodedInformation()},e.prototype.parseNumericBlock=function(){for(;this.isStillNumeric(this.current.getPosition());){var e=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFirstDigitFNC1()){var t=void 0;return t=e.isSecondDigitFNC1()?new Xs(this.current.getPosition(),this.buffer.toString()):new Xs(this.current.getPosition(),this.buffer.toString(),e.getSecondDigit()),new Vs(!0,t)}if(this.buffer.append(e.getFirstDigit()),e.isSecondDigitFNC1()){t=new Xs(this.current.getPosition(),this.buffer.toString());return new Vs(!0,t)}this.buffer.append(e.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new Vs(!1)},e.prototype.parseIsoIec646Block=function(){for(;this.isStillIsoIec646(this.current.getPosition());){var e=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFNC1()){var t=new Xs(this.current.getPosition(),this.buffer.toString());return new Vs(!0,t)}this.buffer.append(e.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new Vs(!1)},e.prototype.parseAlphaBlock=function(){for(;this.isStillAlpha(this.current.getPosition());){var e=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFNC1()){var t=new Xs(this.current.getPosition(),this.buffer.toString());return new Vs(!0,t)}this.buffer.append(e.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new Vs(!1)},e.prototype.isStillIsoIec646=function(e){if(e+5>this.information.getSize())return!1;var t=this.extractNumericValueFromBitArray(e,5);if(t>=5&&t<16)return!0;if(e+7>this.information.getSize())return!1;var r=this.extractNumericValueFromBitArray(e,7);if(r>=64&&r<116)return!0;if(e+8>this.information.getSize())return!1;var n=this.extractNumericValueFromBitArray(e,8);return n>=232&&n<253},e.prototype.decodeIsoIec646=function(e){var t=this.extractNumericValueFromBitArray(e,5);if(15===t)return new Ws(e+5,Ws.FNC1);if(t>=5&&t<15)return new Ws(e+5,"0"+(t-5));var r,n=this.extractNumericValueFromBitArray(e,7);if(n>=64&&n<90)return new Ws(e+7,""+(n+1));if(n>=90&&n<116)return new Ws(e+7,""+(n+7));switch(this.extractNumericValueFromBitArray(e,8)){case 232:r="!";break;case 233:r='"';break;case 234:r="%";break;case 235:r="&";break;case 236:r="'";break;case 237:r="(";break;case 238:r=")";break;case 239:r="*";break;case 240:r="+";break;case 241:r=",";break;case 242:r="-";break;case 243:r=".";break;case 244:r="/";break;case 245:r=":";break;case 246:r=";";break;case 247:r="<";break;case 248:r="=";break;case 249:r=">";break;case 250:r="?";break;case 251:r="_";break;case 252:r=" ";break;default:throw new Ur}return new Ws(e+8,r)},e.prototype.isStillAlpha=function(e){if(e+5>this.information.getSize())return!1;var t=this.extractNumericValueFromBitArray(e,5);if(t>=5&&t<16)return!0;if(e+6>this.information.getSize())return!1;var r=this.extractNumericValueFromBitArray(e,6);return r>=16&&r<63},e.prototype.decodeAlphanumeric=function(e){var t=this.extractNumericValueFromBitArray(e,5);if(15===t)return new Ws(e+5,Ws.FNC1);if(t>=5&&t<15)return new Ws(e+5,"0"+(t-5));var r,n=this.extractNumericValueFromBitArray(e,6);if(n>=32&&n<58)return new Ws(e+6,""+(n+33));switch(n){case 58:r="*";break;case 59:r=",";break;case 60:r="-";break;case 61:r=".";break;case 62:r="/";break;default:throw new Dn("Decoding invalid alphanumeric value: "+n)}return new Ws(e+6,r)},e.prototype.isAlphaTo646ToAlphaLatch=function(e){if(e+1>this.information.getSize())return!1;for(var t=0;t<5&&t+e<this.information.getSize();++t)if(2===t){if(!this.information.get(e+2))return!1}else if(this.information.get(e+t))return!1;return!0},e.prototype.isAlphaOr646ToNumericLatch=function(e){if(e+3>this.information.getSize())return!1;for(var t=e;t<e+3;++t)if(this.information.get(t))return!1;return!0},e.prototype.isNumericToAlphaNumericLatch=function(e){if(e+1>this.information.getSize())return!1;for(var t=0;t<4&&t+e<this.information.getSize();++t)if(this.information.get(e+t))return!1;return!0},e}(),Qs=function(){function e(e){this.information=e,this.generalDecoder=new $s(e)}return e.prototype.getInformation=function(){return this.information},e.prototype.getGeneralDecoder=function(){return this.generalDecoder},e}(),Js=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ei=function(e){function t(t){return e.call(this,t)||this}return Js(t,e),t.prototype.encodeCompressedGtin=function(e,t){e.append("(01)");var r=e.length();e.append("9"),this.encodeCompressedGtinWithoutAI(e,t,r)},t.prototype.encodeCompressedGtinWithoutAI=function(e,r,n){for(var s=0;s<4;++s){var i=this.getGeneralDecoder().extractNumericValueFromBitArray(r+10*s,10);i/100==0&&e.append("0"),i/10==0&&e.append("0"),e.append(i)}t.appendCheckDigit(e,n)},t.appendCheckDigit=function(e,t){for(var r=0,n=0;n<13;n++){var s=e.charAt(n+t).charCodeAt(0)-"0".charCodeAt(0);r+=1&n?s:3*s}10===(r=10-r%10)&&(r=0),e.append(r)},t.GTIN_SIZE=40,t}(Qs),ti=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ri=function(e){function t(t){return e.call(this,t)||this}return ti(t,e),t.prototype.parseInformation=function(){var e=new Kr;e.append("(01)");var r=e.length(),n=this.getGeneralDecoder().extractNumericValueFromBitArray(t.HEADER_SIZE,4);return e.append(n),this.encodeCompressedGtinWithoutAI(e,t.HEADER_SIZE+4,r),this.getGeneralDecoder().decodeAllCodes(e,t.HEADER_SIZE+44)},t.HEADER_SIZE=4,t}(ei),ni=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),si=function(e){function t(t){return e.call(this,t)||this}return ni(t,e),t.prototype.parseInformation=function(){var e=new Kr;return this.getGeneralDecoder().decodeAllCodes(e,t.HEADER_SIZE)},t.HEADER_SIZE=5,t}(Qs),ii=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ai=function(e){function t(t){return e.call(this,t)||this}return ii(t,e),t.prototype.encodeCompressedWeight=function(e,t,r){var n=this.getGeneralDecoder().extractNumericValueFromBitArray(t,r);this.addWeightCode(e,n);for(var s=this.checkWeight(n),i=1e5,a=0;a<5;++a)s/i===0&&e.append("0"),i/=10;e.append(s)},t}(ei),oi=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),li=function(e){function t(t){return e.call(this,t)||this}return oi(t,e),t.prototype.parseInformation=function(){if(this.getInformation().getSize()!==t.HEADER_SIZE+ai.GTIN_SIZE+t.WEIGHT_SIZE)throw new Qr;var e=new Kr;return this.encodeCompressedGtin(e,t.HEADER_SIZE),this.encodeCompressedWeight(e,t.HEADER_SIZE+ai.GTIN_SIZE,t.WEIGHT_SIZE),e.toString()},t.HEADER_SIZE=5,t.WEIGHT_SIZE=15,t}(ai),ci=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),di=function(e){function t(t){return e.call(this,t)||this}return ci(t,e),t.prototype.addWeightCode=function(e,t){e.append("(3103)")},t.prototype.checkWeight=function(e){return e},t}(li),ui=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),hi=function(e){function t(t){return e.call(this,t)||this}return ui(t,e),t.prototype.addWeightCode=function(e,t){t<1e4?e.append("(3202)"):e.append("(3203)")},t.prototype.checkWeight=function(e){return e<1e4?e:e-1e4},t}(li),fi=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),pi=function(e){function t(t){return e.call(this,t)||this}return fi(t,e),t.prototype.parseInformation=function(){if(this.getInformation().getSize()<t.HEADER_SIZE+ei.GTIN_SIZE)throw new Qr;var e=new Kr;this.encodeCompressedGtin(e,t.HEADER_SIZE);var r=this.getGeneralDecoder().extractNumericValueFromBitArray(t.HEADER_SIZE+ei.GTIN_SIZE,t.LAST_DIGIT_SIZE);e.append("(392"),e.append(r),e.append(")");var n=this.getGeneralDecoder().decodeGeneralPurposeField(t.HEADER_SIZE+ei.GTIN_SIZE+t.LAST_DIGIT_SIZE,null);return e.append(n.getNewString()),e.toString()},t.HEADER_SIZE=8,t.LAST_DIGIT_SIZE=2,t}(ei),mi=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),gi=function(e){function t(t){return e.call(this,t)||this}return mi(t,e),t.prototype.parseInformation=function(){if(this.getInformation().getSize()<t.HEADER_SIZE+ei.GTIN_SIZE)throw new Qr;var e=new Kr;this.encodeCompressedGtin(e,t.HEADER_SIZE);var r=this.getGeneralDecoder().extractNumericValueFromBitArray(t.HEADER_SIZE+ei.GTIN_SIZE,t.LAST_DIGIT_SIZE);e.append("(393"),e.append(r),e.append(")");var n=this.getGeneralDecoder().extractNumericValueFromBitArray(t.HEADER_SIZE+ei.GTIN_SIZE+t.LAST_DIGIT_SIZE,t.FIRST_THREE_DIGITS_SIZE);n/100==0&&e.append("0"),n/10==0&&e.append("0"),e.append(n);var s=this.getGeneralDecoder().decodeGeneralPurposeField(t.HEADER_SIZE+ei.GTIN_SIZE+t.LAST_DIGIT_SIZE+t.FIRST_THREE_DIGITS_SIZE,null);return e.append(s.getNewString()),e.toString()},t.HEADER_SIZE=8,t.LAST_DIGIT_SIZE=2,t.FIRST_THREE_DIGITS_SIZE=10,t}(ei),xi=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),yi=function(e){function t(t,r,n){var s=e.call(this,t)||this;return s.dateCode=n,s.firstAIdigits=r,s}return xi(t,e),t.prototype.parseInformation=function(){if(this.getInformation().getSize()!==t.HEADER_SIZE+t.GTIN_SIZE+t.WEIGHT_SIZE+t.DATE_SIZE)throw new Qr;var e=new Kr;return this.encodeCompressedGtin(e,t.HEADER_SIZE),this.encodeCompressedWeight(e,t.HEADER_SIZE+t.GTIN_SIZE,t.WEIGHT_SIZE),this.encodeCompressedDate(e,t.HEADER_SIZE+t.GTIN_SIZE+t.WEIGHT_SIZE),e.toString()},t.prototype.encodeCompressedDate=function(e,r){var n=this.getGeneralDecoder().extractNumericValueFromBitArray(r,t.DATE_SIZE);if(38400!==n){e.append("("),e.append(this.dateCode),e.append(")");var s=n%32,i=(n/=32)%12+1,a=n/=12;a/10==0&&e.append("0"),e.append(a),i/10==0&&e.append("0"),e.append(i),s/10==0&&e.append("0"),e.append(s)}},t.prototype.addWeightCode=function(e,t){e.append("("),e.append(this.firstAIdigits),e.append(t/1e5),e.append(")")},t.prototype.checkWeight=function(e){return e%1e5},t.HEADER_SIZE=8,t.WEIGHT_SIZE=20,t.DATE_SIZE=16,t}(ai);var vi=function(){function e(e,t,r,n){this.leftchar=e,this.rightchar=t,this.finderpattern=r,this.maybeLast=n}return e.prototype.mayBeLast=function(){return this.maybeLast},e.prototype.getLeftChar=function(){return this.leftchar},e.prototype.getRightChar=function(){return this.rightchar},e.prototype.getFinderPattern=function(){return this.finderpattern},e.prototype.mustBeLast=function(){return null==this.rightchar},e.prototype.toString=function(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(null==this.finderpattern?"null":this.finderpattern.getValue())+" ]"},e.equals=function(t,r){return t instanceof e&&(e.equalsOrNull(t.leftchar,r.leftchar)&&e.equalsOrNull(t.rightchar,r.rightchar)&&e.equalsOrNull(t.finderpattern,r.finderpattern))},e.equalsOrNull=function(t,r){return null===t?null===r:e.equals(t,r)},e.prototype.hashCode=function(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()},e}(),wi=function(){function e(e,t,r){this.pairs=e,this.rowNumber=t,this.wasReversed=r}return e.prototype.getPairs=function(){return this.pairs},e.prototype.getRowNumber=function(){return this.rowNumber},e.prototype.isReversed=function(){return this.wasReversed},e.prototype.isEquivalent=function(e){return this.checkEqualitity(this,e)},e.prototype.toString=function(){return"{ "+this.pairs+" }"},e.prototype.equals=function(t,r){return t instanceof e&&(this.checkEqualitity(t,r)&&t.wasReversed===r.wasReversed)},e.prototype.checkEqualitity=function(e,t){var r;if(e&&t)return e.forEach(function(e,n){t.forEach(function(t){e.getLeftChar().getValue()===t.getLeftChar().getValue()&&e.getRightChar().getValue()===t.getRightChar().getValue()&&e.getFinderPatter().getValue()===t.getFinderPatter().getValue()&&(r=!0)})}),r},e}(),_i=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),bi=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ni=function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.pairs=new Array(t.MAX_PAIRS),r.rows=new Array,r.startEnd=[2],r}return _i(t,e),t.prototype.decodeRow=function(e,r,n){this.pairs.length=0,this.startFromEven=!1;try{return t.constructResult(this.decodeRow2pairs(e,r))}catch(s){}return this.pairs.length=0,this.startFromEven=!0,t.constructResult(this.decodeRow2pairs(e,r))},t.prototype.reset=function(){this.pairs.length=0,this.rows.length=0},t.prototype.decodeRow2pairs=function(e,t){for(var r,n=!1;!n;)try{this.pairs.push(this.retrieveNextPair(t,this.pairs,e))}catch(i){if(i instanceof Qr){if(!this.pairs.length)throw new Qr;n=!0}}if(this.checkChecksum())return this.pairs;if(r=!!this.rows.length,this.storeRow(e,!1),r){var s=this.checkRowsBoolean(!1);if(null!=s)return s;if(null!=(s=this.checkRowsBoolean(!0)))return s}throw new Qr},t.prototype.checkRowsBoolean=function(e){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,e&&(this.rows=this.rows.reverse());var t=null;try{t=this.checkRows(new Array,0)}catch(r){}return e&&(this.rows=this.rows.reverse()),t},t.prototype.checkRows=function(e,r){for(var n,s,i=r;i<this.rows.length;i++){var a=this.rows[i];this.pairs.length=0;try{for(var o=(n=void 0,bi(e)),l=o.next();!l.done;l=o.next()){var c=l.value;this.pairs.push(c.getPairs())}}catch(u){n={error:u}}finally{try{l&&!l.done&&(s=o.return)&&s.call(o)}finally{if(n)throw n.error}}if(this.pairs.push(a.getPairs()),t.isValidSequence(this.pairs)){if(this.checkChecksum())return this.pairs;var d=new Array(e);d.push(a);try{return this.checkRows(d,i+1)}catch(h){}}}throw new Qr},t.isValidSequence=function(e){var r,n;try{for(var s=bi(t.FINDER_PATTERN_SEQUENCES),i=s.next();!i.done;i=s.next()){var a=i.value;if(!(e.length>a.length)){for(var o=!0,l=0;l<e.length;l++)if(e[l].getFinderPattern().getValue()!==a[l]){o=!1;break}if(o)return!0}}}catch(c){r={error:c}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return!1},t.prototype.storeRow=function(e,r){for(var n=0,s=!1,i=!1;n<this.rows.length;){var a=this.rows[n];if(a.getRowNumber()>e){i=a.isEquivalent(this.pairs);break}s=a.isEquivalent(this.pairs),n++}i||s||t.isPartialRow(this.pairs,this.rows)||(this.rows.push(n,new wi(this.pairs,e,r)),this.removePartialRows(this.pairs,this.rows))},t.prototype.removePartialRows=function(e,t){var r,n,s,i,a,o;try{for(var l=bi(t),c=l.next();!c.done;c=l.next()){var d=c.value;if(d.getPairs().length!==e.length){try{for(var u=(s=void 0,bi(d.getPairs())),h=u.next();!h.done;h=u.next()){var f=h.value,p=!1;try{for(var m=(a=void 0,bi(e)),g=m.next();!g.done;g=m.next()){var x=g.value;if(vi.equals(f,x)){p=!0;break}}}catch(y){a={error:y}}finally{try{g&&!g.done&&(o=m.return)&&o.call(m)}finally{if(a)throw a.error}}p||!1}}catch(v){s={error:v}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(s)throw s.error}}}}}catch(w){r={error:w}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}},t.isPartialRow=function(e,t){var r,n,s,i,a,o;try{for(var l=bi(t),c=l.next();!c.done;c=l.next()){var d=c.value,u=!0;try{for(var h=(s=void 0,bi(e)),f=h.next();!f.done;f=h.next()){var p=f.value,m=!1;try{for(var g=(a=void 0,bi(d.getPairs())),x=g.next();!x.done;x=g.next()){var y=x.value;if(p.equals(y)){m=!0;break}}}catch(v){a={error:v}}finally{try{x&&!x.done&&(o=g.return)&&o.call(g)}finally{if(a)throw a.error}}if(!m){u=!1;break}}}catch(w){s={error:w}}finally{try{f&&!f.done&&(i=h.return)&&i.call(h)}finally{if(s)throw s.error}}if(u)return!0}}catch(_){r={error:_}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}return!1},t.prototype.getRows=function(){return this.rows},t.constructResult=function(e){var t=function(e){try{if(e.get(1))return new ri(e);if(!e.get(2))return new si(e);switch($s.extractNumericValueFromBitArray(e,1,4)){case 4:return new di(e);case 5:return new hi(e)}switch($s.extractNumericValueFromBitArray(e,1,5)){case 12:return new pi(e);case 13:return new gi(e)}switch($s.extractNumericValueFromBitArray(e,1,7)){case 56:return new yi(e,"310","11");case 57:return new yi(e,"320","11");case 58:return new yi(e,"310","13");case 59:return new yi(e,"320","13");case 60:return new yi(e,"310","15");case 61:return new yi(e,"320","15");case 62:return new yi(e,"310","17");case 63:return new yi(e,"320","17")}}catch(t){throw new Dn("unknown decoder: "+e)}}(Us.buildBitArray(e)).parseInformation(),r=e[0].getFinderPattern().getResultPoints(),n=e[e.length-1].getFinderPattern().getResultPoints(),s=[r[0],r[1],n[0],n[1]];return new pn(t,null,null,s,mn.RSS_EXPANDED,null)},t.prototype.checkChecksum=function(){var e=this.pairs.get(0),t=e.getLeftChar(),r=e.getRightChar();if(null===r)return!1;for(var n=r.getChecksumPortion(),s=2,i=1;i<this.pairs.size();++i){var a=this.pairs.get(i);n+=a.getLeftChar().getChecksumPortion(),s++;var o=a.getRightChar();null!=o&&(n+=o.getChecksumPortion(),s++)}return 211*(s-4)+(n%=211)===t.getValue()},t.getNextSecondBar=function(e,t){var r;return e.get(t)?(r=e.getNextUnset(t),r=e.getNextSet(r)):(r=e.getNextSet(t),r=e.getNextUnset(r)),r},t.prototype.retrieveNextPair=function(e,r,n){var s,i=r.length%2==0;this.startFromEven&&(i=!i);var a=!0,o=-1;do{this.findNextPair(e,r,o),null===(s=this.parseFoundFinderPattern(e,n,i))?o=t.getNextSecondBar(e,this.startEnd[0]):a=!1}while(a);var l,c=this.decodeDataCharacter(e,s,i,!0);if(!this.isEmptyPair(r)&&r[r.length-1].mustBeLast())throw new Qr;try{l=this.decodeDataCharacter(e,s,i,!1)}catch(d){l=null}return new vi(c,l,s,!0)},t.prototype.isEmptyPair=function(e){return 0===e.length},t.prototype.findNextPair=function(e,r,n){var s=this.getDecodeFinderCounters();s[0]=0,s[1]=0,s[2]=0,s[3]=0;var i,a=e.getSize();if(n>=0)i=n;else if(this.isEmptyPair(r))i=0;else{i=r[r.length-1].getFinderPattern().getStartEnd()[1]}var o=r.length%2!=0;this.startFromEven&&(o=!o);for(var l=!1;i<a&&(l=!e.get(i));)i++;for(var c=0,d=i,u=i;u<a;u++)if(e.get(u)!==l)s[c]++;else{if(3===c){if(o&&t.reverseCounters(s),t.isFinderPattern(s))return this.startEnd[0]=d,void(this.startEnd[1]=u);o&&t.reverseCounters(s),d+=s[0]+s[1],s[0]=s[2],s[1]=s[3],s[2]=0,s[3]=0,c--}else c++;s[c]=1,l=!l}throw new Qr},t.reverseCounters=function(e){for(var t=e.length,r=0;r<t/2;++r){var n=e[r];e[r]=e[t-r-1],e[t-r-1]=n}},t.prototype.parseFoundFinderPattern=function(e,r,n){var s,i,a;if(n){for(var o=this.startEnd[0]-1;o>=0&&!e.get(o);)o--;o++,s=this.startEnd[0]-o,i=o,a=this.startEnd[1]}else i=this.startEnd[0],s=(a=e.getNextUnset(this.startEnd[1]+1))-this.startEnd[1];var l,c=this.getDecodeFinderCounters();Sr.arraycopy(c,0,c,1,c.length-1),c[0]=s;try{l=this.parseFinderValue(c,t.FINDER_PATTERNS)}catch(d){return null}return new Bs(l,[i,a],i,a,r)},t.prototype.decodeDataCharacter=function(e,r,n,s){for(var i=this.getDataCharacterCounters(),a=0;a<i.length;a++)i[a]=0;if(s)t.recordPatternInReverse(e,r.getStartEnd()[0],i);else{t.recordPattern(e,r.getStartEnd()[1],i);for(var o=0,l=i.length-1;o<l;o++,l--){var c=i[o];i[o]=i[l],i[l]=c}}var d=kn.sum(new Int32Array(i))/17,u=(r.getStartEnd()[1]-r.getStartEnd()[0])/15;if(Math.abs(d-u)/u>.3)throw new Qr;var h=this.getOddCounts(),f=this.getEvenCounts(),p=this.getOddRoundingErrors(),m=this.getEvenRoundingErrors();for(o=0;o<i.length;o++){var g=1*i[o]/d,x=g+.5;if(x<1){if(g<.3)throw new Qr;x=1}else if(x>8){if(g>8.7)throw new Qr;x=8}var y=o/2;1&o?(f[y]=x,m[y]=g-x):(h[y]=x,p[y]=g-x)}this.adjustOddEvenCounts(17);var v=4*r.getValue()+(n?0:2)+(s?0:1)-1,w=0,_=0;for(o=h.length-1;o>=0;o--){if(t.isNotA1left(r,n,s)){var b=t.WEIGHTS[v][2*o];_+=h[o]*b}w+=h[o]}var N=0;for(o=f.length-1;o>=0;o--)if(t.isNotA1left(r,n,s)){b=t.WEIGHTS[v][2*o+1];N+=f[o]*b}var j=_+N;if(1&w||w>13||w<4)throw new Qr;var C=(13-w)/2,A=t.SYMBOL_WIDEST[C],S=9-A,E=Ls.getRSSvalue(h,A,!0),I=Ls.getRSSvalue(f,S,!1),T=t.EVEN_TOTAL_SUBSET[C],D=t.GSUM[C];return new Ps(E*T+I+D,j)},t.isNotA1left=function(e,t,r){return!(0===e.getValue()&&t&&r)},t.prototype.adjustOddEvenCounts=function(e){var r=kn.sum(new Int32Array(this.getOddCounts())),n=kn.sum(new Int32Array(this.getEvenCounts())),s=!1,i=!1;r>13?i=!0:r<4&&(s=!0);var a=!1,o=!1;n>13?o=!0:n<4&&(a=!0);var l=r+n-e,c=!(1&~r),d=!(1&n);if(1===l)if(c){if(d)throw new Qr;i=!0}else{if(!d)throw new Qr;o=!0}else if(-1===l)if(c){if(d)throw new Qr;s=!0}else{if(!d)throw new Qr;a=!0}else{if(0!==l)throw new Qr;if(c){if(!d)throw new Qr;r<n?(s=!0,o=!0):(i=!0,a=!0)}else if(d)throw new Qr}if(s){if(i)throw new Qr;t.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(i&&t.decrement(this.getOddCounts(),this.getOddRoundingErrors()),a){if(o)throw new Qr;t.increment(this.getEvenCounts(),this.getOddRoundingErrors())}o&&t.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())},t.SYMBOL_WIDEST=[7,5,4,3,1],t.EVEN_TOTAL_SUBSET=[4,20,52,104,204],t.GSUM=[0,348,1388,2948,3988],t.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],t.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],t.FINDER_PAT_A=0,t.FINDER_PAT_B=1,t.FINDER_PAT_C=2,t.FINDER_PAT_D=3,t.FINDER_PAT_E=4,t.FINDER_PAT_F=5,t.FINDER_PATTERN_SEQUENCES=[[t.FINDER_PAT_A,t.FINDER_PAT_A],[t.FINDER_PAT_A,t.FINDER_PAT_B,t.FINDER_PAT_B],[t.FINDER_PAT_A,t.FINDER_PAT_C,t.FINDER_PAT_B,t.FINDER_PAT_D],[t.FINDER_PAT_A,t.FINDER_PAT_E,t.FINDER_PAT_B,t.FINDER_PAT_D,t.FINDER_PAT_C],[t.FINDER_PAT_A,t.FINDER_PAT_E,t.FINDER_PAT_B,t.FINDER_PAT_D,t.FINDER_PAT_D,t.FINDER_PAT_F],[t.FINDER_PAT_A,t.FINDER_PAT_E,t.FINDER_PAT_B,t.FINDER_PAT_D,t.FINDER_PAT_E,t.FINDER_PAT_F,t.FINDER_PAT_F],[t.FINDER_PAT_A,t.FINDER_PAT_A,t.FINDER_PAT_B,t.FINDER_PAT_B,t.FINDER_PAT_C,t.FINDER_PAT_C,t.FINDER_PAT_D,t.FINDER_PAT_D],[t.FINDER_PAT_A,t.FINDER_PAT_A,t.FINDER_PAT_B,t.FINDER_PAT_B,t.FINDER_PAT_C,t.FINDER_PAT_C,t.FINDER_PAT_D,t.FINDER_PAT_E,t.FINDER_PAT_E],[t.FINDER_PAT_A,t.FINDER_PAT_A,t.FINDER_PAT_B,t.FINDER_PAT_B,t.FINDER_PAT_C,t.FINDER_PAT_C,t.FINDER_PAT_D,t.FINDER_PAT_E,t.FINDER_PAT_F,t.FINDER_PAT_F],[t.FINDER_PAT_A,t.FINDER_PAT_A,t.FINDER_PAT_B,t.FINDER_PAT_B,t.FINDER_PAT_C,t.FINDER_PAT_D,t.FINDER_PAT_D,t.FINDER_PAT_E,t.FINDER_PAT_E,t.FINDER_PAT_F,t.FINDER_PAT_F]],t.MAX_PAIRS=11,t}(Ms),ji=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ci=function(e){function t(t,r,n){var s=e.call(this,t,r)||this;return s.count=0,s.finderPattern=n,s}return ji(t,e),t.prototype.getFinderPattern=function(){return this.finderPattern},t.prototype.getCount=function(){return this.count},t.prototype.incrementCount=function(){this.count++},t}(Ps),Ai=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Si=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ei=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.possibleLeftPairs=[],t.possibleRightPairs=[],t}return Ai(t,e),t.prototype.decodeRow=function(e,r,n){var s,i,a,o,l=this.decodePair(r,!1,e,n);t.addOrTally(this.possibleLeftPairs,l),r.reverse();var c=this.decodePair(r,!0,e,n);t.addOrTally(this.possibleRightPairs,c),r.reverse();try{for(var d=Si(this.possibleLeftPairs),u=d.next();!u.done;u=d.next()){var h=u.value;if(h.getCount()>1)try{for(var f=(a=void 0,Si(this.possibleRightPairs)),p=f.next();!p.done;p=f.next()){var m=p.value;if(m.getCount()>1&&t.checkChecksum(h,m))return t.constructResult(h,m)}}catch(g){a={error:g}}finally{try{p&&!p.done&&(o=f.return)&&o.call(f)}finally{if(a)throw a.error}}}}catch(x){s={error:x}}finally{try{u&&!u.done&&(i=d.return)&&i.call(d)}finally{if(s)throw s.error}}throw new Qr},t.addOrTally=function(e,t){var r,n;if(null!=t){var s=!1;try{for(var i=Si(e),a=i.next();!a.done;a=i.next()){var o=a.value;if(o.getValue()===t.getValue()){o.incrementCount(),s=!0;break}}}catch(l){r={error:l}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}s||e.push(t)}},t.prototype.reset=function(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0},t.constructResult=function(e,t){for(var r=4537077*e.getValue()+t.getValue(),n=new String(r).toString(),s=new Kr,i=13-n.length;i>0;i--)s.append("0");s.append(n);var a=0;for(i=0;i<13;i++){var o=s.charAt(i).charCodeAt(0)-"0".charCodeAt(0);a+=1&i?o:3*o}10===(a=10-a%10)&&(a=0),s.append(a.toString());var l=e.getFinderPattern().getResultPoints(),c=t.getFinderPattern().getResultPoints();return new pn(s.toString(),null,0,[l[0],l[1],c[0],c[1]],mn.RSS_14,(new Date).getTime())},t.checkChecksum=function(e,t){var r=(e.getChecksumPortion()+16*t.getChecksumPortion())%79,n=9*e.getFinderPattern().getValue()+t.getFinderPattern().getValue();return n>72&&n--,n>8&&n--,r===n},t.prototype.decodePair=function(e,t,r,n){try{var s=this.findFinderPattern(e,t),i=this.parseFoundFinderPattern(e,r,t,s),a=null==n?null:n.get(Pr.NEED_RESULT_POINT_CALLBACK);if(null!=a){var o=(s[0]+s[1])/2;t&&(o=e.getSize()-1-o),a.foundPossibleResultPoint(new Pn(o,r))}var l=this.decodeDataCharacter(e,i,!0),c=this.decodeDataCharacter(e,i,!1);return new Ci(1597*l.getValue()+c.getValue(),l.getChecksumPortion()+4*c.getChecksumPortion(),i)}catch(d){return null}},t.prototype.decodeDataCharacter=function(e,r,n){for(var s=this.getDataCharacterCounters(),i=0;i<s.length;i++)s[i]=0;if(n)Zn.recordPatternInReverse(e,r.getStartEnd()[0],s);else{Zn.recordPattern(e,r.getStartEnd()[1]+1,s);for(var a=0,o=s.length-1;a<o;a++,o--){var l=s[a];s[a]=s[o],s[o]=l}}var c=n?16:15,d=kn.sum(new Int32Array(s))/c,u=this.getOddCounts(),h=this.getEvenCounts(),f=this.getOddRoundingErrors(),p=this.getEvenRoundingErrors();for(a=0;a<s.length;a++){var m=s[a]/d,g=Math.floor(m+.5);g<1?g=1:g>8&&(g=8);var x=Math.floor(a/2);1&a?(h[x]=g,p[x]=m-g):(u[x]=g,f[x]=m-g)}this.adjustOddEvenCounts(n,c);var y=0,v=0;for(a=u.length-1;a>=0;a--)v*=9,v+=u[a],y+=u[a];var w=0,_=0;for(a=h.length-1;a>=0;a--)w*=9,w+=h[a],_+=h[a];var b=v+3*w;if(n){if(1&y||y>12||y<4)throw new Qr;var N=(12-y)/2,j=9-(I=t.OUTSIDE_ODD_WIDEST[N]),C=Ls.getRSSvalue(u,I,!1),A=Ls.getRSSvalue(h,j,!0),S=t.OUTSIDE_EVEN_TOTAL_SUBSET[N],E=t.OUTSIDE_GSUM[N];return new Ps(C*S+A+E,b)}if(1&_||_>10||_<4)throw new Qr;N=(10-_)/2,j=9-(I=t.INSIDE_ODD_WIDEST[N]),C=Ls.getRSSvalue(u,I,!0),A=Ls.getRSSvalue(h,j,!1);var I,T=t.INSIDE_ODD_TOTAL_SUBSET[N];E=t.INSIDE_GSUM[N];return new Ps(A*T+C+E,b)},t.prototype.findFinderPattern=function(e,t){var r=this.getDecodeFinderCounters();r[0]=0,r[1]=0,r[2]=0,r[3]=0;for(var n=e.getSize(),s=!1,i=0;i<n&&t!==(s=!e.get(i));)i++;for(var a=0,o=i,l=i;l<n;l++)if(e.get(l)!==s)r[a]++;else{if(3===a){if(Ms.isFinderPattern(r))return[o,l];o+=r[0]+r[1],r[0]=r[2],r[1]=r[3],r[2]=0,r[3]=0,a--}else a++;r[a]=1,s=!s}throw new Qr},t.prototype.parseFoundFinderPattern=function(e,r,n,s){for(var i=e.get(s[0]),a=s[0]-1;a>=0&&i!==e.get(a);)a--;a++;var o=s[0]-a,l=this.getDecodeFinderCounters(),c=new Int32Array(l.length);Sr.arraycopy(l,0,c,1,l.length-1),c[0]=o;var d=this.parseFinderValue(c,t.FINDER_PATTERNS),u=a,h=s[1];return n&&(u=e.getSize()-1-u,h=e.getSize()-1-h),new Bs(d,[a,s[1]],u,h,r)},t.prototype.adjustOddEvenCounts=function(e,t){var r=kn.sum(new Int32Array(this.getOddCounts())),n=kn.sum(new Int32Array(this.getEvenCounts())),s=!1,i=!1,a=!1,o=!1;e?(r>12?i=!0:r<4&&(s=!0),n>12?o=!0:n<4&&(a=!0)):(r>11?i=!0:r<5&&(s=!0),n>10?o=!0:n<4&&(a=!0));var l=r+n-t,c=(1&r)==(e?1:0),d=!(1&~n);if(1===l)if(c){if(d)throw new Qr;i=!0}else{if(!d)throw new Qr;o=!0}else if(-1===l)if(c){if(d)throw new Qr;s=!0}else{if(!d)throw new Qr;a=!0}else{if(0!==l)throw new Qr;if(c){if(!d)throw new Qr;r<n?(s=!0,o=!0):(i=!0,a=!0)}else if(d)throw new Qr}if(s){if(i)throw new Qr;Ms.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(i&&Ms.decrement(this.getOddCounts(),this.getOddRoundingErrors()),a){if(o)throw new Qr;Ms.increment(this.getEvenCounts(),this.getOddRoundingErrors())}o&&Ms.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())},t.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],t.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],t.OUTSIDE_GSUM=[0,161,961,2015,2715],t.INSIDE_GSUM=[0,336,1036,1516],t.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],t.INSIDE_ODD_WIDEST=[2,4,6,8],t.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])],t}(Ms),Ii=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ti=function(e){function t(t){var r=e.call(this)||this;r.readers=[];var n=t?t.get(Pr.POSSIBLE_FORMATS):null,s=t&&void 0!==t.get(Pr.ASSUME_CODE_39_CHECK_DIGIT),i=t&&void 0!==t.get(Pr.ENABLE_CODE_39_EXTENDED_MODE);return n&&((n.includes(mn.EAN_13)||n.includes(mn.UPC_A)||n.includes(mn.EAN_8)||n.includes(mn.UPC_E))&&r.readers.push(new Ts(t)),n.includes(mn.CODE_39)&&r.readers.push(new ts(s,i)),n.includes(mn.CODE_93)&&r.readers.push(new ss),n.includes(mn.CODE_128)&&r.readers.push(new Qn),n.includes(mn.ITF)&&r.readers.push(new os),n.includes(mn.CODABAR)&&r.readers.push(new Os),n.includes(mn.RSS_14)&&r.readers.push(new Ei),n.includes(mn.RSS_EXPANDED)&&r.readers.push(new Ni)),0===r.readers.length&&(r.readers.push(new Ts(t)),r.readers.push(new ts),r.readers.push(new ss),r.readers.push(new Ts(t)),r.readers.push(new Qn),r.readers.push(new os),r.readers.push(new Ei)),r}return Ii(t,e),t.prototype.decodeRow=function(e,t,r){for(var n=0;n<this.readers.length;n++)try{return this.readers[n].decodeRow(e,t,r)}catch(s){}throw new Qr},t.prototype.reset=function(){this.readers.forEach(function(e){return e.reset()})},t}(Zn),Di=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();!function(e){function t(t,r){return void 0===t&&(t=500),e.call(this,new Ti(r),t,r)||this}Di(t,e)}(fn);var Oi,Ri,ki=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Mi=function(){function e(e,t,r){this.ecCodewords=e,this.ecBlocks=[t],r&&this.ecBlocks.push(r)}return e.prototype.getECCodewords=function(){return this.ecCodewords},e.prototype.getECBlocks=function(){return this.ecBlocks},e}(),Pi=function(){function e(e,t){this.count=e,this.dataCodewords=t}return e.prototype.getCount=function(){return this.count},e.prototype.getDataCodewords=function(){return this.dataCodewords},e}(),Bi=function(){function e(e,t,r,n,s,i){var a,o;this.versionNumber=e,this.symbolSizeRows=t,this.symbolSizeColumns=r,this.dataRegionSizeRows=n,this.dataRegionSizeColumns=s,this.ecBlocks=i;var l=0,c=i.getECCodewords(),d=i.getECBlocks();try{for(var u=ki(d),h=u.next();!h.done;h=u.next()){var f=h.value;l+=f.getCount()*(f.getDataCodewords()+c)}}catch(p){a={error:p}}finally{try{h&&!h.done&&(o=u.return)&&o.call(u)}finally{if(a)throw a.error}}this.totalCodewords=l}return e.prototype.getVersionNumber=function(){return this.versionNumber},e.prototype.getSymbolSizeRows=function(){return this.symbolSizeRows},e.prototype.getSymbolSizeColumns=function(){return this.symbolSizeColumns},e.prototype.getDataRegionSizeRows=function(){return this.dataRegionSizeRows},e.prototype.getDataRegionSizeColumns=function(){return this.dataRegionSizeColumns},e.prototype.getTotalCodewords=function(){return this.totalCodewords},e.prototype.getECBlocks=function(){return this.ecBlocks},e.getVersionForDimensions=function(t,r){var n,s;if(1&t||1&r)throw new Ur;try{for(var i=ki(e.VERSIONS),a=i.next();!a.done;a=i.next()){var o=a.value;if(o.symbolSizeRows===t&&o.symbolSizeColumns===r)return o}}catch(l){n={error:l}}finally{try{a&&!a.done&&(s=i.return)&&s.call(i)}finally{if(n)throw n.error}}throw new Ur},e.prototype.toString=function(){return""+this.versionNumber},e.buildVersions=function(){return[new e(1,10,10,8,8,new Mi(5,new Pi(1,3))),new e(2,12,12,10,10,new Mi(7,new Pi(1,5))),new e(3,14,14,12,12,new Mi(10,new Pi(1,8))),new e(4,16,16,14,14,new Mi(12,new Pi(1,12))),new e(5,18,18,16,16,new Mi(14,new Pi(1,18))),new e(6,20,20,18,18,new Mi(18,new Pi(1,22))),new e(7,22,22,20,20,new Mi(20,new Pi(1,30))),new e(8,24,24,22,22,new Mi(24,new Pi(1,36))),new e(9,26,26,24,24,new Mi(28,new Pi(1,44))),new e(10,32,32,14,14,new Mi(36,new Pi(1,62))),new e(11,36,36,16,16,new Mi(42,new Pi(1,86))),new e(12,40,40,18,18,new Mi(48,new Pi(1,114))),new e(13,44,44,20,20,new Mi(56,new Pi(1,144))),new e(14,48,48,22,22,new Mi(68,new Pi(1,174))),new e(15,52,52,24,24,new Mi(42,new Pi(2,102))),new e(16,64,64,14,14,new Mi(56,new Pi(2,140))),new e(17,72,72,16,16,new Mi(36,new Pi(4,92))),new e(18,80,80,18,18,new Mi(48,new Pi(4,114))),new e(19,88,88,20,20,new Mi(56,new Pi(4,144))),new e(20,96,96,22,22,new Mi(68,new Pi(4,174))),new e(21,104,104,24,24,new Mi(56,new Pi(6,136))),new e(22,120,120,18,18,new Mi(68,new Pi(6,175))),new e(23,132,132,20,20,new Mi(62,new Pi(8,163))),new e(24,144,144,22,22,new Mi(62,new Pi(8,156),new Pi(2,155))),new e(25,8,18,6,16,new Mi(7,new Pi(1,5))),new e(26,8,32,6,14,new Mi(11,new Pi(1,10))),new e(27,12,26,10,24,new Mi(14,new Pi(1,16))),new e(28,12,36,10,16,new Mi(18,new Pi(1,22))),new e(29,16,36,14,16,new Mi(24,new Pi(1,32))),new e(30,16,48,14,22,new Mi(28,new Pi(1,49)))]},e.VERSIONS=e.buildVersions(),e}(),Fi=function(){function e(t){var r=t.getHeight();if(r<8||r>144||1&r)throw new Ur;this.version=e.readVersion(t),this.mappingBitMatrix=this.extractDataRegion(t),this.readMappingMatrix=new Zr(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}return e.prototype.getVersion=function(){return this.version},e.readVersion=function(e){var t=e.getHeight(),r=e.getWidth();return Bi.getVersionForDimensions(t,r)},e.prototype.readCodewords=function(){var e=new Int8Array(this.version.getTotalCodewords()),t=0,r=4,n=0,s=this.mappingBitMatrix.getHeight(),i=this.mappingBitMatrix.getWidth(),a=!1,o=!1,l=!1,c=!1;do{if(r!==s||0!==n||a)if(r===s-2&&0===n&&3&i&&!o)e[t++]=255&this.readCorner2(s,i),r-=2,n+=2,o=!0;else if(r!==s+4||2!==n||7&i||l)if(r!==s-2||0!==n||4!=(7&i)||c){do{r<s&&n>=0&&!this.readMappingMatrix.get(n,r)&&(e[t++]=255&this.readUtah(r,n,s,i)),r-=2,n+=2}while(r>=0&&n<i);r+=1,n+=3;do{r>=0&&n<i&&!this.readMappingMatrix.get(n,r)&&(e[t++]=255&this.readUtah(r,n,s,i)),r+=2,n-=2}while(r<s&&n>=0);r+=3,n+=1}else e[t++]=255&this.readCorner4(s,i),r-=2,n+=2,c=!0;else e[t++]=255&this.readCorner3(s,i),r-=2,n+=2,l=!0;else e[t++]=255&this.readCorner1(s,i),r-=2,n+=2,a=!0}while(r<s||n<i);if(t!==this.version.getTotalCodewords())throw new Ur;return e},e.prototype.readModule=function(e,t,r,n){return e<0&&(e+=r,t+=4-(r+4&7)),t<0&&(t+=n,e+=4-(n+4&7)),this.readMappingMatrix.set(t,e),this.mappingBitMatrix.get(t,e)},e.prototype.readUtah=function(e,t,r,n){var s=0;return this.readModule(e-2,t-2,r,n)&&(s|=1),s<<=1,this.readModule(e-2,t-1,r,n)&&(s|=1),s<<=1,this.readModule(e-1,t-2,r,n)&&(s|=1),s<<=1,this.readModule(e-1,t-1,r,n)&&(s|=1),s<<=1,this.readModule(e-1,t,r,n)&&(s|=1),s<<=1,this.readModule(e,t-2,r,n)&&(s|=1),s<<=1,this.readModule(e,t-1,r,n)&&(s|=1),s<<=1,this.readModule(e,t,r,n)&&(s|=1),s},e.prototype.readCorner1=function(e,t){var r=0;return this.readModule(e-1,0,e,t)&&(r|=1),r<<=1,this.readModule(e-1,1,e,t)&&(r|=1),r<<=1,this.readModule(e-1,2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-1,e,t)&&(r|=1),r<<=1,this.readModule(1,t-1,e,t)&&(r|=1),r<<=1,this.readModule(2,t-1,e,t)&&(r|=1),r<<=1,this.readModule(3,t-1,e,t)&&(r|=1),r},e.prototype.readCorner2=function(e,t){var r=0;return this.readModule(e-3,0,e,t)&&(r|=1),r<<=1,this.readModule(e-2,0,e,t)&&(r|=1),r<<=1,this.readModule(e-1,0,e,t)&&(r|=1),r<<=1,this.readModule(0,t-4,e,t)&&(r|=1),r<<=1,this.readModule(0,t-3,e,t)&&(r|=1),r<<=1,this.readModule(0,t-2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-1,e,t)&&(r|=1),r<<=1,this.readModule(1,t-1,e,t)&&(r|=1),r},e.prototype.readCorner3=function(e,t){var r=0;return this.readModule(e-1,0,e,t)&&(r|=1),r<<=1,this.readModule(e-1,t-1,e,t)&&(r|=1),r<<=1,this.readModule(0,t-3,e,t)&&(r|=1),r<<=1,this.readModule(0,t-2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-1,e,t)&&(r|=1),r<<=1,this.readModule(1,t-3,e,t)&&(r|=1),r<<=1,this.readModule(1,t-2,e,t)&&(r|=1),r<<=1,this.readModule(1,t-1,e,t)&&(r|=1),r},e.prototype.readCorner4=function(e,t){var r=0;return this.readModule(e-3,0,e,t)&&(r|=1),r<<=1,this.readModule(e-2,0,e,t)&&(r|=1),r<<=1,this.readModule(e-1,0,e,t)&&(r|=1),r<<=1,this.readModule(0,t-2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-1,e,t)&&(r|=1),r<<=1,this.readModule(1,t-1,e,t)&&(r|=1),r<<=1,this.readModule(2,t-1,e,t)&&(r|=1),r<<=1,this.readModule(3,t-1,e,t)&&(r|=1),r},e.prototype.extractDataRegion=function(e){var t=this.version.getSymbolSizeRows(),r=this.version.getSymbolSizeColumns();if(e.getHeight()!==t)throw new br("Dimension of bitMatrix must match the version size");for(var n=this.version.getDataRegionSizeRows(),s=this.version.getDataRegionSizeColumns(),i=t/n|0,a=r/s|0,o=new Zr(a*s,i*n),l=0;l<i;++l)for(var c=l*n,d=0;d<a;++d)for(var u=d*s,h=0;h<n;++h)for(var f=l*(n+2)+1+h,p=c+h,m=0;m<s;++m){var g=d*(s+2)+1+m;if(e.get(g,f)){var x=u+m;o.set(x,p)}}return o},e}(),Li=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ui=function(){function e(e,t){this.numDataCodewords=e,this.codewords=t}return e.getDataBlocks=function(t,r){var n,s,i,a,o=r.getECBlocks(),l=0,c=o.getECBlocks();try{for(var d=Li(c),u=d.next();!u.done;u=d.next()){l+=(g=u.value).getCount()}}catch(I){n={error:I}}finally{try{u&&!u.done&&(s=d.return)&&s.call(d)}finally{if(n)throw n.error}}var h=new Array(l),f=0;try{for(var p=Li(c),m=p.next();!m.done;m=p.next())for(var g=m.value,x=0;x<g.getCount();x++){var y=g.getDataCodewords(),v=o.getECCodewords()+y;h[f++]=new e(y,new Uint8Array(v))}}catch(T){i={error:T}}finally{try{m&&!m.done&&(a=p.return)&&a.call(p)}finally{if(i)throw i.error}}var w=h[0].codewords.length-o.getECCodewords(),_=w-1,b=0;for(x=0;x<_;x++)for(var N=0;N<f;N++)h[N].codewords[x]=t[b++];var j=24===r.getVersionNumber(),C=j?8:f;for(N=0;N<C;N++)h[N].codewords[w-1]=t[b++];var A=h[0].codewords.length;for(x=w;x<A;x++)for(N=0;N<f;N++){var S=j?(N+8)%f:N,E=j&&S>7?x-1:x;h[S].codewords[E]=t[b++]}if(b!==t.length)throw new br;return h},e.prototype.getNumDataCodewords=function(){return this.numDataCodewords},e.prototype.getCodewords=function(){return this.codewords},e}(),Vi=function(){function e(e){this.bytes=e,this.byteOffset=0,this.bitOffset=0}return e.prototype.getBitOffset=function(){return this.bitOffset},e.prototype.getByteOffset=function(){return this.byteOffset},e.prototype.readBits=function(e){if(e<1||e>32||e>this.available())throw new br(""+e);var t=0,r=this.bitOffset,n=this.byteOffset,s=this.bytes;if(r>0){var i=8-r,a=e<i?e:i,o=255>>8-a<<(l=i-a);t=(s[n]&o)>>l,e-=a,8===(r+=a)&&(r=0,n++)}if(e>0){for(;e>=8;)t=t<<8|255&s[n],n++,e-=8;if(e>0){var l;o=255>>(l=8-e)<<l;t=t<<e|(s[n]&o)>>l,r+=e}}return this.bitOffset=r,this.byteOffset=n,t},e.prototype.available=function(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset},e}();(Ri=Oi||(Oi={}))[Ri.PAD_ENCODE=0]="PAD_ENCODE",Ri[Ri.ASCII_ENCODE=1]="ASCII_ENCODE",Ri[Ri.C40_ENCODE=2]="C40_ENCODE",Ri[Ri.TEXT_ENCODE=3]="TEXT_ENCODE",Ri[Ri.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",Ri[Ri.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",Ri[Ri.BASE256_ENCODE=6]="BASE256_ENCODE";var Hi,Gi,Wi=function(){function e(){}return e.decode=function(e){var t=new Vi(e),r=new Kr,n=new Kr,s=new Array,i=Oi.ASCII_ENCODE;do{if(i===Oi.ASCII_ENCODE)i=this.decodeAsciiSegment(t,r,n);else{switch(i){case Oi.C40_ENCODE:this.decodeC40Segment(t,r);break;case Oi.TEXT_ENCODE:this.decodeTextSegment(t,r);break;case Oi.ANSIX12_ENCODE:this.decodeAnsiX12Segment(t,r);break;case Oi.EDIFACT_ENCODE:this.decodeEdifactSegment(t,r);break;case Oi.BASE256_ENCODE:this.decodeBase256Segment(t,r,s);break;default:throw new Ur}i=Oi.ASCII_ENCODE}}while(i!==Oi.PAD_ENCODE&&t.available()>0);return n.length()>0&&r.append(n.toString()),new _n(e,r.toString(),0===s.length?null:s,null)},e.decodeAsciiSegment=function(e,t,r){var n=!1;do{var s=e.readBits(8);if(0===s)throw new Ur;if(s<=128)return n&&(s+=128),t.append(String.fromCharCode(s-1)),Oi.ASCII_ENCODE;if(129===s)return Oi.PAD_ENCODE;if(s<=229){var i=s-130;i<10&&t.append("0"),t.append(""+i)}else switch(s){case 230:return Oi.C40_ENCODE;case 231:return Oi.BASE256_ENCODE;case 232:t.append(String.fromCharCode(29));break;case 233:case 234:case 241:break;case 235:n=!0;break;case 236:t.append("[)>05"),r.insert(0,"");break;case 237:t.append("[)>06"),r.insert(0,"");break;case 238:return Oi.ANSIX12_ENCODE;case 239:return Oi.TEXT_ENCODE;case 240:return Oi.EDIFACT_ENCODE;default:if(254!==s||0!==e.available())throw new Ur}}while(e.available()>0);return Oi.ASCII_ENCODE},e.decodeC40Segment=function(e,t){var r=!1,n=[],s=0;do{if(8===e.available())return;var i=e.readBits(8);if(254===i)return;this.parseTwoBytes(i,e.readBits(8),n);for(var a=0;a<3;a++){var o=n[a];switch(s){case 0:if(o<3)s=o+1;else{if(!(o<this.C40_BASIC_SET_CHARS.length))throw new Ur;var l=this.C40_BASIC_SET_CHARS[o];r?(t.append(String.fromCharCode(l.charCodeAt(0)+128)),r=!1):t.append(l)}break;case 1:r?(t.append(String.fromCharCode(o+128)),r=!1):t.append(String.fromCharCode(o)),s=0;break;case 2:if(o<this.C40_SHIFT2_SET_CHARS.length){l=this.C40_SHIFT2_SET_CHARS[o];r?(t.append(String.fromCharCode(l.charCodeAt(0)+128)),r=!1):t.append(l)}else switch(o){case 27:t.append(String.fromCharCode(29));break;case 30:r=!0;break;default:throw new Ur}s=0;break;case 3:r?(t.append(String.fromCharCode(o+224)),r=!1):t.append(String.fromCharCode(o+96)),s=0;break;default:throw new Ur}}}while(e.available()>0)},e.decodeTextSegment=function(e,t){var r=!1,n=[],s=0;do{if(8===e.available())return;var i=e.readBits(8);if(254===i)return;this.parseTwoBytes(i,e.readBits(8),n);for(var a=0;a<3;a++){var o=n[a];switch(s){case 0:if(o<3)s=o+1;else{if(!(o<this.TEXT_BASIC_SET_CHARS.length))throw new Ur;var l=this.TEXT_BASIC_SET_CHARS[o];r?(t.append(String.fromCharCode(l.charCodeAt(0)+128)),r=!1):t.append(l)}break;case 1:r?(t.append(String.fromCharCode(o+128)),r=!1):t.append(String.fromCharCode(o)),s=0;break;case 2:if(o<this.TEXT_SHIFT2_SET_CHARS.length){l=this.TEXT_SHIFT2_SET_CHARS[o];r?(t.append(String.fromCharCode(l.charCodeAt(0)+128)),r=!1):t.append(l)}else switch(o){case 27:t.append(String.fromCharCode(29));break;case 30:r=!0;break;default:throw new Ur}s=0;break;case 3:if(!(o<this.TEXT_SHIFT3_SET_CHARS.length))throw new Ur;l=this.TEXT_SHIFT3_SET_CHARS[o];r?(t.append(String.fromCharCode(l.charCodeAt(0)+128)),r=!1):t.append(l),s=0;break;default:throw new Ur}}}while(e.available()>0)},e.decodeAnsiX12Segment=function(e,t){var r=[];do{if(8===e.available())return;var n=e.readBits(8);if(254===n)return;this.parseTwoBytes(n,e.readBits(8),r);for(var s=0;s<3;s++){var i=r[s];switch(i){case 0:t.append("\r");break;case 1:t.append("*");break;case 2:t.append(">");break;case 3:t.append(" ");break;default:if(i<14)t.append(String.fromCharCode(i+44));else{if(!(i<40))throw new Ur;t.append(String.fromCharCode(i+51))}}}}while(e.available()>0)},e.parseTwoBytes=function(e,t,r){var n=(e<<8)+t-1,s=Math.floor(n/1600);r[0]=s,n-=1600*s,s=Math.floor(n/40),r[1]=s,r[2]=n-40*s},e.decodeEdifactSegment=function(e,t){do{if(e.available()<=16)return;for(var r=0;r<4;r++){var n=e.readBits(6);if(31===n){var s=8-e.getBitOffset();return void(8!==s&&e.readBits(s))}32&n||(n|=64),t.append(String.fromCharCode(n))}}while(e.available()>0)},e.decodeBase256Segment=function(e,t,r){var n,s=1+e.getByteOffset(),i=this.unrandomize255State(e.readBits(8),s++);if((n=0===i?e.available()/8|0:i<250?i:250*(i-249)+this.unrandomize255State(e.readBits(8),s++))<0)throw new Ur;for(var a=new Uint8Array(n),o=0;o<n;o++){if(e.available()<8)throw new Ur;a[o]=this.unrandomize255State(e.readBits(8),s++)}r.push(a);try{t.append(Yr.decode(a,qr.ISO88591))}catch(l){throw new Dn("Platform does not support required encoding: "+l.message)}},e.unrandomize255State=function(e,t){var r=e-(149*t%255+1);return r>=0?r:r+256},e.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],e.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],e.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],e.TEXT_SHIFT2_SET_CHARS=e.C40_SHIFT2_SET_CHARS,e.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",String.fromCharCode(127)],e}(),zi=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Xi=function(){function e(){this.rsDecoder=new On(Sn.DATA_MATRIX_FIELD_256)}return e.prototype.decode=function(e){var t,r,n=new Fi(e),s=n.getVersion(),i=n.readCodewords(),a=Ui.getDataBlocks(i,s),o=0;try{for(var l=zi(a),c=l.next();!c.done;c=l.next()){o+=c.value.getNumDataCodewords()}}catch(x){t={error:x}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}for(var d=new Uint8Array(o),u=a.length,h=0;h<u;h++){var f=a[h],p=f.getCodewords(),m=f.getNumDataCodewords();this.correctErrors(p,m);for(var g=0;g<m;g++)d[g*u+h]=p[g]}return Wi.decode(d)},e.prototype.correctErrors=function(e,t){var r=new Int32Array(e);try{this.rsDecoder.decode(r,e.length-t)}catch(s){throw new Cr}for(var n=0;n<t;n++)e[n]=r[n]},e}(),Yi=function(){function e(e){this.image=e,this.rectangleDetector=new Un(this.image)}return e.prototype.detect=function(){var t=this.rectangleDetector.detect(),r=this.detectSolid1(t);if((r=this.detectSolid2(r))[3]=this.correctTopRight(r),!r[3])throw new Qr;var n=(r=this.shiftToModuleCenter(r))[0],s=r[1],i=r[2],a=r[3],o=this.transitionsBetween(n,a)+1,l=this.transitionsBetween(i,a)+1;1&~o||(o+=1),1&~l||(l+=1),4*o<7*l&&4*l<7*o&&(o=l=Math.max(o,l));var c=e.sampleGrid(this.image,n,s,i,a,o,l);return new Bn(c,[n,s,i,a])},e.shiftPoint=function(e,t,r){var n=(t.getX()-e.getX())/(r+1),s=(t.getY()-e.getY())/(r+1);return new Pn(e.getX()+n,e.getY()+s)},e.moveAway=function(e,t,r){var n=e.getX(),s=e.getY();return n<t?n-=1:n+=1,s<r?s-=1:s+=1,new Pn(n,s)},e.prototype.detectSolid1=function(e){var t=e[0],r=e[1],n=e[3],s=e[2],i=this.transitionsBetween(t,r),a=this.transitionsBetween(r,n),o=this.transitionsBetween(n,s),l=this.transitionsBetween(s,t),c=i,d=[s,t,r,n];return c>a&&(c=a,d[0]=t,d[1]=r,d[2]=n,d[3]=s),c>o&&(c=o,d[0]=r,d[1]=n,d[2]=s,d[3]=t),c>l&&(d[0]=n,d[1]=s,d[2]=t,d[3]=r),d},e.prototype.detectSolid2=function(t){var r=t[0],n=t[1],s=t[2],i=t[3],a=this.transitionsBetween(r,i),o=e.shiftPoint(n,s,4*(a+1)),l=e.shiftPoint(s,n,4*(a+1));return this.transitionsBetween(o,r)<this.transitionsBetween(l,i)?(t[0]=r,t[1]=n,t[2]=s,t[3]=i):(t[0]=n,t[1]=s,t[2]=i,t[3]=r),t},e.prototype.correctTopRight=function(t){var r=t[0],n=t[1],s=t[2],i=t[3],a=this.transitionsBetween(r,i),o=this.transitionsBetween(n,i),l=e.shiftPoint(r,n,4*(o+1)),c=e.shiftPoint(s,n,4*(a+1));a=this.transitionsBetween(l,i),o=this.transitionsBetween(c,i);var d=new Pn(i.getX()+(s.getX()-n.getX())/(a+1),i.getY()+(s.getY()-n.getY())/(a+1)),u=new Pn(i.getX()+(r.getX()-n.getX())/(o+1),i.getY()+(r.getY()-n.getY())/(o+1));return this.isValid(d)?this.isValid(u)?this.transitionsBetween(l,d)+this.transitionsBetween(c,d)>this.transitionsBetween(l,u)+this.transitionsBetween(c,u)?d:u:d:this.isValid(u)?u:null},e.prototype.shiftToModuleCenter=function(t){var r=t[0],n=t[1],s=t[2],i=t[3],a=this.transitionsBetween(r,i)+1,o=this.transitionsBetween(s,i)+1,l=e.shiftPoint(r,n,4*o),c=e.shiftPoint(s,n,4*a);1&~(a=this.transitionsBetween(l,i)+1)||(a+=1),1&~(o=this.transitionsBetween(c,i)+1)||(o+=1);var d,u,h=(r.getX()+n.getX()+s.getX()+i.getX())/4,f=(r.getY()+n.getY()+s.getY()+i.getY())/4;return r=e.moveAway(r,h,f),n=e.moveAway(n,h,f),s=e.moveAway(s,h,f),i=e.moveAway(i,h,f),l=e.shiftPoint(r,n,4*o),l=e.shiftPoint(l,i,4*a),d=e.shiftPoint(n,r,4*o),d=e.shiftPoint(d,s,4*a),c=e.shiftPoint(s,i,4*o),c=e.shiftPoint(c,n,4*a),u=e.shiftPoint(i,s,4*o),[l,d,c,u=e.shiftPoint(u,r,4*a)]},e.prototype.isValid=function(e){return e.getX()>=0&&e.getX()<this.image.getWidth()&&e.getY()>0&&e.getY()<this.image.getHeight()},e.sampleGrid=function(e,t,r,n,s,i,a){return zn.getInstance().sampleGrid(e,i,a,.5,.5,i-.5,.5,i-.5,a-.5,.5,a-.5,t.getX(),t.getY(),s.getX(),s.getY(),n.getX(),n.getY(),r.getX(),r.getY())},e.prototype.transitionsBetween=function(e,t){var r=Math.trunc(e.getX()),n=Math.trunc(e.getY()),s=Math.trunc(t.getX()),i=Math.trunc(t.getY()),a=Math.abs(i-n)>Math.abs(s-r);if(a){var o=r;r=n,n=o,o=s,s=i,i=o}for(var l=Math.abs(s-r),c=Math.abs(i-n),d=-l/2,u=n<i?1:-1,h=r<s?1:-1,f=0,p=this.image.get(a?n:r,a?r:n),m=r,g=n;m!==s;m+=h){var x=this.image.get(a?g:m,a?m:g);if(x!==p&&(f++,p=x),(d+=c)>0){if(g===i)break;g+=u,d-=l}}return f},e}(),qi=function(){function e(){this.decoder=new Xi}return e.prototype.decode=function(t,r){var n,s;if(void 0===r&&(r=null),null!=r&&r.has(Pr.PURE_BARCODE)){var i=e.extractPureBits(t.getBlackMatrix());n=this.decoder.decode(i),s=e.NO_POINTS}else{var a=new Yi(t.getBlackMatrix()).detect();n=this.decoder.decode(a.getBits()),s=a.getPoints()}var o=n.getRawBytes(),l=new pn(n.getText(),o,8*o.length,s,mn.DATA_MATRIX,Sr.currentTimeMillis()),c=n.getByteSegments();null!=c&&l.putMetadata(yn.BYTE_SEGMENTS,c);var d=n.getECLevel();return null!=d&&l.putMetadata(yn.ERROR_CORRECTION_LEVEL,d),l},e.prototype.reset=function(){},e.extractPureBits=function(e){var t=e.getTopLeftOnBit(),r=e.getBottomRightOnBit();if(null==t||null==r)throw new Qr;var n=this.moduleSize(t,e),s=t[1],i=r[1],a=t[0],o=(r[0]-a+1)/n,l=(i-s+1)/n;if(o<=0||l<=0)throw new Qr;var c=n/2;s+=c,a+=c;for(var d=new Zr(o,l),u=0;u<l;u++)for(var h=s+u*n,f=0;f<o;f++)e.get(a+f*n,h)&&d.set(f,u);return d},e.moduleSize=function(e,t){for(var r=t.getWidth(),n=e[0],s=e[1];n<r&&t.get(n,s);)n++;if(n===r)throw new Qr;var i=n-e[0];if(0===i)throw new Qr;return i},e.NO_POINTS=[],e}(),Ki=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();!function(e){function t(t){return void 0===t&&(t=500),e.call(this,new qi,t)||this}Ki(t,e)}(fn),(Gi=Hi||(Hi={}))[Gi.L=0]="L",Gi[Gi.M=1]="M",Gi[Gi.Q=2]="Q",Gi[Gi.H=3]="H";var Zi,$i,Qi=function(){function e(t,r,n){this.value=t,this.stringValue=r,this.bits=n,e.FOR_BITS.set(n,this),e.FOR_VALUE.set(t,this)}return e.prototype.getValue=function(){return this.value},e.prototype.getBits=function(){return this.bits},e.fromString=function(t){switch(t){case"L":return e.L;case"M":return e.M;case"Q":return e.Q;case"H":return e.H;default:throw new wr(t+"not available")}},e.prototype.toString=function(){return this.stringValue},e.prototype.equals=function(t){if(!(t instanceof e))return!1;var r=t;return this.value===r.value},e.forBits=function(t){if(t<0||t>=e.FOR_BITS.size)throw new br;return e.FOR_BITS.get(t)},e.FOR_BITS=new Map,e.FOR_VALUE=new Map,e.L=new e(Hi.L,"L",1),e.M=new e(Hi.M,"M",0),e.Q=new e(Hi.Q,"Q",3),e.H=new e(Hi.H,"H",2),e}(),Ji=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ea=function(){function e(e){this.errorCorrectionLevel=Qi.forBits(e>>3&3),this.dataMask=7&e}return e.numBitsDiffering=function(e,t){return kr.bitCount(e^t)},e.decodeFormatInformation=function(t,r){var n=e.doDecodeFormatInformation(t,r);return null!==n?n:e.doDecodeFormatInformation(t^e.FORMAT_INFO_MASK_QR,r^e.FORMAT_INFO_MASK_QR)},e.doDecodeFormatInformation=function(t,r){var n,s,i=Number.MAX_SAFE_INTEGER,a=0;try{for(var o=Ji(e.FORMAT_INFO_DECODE_LOOKUP),l=o.next();!l.done;l=o.next()){var c=l.value,d=c[0];if(d===t||d===r)return new e(c[1]);var u=e.numBitsDiffering(t,d);u<i&&(a=c[1],i=u),t!==r&&(u=e.numBitsDiffering(r,d))<i&&(a=c[1],i=u)}}catch(h){n={error:h}}finally{try{l&&!l.done&&(s=o.return)&&s.call(o)}finally{if(n)throw n.error}}return i<=3?new e(a):null},e.prototype.getErrorCorrectionLevel=function(){return this.errorCorrectionLevel},e.prototype.getDataMask=function(){return this.dataMask},e.prototype.hashCode=function(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask},e.prototype.equals=function(t){if(!(t instanceof e))return!1;var r=t;return this.errorCorrectionLevel===r.errorCorrectionLevel&&this.dataMask===r.dataMask},e.FORMAT_INFO_MASK_QR=21522,e.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])],e}(),ta=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ra=function(){function e(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.ecCodewordsPerBlock=e,this.ecBlocks=t}return e.prototype.getECCodewordsPerBlock=function(){return this.ecCodewordsPerBlock},e.prototype.getNumBlocks=function(){var e,t,r=0,n=this.ecBlocks;try{for(var s=ta(n),i=s.next();!i.done;i=s.next()){r+=i.value.getCount()}}catch(a){e={error:a}}finally{try{i&&!i.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}return r},e.prototype.getTotalECCodewords=function(){return this.ecCodewordsPerBlock*this.getNumBlocks()},e.prototype.getECBlocks=function(){return this.ecBlocks},e}(),na=function(){function e(e,t){this.count=e,this.dataCodewords=t}return e.prototype.getCount=function(){return this.count},e.prototype.getDataCodewords=function(){return this.dataCodewords},e}(),sa=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ia=function(){function e(e,t){for(var r,n,s=[],i=2;i<arguments.length;i++)s[i-2]=arguments[i];this.versionNumber=e,this.alignmentPatternCenters=t,this.ecBlocks=s;var a=0,o=s[0].getECCodewordsPerBlock(),l=s[0].getECBlocks();try{for(var c=sa(l),d=c.next();!d.done;d=c.next()){var u=d.value;a+=u.getCount()*(u.getDataCodewords()+o)}}catch(h){r={error:h}}finally{try{d&&!d.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}this.totalCodewords=a}return e.prototype.getVersionNumber=function(){return this.versionNumber},e.prototype.getAlignmentPatternCenters=function(){return this.alignmentPatternCenters},e.prototype.getTotalCodewords=function(){return this.totalCodewords},e.prototype.getDimensionForVersion=function(){return 17+4*this.versionNumber},e.prototype.getECBlocksForLevel=function(e){return this.ecBlocks[e.getValue()]},e.getProvisionalVersionForDimension=function(e){if(e%4!=1)throw new Ur;try{return this.getVersionForNumber((e-17)/4)}catch(t){throw new Ur}},e.getVersionForNumber=function(t){if(t<1||t>40)throw new br;return e.VERSIONS[t-1]},e.decodeVersionInformation=function(t){for(var r=Number.MAX_SAFE_INTEGER,n=0,s=0;s<e.VERSION_DECODE_INFO.length;s++){var i=e.VERSION_DECODE_INFO[s];if(i===t)return e.getVersionForNumber(s+7);var a=ea.numBitsDiffering(t,i);a<r&&(n=s+7,r=a)}return r<=3?e.getVersionForNumber(n):null},e.prototype.buildFunctionPattern=function(){var e=this.getDimensionForVersion(),t=new Zr(e);t.setRegion(0,0,9,9),t.setRegion(e-8,0,8,9),t.setRegion(0,e-8,9,8);for(var r=this.alignmentPatternCenters.length,n=0;n<r;n++)for(var s=this.alignmentPatternCenters[n]-2,i=0;i<r;i++)0===n&&(0===i||i===r-1)||n===r-1&&0===i||t.setRegion(this.alignmentPatternCenters[i]-2,s,5,5);return t.setRegion(6,9,1,e-17),t.setRegion(9,6,e-17,1),this.versionNumber>6&&(t.setRegion(e-11,0,3,6),t.setRegion(0,e-11,6,3)),t},e.prototype.toString=function(){return""+this.versionNumber},e.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),e.VERSIONS=[new e(1,new Int32Array(0),new ra(7,new na(1,19)),new ra(10,new na(1,16)),new ra(13,new na(1,13)),new ra(17,new na(1,9))),new e(2,Int32Array.from([6,18]),new ra(10,new na(1,34)),new ra(16,new na(1,28)),new ra(22,new na(1,22)),new ra(28,new na(1,16))),new e(3,Int32Array.from([6,22]),new ra(15,new na(1,55)),new ra(26,new na(1,44)),new ra(18,new na(2,17)),new ra(22,new na(2,13))),new e(4,Int32Array.from([6,26]),new ra(20,new na(1,80)),new ra(18,new na(2,32)),new ra(26,new na(2,24)),new ra(16,new na(4,9))),new e(5,Int32Array.from([6,30]),new ra(26,new na(1,108)),new ra(24,new na(2,43)),new ra(18,new na(2,15),new na(2,16)),new ra(22,new na(2,11),new na(2,12))),new e(6,Int32Array.from([6,34]),new ra(18,new na(2,68)),new ra(16,new na(4,27)),new ra(24,new na(4,19)),new ra(28,new na(4,15))),new e(7,Int32Array.from([6,22,38]),new ra(20,new na(2,78)),new ra(18,new na(4,31)),new ra(18,new na(2,14),new na(4,15)),new ra(26,new na(4,13),new na(1,14))),new e(8,Int32Array.from([6,24,42]),new ra(24,new na(2,97)),new ra(22,new na(2,38),new na(2,39)),new ra(22,new na(4,18),new na(2,19)),new ra(26,new na(4,14),new na(2,15))),new e(9,Int32Array.from([6,26,46]),new ra(30,new na(2,116)),new ra(22,new na(3,36),new na(2,37)),new ra(20,new na(4,16),new na(4,17)),new ra(24,new na(4,12),new na(4,13))),new e(10,Int32Array.from([6,28,50]),new ra(18,new na(2,68),new na(2,69)),new ra(26,new na(4,43),new na(1,44)),new ra(24,new na(6,19),new na(2,20)),new ra(28,new na(6,15),new na(2,16))),new e(11,Int32Array.from([6,30,54]),new ra(20,new na(4,81)),new ra(30,new na(1,50),new na(4,51)),new ra(28,new na(4,22),new na(4,23)),new ra(24,new na(3,12),new na(8,13))),new e(12,Int32Array.from([6,32,58]),new ra(24,new na(2,92),new na(2,93)),new ra(22,new na(6,36),new na(2,37)),new ra(26,new na(4,20),new na(6,21)),new ra(28,new na(7,14),new na(4,15))),new e(13,Int32Array.from([6,34,62]),new ra(26,new na(4,107)),new ra(22,new na(8,37),new na(1,38)),new ra(24,new na(8,20),new na(4,21)),new ra(22,new na(12,11),new na(4,12))),new e(14,Int32Array.from([6,26,46,66]),new ra(30,new na(3,115),new na(1,116)),new ra(24,new na(4,40),new na(5,41)),new ra(20,new na(11,16),new na(5,17)),new ra(24,new na(11,12),new na(5,13))),new e(15,Int32Array.from([6,26,48,70]),new ra(22,new na(5,87),new na(1,88)),new ra(24,new na(5,41),new na(5,42)),new ra(30,new na(5,24),new na(7,25)),new ra(24,new na(11,12),new na(7,13))),new e(16,Int32Array.from([6,26,50,74]),new ra(24,new na(5,98),new na(1,99)),new ra(28,new na(7,45),new na(3,46)),new ra(24,new na(15,19),new na(2,20)),new ra(30,new na(3,15),new na(13,16))),new e(17,Int32Array.from([6,30,54,78]),new ra(28,new na(1,107),new na(5,108)),new ra(28,new na(10,46),new na(1,47)),new ra(28,new na(1,22),new na(15,23)),new ra(28,new na(2,14),new na(17,15))),new e(18,Int32Array.from([6,30,56,82]),new ra(30,new na(5,120),new na(1,121)),new ra(26,new na(9,43),new na(4,44)),new ra(28,new na(17,22),new na(1,23)),new ra(28,new na(2,14),new na(19,15))),new e(19,Int32Array.from([6,30,58,86]),new ra(28,new na(3,113),new na(4,114)),new ra(26,new na(3,44),new na(11,45)),new ra(26,new na(17,21),new na(4,22)),new ra(26,new na(9,13),new na(16,14))),new e(20,Int32Array.from([6,34,62,90]),new ra(28,new na(3,107),new na(5,108)),new ra(26,new na(3,41),new na(13,42)),new ra(30,new na(15,24),new na(5,25)),new ra(28,new na(15,15),new na(10,16))),new e(21,Int32Array.from([6,28,50,72,94]),new ra(28,new na(4,116),new na(4,117)),new ra(26,new na(17,42)),new ra(28,new na(17,22),new na(6,23)),new ra(30,new na(19,16),new na(6,17))),new e(22,Int32Array.from([6,26,50,74,98]),new ra(28,new na(2,111),new na(7,112)),new ra(28,new na(17,46)),new ra(30,new na(7,24),new na(16,25)),new ra(24,new na(34,13))),new e(23,Int32Array.from([6,30,54,78,102]),new ra(30,new na(4,121),new na(5,122)),new ra(28,new na(4,47),new na(14,48)),new ra(30,new na(11,24),new na(14,25)),new ra(30,new na(16,15),new na(14,16))),new e(24,Int32Array.from([6,28,54,80,106]),new ra(30,new na(6,117),new na(4,118)),new ra(28,new na(6,45),new na(14,46)),new ra(30,new na(11,24),new na(16,25)),new ra(30,new na(30,16),new na(2,17))),new e(25,Int32Array.from([6,32,58,84,110]),new ra(26,new na(8,106),new na(4,107)),new ra(28,new na(8,47),new na(13,48)),new ra(30,new na(7,24),new na(22,25)),new ra(30,new na(22,15),new na(13,16))),new e(26,Int32Array.from([6,30,58,86,114]),new ra(28,new na(10,114),new na(2,115)),new ra(28,new na(19,46),new na(4,47)),new ra(28,new na(28,22),new na(6,23)),new ra(30,new na(33,16),new na(4,17))),new e(27,Int32Array.from([6,34,62,90,118]),new ra(30,new na(8,122),new na(4,123)),new ra(28,new na(22,45),new na(3,46)),new ra(30,new na(8,23),new na(26,24)),new ra(30,new na(12,15),new na(28,16))),new e(28,Int32Array.from([6,26,50,74,98,122]),new ra(30,new na(3,117),new na(10,118)),new ra(28,new na(3,45),new na(23,46)),new ra(30,new na(4,24),new na(31,25)),new ra(30,new na(11,15),new na(31,16))),new e(29,Int32Array.from([6,30,54,78,102,126]),new ra(30,new na(7,116),new na(7,117)),new ra(28,new na(21,45),new na(7,46)),new ra(30,new na(1,23),new na(37,24)),new ra(30,new na(19,15),new na(26,16))),new e(30,Int32Array.from([6,26,52,78,104,130]),new ra(30,new na(5,115),new na(10,116)),new ra(28,new na(19,47),new na(10,48)),new ra(30,new na(15,24),new na(25,25)),new ra(30,new na(23,15),new na(25,16))),new e(31,Int32Array.from([6,30,56,82,108,134]),new ra(30,new na(13,115),new na(3,116)),new ra(28,new na(2,46),new na(29,47)),new ra(30,new na(42,24),new na(1,25)),new ra(30,new na(23,15),new na(28,16))),new e(32,Int32Array.from([6,34,60,86,112,138]),new ra(30,new na(17,115)),new ra(28,new na(10,46),new na(23,47)),new ra(30,new na(10,24),new na(35,25)),new ra(30,new na(19,15),new na(35,16))),new e(33,Int32Array.from([6,30,58,86,114,142]),new ra(30,new na(17,115),new na(1,116)),new ra(28,new na(14,46),new na(21,47)),new ra(30,new na(29,24),new na(19,25)),new ra(30,new na(11,15),new na(46,16))),new e(34,Int32Array.from([6,34,62,90,118,146]),new ra(30,new na(13,115),new na(6,116)),new ra(28,new na(14,46),new na(23,47)),new ra(30,new na(44,24),new na(7,25)),new ra(30,new na(59,16),new na(1,17))),new e(35,Int32Array.from([6,30,54,78,102,126,150]),new ra(30,new na(12,121),new na(7,122)),new ra(28,new na(12,47),new na(26,48)),new ra(30,new na(39,24),new na(14,25)),new ra(30,new na(22,15),new na(41,16))),new e(36,Int32Array.from([6,24,50,76,102,128,154]),new ra(30,new na(6,121),new na(14,122)),new ra(28,new na(6,47),new na(34,48)),new ra(30,new na(46,24),new na(10,25)),new ra(30,new na(2,15),new na(64,16))),new e(37,Int32Array.from([6,28,54,80,106,132,158]),new ra(30,new na(17,122),new na(4,123)),new ra(28,new na(29,46),new na(14,47)),new ra(30,new na(49,24),new na(10,25)),new ra(30,new na(24,15),new na(46,16))),new e(38,Int32Array.from([6,32,58,84,110,136,162]),new ra(30,new na(4,122),new na(18,123)),new ra(28,new na(13,46),new na(32,47)),new ra(30,new na(48,24),new na(14,25)),new ra(30,new na(42,15),new na(32,16))),new e(39,Int32Array.from([6,26,54,82,110,138,166]),new ra(30,new na(20,117),new na(4,118)),new ra(28,new na(40,47),new na(7,48)),new ra(30,new na(43,24),new na(22,25)),new ra(30,new na(10,15),new na(67,16))),new e(40,Int32Array.from([6,30,58,86,114,142,170]),new ra(30,new na(19,118),new na(6,119)),new ra(28,new na(18,47),new na(31,48)),new ra(30,new na(34,24),new na(34,25)),new ra(30,new na(20,15),new na(61,16)))],e}();($i=Zi||(Zi={}))[$i.DATA_MASK_000=0]="DATA_MASK_000",$i[$i.DATA_MASK_001=1]="DATA_MASK_001",$i[$i.DATA_MASK_010=2]="DATA_MASK_010",$i[$i.DATA_MASK_011=3]="DATA_MASK_011",$i[$i.DATA_MASK_100=4]="DATA_MASK_100",$i[$i.DATA_MASK_101=5]="DATA_MASK_101",$i[$i.DATA_MASK_110=6]="DATA_MASK_110",$i[$i.DATA_MASK_111=7]="DATA_MASK_111";var aa,oa,la=function(){function e(e,t){this.value=e,this.isMasked=t}return e.prototype.unmaskBitMatrix=function(e,t){for(var r=0;r<t;r++)for(var n=0;n<t;n++)this.isMasked(r,n)&&e.flip(n,r)},e.values=new Map([[Zi.DATA_MASK_000,new e(Zi.DATA_MASK_000,function(e,t){return!(e+t&1)})],[Zi.DATA_MASK_001,new e(Zi.DATA_MASK_001,function(e,t){return!(1&e)})],[Zi.DATA_MASK_010,new e(Zi.DATA_MASK_010,function(e,t){return t%3==0})],[Zi.DATA_MASK_011,new e(Zi.DATA_MASK_011,function(e,t){return(e+t)%3==0})],[Zi.DATA_MASK_100,new e(Zi.DATA_MASK_100,function(e,t){return!(Math.floor(e/2)+Math.floor(t/3)&1)})],[Zi.DATA_MASK_101,new e(Zi.DATA_MASK_101,function(e,t){return e*t%6==0})],[Zi.DATA_MASK_110,new e(Zi.DATA_MASK_110,function(e,t){return e*t%6<3})],[Zi.DATA_MASK_111,new e(Zi.DATA_MASK_111,function(e,t){return!(e+t+e*t%3&1)})]]),e}(),ca=function(){function e(e){var t=e.getHeight();if(t<21||1!=(3&t))throw new Ur;this.bitMatrix=e}return e.prototype.readFormatInformation=function(){if(null!==this.parsedFormatInfo&&void 0!==this.parsedFormatInfo)return this.parsedFormatInfo;for(var e=0,t=0;t<6;t++)e=this.copyBit(t,8,e);e=this.copyBit(7,8,e),e=this.copyBit(8,8,e),e=this.copyBit(8,7,e);for(var r=5;r>=0;r--)e=this.copyBit(8,r,e);var n=this.bitMatrix.getHeight(),s=0,i=n-7;for(r=n-1;r>=i;r--)s=this.copyBit(8,r,s);for(t=n-8;t<n;t++)s=this.copyBit(t,8,s);if(this.parsedFormatInfo=ea.decodeFormatInformation(e,s),null!==this.parsedFormatInfo)return this.parsedFormatInfo;throw new Ur},e.prototype.readVersion=function(){if(null!==this.parsedVersion&&void 0!==this.parsedVersion)return this.parsedVersion;var e=this.bitMatrix.getHeight(),t=Math.floor((e-17)/4);if(t<=6)return ia.getVersionForNumber(t);for(var r=0,n=e-11,s=5;s>=0;s--)for(var i=e-9;i>=n;i--)r=this.copyBit(i,s,r);var a=ia.decodeVersionInformation(r);if(null!==a&&a.getDimensionForVersion()===e)return this.parsedVersion=a,a;r=0;for(i=5;i>=0;i--)for(s=e-9;s>=n;s--)r=this.copyBit(i,s,r);if(null!==(a=ia.decodeVersionInformation(r))&&a.getDimensionForVersion()===e)return this.parsedVersion=a,a;throw new Ur},e.prototype.copyBit=function(e,t,r){return(this.isMirror?this.bitMatrix.get(t,e):this.bitMatrix.get(e,t))?r<<1|1:r<<1},e.prototype.readCodewords=function(){var e=this.readFormatInformation(),t=this.readVersion(),r=la.values.get(e.getDataMask()),n=this.bitMatrix.getHeight();r.unmaskBitMatrix(this.bitMatrix,n);for(var s=t.buildFunctionPattern(),i=!0,a=new Uint8Array(t.getTotalCodewords()),o=0,l=0,c=0,d=n-1;d>0;d-=2){6===d&&d--;for(var u=0;u<n;u++)for(var h=i?n-1-u:u,f=0;f<2;f++)s.get(d-f,h)||(c++,l<<=1,this.bitMatrix.get(d-f,h)&&(l|=1),8===c&&(a[o++]=l,c=0,l=0));i=!i}if(o!==t.getTotalCodewords())throw new Ur;return a},e.prototype.remask=function(){if(null!==this.parsedFormatInfo){var e=la.values.get(this.parsedFormatInfo.getDataMask()),t=this.bitMatrix.getHeight();e.unmaskBitMatrix(this.bitMatrix,t)}},e.prototype.setMirror=function(e){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=e},e.prototype.mirror=function(){for(var e=this.bitMatrix,t=0,r=e.getWidth();t<r;t++)for(var n=t+1,s=e.getHeight();n<s;n++)e.get(t,n)!==e.get(n,t)&&(e.flip(n,t),e.flip(t,n))},e}(),da=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ua=function(){function e(e,t){this.numDataCodewords=e,this.codewords=t}return e.getDataBlocks=function(t,r,n){var s,i,a,o;if(t.length!==r.getTotalCodewords())throw new br;var l=r.getECBlocksForLevel(n),c=0,d=l.getECBlocks();try{for(var u=da(d),h=u.next();!h.done;h=u.next()){c+=(x=h.value).getCount()}}catch(E){s={error:E}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(s)throw s.error}}var f=new Array(c),p=0;try{for(var m=da(d),g=m.next();!g.done;g=m.next())for(var x=g.value,y=0;y<x.getCount();y++){var v=x.getDataCodewords(),w=l.getECCodewordsPerBlock()+v;f[p++]=new e(v,new Uint8Array(w))}}catch(I){a={error:I}}finally{try{g&&!g.done&&(o=m.return)&&o.call(m)}finally{if(a)throw a.error}}for(var _=f[0].codewords.length,b=f.length-1;b>=0;){if(f[b].codewords.length===_)break;b--}b++;var N=_-l.getECCodewordsPerBlock(),j=0;for(y=0;y<N;y++)for(var C=0;C<p;C++)f[C].codewords[y]=t[j++];for(C=b;C<p;C++)f[C].codewords[N]=t[j++];var A=f[0].codewords.length;for(y=N;y<A;y++)for(C=0;C<p;C++){var S=C<b?y:y+1;f[C].codewords[S]=t[j++]}return f},e.prototype.getNumDataCodewords=function(){return this.numDataCodewords},e.prototype.getCodewords=function(){return this.codewords},e}();(oa=aa||(aa={}))[oa.TERMINATOR=0]="TERMINATOR",oa[oa.NUMERIC=1]="NUMERIC",oa[oa.ALPHANUMERIC=2]="ALPHANUMERIC",oa[oa.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",oa[oa.BYTE=4]="BYTE",oa[oa.ECI=5]="ECI",oa[oa.KANJI=6]="KANJI",oa[oa.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",oa[oa.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",oa[oa.HANZI=9]="HANZI";var ha,fa,pa=function(){function e(t,r,n,s){this.value=t,this.stringValue=r,this.characterCountBitsForVersions=n,this.bits=s,e.FOR_BITS.set(s,this),e.FOR_VALUE.set(t,this)}return e.forBits=function(t){var r=e.FOR_BITS.get(t);if(void 0===r)throw new br;return r},e.prototype.getCharacterCountBits=function(e){var t,r=e.getVersionNumber();return t=r<=9?0:r<=26?1:2,this.characterCountBitsForVersions[t]},e.prototype.getValue=function(){return this.value},e.prototype.getBits=function(){return this.bits},e.prototype.equals=function(t){if(!(t instanceof e))return!1;var r=t;return this.value===r.value},e.prototype.toString=function(){return this.stringValue},e.FOR_BITS=new Map,e.FOR_VALUE=new Map,e.TERMINATOR=new e(aa.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),e.NUMERIC=new e(aa.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),e.ALPHANUMERIC=new e(aa.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),e.STRUCTURED_APPEND=new e(aa.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),e.BYTE=new e(aa.BYTE,"BYTE",Int32Array.from([8,16,16]),4),e.ECI=new e(aa.ECI,"ECI",Int32Array.from([0,0,0]),7),e.KANJI=new e(aa.KANJI,"KANJI",Int32Array.from([8,10,12]),8),e.FNC1_FIRST_POSITION=new e(aa.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),e.FNC1_SECOND_POSITION=new e(aa.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),e.HANZI=new e(aa.HANZI,"HANZI",Int32Array.from([8,10,12]),13),e}(),ma=function(){function e(){}return e.decode=function(t,r,n,s){var i=new Vi(t),a=new Kr,o=new Array,l=-1,c=-1;try{var d=null,u=!1,h=void 0;do{if(i.available()<4)h=pa.TERMINATOR;else{var f=i.readBits(4);h=pa.forBits(f)}switch(h){case pa.TERMINATOR:break;case pa.FNC1_FIRST_POSITION:case pa.FNC1_SECOND_POSITION:u=!0;break;case pa.STRUCTURED_APPEND:if(i.available()<16)throw new Ur;l=i.readBits(8),c=i.readBits(8);break;case pa.ECI:var p=e.parseECIValue(i);if(null===(d=Wr.getCharacterSetECIByValue(p)))throw new Ur;break;case pa.HANZI:var m=i.readBits(4),g=i.readBits(h.getCharacterCountBits(r));m===e.GB2312_SUBSET&&e.decodeHanziSegment(i,a,g);break;default:var x=i.readBits(h.getCharacterCountBits(r));switch(h){case pa.NUMERIC:e.decodeNumericSegment(i,a,x);break;case pa.ALPHANUMERIC:e.decodeAlphanumericSegment(i,a,x,u);break;case pa.BYTE:e.decodeByteSegment(i,a,x,d,o,s);break;case pa.KANJI:e.decodeKanjiSegment(i,a,x);break;default:throw new Ur}}}while(h!==pa.TERMINATOR)}catch(y){throw new Ur}return new _n(t,a.toString(),0===o.length?null:o,null===n?null:n.toString(),l,c)},e.decodeHanziSegment=function(e,t,r){if(13*r>e.available())throw new Ur;for(var n=new Uint8Array(2*r),s=0;r>0;){var i=e.readBits(13),a=i/96<<8&4294967295|i%96;a+=a<959?41377:42657,n[s]=a>>8&255,n[s+1]=255&a,s+=2,r--}try{t.append(Yr.decode(n,qr.GB2312))}catch(o){throw new Ur(o)}},e.decodeKanjiSegment=function(e,t,r){if(13*r>e.available())throw new Ur;for(var n=new Uint8Array(2*r),s=0;r>0;){var i=e.readBits(13),a=i/192<<8&4294967295|i%192;a+=a<7936?33088:49472,n[s]=a>>8,n[s+1]=a,s+=2,r--}try{t.append(Yr.decode(n,qr.SHIFT_JIS))}catch(o){throw new Ur(o)}},e.decodeByteSegment=function(e,t,r,n,s,i){if(8*r>e.available())throw new Ur;for(var a,o=new Uint8Array(r),l=0;l<r;l++)o[l]=e.readBits(8);a=null===n?qr.guessEncoding(o,i):n.getName();try{t.append(Yr.decode(o,a))}catch(c){throw new Ur(c)}s.push(o)},e.toAlphaNumericChar=function(t){if(t>=e.ALPHANUMERIC_CHARS.length)throw new Ur;return e.ALPHANUMERIC_CHARS[t]},e.decodeAlphanumericSegment=function(t,r,n,s){for(var i=r.length();n>1;){if(t.available()<11)throw new Ur;var a=t.readBits(11);r.append(e.toAlphaNumericChar(Math.floor(a/45))),r.append(e.toAlphaNumericChar(a%45)),n-=2}if(1===n){if(t.available()<6)throw new Ur;r.append(e.toAlphaNumericChar(t.readBits(6)))}if(s)for(var o=i;o<r.length();o++)"%"===r.charAt(o)&&(o<r.length()-1&&"%"===r.charAt(o+1)?r.deleteCharAt(o+1):r.setCharAt(o,String.fromCharCode(29)))},e.decodeNumericSegment=function(t,r,n){for(;n>=3;){if(t.available()<10)throw new Ur;var s=t.readBits(10);if(s>=1e3)throw new Ur;r.append(e.toAlphaNumericChar(Math.floor(s/100))),r.append(e.toAlphaNumericChar(Math.floor(s/10)%10)),r.append(e.toAlphaNumericChar(s%10)),n-=3}if(2===n){if(t.available()<7)throw new Ur;var i=t.readBits(7);if(i>=100)throw new Ur;r.append(e.toAlphaNumericChar(Math.floor(i/10))),r.append(e.toAlphaNumericChar(i%10))}else if(1===n){if(t.available()<4)throw new Ur;var a=t.readBits(4);if(a>=10)throw new Ur;r.append(e.toAlphaNumericChar(a))}},e.parseECIValue=function(e){var t=e.readBits(8);if(!(128&t))return 127&t;if(128==(192&t))return(63&t)<<8&4294967295|e.readBits(8);if(192==(224&t))return(31&t)<<16&4294967295|e.readBits(16);throw new Ur},e.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",e.GB2312_SUBSET=1,e}(),ga=function(){function e(e){this.mirrored=e}return e.prototype.isMirrored=function(){return this.mirrored},e.prototype.applyMirroredCorrection=function(e){if(this.mirrored&&null!==e&&!(e.length<3)){var t=e[0];e[0]=e[2],e[2]=t}},e}(),xa=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ya=function(){function e(){this.rsDecoder=new On(Sn.QR_CODE_FIELD_256)}return e.prototype.decodeBooleanArray=function(e,t){return this.decodeBitMatrix(Zr.parseFromBooleanArray(e),t)},e.prototype.decodeBitMatrix=function(e,t){var r=new ca(e),n=null;try{return this.decodeBitMatrixParser(r,t)}catch(i){n=i}try{r.remask(),r.setMirror(!0),r.readVersion(),r.readFormatInformation(),r.mirror();var s=this.decodeBitMatrixParser(r,t);return s.setOther(new ga(!0)),s}catch(i){if(null!==n)throw n;throw i}},e.prototype.decodeBitMatrixParser=function(e,t){var r,n,s,i,a=e.readVersion(),o=e.readFormatInformation().getErrorCorrectionLevel(),l=e.readCodewords(),c=ua.getDataBlocks(l,a,o),d=0;try{for(var u=xa(c),h=u.next();!h.done;h=u.next()){d+=(x=h.value).getNumDataCodewords()}}catch(_){r={error:_}}finally{try{h&&!h.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}var f=new Uint8Array(d),p=0;try{for(var m=xa(c),g=m.next();!g.done;g=m.next()){var x,y=(x=g.value).getCodewords(),v=x.getNumDataCodewords();this.correctErrors(y,v);for(var w=0;w<v;w++)f[p++]=y[w]}}catch(b){s={error:b}}finally{try{g&&!g.done&&(i=m.return)&&i.call(m)}finally{if(s)throw s.error}}return ma.decode(f,a,o,t)},e.prototype.correctErrors=function(e,t){var r=new Int32Array(e);try{this.rsDecoder.decode(r,e.length-t)}catch(s){throw new Cr}for(var n=0;n<t;n++)e[n]=r[n]},e}(),va=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),wa=function(e){function t(t,r,n){var s=e.call(this,t,r)||this;return s.estimatedModuleSize=n,s}return va(t,e),t.prototype.aboutEquals=function(e,t,r){if(Math.abs(t-this.getY())<=e&&Math.abs(r-this.getX())<=e){var n=Math.abs(e-this.estimatedModuleSize);return n<=1||n<=this.estimatedModuleSize}return!1},t.prototype.combineEstimate=function(e,r,n){return new t((this.getX()+r)/2,(this.getY()+e)/2,(this.estimatedModuleSize+n)/2)},t}(Pn),_a=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ba=function(){function e(e,t,r,n,s,i,a){this.image=e,this.startX=t,this.startY=r,this.width=n,this.height=s,this.moduleSize=i,this.resultPointCallback=a,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}return e.prototype.find=function(){for(var e=this.startX,t=this.height,r=e+this.width,n=this.startY+t/2,s=new Int32Array(3),i=this.image,a=0;a<t;a++){var o=n+(1&a?-Math.floor((a+1)/2):Math.floor((a+1)/2));s[0]=0,s[1]=0,s[2]=0;for(var l=e;l<r&&!i.get(l,o);)l++;for(var c=0;l<r;){if(i.get(l,o))if(1===c)s[1]++;else if(2===c){var d;if(this.foundPatternCross(s))if(null!==(d=this.handlePossibleCenter(s,o,l)))return d;s[0]=s[2],s[1]=1,s[2]=0,c=1}else s[++c]++;else 1===c&&c++,s[c]++;l++}if(this.foundPatternCross(s))if(null!==(d=this.handlePossibleCenter(s,o,r)))return d}if(0!==this.possibleCenters.length)return this.possibleCenters[0];throw new Qr},e.centerFromEnd=function(e,t){return t-e[2]-e[1]/2},e.prototype.foundPatternCross=function(e){for(var t=this.moduleSize,r=t/2,n=0;n<3;n++)if(Math.abs(t-e[n])>=r)return!1;return!0},e.prototype.crossCheckVertical=function(t,r,n,s){var i=this.image,a=i.getHeight(),o=this.crossCheckStateCount;o[0]=0,o[1]=0,o[2]=0;for(var l=t;l>=0&&i.get(r,l)&&o[1]<=n;)o[1]++,l--;if(l<0||o[1]>n)return NaN;for(;l>=0&&!i.get(r,l)&&o[0]<=n;)o[0]++,l--;if(o[0]>n)return NaN;for(l=t+1;l<a&&i.get(r,l)&&o[1]<=n;)o[1]++,l++;if(l===a||o[1]>n)return NaN;for(;l<a&&!i.get(r,l)&&o[2]<=n;)o[2]++,l++;if(o[2]>n)return NaN;var c=o[0]+o[1]+o[2];return 5*Math.abs(c-s)>=2*s?NaN:this.foundPatternCross(o)?e.centerFromEnd(o,l):NaN},e.prototype.handlePossibleCenter=function(t,r,n){var s,i,a=t[0]+t[1]+t[2],o=e.centerFromEnd(t,n),l=this.crossCheckVertical(r,o,2*t[1],a);if(!isNaN(l)){var c=(t[0]+t[1]+t[2])/3;try{for(var d=_a(this.possibleCenters),u=d.next();!u.done;u=d.next()){var h=u.value;if(h.aboutEquals(c,l,o))return h.combineEstimate(l,o,c)}}catch(p){s={error:p}}finally{try{u&&!u.done&&(i=d.return)&&i.call(d)}finally{if(s)throw s.error}}var f=new wa(o,l,c);this.possibleCenters.push(f),null!==this.resultPointCallback&&void 0!==this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(f)}return null},e}(),Na=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ja=function(e){function t(t,r,n,s){var i=e.call(this,t,r)||this;return i.estimatedModuleSize=n,i.count=s,void 0===s&&(i.count=1),i}return Na(t,e),t.prototype.getEstimatedModuleSize=function(){return this.estimatedModuleSize},t.prototype.getCount=function(){return this.count},t.prototype.aboutEquals=function(e,t,r){if(Math.abs(t-this.getY())<=e&&Math.abs(r-this.getX())<=e){var n=Math.abs(e-this.estimatedModuleSize);return n<=1||n<=this.estimatedModuleSize}return!1},t.prototype.combineEstimate=function(e,r,n){var s=this.count+1;return new t((this.count*this.getX()+r)/s,(this.count*this.getY()+e)/s,(this.count*this.estimatedModuleSize+n)/s,s)},t}(Pn),Ca=function(){function e(e){this.bottomLeft=e[0],this.topLeft=e[1],this.topRight=e[2]}return e.prototype.getBottomLeft=function(){return this.bottomLeft},e.prototype.getTopLeft=function(){return this.topLeft},e.prototype.getTopRight=function(){return this.topRight},e}(),Aa=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Sa=function(){function e(e,t){this.image=e,this.resultPointCallback=t,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=t}return e.prototype.getImage=function(){return this.image},e.prototype.getPossibleCenters=function(){return this.possibleCenters},e.prototype.find=function(t){var r=null!=t&&void 0!==t.get(Pr.TRY_HARDER),n=null!=t&&void 0!==t.get(Pr.PURE_BARCODE),s=this.image,i=s.getHeight(),a=s.getWidth(),o=Math.floor(3*i/(4*e.MAX_MODULES));(o<e.MIN_SKIP||r)&&(o=e.MIN_SKIP);for(var l=!1,c=new Int32Array(5),d=o-1;d<i&&!l;d+=o){c[0]=0,c[1]=0,c[2]=0,c[3]=0,c[4]=0;for(var u=0,h=0;h<a;h++)if(s.get(h,d))1&~u||u++,c[u]++;else if(1&u)c[u]++;else if(4===u)if(e.foundPatternCross(c)){if(!0!==this.handlePossibleCenter(c,d,h,n)){c[0]=c[2],c[1]=c[3],c[2]=c[4],c[3]=1,c[4]=0,u=3;continue}if(o=2,!0===this.hasSkipped)l=this.haveMultiplyConfirmedCenters();else{var f=this.findRowSkip();f>c[2]&&(d+=f-c[2]-o,h=a-1)}u=0,c[0]=0,c[1]=0,c[2]=0,c[3]=0,c[4]=0}else c[0]=c[2],c[1]=c[3],c[2]=c[4],c[3]=1,c[4]=0,u=3;else c[++u]++;if(e.foundPatternCross(c))!0===this.handlePossibleCenter(c,d,a,n)&&(o=c[0],this.hasSkipped&&(l=this.haveMultiplyConfirmedCenters()))}var p=this.selectBestPatterns();return Pn.orderBestPatterns(p),new Ca(p)},e.centerFromEnd=function(e,t){return t-e[4]-e[3]-e[2]/2},e.foundPatternCross=function(e){for(var t=0,r=0;r<5;r++){var n=e[r];if(0===n)return!1;t+=n}if(t<7)return!1;var s=t/7,i=s/2;return Math.abs(s-e[0])<i&&Math.abs(s-e[1])<i&&Math.abs(3*s-e[2])<3*i&&Math.abs(s-e[3])<i&&Math.abs(s-e[4])<i},e.prototype.getCrossCheckStateCount=function(){var e=this.crossCheckStateCount;return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e},e.prototype.crossCheckDiagonal=function(t,r,n,s){for(var i=this.getCrossCheckStateCount(),a=0,o=this.image;t>=a&&r>=a&&o.get(r-a,t-a);)i[2]++,a++;if(t<a||r<a)return!1;for(;t>=a&&r>=a&&!o.get(r-a,t-a)&&i[1]<=n;)i[1]++,a++;if(t<a||r<a||i[1]>n)return!1;for(;t>=a&&r>=a&&o.get(r-a,t-a)&&i[0]<=n;)i[0]++,a++;if(i[0]>n)return!1;var l=o.getHeight(),c=o.getWidth();for(a=1;t+a<l&&r+a<c&&o.get(r+a,t+a);)i[2]++,a++;if(t+a>=l||r+a>=c)return!1;for(;t+a<l&&r+a<c&&!o.get(r+a,t+a)&&i[3]<n;)i[3]++,a++;if(t+a>=l||r+a>=c||i[3]>=n)return!1;for(;t+a<l&&r+a<c&&o.get(r+a,t+a)&&i[4]<n;)i[4]++,a++;if(i[4]>=n)return!1;var d=i[0]+i[1]+i[2]+i[3]+i[4];return Math.abs(d-s)<2*s&&e.foundPatternCross(i)},e.prototype.crossCheckVertical=function(t,r,n,s){for(var i=this.image,a=i.getHeight(),o=this.getCrossCheckStateCount(),l=t;l>=0&&i.get(r,l);)o[2]++,l--;if(l<0)return NaN;for(;l>=0&&!i.get(r,l)&&o[1]<=n;)o[1]++,l--;if(l<0||o[1]>n)return NaN;for(;l>=0&&i.get(r,l)&&o[0]<=n;)o[0]++,l--;if(o[0]>n)return NaN;for(l=t+1;l<a&&i.get(r,l);)o[2]++,l++;if(l===a)return NaN;for(;l<a&&!i.get(r,l)&&o[3]<n;)o[3]++,l++;if(l===a||o[3]>=n)return NaN;for(;l<a&&i.get(r,l)&&o[4]<n;)o[4]++,l++;if(o[4]>=n)return NaN;var c=o[0]+o[1]+o[2]+o[3]+o[4];return 5*Math.abs(c-s)>=2*s?NaN:e.foundPatternCross(o)?e.centerFromEnd(o,l):NaN},e.prototype.crossCheckHorizontal=function(t,r,n,s){for(var i=this.image,a=i.getWidth(),o=this.getCrossCheckStateCount(),l=t;l>=0&&i.get(l,r);)o[2]++,l--;if(l<0)return NaN;for(;l>=0&&!i.get(l,r)&&o[1]<=n;)o[1]++,l--;if(l<0||o[1]>n)return NaN;for(;l>=0&&i.get(l,r)&&o[0]<=n;)o[0]++,l--;if(o[0]>n)return NaN;for(l=t+1;l<a&&i.get(l,r);)o[2]++,l++;if(l===a)return NaN;for(;l<a&&!i.get(l,r)&&o[3]<n;)o[3]++,l++;if(l===a||o[3]>=n)return NaN;for(;l<a&&i.get(l,r)&&o[4]<n;)o[4]++,l++;if(o[4]>=n)return NaN;var c=o[0]+o[1]+o[2]+o[3]+o[4];return 5*Math.abs(c-s)>=s?NaN:e.foundPatternCross(o)?e.centerFromEnd(o,l):NaN},e.prototype.handlePossibleCenter=function(t,r,n,s){var i=t[0]+t[1]+t[2]+t[3]+t[4],a=e.centerFromEnd(t,n),o=this.crossCheckVertical(r,Math.floor(a),t[2],i);if(!isNaN(o)&&(a=this.crossCheckHorizontal(Math.floor(a),Math.floor(o),t[2],i),!isNaN(a)&&(!s||this.crossCheckDiagonal(Math.floor(o),Math.floor(a),t[2],i)))){for(var l=i/7,c=!1,d=this.possibleCenters,u=0,h=d.length;u<h;u++){var f=d[u];if(f.aboutEquals(l,o,a)){d[u]=f.combineEstimate(o,a,l),c=!0;break}}if(!c){var p=new ja(a,o,l);d.push(p),null!==this.resultPointCallback&&void 0!==this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(p)}return!0}return!1},e.prototype.findRowSkip=function(){var t,r;if(this.possibleCenters.length<=1)return 0;var n=null;try{for(var s=Aa(this.possibleCenters),i=s.next();!i.done;i=s.next()){var a=i.value;if(a.getCount()>=e.CENTER_QUORUM){if(null!=n)return this.hasSkipped=!0,Math.floor((Math.abs(n.getX()-a.getX())-Math.abs(n.getY()-a.getY()))/2);n=a}}}catch(o){t={error:o}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return 0},e.prototype.haveMultiplyConfirmedCenters=function(){var t,r,n,s,i=0,a=0,o=this.possibleCenters.length;try{for(var l=Aa(this.possibleCenters),c=l.next();!c.done;c=l.next()){(p=c.value).getCount()>=e.CENTER_QUORUM&&(i++,a+=p.getEstimatedModuleSize())}}catch(m){t={error:m}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}if(i<3)return!1;var d=a/o,u=0;try{for(var h=Aa(this.possibleCenters),f=h.next();!f.done;f=h.next()){var p=f.value;u+=Math.abs(p.getEstimatedModuleSize()-d)}}catch(g){n={error:g}}finally{try{f&&!f.done&&(s=h.return)&&s.call(h)}finally{if(n)throw n.error}}return u<=.05*a},e.prototype.selectBestPatterns=function(){var e,t,r,n,s=this.possibleCenters.length;if(s<3)throw new Qr;var i,a=this.possibleCenters;if(s>3){var o=0,l=0;try{for(var c=Aa(this.possibleCenters),d=c.next();!d.done;d=c.next()){var u=d.value.getEstimatedModuleSize();o+=u,l+=u*u}}catch(y){e={error:y}}finally{try{d&&!d.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}i=o/s;var h=Math.sqrt(l/s-i*i);a.sort(function(e,t){var r=Math.abs(t.getEstimatedModuleSize()-i),n=Math.abs(e.getEstimatedModuleSize()-i);return r<n?-1:r>n?1:0});for(var f=Math.max(.2*i,h),p=0;p<a.length&&a.length>3;p++){var m=a[p];Math.abs(m.getEstimatedModuleSize()-i)>f&&(a.splice(p,1),p--)}}if(a.length>3){o=0;try{for(var g=Aa(a),x=g.next();!x.done;x=g.next()){o+=x.value.getEstimatedModuleSize()}}catch(v){r={error:v}}finally{try{x&&!x.done&&(n=g.return)&&n.call(g)}finally{if(r)throw r.error}}i=o/a.length,a.sort(function(e,t){if(t.getCount()===e.getCount()){var r=Math.abs(t.getEstimatedModuleSize()-i),n=Math.abs(e.getEstimatedModuleSize()-i);return r<n?1:r>n?-1:0}return t.getCount()-e.getCount()}),a.splice(3)}return[a[0],a[1],a[2]]},e.CENTER_QUORUM=2,e.MIN_SKIP=3,e.MAX_MODULES=57,e}(),Ea=function(){function e(e){this.image=e}return e.prototype.getImage=function(){return this.image},e.prototype.getResultPointCallback=function(){return this.resultPointCallback},e.prototype.detect=function(e){this.resultPointCallback=null==e?null:e.get(Pr.NEED_RESULT_POINT_CALLBACK);var t=new Sa(this.image,this.resultPointCallback).find(e);return this.processFinderPatternInfo(t)},e.prototype.processFinderPatternInfo=function(t){var r=t.getTopLeft(),n=t.getTopRight(),s=t.getBottomLeft(),i=this.calculateModuleSize(r,n,s);if(i<1)throw new Qr("No pattern found in proccess finder.");var a=e.computeDimension(r,n,s,i),o=ia.getProvisionalVersionForDimension(a),l=o.getDimensionForVersion()-7,c=null;if(o.getAlignmentPatternCenters().length>0)for(var d=n.getX()-r.getX()+s.getX(),u=n.getY()-r.getY()+s.getY(),h=1-3/l,f=Math.floor(r.getX()+h*(d-r.getX())),p=Math.floor(r.getY()+h*(u-r.getY())),m=4;m<=16;m<<=1)try{c=this.findAlignmentInRegion(i,f,p,m);break}catch(y){if(!(y instanceof Qr))throw y}var g=e.createTransform(r,n,s,c,a),x=e.sampleGrid(this.image,g,a);return new Bn(x,null===c?[s,r,n]:[s,r,n,c])},e.createTransform=function(e,t,r,n,s){var i,a,o,l,c=s-3.5;return null!==n?(i=n.getX(),a=n.getY(),l=o=c-3):(i=t.getX()-e.getX()+r.getX(),a=t.getY()-e.getY()+r.getY(),o=c,l=c),Hn.quadrilateralToQuadrilateral(3.5,3.5,c,3.5,o,l,3.5,c,e.getX(),e.getY(),t.getX(),t.getY(),i,a,r.getX(),r.getY())},e.sampleGrid=function(e,t,r){return zn.getInstance().sampleGridWithTransform(e,r,r,t)},e.computeDimension=function(e,t,r,n){var s=kn.round(Pn.distance(e,t)/n),i=kn.round(Pn.distance(e,r)/n),a=Math.floor((s+i)/2)+7;switch(3&a){case 0:a++;break;case 2:a--;break;case 3:throw new Qr("Dimensions could be not found.")}return a},e.prototype.calculateModuleSize=function(e,t,r){return(this.calculateModuleSizeOneWay(e,t)+this.calculateModuleSizeOneWay(e,r))/2},e.prototype.calculateModuleSizeOneWay=function(e,t){var r=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(e.getX()),Math.floor(e.getY()),Math.floor(t.getX()),Math.floor(t.getY())),n=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(t.getX()),Math.floor(t.getY()),Math.floor(e.getX()),Math.floor(e.getY()));return isNaN(r)?n/7:isNaN(n)?r/7:(r+n)/14},e.prototype.sizeOfBlackWhiteBlackRunBothWays=function(e,t,r,n){var s=this.sizeOfBlackWhiteBlackRun(e,t,r,n),i=1,a=e-(r-e);a<0?(i=e/(e-a),a=0):a>=this.image.getWidth()&&(i=(this.image.getWidth()-1-e)/(a-e),a=this.image.getWidth()-1);var o=Math.floor(t-(n-t)*i);return i=1,o<0?(i=t/(t-o),o=0):o>=this.image.getHeight()&&(i=(this.image.getHeight()-1-t)/(o-t),o=this.image.getHeight()-1),a=Math.floor(e+(a-e)*i),(s+=this.sizeOfBlackWhiteBlackRun(e,t,a,o))-1},e.prototype.sizeOfBlackWhiteBlackRun=function(e,t,r,n){var s=Math.abs(n-t)>Math.abs(r-e);if(s){var i=e;e=t,t=i,i=r,r=n,n=i}for(var a=Math.abs(r-e),o=Math.abs(n-t),l=-a/2,c=e<r?1:-1,d=t<n?1:-1,u=0,h=r+c,f=e,p=t;f!==h;f+=c){var m=s?p:f,g=s?f:p;if(1===u===this.image.get(m,g)){if(2===u)return kn.distance(f,p,e,t);u++}if((l+=o)>0){if(p===n)break;p+=d,l-=a}}return 2===u?kn.distance(r+c,n,e,t):NaN},e.prototype.findAlignmentInRegion=function(e,t,r,n){var s=Math.floor(n*e),i=Math.max(0,t-s),a=Math.min(this.image.getWidth()-1,t+s);if(a-i<3*e)throw new Qr("Alignment top exceeds estimated module size.");var o=Math.max(0,r-s),l=Math.min(this.image.getHeight()-1,r+s);if(l-o<3*e)throw new Qr("Alignment bottom exceeds estimated module size.");return new ba(this.image,i,o,a-i,l-o,e,this.resultPointCallback).find()},e}(),Ia=function(){function e(){this.decoder=new ya}return e.prototype.getDecoder=function(){return this.decoder},e.prototype.decode=function(t,r){var n,s;if(null!=r&&void 0!==r.get(Pr.PURE_BARCODE)){var i=e.extractPureBits(t.getBlackMatrix());n=this.decoder.decodeBitMatrix(i,r),s=e.NO_POINTS}else{var a=new Ea(t.getBlackMatrix()).detect(r);n=this.decoder.decodeBitMatrix(a.getBits(),r),s=a.getPoints()}n.getOther()instanceof ga&&n.getOther().applyMirroredCorrection(s);var o=new pn(n.getText(),n.getRawBytes(),void 0,s,mn.QR_CODE,void 0),l=n.getByteSegments();null!==l&&o.putMetadata(yn.BYTE_SEGMENTS,l);var c=n.getECLevel();return null!==c&&o.putMetadata(yn.ERROR_CORRECTION_LEVEL,c),n.hasStructuredAppend()&&(o.putMetadata(yn.STRUCTURED_APPEND_SEQUENCE,n.getStructuredAppendSequenceNumber()),o.putMetadata(yn.STRUCTURED_APPEND_PARITY,n.getStructuredAppendParity())),o},e.prototype.reset=function(){},e.extractPureBits=function(e){var t=e.getTopLeftOnBit(),r=e.getBottomRightOnBit();if(null===t||null===r)throw new Qr;var n=this.moduleSize(t,e),s=t[1],i=r[1],a=t[0],o=r[0];if(a>=o||s>=i)throw new Qr;if(i-s!==o-a&&(o=a+(i-s))>=e.getWidth())throw new Qr;var l=Math.round((o-a+1)/n),c=Math.round((i-s+1)/n);if(l<=0||c<=0)throw new Qr;if(c!==l)throw new Qr;var d=Math.floor(n/2);s+=d;var u=(a+=d)+Math.floor((l-1)*n)-o;if(u>0){if(u>d)throw new Qr;a-=u}var h=s+Math.floor((c-1)*n)-i;if(h>0){if(h>d)throw new Qr;s-=h}for(var f=new Zr(l,c),p=0;p<c;p++)for(var m=s+Math.floor(p*n),g=0;g<l;g++)e.get(a+Math.floor(g*n),m)&&f.set(g,p);return f},e.moduleSize=function(e,t){for(var r=t.getHeight(),n=t.getWidth(),s=e[0],i=e[1],a=!0,o=0;s<n&&i<r;){if(a!==t.get(s,i)){if(5===++o)break;a=!a}s++,i++}if(s===n||i===r)throw new Qr;return(s-e[0])/7},e.NO_POINTS=new Array,e}(),Ta=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Da=function(){function e(){}return e.prototype.PDF417Common=function(){},e.getBitCountSum=function(e){return kn.sum(e)},e.toIntArray=function(t){var r,n;if(null==t||!t.length)return e.EMPTY_INT_ARRAY;var s=new Int32Array(t.length),i=0;try{for(var a=Ta(t),o=a.next();!o.done;o=a.next()){var l=o.value;s[i++]=l}}catch(c){r={error:c}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return s},e.getCodeword=function(t){var r=Rr.binarySearch(e.SYMBOL_TABLE,262143&t);return r<0?-1:(e.CODEWORD_TABLE[r]-1)%e.NUMBER_OF_CODEWORDS},e.NUMBER_OF_CODEWORDS=929,e.MAX_CODEWORDS_IN_BARCODE=e.NUMBER_OF_CODEWORDS-1,e.MIN_ROWS_IN_BARCODE=3,e.MAX_ROWS_IN_BARCODE=90,e.MODULES_IN_CODEWORD=17,e.MODULES_IN_STOP_PATTERN=18,e.BARS_IN_MODULE=8,e.EMPTY_INT_ARRAY=new Int32Array([]),e.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),e.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]),e}(),Oa=function(){function e(e,t){this.bits=e,this.points=t}return e.prototype.getBits=function(){return this.bits},e.prototype.getPoints=function(){return this.points},e}(),Ra=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ka=function(){function e(){}return e.detectMultiple=function(t,r,n){var s=t.getBlackMatrix(),i=e.detect(n,s);return i.length||((s=s.clone()).rotate180(),i=e.detect(n,s)),new Oa(s,i)},e.detect=function(t,r){for(var n,s,i=new Array,a=0,o=0,l=!1;a<r.getHeight();){var c=e.findVertices(r,a,o);if(null!=c[0]||null!=c[3]){if(l=!0,i.push(c),!t)break;null!=c[2]?(o=Math.trunc(c[2].getX()),a=Math.trunc(c[2].getY())):(o=Math.trunc(c[4].getX()),a=Math.trunc(c[4].getY()))}else{if(!l)break;l=!1,o=0;try{for(var d=(n=void 0,Ra(i)),u=d.next();!u.done;u=d.next()){var h=u.value;null!=h[1]&&(a=Math.trunc(Math.max(a,h[1].getY()))),null!=h[3]&&(a=Math.max(a,Math.trunc(h[3].getY())))}}catch(f){n={error:f}}finally{try{u&&!u.done&&(s=d.return)&&s.call(d)}finally{if(n)throw n.error}}a+=e.ROW_STEP}}return i},e.findVertices=function(t,r,n){var s=t.getHeight(),i=t.getWidth(),a=new Array(8);return e.copyToResult(a,e.findRowsWithPattern(t,s,i,r,n,e.START_PATTERN),e.INDEXES_START_PATTERN),null!=a[4]&&(n=Math.trunc(a[4].getX()),r=Math.trunc(a[4].getY())),e.copyToResult(a,e.findRowsWithPattern(t,s,i,r,n,e.STOP_PATTERN),e.INDEXES_STOP_PATTERN),a},e.copyToResult=function(e,t,r){for(var n=0;n<r.length;n++)e[r[n]]=t[n]},e.findRowsWithPattern=function(t,r,n,s,i,a){for(var o=new Array(4),l=!1,c=new Int32Array(a.length);s<r;s+=e.ROW_STEP){if(null!=(f=e.findGuardPattern(t,i,s,n,!1,a,c))){for(;s>0;){if(null==(h=e.findGuardPattern(t,i,--s,n,!1,a,c))){s++;break}f=h}o[0]=new Pn(f[0],s),o[1]=new Pn(f[1],s),l=!0;break}}var d=s+1;if(l){for(var u=0,h=Int32Array.from([Math.trunc(o[0].getX()),Math.trunc(o[1].getX())]);d<r;d++){var f;if(null!=(f=e.findGuardPattern(t,h[0],d,n,!1,a,c))&&Math.abs(h[0]-f[0])<e.MAX_PATTERN_DRIFT&&Math.abs(h[1]-f[1])<e.MAX_PATTERN_DRIFT)h=f,u=0;else{if(u>e.SKIPPED_ROW_COUNT_MAX)break;u++}}d-=u+1,o[2]=new Pn(h[0],d),o[3]=new Pn(h[1],d)}return d-s<e.BARCODE_MIN_HEIGHT&&Rr.fill(o,null),o},e.findGuardPattern=function(t,r,n,s,i,a,o){Rr.fillWithin(o,0,o.length,0);for(var l=r,c=0;t.get(l,n)&&l>0&&c++<e.MAX_PIXEL_DRIFT;)l--;for(var d=l,u=0,h=a.length,f=i;d<s;d++){if(t.get(d,n)!==f)o[u]++;else{if(u===h-1){if(e.patternMatchVariance(o,a,e.MAX_INDIVIDUAL_VARIANCE)<e.MAX_AVG_VARIANCE)return new Int32Array([l,d]);l+=o[0]+o[1],Sr.arraycopy(o,2,o,0,u-1),o[u-1]=0,o[u]=0,u--}else u++;o[u]=1,f=!f}}return u===h-1&&e.patternMatchVariance(o,a,e.MAX_INDIVIDUAL_VARIANCE)<e.MAX_AVG_VARIANCE?new Int32Array([l,d-1]):null},e.patternMatchVariance=function(e,t,r){for(var n=e.length,s=0,i=0,a=0;a<n;a++)s+=e[a],i+=t[a];if(s<i)return 1/0;var o=s/i;r*=o;for(var l=0,c=0;c<n;c++){var d=e[c],u=t[c]*o,h=d>u?d-u:u-d;if(h>r)return 1/0;l+=h}return l/s},e.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),e.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),e.MAX_AVG_VARIANCE=.42,e.MAX_INDIVIDUAL_VARIANCE=.8,e.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),e.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),e.MAX_PIXEL_DRIFT=3,e.MAX_PATTERN_DRIFT=5,e.SKIPPED_ROW_COUNT_MAX=25,e.ROW_STEP=5,e.BARCODE_MIN_HEIGHT=10,e}(),Ma=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Pa=function(){function e(e,t){if(0===t.length)throw new br;this.field=e;var r=t.length;if(r>1&&0===t[0]){for(var n=1;n<r&&0===t[n];)n++;n===r?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(r-n),Sr.arraycopy(t,n,this.coefficients,0,this.coefficients.length))}else this.coefficients=t}return e.prototype.getCoefficients=function(){return this.coefficients},e.prototype.getDegree=function(){return this.coefficients.length-1},e.prototype.isZero=function(){return 0===this.coefficients[0]},e.prototype.getCoefficient=function(e){return this.coefficients[this.coefficients.length-1-e]},e.prototype.evaluateAt=function(e){var t,r;if(0===e)return this.getCoefficient(0);if(1===e){var n=0;try{for(var s=Ma(this.coefficients),i=s.next();!i.done;i=s.next()){var a=i.value;n=this.field.add(n,a)}}catch(d){t={error:d}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return n}for(var o=this.coefficients[0],l=this.coefficients.length,c=1;c<l;c++)o=this.field.add(this.field.multiply(e,o),this.coefficients[c]);return o},e.prototype.add=function(t){if(!this.field.equals(t.field))throw new br("ModulusPolys do not have same ModulusGF field");if(this.isZero())return t;if(t.isZero())return this;var r=this.coefficients,n=t.coefficients;if(r.length>n.length){var s=r;r=n,n=s}var i=new Int32Array(n.length),a=n.length-r.length;Sr.arraycopy(n,0,i,0,a);for(var o=a;o<n.length;o++)i[o]=this.field.add(r[o-a],n[o]);return new e(this.field,i)},e.prototype.subtract=function(e){if(!this.field.equals(e.field))throw new br("ModulusPolys do not have same ModulusGF field");return e.isZero()?this:this.add(e.negative())},e.prototype.multiply=function(t){return t instanceof e?this.multiplyOther(t):this.multiplyScalar(t)},e.prototype.multiplyOther=function(t){if(!this.field.equals(t.field))throw new br("ModulusPolys do not have same ModulusGF field");if(this.isZero()||t.isZero())return new e(this.field,new Int32Array([0]));for(var r=this.coefficients,n=r.length,s=t.coefficients,i=s.length,a=new Int32Array(n+i-1),o=0;o<n;o++)for(var l=r[o],c=0;c<i;c++)a[o+c]=this.field.add(a[o+c],this.field.multiply(l,s[c]));return new e(this.field,a)},e.prototype.negative=function(){for(var t=this.coefficients.length,r=new Int32Array(t),n=0;n<t;n++)r[n]=this.field.subtract(0,this.coefficients[n]);return new e(this.field,r)},e.prototype.multiplyScalar=function(t){if(0===t)return new e(this.field,new Int32Array([0]));if(1===t)return this;for(var r=this.coefficients.length,n=new Int32Array(r),s=0;s<r;s++)n[s]=this.field.multiply(this.coefficients[s],t);return new e(this.field,n)},e.prototype.multiplyByMonomial=function(t,r){if(t<0)throw new br;if(0===r)return new e(this.field,new Int32Array([0]));for(var n=this.coefficients.length,s=new Int32Array(n+t),i=0;i<n;i++)s[i]=this.field.multiply(this.coefficients[i],r);return new e(this.field,s)},e.prototype.toString=function(){for(var e=new Kr,t=this.getDegree();t>=0;t--){var r=this.getCoefficient(t);0!==r&&(r<0?(e.append(" - "),r=-r):e.length()>0&&e.append(" + "),0!==t&&1===r||e.append(r),0!==t&&(1===t?e.append("x"):(e.append("x^"),e.append(t))))}return e.toString()},e}(),Ba=function(){function e(){}return e.prototype.add=function(e,t){return(e+t)%this.modulus},e.prototype.subtract=function(e,t){return(this.modulus+e-t)%this.modulus},e.prototype.exp=function(e){return this.expTable[e]},e.prototype.log=function(e){if(0===e)throw new br;return this.logTable[e]},e.prototype.inverse=function(e){if(0===e)throw new Cn;return this.expTable[this.modulus-this.logTable[e]-1]},e.prototype.multiply=function(e,t){return 0===e||0===t?0:this.expTable[(this.logTable[e]+this.logTable[t])%(this.modulus-1)]},e.prototype.getSize=function(){return this.modulus},e.prototype.equals=function(e){return e===this},e}(),Fa=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),La=function(e){function t(t,r){var n=e.call(this)||this;n.modulus=t,n.expTable=new Int32Array(t),n.logTable=new Int32Array(t);for(var s=1,i=0;i<t;i++)n.expTable[i]=s,s=s*r%t;for(i=0;i<t-1;i++)n.logTable[n.expTable[i]]=i;return n.zero=new Pa(n,new Int32Array([0])),n.one=new Pa(n,new Int32Array([1])),n}return Fa(t,e),t.prototype.getZero=function(){return this.zero},t.prototype.getOne=function(){return this.one},t.prototype.buildMonomial=function(e,t){if(e<0)throw new br;if(0===t)return this.zero;var r=new Int32Array(e+1);return r[0]=t,new Pa(this,r)},t.PDF417_GF=new t(Da.NUMBER_OF_CODEWORDS,3),t}(Ba),Ua=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Va=function(){function e(){this.field=La.PDF417_GF}return e.prototype.decode=function(e,t,r){for(var n,s,i=new Pa(this.field,e),a=new Int32Array(t),o=!1,l=t;l>0;l--){var c=i.evaluateAt(this.field.exp(l));a[t-l]=c,0!==c&&(o=!0)}if(!o)return 0;var d=this.field.getOne();if(null!=r)try{for(var u=Ua(r),h=u.next();!h.done;h=u.next()){var f=h.value,p=this.field.exp(e.length-1-f),m=new Pa(this.field,new Int32Array([this.field.subtract(0,p),1]));d=d.multiply(m)}}catch(N){n={error:N}}finally{try{h&&!h.done&&(s=u.return)&&s.call(u)}finally{if(n)throw n.error}}var g=new Pa(this.field,a),x=this.runEuclideanAlgorithm(this.field.buildMonomial(t,1),g,t),y=x[0],v=x[1],w=this.findErrorLocations(y),_=this.findErrorMagnitudes(v,y,w);for(l=0;l<w.length;l++){var b=e.length-1-this.field.log(w[l]);if(b<0)throw Cr.getChecksumInstance();e[b]=this.field.subtract(e[b],_[l])}return w.length},e.prototype.runEuclideanAlgorithm=function(e,t,r){if(e.getDegree()<t.getDegree()){var n=e;e=t,t=n}for(var s=e,i=t,a=this.field.getZero(),o=this.field.getOne();i.getDegree()>=Math.round(r/2);){var l=s,c=a;if(a=o,(s=i).isZero())throw Cr.getChecksumInstance();i=l;for(var d=this.field.getZero(),u=s.getCoefficient(s.getDegree()),h=this.field.inverse(u);i.getDegree()>=s.getDegree()&&!i.isZero();){var f=i.getDegree()-s.getDegree(),p=this.field.multiply(i.getCoefficient(i.getDegree()),h);d=d.add(this.field.buildMonomial(f,p)),i=i.subtract(s.multiplyByMonomial(f,p))}o=d.multiply(a).subtract(c).negative()}var m=o.getCoefficient(0);if(0===m)throw Cr.getChecksumInstance();var g=this.field.inverse(m);return[o.multiply(g),i.multiply(g)]},e.prototype.findErrorLocations=function(e){for(var t=e.getDegree(),r=new Int32Array(t),n=0,s=1;s<this.field.getSize()&&n<t;s++)0===e.evaluateAt(s)&&(r[n]=this.field.inverse(s),n++);if(n!==t)throw Cr.getChecksumInstance();return r},e.prototype.findErrorMagnitudes=function(e,t,r){for(var n=t.getDegree(),s=new Int32Array(n),i=1;i<=n;i++)s[n-i]=this.field.multiply(i,t.getCoefficient(i));var a=new Pa(this.field,s),o=r.length,l=new Int32Array(o);for(i=0;i<o;i++){var c=this.field.inverse(r[i]),d=this.field.subtract(0,e.evaluateAt(c)),u=this.field.inverse(a.evaluateAt(c));l[i]=this.field.multiply(d,u)}return l},e}(),Ha=function(){function e(t,r,n,s,i){t instanceof e?this.constructor_2(t):this.constructor_1(t,r,n,s,i)}return e.prototype.constructor_1=function(e,t,r,n,s){var i=null==t||null==r,a=null==n||null==s;if(i&&a)throw new Qr;i?(t=new Pn(0,n.getY()),r=new Pn(0,s.getY())):a&&(n=new Pn(e.getWidth()-1,t.getY()),s=new Pn(e.getWidth()-1,r.getY())),this.image=e,this.topLeft=t,this.bottomLeft=r,this.topRight=n,this.bottomRight=s,this.minX=Math.trunc(Math.min(t.getX(),r.getX())),this.maxX=Math.trunc(Math.max(n.getX(),s.getX())),this.minY=Math.trunc(Math.min(t.getY(),n.getY())),this.maxY=Math.trunc(Math.max(r.getY(),s.getY()))},e.prototype.constructor_2=function(e){this.image=e.image,this.topLeft=e.getTopLeft(),this.bottomLeft=e.getBottomLeft(),this.topRight=e.getTopRight(),this.bottomRight=e.getBottomRight(),this.minX=e.getMinX(),this.maxX=e.getMaxX(),this.minY=e.getMinY(),this.maxY=e.getMaxY()},e.merge=function(t,r){return null==t?r:null==r?t:new e(t.image,t.topLeft,t.bottomLeft,r.topRight,r.bottomRight)},e.prototype.addMissingRows=function(t,r,n){var s=this.topLeft,i=this.bottomLeft,a=this.topRight,o=this.bottomRight;if(t>0){var l=n?this.topLeft:this.topRight,c=Math.trunc(l.getY()-t);c<0&&(c=0);var d=new Pn(l.getX(),c);n?s=d:a=d}if(r>0){var u=n?this.bottomLeft:this.bottomRight,h=Math.trunc(u.getY()+r);h>=this.image.getHeight()&&(h=this.image.getHeight()-1);var f=new Pn(u.getX(),h);n?i=f:o=f}return new e(this.image,s,i,a,o)},e.prototype.getMinX=function(){return this.minX},e.prototype.getMaxX=function(){return this.maxX},e.prototype.getMinY=function(){return this.minY},e.prototype.getMaxY=function(){return this.maxY},e.prototype.getTopLeft=function(){return this.topLeft},e.prototype.getTopRight=function(){return this.topRight},e.prototype.getBottomLeft=function(){return this.bottomLeft},e.prototype.getBottomRight=function(){return this.bottomRight},e}(),Ga=function(){function e(e,t,r,n){this.columnCount=e,this.errorCorrectionLevel=n,this.rowCountUpperPart=t,this.rowCountLowerPart=r,this.rowCount=t+r}return e.prototype.getColumnCount=function(){return this.columnCount},e.prototype.getErrorCorrectionLevel=function(){return this.errorCorrectionLevel},e.prototype.getRowCount=function(){return this.rowCount},e.prototype.getRowCountUpperPart=function(){return this.rowCountUpperPart},e.prototype.getRowCountLowerPart=function(){return this.rowCountLowerPart},e}(),Wa=function(){function e(){this.buffer=""}return e.form=function(e,t){var r=-1;return e.replace(/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g,function(e,n,s,i,a,o){if("%%"===e)return"%";if(void 0!==t[++r]){e=i?parseInt(i.substr(1)):void 0;var l,c=a?parseInt(a.substr(1)):void 0;switch(o){case"s":l=t[r];break;case"c":l=t[r][0];break;case"f":l=parseFloat(t[r]).toFixed(e);break;case"p":l=parseFloat(t[r]).toPrecision(e);break;case"e":l=parseFloat(t[r]).toExponential(e);break;case"x":l=parseInt(t[r]).toString(c||16);break;case"d":l=parseFloat(parseInt(t[r],c||10).toPrecision(e)).toFixed(0)}l="object"==typeof l?JSON.stringify(l):(+l).toString(c);for(var d=parseInt(s),u=s&&s[0]+""=="0"?"0":" ";l.length<d;)l=void 0!==n?l+u:u+l;return l}})},e.prototype.format=function(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];this.buffer+=e.form(t,r)},e.prototype.toString=function(){return this.buffer},e}(),za=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Xa=function(){function e(e){this.boundingBox=new Ha(e),this.codewords=new Array(e.getMaxY()-e.getMinY()+1)}return e.prototype.getCodewordNearby=function(t){var r=this.getCodeword(t);if(null!=r)return r;for(var n=1;n<e.MAX_NEARBY_DISTANCE;n++){var s=this.imageRowToCodewordIndex(t)-n;if(s>=0&&null!=(r=this.codewords[s]))return r;if((s=this.imageRowToCodewordIndex(t)+n)<this.codewords.length&&null!=(r=this.codewords[s]))return r}return null},e.prototype.imageRowToCodewordIndex=function(e){return e-this.boundingBox.getMinY()},e.prototype.setCodeword=function(e,t){this.codewords[this.imageRowToCodewordIndex(e)]=t},e.prototype.getCodeword=function(e){return this.codewords[this.imageRowToCodewordIndex(e)]},e.prototype.getBoundingBox=function(){return this.boundingBox},e.prototype.getCodewords=function(){return this.codewords},e.prototype.toString=function(){var e,t,r=new Wa,n=0;try{for(var s=za(this.codewords),i=s.next();!i.done;i=s.next()){var a=i.value;null!=a?r.format("%3d: %3d|%3d%n",n++,a.getRowNumber(),a.getValue()):r.format("%3d:    |   %n",n++)}}catch(o){e={error:o}}finally{try{i&&!i.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}return r.toString()},e.MAX_NEARBY_DISTANCE=5,e}(),Ya=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},qa=globalThis&&globalThis.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,s,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(o){s={error:o}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(s)throw s.error}}return a},Ka=function(){function e(){this.values=new Map}return e.prototype.setValue=function(e){e=Math.trunc(e);var t=this.values.get(e);null==t&&(t=0),t++,this.values.set(e,t)},e.prototype.getValue=function(){var e,t,r=-1,n=new Array,s=function(e,t){var s=function(){return e},i=function(){return t};i()>r?(r=i(),(n=[]).push(s())):i()===r&&n.push(s())};try{for(var i=Ya(this.values.entries()),a=i.next();!a.done;a=i.next()){var o=qa(a.value,2);s(o[0],o[1])}}catch(l){e={error:l}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return Da.toIntArray(n)},e.prototype.getConfidence=function(e){return this.values.get(e)},e}(),Za=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),$a=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Qa=function(e){function t(t,r){var n=e.call(this,t)||this;return n._isLeft=r,n}return Za(t,e),t.prototype.setRowNumbers=function(){var e,t;try{for(var r=$a(this.getCodewords()),n=r.next();!n.done;n=r.next()){var s=n.value;null!=s&&s.setRowNumberAsRowIndicatorColumn()}}catch(i){e={error:i}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t.prototype.adjustCompleteIndicatorColumnRowNumbers=function(e){var t=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(t,e);for(var r=this.getBoundingBox(),n=this._isLeft?r.getTopLeft():r.getTopRight(),s=this._isLeft?r.getBottomLeft():r.getBottomRight(),i=this.imageRowToCodewordIndex(Math.trunc(n.getY())),a=this.imageRowToCodewordIndex(Math.trunc(s.getY())),o=-1,l=1,c=0,d=i;d<a;d++)if(null!=t[d]){var u=t[d],h=u.getRowNumber()-o;if(0===h)c++;else if(1===h)l=Math.max(l,c),c=1,o=u.getRowNumber();else if(h<0||u.getRowNumber()>=e.getRowCount()||h>d)t[d]=null;else{for(var f=void 0,p=(f=l>2?(l-2)*h:h)>=d,m=1;m<=f&&!p;m++)p=null!=t[d-m];p?t[d]=null:(o=u.getRowNumber(),c=1)}}},t.prototype.getRowHeights=function(){var e,t,r=this.getBarcodeMetadata();if(null==r)return null;this.adjustIncompleteIndicatorColumnRowNumbers(r);var n=new Int32Array(r.getRowCount());try{for(var s=$a(this.getCodewords()),i=s.next();!i.done;i=s.next()){var a=i.value;if(null!=a){var o=a.getRowNumber();if(o>=n.length)continue;n[o]++}}}catch(l){e={error:l}}finally{try{i&&!i.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}return n},t.prototype.adjustIncompleteIndicatorColumnRowNumbers=function(e){for(var t=this.getBoundingBox(),r=this._isLeft?t.getTopLeft():t.getTopRight(),n=this._isLeft?t.getBottomLeft():t.getBottomRight(),s=this.imageRowToCodewordIndex(Math.trunc(r.getY())),i=this.imageRowToCodewordIndex(Math.trunc(n.getY())),a=this.getCodewords(),o=-1,l=s;l<i;l++)if(null!=a[l]){var c=a[l];c.setRowNumberAsRowIndicatorColumn();var d=c.getRowNumber()-o;0===d||(1===d?o=c.getRowNumber():c.getRowNumber()>=e.getRowCount()?a[l]=null:o=c.getRowNumber())}},t.prototype.getBarcodeMetadata=function(){var e,t,r=this.getCodewords(),n=new Ka,s=new Ka,i=new Ka,a=new Ka;try{for(var o=$a(r),l=o.next();!l.done;l=o.next()){var c=l.value;if(null!=c){c.setRowNumberAsRowIndicatorColumn();var d=c.getValue()%30,u=c.getRowNumber();switch(this._isLeft||(u+=2),u%3){case 0:s.setValue(3*d+1);break;case 1:a.setValue(d/3),i.setValue(d%3);break;case 2:n.setValue(d+1)}}}}catch(f){e={error:f}}finally{try{l&&!l.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}if(0===n.getValue().length||0===s.getValue().length||0===i.getValue().length||0===a.getValue().length||n.getValue()[0]<1||s.getValue()[0]+i.getValue()[0]<Da.MIN_ROWS_IN_BARCODE||s.getValue()[0]+i.getValue()[0]>Da.MAX_ROWS_IN_BARCODE)return null;var h=new Ga(n.getValue()[0],s.getValue()[0],i.getValue()[0],a.getValue()[0]);return this.removeIncorrectCodewords(r,h),h},t.prototype.removeIncorrectCodewords=function(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(null!=e[r]){var s=n.getValue()%30,i=n.getRowNumber();if(i>t.getRowCount())e[r]=null;else switch(this._isLeft||(i+=2),i%3){case 0:3*s+1!==t.getRowCountUpperPart()&&(e[r]=null);break;case 1:Math.trunc(s/3)===t.getErrorCorrectionLevel()&&s%3===t.getRowCountLowerPart()||(e[r]=null);break;case 2:s+1!==t.getColumnCount()&&(e[r]=null)}}}},t.prototype.isLeft=function(){return this._isLeft},t.prototype.toString=function(){return"IsLeft: "+this._isLeft+"\n"+e.prototype.toString.call(this)},t}(Xa),Ja=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},eo=function(){function e(e,t){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=e,this.barcodeColumnCount=e.getColumnCount(),this.boundingBox=t,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}return e.prototype.getDetectionResultColumns=function(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);var e,t=Da.MAX_CODEWORDS_IN_BARCODE;do{e=t,t=this.adjustRowNumbersAndGetCount()}while(t>0&&t<e);return this.detectionResultColumns},e.prototype.adjustIndicatorColumnRowNumbers=function(e){null!=e&&e.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)},e.prototype.adjustRowNumbersAndGetCount=function(){var e=this.adjustRowNumbersByRow();if(0===e)return 0;for(var t=1;t<this.barcodeColumnCount+1;t++)for(var r=this.detectionResultColumns[t].getCodewords(),n=0;n<r.length;n++)null!=r[n]&&(r[n].hasValidRowNumber()||this.adjustRowNumbers(t,n,r));return e},e.prototype.adjustRowNumbersByRow=function(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()},e.prototype.adjustRowNumbersFromBothRI=function(){if(null!=this.detectionResultColumns[0]&&null!=this.detectionResultColumns[this.barcodeColumnCount+1])for(var e=this.detectionResultColumns[0].getCodewords(),t=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords(),r=0;r<e.length;r++)if(null!=e[r]&&null!=t[r]&&e[r].getRowNumber()===t[r].getRowNumber())for(var n=1;n<=this.barcodeColumnCount;n++){var s=this.detectionResultColumns[n].getCodewords()[r];null!=s&&(s.setRowNumber(e[r].getRowNumber()),s.hasValidRowNumber()||(this.detectionResultColumns[n].getCodewords()[r]=null))}},e.prototype.adjustRowNumbersFromRRI=function(){if(null==this.detectionResultColumns[this.barcodeColumnCount+1])return 0;for(var t=0,r=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords(),n=0;n<r.length;n++)if(null!=r[n])for(var s=r[n].getRowNumber(),i=0,a=this.barcodeColumnCount+1;a>0&&i<this.ADJUST_ROW_NUMBER_SKIP;a--){var o=this.detectionResultColumns[a].getCodewords()[n];null!=o&&(i=e.adjustRowNumberIfValid(s,i,o),o.hasValidRowNumber()||t++)}return t},e.prototype.adjustRowNumbersFromLRI=function(){if(null==this.detectionResultColumns[0])return 0;for(var t=0,r=this.detectionResultColumns[0].getCodewords(),n=0;n<r.length;n++)if(null!=r[n])for(var s=r[n].getRowNumber(),i=0,a=1;a<this.barcodeColumnCount+1&&i<this.ADJUST_ROW_NUMBER_SKIP;a++){var o=this.detectionResultColumns[a].getCodewords()[n];null!=o&&(i=e.adjustRowNumberIfValid(s,i,o),o.hasValidRowNumber()||t++)}return t},e.adjustRowNumberIfValid=function(e,t,r){return null==r||r.hasValidRowNumber()||(r.isValidRowNumber(e)?(r.setRowNumber(e),t=0):++t),t},e.prototype.adjustRowNumbers=function(t,r,n){var s,i;if(null!=this.detectionResultColumns[t-1]){var a=n[r],o=this.detectionResultColumns[t-1].getCodewords(),l=o;null!=this.detectionResultColumns[t+1]&&(l=this.detectionResultColumns[t+1].getCodewords());var c=new Array(14);c[2]=o[r],c[3]=l[r],r>0&&(c[0]=n[r-1],c[4]=o[r-1],c[5]=l[r-1]),r>1&&(c[8]=n[r-2],c[10]=o[r-2],c[11]=l[r-2]),r<n.length-1&&(c[1]=n[r+1],c[6]=o[r+1],c[7]=l[r+1]),r<n.length-2&&(c[9]=n[r+2],c[12]=o[r+2],c[13]=l[r+2]);try{for(var d=Ja(c),u=d.next();!u.done;u=d.next()){var h=u.value;if(e.adjustRowNumber(a,h))return}}catch(f){s={error:f}}finally{try{u&&!u.done&&(i=d.return)&&i.call(d)}finally{if(s)throw s.error}}}},e.adjustRowNumber=function(e,t){return null!=t&&(!(!t.hasValidRowNumber()||t.getBucket()!==e.getBucket())&&(e.setRowNumber(t.getRowNumber()),!0))},e.prototype.getBarcodeColumnCount=function(){return this.barcodeColumnCount},e.prototype.getBarcodeRowCount=function(){return this.barcodeMetadata.getRowCount()},e.prototype.getBarcodeECLevel=function(){return this.barcodeMetadata.getErrorCorrectionLevel()},e.prototype.setBoundingBox=function(e){this.boundingBox=e},e.prototype.getBoundingBox=function(){return this.boundingBox},e.prototype.setDetectionResultColumn=function(e,t){this.detectionResultColumns[e]=t},e.prototype.getDetectionResultColumn=function(e){return this.detectionResultColumns[e]},e.prototype.toString=function(){var e=this.detectionResultColumns[0];null==e&&(e=this.detectionResultColumns[this.barcodeColumnCount+1]);for(var t=new Wa,r=0;r<e.getCodewords().length;r++){t.format("CW %3d:",r);for(var n=0;n<this.barcodeColumnCount+2;n++)if(null!=this.detectionResultColumns[n]){var s=this.detectionResultColumns[n].getCodewords()[r];null!=s?t.format(" %3d|%3d",s.getRowNumber(),s.getValue()):t.format("    |   ")}else t.format("    |   ");t.format("%n")}return t.toString()},e}(),to=function(){function e(t,r,n,s){this.rowNumber=e.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(t),this.endX=Math.trunc(r),this.bucket=Math.trunc(n),this.value=Math.trunc(s)}return e.prototype.hasValidRowNumber=function(){return this.isValidRowNumber(this.rowNumber)},e.prototype.isValidRowNumber=function(t){return t!==e.BARCODE_ROW_UNKNOWN&&this.bucket===t%3*3},e.prototype.setRowNumberAsRowIndicatorColumn=function(){this.rowNumber=Math.trunc(3*Math.trunc(this.value/30)+Math.trunc(this.bucket/3))},e.prototype.getWidth=function(){return this.endX-this.startX},e.prototype.getStartX=function(){return this.startX},e.prototype.getEndX=function(){return this.endX},e.prototype.getBucket=function(){return this.bucket},e.prototype.getValue=function(){return this.value},e.prototype.getRowNumber=function(){return this.rowNumber},e.prototype.setRowNumber=function(e){this.rowNumber=e},e.prototype.toString=function(){return this.rowNumber+"|"+this.value},e.BARCODE_ROW_UNKNOWN=-1,e}(),ro=function(){function e(){}return e.initialize=function(){for(var t=0;t<Da.SYMBOL_TABLE.length;t++)for(var r=Da.SYMBOL_TABLE[t],n=1&r,s=0;s<Da.BARS_IN_MODULE;s++){for(var i=0;(1&r)===n;)i+=1,r>>=1;n=1&r,e.RATIOS_TABLE[t]||(e.RATIOS_TABLE[t]=new Array(Da.BARS_IN_MODULE)),e.RATIOS_TABLE[t][Da.BARS_IN_MODULE-s-1]=Math.fround(i/Da.MODULES_IN_CODEWORD)}this.bSymbolTableReady=!0},e.getDecodedValue=function(t){var r=e.getDecodedCodewordValue(e.sampleBitCounts(t));return-1!==r?r:e.getClosestDecodedValue(t)},e.sampleBitCounts=function(e){for(var t=kn.sum(e),r=new Int32Array(Da.BARS_IN_MODULE),n=0,s=0,i=0;i<Da.MODULES_IN_CODEWORD;i++){var a=t/(2*Da.MODULES_IN_CODEWORD)+i*t/Da.MODULES_IN_CODEWORD;s+e[n]<=a&&(s+=e[n],n++),r[n]++}return r},e.getDecodedCodewordValue=function(t){var r=e.getBitValue(t);return-1===Da.getCodeword(r)?-1:r},e.getBitValue=function(e){for(var t=0,r=0;r<e.length;r++)for(var n=0;n<e[r];n++)t=t<<1|(r%2==0?1:0);return Math.trunc(t)},e.getClosestDecodedValue=function(t){var r=kn.sum(t),n=new Array(Da.BARS_IN_MODULE);if(r>1)for(var s=0;s<n.length;s++)n[s]=Math.fround(t[s]/r);var i=Mn.MAX_VALUE,a=-1;this.bSymbolTableReady||e.initialize();for(var o=0;o<e.RATIOS_TABLE.length;o++){for(var l=0,c=e.RATIOS_TABLE[o],d=0;d<Da.BARS_IN_MODULE;d++){var u=Math.fround(c[d]-n[d]);if((l+=Math.fround(u*u))>=i)break}l<i&&(i=l,a=Da.SYMBOL_TABLE[o])}return a},e.bSymbolTableReady=!1,e.RATIOS_TABLE=new Array(Da.SYMBOL_TABLE.length).map(function(e){return new Array(Da.BARS_IN_MODULE)}),e}(),no=function(){function e(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}return e.prototype.getSegmentIndex=function(){return this.segmentIndex},e.prototype.setSegmentIndex=function(e){this.segmentIndex=e},e.prototype.getFileId=function(){return this.fileId},e.prototype.setFileId=function(e){this.fileId=e},e.prototype.getOptionalData=function(){return this.optionalData},e.prototype.setOptionalData=function(e){this.optionalData=e},e.prototype.isLastSegment=function(){return this.lastSegment},e.prototype.setLastSegment=function(e){this.lastSegment=e},e.prototype.getSegmentCount=function(){return this.segmentCount},e.prototype.setSegmentCount=function(e){this.segmentCount=e},e.prototype.getSender=function(){return this.sender||null},e.prototype.setSender=function(e){this.sender=e},e.prototype.getAddressee=function(){return this.addressee||null},e.prototype.setAddressee=function(e){this.addressee=e},e.prototype.getFileName=function(){return this.fileName},e.prototype.setFileName=function(e){this.fileName=e},e.prototype.getFileSize=function(){return this.fileSize},e.prototype.setFileSize=function(e){this.fileSize=e},e.prototype.getChecksum=function(){return this.checksum},e.prototype.setChecksum=function(e){this.checksum=e},e.prototype.getTimestamp=function(){return this.timestamp},e.prototype.setTimestamp=function(e){this.timestamp=e},e}(),so=function(){function e(){}return e.parseLong=function(e,t){return void 0===t&&(t=void 0),parseInt(e,t)},e}(),io=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ao=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return io(t,e),t.kind="NullPointerException",t}(yr),oo=function(){function e(){}return e.prototype.writeBytes=function(e){this.writeBytesOffset(e,0,e.length)},e.prototype.writeBytesOffset=function(e,t,r){if(null==e)throw new ao;if(t<0||t>e.length||r<0||t+r>e.length||t+r<0)throw new Ir;if(0!==r)for(var n=0;n<r;n++)this.write(e[t+n])},e.prototype.flush=function(){},e.prototype.close=function(){},e}(),lo=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),co=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return lo(t,e),t}(yr),uo=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ho=function(e){function t(t){void 0===t&&(t=32);var r=e.call(this)||this;if(r.count=0,t<0)throw new br("Negative initial size: "+t);return r.buf=new Uint8Array(t),r}return uo(t,e),t.prototype.ensureCapacity=function(e){e-this.buf.length>0&&this.grow(e)},t.prototype.grow=function(e){var t=this.buf.length<<1;if(t-e<0&&(t=e),t<0){if(e<0)throw new co;t=kr.MAX_VALUE}this.buf=Rr.copyOfUint8Array(this.buf,t)},t.prototype.write=function(e){this.ensureCapacity(this.count+1),this.buf[this.count]=e,this.count+=1},t.prototype.writeBytesOffset=function(e,t,r){if(t<0||t>e.length||r<0||t+r-e.length>0)throw new Ir;this.ensureCapacity(this.count+r),Sr.arraycopy(e,t,this.buf,this.count,r),this.count+=r},t.prototype.writeTo=function(e){e.writeBytesOffset(this.buf,0,this.count)},t.prototype.reset=function(){this.count=0},t.prototype.toByteArray=function(){return Rr.copyOfUint8Array(this.buf,this.count)},t.prototype.size=function(){return this.count},t.prototype.toString=function(e){return e?"string"==typeof e?this.toString_string(e):this.toString_number(e):this.toString_void()},t.prototype.toString_void=function(){return new String(this.buf).toString()},t.prototype.toString_string=function(e){return new String(this.buf).toString()},t.prototype.toString_number=function(e){return new String(this.buf).toString()},t.prototype.close=function(){},t}(oo);function fo(){if("undefined"!=typeof window)return window.BigInt||null;if("undefined"!=typeof global)return global.BigInt||null;if("undefined"!=typeof self)return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}function po(e){if(void 0===fa&&(fa=fo()),null===fa)throw new Error("BigInt is not supported!");return fa(e)}!function(e){e[e.ALPHA=0]="ALPHA",e[e.LOWER=1]="LOWER",e[e.MIXED=2]="MIXED",e[e.PUNCT=3]="PUNCT",e[e.ALPHA_SHIFT=4]="ALPHA_SHIFT",e[e.PUNCT_SHIFT=5]="PUNCT_SHIFT"}(ha||(ha={}));var mo=function(){function e(){}return e.decode=function(t,r){var n=new Kr(""),s=Wr.ISO8859_1;n.enableDecoding(s);for(var i=1,a=t[i++],o=new no;i<t[0];){switch(a){case e.TEXT_COMPACTION_MODE_LATCH:i=e.textCompaction(t,i,n);break;case e.BYTE_COMPACTION_MODE_LATCH:case e.BYTE_COMPACTION_MODE_LATCH_6:i=e.byteCompaction(a,t,s,i,n);break;case e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:n.append(t[i++]);break;case e.NUMERIC_COMPACTION_MODE_LATCH:i=e.numericCompaction(t,i,n);break;case e.ECI_CHARSET:Wr.getCharacterSetECIByValue(t[i++]);break;case e.ECI_GENERAL_PURPOSE:i+=2;break;case e.ECI_USER_DEFINED:i++;break;case e.BEGIN_MACRO_PDF417_CONTROL_BLOCK:i=e.decodeMacroBlock(t,i,o);break;case e.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case e.MACRO_PDF417_TERMINATOR:throw new Ur;default:i--,i=e.textCompaction(t,i,n)}if(!(i<t.length))throw Ur.getFormatInstance();a=t[i++]}if(0===n.length())throw Ur.getFormatInstance();var l=new _n(null,n.toString(),null,r);return l.setOther(o),l},e.decodeMacroBlock=function(t,r,n){if(r+e.NUMBER_OF_SEQUENCE_CODEWORDS>t[0])throw Ur.getFormatInstance();for(var s=new Int32Array(e.NUMBER_OF_SEQUENCE_CODEWORDS),i=0;i<e.NUMBER_OF_SEQUENCE_CODEWORDS;i++,r++)s[i]=t[r];n.setSegmentIndex(kr.parseInt(e.decodeBase900toBase10(s,e.NUMBER_OF_SEQUENCE_CODEWORDS)));var a=new Kr;r=e.textCompaction(t,r,a),n.setFileId(a.toString());var o=-1;for(t[r]===e.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(o=r+1);r<t[0];)switch(t[r]){case e.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(t[++r]){case e.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:var l=new Kr;r=e.textCompaction(t,r+1,l),n.setFileName(l.toString());break;case e.MACRO_PDF417_OPTIONAL_FIELD_SENDER:var c=new Kr;r=e.textCompaction(t,r+1,c),n.setSender(c.toString());break;case e.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:var d=new Kr;r=e.textCompaction(t,r+1,d),n.setAddressee(d.toString());break;case e.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:var u=new Kr;r=e.numericCompaction(t,r+1,u),n.setSegmentCount(kr.parseInt(u.toString()));break;case e.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:var h=new Kr;r=e.numericCompaction(t,r+1,h),n.setTimestamp(so.parseLong(h.toString()));break;case e.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:var f=new Kr;r=e.numericCompaction(t,r+1,f),n.setChecksum(kr.parseInt(f.toString()));break;case e.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:var p=new Kr;r=e.numericCompaction(t,r+1,p),n.setFileSize(so.parseLong(p.toString()));break;default:throw Ur.getFormatInstance()}break;case e.MACRO_PDF417_TERMINATOR:r++,n.setLastSegment(!0);break;default:throw Ur.getFormatInstance()}if(-1!==o){var m=r-o;n.isLastSegment()&&m--,n.setOptionalData(Rr.copyOfRange(t,o,o+m))}return r},e.textCompaction=function(t,r,n){for(var s=new Int32Array(2*(t[0]-r)),i=new Int32Array(2*(t[0]-r)),a=0,o=!1;r<t[0]&&!o;){var l=t[r++];if(l<e.TEXT_COMPACTION_MODE_LATCH)s[a]=l/30,s[a+1]=l%30,a+=2;else switch(l){case e.TEXT_COMPACTION_MODE_LATCH:s[a++]=e.TEXT_COMPACTION_MODE_LATCH;break;case e.BYTE_COMPACTION_MODE_LATCH:case e.BYTE_COMPACTION_MODE_LATCH_6:case e.NUMERIC_COMPACTION_MODE_LATCH:case e.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case e.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case e.MACRO_PDF417_TERMINATOR:r--,o=!0;break;case e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:s[a]=e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,l=t[r++],i[a]=l,a++}}return e.decodeTextCompaction(s,i,a,n),r},e.decodeTextCompaction=function(t,r,n,s){for(var i=ha.ALPHA,a=ha.ALPHA,o=0;o<n;){var l=t[o],c="";switch(i){case ha.ALPHA:if(l<26)c=String.fromCharCode(65+l);else switch(l){case 26:c=" ";break;case e.LL:i=ha.LOWER;break;case e.ML:i=ha.MIXED;break;case e.PS:a=i,i=ha.PUNCT_SHIFT;break;case e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:s.append(r[o]);break;case e.TEXT_COMPACTION_MODE_LATCH:i=ha.ALPHA}break;case ha.LOWER:if(l<26)c=String.fromCharCode(97+l);else switch(l){case 26:c=" ";break;case e.AS:a=i,i=ha.ALPHA_SHIFT;break;case e.ML:i=ha.MIXED;break;case e.PS:a=i,i=ha.PUNCT_SHIFT;break;case e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:s.append(r[o]);break;case e.TEXT_COMPACTION_MODE_LATCH:i=ha.ALPHA}break;case ha.MIXED:if(l<e.PL)c=e.MIXED_CHARS[l];else switch(l){case e.PL:i=ha.PUNCT;break;case 26:c=" ";break;case e.LL:i=ha.LOWER;break;case e.AL:i=ha.ALPHA;break;case e.PS:a=i,i=ha.PUNCT_SHIFT;break;case e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:s.append(r[o]);break;case e.TEXT_COMPACTION_MODE_LATCH:i=ha.ALPHA}break;case ha.PUNCT:if(l<e.PAL)c=e.PUNCT_CHARS[l];else switch(l){case e.PAL:i=ha.ALPHA;break;case e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:s.append(r[o]);break;case e.TEXT_COMPACTION_MODE_LATCH:i=ha.ALPHA}break;case ha.ALPHA_SHIFT:if(i=a,l<26)c=String.fromCharCode(65+l);else switch(l){case 26:c=" ";break;case e.TEXT_COMPACTION_MODE_LATCH:i=ha.ALPHA}break;case ha.PUNCT_SHIFT:if(i=a,l<e.PAL)c=e.PUNCT_CHARS[l];else switch(l){case e.PAL:i=ha.ALPHA;break;case e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:s.append(r[o]);break;case e.TEXT_COMPACTION_MODE_LATCH:i=ha.ALPHA}}""!==c&&s.append(c),o++}},e.byteCompaction=function(t,r,n,s,i){var a=new ho,o=0,l=0,c=!1;switch(t){case e.BYTE_COMPACTION_MODE_LATCH:for(var d=new Int32Array(6),u=r[s++];s<r[0]&&!c;)switch(d[o++]=u,l=900*l+u,u=r[s++]){case e.TEXT_COMPACTION_MODE_LATCH:case e.BYTE_COMPACTION_MODE_LATCH:case e.NUMERIC_COMPACTION_MODE_LATCH:case e.BYTE_COMPACTION_MODE_LATCH_6:case e.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case e.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case e.MACRO_PDF417_TERMINATOR:s--,c=!0;break;default:if(o%5==0&&o>0){for(var h=0;h<6;++h)a.write(Number(po(l)>>po(8*(5-h))));l=0,o=0}}s===r[0]&&u<e.TEXT_COMPACTION_MODE_LATCH&&(d[o++]=u);for(var f=0;f<o;f++)a.write(d[f]);break;case e.BYTE_COMPACTION_MODE_LATCH_6:for(;s<r[0]&&!c;){var p=r[s++];if(p<e.TEXT_COMPACTION_MODE_LATCH)o++,l=900*l+p;else switch(p){case e.TEXT_COMPACTION_MODE_LATCH:case e.BYTE_COMPACTION_MODE_LATCH:case e.NUMERIC_COMPACTION_MODE_LATCH:case e.BYTE_COMPACTION_MODE_LATCH_6:case e.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case e.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case e.MACRO_PDF417_TERMINATOR:s--,c=!0}if(o%5==0&&o>0){for(h=0;h<6;++h)a.write(Number(po(l)>>po(8*(5-h))));l=0,o=0}}}return i.append(Yr.decode(a.toByteArray(),n)),s},e.numericCompaction=function(t,r,n){for(var s=0,i=!1,a=new Int32Array(e.MAX_NUMERIC_CODEWORDS);r<t[0]&&!i;){var o=t[r++];if(r===t[0]&&(i=!0),o<e.TEXT_COMPACTION_MODE_LATCH)a[s]=o,s++;else switch(o){case e.TEXT_COMPACTION_MODE_LATCH:case e.BYTE_COMPACTION_MODE_LATCH:case e.BYTE_COMPACTION_MODE_LATCH_6:case e.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case e.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case e.MACRO_PDF417_TERMINATOR:r--,i=!0}(s%e.MAX_NUMERIC_CODEWORDS===0||o===e.NUMERIC_COMPACTION_MODE_LATCH||i)&&s>0&&(n.append(e.decodeBase900toBase10(a,s)),s=0)}return r},e.decodeBase900toBase10=function(t,r){for(var n=po(0),s=0;s<r;s++)n+=e.EXP900[r-s-1]*po(t[s]);var i=n.toString();if("1"!==i.charAt(0))throw new Ur;return i.substring(1)},e.TEXT_COMPACTION_MODE_LATCH=900,e.BYTE_COMPACTION_MODE_LATCH=901,e.NUMERIC_COMPACTION_MODE_LATCH=902,e.BYTE_COMPACTION_MODE_LATCH_6=924,e.ECI_USER_DEFINED=925,e.ECI_GENERAL_PURPOSE=926,e.ECI_CHARSET=927,e.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,e.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,e.MACRO_PDF417_TERMINATOR=922,e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,e.MAX_NUMERIC_CODEWORDS=15,e.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,e.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,e.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,e.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,e.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,e.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,e.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,e.PL=25,e.LL=27,e.AS=27,e.ML=28,e.AL=28,e.PS=29,e.PAL=29,e.PUNCT_CHARS=";<>@[\\]_`~!\r\t,:\n-.$/\"|*()?{}'",e.MIXED_CHARS="0123456789&\r\t,:#-.$/+%*=^",e.EXP900=fo()?function(){var e=[];e[0]=po(1);var t=po(900);e[1]=t;for(var r=2;r<16;r++)e[r]=e[r-1]*t;return e}():[],e.NUMBER_OF_SEQUENCE_CODEWORDS=2,e}(),go=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},xo=function(){function e(){}return e.decode=function(t,r,n,s,i,a,o){for(var l,c=new Ha(t,r,n,s,i),d=null,u=null,h=!0;;h=!1){if(null!=r&&(d=e.getRowIndicatorColumn(t,c,r,!0,a,o)),null!=s&&(u=e.getRowIndicatorColumn(t,c,s,!1,a,o)),null==(l=e.merge(d,u)))throw Qr.getNotFoundInstance();var f=l.getBoundingBox();if(!h||null==f||!(f.getMinY()<c.getMinY()||f.getMaxY()>c.getMaxY()))break;c=f}l.setBoundingBox(c);var p=l.getBarcodeColumnCount()+1;l.setDetectionResultColumn(0,d),l.setDetectionResultColumn(p,u);for(var m=null!=d,g=1;g<=p;g++){var x=m?g:p-g;if(void 0===l.getDetectionResultColumn(x)){var y=void 0;y=0===x||x===p?new Qa(c,0===x):new Xa(c),l.setDetectionResultColumn(x,y);for(var v=-1,w=v,_=c.getMinY();_<=c.getMaxY();_++){if((v=e.getStartColumn(l,x,_,m))<0||v>c.getMaxX()){if(-1===w)continue;v=w}var b=e.detectCodeword(t,c.getMinX(),c.getMaxX(),m,v,_,a,o);null!=b&&(y.setCodeword(_,b),w=v,a=Math.min(a,b.getWidth()),o=Math.max(o,b.getWidth()))}}}return e.createDecoderResult(l)},e.merge=function(t,r){if(null==t&&null==r)return null;var n=e.getBarcodeMetadata(t,r);if(null==n)return null;var s=Ha.merge(e.adjustBoundingBox(t),e.adjustBoundingBox(r));return new eo(n,s)},e.adjustBoundingBox=function(t){var r,n;if(null==t)return null;var s=t.getRowHeights();if(null==s)return null;var i=e.getMax(s),a=0;try{for(var o=go(s),l=o.next();!l.done;l=o.next()){var c=l.value;if(a+=i-c,c>0)break}}catch(f){r={error:f}}finally{try{l&&!l.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}for(var d=t.getCodewords(),u=0;a>0&&null==d[u];u++)a--;var h=0;for(u=s.length-1;u>=0&&(h+=i-s[u],!(s[u]>0));u--);for(u=d.length-1;h>0&&null==d[u];u--)h--;return t.getBoundingBox().addMissingRows(a,h,t.isLeft())},e.getMax=function(e){var t,r,n=-1;try{for(var s=go(e),i=s.next();!i.done;i=s.next()){var a=i.value;n=Math.max(n,a)}}catch(o){t={error:o}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return n},e.getBarcodeMetadata=function(e,t){var r,n;return null==e||null==(r=e.getBarcodeMetadata())?null==t?null:t.getBarcodeMetadata():null==t||null==(n=t.getBarcodeMetadata())?r:r.getColumnCount()!==n.getColumnCount()&&r.getErrorCorrectionLevel()!==n.getErrorCorrectionLevel()&&r.getRowCount()!==n.getRowCount()?null:r},e.getRowIndicatorColumn=function(t,r,n,s,i,a){for(var o=new Qa(r,s),l=0;l<2;l++)for(var c=0===l?1:-1,d=Math.trunc(Math.trunc(n.getX())),u=Math.trunc(Math.trunc(n.getY()));u<=r.getMaxY()&&u>=r.getMinY();u+=c){var h=e.detectCodeword(t,0,t.getWidth(),s,d,u,i,a);null!=h&&(o.setCodeword(u,h),d=s?h.getStartX():h.getEndX())}return o},e.adjustCodewordCount=function(t,r){var n=r[0][1],s=n.getValue(),i=t.getBarcodeColumnCount()*t.getBarcodeRowCount()-e.getNumberOfECCodeWords(t.getBarcodeECLevel());if(0===s.length){if(i<1||i>Da.MAX_CODEWORDS_IN_BARCODE)throw Qr.getNotFoundInstance();n.setValue(i)}else s[0]!==i&&n.setValue(i)},e.createDecoderResult=function(t){var r=e.createBarcodeMatrix(t);e.adjustCodewordCount(t,r);for(var n=new Array,s=new Int32Array(t.getBarcodeRowCount()*t.getBarcodeColumnCount()),i=[],a=new Array,o=0;o<t.getBarcodeRowCount();o++)for(var l=0;l<t.getBarcodeColumnCount();l++){var c=r[o][l+1].getValue(),d=o*t.getBarcodeColumnCount()+l;0===c.length?n.push(d):1===c.length?s[d]=c[0]:(a.push(d),i.push(c))}for(var u=new Array(i.length),h=0;h<u.length;h++)u[h]=i[h];return e.createDecoderResultFromAmbiguousValues(t.getBarcodeECLevel(),s,Da.toIntArray(n),Da.toIntArray(a),u)},e.createDecoderResultFromAmbiguousValues=function(t,r,n,s,i){for(var a=new Int32Array(s.length),o=100;o-- >0;){for(var l=0;l<a.length;l++)r[s[l]]=i[l][a[l]];try{return e.decodeCodewords(r,t,n)}catch(c){if(!(c instanceof Cr))throw c}if(0===a.length)throw Cr.getChecksumInstance();for(l=0;l<a.length;l++){if(a[l]<i[l].length-1){a[l]++;break}if(a[l]=0,l===a.length-1)throw Cr.getChecksumInstance()}}throw Cr.getChecksumInstance()},e.createBarcodeMatrix=function(e){for(var t,r,n,s,i=Array.from({length:e.getBarcodeRowCount()},function(){return new Array(e.getBarcodeColumnCount()+2)}),a=0;a<i.length;a++)for(var o=0;o<i[a].length;o++)i[a][o]=new Ka;var l=0;try{for(var c=go(e.getDetectionResultColumns()),d=c.next();!d.done;d=c.next()){var u=d.value;if(null!=u)try{for(var h=(n=void 0,go(u.getCodewords())),f=h.next();!f.done;f=h.next()){var p=f.value;if(null!=p){var m=p.getRowNumber();if(m>=0){if(m>=i.length)continue;i[m][l].setValue(p.getValue())}}}}catch(g){n={error:g}}finally{try{f&&!f.done&&(s=h.return)&&s.call(h)}finally{if(n)throw n.error}}l++}}catch(x){t={error:x}}finally{try{d&&!d.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}return i},e.isValidBarcodeColumn=function(e,t){return t>=0&&t<=e.getBarcodeColumnCount()+1},e.getStartColumn=function(t,r,n,s){var i,a,o=s?1:-1,l=null;if(e.isValidBarcodeColumn(t,r-o)&&(l=t.getDetectionResultColumn(r-o).getCodeword(n)),null!=l)return s?l.getEndX():l.getStartX();if(null!=(l=t.getDetectionResultColumn(r).getCodewordNearby(n)))return s?l.getStartX():l.getEndX();if(e.isValidBarcodeColumn(t,r-o)&&(l=t.getDetectionResultColumn(r-o).getCodewordNearby(n)),null!=l)return s?l.getEndX():l.getStartX();for(var c=0;e.isValidBarcodeColumn(t,r-o);){r-=o;try{for(var d=(i=void 0,go(t.getDetectionResultColumn(r).getCodewords())),u=d.next();!u.done;u=d.next()){var h=u.value;if(null!=h)return(s?h.getEndX():h.getStartX())+o*c*(h.getEndX()-h.getStartX())}}catch(f){i={error:f}}finally{try{u&&!u.done&&(a=d.return)&&a.call(d)}finally{if(i)throw i.error}}c++}return s?t.getBoundingBox().getMinX():t.getBoundingBox().getMaxX()},e.detectCodeword=function(t,r,n,s,i,a,o,l){i=e.adjustCodewordStartColumn(t,r,n,s,i,a);var c,d=e.getModuleBitCount(t,r,n,s,i,a);if(null==d)return null;var u=kn.sum(d);if(s)c=i+u;else{for(var h=0;h<d.length/2;h++){var f=d[h];d[h]=d[d.length-1-h],d[d.length-1-h]=f}i=(c=i)-u}if(!e.checkCodewordSkew(u,o,l))return null;var p=ro.getDecodedValue(d),m=Da.getCodeword(p);return-1===m?null:new to(i,c,e.getCodewordBucketNumber(p),m)},e.getModuleBitCount=function(e,t,r,n,s,i){for(var a=s,o=new Int32Array(8),l=0,c=n?1:-1,d=n;(n?a<r:a>=t)&&l<o.length;)e.get(a,i)===d?(o[l]++,a+=c):(l++,d=!d);return l===o.length||a===(n?r:t)&&l===o.length-1?o:null},e.getNumberOfECCodeWords=function(e){return 2<<e},e.adjustCodewordStartColumn=function(t,r,n,s,i,a){for(var o=i,l=s?-1:1,c=0;c<2;c++){for(;(s?o>=r:o<n)&&s===t.get(o,a);){if(Math.abs(i-o)>e.CODEWORD_SKEW_SIZE)return i;o+=l}l=-l,s=!s}return o},e.checkCodewordSkew=function(t,r,n){return r-e.CODEWORD_SKEW_SIZE<=t&&t<=n+e.CODEWORD_SKEW_SIZE},e.decodeCodewords=function(t,r,n){if(0===t.length)throw Ur.getFormatInstance();var s=1<<r+1,i=e.correctErrors(t,n,s);e.verifyCodewordCount(t,s);var a=mo.decode(t,""+r);return a.setErrorsCorrected(i),a.setErasures(n.length),a},e.correctErrors=function(t,r,n){if(null!=r&&r.length>n/2+e.MAX_ERRORS||n<0||n>e.MAX_EC_CODEWORDS)throw Cr.getChecksumInstance();return e.errorCorrection.decode(t,n,r)},e.verifyCodewordCount=function(e,t){if(e.length<4)throw Ur.getFormatInstance();var r=e[0];if(r>e.length)throw Ur.getFormatInstance();if(0===r){if(!(t<e.length))throw Ur.getFormatInstance();e[0]=e.length-t}},e.getBitCountForCodeword=function(e){for(var t=new Int32Array(8),r=0,n=t.length-1;!((1&e)!==r&&(r=1&e,--n<0));)t[n]++,e>>=1;return t},e.getCodewordBucketNumber=function(e){return e instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(e):this.getCodewordBucketNumber_number(e)},e.getCodewordBucketNumber_number=function(t){return e.getCodewordBucketNumber(e.getBitCountForCodeword(t))},e.getCodewordBucketNumber_Int32Array=function(e){return(e[0]-e[2]+e[4]-e[6]+9)%9},e.toString=function(e){for(var t=new Wa,r=0;r<e.length;r++){t.format("Row %2d: ",r);for(var n=0;n<e[r].length;n++){var s=e[r][n];0===s.getValue().length?t.format("        ",null):t.format("%4d(%2d)",s.getValue()[0],s.getConfidence(s.getValue()[0]))}t.format("%n")}return t.toString()},e.CODEWORD_SKEW_SIZE=2,e.MAX_ERRORS=3,e.MAX_EC_CODEWORDS=512,e.errorCorrection=new Va,e}(),yo=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},vo=function(){function e(){}return e.prototype.decode=function(t,r){void 0===r&&(r=null);var n=e.decode(t,r,!1);if(null==n||0===n.length||null==n[0])throw Qr.getNotFoundInstance();return n[0]},e.prototype.decodeMultiple=function(t,r){void 0===r&&(r=null);try{return e.decode(t,r,!0)}catch(n){if(n instanceof Ur||n instanceof Cr)throw Qr.getNotFoundInstance();throw n}},e.decode=function(t,r,n){var s,i,a=new Array,o=ka.detectMultiple(t,r,n);try{for(var l=yo(o.getPoints()),c=l.next();!c.done;c=l.next()){var d=c.value,u=xo.decode(o.getBits(),d[4],d[5],d[6],d[7],e.getMinCodewordWidth(d),e.getMaxCodewordWidth(d)),h=new pn(u.getText(),u.getRawBytes(),void 0,d,mn.PDF_417);h.putMetadata(yn.ERROR_CORRECTION_LEVEL,u.getECLevel());var f=u.getOther();null!=f&&h.putMetadata(yn.PDF417_EXTRA_METADATA,f),a.push(h)}}catch(p){s={error:p}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(s)throw s.error}}return a.map(function(e){return e})},e.getMaxWidth=function(e,t){return null==e||null==t?0:Math.trunc(Math.abs(e.getX()-t.getX()))},e.getMinWidth=function(e,t){return null==e||null==t?kr.MAX_VALUE:Math.trunc(Math.abs(e.getX()-t.getX()))},e.getMaxCodewordWidth=function(t){return Math.floor(Math.max(Math.max(e.getMaxWidth(t[0],t[4]),e.getMaxWidth(t[6],t[2])*Da.MODULES_IN_CODEWORD/Da.MODULES_IN_STOP_PATTERN),Math.max(e.getMaxWidth(t[1],t[5]),e.getMaxWidth(t[7],t[3])*Da.MODULES_IN_CODEWORD/Da.MODULES_IN_STOP_PATTERN)))},e.getMinCodewordWidth=function(t){return Math.floor(Math.min(Math.min(e.getMinWidth(t[0],t[4]),e.getMinWidth(t[6],t[2])*Da.MODULES_IN_CODEWORD/Da.MODULES_IN_STOP_PATTERN),Math.min(e.getMinWidth(t[1],t[5]),e.getMinWidth(t[7],t[3])*Da.MODULES_IN_CODEWORD/Da.MODULES_IN_STOP_PATTERN)))},e.prototype.reset=function(){},e}(),wo=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),_o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return wo(t,e),t.kind="ReaderException",t}(yr),bo=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},No=function(){function e(){}return e.prototype.decode=function(e,t){return this.setHints(t),this.decodeInternal(e)},e.prototype.decodeWithState=function(e){return null!==this.readers&&void 0!==this.readers||this.setHints(null),this.decodeInternal(e)},e.prototype.setHints=function(e){this.hints=e;var t=null!=e&&void 0!==e.get(Pr.TRY_HARDER),r=null==e?null:e.get(Pr.POSSIBLE_FORMATS),n=new Array;if(null!=r){var s=r.some(function(e){return e===mn.UPC_A||e===mn.UPC_E||e===mn.EAN_13||e===mn.EAN_8||e===mn.CODABAR||e===mn.CODE_39||e===mn.CODE_93||e===mn.CODE_128||e===mn.ITF||e===mn.RSS_14||e===mn.RSS_EXPANDED});s&&!t&&n.push(new Ti(e)),r.includes(mn.QR_CODE)&&n.push(new Ia),r.includes(mn.DATA_MATRIX)&&n.push(new qi),r.includes(mn.AZTEC)&&n.push(new qn),r.includes(mn.PDF_417)&&n.push(new vo),s&&t&&n.push(new Ti(e))}0===n.length&&(t||n.push(new Ti(e)),n.push(new Ia),n.push(new qi),n.push(new qn),n.push(new vo),t&&n.push(new Ti(e))),this.readers=n},e.prototype.reset=function(){var e,t;if(null!==this.readers)try{for(var r=bo(this.readers),n=r.next();!n.done;n=r.next()){n.value.reset()}}catch(s){e={error:s}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e.prototype.decodeInternal=function(e){var t,r;if(null===this.readers)throw new _o("No readers where selected, nothing can be read.");try{for(var n=bo(this.readers),s=n.next();!s.done;s=n.next()){var i=s.value;try{return i.decode(e,this.hints)}catch(a){if(a instanceof _o)continue}}}catch(o){t={error:o}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}throw new Qr("No MultiFormat Readers were able to detect the code.")},e}(),jo=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Co=function(e){function t(t,r){void 0===t&&(t=null),void 0===r&&(r=500);var n=new No;return n.setHints(t),e.call(this,n,r)||this}return jo(t,e),t.prototype.decodeBitmap=function(e){return this.reader.decodeWithState(e)},t}(fn),Ao=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();!function(e){function t(t){return void 0===t&&(t=500),e.call(this,new vo,t)||this}Ao(t,e)}(fn);var So,Eo,Io=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();!function(e){function t(t){return void 0===t&&(t=500),e.call(this,new Ia,t)||this}Io(t,e)}(fn),(Eo=So||(So={}))[Eo.ERROR_CORRECTION=0]="ERROR_CORRECTION",Eo[Eo.CHARACTER_SET=1]="CHARACTER_SET",Eo[Eo.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",Eo[Eo.DATA_MATRIX_COMPACT=3]="DATA_MATRIX_COMPACT",Eo[Eo.MIN_SIZE=4]="MIN_SIZE",Eo[Eo.MAX_SIZE=5]="MAX_SIZE",Eo[Eo.MARGIN=6]="MARGIN",Eo[Eo.PDF417_COMPACT=7]="PDF417_COMPACT",Eo[Eo.PDF417_COMPACTION=8]="PDF417_COMPACTION",Eo[Eo.PDF417_DIMENSIONS=9]="PDF417_DIMENSIONS",Eo[Eo.AZTEC_LAYERS=10]="AZTEC_LAYERS",Eo[Eo.QR_VERSION=11]="QR_VERSION",Eo[Eo.GS1_FORMAT=12]="GS1_FORMAT",Eo[Eo.FORCE_C40=13]="FORCE_C40";const To=So;var Do=function(){function e(e){this.field=e,this.cachedGenerators=[],this.cachedGenerators.push(new Nn(e,Int32Array.from([1])))}return e.prototype.buildGenerator=function(e){var t=this.cachedGenerators;if(e>=t.length)for(var r=t[t.length-1],n=this.field,s=t.length;s<=e;s++){var i=r.multiply(new Nn(n,Int32Array.from([1,n.exp(s-1+n.getGeneratorBase())])));t.push(i),r=i}return t[e]},e.prototype.encode=function(e,t){if(0===t)throw new br("No error correction bytes");var r=e.length-t;if(r<=0)throw new br("No data bytes provided");var n=this.buildGenerator(t),s=new Int32Array(r);Sr.arraycopy(e,0,s,0,r);for(var i=new Nn(this.field,s),a=(i=i.multiplyByMonomial(t,1)).divide(n)[1].getCoefficients(),o=t-a.length,l=0;l<o;l++)e[r+l]=0;Sr.arraycopy(a,0,e,r+o,a.length)},e}(),Oo=function(){function e(){}return e.applyMaskPenaltyRule1=function(t){return e.applyMaskPenaltyRule1Internal(t,!0)+e.applyMaskPenaltyRule1Internal(t,!1)},e.applyMaskPenaltyRule2=function(t){for(var r=0,n=t.getArray(),s=t.getWidth(),i=t.getHeight(),a=0;a<i-1;a++)for(var o=n[a],l=0;l<s-1;l++){var c=o[l];c===o[l+1]&&c===n[a+1][l]&&c===n[a+1][l+1]&&r++}return e.N2*r},e.applyMaskPenaltyRule3=function(t){for(var r=0,n=t.getArray(),s=t.getWidth(),i=t.getHeight(),a=0;a<i;a++)for(var o=0;o<s;o++){var l=n[a];o+6<s&&1===l[o]&&0===l[o+1]&&1===l[o+2]&&1===l[o+3]&&1===l[o+4]&&0===l[o+5]&&1===l[o+6]&&(e.isWhiteHorizontal(l,o-4,o)||e.isWhiteHorizontal(l,o+7,o+11))&&r++,a+6<i&&1===n[a][o]&&0===n[a+1][o]&&1===n[a+2][o]&&1===n[a+3][o]&&1===n[a+4][o]&&0===n[a+5][o]&&1===n[a+6][o]&&(e.isWhiteVertical(n,o,a-4,a)||e.isWhiteVertical(n,o,a+7,a+11))&&r++}return r*e.N3},e.isWhiteHorizontal=function(e,t,r){t=Math.max(t,0),r=Math.min(r,e.length);for(var n=t;n<r;n++)if(1===e[n])return!1;return!0},e.isWhiteVertical=function(e,t,r,n){r=Math.max(r,0),n=Math.min(n,e.length);for(var s=r;s<n;s++)if(1===e[s][t])return!1;return!0},e.applyMaskPenaltyRule4=function(t){for(var r=0,n=t.getArray(),s=t.getWidth(),i=t.getHeight(),a=0;a<i;a++)for(var o=n[a],l=0;l<s;l++)1===o[l]&&r++;var c=t.getHeight()*t.getWidth();return Math.floor(10*Math.abs(2*r-c)/c)*e.N4},e.getDataMaskBit=function(e,t,r){var n,s;switch(e){case 0:n=r+t&1;break;case 1:n=1&r;break;case 2:n=t%3;break;case 3:n=(r+t)%3;break;case 4:n=Math.floor(r/2)+Math.floor(t/3)&1;break;case 5:n=(1&(s=r*t))+s%3;break;case 6:n=(1&(s=r*t))+s%3&1;break;case 7:n=(s=r*t)%3+(r+t&1)&1;break;default:throw new br("Invalid mask pattern: "+e)}return 0===n},e.applyMaskPenaltyRule1Internal=function(t,r){for(var n=0,s=r?t.getHeight():t.getWidth(),i=r?t.getWidth():t.getHeight(),a=t.getArray(),o=0;o<s;o++){for(var l=0,c=-1,d=0;d<i;d++){var u=r?a[o][d]:a[d][o];u===c?l++:(l>=5&&(n+=e.N1+(l-5)),l=1,c=u)}l>=5&&(n+=e.N1+(l-5))}return n},e.N1=3,e.N2=3,e.N3=40,e.N4=10,e}(),Ro=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ko=function(){function e(e,t){this.width=e,this.height=t;for(var r=new Array(t),n=0;n!==t;n++)r[n]=new Uint8Array(e);this.bytes=r}return e.prototype.getHeight=function(){return this.height},e.prototype.getWidth=function(){return this.width},e.prototype.get=function(e,t){return this.bytes[t][e]},e.prototype.getArray=function(){return this.bytes},e.prototype.setNumber=function(e,t,r){this.bytes[t][e]=r},e.prototype.setBoolean=function(e,t,r){this.bytes[t][e]=r?1:0},e.prototype.clear=function(e){var t,r;try{for(var n=Ro(this.bytes),s=n.next();!s.done;s=n.next()){var i=s.value;Rr.fill(i,e)}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},e.prototype.equals=function(t){if(!(t instanceof e))return!1;var r=t;if(this.width!==r.width)return!1;if(this.height!==r.height)return!1;for(var n=0,s=this.height;n<s;++n)for(var i=this.bytes[n],a=r.bytes[n],o=0,l=this.width;o<l;++o)if(i[o]!==a[o])return!1;return!0},e.prototype.toString=function(){for(var e=new Kr,t=0,r=this.height;t<r;++t){for(var n=this.bytes[t],s=0,i=this.width;s<i;++s)switch(n[s]){case 0:e.append(" 0");break;case 1:e.append(" 1");break;default:e.append("  ")}e.append("\n")}return e.toString()},e}(),Mo=function(){function e(){this.maskPattern=-1}return e.prototype.getMode=function(){return this.mode},e.prototype.getECLevel=function(){return this.ecLevel},e.prototype.getVersion=function(){return this.version},e.prototype.getMaskPattern=function(){return this.maskPattern},e.prototype.getMatrix=function(){return this.matrix},e.prototype.toString=function(){var e=new Kr;return e.append("<<\n"),e.append(" mode: "),e.append(this.mode?this.mode.toString():"null"),e.append("\n ecLevel: "),e.append(this.ecLevel?this.ecLevel.toString():"null"),e.append("\n version: "),e.append(this.version?this.version.toString():"null"),e.append("\n maskPattern: "),e.append(this.maskPattern.toString()),this.matrix?(e.append("\n matrix:\n"),e.append(this.matrix.toString())):e.append("\n matrix: null\n"),e.append(">>\n"),e.toString()},e.prototype.setMode=function(e){this.mode=e},e.prototype.setECLevel=function(e){this.ecLevel=e},e.prototype.setVersion=function(e){this.version=e},e.prototype.setMaskPattern=function(e){this.maskPattern=e},e.prototype.setMatrix=function(e){this.matrix=e},e.isValidMaskPattern=function(t){return t>=0&&t<e.NUM_MASK_PATTERNS},e.NUM_MASK_PATTERNS=8,e}(),Po=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Bo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Po(t,e),t.kind="WriterException",t}(yr),Fo=function(){function e(){}return e.clearMatrix=function(e){e.clear(255)},e.buildMatrix=function(t,r,n,s,i){e.clearMatrix(i),e.embedBasicPatterns(n,i),e.embedTypeInfo(r,s,i),e.maybeEmbedVersionInfo(n,i),e.embedDataBits(t,s,i)},e.embedBasicPatterns=function(t,r){e.embedPositionDetectionPatternsAndSeparators(r),e.embedDarkDotAtLeftBottomCorner(r),e.maybeEmbedPositionAdjustmentPatterns(t,r),e.embedTimingPatterns(r)},e.embedTypeInfo=function(t,r,n){var s=new Mr;e.makeTypeInfoBits(t,r,s);for(var i=0,a=s.getSize();i<a;++i){var o=s.get(s.getSize()-1-i),l=e.TYPE_INFO_COORDINATES[i],c=l[0],d=l[1];if(n.setBoolean(c,d,o),i<8){var u=n.getWidth()-i-1,h=8;n.setBoolean(u,h,o)}else{u=8,h=n.getHeight()-7+(i-8);n.setBoolean(u,h,o)}}},e.maybeEmbedVersionInfo=function(t,r){if(!(t.getVersionNumber()<7)){var n=new Mr;e.makeVersionInfoBits(t,n);for(var s=17,i=0;i<6;++i)for(var a=0;a<3;++a){var o=n.get(s);s--,r.setBoolean(i,r.getHeight()-11+a,o),r.setBoolean(r.getHeight()-11+a,i,o)}}},e.embedDataBits=function(t,r,n){for(var s=0,i=-1,a=n.getWidth()-1,o=n.getHeight()-1;a>0;){for(6===a&&(a-=1);o>=0&&o<n.getHeight();){for(var l=0;l<2;++l){var c=a-l;if(e.isEmpty(n.get(c,o))){var d=void 0;s<t.getSize()?(d=t.get(s),++s):d=!1,255!==r&&Oo.getDataMaskBit(r,c,o)&&(d=!d),n.setBoolean(c,o,d)}}o+=i}o+=i=-i,a-=2}if(s!==t.getSize())throw new Bo("Not all bits consumed: "+s+"/"+t.getSize())},e.findMSBSet=function(e){return 32-kr.numberOfLeadingZeros(e)},e.calculateBCHCode=function(t,r){if(0===r)throw new br("0 polynomial");var n=e.findMSBSet(r);for(t<<=n-1;e.findMSBSet(t)>=n;)t^=r<<e.findMSBSet(t)-n;return t},e.makeTypeInfoBits=function(t,r,n){if(!Mo.isValidMaskPattern(r))throw new Bo("Invalid mask pattern");var s=t.getBits()<<3|r;n.appendBits(s,5);var i=e.calculateBCHCode(s,e.TYPE_INFO_POLY);n.appendBits(i,10);var a=new Mr;if(a.appendBits(e.TYPE_INFO_MASK_PATTERN,15),n.xor(a),15!==n.getSize())throw new Bo("should not happen but we got: "+n.getSize())},e.makeVersionInfoBits=function(t,r){r.appendBits(t.getVersionNumber(),6);var n=e.calculateBCHCode(t.getVersionNumber(),e.VERSION_INFO_POLY);if(r.appendBits(n,12),18!==r.getSize())throw new Bo("should not happen but we got: "+r.getSize())},e.isEmpty=function(e){return 255===e},e.embedTimingPatterns=function(t){for(var r=8;r<t.getWidth()-8;++r){var n=(r+1)%2;e.isEmpty(t.get(r,6))&&t.setNumber(r,6,n),e.isEmpty(t.get(6,r))&&t.setNumber(6,r,n)}},e.embedDarkDotAtLeftBottomCorner=function(e){if(0===e.get(8,e.getHeight()-8))throw new Bo;e.setNumber(8,e.getHeight()-8,1)},e.embedHorizontalSeparationPattern=function(t,r,n){for(var s=0;s<8;++s){if(!e.isEmpty(n.get(t+s,r)))throw new Bo;n.setNumber(t+s,r,0)}},e.embedVerticalSeparationPattern=function(t,r,n){for(var s=0;s<7;++s){if(!e.isEmpty(n.get(t,r+s)))throw new Bo;n.setNumber(t,r+s,0)}},e.embedPositionAdjustmentPattern=function(t,r,n){for(var s=0;s<5;++s)for(var i=e.POSITION_ADJUSTMENT_PATTERN[s],a=0;a<5;++a)n.setNumber(t+a,r+s,i[a])},e.embedPositionDetectionPattern=function(t,r,n){for(var s=0;s<7;++s)for(var i=e.POSITION_DETECTION_PATTERN[s],a=0;a<7;++a)n.setNumber(t+a,r+s,i[a])},e.embedPositionDetectionPatternsAndSeparators=function(t){var r=e.POSITION_DETECTION_PATTERN[0].length;e.embedPositionDetectionPattern(0,0,t),e.embedPositionDetectionPattern(t.getWidth()-r,0,t),e.embedPositionDetectionPattern(0,t.getWidth()-r,t);e.embedHorizontalSeparationPattern(0,7,t),e.embedHorizontalSeparationPattern(t.getWidth()-8,7,t),e.embedHorizontalSeparationPattern(0,t.getWidth()-8,t);e.embedVerticalSeparationPattern(7,0,t),e.embedVerticalSeparationPattern(t.getHeight()-7-1,0,t),e.embedVerticalSeparationPattern(7,t.getHeight()-7,t)},e.maybeEmbedPositionAdjustmentPatterns=function(t,r){if(!(t.getVersionNumber()<2))for(var n=t.getVersionNumber()-1,s=e.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[n],i=0,a=s.length;i!==a;i++){var o=s[i];if(o>=0)for(var l=0;l!==a;l++){var c=s[l];c>=0&&e.isEmpty(r.get(c,o))&&e.embedPositionAdjustmentPattern(c-2,o-2,r)}}},e.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),e.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),e.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),e.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),e.VERSION_INFO_POLY=7973,e.TYPE_INFO_POLY=1335,e.TYPE_INFO_MASK_PATTERN=21522,e}(),Lo=function(){function e(e,t){this.dataBytes=e,this.errorCorrectionBytes=t}return e.prototype.getDataBytes=function(){return this.dataBytes},e.prototype.getErrorCorrectionBytes=function(){return this.errorCorrectionBytes},e}(),Uo=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};!function(){function e(){}e.calculateMaskPenalty=function(e){return Oo.applyMaskPenaltyRule1(e)+Oo.applyMaskPenaltyRule2(e)+Oo.applyMaskPenaltyRule3(e)+Oo.applyMaskPenaltyRule4(e)},e.encode=function(t,r,n){void 0===n&&(n=null);var s=e.DEFAULT_BYTE_MODE_ENCODING,i=null!==n&&void 0!==n.get(To.CHARACTER_SET);i&&(s=n.get(To.CHARACTER_SET).toString());var a=this.chooseMode(t,s),o=new Mr;if(a===pa.BYTE&&(i||e.DEFAULT_BYTE_MODE_ENCODING!==s)){var l=Wr.getCharacterSetECIByName(s);void 0!==l&&this.appendECI(l,o)}this.appendModeInfo(a,o);var c,d=new Mr;if(this.appendBytes(t,a,d,s),null!==n&&void 0!==n.get(To.QR_VERSION)){var u=Number.parseInt(n.get(To.QR_VERSION).toString(),10);c=ia.getVersionForNumber(u);var h=this.calculateBitsNeeded(a,o,d,c);if(!this.willFit(h,c,r))throw new Bo("Data too big for requested version")}else c=this.recommendVersion(r,a,o,d);var f=new Mr;f.appendBitArray(o);var p=a===pa.BYTE?d.getSizeInBytes():t.length;this.appendLengthInfo(p,c,a,f),f.appendBitArray(d);var m=c.getECBlocksForLevel(r),g=c.getTotalCodewords()-m.getTotalECCodewords();this.terminateBits(g,f);var x=this.interleaveWithECBytes(f,c.getTotalCodewords(),g,m.getNumBlocks()),y=new Mo;y.setECLevel(r),y.setMode(a),y.setVersion(c);var v=c.getDimensionForVersion(),w=new ko(v,v),_=this.chooseMaskPattern(x,r,c,w);return y.setMaskPattern(_),Fo.buildMatrix(x,r,c,_,w),y.setMatrix(w),y},e.recommendVersion=function(e,t,r,n){var s=this.calculateBitsNeeded(t,r,n,ia.getVersionForNumber(1)),i=this.chooseVersion(s,e),a=this.calculateBitsNeeded(t,r,n,i);return this.chooseVersion(a,e)},e.calculateBitsNeeded=function(e,t,r,n){return t.getSize()+e.getCharacterCountBits(n)+r.getSize()},e.getAlphanumericCode=function(t){return t<e.ALPHANUMERIC_TABLE.length?e.ALPHANUMERIC_TABLE[t]:-1},e.chooseMode=function(t,r){if(void 0===r&&(r=null),Wr.SJIS.getName()===r&&this.isOnlyDoubleByteKanji(t))return pa.KANJI;for(var n=!1,s=!1,i=0,a=t.length;i<a;++i){var o=t.charAt(i);if(e.isDigit(o))n=!0;else{if(-1===this.getAlphanumericCode(o.charCodeAt(0)))return pa.BYTE;s=!0}}return s?pa.ALPHANUMERIC:n?pa.NUMERIC:pa.BYTE},e.isOnlyDoubleByteKanji=function(e){var t;try{t=Yr.encode(e,Wr.SJIS)}catch(i){return!1}var r=t.length;if(r%2!=0)return!1;for(var n=0;n<r;n+=2){var s=255&t[n];if((s<129||s>159)&&(s<224||s>235))return!1}return!0},e.chooseMaskPattern=function(e,t,r,n){for(var s=Number.MAX_SAFE_INTEGER,i=-1,a=0;a<Mo.NUM_MASK_PATTERNS;a++){Fo.buildMatrix(e,t,r,a,n);var o=this.calculateMaskPenalty(n);o<s&&(s=o,i=a)}return i},e.chooseVersion=function(t,r){for(var n=1;n<=40;n++){var s=ia.getVersionForNumber(n);if(e.willFit(t,s,r))return s}throw new Bo("Data too big")},e.willFit=function(e,t,r){return t.getTotalCodewords()-t.getECBlocksForLevel(r).getTotalECCodewords()>=(e+7)/8},e.terminateBits=function(e,t){var r=8*e;if(t.getSize()>r)throw new Bo("data bits cannot fit in the QR Code"+t.getSize()+" > "+r);for(var n=0;n<4&&t.getSize()<r;++n)t.appendBit(!1);var s=7&t.getSize();if(s>0)for(n=s;n<8;n++)t.appendBit(!1);var i=e-t.getSizeInBytes();for(n=0;n<i;++n)t.appendBits(1&n?17:236,8);if(t.getSize()!==r)throw new Bo("Bits size does not equal capacity")},e.getNumDataBytesAndNumECBytesForBlockID=function(e,t,r,n,s,i){if(n>=r)throw new Bo("Block ID too large");var a=e%r,o=r-a,l=Math.floor(e/r),c=l+1,d=Math.floor(t/r),u=d+1,h=l-d,f=c-u;if(h!==f)throw new Bo("EC bytes mismatch");if(r!==o+a)throw new Bo("RS blocks mismatch");if(e!==(d+h)*o+(u+f)*a)throw new Bo("Total bytes mismatch");n<o?(s[0]=d,i[0]=h):(s[0]=u,i[0]=f)},e.interleaveWithECBytes=function(t,r,n,s){var i,a,o,l;if(t.getSizeInBytes()!==n)throw new Bo("Number of bits and data bytes does not match");for(var c=0,d=0,u=0,h=new Array,f=0;f<s;++f){var p=new Int32Array(1),m=new Int32Array(1);e.getNumDataBytesAndNumECBytesForBlockID(r,n,s,f,p,m);var g=p[0],x=new Uint8Array(g);t.toBytes(8*c,x,0,g);var y=e.generateECBytes(x,m[0]);h.push(new Lo(x,y)),d=Math.max(d,g),u=Math.max(u,y.length),c+=p[0]}if(n!==c)throw new Bo("Data bytes does not match offset");var v=new Mr;for(f=0;f<d;++f)try{for(var w=(i=void 0,Uo(h)),_=w.next();!_.done;_=w.next()){f<(x=_.value.getDataBytes()).length&&v.appendBits(x[f],8)}}catch(j){i={error:j}}finally{try{_&&!_.done&&(a=w.return)&&a.call(w)}finally{if(i)throw i.error}}for(f=0;f<u;++f)try{for(var b=(o=void 0,Uo(h)),N=b.next();!N.done;N=b.next()){f<(y=N.value.getErrorCorrectionBytes()).length&&v.appendBits(y[f],8)}}catch(C){o={error:C}}finally{try{N&&!N.done&&(l=b.return)&&l.call(b)}finally{if(o)throw o.error}}if(r!==v.getSizeInBytes())throw new Bo("Interleaving error: "+r+" and "+v.getSizeInBytes()+" differ.");return v},e.generateECBytes=function(e,t){for(var r=e.length,n=new Int32Array(r+t),s=0;s<r;s++)n[s]=255&e[s];new Do(Sn.QR_CODE_FIELD_256).encode(n,t);var i=new Uint8Array(t);for(s=0;s<t;s++)i[s]=n[r+s];return i},e.appendModeInfo=function(e,t){t.appendBits(e.getBits(),4)},e.appendLengthInfo=function(e,t,r,n){var s=r.getCharacterCountBits(t);if(e>=1<<s)throw new Bo(e+" is bigger than "+((1<<s)-1));n.appendBits(e,s)},e.appendBytes=function(t,r,n,s){switch(r){case pa.NUMERIC:e.appendNumericBytes(t,n);break;case pa.ALPHANUMERIC:e.appendAlphanumericBytes(t,n);break;case pa.BYTE:e.append8BitBytes(t,n,s);break;case pa.KANJI:e.appendKanjiBytes(t,n);break;default:throw new Bo("Invalid mode: "+r)}},e.getDigit=function(e){return e.charCodeAt(0)-48},e.isDigit=function(t){var r=e.getDigit(t);return r>=0&&r<=9},e.appendNumericBytes=function(t,r){for(var n=t.length,s=0;s<n;){var i=e.getDigit(t.charAt(s));if(s+2<n){var a=e.getDigit(t.charAt(s+1)),o=e.getDigit(t.charAt(s+2));r.appendBits(100*i+10*a+o,10),s+=3}else if(s+1<n){a=e.getDigit(t.charAt(s+1));r.appendBits(10*i+a,7),s+=2}else r.appendBits(i,4),s++}},e.appendAlphanumericBytes=function(t,r){for(var n=t.length,s=0;s<n;){var i=e.getAlphanumericCode(t.charCodeAt(s));if(-1===i)throw new Bo;if(s+1<n){var a=e.getAlphanumericCode(t.charCodeAt(s+1));if(-1===a)throw new Bo;r.appendBits(45*i+a,11),s+=2}else r.appendBits(i,6),s++}},e.append8BitBytes=function(e,t,r){var n;try{n=Yr.encode(e,r)}catch(o){throw new Bo(o)}for(var s=0,i=n.length;s!==i;s++){var a=n[s];t.appendBits(a,8)}},e.appendKanjiBytes=function(e,t){var r;try{r=Yr.encode(e,Wr.SJIS)}catch(l){throw new Bo(l)}for(var n=r.length,s=0;s<n;s+=2){var i=(255&r[s])<<8&4294967295|255&r[s+1],a=-1;if(i>=33088&&i<=40956?a=i-33088:i>=57408&&i<=60351&&(a=i-49472),-1===a)throw new Bo("Invalid byte sequence");var o=192*(a>>8)+(255&a);t.appendBits(o,13)}},e.appendECI=function(e,t){t.appendBits(pa.ECI.getBits(),4),t.appendBits(e.getValue(),8)},e.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),e.DEFAULT_BYTE_MODE_ENCODING=Wr.UTF8.getName()}();var Vo=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();!function(e){function t(t,r,n,s,i,a,o,l){var c=e.call(this,a,o)||this;if(c.yuvData=t,c.dataWidth=r,c.dataHeight=n,c.left=s,c.top=i,s+a>r||i+o>n)throw new br("Crop rectangle does not fit within image data.");return l&&c.reverseHorizontal(a,o),c}Vo(t,e),t.prototype.getRow=function(e,t){if(e<0||e>=this.getHeight())throw new br("Requested row is outside the image: "+e);var r=this.getWidth();(null==t||t.length<r)&&(t=new Uint8ClampedArray(r));var n=(e+this.top)*this.dataWidth+this.left;return Sr.arraycopy(this.yuvData,n,t,0,r),t},t.prototype.getMatrix=function(){var e=this.getWidth(),t=this.getHeight();if(e===this.dataWidth&&t===this.dataHeight)return this.yuvData;var r=e*t,n=new Uint8ClampedArray(r),s=this.top*this.dataWidth+this.left;if(e===this.dataWidth)return Sr.arraycopy(this.yuvData,s,n,0,r),n;for(var i=0;i<t;i++){var a=i*e;Sr.arraycopy(this.yuvData,s,n,a,e),s+=this.dataWidth}return n},t.prototype.isCropSupported=function(){return!0},t.prototype.crop=function(e,r,n,s){return new t(this.yuvData,this.dataWidth,this.dataHeight,this.left+e,this.top+r,n,s,!1)},t.prototype.renderThumbnail=function(){for(var e=this.getWidth()/t.THUMBNAIL_SCALE_FACTOR,r=this.getHeight()/t.THUMBNAIL_SCALE_FACTOR,n=new Int32Array(e*r),s=this.yuvData,i=this.top*this.dataWidth+this.left,a=0;a<r;a++){for(var o=a*e,l=0;l<e;l++){var c=255&s[i+l*t.THUMBNAIL_SCALE_FACTOR];n[o+l]=4278190080|65793*c}i+=this.dataWidth*t.THUMBNAIL_SCALE_FACTOR}return n},t.prototype.getThumbnailWidth=function(){return this.getWidth()/t.THUMBNAIL_SCALE_FACTOR},t.prototype.getThumbnailHeight=function(){return this.getHeight()/t.THUMBNAIL_SCALE_FACTOR},t.prototype.reverseHorizontal=function(e,t){for(var r=this.yuvData,n=0,s=this.top*this.dataWidth+this.left;n<t;n++,s+=this.dataWidth)for(var i=s+e/2,a=s,o=s+e-1;a<i;a++,o--){var l=r[a];r[a]=r[o],r[o]=l}},t.prototype.invert=function(){return new an(this)},t.THUMBNAIL_SCALE_FACTOR=2}(nn);var Ho=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();!function(e){function t(t,r,n,s,i,a,o){var l=e.call(this,r,n)||this;if(l.dataWidth=s,l.dataHeight=i,l.left=a,l.top=o,4===t.BYTES_PER_ELEMENT){for(var c=r*n,d=new Uint8ClampedArray(c),u=0;u<c;u++){var h=t[u],f=h>>16&255,p=h>>7&510,m=255&h;d[u]=(f+p+m)/4&255}l.luminances=d}else l.luminances=t;if(void 0===s&&(l.dataWidth=r),void 0===i&&(l.dataHeight=n),void 0===a&&(l.left=0),void 0===o&&(l.top=0),l.left+r>l.dataWidth||l.top+n>l.dataHeight)throw new br("Crop rectangle does not fit within image data.");return l}Ho(t,e),t.prototype.getRow=function(e,t){if(e<0||e>=this.getHeight())throw new br("Requested row is outside the image: "+e);var r=this.getWidth();(null==t||t.length<r)&&(t=new Uint8ClampedArray(r));var n=(e+this.top)*this.dataWidth+this.left;return Sr.arraycopy(this.luminances,n,t,0,r),t},t.prototype.getMatrix=function(){var e=this.getWidth(),t=this.getHeight();if(e===this.dataWidth&&t===this.dataHeight)return this.luminances;var r=e*t,n=new Uint8ClampedArray(r),s=this.top*this.dataWidth+this.left;if(e===this.dataWidth)return Sr.arraycopy(this.luminances,s,n,0,r),n;for(var i=0;i<t;i++){var a=i*e;Sr.arraycopy(this.luminances,s,n,a,e),s+=this.dataWidth}return n},t.prototype.isCropSupported=function(){return!0},t.prototype.crop=function(e,r,n,s){return new t(this.luminances,n,s,this.dataWidth,this.dataHeight,this.left+e,this.top+r)},t.prototype.invert=function(){return new an(this)}}(nn);var Go,Wo,zo,Xo=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Yo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Xo(t,e),t.forName=function(e){return this.getCharacterSetECIByName(e)},t}(Wr),qo=function(){function e(){}return e.ISO_8859_1=Wr.ISO8859_1,e}();(Go=function(e,t){for(var r=1,n=0;n<255;n++)t[n]=r,e[r]=n,(r*=2)>=256&&(r^=301);return{LOG:e,ALOG:t}}([],[])).LOG,Go.ALOG,(zo=Wo||(Wo={}))[zo.FORCE_NONE=0]="FORCE_NONE",zo[zo.FORCE_SQUARE=1]="FORCE_SQUARE",zo[zo.FORCE_RECTANGLE=2]="FORCE_RECTANGLE";var Ko="[)>05",Zo="[)>06",$o=function(){function e(){}return e.prototype.getEncodingMode=function(){return 0},e.prototype.encode=function(e){if(ul.determineConsecutiveDigitCount(e.getMessage(),e.pos)>=2)e.writeCodeword(this.encodeASCIIDigits(e.getMessage().charCodeAt(e.pos),e.getMessage().charCodeAt(e.pos+1))),e.pos+=2;else{var t=e.getCurrentChar(),r=ul.lookAheadTest(e.getMessage(),e.pos,this.getEncodingMode());if(r!==this.getEncodingMode())switch(r){case 5:return e.writeCodeword(231),void e.signalEncoderChange(5);case 1:return e.writeCodeword(230),void e.signalEncoderChange(1);case 3:e.writeCodeword(238),e.signalEncoderChange(3);break;case 2:e.writeCodeword(239),e.signalEncoderChange(2);break;case 4:e.writeCodeword(240),e.signalEncoderChange(4);break;default:throw new Error("Illegal mode: "+r)}else ul.isExtendedASCII(t)?(e.writeCodeword(235),e.writeCodeword(t-128+1),e.pos++):(e.writeCodeword(t+1),e.pos++)}},e.prototype.encodeASCIIDigits=function(e,t){if(ul.isDigit(e)&&ul.isDigit(t))return 10*(e-48)+(t-48)+130;throw new Error("not digits: "+e+t)},e}(),Qo=function(){function e(){}return e.prototype.getEncodingMode=function(){return 5},e.prototype.encode=function(e){var t=new Kr;for(t.append(0);e.hasMoreCharacters();){var r=e.getCurrentChar();if(t.append(r),e.pos++,ul.lookAheadTest(e.getMessage(),e.pos,this.getEncodingMode())!==this.getEncodingMode()){e.signalEncoderChange(0);break}}var n=t.length()-1,s=e.getCodewordCount()+n+1;e.updateSymbolInfo(s);var i=e.getSymbolInfo().getDataCapacity()-s>0;if(e.hasMoreCharacters()||i)if(n<=249)t.setCharAt(0,qr.getCharAt(n));else{if(!(n<=1555))throw new Error("Message length not in valid ranges: "+n);t.setCharAt(0,qr.getCharAt(Math.floor(n/250)+249)),t.insert(1,qr.getCharAt(n%250))}var a=0;for(r=t.length();a<r;a++)e.writeCodeword(this.randomize255State(t.charAt(a).charCodeAt(0),e.getCodewordCount()+1))},e.prototype.randomize255State=function(e,t){var r=e+(149*t%255+1);return r<=255?r:r-256},e}(),Jo=function(){function e(){}return e.prototype.getEncodingMode=function(){return 1},e.prototype.encodeMaximal=function(e){for(var t=new Kr,r=0,n=e.pos,s=0;e.hasMoreCharacters();){var i=e.getCurrentChar();e.pos++,r=this.encodeChar(i,t),t.length()%3==0&&(n=e.pos,s=t.length())}if(s!==t.length()){var a=Math.floor(t.length()/3*2),o=Math.floor(e.getCodewordCount()+a+1);e.updateSymbolInfo(o);var l=e.getSymbolInfo().getDataCapacity()-o,c=Math.floor(t.length()%3);(2===c&&2!==l||1===c&&(r>3||1!==l))&&(e.pos=n)}t.length()>0&&e.writeCodeword(230),this.handleEOD(e,t)},e.prototype.encode=function(e){for(var t=new Kr;e.hasMoreCharacters();){var r=e.getCurrentChar();e.pos++;var n=this.encodeChar(r,t),s=2*Math.floor(t.length()/3),i=e.getCodewordCount()+s;e.updateSymbolInfo(i);var a=e.getSymbolInfo().getDataCapacity()-i;if(!e.hasMoreCharacters()){var o=new Kr;for(t.length()%3==2&&2!==a&&(n=this.backtrackOneCharacter(e,t,o,n));t.length()%3==1&&(n>3||1!==a);)n=this.backtrackOneCharacter(e,t,o,n);break}if(t.length()%3==0)if(ul.lookAheadTest(e.getMessage(),e.pos,this.getEncodingMode())!==this.getEncodingMode()){e.signalEncoderChange(0);break}}this.handleEOD(e,t)},e.prototype.backtrackOneCharacter=function(e,t,r,n){var s=t.length(),i=t.toString().substring(0,s-n);t.setLengthToZero(),t.append(i),e.pos--;var a=e.getCurrentChar();return n=this.encodeChar(a,r),e.resetSymbolInfo(),n},e.prototype.writeNextTriplet=function(e,t){e.writeCodewords(this.encodeToCodewords(t.toString()));var r=t.toString().substring(3);t.setLengthToZero(),t.append(r)},e.prototype.handleEOD=function(e,t){var r=Math.floor(t.length()/3*2),n=t.length()%3,s=e.getCodewordCount()+r;e.updateSymbolInfo(s);var i=e.getSymbolInfo().getDataCapacity()-s;if(2===n){for(t.append("\0");t.length()>=3;)this.writeNextTriplet(e,t);e.hasMoreCharacters()&&e.writeCodeword(254)}else if(1===i&&1===n){for(;t.length()>=3;)this.writeNextTriplet(e,t);e.hasMoreCharacters()&&e.writeCodeword(254),e.pos--}else{if(0!==n)throw new Error("Unexpected case. Please report!");for(;t.length()>=3;)this.writeNextTriplet(e,t);(i>0||e.hasMoreCharacters())&&e.writeCodeword(254)}e.signalEncoderChange(0)},e.prototype.encodeChar=function(e,t){if(e===" ".charCodeAt(0))return t.append(3),1;if(e>="0".charCodeAt(0)&&e<="9".charCodeAt(0))return t.append(e-48+4),1;if(e>="A".charCodeAt(0)&&e<="Z".charCodeAt(0))return t.append(e-65+14),1;if(e<" ".charCodeAt(0))return t.append(0),t.append(e),2;if(e<="/".charCodeAt(0))return t.append(1),t.append(e-33),2;if(e<="@".charCodeAt(0))return t.append(1),t.append(e-58+15),2;if(e<="_".charCodeAt(0))return t.append(1),t.append(e-91+22),2;if(e<=127)return t.append(2),t.append(e-96),2;t.append("1");var r=2;return r+=this.encodeChar(e-128,t)},e.prototype.encodeToCodewords=function(e){var t=1600*e.charCodeAt(0)+40*e.charCodeAt(1)+e.charCodeAt(2)+1,r=t/256,n=t%256,s=new Kr;return s.append(r),s.append(n),s.toString()},e}(),el=function(){function e(){}return e.prototype.getEncodingMode=function(){return 4},e.prototype.encode=function(e){for(var t=new Kr;e.hasMoreCharacters();){var r=e.getCurrentChar();if(this.encodeChar(r,t),e.pos++,t.length()>=4){e.writeCodewords(this.encodeToCodewords(t.toString()));var n=t.toString().substring(4);if(t.setLengthToZero(),t.append(n),ul.lookAheadTest(e.getMessage(),e.pos,this.getEncodingMode())!==this.getEncodingMode()){e.signalEncoderChange(0);break}}}t.append(qr.getCharAt(31)),this.handleEOD(e,t)},e.prototype.handleEOD=function(e,t){try{var r=t.length();if(0===r)return;if(1===r){e.updateSymbolInfo();var n=e.getSymbolInfo().getDataCapacity()-e.getCodewordCount(),s=e.getRemainingCharacters();if(s>n&&(e.updateSymbolInfo(e.getCodewordCount()+1),n=e.getSymbolInfo().getDataCapacity()-e.getCodewordCount()),s<=n&&n<=2)return}if(r>4)throw new Error("Count must not exceed 4");var i=r-1,a=this.encodeToCodewords(t.toString()),o=!e.hasMoreCharacters()&&i<=2;if(i<=2)e.updateSymbolInfo(e.getCodewordCount()+i),(n=e.getSymbolInfo().getDataCapacity()-e.getCodewordCount())>=3&&(o=!1,e.updateSymbolInfo(e.getCodewordCount()+a.length));o?(e.resetSymbolInfo(),e.pos-=i):e.writeCodewords(a)}finally{e.signalEncoderChange(0)}},e.prototype.encodeChar=function(e,t){e>=" ".charCodeAt(0)&&e<="?".charCodeAt(0)?t.append(e):e>="@".charCodeAt(0)&&e<="^".charCodeAt(0)?t.append(qr.getCharAt(e-64)):ul.illegalCharacter(qr.getCharAt(e))},e.prototype.encodeToCodewords=function(e){var t=e.length;if(0===t)throw new Error("StringBuilder must not be empty");var r=(e.charAt(0).charCodeAt(0)<<18)+((t>=2?e.charAt(1).charCodeAt(0):0)<<12)+((t>=3?e.charAt(2).charCodeAt(0):0)<<6)+(t>=4?e.charAt(3).charCodeAt(0):0),n=r>>16&255,s=r>>8&255,i=255&r,a=new Kr;return a.append(n),t>=2&&a.append(s),t>=3&&a.append(i),a.toString()},e}(),tl=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),rl=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},nl=function(){function e(e,t,r,n,s,i,a,o){void 0===a&&(a=0),void 0===o&&(o=0),this.rectangular=e,this.dataCapacity=t,this.errorCodewords=r,this.matrixWidth=n,this.matrixHeight=s,this.dataRegions=i,this.rsBlockData=a,this.rsBlockError=o}return e.lookup=function(e,t,r,n,s){var i,a;void 0===t&&(t=0),void 0===r&&(r=null),void 0===n&&(n=null),void 0===s&&(s=!0);try{for(var o=rl(il),l=o.next();!l.done;l=o.next()){var c=l.value;if((1!==t||!c.rectangular)&&((2!==t||c.rectangular)&&(null==r||!(c.getSymbolWidth()<r.getWidth()||c.getSymbolHeight()<r.getHeight()))&&(null==n||!(c.getSymbolWidth()>n.getWidth()||c.getSymbolHeight()>n.getHeight()))&&e<=c.dataCapacity))return c}}catch(d){i={error:d}}finally{try{l&&!l.done&&(a=o.return)&&a.call(o)}finally{if(i)throw i.error}}if(s)throw new Error("Can't find a symbol arrangement that matches the message. Data codewords: "+e);return null},e.prototype.getHorizontalDataRegions=function(){switch(this.dataRegions){case 1:return 1;case 2:case 4:return 2;case 16:return 4;case 36:return 6;default:throw new Error("Cannot handle this number of data regions")}},e.prototype.getVerticalDataRegions=function(){switch(this.dataRegions){case 1:case 2:return 1;case 4:return 2;case 16:return 4;case 36:return 6;default:throw new Error("Cannot handle this number of data regions")}},e.prototype.getSymbolDataWidth=function(){return this.getHorizontalDataRegions()*this.matrixWidth},e.prototype.getSymbolDataHeight=function(){return this.getVerticalDataRegions()*this.matrixHeight},e.prototype.getSymbolWidth=function(){return this.getSymbolDataWidth()+2*this.getHorizontalDataRegions()},e.prototype.getSymbolHeight=function(){return this.getSymbolDataHeight()+2*this.getVerticalDataRegions()},e.prototype.getCodewordCount=function(){return this.dataCapacity+this.errorCodewords},e.prototype.getInterleavedBlockCount=function(){return this.rsBlockData?this.dataCapacity/this.rsBlockData:1},e.prototype.getDataCapacity=function(){return this.dataCapacity},e.prototype.getErrorCodewords=function(){return this.errorCodewords},e.prototype.getDataLengthForInterleavedBlock=function(e){return this.rsBlockData},e.prototype.getErrorLengthForInterleavedBlock=function(e){return this.rsBlockError},e}(),sl=function(e){function t(){return e.call(this,!1,1558,620,22,22,36,-1,62)||this}return tl(t,e),t.prototype.getInterleavedBlockCount=function(){return 10},t.prototype.getDataLengthForInterleavedBlock=function(e){return e<=8?156:155},t}(nl),il=[new nl(!1,3,5,8,8,1),new nl(!1,5,7,10,10,1),new nl(!0,5,7,16,6,1),new nl(!1,8,10,12,12,1),new nl(!0,10,11,14,6,2),new nl(!1,12,12,14,14,1),new nl(!0,16,14,24,10,1),new nl(!1,18,14,16,16,1),new nl(!1,22,18,18,18,1),new nl(!0,22,18,16,10,2),new nl(!1,30,20,20,20,1),new nl(!0,32,24,16,14,2),new nl(!1,36,24,22,22,1),new nl(!1,44,28,24,24,1),new nl(!0,49,28,22,14,2),new nl(!1,62,36,14,14,4),new nl(!1,86,42,16,16,4),new nl(!1,114,48,18,18,4),new nl(!1,144,56,20,20,4),new nl(!1,174,68,22,22,4),new nl(!1,204,84,24,24,4,102,42),new nl(!1,280,112,14,14,16,140,56),new nl(!1,368,144,16,16,16,92,36),new nl(!1,456,192,18,18,16,114,48),new nl(!1,576,224,20,20,16,144,56),new nl(!1,696,272,22,22,16,174,68),new nl(!1,816,336,24,24,16,136,56),new nl(!1,1050,408,18,18,36,175,68),new nl(!1,1304,496,20,20,36,163,62),new sl],al=function(){function e(e){this.msg=e,this.pos=0,this.skipAtEnd=0;for(var t=e.split("").map(function(e){return e.charCodeAt(0)}),r=new Kr,n=0,s=t.length;n<s;n++){var i=String.fromCharCode(255&t[n]);if("?"===i&&"?"!==e.charAt(n))throw new Error("Message contains characters outside ISO-8859-1 encoding.");r.append(i)}this.msg=r.toString(),this.shape=0,this.codewords=new Kr,this.newEncoding=-1}return e.prototype.setSymbolShape=function(e){this.shape=e},e.prototype.setSizeConstraints=function(e,t){this.minSize=e,this.maxSize=t},e.prototype.getMessage=function(){return this.msg},e.prototype.setSkipAtEnd=function(e){this.skipAtEnd=e},e.prototype.getCurrentChar=function(){return this.msg.charCodeAt(this.pos)},e.prototype.getCurrent=function(){return this.msg.charCodeAt(this.pos)},e.prototype.getCodewords=function(){return this.codewords},e.prototype.writeCodewords=function(e){this.codewords.append(e)},e.prototype.writeCodeword=function(e){this.codewords.append(e)},e.prototype.getCodewordCount=function(){return this.codewords.length()},e.prototype.getNewEncoding=function(){return this.newEncoding},e.prototype.signalEncoderChange=function(e){this.newEncoding=e},e.prototype.resetEncoderSignal=function(){this.newEncoding=-1},e.prototype.hasMoreCharacters=function(){return this.pos<this.getTotalMessageCharCount()},e.prototype.getTotalMessageCharCount=function(){return this.msg.length-this.skipAtEnd},e.prototype.getRemainingCharacters=function(){return this.getTotalMessageCharCount()-this.pos},e.prototype.getSymbolInfo=function(){return this.symbolInfo},e.prototype.updateSymbolInfo=function(e){void 0===e&&(e=this.getCodewordCount()),(null==this.symbolInfo||e>this.symbolInfo.getDataCapacity())&&(this.symbolInfo=nl.lookup(e,this.shape,this.minSize,this.maxSize,!0))},e.prototype.resetSymbolInfo=function(){this.symbolInfo=null},e}(),ol=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ll=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ol(t,e),t.prototype.getEncodingMode=function(){return 3},t.prototype.encode=function(e){for(var t=new Kr;e.hasMoreCharacters();){var r=e.getCurrentChar();if(e.pos++,this.encodeChar(r,t),t.length()%3==0)if(this.writeNextTriplet(e,t),ul.lookAheadTest(e.getMessage(),e.pos,this.getEncodingMode())!==this.getEncodingMode()){e.signalEncoderChange(0);break}}this.handleEOD(e,t)},t.prototype.encodeChar=function(e,t){switch(e){case 13:t.append(0);break;case"*".charCodeAt(0):t.append(1);break;case">".charCodeAt(0):t.append(2);break;case" ".charCodeAt(0):t.append(3);break;default:e>="0".charCodeAt(0)&&e<="9".charCodeAt(0)?t.append(e-48+4):e>="A".charCodeAt(0)&&e<="Z".charCodeAt(0)?t.append(e-65+14):ul.illegalCharacter(qr.getCharAt(e))}return 1},t.prototype.handleEOD=function(e,t){e.updateSymbolInfo();var r=e.getSymbolInfo().getDataCapacity()-e.getCodewordCount(),n=t.length();e.pos-=n,(e.getRemainingCharacters()>1||r>1||e.getRemainingCharacters()!==r)&&e.writeCodeword(254),e.getNewEncoding()<0&&e.signalEncoderChange(0)},t}(Jo),cl=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),dl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return cl(t,e),t.prototype.getEncodingMode=function(){return 2},t.prototype.encodeChar=function(e,t){if(e===" ".charCodeAt(0))return t.append(3),1;if(e>="0".charCodeAt(0)&&e<="9".charCodeAt(0))return t.append(e-48+4),1;if(e>="a".charCodeAt(0)&&e<="z".charCodeAt(0))return t.append(e-97+14),1;if(e<" ".charCodeAt(0))return t.append(0),t.append(e),2;if(e<="/".charCodeAt(0))return t.append(1),t.append(e-33),2;if(e<="@".charCodeAt(0))return t.append(1),t.append(e-58+15),2;if(e>="[".charCodeAt(0)&&e<="_".charCodeAt(0))return t.append(1),t.append(e-91+22),2;if(e==="`".charCodeAt(0))return t.append(2),t.append(0),2;if(e<="Z".charCodeAt(0))return t.append(2),t.append(e-65+1),2;if(e<=127)return t.append(2),t.append(e-123+27),2;t.append("1");var r=2;return r+=this.encodeChar(e-128,t)},t}(Jo);const ul=function(){function e(){}return e.randomize253State=function(e){var t=129+(149*e%253+1);return t<=254?t:t-254},e.encodeHighLevel=function(e,t,r,n,s){void 0===t&&(t=0),void 0===r&&(r=null),void 0===n&&(n=null),void 0===s&&(s=!1);var i=new Jo,a=[new $o,i,new dl,new ll,new el,new Qo],o=new al(e);o.setSymbolShape(t),o.setSizeConstraints(r,n),e.startsWith(Ko)&&e.endsWith("")?(o.writeCodeword(236),o.setSkipAtEnd(2),o.pos+=7):e.startsWith(Zo)&&e.endsWith("")&&(o.writeCodeword(237),o.setSkipAtEnd(2),o.pos+=7);var l=0;for(s&&(i.encodeMaximal(o),l=o.getNewEncoding(),o.resetEncoderSignal());o.hasMoreCharacters();)a[l].encode(o),o.getNewEncoding()>=0&&(l=o.getNewEncoding(),o.resetEncoderSignal());var c=o.getCodewordCount();o.updateSymbolInfo();var d=o.getSymbolInfo().getDataCapacity();c<d&&0!==l&&5!==l&&4!==l&&o.writeCodeword("Ã¾");var u=o.getCodewords();for(u.length()<d&&u.append(129);u.length()<d;)u.append(this.randomize253State(u.length()+1));return o.getCodewords().toString()},e.lookAheadTest=function(e,t,r){var n=this.lookAheadTestIntern(e,t,r);if(3===r&&3===n){for(var s=Math.min(t+3,e.length),i=t;i<s;i++)if(!this.isNativeX12(e.charCodeAt(i)))return 0}else if(4===r&&4===n)for(s=Math.min(t+4,e.length),i=t;i<s;i++)if(!this.isNativeEDIFACT(e.charCodeAt(i)))return 0;return n},e.lookAheadTestIntern=function(e,t,r){if(t>=e.length)return r;var n;0===r?n=[0,1,1,1,1,1.25]:(n=[1,2,2,2,2,2.25])[r]=0;for(var s=0,i=new Uint8Array(6),a=[];;){if(t+s===e.length){Rr.fill(i,0),Rr.fill(a,0);var o=this.findMinimums(n,a,kr.MAX_VALUE,i),l=this.getMinimumCount(i);if(a[0]===o)return 0;if(1===l){if(i[5]>0)return 5;if(i[4]>0)return 4;if(i[2]>0)return 2;if(i[3]>0)return 3}return 1}var c=e.charCodeAt(t+s);if(s++,this.isDigit(c)?n[0]+=.5:this.isExtendedASCII(c)?(n[0]=Math.ceil(n[0]),n[0]+=2):(n[0]=Math.ceil(n[0]),n[0]++),this.isNativeC40(c)?n[1]+=2/3:this.isExtendedASCII(c)?n[1]+=8/3:n[1]+=4/3,this.isNativeText(c)?n[2]+=2/3:this.isExtendedASCII(c)?n[2]+=8/3:n[2]+=4/3,this.isNativeX12(c)?n[3]+=2/3:this.isExtendedASCII(c)?n[3]+=13/3:n[3]+=10/3,this.isNativeEDIFACT(c)?n[4]+=3/4:this.isExtendedASCII(c)?n[4]+=4.25:n[4]+=3.25,this.isSpecialB256(c)?n[5]+=4:n[5]++,s>=4){if(Rr.fill(i,0),Rr.fill(a,0),this.findMinimums(n,a,kr.MAX_VALUE,i),a[0]<this.min(a[5],a[1],a[2],a[3],a[4]))return 0;if(a[5]<a[0]||a[5]+1<this.min(a[1],a[2],a[3],a[4]))return 5;if(a[4]+1<this.min(a[5],a[1],a[2],a[3],a[0]))return 4;if(a[2]+1<this.min(a[5],a[1],a[4],a[3],a[0]))return 2;if(a[3]+1<this.min(a[5],a[1],a[4],a[2],a[0]))return 3;if(a[1]+1<this.min(a[0],a[5],a[4],a[2])){if(a[1]<a[3])return 1;if(a[1]===a[3]){for(var d=t+s+1;d<e.length;){var u=e.charCodeAt(d);if(this.isX12TermSep(u))return 3;if(!this.isNativeX12(u))break;d++}return 1}}}}},e.min=function(e,t,r,n,s){var i=Math.min(e,Math.min(t,Math.min(r,n)));return void 0===s?i:Math.min(i,s)},e.findMinimums=function(e,t,r,n){for(var s=0;s<6;s++){var i=t[s]=Math.ceil(e[s]);r>i&&(r=i,Rr.fill(n,0)),r===i&&(n[s]=n[s]+1)}return r},e.getMinimumCount=function(e){for(var t=0,r=0;r<6;r++)t+=e[r];return t||0},e.isDigit=function(e){return e>="0".charCodeAt(0)&&e<="9".charCodeAt(0)},e.isExtendedASCII=function(e){return e>=128&&e<=255},e.isNativeC40=function(e){return e===" ".charCodeAt(0)||e>="0".charCodeAt(0)&&e<="9".charCodeAt(0)||e>="A".charCodeAt(0)&&e<="Z".charCodeAt(0)},e.isNativeText=function(e){return e===" ".charCodeAt(0)||e>="0".charCodeAt(0)&&e<="9".charCodeAt(0)||e>="a".charCodeAt(0)&&e<="z".charCodeAt(0)},e.isNativeX12=function(e){return this.isX12TermSep(e)||e===" ".charCodeAt(0)||e>="0".charCodeAt(0)&&e<="9".charCodeAt(0)||e>="A".charCodeAt(0)&&e<="Z".charCodeAt(0)},e.isX12TermSep=function(e){return 13===e||e==="*".charCodeAt(0)||e===">".charCodeAt(0)},e.isNativeEDIFACT=function(e){return e>=" ".charCodeAt(0)&&e<="^".charCodeAt(0)},e.isSpecialB256=function(e){return!1},e.determineConsecutiveDigitCount=function(e,t){void 0===t&&(t=0);for(var r=e.length,n=t;n<r&&this.isDigit(e.charCodeAt(n));)n++;return n-t},e.illegalCharacter=function(e){var t=kr.toHexString(e.charCodeAt(0));throw t="0000".substring(0,4-t.length)+t,new Error("Illegal character: "+e+" (0x"+t+")")},e}();var hl=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},fl=function(){function e(e){this.charset=e,this.name=e.name}return e.prototype.canEncode=function(e){try{return null!=Yr.encode(e,this.charset)}catch(t){return!1}},e}(),pl=function(){function e(e,t,r){var n,s,i,a,o,l;this.ENCODERS=["IBM437","ISO-8859-2","ISO-8859-3","ISO-8859-4","ISO-8859-5","ISO-8859-6","ISO-8859-7","ISO-8859-8","ISO-8859-9","ISO-8859-10","ISO-8859-11","ISO-8859-13","ISO-8859-14","ISO-8859-15","ISO-8859-16","windows-1250","windows-1251","windows-1252","windows-1256","Shift_JIS"].map(function(e){return new fl(Yo.forName(e))}),this.encoders=[];var c=[];c.push(new fl(qo.ISO_8859_1));for(var d=null!=t&&t.name.startsWith("UTF"),u=0;u<e.length;u++){var h=!1;try{for(var f=(n=void 0,hl(c)),p=f.next();!p.done;p=f.next()){var m=p.value,g=e.charAt(u);if(g.charCodeAt(0)===r||m.canEncode(g)){h=!0;break}}}catch(N){n={error:N}}finally{try{p&&!p.done&&(s=f.return)&&s.call(f)}finally{if(n)throw n.error}}if(!h)try{for(var x=(i=void 0,hl(this.ENCODERS)),y=x.next();!y.done;y=x.next()){if((m=y.value).canEncode(e.charAt(u))){c.push(m),h=!0;break}}}catch(j){i={error:j}}finally{try{y&&!y.done&&(a=x.return)&&a.call(x)}finally{if(i)throw i.error}}h||(d=!0)}if(1!==c.length||d){this.encoders=[];var v=0;try{for(var w=hl(c),_=w.next();!_.done;_=w.next()){m=_.value;this.encoders[v++]=m}}catch(C){o={error:C}}finally{try{_&&!_.done&&(l=w.return)&&l.call(w)}finally{if(o)throw o.error}}}else this.encoders=[c[0]];var b=-1;if(null!=t)for(u=0;u<this.encoders.length;u++)if(null!=this.encoders[u]&&t.name===this.encoders[u].name){b=u;break}this.priorityEncoderIndex=b}return e.prototype.length=function(){return this.encoders.length},e.prototype.getCharsetName=function(e){if(!(e<this.length()))throw new Error("index must be less than length");return this.encoders[e].name},e.prototype.getCharset=function(e){if(!(e<this.length()))throw new Error("index must be less than length");return this.encoders[e].charset},e.prototype.getECIValue=function(e){return this.encoders[e].charset.getValueIdentifier()},e.prototype.getPriorityEncoderIndex=function(){return this.priorityEncoderIndex},e.prototype.canEncode=function(e,t){if(!(t<this.length()))throw new Error("index must be less than length");return!0},e.prototype.encode=function(e,t){if(!(t<this.length()))throw new Error("index must be less than length");return Yr.encode(qr.getCharAt(e),this.encoders[t].name)},e}(),ml=function(){function e(e,t,r){this.fnc1=r;var n=new pl(e,t,r);if(1===n.length())for(var s=0;s<this.bytes.length;s++){var i=e.charAt(s).charCodeAt(0);this.bytes[s]=i===r?1e3:i}else this.bytes=this.encodeMinimally(e,n,r)}return e.prototype.getFNC1Character=function(){return this.fnc1},e.prototype.length=function(){return this.bytes.length},e.prototype.haveNCharacters=function(e,t){if(e+t-1>=this.bytes.length)return!1;for(var r=0;r<t;r++)if(this.isECI(e+r))return!1;return!0},e.prototype.charAt=function(e){if(e<0||e>=this.length())throw new Error(""+e);if(this.isECI(e))throw new Error("value at "+e+" is not a character but an ECI");return this.isFNC1(e)?this.fnc1:this.bytes[e]},e.prototype.subSequence=function(e,t){if(e<0||e>t||t>this.length())throw new Error(""+e);for(var r=new Kr,n=e;n<t;n++){if(this.isECI(n))throw new Error("value at "+n+" is not a character but an ECI");r.append(this.charAt(n))}return r.toString()},e.prototype.isECI=function(e){if(e<0||e>=this.length())throw new Error(""+e);return this.bytes[e]>255&&this.bytes[e]<=999},e.prototype.isFNC1=function(e){if(e<0||e>=this.length())throw new Error(""+e);return 1e3===this.bytes[e]},e.prototype.getECIValue=function(e){if(e<0||e>=this.length())throw new Error(""+e);if(!this.isECI(e))throw new Error("value at "+e+" is not an ECI but a character");return this.bytes[e]-256},e.prototype.addEdge=function(e,t,r){(null==e[t][r.encoderIndex]||e[t][r.encoderIndex].cachedTotalSize>r.cachedTotalSize)&&(e[t][r.encoderIndex]=r)},e.prototype.addEdges=function(e,t,r,n,s,i){var a=e.charAt(n).charCodeAt(0),o=0,l=t.length();t.getPriorityEncoderIndex()>=0&&(a===i||t.canEncode(a,t.getPriorityEncoderIndex()))&&(l=(o=t.getPriorityEncoderIndex())+1);for(var c=o;c<l;c++)(a===i||t.canEncode(a,c))&&this.addEdge(r,n+1,new gl(a,t,c,s,i))},e.prototype.encodeMinimally=function(e,t,r){var n=e.length,s=new(gl[n+1][t.length()]);this.addEdges(e,t,s,0,null,r);for(var i=1;i<=n;i++){for(var a=0;a<t.length();a++)null!=s[i][a]&&i<n&&this.addEdges(e,t,s,i,s[i][a],r);for(a=0;a<t.length();a++)s[i-1][a]=null}var o=-1,l=kr.MAX_VALUE;for(a=0;a<t.length();a++)if(null!=s[n][a]){var c=s[n][a];c.cachedTotalSize<l&&(l=c.cachedTotalSize,o=a)}if(o<0)throw new Error('Failed to encode "'+e+'"');for(var d=[],u=s[n][o];null!=u;){if(u.isFNC1())d.unshift(1e3);else{var h=t.encode(u.c,u.encoderIndex);for(i=h.length-1;i>=0;i--)d.unshift(255&h[i])}(null===u.previous?0:u.previous.encoderIndex)!==u.encoderIndex&&d.unshift(256+t.getECIValue(u.encoderIndex)),u=u.previous}var f=[];for(i=0;i<f.length;i++)f[i]=d[i];return f},e}(),gl=function(){function e(e,t,r,n,s){this.c=e,this.encoderSet=t,this.encoderIndex=r,this.previous=n,this.fnc1=s,this.c=e===s?1e3:e;var i=this.isFNC1()?1:t.encode(e,r).length;(null===n?0:n.encoderIndex)!==r&&(i+=3),null!=n&&(i+=n.cachedTotalSize),this.cachedTotalSize=i}return e.prototype.isFNC1=function(){return 1e3===this.c},e}(),xl=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();globalThis&&globalThis.__values;var yl;globalThis&&globalThis.__read;globalThis&&globalThis.__spread,function(e){e[e.ASCII=0]="ASCII",e[e.C40=1]="C40",e[e.TEXT=2]="TEXT",e[e.X12=3]="X12",e[e.EDF=4]="EDF",e[e.B256=5]="B256"}(yl||(yl={})),function(e){function t(t,r,n,s,i){var a=e.call(this,t,r,n)||this;return a.shape=s,a.macroId=i,a}xl(t,e),t.prototype.getMacroId=function(){return this.macroId},t.prototype.getShapeHint=function(){return this.shape}}(ml);var vl=function(){function e(){}return e.prototype.isCompact=function(){return this.compact},e.prototype.setCompact=function(e){this.compact=e},e.prototype.getSize=function(){return this.size},e.prototype.setSize=function(e){this.size=e},e.prototype.getLayers=function(){return this.layers},e.prototype.setLayers=function(e){this.layers=e},e.prototype.getCodeWords=function(){return this.codeWords},e.prototype.setCodeWords=function(e){this.codeWords=e},e.prototype.getMatrix=function(){return this.matrix},e.prototype.setMatrix=function(e){this.matrix=e},e}(),wl=function(){function e(){}return e.singletonList=function(e){return[e]},e.min=function(e,t){return e.sort(t)[0]},e}(),_l=function(){function e(e){this.previous=e}return e.prototype.getPrevious=function(){return this.previous},e}(),bl=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Nl=function(e){function t(t,r,n){var s=e.call(this,t)||this;return s.value=r,s.bitCount=n,s}return bl(t,e),t.prototype.appendTo=function(e,t){e.appendBits(this.value,this.bitCount)},t.prototype.add=function(e,r){return new t(this,e,r)},t.prototype.addBinaryShift=function(e,r){return new t(this,e,r)},t.prototype.toString=function(){var e=this.value&(1<<this.bitCount)-1;return e|=1<<this.bitCount,"<"+kr.toBinaryString(e|1<<this.bitCount).substring(1)+">"},t}(_l),jl=globalThis&&globalThis.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Cl=function(e){function t(t,r,n){var s=e.call(this,t,0,0)||this;return s.binaryShiftStart=r,s.binaryShiftByteCount=n,s}return jl(t,e),t.prototype.appendTo=function(e,t){for(var r=0;r<this.binaryShiftByteCount;r++)(0===r||31===r&&this.binaryShiftByteCount<=62)&&(e.appendBits(31,5),this.binaryShiftByteCount>62?e.appendBits(this.binaryShiftByteCount-31,16):0===r?e.appendBits(Math.min(this.binaryShiftByteCount,31),5):e.appendBits(this.binaryShiftByteCount-31,5)),e.appendBits(t[this.binaryShiftStart+r],8)},t.prototype.addBinaryShift=function(e,r){return new t(this,e,r)},t.prototype.toString=function(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"},t}(Nl);function Al(e,t,r){return new Nl(e,t,r)}var Sl=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],El=new Nl(null,0,0),Il=[Int32Array.from([0,327708,327710,327709,656318]),Int32Array.from([590318,0,327710,327709,656318]),Int32Array.from([262158,590300,0,590301,932798]),Int32Array.from([327709,327708,656318,0,327710]),Int32Array.from([327711,656380,656382,656381,0])],Tl=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};var Dl=function(e){var t,r;try{for(var n=Tl(e),s=n.next();!s.done;s=n.next()){var i=s.value;Rr.fill(i,-1)}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return e[0][4]=0,e[1][4]=0,e[1][0]=28,e[3][4]=0,e[2][4]=0,e[2][0]=15,e}(Rr.createInt32Array(6,6)),Ol=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Rl=function(){function e(e,t,r,n){this.token=e,this.mode=t,this.binaryShiftByteCount=r,this.bitCount=n}return e.prototype.getMode=function(){return this.mode},e.prototype.getToken=function(){return this.token},e.prototype.getBinaryShiftByteCount=function(){return this.binaryShiftByteCount},e.prototype.getBitCount=function(){return this.bitCount},e.prototype.latchAndAppend=function(t,r){var n=this.bitCount,s=this.token;if(t!==this.mode){var i=Il[this.mode][t];s=Al(s,65535&i,i>>16),n+=i>>16}var a=2===t?4:5;return new e(s=Al(s,r,a),t,0,n+a)},e.prototype.shiftAndAppend=function(t,r){var n=this.token,s=2===this.mode?4:5;return n=Al(n,Dl[this.mode][t],s),new e(n=Al(n,r,5),this.mode,0,this.bitCount+s+5)},e.prototype.addBinaryShiftChar=function(t){var r=this.token,n=this.mode,s=this.bitCount;if(4===this.mode||2===this.mode){var i=Il[n][0];r=Al(r,65535&i,i>>16),s+=i>>16,n=0}var a=0===this.binaryShiftByteCount||31===this.binaryShiftByteCount?18:62===this.binaryShiftByteCount?9:8,o=new e(r,n,this.binaryShiftByteCount+1,s+a);return 2078===o.binaryShiftByteCount&&(o=o.endBinaryShift(t+1)),o},e.prototype.endBinaryShift=function(t){if(0===this.binaryShiftByteCount)return this;var r=this.token;return new e(r=function(e,t,r){return new Cl(e,t,r)}(r,t-this.binaryShiftByteCount,this.binaryShiftByteCount),this.mode,0,this.bitCount)},e.prototype.isBetterThanOrEqualTo=function(t){var r=this.bitCount+(Il[this.mode][t.mode]>>16);return this.binaryShiftByteCount<t.binaryShiftByteCount?r+=e.calculateBinaryShiftCost(t)-e.calculateBinaryShiftCost(this):this.binaryShiftByteCount>t.binaryShiftByteCount&&t.binaryShiftByteCount>0&&(r+=10),r<=t.bitCount},e.prototype.toBitArray=function(e){for(var t,r,n=[],s=this.endBinaryShift(e.length).token;null!==s;s=s.getPrevious())n.unshift(s);var i=new Mr;try{for(var a=Ol(n),o=a.next();!o.done;o=a.next()){o.value.appendTo(i,e)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return i},e.prototype.toString=function(){return qr.format("%s bits=%d bytes=%d",Sl[this.mode],this.bitCount,this.binaryShiftByteCount)},e.calculateBinaryShiftCost=function(e){return e.binaryShiftByteCount>62?21:e.binaryShiftByteCount>31?20:e.binaryShiftByteCount>0?10:0},e.INITIAL_STATE=new e(El,0,0,0),e}();var kl=function(e){var t=qr.getCharCode(" "),r=qr.getCharCode("."),n=qr.getCharCode(",");e[0][t]=1;for(var s=qr.getCharCode("Z"),i=qr.getCharCode("A"),a=i;a<=s;a++)e[0][a]=a-i+2;e[1][t]=1;var o=qr.getCharCode("z"),l=qr.getCharCode("a");for(a=l;a<=o;a++)e[1][a]=a-l+2;e[2][t]=1;var c=qr.getCharCode("9"),d=qr.getCharCode("0");for(a=d;a<=c;a++)e[2][a]=a-d+2;e[2][n]=12,e[2][r]=13;for(var u=["\0"," ","","","","","","","","\b","\t","\n","\v","\f","\r","","","","","","@","\\","^","_","`","|","~",""],h=0;h<u.length;h++)e[3][qr.getCharCode(u[h])]=h;var f=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(h=0;h<f.length;h++)qr.getCharCode(f[h])>0&&(e[4][qr.getCharCode(f[h])]=h);return e}(Rr.createInt32Array(5,256)),Ml=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Pl=function(){function e(e){this.text=e}return e.prototype.encode=function(){for(var t=qr.getCharCode(" "),r=qr.getCharCode("\n"),n=wl.singletonList(Rl.INITIAL_STATE),s=0;s<this.text.length;s++){var i=void 0,a=s+1<this.text.length?this.text[s+1]:0;switch(this.text[s]){case qr.getCharCode("\r"):i=a===r?2:0;break;case qr.getCharCode("."):i=a===t?3:0;break;case qr.getCharCode(","):i=a===t?4:0;break;case qr.getCharCode(":"):i=a===t?5:0;break;default:i=0}i>0?(n=e.updateStateListForPair(n,s,i),s++):n=this.updateStateListForChar(n,s)}return wl.min(n,function(e,t){return e.getBitCount()-t.getBitCount()}).toBitArray(this.text)},e.prototype.updateStateListForChar=function(t,r){var n,s,i=[];try{for(var a=Ml(t),o=a.next();!o.done;o=a.next()){var l=o.value;this.updateStateForChar(l,r,i)}}catch(c){n={error:c}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(n)throw n.error}}return e.simplifyStates(i)},e.prototype.updateStateForChar=function(e,t,r){for(var n=255&this.text[t],s=kl[e.getMode()][n]>0,i=null,a=0;a<=4;a++){var o=kl[a][n];if(o>0){if(null==i&&(i=e.endBinaryShift(t)),!s||a===e.getMode()||2===a){var l=i.latchAndAppend(a,o);r.push(l)}if(!s&&Dl[e.getMode()][a]>=0){var c=i.shiftAndAppend(a,o);r.push(c)}}}if(e.getBinaryShiftByteCount()>0||0===kl[e.getMode()][n]){var d=e.addBinaryShiftChar(t);r.push(d)}},e.updateStateListForPair=function(e,t,r){var n,s,i=[];try{for(var a=Ml(e),o=a.next();!o.done;o=a.next()){var l=o.value;this.updateStateForPair(l,t,r,i)}}catch(c){n={error:c}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(n)throw n.error}}return this.simplifyStates(i)},e.updateStateForPair=function(e,t,r,n){var s=e.endBinaryShift(t);if(n.push(s.latchAndAppend(4,r)),4!==e.getMode()&&n.push(s.shiftAndAppend(4,r)),3===r||4===r){var i=s.latchAndAppend(2,16-r).latchAndAppend(2,1);n.push(i)}if(e.getBinaryShiftByteCount()>0){var a=e.addBinaryShiftChar(t).addBinaryShiftChar(t+1);n.push(a)}},e.simplifyStates=function(e){var t,r,n,s,i=[];try{for(var a=Ml(e),o=a.next();!o.done;o=a.next()){var l=o.value,c=!0,d=function(e){if(e.isBetterThanOrEqualTo(l))return c=!1,"break";l.isBetterThanOrEqualTo(e)&&(i=i.filter(function(t){return t!==e}))};try{for(var u=(n=void 0,Ml(i)),h=u.next();!h.done;h=u.next()){if("break"===d(h.value))break}}catch(f){n={error:f}}finally{try{h&&!h.done&&(s=u.return)&&s.call(u)}finally{if(n)throw n.error}}c&&i.push(l)}}catch(p){t={error:p}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return i},e}(),Bl=globalThis&&globalThis.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};!function(){function e(){}e.encodeBytes=function(t){return e.encode(t,e.DEFAULT_EC_PERCENT,e.DEFAULT_AZTEC_LAYERS)},e.encode=function(t,r,n){var s,i,a,o,l,c=new Pl(t).encode(),d=kr.truncDivision(c.getSize()*r,100)+11,u=c.getSize()+d;if(n!==e.DEFAULT_AZTEC_LAYERS){if(s=n<0,(i=Math.abs(n))>(s?e.MAX_NB_BITS_COMPACT:e.MAX_NB_BITS))throw new br(qr.format("Illegal value %s for layers",n));var h=(a=e.totalBitsInLayer(i,s))-a%(o=e.WORD_SIZE[i]);if((l=e.stuffBits(c,o)).getSize()+d>h)throw new br("Data to large for user specified layer");if(s&&l.getSize()>64*o)throw new br("Data to large for user specified layer")}else{o=0,l=null;for(var f=0;;f++){if(f>e.MAX_NB_BITS)throw new br("Data too large for an Aztec code");if(i=(s=f<=3)?f+1:f,!(u>(a=e.totalBitsInLayer(i,s)))){null!=l&&o===e.WORD_SIZE[i]||(o=e.WORD_SIZE[i],l=e.stuffBits(c,o));h=a-a%o;if(!(s&&l.getSize()>64*o)&&l.getSize()+d<=h)break}}}var p,m=e.generateCheckWords(l,a,o),g=l.getSize()/o,x=e.generateModeMessage(s,i,g),y=(s?11:14)+4*i,v=new Int32Array(y);if(s){p=y;for(f=0;f<v.length;f++)v[f]=f}else{p=y+1+2*kr.truncDivision(kr.truncDivision(y,2)-1,15);var w=kr.truncDivision(y,2),_=kr.truncDivision(p,2);for(f=0;f<w;f++){var b=f+kr.truncDivision(f,15);v[w-f-1]=_-b-1,v[w+f]=_+b+1}}for(var N=new Zr(p),j=(f=0,0);f<i;f++){for(var C=4*(i-f)+(s?9:12),A=0;A<C;A++)for(var S=2*A,E=0;E<2;E++)m.get(j+S+E)&&N.set(v[2*f+E],v[2*f+A]),m.get(j+2*C+S+E)&&N.set(v[2*f+A],v[y-1-2*f-E]),m.get(j+4*C+S+E)&&N.set(v[y-1-2*f-E],v[y-1-2*f-A]),m.get(j+6*C+S+E)&&N.set(v[y-1-2*f-A],v[2*f+E]);j+=8*C}if(e.drawModeMessage(N,s,p,x),s)e.drawBullsEye(N,kr.truncDivision(p,2),5);else{e.drawBullsEye(N,kr.truncDivision(p,2),7);for(f=0,A=0;f<kr.truncDivision(y,2)-1;f+=15,A+=16)for(E=1&kr.truncDivision(p,2);E<p;E+=2)N.set(kr.truncDivision(p,2)-A,E),N.set(kr.truncDivision(p,2)+A,E),N.set(E,kr.truncDivision(p,2)-A),N.set(E,kr.truncDivision(p,2)+A)}var I=new vl;return I.setCompact(s),I.setSize(p),I.setLayers(i),I.setCodeWords(g),I.setMatrix(N),I},e.drawBullsEye=function(e,t,r){for(var n=0;n<r;n+=2)for(var s=t-n;s<=t+n;s++)e.set(s,t-n),e.set(s,t+n),e.set(t-n,s),e.set(t+n,s);e.set(t-r,t-r),e.set(t-r+1,t-r),e.set(t-r,t-r+1),e.set(t+r,t-r),e.set(t+r,t-r+1),e.set(t+r,t+r-1)},e.generateModeMessage=function(t,r,n){var s=new Mr;return t?(s.appendBits(r-1,2),s.appendBits(n-1,6),s=e.generateCheckWords(s,28,4)):(s.appendBits(r-1,5),s.appendBits(n-1,11),s=e.generateCheckWords(s,40,4)),s},e.drawModeMessage=function(e,t,r,n){var s=kr.truncDivision(r,2);if(t)for(var i=0;i<7;i++){var a=s-3+i;n.get(i)&&e.set(a,s-5),n.get(i+7)&&e.set(s+5,a),n.get(20-i)&&e.set(a,s+5),n.get(27-i)&&e.set(s-5,a)}else for(i=0;i<10;i++){a=s-5+i+kr.truncDivision(i,5);n.get(i)&&e.set(a,s-7),n.get(i+10)&&e.set(s+7,a),n.get(29-i)&&e.set(a,s+7),n.get(39-i)&&e.set(s-7,a)}},e.generateCheckWords=function(t,r,n){var s,i,a=t.getSize()/n,o=new Do(e.getGF(n)),l=kr.truncDivision(r,n),c=e.bitsToWords(t,n,l);o.encode(c,l-a);var d=r%n,u=new Mr;u.appendBits(0,d);try{for(var h=Bl(Array.from(c)),f=h.next();!f.done;f=h.next()){var p=f.value;u.appendBits(p,n)}}catch(m){s={error:m}}finally{try{f&&!f.done&&(i=h.return)&&i.call(h)}finally{if(s)throw s.error}}return u},e.bitsToWords=function(e,t,r){var n,s,i=new Int32Array(r);for(n=0,s=e.getSize()/t;n<s;n++){for(var a=0,o=0;o<t;o++)a|=e.get(n*t+o)?1<<t-o-1:0;i[n]=a}return i},e.getGF=function(e){switch(e){case 4:return Sn.AZTEC_PARAM;case 6:return Sn.AZTEC_DATA_6;case 8:return Sn.AZTEC_DATA_8;case 10:return Sn.AZTEC_DATA_10;case 12:return Sn.AZTEC_DATA_12;default:throw new br("Unsupported word size "+e)}},e.stuffBits=function(e,t){for(var r=new Mr,n=e.getSize(),s=(1<<t)-2,i=0;i<n;i+=t){for(var a=0,o=0;o<t;o++)(i+o>=n||e.get(i+o))&&(a|=1<<t-1-o);(a&s)===s?(r.appendBits(a&s,t),i--):0===(a&s)?(r.appendBits(1|a,t),i--):r.appendBits(a,t)}return r},e.totalBitsInLayer=function(e,t){return((t?88:112)+16*e)*e},e.DEFAULT_EC_PERCENT=33,e.DEFAULT_AZTEC_LAYERS=0,e.MAX_NB_BITS=32,e.MAX_NB_BITS_COMPACT=4,e.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12])}();const Fl=({onFoodAdded:t})=>{const{userProfile:n}=l(),[s,i]=r.useState(!1),[a,c]=r.useState(!1),[d,f]=r.useState(null),[p,m]=r.useState(null),[x,y]=r.useState(null),v=r.useRef(null),w=r.useRef(null);r.useEffect(()=>(w.current=new Co,()=>{w.current&&w.current.reset()}),[]);const A=()=>{w.current&&w.current.reset(),i(!1)},S=async e=>{var t,r,n,s,i,a,o,l,d,u,p,g,x,y;c(!0);try{const v=await fetch(`https://world.openfoodfacts.org/api/v2/product/${e}.json`),w=await v.json();if(0===w.status||!w.product)return m(`Product not found for barcode: ${e}. Try entering manually.`),void c(!1);const _=w.product,b={barcode:e,name:_.product_name||"Unknown Product",brand:_.brands||"",quantity:_.quantity||"",servingSize:_.serving_size||"100g",imageUrl:_.image_url||_.image_front_url||null,nutrition:{calories:(null==(t=_.nutriments)?void 0:t["energy-kcal_100g"])||(null==(r=_.nutriments)?void 0:r["energy-kcal"])||0,protein:(null==(n=_.nutriments)?void 0:n.proteins_100g)||(null==(s=_.nutriments)?void 0:s.proteins)||0,carbs:(null==(i=_.nutriments)?void 0:i.carbohydrates_100g)||(null==(a=_.nutriments)?void 0:a.carbohydrates)||0,fats:(null==(o=_.nutriments)?void 0:o.fat_100g)||(null==(l=_.nutriments)?void 0:l.fat)||0,fiber:(null==(d=_.nutriments)?void 0:d.fiber_100g)||(null==(u=_.nutriments)?void 0:u.fiber)||0,sugar:(null==(p=_.nutriments)?void 0:p.sugars_100g)||(null==(g=_.nutriments)?void 0:g.sugars)||0,sodium:(null==(x=_.nutriments)?void 0:x.sodium_100g)||(null==(y=_.nutriments)?void 0:y.sodium)||0},categories:_.categories_tags||[],labels:_.labels_tags||[],ingredients:_.ingredients_text||"",nutriScore:_.nutrition_grades||null,novaGroup:_.nova_group||null};f(b),h({title:"Product Found!",description:`${b.name} by ${b.brand}`})}catch(v){m("Failed to fetch product data. Please try again.")}finally{c(!1)}};return e.jsx("div",{className:"space-y-4",children:e.jsxs(_,{className:"glass-effect",children:[e.jsxs(b,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5"}),"Barcode Scanner"]}),e.jsx(C,{children:"Scan any food product barcode to instantly get nutritional information"})]}),e.jsxs(j,{className:"space-y-4",children:["denied"===x&&e.jsx(Wt,{variant:"destructive",children:e.jsx(zt,{children:"Camera access is required to scan barcodes. Please enable camera permissions in your browser settings."})}),p&&e.jsx(Wt,{variant:"destructive",children:e.jsx(zt,{children:p})}),e.jsx("div",{className:"flex gap-2",children:s?e.jsxs(o,{onClick:A,variant:"destructive",className:"flex-1",children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Stop Scanning"]}):e.jsxs(o,{onClick:async()=>{m(null),f(null);try{await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});y("granted"),i(!0);const e=await w.current.listVideoInputDevices();if(0===e.length)throw new Error("No camera devices found");const t=e[0].deviceId;w.current.decodeFromVideoDevice(t,v.current,async(e,t)=>{if(e){const t=e.getText();A(),await S(t)}})}catch(e){"NotAllowedError"===e.name||"PermissionDeniedError"===e.name?(y("denied"),m("Camera permission denied. Please enable camera access in your browser settings.")):"NotFoundError"===e.name?m("No camera found on this device."):m("Failed to start camera: "+e.message),i(!1)}},className:"flex-1",children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Start Scanning"]})}),s&&e.jsxs("div",{className:"relative rounded-lg overflow-hidden bg-black aspect-video",children:[e.jsx("video",{ref:v,className:"w-full h-full object-cover",autoPlay:!0,playsInline:!0}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"w-64 h-48 border-4 border-primary rounded-lg animate-pulse"})}),e.jsx("div",{className:"absolute bottom-4 left-0 right-0 text-center",children:e.jsxs(g,{variant:"secondary",className:"bg-black/50 text-white",children:[e.jsx(ue,{className:"mr-2 h-3 w-3"}),"Scanning for barcode..."]})})]}),a&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-text-secondary",children:"Fetching product data..."})]}),d&&!a&&e.jsx(_,{className:"bg-background/50",children:e.jsxs(j,{className:"pt-6 space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[d.imageUrl&&e.jsx("img",{src:d.imageUrl,alt:d.name,className:"w-24 h-24 object-cover rounded-lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:d.name}),d.brand&&e.jsx("p",{className:"text-sm text-text-secondary",children:d.brand}),d.quantity&&e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:d.quantity}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[d.nutriScore&&e.jsxs(g,{className:(I=d.nutriScore,{a:"bg-green-500",b:"bg-lime-500",c:"bg-yellow-500",d:"bg-orange-500",e:"bg-red-500"}[null==I?void 0:I.toLowerCase()]||"bg-gray-500"),children:["Nutri-Score: ",d.nutriScore.toUpperCase()]}),d.novaGroup&&e.jsx(g,{variant:"outline",children:(E=d.novaGroup,{1:"Unprocessed",2:"Processed",3:"Ultra-Processed",4:"Ultra-Processed"}[E]||"Unknown")})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-2",children:["Nutrition per ",d.servingSize]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-background/50",children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Calories"}),e.jsx("p",{className:"text-lg font-semibold",children:Math.round(d.nutrition.calories)})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-background/50",children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Protein"}),e.jsxs("p",{className:"text-lg font-semibold",children:[d.nutrition.protein.toFixed(1),"g"]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-background/50",children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Carbs"}),e.jsxs("p",{className:"text-lg font-semibold",children:[d.nutrition.carbs.toFixed(1),"g"]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-background/50",children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Fats"}),e.jsxs("p",{className:"text-lg font-semibold",children:[d.nutrition.fats.toFixed(1),"g"]})]})]})]}),(d.nutrition.fiber>0||d.nutrition.sugar>0)&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[d.nutrition.fiber>0&&e.jsxs("div",{className:"p-2 rounded bg-background/30",children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Fiber"}),e.jsxs("p",{className:"font-semibold",children:[d.nutrition.fiber.toFixed(1),"g"]})]}),d.nutrition.sugar>0&&e.jsxs("div",{className:"p-2 rounded bg-background/30",children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Sugar"}),e.jsxs("p",{className:"font-semibold",children:[d.nutrition.sugar.toFixed(1),"g"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{onClick:async()=>{if(d&&(null==n?void 0:n.id))try{const{data:e,error:r}=await u.from("meal_logs").insert({user_id:n.id,food_name:d.name,brand:d.brand,barcode:d.barcode,serving_size:d.servingSize,calories:d.nutrition.calories,protein:d.nutrition.protein,carbs:d.nutrition.carbs,fats:d.nutrition.fats,fiber:d.nutrition.fiber,meal_type:"snack",logged_at:(new Date).toISOString()}).select().single();if(r)throw r;h({title:"Added to Meal Log!",description:`${d.name} logged successfully`}),t&&t(e),f(null)}catch(e){h({title:"Error",description:"Failed to add to meal log",variant:"destructive"})}},className:"flex-1",children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),"Add to Meal Log"]}),e.jsxs(o,{onClick:()=>f(null),variant:"outline",children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Clear"]})]})]})}),e.jsxs(Wt,{children:[e.jsx(he,{className:"h-4 w-4"}),e.jsxs(zt,{children:[e.jsx("strong",{children:"Powered by Open Food Facts"})," - A collaborative, free and open database of food products from around the world (2.3M+ products)."]})]})]})]})});var E,I},Ll=()=>{var t,n;const{userProfile:s}=l(),{hasAccess:i}=y(),a=i("wearableIntegration"),[d,f]=r.useState([]),[p,m]=r.useState(!1),[x,v]=r.useState(null),[w,A]=r.useState(null),[S,E]=r.useState(!0),I=[{id:"apple-health",name:"Apple Health",icon:"ðŸŽ",platform:"iOS",description:"Sync steps, calories, workouts, heart rate",color:"from-gray-700 to-gray-900",requiresNativeApp:!0},{id:"google-fit",name:"Google Fit",icon:"ðŸƒ",platform:"Android/Web",description:"Sync steps, calories, workouts, heart rate",color:"from-green-500 to-green-700",webSupported:!0},{id:"fitbit",name:"Fitbit",icon:"âŒš",platform:"All",description:"Sync steps, calories, sleep, heart rate",color:"from-teal-500 to-teal-700",webSupported:!0},{id:"garmin",name:"Garmin Connect",icon:"ðŸ‹ï¸",platform:"All",description:"Sync workouts, heart rate, stress levels",color:"from-blue-600 to-blue-800",webSupported:!0},{id:"samsung-health",name:"Samsung Health",icon:"ðŸ“±",platform:"Android",description:"Sync steps, calories, sleep, heart rate",color:"from-blue-500 to-blue-700",requiresNativeApp:!0},{id:"whoop",name:"WHOOP",icon:"ðŸ’ª",platform:"All",description:"Sync strain, recovery, sleep performance",color:"from-red-500 to-red-700",webSupported:!0}];r.useEffect(()=>{(null==s?void 0:s.id)&&(T(),D())},[null==s?void 0:s.id]);const T=async()=>{E(!0);try{const{data:e,error:t}=await u.from("wearable_connections").select("*").eq("user_id",s.id);t&&t.code,f(e||[])}catch(e){}finally{E(!1)}},D=async()=>{try{const{data:e}=await u.from("wearable_sync_history").select("synced_at, stats").eq("user_id",s.id).order("synced_at",{ascending:!1}).limit(1).maybeSingle();e&&(v(new Date(e.synced_at)),A(e.stats))}catch(e){}};return a?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-5 w-5"}),"Wearable Device Sync"]}),e.jsx(C,{children:"Connect fitness trackers to automatically sync health data"})]}),d.length>0&&e.jsxs(g,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(ee,{className:"h-3 w-3"}),d.length," Connected"]})]})}),e.jsxs(j,{className:"space-y-4",children:[d.length>0&&e.jsxs("div",{className:"p-4 rounded-lg bg-background/50 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Last Sync"}),e.jsx("p",{className:"font-semibold",children:(()=>{if(!x)return"Never";const e=new Date-x,t=Math.floor(e/6e4);if(t<1)return"Just now";if(t<60)return`${t} minutes ago`;const r=Math.floor(t/60);if(r<24)return`${r} hours ago`;return`${Math.floor(r/24)} days ago`})()}),w&&e.jsxs("div",{className:"flex gap-4 mt-2 text-xs text-text-secondary",children:[e.jsxs("span",{children:["Steps: ",(null==(t=w.steps)?void 0:t.toLocaleString())||0]}),e.jsxs("span",{children:["Calories: ",w.calories||0]}),e.jsxs("span",{children:["Active Minutes: ",w.activeMinutes||0]})]})]}),e.jsx(o,{onClick:async()=>{if(a)if(0!==d.length){m(!0);try{const{data:e,error:t}=await u.functions.invoke("sync-wearable-data",{body:{user_id:s.id}});if(t)throw t;h({title:"Sync Complete!",description:`Synced ${e.recordsImported||0} new records from your wearable devices.`}),A(e.stats),v(new Date),D()}catch(e){h({title:"Sync Failed",description:e.message||"Failed to sync wearable data.",variant:"destructive"})}finally{m(!1)}}else h({title:"No Devices Connected",description:"Please connect a wearable device first."});else h({title:"Premium Feature",description:"Please upgrade to Premium to sync wearable data.",variant:"destructive"})},disabled:p,size:"sm",children:p?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"mr-2 h-4 w-4 animate-spin"}),"Syncing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"mr-2 h-4 w-4"}),"Sync Now"]})})]}),d.length>0&&e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-background/30",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"auto-sync",children:"Automatic Sync"}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Sync data automatically every hour"})]}),e.jsx(Yt,{id:"auto-sync",defaultChecked:!0})]})]})]}),e.jsxs(_,{className:"glass-effect",children:[e.jsxs(b,{children:[e.jsx(N,{children:"Available Devices"}),e.jsx(C,{children:"Connect your wearable devices to start syncing health data"})]}),e.jsx(j,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:I.map(t=>{const r=(n=t.id,d.some(e=>e.device_id===n));var n;const i=(e=>d.find(t=>t.device_id===e))(t.id);return e.jsxs(_,{className:"relative overflow-hidden "+(r?"ring-2 ring-primary":""),children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${t.color} opacity-10`}),e.jsxs(j,{className:"relative pt-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-3xl",children:t.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:t.name}),e.jsx("p",{className:"text-xs text-text-secondary",children:t.platform})]})]}),r&&e.jsxs(g,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(ee,{className:"h-3 w-3"}),"Connected"]})]}),e.jsx("p",{className:"text-xs text-text-secondary mb-4",children:t.description}),r?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs text-text-secondary",children:["Connected on ",new Date(i.connected_at).toLocaleDateString()]}),e.jsxs(o,{onClick:()=>(async e=>{try{const{error:t}=await u.from("wearable_connections").delete().eq("user_id",s.id).eq("device_id",e);if(t)throw t;h({title:"Device Disconnected",description:"Wearable device has been disconnected successfully."}),T()}catch(t){h({title:"Error",description:"Failed to disconnect device.",variant:"destructive"})}})(t.id),variant:"outline",size:"sm",className:"w-full",children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),"Disconnect"]})]}):e.jsx(o,{onClick:()=>(async e=>{if(!a)return void h({title:"Premium Feature",description:"Wearable device sync is available in Premium tier and above. Please upgrade your plan.",variant:"destructive"});const t=I.find(t=>t.id===e);if(t.requiresNativeApp)h({title:"Mobile App Required",description:`${t.name} integration requires the GreenoFig mobile app. Coming soon!`});else try{const{data:t,error:r}=await u.functions.invoke("connect-wearable",{body:{device_id:e,user_id:s.id}});if(r)throw r;t.authUrl&&(window.location.href=t.authUrl)}catch(r){h({title:"Connection Failed",description:r.message||"Failed to connect device. Please try again.",variant:"destructive"})}})(t.id),className:"w-full",size:"sm",disabled:t.requiresNativeApp,children:t.requiresNativeApp?e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"Requires Mobile App"]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"mr-2 h-4 w-4"}),"Connect"]})})]})]},t.id)})})})]}),w&&e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5"}),"Today's Activity (Synced Data)"]})}),e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-background/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(xe,{className:"h-4 w-4 text-blue-500"}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Steps"})]}),e.jsx("p",{className:"text-2xl font-bold",children:(null==(n=w.steps)?void 0:n.toLocaleString())||0}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Goal: 10,000"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-background/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ye,{className:"h-4 w-4 text-red-500"}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Calories"})]}),e.jsx("p",{className:"text-2xl font-bold",children:w.calories||0}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Burned"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-background/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(X,{className:"h-4 w-4 text-green-500"}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Active Minutes"})]}),e.jsx("p",{className:"text-2xl font-bold",children:w.activeMinutes||0}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Today"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-background/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ye,{className:"h-4 w-4 text-pink-500"}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Heart Rate"})]}),e.jsx("p",{className:"text-2xl font-bold",children:w.avgHeartRate||"--"}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Average BPM"})]})]})})]})]}):e.jsxs(_,{className:"glass-effect",children:[e.jsxs(b,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-5 w-5"}),"Wearable Device Sync"]}),e.jsx(C,{children:"Connect your fitness trackers and smartwatches"})]}),e.jsx(j,{children:e.jsxs(Wt,{children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsxs(zt,{children:[e.jsx("strong",{children:"Premium Feature"})," - Wearable device synchronization is available in Premium tier and above. Upgrade to automatically sync your steps, calories, workouts, and heart rate data."]})]})})]})},Ul=({onFoodSelected:t})=>{const{userProfile:n}=l(),[s,i]=r.useState(""),[a,f]=r.useState([]),[p,m]=r.useState(!1),[x,y]=r.useState(null),[v,w]=r.useState(!1),[A,S]=r.useState(100),[E,I]=r.useState("Foundation,SR Legacy"),T={}.VITE_USDA_API_KEY||"DEMO_KEY",D=async()=>{if(!s||s.length<2)h({title:"Search Query Too Short",description:"Please enter at least 2 characters to search"});else{m(!0),f([]);try{const e=await fetch(`https://api.nal.usda.gov/fdc/v1/foods/search?query=${encodeURIComponent(s)}&dataType=${E}&pageSize=20&api_key=${T}`);if(!e.ok)throw new Error("USDA API error: "+e.statusText);const t=await e.json();if(!t.foods||0===t.foods.length)return h({title:"No Results",description:`No foods found for "${s}". Try different keywords.`}),void m(!1);const r=t.foods.map(e=>({fdcId:e.fdcId,name:e.description||e.lowercaseDescription,brandName:e.brandName||e.brandOwner||null,dataType:e.dataType,category:e.foodCategory||null,nutrients:O(e.foodNutrients||[]),servingSize:e.servingSize||100,servingUnit:e.servingSizeUnit||"g",score:e.score||0}));f(r),h({title:"Search Complete",description:`Found ${r.length} foods`})}catch(e){h({title:"Search Failed",description:e.message||"Failed to search food database",variant:"destructive"})}finally{m(!1)}}},O=e=>{const t={calories:0,protein:0,carbs:0,fats:0,fiber:0,sugar:0,sodium:0};return e.forEach(e=>{var r;const n=(null==(r=e.nutrientName)?void 0:r.toLowerCase())||"",s=e.value||0;n.includes("energy")||n.includes("calori")?t.calories=s:n.includes("protein")?t.protein=s:n.includes("carbohydrate")?t.carbs=s:n.includes("total lipid")||n.includes("fat")?t.fats=s:n.includes("fiber")?t.fiber=s:n.includes("sugars")?t.sugar=s:n.includes("sodium")&&(t.sodium=s)}),t};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(_,{className:"glass-effect",children:[e.jsxs(b,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5"}),"USDA Food Database Search"]}),e.jsx(C,{children:"Search 100,000+ foods from the USDA FoodData Central database"})]}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(d,{type:"text",placeholder:"Search for any food (e.g., apple, chicken breast, brown rice)...",value:s,onChange:e=>i(e.target.value),onKeyPress:e=>{"Enter"===e.key&&D()}})}),e.jsx(o,{onClick:D,disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"mr-2 h-4 w-4 animate-spin"}),"Searching..."]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),"Search"]})})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"data-type",children:"Food Type Filter"}),e.jsxs(At,{value:E,onValueChange:I,children:[e.jsx(St,{id:"data-type",children:e.jsx(Et,{})}),e.jsxs(It,{children:[e.jsx(Tt,{value:"Foundation,SR Legacy",children:"All USDA Foods"}),e.jsx(Tt,{value:"Foundation",children:"Foundation Foods (Core ingredients)"}),e.jsx(Tt,{value:"SR Legacy",children:"Legacy Foods (Standardized)"}),e.jsx(Tt,{value:"Branded",children:"Branded Foods (Packaged products)"}),e.jsx(Tt,{value:"Survey (FNDDS)",children:"Survey Foods (What Americans eat)"})]})]})]}),e.jsxs(Wt,{children:[e.jsx(J,{className:"h-4 w-4"}),e.jsxs(zt,{children:[e.jsx("strong",{children:"USDA FoodData Central"})," - Official nutrient database from the U.S. Department of Agriculture. All nutrition values are per 100g unless otherwise specified."]})]})]})]}),a.length>0&&!x&&e.jsxs(_,{className:"glass-effect",children:[e.jsxs(b,{children:[e.jsxs(N,{children:["Search Results (",a.length,")"]}),e.jsx(C,{children:"Click on a food to view details and add to your meal log"})]}),e.jsx(j,{children:e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:a.map(t=>{return e.jsx("div",{onClick:()=>(async e=>{w(!0),y(e);try{const t=await fetch(`https://api.nal.usda.gov/fdc/v1/food/${e.fdcId}?api_key=${T}`);if(t.ok){const r=await t.json(),n=O(r.foodNutrients||[]);y({...e,nutrients:n,ingredients:r.ingredients||null,labelNutrients:r.labelNutrients||null})}}catch(t){}finally{w(!1)}})(t),className:"p-3 rounded-lg bg-background/50 hover:bg-background/70 cursor-pointer transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold",children:t.name}),t.brandName&&e.jsx("p",{className:"text-sm text-text-secondary",children:t.brandName}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx(g,{className:(r=t.dataType,{Foundation:"bg-green-500","SR Legacy":"bg-blue-500",Branded:"bg-purple-500","Survey (FNDDS)":"bg-orange-500"}[r]||"bg-gray-500"),variant:"secondary",children:t.dataType}),t.category&&e.jsx(g,{variant:"outline",children:t.category})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-semibold",children:[Math.round(t.nutrients.calories)," cal"]}),e.jsx("p",{className:"text-xs text-text-secondary",children:"per 100g"})]})]})},t.fdcId);var r})})})]}),x&&e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(N,{children:x.name}),x.brandName&&e.jsx(C,{children:x.brandName})]}),e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>y(null),children:e.jsx(R,{className:"h-4 w-4"})})]})}),e.jsxs(j,{className:"space-y-4",children:[v&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(re,{className:"h-8 w-8 animate-spin mx-auto text-primary"}),e.jsx("p",{className:"text-sm text-text-secondary mt-2",children:"Loading detailed nutrition..."})]}),!v&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"serving-size",children:"Serving Size (grams)"}),e.jsx(d,{id:"serving-size",type:"number",value:A,onChange:e=>S(parseInt(e.target.value)||100),min:"1",max:"10000"}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Common portions: 28g (1 oz), 100g, 227g (8 oz), 454g (1 lb)"})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-3",children:["Nutrition Facts (per ",A,"g)"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-background/50",children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Calories"}),e.jsx("p",{className:"text-xl font-bold",children:Math.round(x.nutrients.calories*(A/100))})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-background/50",children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Protein"}),e.jsxs("p",{className:"text-xl font-bold",children:[(x.nutrients.protein*(A/100)).toFixed(1),"g"]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-background/50",children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Carbs"}),e.jsxs("p",{className:"text-xl font-bold",children:[(x.nutrients.carbs*(A/100)).toFixed(1),"g"]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-background/50",children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Fats"}),e.jsxs("p",{className:"text-xl font-bold",children:[(x.nutrients.fats*(A/100)).toFixed(1),"g"]})]})]}),(x.nutrients.fiber>0||x.nutrients.sugar>0)&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[x.nutrients.fiber>0&&e.jsxs("div",{className:"p-2 rounded bg-background/30",children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Fiber"}),e.jsxs("p",{className:"font-semibold",children:[(x.nutrients.fiber*(A/100)).toFixed(1),"g"]})]}),x.nutrients.sugar>0&&e.jsxs("div",{className:"p-2 rounded bg-background/30",children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Sugar"}),e.jsxs("p",{className:"font-semibold",children:[(x.nutrients.sugar*(A/100)).toFixed(1),"g"]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{onClick:async()=>{if(x&&(null==n?void 0:n.id))try{const e=A/100,{data:r,error:s}=await u.from("meal_logs").insert({user_id:n.id,food_name:x.name,brand:x.brandName,serving_size:`${A}g`,calories:Math.round(x.nutrients.calories*e),protein:(x.nutrients.protein*e).toFixed(1),carbs:(x.nutrients.carbs*e).toFixed(1),fats:(x.nutrients.fats*e).toFixed(1),fiber:(x.nutrients.fiber*e).toFixed(1),meal_type:"snack",usda_fdc_id:x.fdcId,logged_at:(new Date).toISOString()}).select().single();if(s)throw s;h({title:"Added to Meal Log!",description:`${x.name} (${A}g) logged successfully`}),t&&t(r),y(null),f([]),i("")}catch(e){h({title:"Error",description:"Failed to add to meal log",variant:"destructive"})}},className:"flex-1",children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),"Add to Meal Log"]}),e.jsxs(o,{onClick:()=>y(null),variant:"outline",children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Cancel"]})]})]})]})]})]})},Vl=s.createContext(null),Hl=s.createContext(null),Gl=({tier:t})=>{const n=r.useMemo(()=>({id:"preview-user-id",email:"demo@greenofig.com",full_name:"Demo User",subscription_tier:t,gender:"male",age:30,weight_kg:75,height_cm:175,goal_id:"lose_weight",activity_level:"moderate",dietary_preferences:["vegetarian"],created_at:(new Date).toISOString()}),[t]),s=r.useMemo(()=>({user:{id:"preview-user-id",email:"demo@greenofig.com"},userProfile:n,signOut:()=>{}}),[n]),i=r.useMemo(()=>{const e={free:{hasAds:!0,planName:"Free",planKey:"free",features:{unlimited_meals:!1,unlimited_workouts:!1,advanced_analytics:!1,barcode_scanner:!1,food_database:!1,wearable_sync:!1,messaging:!1,video_consultations:!1,photo_recognition:!1,doctor_consultations:!1}},premium:{hasAds:!1,planName:"Premium",planKey:"premium",features:{unlimited_meals:!0,unlimited_workouts:!0,advanced_analytics:!0,barcode_scanner:!0,food_database:!0,wearable_sync:!1,messaging:!1,video_consultations:!1,photo_recognition:!1,doctor_consultations:!1}},ultimate:{hasAds:!1,planName:"Ultimate",planKey:"ultimate",features:{unlimited_meals:!0,unlimited_workouts:!0,advanced_analytics:!0,barcode_scanner:!0,food_database:!0,wearable_sync:!0,messaging:!0,video_consultations:!0,photo_recognition:!1,doctor_consultations:!1}},elite:{hasAds:!1,planName:"Elite",planKey:"elite",features:{unlimited_meals:!0,unlimited_workouts:!0,advanced_analytics:!0,barcode_scanner:!0,food_database:!0,wearable_sync:!0,messaging:!0,video_consultations:!0,photo_recognition:!0,doctor_consultations:!0}}},r=e[t]||e.free;return{hasAds:r.hasAds,planName:r.planName,planKey:r.planKey,hasAccess:e=>!0===r.features[e],canAccessFeature:e=>{const r=["free","premium","ultimate","elite"];return r.indexOf(t)>=r.indexOf(e)}}},[t]);return e.jsx(Vl.Provider,{value:s,children:e.jsx(Hl.Provider,{value:i,children:e.jsx(Wl,{})})})},Wl=()=>e.jsx("div",{className:"preview-dashboard-container",children:e.jsx(vc,{logoUrl:"/logo.png",previewMode:!0})}),zl=()=>{const e=[];for(let t=30;t>=0;t--){const r=new Date;r.setDate(r.getDate()-t);const n=78-5*((30-t)/30),s=.5*(Math.random()-.5);e.push({date:r.toISOString().split("T")[0],weight_kg:Math.round(10*(n+s))/10})}return e},Xl=()=>{const e=[];for(let t=30;t>=0;t--){const r=new Date;r.setDate(r.getDate()-t);const n=400*(Math.random()-.5),s=Math.round(1500+n);e.push({date:r.toISOString().split("T")[0],calories:Math.max(1e3,Math.min(2500,s))})}return e},Yl=()=>{const e=[];for(let t=30;t>=0;t--){const r=new Date;r.setDate(r.getDate()-t);Math.random()>.5&&e.push({date:r.toISOString().split("T")[0],duration_minutes:Math.round(30+40*Math.random()),type:["cardio","strength","yoga","hiit"][Math.floor(4*Math.random())]})}return e},ql=[{id:"mock-1",name:"Protein Power Smoothie Bowl",description:"A nutrient-packed breakfast bowl loaded with protein, antioxidants, and healthy fats to kickstart your day.",category:"breakfast",diet_type:"vegetarian",prep_time_minutes:10,servings:2,calories:320,is_active:!0,image_url:"https://images.unsplash.com/photo-1590301157890-4810ed352733?w=800",ingredients:["2 frozen bananas","1 cup frozen berries","1 scoop vanilla protein powder","1 cup almond milk","2 tbsp almond butter","1 tbsp chia seeds","Toppings: granola, fresh berries, coconut flakes"],instructions:["Add frozen bananas, berries, protein powder, and almond milk to a high-speed blender.","Blend until smooth and creamy, adding more milk if needed for desired consistency.","Pour into bowls and top with almond butter, chia seeds, and your favorite toppings.","Serve immediately and enjoy!"],nutrition_info:{protein:28,carbs:42,fat:12,fiber:8}},{id:"mock-2",name:"Grilled Chicken Quinoa Bowl",description:"A balanced, protein-rich lunch with grilled chicken, quinoa, and colorful vegetables.",category:"lunch",diet_type:"balanced",prep_time_minutes:25,servings:4,calories:485,is_active:!0,image_url:"https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=800",ingredients:["2 chicken breasts (500g)","1 cup quinoa","2 cups chicken broth","2 cups mixed greens","1 cup cherry tomatoes, halved","1 cucumber, diced","1 avocado, sliced","2 tbsp olive oil","Lemon juice, salt, pepper to taste"],instructions:["Cook quinoa in chicken broth according to package instructions.","Season chicken breasts with salt, pepper, and herbs. Grill for 6-8 minutes per side.","Prepare vegetables: halve tomatoes, dice cucumber, slice avocado.","Divide quinoa among bowls, top with sliced chicken, vegetables, and drizzle with olive oil and lemon.","Season to taste and serve warm."],nutrition_info:{protein:42,carbs:38,fat:18,fiber:7}},{id:"mock-3",name:"Vegan Buddha Bowl",description:"A complete plant-based meal with roasted chickpeas, sweet potato, and tahini dressing.",category:"dinner",diet_type:"vegan",prep_time_minutes:35,servings:2,calories:425,is_active:!0,image_url:"https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=800",ingredients:["1 can chickpeas, drained","1 large sweet potato, cubed","2 cups kale, chopped","1 cup quinoa","3 tbsp tahini","2 tbsp lemon juice","2 cups vegetable broth","Spices: cumin, paprika, garlic powder","Salt and pepper to taste"],instructions:["Preheat oven to 400F (200C). Toss sweet potato cubes and chickpeas with spices and olive oil.","Roast for 25-30 minutes until golden and crispy.","Cook quinoa in vegetable broth.","Make tahini dressing by mixing tahini, lemon juice, water, and salt.","Assemble bowls with quinoa, roasted vegetables, chickpeas, kale, and drizzle with tahini dressing."],nutrition_info:{protein:18,carbs:62,fat:14,fiber:12}},{id:"mock-4",name:"Avocado Toast with Poached Eggs",description:"Classic breakfast favorite with perfectly poached eggs and creamy avocado.",category:"breakfast",diet_type:"vegetarian",prep_time_minutes:15,servings:2,calories:380,is_active:!0,image_url:"https://images.unsplash.com/photo-1541519227354-08fa5d50c44d?w=800",ingredients:["4 slices whole grain bread","2 ripe avocados","4 eggs","1 tbsp white vinegar","Cherry tomatoes","Red pepper flakes","Salt, pepper, lemon juice"],instructions:["Toast bread slices until golden brown.","Mash avocados with lemon juice, salt, and pepper.","Bring a pot of water to simmer, add vinegar. Poach eggs for 3-4 minutes.","Spread avocado on toast, top with poached eggs.","Garnish with cherry tomatoes, red pepper flakes, and season to taste."],nutrition_info:{protein:18,carbs:32,fat:22,fiber:10}},{id:"mock-5",name:"Keto Cauliflower Pizza",description:"Low-carb pizza with cauliflower crust, perfect for keto diet enthusiasts.",category:"dinner",diet_type:"keto",prep_time_minutes:45,servings:4,calories:310,is_active:!0,image_url:"https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=800",ingredients:["1 large cauliflower head, riced","2 cups mozzarella cheese","2 eggs","1/4 cup parmesan","1 cup marinara sauce (sugar-free)","Pizza toppings: pepperoni, bell peppers, mushrooms","Italian herbs, garlic powder"],instructions:["Rice cauliflower and microwave for 5 minutes. Squeeze out excess moisture using cheesecloth.","Mix cauliflower with 1 cup mozzarella, eggs, parmesan, and seasonings.","Form into pizza crust on parchment paper and bake at 450F for 15 minutes.","Add sauce, remaining cheese, and toppings. Bake for another 10 minutes.","Let cool for 5 minutes before slicing and serving."],nutrition_info:{protein:24,carbs:12,fat:20,fiber:4}},{id:"mock-6",name:"Mediterranean Salmon with Vegetables",description:"Heart-healthy salmon with roasted Mediterranean vegetables.",category:"dinner",diet_type:"paleo",prep_time_minutes:30,servings:2,calories:520,is_active:!0,image_url:"https://images.unsplash.com/photo-1467003909585-2f8a72700288?w=800",ingredients:["2 salmon fillets (200g each)","2 zucchini, sliced","1 red bell pepper, chopped","1 cup cherry tomatoes","1/4 cup olives","3 tbsp olive oil","Fresh herbs: oregano, thyme","Lemon wedges, garlic, salt, pepper"],instructions:["Preheat oven to 400F (200C).","Arrange vegetables on a baking sheet, drizzle with olive oil, season with herbs and garlic.","Roast vegetables for 15 minutes.","Season salmon with salt, pepper, and herbs. Place on the baking sheet with vegetables.","Bake for another 12-15 minutes until salmon is cooked through. Serve with lemon wedges."],nutrition_info:{protein:38,carbs:18,fat:32,fiber:5}},{id:"mock-7",name:"Greek Yogurt Parfait",description:"Layered parfait with Greek yogurt, berries, and honey granola.",category:"breakfast",diet_type:"vegetarian",prep_time_minutes:5,servings:1,calories:285,is_active:!0,image_url:"https://images.unsplash.com/photo-1488477181946-6428a0291777?w=800",ingredients:["1 cup Greek yogurt","1/2 cup mixed berries","1/4 cup granola","1 tbsp honey","1 tbsp sliced almonds","Mint leaves for garnish"],instructions:["In a glass or bowl, layer half the Greek yogurt.","Add half the berries and a drizzle of honey.","Repeat layers with remaining yogurt and berries.","Top with granola, sliced almonds, and honey.","Garnish with mint and serve immediately."],nutrition_info:{protein:20,carbs:38,fat:8,fiber:4}},{id:"mock-8",name:"Spicy Thai Peanut Noodles",description:"Vibrant Asian-inspired noodles with vegetables and spicy peanut sauce.",category:"lunch",diet_type:"vegan",prep_time_minutes:20,servings:3,calories:395,is_active:!0,image_url:"https://images.unsplash.com/photo-1569718212165-3a8278d5f624?w=800",ingredients:["8 oz rice noodles","2 cups mixed vegetables (bell peppers, carrots, snap peas)","1/4 cup peanut butter","2 tbsp soy sauce","1 tbsp sriracha","1 tbsp maple syrup","Lime juice, garlic, ginger","Crushed peanuts, cilantro for garnish"],instructions:["Cook rice noodles according to package directions. Drain and set aside.","Stir-fry vegetables in a wok until tender-crisp.","Mix peanut butter, soy sauce, sriracha, maple syrup, lime juice, garlic, and ginger to make sauce.","Toss noodles and vegetables with the sauce until well coated.","Garnish with crushed peanuts and fresh cilantro. Serve warm or cold."],nutrition_info:{protein:14,carbs:52,fat:16,fiber:6}},{id:"mock-9",name:"Energy Balls",description:"No-bake protein-packed snack balls perfect for pre or post-workout.",category:"snack",diet_type:"vegan",prep_time_minutes:10,servings:12,calories:95,is_active:!0,image_url:"https://images.unsplash.com/photo-1607623814075-e51df1bdc82f?w=800",ingredients:["1 cup rolled oats","1/2 cup peanut butter","1/3 cup honey or maple syrup","1/4 cup dark chocolate chips","2 tbsp ground flaxseed","1 tsp vanilla extract","Pinch of salt"],instructions:["Mix all ingredients in a large bowl until well combined.","Refrigerate mixture for 30 minutes to make it easier to handle.","Roll mixture into 12 equal-sized balls using your hands.","Store in an airtight container in the refrigerator for up to 1 week.","Enjoy as a quick snack or pre-workout energy boost!"],nutrition_info:{protein:3,carbs:12,fat:5,fiber:2}},{id:"mock-10",name:"Gluten-Free Banana Pancakes",description:"Fluffy gluten-free pancakes made with ripe bananas and almond flour.",category:"breakfast",diet_type:"gluten-free",prep_time_minutes:20,servings:4,calories:245,is_active:!0,image_url:"https://images.unsplash.com/photo-1528207776546-365bb710ee93?w=800",ingredients:["2 ripe bananas, mashed","4 eggs","1 cup almond flour","1 tsp baking powder","1 tsp vanilla extract","1/2 tsp cinnamon","Pinch of salt","Coconut oil for cooking","Maple syrup and berries for serving"],instructions:["In a bowl, mash bananas until smooth.","Add eggs and vanilla extract, whisk well.","Mix in almond flour, baking powder, cinnamon, and salt until combined.","Heat coconut oil in a non-stick pan over medium heat.","Pour batter to form pancakes, cook 2-3 minutes per side until golden.","Serve with maple syrup and fresh berries."],nutrition_info:{protein:10,carbs:22,fat:14,fiber:4}},{id:"mock-11",name:"Chicken Caesar Salad Wrap",description:"Portable lunch wrap with classic Caesar flavors and grilled chicken.",category:"lunch",diet_type:"balanced",prep_time_minutes:15,servings:2,calories:405,is_active:!0,image_url:"https://images.unsplash.com/photo-1626700051175-6818013e1d4f?w=800",ingredients:["2 large whole wheat tortillas","2 grilled chicken breasts, sliced","2 cups romaine lettuce, chopped","1/4 cup parmesan cheese","1/4 cup Caesar dressing","Cherry tomatoes, halved","Croutons (optional)"],instructions:["Warm tortillas slightly to make them more pliable.","Spread Caesar dressing on each tortilla.","Layer with lettuce, sliced chicken, parmesan, and tomatoes.","Add croutons if desired for extra crunch.","Roll up tightly, cut in half, and serve immediately or wrap for later."],nutrition_info:{protein:32,carbs:28,fat:18,fiber:4}},{id:"mock-12",name:"Dark Chocolate Avocado Mousse",description:"Decadent yet healthy chocolate dessert made with avocado.",category:"dessert",diet_type:"vegan",prep_time_minutes:10,servings:4,calories:195,is_active:!0,image_url:"https://images.unsplash.com/photo-1578985545062-69928b1d9587?w=800",ingredients:["2 ripe avocados","1/4 cup cocoa powder","1/4 cup maple syrup","1/4 cup almond milk","1 tsp vanilla extract","Pinch of salt","Fresh berries and mint for garnish"],instructions:["Add all ingredients to a food processor or blender.","Blend until completely smooth and creamy, scraping down sides as needed.","Taste and adjust sweetness if desired.","Divide among serving dishes and refrigerate for at least 30 minutes.","Garnish with fresh berries and mint before serving."],nutrition_info:{protein:3,carbs:24,fat:12,fiber:7}},{id:"mock-13",name:"Turkey Meatballs with Zoodles",description:"Lean turkey meatballs served over spiralized zucchini noodles.",category:"dinner",diet_type:"paleo",prep_time_minutes:35,servings:4,calories:340,is_active:!0,image_url:"https://images.unsplash.com/photo-1529042410759-befb1204b468?w=800",ingredients:["500g ground turkey","1 egg","1/4 cup almond flour","2 cloves garlic, minced","4 zucchini, spiralized","2 cups marinara sauce","Italian herbs: basil, oregano, parsley","Salt, pepper, olive oil"],instructions:["Preheat oven to 375F (190C).","Mix ground turkey, egg, almond flour, garlic, and herbs. Form into meatballs.","Bake meatballs for 20-25 minutes until cooked through.","Heat marinara sauce in a pan, add cooked meatballs.","SautÃ© zucchini noodles in olive oil for 2-3 minutes.","Serve meatballs and sauce over zoodles, garnish with fresh herbs."],nutrition_info:{protein:35,carbs:18,fat:16,fiber:5}},{id:"mock-14",name:"Hummus & Veggie Snack Plate",description:"Colorful array of fresh vegetables with creamy homemade hummus.",category:"snack",diet_type:"vegan",prep_time_minutes:15,servings:4,calories:165,is_active:!0,image_url:"https://images.unsplash.com/photo-1621939514649-280e2ee25f60?w=800",ingredients:["1 can chickpeas","3 tbsp tahini","2 tbsp lemon juice","2 cloves garlic","Assorted vegetables: carrots, celery, bell peppers, cucumber","Olive oil, cumin, paprika","Salt to taste"],instructions:["Blend chickpeas, tahini, lemon juice, garlic, and spices until smooth.","Add water gradually to reach desired consistency.","Cut vegetables into sticks or bite-sized pieces.","Transfer hummus to a serving bowl, drizzle with olive oil and sprinkle with paprika.","Arrange vegetables around hummus and serve."],nutrition_info:{protein:6,carbs:20,fat:8,fiber:6}},{id:"mock-15",name:"Chia Seed Pudding",description:"Overnight chia pudding packed with omega-3s and fiber.",category:"breakfast",diet_type:"vegan",prep_time_minutes:5,servings:2,calories:210,is_active:!0,image_url:"https://images.unsplash.com/photo-1623428454614-abaf00244e52?w=800",ingredients:["1/4 cup chia seeds","1 cup almond milk","1 tbsp maple syrup","1/2 tsp vanilla extract","Fresh fruit for topping","Coconut flakes","Nuts or granola"],instructions:["Mix chia seeds, almond milk, maple syrup, and vanilla in a jar or bowl.","Stir well to prevent clumping.","Refrigerate for at least 4 hours or overnight, stirring once after 30 minutes.","The mixture will thicken to a pudding-like consistency.","Top with fresh fruit, coconut flakes, and nuts before serving."],nutrition_info:{protein:6,carbs:24,fat:10,fiber:11}}],Kl=({previewMode:t=!1})=>{var n,s;v();const[i,a]=r.useState([]),[l,c]=r.useState([]),[f,p]=r.useState(!0),[m,x]=r.useState(""),[y,w]=r.useState(null),[C,S]=r.useState("all"),[R,k]=r.useState("all"),[M,P]=r.useState("all"),[B,F]=r.useState([]);r.useEffect(()=>{t?(a(ql),F(["mock-1","mock-5","mock-10"]),p(!1)):(L(),U())},[t]),r.useEffect(()=>{V()},[i,m,C,R,M]);const L=async()=>{try{const{data:e,error:t}=await u.from("recipes").select("*").eq("is_active",!0).order("created_at",{ascending:!1});if(t)throw t;a(e||[])}catch(e){h({title:"Error",description:"Failed to load recipes",variant:"destructive"})}finally{p(!1)}},U=async()=>{try{const{data:{user:e}}=await u.auth.getUser();if(!e)return;const{data:t,error:r}=await u.from("user_favorite_recipes").select("recipe_id").eq("user_id",e.id);if(r)throw r;F((null==t?void 0:t.map(e=>e.recipe_id))||[])}catch(e){}},V=()=>{let e=[...i];if(m&&(e=e.filter(e=>{var t,r;return e.name.toLowerCase().includes(m.toLowerCase())||(null==(t=e.description)?void 0:t.toLowerCase().includes(m.toLowerCase()))||(null==(r=e.ingredients)?void 0:r.some(e=>e.toLowerCase().includes(m.toLowerCase())))})),"all"!==C&&(e=e.filter(e=>e.category===C)),"all"!==R&&(e=e.filter(e=>e.diet_type===R)),"all"!==M){const t=parseInt(M);e=e.filter(e=>e.prep_time_minutes<=t)}c(e)},H=async e=>{if(t){const t=B.includes(e);return F(t?B.filter(t=>t!==e):[...B,e]),void h({title:t?"Removed from favorites":"Added to favorites",description:t?"Recipe removed from your favorites":"Recipe saved to your favorites"})}try{const{data:{user:t}}=await u.auth.getUser();if(!t)return;const r=B.includes(e);r?(await u.from("user_favorite_recipes").delete().eq("user_id",t.id).eq("recipe_id",e),F(B.filter(t=>t!==e))):(await u.from("user_favorite_recipes").insert({user_id:t.id,recipe_id:e}),F([...B,e])),h({title:r?"Removed from favorites":"Added to favorites",description:r?"Recipe removed from your favorites":"Recipe saved to your favorites"})}catch(r){h({title:"Error",description:"Failed to update favorites",variant:"destructive"})}},G=e=>({vegetarian:"bg-green-500/20 text-green-300",vegan:"bg-emerald-500/20 text-emerald-300",keto:"bg-purple-500/20 text-purple-300",paleo:"bg-orange-500/20 text-orange-300","gluten-free":"bg-yellow-500/20 text-yellow-300","dairy-free":"bg-blue-500/20 text-blue-300",balanced:"bg-gray-500/20 text-gray-300"}[e]||"bg-gray-500/20 text-gray-300"),W=({recipe:t})=>{const r=B.includes(t.id);return e.jsx(_,{className:"glass-effect hover:shadow-lg transition-all duration-300 cursor-pointer group",children:e.jsxs(j,{className:"p-0",children:[t.image_url&&e.jsxs("div",{className:"relative h-48 overflow-hidden rounded-t-lg",children:[e.jsx("img",{src:t.image_url,alt:t.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}),e.jsx(o,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 bg-black/50 hover:bg-black/70",onClick:e=>{e.stopPropagation(),H(t.id)},children:e.jsx(ye,{className:"w-5 h-5 "+(r?"fill-red-500 text-red-500":"text-white")})})]}),e.jsxs("div",{className:"p-4",onClick:()=>w(t),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold line-clamp-1",children:t.name}),t.diet_type&&e.jsx(g,{className:`${G(t.diet_type)} text-xs`,children:t.diet_type})]}),e.jsx("p",{className:"text-sm text-text-secondary line-clamp-2 mb-3",children:t.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-text-secondary",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsxs("span",{children:[t.prep_time_minutes," min"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsxs("span",{children:[t.servings," servings"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_e,{className:"w-4 h-4"}),e.jsxs("span",{children:[t.calories," cal"]})]})]})]})]})})};return e.jsxs(_,{className:"glass-effect",children:[e.jsxs(b,{children:[e.jsxs(N,{className:"flex items-center gap-2 text-xl",children:[e.jsx(K,{className:"w-6 h-6 text-primary"}),"Recipe Database"]}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Discover thousands of healthy recipes tailored to your dietary needs"})]}),e.jsxs(j,{children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-text-secondary"}),e.jsx(d,{placeholder:"Search recipes, ingredients...",value:m,onChange:e=>x(e.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(At,{value:C,onValueChange:S,children:[e.jsx(St,{children:e.jsx(Et,{placeholder:"All Categories"})}),e.jsxs(It,{children:[e.jsx(Tt,{value:"all",children:"All Categories"}),e.jsx(Tt,{value:"breakfast",children:"Breakfast"}),e.jsx(Tt,{value:"lunch",children:"Lunch"}),e.jsx(Tt,{value:"dinner",children:"Dinner"}),e.jsx(Tt,{value:"snack",children:"Snack"}),e.jsx(Tt,{value:"dessert",children:"Dessert"})]})]}),e.jsxs(At,{value:R,onValueChange:k,children:[e.jsx(St,{children:e.jsx(Et,{placeholder:"All Diets"})}),e.jsxs(It,{children:[e.jsx(Tt,{value:"all",children:"All Diets"}),e.jsx(Tt,{value:"vegetarian",children:"Vegetarian"}),e.jsx(Tt,{value:"vegan",children:"Vegan"}),e.jsx(Tt,{value:"keto",children:"Keto"}),e.jsx(Tt,{value:"paleo",children:"Paleo"}),e.jsx(Tt,{value:"gluten-free",children:"Gluten-Free"}),e.jsx(Tt,{value:"dairy-free",children:"Dairy-Free"}),e.jsx(Tt,{value:"balanced",children:"Balanced"})]})]}),e.jsxs(At,{value:M,onValueChange:P,children:[e.jsx(St,{children:e.jsx(Et,{placeholder:"Max Prep Time"})}),e.jsxs(It,{children:[e.jsx(Tt,{value:"all",children:"Any Time"}),e.jsx(Tt,{value:"15",children:"Under 15 min"}),e.jsx(Tt,{value:"30",children:"Under 30 min"}),e.jsx(Tt,{value:"45",children:"Under 45 min"}),e.jsx(Tt,{value:"60",children:"Under 1 hour"})]})]})]})]}),e.jsxs(Dt,{defaultValue:"all",className:"mb-6",children:[e.jsxs(Ot,{children:[e.jsx(Rt,{value:"all",children:"All Recipes"}),e.jsxs(Rt,{value:"favorites",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Favorites (",B.length,")"]})]}),e.jsx(kt,{value:"all",children:f?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(re,{className:"w-8 h-8 animate-spin text-primary"})}):l.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map(t=>e.jsx(W,{recipe:t},t.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ve,{className:"w-16 h-16 mx-auto mb-4 text-text-secondary opacity-50"}),e.jsx("p",{className:"text-text-secondary",children:"No recipes found matching your filters"})]})}),e.jsx(kt,{value:"favorites",children:l.filter(e=>B.includes(e.id)).length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.filter(e=>B.includes(e.id)).map(t=>e.jsx(W,{recipe:t},t.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ye,{className:"w-16 h-16 mx-auto mb-4 text-text-secondary opacity-50"}),e.jsx("p",{className:"text-text-secondary",children:"No favorite recipes yet"}),e.jsx("p",{className:"text-sm text-text-secondary mt-2",children:"Click the heart icon on any recipe to add it to your favorites"})]})})]}),y&&e.jsx(A,{open:!!y,onOpenChange:()=>w(null),children:e.jsxs(E,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(I,{children:[e.jsx(T,{className:"text-2xl",children:y.name}),e.jsx(D,{children:y.description})]}),y.image_url&&e.jsx("img",{src:y.image_url,alt:y.name,className:"w-full h-64 object-cover rounded-lg"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 py-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(O,{className:"w-6 h-6 mx-auto mb-1 text-primary"}),e.jsxs("p",{className:"text-sm font-semibold",children:[y.prep_time_minutes," min"]}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Prep Time"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(we,{className:"w-6 h-6 mx-auto mb-1 text-primary"}),e.jsx("p",{className:"text-sm font-semibold",children:y.servings}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Servings"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(_e,{className:"w-6 h-6 mx-auto mb-1 text-primary"}),e.jsx("p",{className:"text-sm font-semibold",children:y.calories}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Calories"})]}),e.jsx("div",{className:"text-center",children:e.jsx(g,{className:`${G(y.diet_type)} mt-2`,children:y.diet_type})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Ingredients"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:null==(n=y.ingredients)?void 0:n.map((t,r)=>e.jsx("li",{className:"text-sm",children:t},r))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Instructions"}),e.jsx("ol",{className:"list-decimal list-inside space-y-2",children:null==(s=y.instructions)?void 0:s.map((t,r)=>e.jsx("li",{className:"text-sm",children:t},r))})]}),y.nutrition_info&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nutrition Information"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-muted p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Protein"}),e.jsxs("p",{className:"text-lg font-semibold",children:[y.nutrition_info.protein,"g"]})]}),e.jsxs("div",{className:"bg-muted p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Carbs"}),e.jsxs("p",{className:"text-lg font-semibold",children:[y.nutrition_info.carbs,"g"]})]}),e.jsxs("div",{className:"bg-muted p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Fat"}),e.jsxs("p",{className:"text-lg font-semibold",children:[y.nutrition_info.fat,"g"]})]}),e.jsxs("div",{className:"bg-muted p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Fiber"}),e.jsxs("p",{className:"text-lg font-semibold",children:[y.nutrition_info.fiber,"g"]})]})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs(o,{className:"flex-1",onClick:()=>H(y.id),children:[e.jsx(ye,{className:"w-4 h-4 mr-2 "+(B.includes(y.id)?"fill-current":"")}),B.includes(y.id)?"Remove from Favorites":"Add to Favorites"]}),e.jsx(o,{variant:"outline",onClick:()=>w(null),children:"Close"})]})]})})]})]})},Zl=()=>{const{userProfile:t}=l(),[n,s]=r.useState(new Date),[i,a]=r.useState(null),[o,c]=r.useState([]),[d,h]=r.useState({calories:2e3,protein:150,carbs:200,fat:65}),[f,p]=r.useState(!0);r.useEffect(()=>{(null==t?void 0:t.id)&&(m(),g(n),x())},[null==t?void 0:t.id,n]);const m=async()=>{try{const{data:e,error:r}=await u.from("user_macro_goals").select("*").eq("user_id",t.id).maybeSingle();if(r)throw r;e&&h({calories:e.calories_goal,protein:e.protein_goal,carbs:e.carbs_goal,fat:e.fat_goal})}catch(e){}},g=async e=>{try{const r=e.toISOString().split("T")[0],{data:n,error:s}=await u.from("daily_macros").select("*").eq("user_id",t.id).eq("date",r).maybeSingle();if(s&&"PGRST116"!==s.code)throw s;a(n||{calories:0,protein:0,carbs:0,fat:0}),p(!1)}catch(r){p(!1)}},x=async()=>{try{const e=new Date,r=new Date;r.setDate(r.getDate()-6);const{data:n,error:s}=await u.from("daily_macros").select("*").eq("user_id",t.id).gte("date",r.toISOString().split("T")[0]).lte("date",e.toISOString().split("T")[0]).order("date",{ascending:!0});if(s)throw s;c(n||[])}catch(e){}},y=e=>e<70?"text-yellow-500":e>110?"text-red-500":"text-green-500",v="#3b82f6",w="#22c55e",C="#f59e0b",A=({title:t,current:r,goal:n,unit:s,icon:i,color:a})=>{const o=((e,t)=>Math.min(Math.round(e/t*100),100))(r,n),l=((e,t)=>{const r=e/t*100;return r>110?{icon:X,color:"text-red-500",label:"Over"}:r<70?{icon:Y,color:"text-yellow-500",label:"Under"}:{icon:Me,color:"text-green-500",label:"On Track"}})(r,n),c=l.icon;return e.jsx(_,{className:"glass-effect",children:e.jsxs(j,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-2 rounded-lg bg-${a}-500/20`,children:e.jsx(i,{className:`w-5 h-5 text-${a}-500`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-text-secondary",children:t}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-2xl font-bold",children:r}),e.jsxs("span",{className:"text-sm text-text-secondary",children:["/ ",n," ",s]})]})]})]}),e.jsxs("div",{className:`flex items-center gap-1 ${l.color}`,children:[e.jsx(c,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:l.label})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-text-secondary",children:[o,"%"]}),e.jsxs("span",{className:y(o),children:[r-n>0?"+":"",r-n," ",s]})]}),e.jsx(Xt,{value:o,className:"h-2"})]})]})})},S=i?[{name:"Protein",value:i.protein,color:v},{name:"Carbs",value:i.carbs,color:w},{name:"Fat",value:i.fat,color:C}]:[],E=o.map(e=>({date:new Date(e.date).toLocaleDateString("en-US",{weekday:"short"}),calories:e.calories,protein:e.protein,carbs:e.carbs,fat:e.fat}));return e.jsxs("div",{className:"space-y-6",children:[e.jsx(_,{className:"glass-effect",children:e.jsxs(b,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-6 h-6 text-primary"}),"Macro Tracking Dashboard"]}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Track your daily macronutrients and stay on target with your goals"})]})}),e.jsxs(Dt,{defaultValue:"today",className:"w-full",children:[e.jsxs(Ot,{className:"grid w-full grid-cols-2",children:[e.jsx(Rt,{value:"today",children:"Today"}),e.jsx(Rt,{value:"week",children:"This Week"})]}),e.jsxs(kt,{value:"today",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(A,{title:"Calories",current:(null==i?void 0:i.calories)||0,goal:d.calories,unit:"kcal",icon:_e,color:"red"}),e.jsx(A,{title:"Protein",current:(null==i?void 0:i.protein)||0,goal:d.protein,unit:"g",icon:xe,color:"blue"}),e.jsx(A,{title:"Carbs",current:(null==i?void 0:i.carbs)||0,goal:d.carbs,unit:"g",icon:xe,color:"green"}),e.jsx(A,{title:"Fat",current:(null==i?void 0:i.fat)||0,goal:d.fat,unit:"g",icon:xe,color:"orange"})]}),e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsx(N,{className:"text-lg",children:"Today's Macro Distribution"})}),e.jsx(j,{children:e.jsx(be,{width:"100%",height:300,children:e.jsxs(Ne,{children:[e.jsx(je,{data:S,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,value:t})=>`${e}: ${t}g`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:S.map((t,r)=>e.jsx(Ce,{fill:t.color},`cell-${r}`))}),e.jsx(Ae,{}),e.jsx(Se,{})]})})})]}),e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsx(N,{className:"text-lg",children:"Daily Goals Summary"})}),e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-sm text-text-secondary mb-1",children:"Calories Goal"}),e.jsx("p",{className:"text-2xl font-bold",children:d.calories}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"kcal/day"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-sm text-text-secondary mb-1",children:"Protein Goal"}),e.jsxs("p",{className:"text-2xl font-bold",children:[d.protein,"g"]}),e.jsxs("p",{className:"text-xs text-text-secondary mt-1",children:[Math.round(4*d.protein/d.calories*100),"% of calories"]})]}),e.jsxs("div",{className:"text-center p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-sm text-text-secondary mb-1",children:"Carbs Goal"}),e.jsxs("p",{className:"text-2xl font-bold",children:[d.carbs,"g"]}),e.jsxs("p",{className:"text-xs text-text-secondary mt-1",children:[Math.round(4*d.carbs/d.calories*100),"% of calories"]})]}),e.jsxs("div",{className:"text-center p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-sm text-text-secondary mb-1",children:"Fat Goal"}),e.jsxs("p",{className:"text-2xl font-bold",children:[d.fat,"g"]}),e.jsxs("p",{className:"text-xs text-text-secondary mt-1",children:[Math.round(9*d.fat/d.calories*100),"% of calories"]})]})]})})]})]}),e.jsxs(kt,{value:"week",className:"space-y-6",children:[e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsx(N,{className:"text-lg",children:"7-Day Macro Trends"})}),e.jsx(j,{children:e.jsx(be,{width:"100%",height:350,children:e.jsxs(Ee,{data:E,children:[e.jsx(Ie,{strokeDasharray:"3 3"}),e.jsx(Te,{dataKey:"date"}),e.jsx(De,{}),e.jsx(Ae,{}),e.jsx(Se,{}),e.jsx(Oe,{type:"monotone",dataKey:"calories",stroke:"#ef4444",name:"Calories"}),e.jsx(Oe,{type:"monotone",dataKey:"protein",stroke:v,name:"Protein (g)"}),e.jsx(Oe,{type:"monotone",dataKey:"carbs",stroke:w,name:"Carbs (g)"}),e.jsx(Oe,{type:"monotone",dataKey:"fat",stroke:C,name:"Fat (g)"})]})})})]}),e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsx(N,{className:"text-lg",children:"Weekly Macro Comparison"})}),e.jsx(j,{children:e.jsx(be,{width:"100%",height:350,children:e.jsxs(Re,{data:E,children:[e.jsx(Ie,{strokeDasharray:"3 3"}),e.jsx(Te,{dataKey:"date"}),e.jsx(De,{}),e.jsx(Ae,{}),e.jsx(Se,{}),e.jsx(ke,{dataKey:"protein",fill:v,name:"Protein (g)"}),e.jsx(ke,{dataKey:"carbs",fill:w,name:"Carbs (g)"}),e.jsx(ke,{dataKey:"fat",fill:C,name:"Fat (g)"})]})})})]})]})]})]})},$l=()=>{const{t:t}=v(),[n,s]=r.useState([]),[i,a]=r.useState([]),[l,c]=r.useState(!0),[f,p]=r.useState(""),[m,x]=r.useState(null),[y,w]=r.useState("all"),[C,S]=r.useState("all"),[O,R]=r.useState("all"),[k,M]=r.useState([]);r.useEffect(()=>{B(),F()},[]),r.useEffect(()=>{L()},[n,f,y,C,O]);const B=async()=>{try{const{data:e,error:t}=await u.from("exercises").select("*").eq("is_active",!0).order("name",{ascending:!0});if(t)throw t;s(e||[])}catch(e){h({title:t("error")||"Error",description:t("failedToLoadExercises")||"Failed to load exercises",variant:"destructive"})}finally{c(!1)}},F=async()=>{try{const{data:{user:e}}=await u.auth.getUser();if(!e)return;const{data:t,error:r}=await u.from("user_favorite_exercises").select("exercise_id").eq("user_id",e.id);if(r)throw r;M((null==t?void 0:t.map(e=>e.exercise_id))||[])}catch(e){}},L=()=>{let e=[...n];f&&(e=e.filter(e=>{var t,r;return e.name.toLowerCase().includes(f.toLowerCase())||(null==(t=e.description)?void 0:t.toLowerCase().includes(f.toLowerCase()))||(null==(r=e.muscle_group)?void 0:r.toLowerCase().includes(f.toLowerCase()))})),"all"!==y&&(e=e.filter(e=>e.muscle_group===y)),"all"!==C&&(e=e.filter(e=>e.equipment===C)),"all"!==O&&(e=e.filter(e=>e.difficulty===O)),a(e)},U=async e=>{try{const{data:{user:r}}=await u.auth.getUser();if(!r)return;const n=k.includes(e);n?(await u.from("user_favorite_exercises").delete().eq("user_id",r.id).eq("exercise_id",e),M(k.filter(t=>t!==e))):(await u.from("user_favorite_exercises").insert({user_id:r.id,exercise_id:e}),M([...k,e])),h({title:n?t("removedFromFavorites")||"Removed from favorites":t("addedToFavorites")||"Added to favorites",description:n?t("exerciseRemovedFromFavorites")||"Exercise removed from your favorites":t("exerciseSavedToFavorites")||"Exercise saved to your favorites"})}catch(r){h({title:t("error")||"Error",description:t("failedToUpdateFavorites")||"Failed to update favorites",variant:"destructive"})}},H=e=>({beginner:"bg-green-500/20 text-green-300",intermediate:"bg-yellow-500/20 text-yellow-300",advanced:"bg-red-500/20 text-red-300"}[e]||"bg-gray-500/20 text-gray-300"),G=e=>({chest:"bg-blue-500/20 text-blue-300",back:"bg-purple-500/20 text-purple-300",shoulders:"bg-orange-500/20 text-orange-300",arms:"bg-pink-500/20 text-pink-300",legs:"bg-green-500/20 text-green-300",core:"bg-yellow-500/20 text-yellow-300",fullBody:"bg-red-500/20 text-red-300"}[e]||"bg-gray-500/20 text-gray-300"),W=({exercise:t})=>{const r=k.includes(t.id);return e.jsx(_,{className:"glass-effect hover:shadow-lg transition-all duration-300 cursor-pointer group",children:e.jsxs(j,{className:"p-0",children:[t.thumbnail_url&&e.jsxs("div",{className:"relative h-48 overflow-hidden rounded-t-lg",children:[e.jsx("img",{src:t.thumbnail_url,alt:t.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}),e.jsx(o,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 bg-black/50 hover:bg-black/70",onClick:e=>{e.stopPropagation(),U(t.id)},children:e.jsx(ye,{className:"w-5 h-5 "+(r?"fill-red-500 text-red-500":"text-white")})}),t.video_url&&e.jsx("div",{className:"absolute bottom-2 left-2 bg-black/70 rounded-full p-2",children:e.jsx(P,{className:"w-4 h-4 text-white"})})]}),e.jsxs("div",{className:"p-4",onClick:()=>x(t),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold line-clamp-1",children:t.name}),e.jsx(g,{className:`${H(t.difficulty)} text-xs ml-2`,children:t.difficulty})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(g,{className:`${G(t.muscle_group)} text-xs`,children:t.muscle_group}),t.equipment&&e.jsx(g,{className:"bg-gray-500/20 text-gray-300 text-xs",children:t.equipment})]}),e.jsx("p",{className:"text-sm text-text-secondary line-clamp-2",children:t.description})]})]})})};return e.jsxs(_,{className:"glass-effect",children:[e.jsxs(b,{children:[e.jsxs(N,{className:"flex items-center gap-2 text-xl",children:[e.jsx(V,{className:"w-6 h-6 text-primary"}),t("exerciseLibrary")||"Exercise Library"]}),e.jsx("p",{className:"text-sm text-text-secondary",children:t("exerciseLibraryDescription")||"Browse our comprehensive exercise library with video demonstrations and detailed instructions"})]}),e.jsxs(j,{children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-text-secondary"}),e.jsx(d,{placeholder:t("searchExercises")||"Search exercises...",value:f,onChange:e=>p(e.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(At,{value:y,onValueChange:w,children:[e.jsx(St,{children:e.jsx(Et,{placeholder:t("allMuscleGroups")||"All Muscle Groups"})}),e.jsxs(It,{children:[e.jsx(Tt,{value:"all",children:t("allMuscleGroups")||"All Muscle Groups"}),e.jsx(Tt,{value:"chest",children:t("chest")||"Chest"}),e.jsx(Tt,{value:"back",children:t("back")||"Back"}),e.jsx(Tt,{value:"shoulders",children:t("shoulders")||"Shoulders"}),e.jsx(Tt,{value:"arms",children:t("arms")||"Arms"}),e.jsx(Tt,{value:"legs",children:t("legs")||"Legs"}),e.jsx(Tt,{value:"core",children:t("core")||"Core"}),e.jsx(Tt,{value:"fullBody",children:t("fullBody")||"Full Body"})]})]}),e.jsxs(At,{value:C,onValueChange:S,children:[e.jsx(St,{children:e.jsx(Et,{placeholder:t("allEquipment")||"All Equipment"})}),e.jsxs(It,{children:[e.jsx(Tt,{value:"all",children:t("allEquipment")||"All Equipment"}),e.jsx(Tt,{value:"bodyweight",children:t("bodyweight")||"Bodyweight"}),e.jsx(Tt,{value:"dumbbells",children:t("dumbbells")||"Dumbbells"}),e.jsx(Tt,{value:"barbell",children:t("barbell")||"Barbell"}),e.jsx(Tt,{value:"machine",children:t("machine")||"Machine"}),e.jsx(Tt,{value:"cables",children:t("cables")||"Cables"}),e.jsx(Tt,{value:"kettlebell",children:t("kettlebell")||"Kettlebell"}),e.jsx(Tt,{value:"bands",children:t("bands")||"Resistance Bands"})]})]}),e.jsxs(At,{value:O,onValueChange:R,children:[e.jsx(St,{children:e.jsx(Et,{placeholder:t("allDifficulties")||"All Difficulties"})}),e.jsxs(It,{children:[e.jsx(Tt,{value:"all",children:t("allDifficulties")||"All Difficulties"}),e.jsx(Tt,{value:"beginner",children:t("beginner")||"Beginner"}),e.jsx(Tt,{value:"intermediate",children:t("intermediate")||"Intermediate"}),e.jsx(Tt,{value:"advanced",children:t("advanced")||"Advanced"})]})]})]})]}),e.jsxs(Dt,{defaultValue:"all",className:"mb-6",children:[e.jsxs(Ot,{children:[e.jsx(Rt,{value:"all",children:t("allExercises")||"All Exercises"}),e.jsxs(Rt,{value:"favorites",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),t("favorites")||"Favorites"," (",k.length,")"]})]}),e.jsx(kt,{value:"all",children:l?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(re,{className:"w-8 h-8 animate-spin text-primary"})}):i.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(t=>e.jsx(W,{exercise:t},t.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(V,{className:"w-16 h-16 mx-auto mb-4 text-text-secondary opacity-50"}),e.jsx("p",{className:"text-text-secondary",children:t("noExercisesFound")||"No exercises found matching your filters"})]})}),e.jsx(kt,{value:"favorites",children:i.filter(e=>k.includes(e.id)).length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.filter(e=>k.includes(e.id)).map(t=>e.jsx(W,{exercise:t},t.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ye,{className:"w-16 h-16 mx-auto mb-4 text-text-secondary opacity-50"}),e.jsx("p",{className:"text-text-secondary",children:t("noFavoriteExercises")||"No favorite exercises yet"}),e.jsx("p",{className:"text-sm text-text-secondary mt-2",children:t("clickHeartToAddFavorites")||"Click the heart icon on any exercise to add it to your favorites"})]})})]}),m&&e.jsx(A,{open:!!m,onOpenChange:()=>x(null),children:e.jsxs(E,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(I,{children:[e.jsxs(T,{className:"text-2xl flex items-center justify-between",children:[m.name,e.jsx(g,{className:H(m.difficulty),children:m.difficulty})]}),e.jsx(D,{children:m.description})]}),m.video_url&&e.jsx("div",{className:"w-full rounded-lg overflow-hidden bg-black",children:e.jsxs("video",{controls:!0,className:"w-full",poster:m.thumbnail_url,children:[e.jsx("source",{src:m.video_url,type:"video/mp4"}),"Your browser does not support the video tag."]})}),!m.video_url&&m.thumbnail_url&&e.jsx("img",{src:m.thumbnail_url,alt:m.name,className:"w-full h-64 object-cover rounded-lg"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 py-4",children:[e.jsxs("div",{className:"text-center p-3 bg-muted rounded-lg",children:[e.jsx(g,{className:G(m.muscle_group),children:m.muscle_group}),e.jsx("p",{className:"text-xs text-text-secondary mt-2",children:t("muscleGroup")||"Muscle Group"})]}),e.jsxs("div",{className:"text-center p-3 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-sm font-semibold",children:m.equipment||"Bodyweight"}),e.jsx("p",{className:"text-xs text-text-secondary",children:t("equipment")||"Equipment"})]}),e.jsxs("div",{className:"text-center p-3 bg-muted rounded-lg",children:[e.jsx(g,{className:H(m.difficulty),children:m.difficulty}),e.jsx("p",{className:"text-xs text-text-secondary mt-2",children:t("difficulty")||"Difficulty"})]})]}),e.jsxs("div",{className:"space-y-4",children:[m.instructions&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2 flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-primary"}),t("properForm")||"Proper Form & Instructions"]}),e.jsx("ol",{className:"list-decimal list-inside space-y-2",children:m.instructions.map((t,r)=>e.jsx("li",{className:"text-sm",children:t},r))})]}),m.tips&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:t("tipsAndSafety")||"Tips & Safety"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:m.tips.map((t,r)=>e.jsx("li",{className:"text-sm text-text-secondary",children:t},r))})]}),m.target_muscles&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:t("targetMuscles")||"Target Muscles"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:m.target_muscles.map((t,r)=>e.jsx(g,{variant:"outline",children:t},r))})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs(o,{className:"flex-1",onClick:()=>U(m.id),children:[e.jsx(ye,{className:"w-4 h-4 mr-2 "+(k.includes(m.id)?"fill-current":"")}),k.includes(m.id)?t("removeFromFavorites")||"Remove from Favorites":t("addToFavorites")||"Add to Favorites"]}),e.jsx(o,{variant:"outline",onClick:()=>x(null),children:t("close")||"Close"})]})]})})]})]})},Ql=()=>{const{t:t}=v(),{userProfile:n}=l(),[s,i]=r.useState(!0),[a,p]=r.useState([]),[m,x]=r.useState(!1),[y,w]=r.useState(null),[C,O]=r.useState({title:"",description:"",category:"weight",target_value:"",current_value:"",unit:"kg",start_date:(new Date).toISOString().split("T")[0],target_date:"",milestones:[]});r.useEffect(()=>{(null==n?void 0:n.id)&&R()},[null==n?void 0:n.id]);const R=async()=>{try{const{data:e,error:t}=await u.from("user_goals_tracking").select("*").eq("user_id",n.id).order("created_at",{ascending:!1});if(t)throw t;p(e||[])}catch(e){h({title:t("error")||"Error",description:t("failedToLoadGoals")||"Failed to load goals",variant:"destructive"})}finally{i(!1)}},k=()=>{O({title:"",description:"",category:"weight",target_value:"",current_value:"",unit:"kg",start_date:(new Date).toISOString().split("T")[0],target_date:"",milestones:[]}),w(null)},M=e=>({weight:"âš–ï¸",fitness:"ðŸ’ª",nutrition:"ðŸ¥—",sleep:"ðŸ˜´",hydration:"ðŸ’§",custom:"ðŸŽ¯"}[e]||"ðŸŽ¯"),P=[{value:"weight",label:t("weight")||"Weight"},{value:"fitness",label:t("fitness")||"Fitness"},{value:"nutrition",label:t("nutrition")||"Nutrition"},{value:"sleep",label:t("sleep")||"Sleep"},{value:"hydration",label:t("hydration")||"Hydration"},{value:"custom",label:t("custom")||"Custom"}],B=a.filter(e=>"active"===e.status),F=a.filter(e=>"completed"===e.status),L=({goal:r})=>{const n=(e=>{const t=Math.abs(e.target_value-parseFloat(e.current_value||0)),r=Math.abs(parseFloat(e.current_value||0)-parseFloat(e.start_value||e.current_value)),n=0!==e.target_value?r/t*100:0;return Math.min(Math.max(n,0),100)})(r),s=(e=>{const t=new Date,r=new Date(e)-t;return Math.ceil(r/864e5)})(r.target_date),i=s<0;return e.jsx(_,{className:"glass-effect hover:shadow-lg transition-all duration-300",children:e.jsxs(j,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("span",{className:"text-3xl",children:M(r.category)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold mb-1",children:r.title}),r.description&&e.jsx("p",{className:"text-sm text-text-secondary mb-2",children:r.description}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(g,{className:(a=r.category,{weight:"bg-green-500/20 text-green-300",fitness:"bg-blue-500/20 text-blue-300",nutrition:"bg-orange-500/20 text-orange-300",sleep:"bg-purple-500/20 text-purple-300",hydration:"bg-cyan-500/20 text-cyan-300",custom:"bg-gray-500/20 text-gray-300"}[a]||"bg-gray-500/20 text-gray-300"),children:r.category}),"completed"===r.status&&e.jsxs(g,{className:"bg-green-500/20 text-green-300",children:[e.jsx(ee,{className:"w-3 h-3 mr-1"}),"Completed"]})]})]})]}),e.jsxs("div",{className:"flex gap-1",children:["active"===r.status&&e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>(e=>{w(e),O({title:e.title,description:e.description||"",category:e.category,target_value:e.target_value.toString(),current_value:e.current_value.toString(),unit:e.unit,start_date:e.start_date,target_date:e.target_date,milestones:e.milestones||[]}),x(!0)})(r),children:e.jsx(Fe,{className:"w-4 h-4"})}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>(async e=>{try{const{error:r}=await u.from("user_goals_tracking").delete().eq("id",e);if(r)throw r;h({title:t("goalDeleted")||"Goal Deleted",description:t("goalDeletedSuccessfully")||"Goal has been deleted"}),R()}catch(r){h({title:t("error")||"Error",description:t("failedToDeleteGoal")||"Failed to delete goal",variant:"destructive"})}})(r.id),children:e.jsx(Le,{className:"w-4 h-4 text-red-500"})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-text-secondary",children:"Progress"}),e.jsxs("span",{className:"font-semibold",children:[r.current_value," / ",r.target_value," ",r.unit]})]}),e.jsx(Xt,{value:n,className:"h-3"}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-text-secondary",children:[e.jsxs("span",{children:[n.toFixed(0),"% Complete"]}),"active"===r.status&&e.jsx("span",{className:i?"text-red-500":"",children:i?"Overdue":`${s} days left`})]})]}),"active"===r.status&&e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx(d,{type:"number",placeholder:"Update progress",defaultValue:r.current_value,className:"flex-1",id:`progress-${r.id}`}),e.jsx(o,{size:"sm",onClick:()=>{const e=document.getElementById(`progress-${r.id}`);(async(e,r)=>{try{const{error:n}=await u.from("user_goals_tracking").update({current_value:r}).eq("id",e.id);if(n)throw n;h({title:t("progressUpdated")||"Progress Updated",description:t("goalProgressUpdated")||"Your progress has been updated"}),R()}catch(n){h({title:t("error")||"Error",description:t("failedToUpdateProgress")||"Failed to update progress",variant:"destructive"})}})(r,parseFloat(e.value))},children:"Update"}),n>=100&&e.jsxs(o,{size:"sm",variant:"default",onClick:()=>(async e=>{try{const{error:r}=await u.from("user_goals_tracking").update({status:"completed",completed_date:(new Date).toISOString().split("T")[0]}).eq("id",e.id);if(r)throw r;h({title:"ðŸŽ‰ "+(t("congratulations")||"Congratulations!"),description:t("goalCompleted")||`You've achieved your goal: ${e.title}!`}),R()}catch(r){h({title:t("error")||"Error",description:t("failedToCompleteGoal")||"Failed to complete goal",variant:"destructive"})}})(r),className:"bg-green-600 hover:bg-green-700",children:[e.jsx(Be,{className:"w-4 h-4 mr-1"}),"Complete"]})]})]})});var a};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(_,{className:"glass-effect",children:e.jsx(b,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(N,{className:"flex items-center gap-2 text-xl",children:[e.jsx(Me,{className:"w-6 h-6 text-primary"}),t("goalTracking")||"Goal Tracking"]}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:t("goalTrackingDescription")||"Set SMART goals and track your progress with milestones"})]}),e.jsxs(A,{open:m,onOpenChange:e=>{x(e),e||k()},children:[e.jsx(S,{asChild:!0,children:e.jsxs(o,{children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),t("newGoal")||"New Goal"]})}),e.jsxs(E,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(I,{children:[e.jsx(T,{children:y?t("editGoal")||"Edit Goal":t("createNewGoal")||"Create New Goal"}),e.jsx(D,{children:t("goalDescription")||"Set a SMART goal (Specific, Measurable, Achievable, Relevant, Time-bound)"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"title",children:t("goalTitle")||"Goal Title"}),e.jsx(d,{id:"title",value:C.title,onChange:e=>O(t=>({...t,title:e.target.value})),placeholder:"e.g., Lose 10kg in 3 months"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"description",children:t("description")||"Description"}),e.jsx(f,{id:"description",value:C.description,onChange:e=>O(t=>({...t,description:e.target.value})),placeholder:"Describe your goal and why it's important to you"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"category",children:t("category")||"Category"}),e.jsxs(At,{value:C.category,onValueChange:e=>O(t=>({...t,category:e})),children:[e.jsx(St,{children:e.jsx(Et,{})}),e.jsx(It,{children:P.map(t=>e.jsxs(Tt,{value:t.value,children:[M(t.value)," ",t.label]},t.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"current_value",children:t("currentValue")||"Current Value"}),e.jsx(d,{id:"current_value",type:"number",value:C.current_value,onChange:e=>O(t=>({...t,current_value:e.target.value}))})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"target_value",children:t("targetValue")||"Target Value"}),e.jsx(d,{id:"target_value",type:"number",value:C.target_value,onChange:e=>O(t=>({...t,target_value:e.target.value}))})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"unit",children:t("unit")||"Unit"}),e.jsx(d,{id:"unit",value:C.unit,onChange:e=>O(t=>({...t,unit:e.target.value})),placeholder:"kg, hrs, reps"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"start_date",children:t("startDate")||"Start Date"}),e.jsx(d,{id:"start_date",type:"date",value:C.start_date,onChange:e=>O(t=>({...t,start_date:e.target.value}))})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"target_date",children:t("targetDate")||"Target Date"}),e.jsx(d,{id:"target_date",type:"date",value:C.target_date,onChange:e=>O(t=>({...t,target_date:e.target.value}))})]})]}),e.jsxs(o,{onClick:async()=>{try{const e={user_id:n.id,title:C.title,description:C.description,category:C.category,target_value:parseFloat(C.target_value),current_value:parseFloat(C.current_value),unit:C.unit,start_date:C.start_date,target_date:C.target_date,milestones:C.milestones,status:"active"};if(y){const{error:r}=await u.from("user_goals_tracking").update(e).eq("id",y.id);if(r)throw r;h({title:t("goalUpdated")||"Goal Updated",description:t("goalUpdatedSuccessfully")||"Your goal has been updated successfully"})}else{const{error:r}=await u.from("user_goals_tracking").insert(e);if(r)throw r;h({title:t("goalCreated")||"Goal Created",description:t("goalCreatedSuccessfully")||"Your goal has been created successfully"})}x(!1),k(),R()}catch(e){h({title:t("error")||"Error",description:t("failedToSaveGoal")||"Failed to save goal",variant:"destructive"})}},className:"w-full",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),y?t("updateGoal")||"Update Goal":t("createGoal")||"Create Goal"]})]})]})]})]})})}),s?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(re,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs(Dt,{defaultValue:"active",className:"w-full",children:[e.jsxs(Ot,{className:"grid w-full grid-cols-3",children:[e.jsxs(Rt,{value:"active",children:[t("activeGoals")||"Active"," (",B.length,")"]}),e.jsxs(Rt,{value:"completed",children:[t("completed")||"Completed"," (",F.length,")"]}),e.jsxs(Rt,{value:"all",children:[t("allGoals")||"All"," (",a.length,")"]})]}),e.jsx(kt,{value:"active",className:"space-y-4",children:B.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:B.map(t=>e.jsx(L,{goal:t},t.id))}):e.jsx(_,{className:"glass-effect",children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Me,{className:"w-16 h-16 mb-4 text-text-secondary opacity-50"}),e.jsx("p",{className:"text-text-secondary mb-4",children:t("noActiveGoals")||"No active goals"}),e.jsxs(o,{onClick:()=>x(!0),children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),t("setFirstGoal")||"Set Your First Goal"]})]})})}),e.jsx(kt,{value:"completed",className:"space-y-4",children:F.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:F.map(t=>e.jsx(L,{goal:t},t.id))}):e.jsx(_,{className:"glass-effect",children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Be,{className:"w-16 h-16 mb-4 text-text-secondary opacity-50"}),e.jsx("p",{className:"text-text-secondary",children:t("noCompletedGoals")||"No completed goals yet"})]})})}),e.jsx(kt,{value:"all",className:"space-y-4",children:a.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:a.map(t=>e.jsx(L,{goal:t},t.id))}):e.jsx(_,{className:"glass-effect",children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Me,{className:"w-16 h-16 mb-4 text-text-secondary opacity-50"}),e.jsx("p",{className:"text-text-secondary mb-4",children:t("noGoalsYet")||"No goals set yet"}),e.jsxs(o,{onClick:()=>x(!0),children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),t("createYourFirstGoal")||"Create Your First Goal"]})]})})})]})]})},Jl=()=>{const{t:t}=v(),{userProfile:n}=l(),[s,i]=r.useState(!0),[a,o]=r.useState({workout:{current:0,best:0,lastDate:null},water:{current:0,best:0,lastDate:null},sleep:{current:0,best:0,lastDate:null},meal:{current:0,best:0,lastDate:null}}),[c,d]=r.useState([]);r.useEffect(()=>{(null==n?void 0:n.id)&&(h(),m())},[null==n?void 0:n.id]);const h=async()=>{try{const e=(new Date).toISOString().split("T")[0],t=new Date(Date.now()-2592e6).toISOString().split("T")[0],[r,n,s,i]=await Promise.all([f("workout_logs",t,e),f("water_logs",t,e),f("sleep_logs",t,e),f("meal_logs",t,e)]);o({workout:p(r),water:p(n),sleep:p(s),meal:p(i)})}catch(e){}finally{i(!1)}},f=async(e,t,r)=>{const{data:s,error:i}=await u.from(e).select("date").eq("user_id",n.id).gte("date",t).lte("date",r).order("date",{ascending:!1});if(i)throw i;return s||[]},p=e=>{if(0===e.length)return{current:0,best:0,lastDate:null};const t=e.map(e=>e.date).sort().reverse();let r=0,n=0,s=1;const i=(new Date).toISOString().split("T")[0],a=new Date(Date.now()-864e5).toISOString().split("T")[0];if(t[0]===i||t[0]===a){r=1;for(let e=1;e<t.length;e++){if(1!==(new Date(t[e-1])-new Date(t[e]))/864e5)break;r++,s++}}for(let o=1;o<t.length;o++){1===(new Date(t[o-1])-new Date(t[o]))/864e5?(s++,n=Math.max(n,s)):s=1}return n=Math.max(n,r),{current:r,best:n,lastDate:t[0]}},m=async()=>{const e=[{id:1,title:"7-Day Warrior",description:"7 day workout streak",icon:"ðŸ”¥",unlocked:a.workout.current>=7},{id:2,title:"Hydration Hero",description:"14 day water streak",icon:"ðŸ’§",unlocked:a.water.current>=14},{id:3,title:"Sleep Master",description:"30 day sleep streak",icon:"ðŸ˜´",unlocked:a.sleep.current>=30},{id:4,title:"Consistency King",description:"21 day meal tracking streak",icon:"ðŸ½ï¸",unlocked:a.meal.current>=21},{id:5,title:"Century Club",description:"100 day any streak",icon:"ðŸ’¯",unlocked:Object.values(a).some(e=>e.best>=100)}];d(e)},x=(e,t)=>0===e?"text-gray-500":e===t&&e>=7?"text-yellow-500":e>=5?"text-orange-500":"text-primary",y=({title:t,icon:r,current:n,best:s,color:i})=>e.jsx(_,{className:"glass-effect hover:shadow-lg transition-all",children:e.jsxs(j,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"text-3xl",children:r}),e.jsx(_e,{className:`w-6 h-6 ${x(n,s)}`})]}),e.jsx("h3",{className:"text-lg font-semibold mb-1",children:t}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:`text-4xl font-bold ${x(n,s)}`,children:n}),e.jsx("span",{className:"text-sm text-text-secondary",children:"days"})]}),e.jsxs("div",{className:"mt-2 text-xs text-text-secondary",children:[e.jsx(Be,{className:"w-3 h-3 inline mr-1"}),"Best: ",s," days"]})]})});return e.jsxs("div",{className:"space-y-6",children:[e.jsx(_,{className:"glass-effect",children:e.jsxs(b,{children:[e.jsxs(N,{className:"flex items-center gap-2 text-xl",children:[e.jsx(_e,{className:"w-6 h-6 text-primary"}),t("healthStreaks")||"Health Streaks"]}),e.jsx("p",{className:"text-sm text-text-secondary",children:t("healthStreaksDescription")||"Track your consistency and build healthy habits"})]})}),s?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(re,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(y,{title:"Workout Streak",icon:"ðŸ’ª",current:a.workout.current,best:a.workout.best}),e.jsx(y,{title:"Water Streak",icon:"ðŸ’§",current:a.water.current,best:a.water.best}),e.jsx(y,{title:"Sleep Streak",icon:"ðŸ˜´",current:a.sleep.current,best:a.sleep.best}),e.jsx(y,{title:"Meal Tracking",icon:"ðŸ½ï¸",current:a.meal.current,best:a.meal.best})]}),e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsxs(N,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5 text-primary"}),t("achievements")||"Achievements & Badges"]})}),e.jsx(j,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:c.map(t=>e.jsxs("div",{className:"p-4 rounded-lg text-center transition-all "+(t.unlocked?"bg-primary/20 border-2 border-primary":"bg-muted opacity-50"),children:[e.jsx("div",{className:"text-4xl mb-2",children:t.icon}),e.jsx("h4",{className:"font-semibold text-sm mb-1",children:t.title}),e.jsx("p",{className:"text-xs text-text-secondary",children:t.description}),t.unlocked&&e.jsxs(g,{className:"mt-2 bg-green-500/20 text-green-300",children:[e.jsx(Ve,{className:"w-3 h-3 mr-1"}),"Unlocked"]})]},t.id))})})]}),e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsx(N,{className:"text-lg",children:t("motivationalTips")||"Keep Your Streak Going!"})}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-muted rounded-lg",children:[e.jsx($,{className:"w-5 h-5 text-yellow-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm",children:"Don't break the chain!"}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Consistency is key to building lasting habits"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-muted rounded-lg",children:[e.jsx(X,{className:"w-5 h-5 text-green-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm",children:"Small steps lead to big results"}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Every day counts towards your health journey"})]})]})]})})]})]})]})},ec=()=>{const{t:t}=v(),{userProfile:n}=l(),[s,i]=r.useState(!0),[a,f]=r.useState([]),[p,m]=r.useState(!1),[x,y]=r.useState(null),[w,C]=r.useState({title:"",type:"meal",time:"09:00",days:["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],enabled:!0,message:""});r.useEffect(()=>{(null==n?void 0:n.id)&&R()},[null==n?void 0:n.id]);const R=async()=>{try{const{data:e,error:t}=await u.from("user_notifications").select("*").eq("user_id",n.id).order("time",{ascending:!0});if(t)throw t;f(e||[])}catch(e){h({title:t("error")||"Error",description:t("failedToLoadNotifications")||"Failed to load notifications",variant:"destructive"})}finally{i(!1)}},k=()=>{C({title:"",type:"meal",time:"09:00",days:["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],enabled:!0,message:""}),y(null)},M=e=>({meal:"ðŸ½ï¸",workout:"ðŸ’ª",water:"ðŸ’§",sleep:"ðŸ˜´",medication:"ðŸ’Š",custom:"ðŸ””"}[e]||"ðŸ””"),P=e=>({meal:"bg-orange-500/20 text-orange-300",workout:"bg-blue-500/20 text-blue-300",water:"bg-cyan-500/20 text-cyan-300",sleep:"bg-purple-500/20 text-purple-300",medication:"bg-red-500/20 text-red-300",custom:"bg-gray-500/20 text-gray-300"}[e]||"bg-gray-500/20 text-gray-300"),B=[{value:"meal",label:t("meal")||"Meal Reminder"},{value:"workout",label:t("workout")||"Workout Reminder"},{value:"water",label:t("water")||"Water Reminder"},{value:"sleep",label:t("sleep")||"Sleep Reminder"},{value:"medication",label:t("medication")||"Medication Reminder"},{value:"custom",label:t("custom")||"Custom Reminder"}],F=a.reduce((e,t)=>(e[t.type]||(e[t.type]=[]),e[t.type].push(t),e),{});return e.jsxs("div",{className:"space-y-6",children:[e.jsx(_,{className:"glass-effect",children:e.jsx(b,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(N,{className:"flex items-center gap-2 text-xl",children:[e.jsx(He,{className:"w-6 h-6 text-primary"}),t("customNotifications")||"Custom Notifications"]}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:t("customNotificationsDescription")||"Set up personalized reminders for your health goals"})]}),e.jsxs(A,{open:p,onOpenChange:e=>{m(e),e||k()},children:[e.jsx(S,{asChild:!0,children:e.jsxs(o,{children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),t("addReminder")||"Add Reminder"]})}),e.jsxs(E,{className:"max-w-2xl",children:[e.jsxs(I,{children:[e.jsx(T,{children:x?t("editReminder")||"Edit Reminder":t("createNewReminder")||"Create New Reminder"}),e.jsx(D,{children:t("reminderDescription")||"Set up a custom reminder for your health routine"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"title",children:t("title")||"Title"}),e.jsx(d,{id:"title",value:w.title,onChange:e=>C(t=>({...t,title:e.target.value})),placeholder:t("enterReminderTitle")||"Enter reminder title"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"type",children:t("type")||"Type"}),e.jsxs(At,{value:w.type,onValueChange:e=>C(t=>({...t,type:e})),children:[e.jsx(St,{children:e.jsx(Et,{})}),e.jsx(It,{children:B.map(t=>e.jsxs(Tt,{value:t.value,children:[M(t.value)," ",t.label]},t.value))})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"time",children:t("time")||"Time"}),e.jsx(d,{id:"time",type:"time",value:w.time,onChange:e=>C(t=>({...t,time:e.target.value}))})]}),e.jsxs("div",{children:[e.jsx(c,{children:t("repeatOn")||"Repeat On"}),e.jsx("div",{className:"flex gap-2 mt-2",children:[{id:"monday",label:"Mon"},{id:"tuesday",label:"Tue"},{id:"wednesday",label:"Wed"},{id:"thursday",label:"Thu"},{id:"friday",label:"Fri"},{id:"saturday",label:"Sat"},{id:"sunday",label:"Sun"}].map(t=>e.jsx(o,{variant:w.days.includes(t.id)?"default":"outline",size:"sm",onClick:()=>(e=>{C(t=>({...t,days:t.days.includes(e)?t.days.filter(t=>t!==e):[...t.days,e]}))})(t.id),className:"flex-1",children:t.label},t.id))})]}),e.jsxs("div",{children:[e.jsxs(c,{htmlFor:"message",children:[t("message")||"Message"," (",t("optional")||"Optional",")"]}),e.jsx(d,{id:"message",value:w.message,onChange:e=>C(t=>({...t,message:e.target.value})),placeholder:t("enterCustomMessage")||"Enter custom message"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[e.jsx(c,{htmlFor:"enabled",children:t("enabledReminder")||"Enabled"}),e.jsx(Yt,{id:"enabled",checked:w.enabled,onCheckedChange:e=>C(t=>({...t,enabled:e}))})]}),e.jsxs(o,{onClick:async()=>{try{if(x){const{error:e}=await u.from("user_notifications").update({title:w.title,type:w.type,time:w.time,days:w.days,enabled:w.enabled,message:w.message}).eq("id",x.id);if(e)throw e;h({title:t("notificationUpdated")||"Notification Updated",description:t("notificationUpdatedSuccessfully")||"Notification has been updated successfully"})}else{const{error:e}=await u.from("user_notifications").insert({user_id:n.id,title:w.title,type:w.type,time:w.time,days:w.days,enabled:w.enabled,message:w.message});if(e)throw e;h({title:t("notificationCreated")||"Notification Created",description:t("notificationCreatedSuccessfully")||"Notification has been created successfully"})}m(!1),k(),R()}catch(e){h({title:t("error")||"Error",description:t("failedToSaveNotification")||"Failed to save notification",variant:"destructive"})}},className:"w-full",children:[e.jsx(Ge,{className:"w-4 h-4 mr-2"}),x?t("updateReminder")||"Update Reminder":t("createReminder")||"Create Reminder"]})]})]})]})]})})}),s?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(re,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs(Dt,{defaultValue:"all",className:"w-full",children:[e.jsxs(Ot,{children:[e.jsxs(Rt,{value:"all",children:[t("allReminders")||"All Reminders"," (",a.length,")"]}),e.jsxs(Rt,{value:"active",children:[t("active")||"Active"," (",a.filter(e=>e.enabled).length,")"]})]}),e.jsx(kt,{value:"all",className:"space-y-6",children:Object.keys(F).length>0?Object.keys(F).map(r=>{var n;return e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsxs(N,{className:"text-lg flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:M(r)}),(null==(n=B.find(e=>e.value===r))?void 0:n.label)||r]})}),e.jsx(j,{children:e.jsx("div",{className:"space-y-3",children:F[r].map(r=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted rounded-lg",children:[e.jsx("div",{className:"flex items-center gap-4 flex-1",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold",children:r.title}),e.jsx(g,{className:P(r.type),variant:"outline",children:r.type})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-text-secondary",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsx("span",{children:r.time})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(We,{className:"w-4 h-4"}),e.jsx("span",{children:7===r.days.length?"Daily":`${r.days.length} days/week`})]})]}),r.message&&e.jsxs("p",{className:"text-sm text-text-secondary italic",children:['"',r.message,'"']})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Yt,{checked:r.enabled,onCheckedChange:()=>(async(e,r)=>{try{const{error:t}=await u.from("user_notifications").update({enabled:!r}).eq("id",e);if(t)throw t;R()}catch(n){h({title:t("error")||"Error",description:t("failedToToggleNotification")||"Failed to toggle notification",variant:"destructive"})}})(r.id,r.enabled)}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>(e=>{y(e),C({title:e.title,type:e.type,time:e.time,days:e.days,enabled:e.enabled,message:e.message||""}),m(!0)})(r),children:e.jsx(Fe,{className:"w-4 h-4"})}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>(async e=>{try{const{error:r}=await u.from("user_notifications").delete().eq("id",e);if(r)throw r;h({title:t("notificationDeleted")||"Notification Deleted",description:t("notificationDeletedSuccessfully")||"Notification has been deleted"}),R()}catch(r){h({title:t("error")||"Error",description:t("failedToDeleteNotification")||"Failed to delete notification",variant:"destructive"})}})(r.id),children:e.jsx(Le,{className:"w-4 h-4 text-red-500"})})]})]},r.id))})})]},r)}):e.jsx(_,{className:"glass-effect",children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(ze,{className:"w-16 h-16 mb-4 text-text-secondary opacity-50"}),e.jsx("p",{className:"text-text-secondary mb-4",children:t("noRemindersYet")||"No reminders set yet"}),e.jsxs(o,{onClick:()=>m(!0),children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),t("createFirstReminder")||"Create Your First Reminder"]})]})})}),e.jsx(kt,{value:"active",className:"space-y-6",children:a.filter(e=>e.enabled).length>0?e.jsx(_,{className:"glass-effect",children:e.jsx(j,{className:"p-6",children:e.jsx("div",{className:"space-y-3",children:a.filter(e=>e.enabled).map(r=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-2xl",children:M(r.type)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:r.title}),e.jsxs("p",{className:"text-sm text-text-secondary",children:[r.time," â€¢ ",7===r.days.length?"Daily":`${r.days.length} days/week`]})]})]}),e.jsx(g,{className:"bg-green-500/20 text-green-300",children:t("active")||"Active"})]},r.id))})})}):e.jsx(_,{className:"glass-effect",children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(ze,{className:"w-16 h-16 mb-4 text-text-secondary opacity-50"}),e.jsx("p",{className:"text-text-secondary",children:t("noActiveReminders")||"No active reminders"})]})})})]})]})},tc=()=>{const{t:t}=v(),[n,s]=r.useState(null),[i,a]=r.useState([]),l=[{text:"The only bad workout is the one that didn't happen.",author:"Unknown"},{text:"Your body can stand almost anything. It's your mind you have to convince.",author:"Unknown"},{text:"Take care of your body. It's the only place you have to live.",author:"Jim Rohn"},{text:"Health is not about the weight you lose, but about the life you gain.",author:"Unknown"},{text:"The groundwork for all happiness is good health.",author:"Leigh Hunt"},{text:"Exercise is a celebration of what your body can do, not a punishment for what you ate.",author:"Unknown"},{text:"A healthy outside starts from the inside.",author:"Robert Urich"},{text:"The greatest wealth is health.",author:"Virgil"},{text:"Success is the sum of small efforts repeated day in and day out.",author:"Robert Collier"},{text:"Motivation is what gets you started. Habit is what keeps you going.",author:"Jim Ryun"}],c=[{id:1,icon:"ðŸ†",title:"First Week Complete",description:"You logged 7 days of activity!",unlocked:!0},{id:2,icon:"ðŸ’§",title:"Hydration Champion",description:"Met water goal 10 days in a row",unlocked:!0},{id:3,icon:"ðŸ˜´",title:"Sleep Master",description:"Consistent 7+ hours of sleep",unlocked:!1},{id:4,icon:"ðŸ¥—",title:"Nutrition Pro",description:"Tracked all meals for a month",unlocked:!1}];r.useEffect(()=>{d(),a(c)},[]);const d=()=>{const e=(new Date).toDateString(),t=localStorage.getItem("dailyQuote"),r=localStorage.getItem("quoteDate");if(t&&r===e)s(JSON.parse(t));else{const t=l[Math.floor(Math.random()*l.length)];s(t),localStorage.setItem("dailyQuote",JSON.stringify(t)),localStorage.setItem("quoteDate",e)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(_,{className:"glass-effect",children:e.jsxs(b,{children:[e.jsxs(N,{className:"flex items-center gap-2 text-xl",children:[e.jsx(ye,{className:"w-6 h-6 text-primary"}),t("motivationalSupport")||"Motivational Support"]}),e.jsx("p",{className:"text-sm text-text-secondary",children:t("motivationalSupportDescription")||"Stay inspired on your health journey"})]})}),n&&e.jsx(_,{className:"glass-effect border-2 border-primary/30",children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(Xe,{className:"w-8 h-8 text-primary flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-lg italic mb-3",children:['"',n.text,'"']}),e.jsxs("p",{className:"text-sm text-text-secondary",children:["â€” ",n.author]})]}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>{const e=l[Math.floor(Math.random()*l.length)];s(e)},children:e.jsx(pe,{className:"w-4 h-4"})})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[{icon:"ðŸŽ¯",title:"Stay Focused",message:"Every small step counts towards your big goals!"},{icon:"ðŸ’ª",title:"You're Stronger Than You Think",message:"Keep pushing, you've got this!"},{icon:"ðŸŒŸ",title:"Shine Bright",message:"Your dedication is inspiring!"},{icon:"ðŸ”¥",title:"Keep the Fire Burning",message:"Consistency is the key to success!"},{icon:"ðŸŽŠ",title:"Celebrate Progress",message:"Be proud of how far you've come!"}].map((t,r)=>e.jsx(_,{className:"glass-effect hover:shadow-lg transition-all cursor-pointer",children:e.jsxs(j,{className:"p-6 text-center",children:[e.jsx("div",{className:"text-4xl mb-3",children:t.icon}),e.jsx("h3",{className:"font-semibold mb-2",children:t.title}),e.jsx("p",{className:"text-sm text-text-secondary",children:t.message})]})},r))}),e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsxs(N,{className:"text-lg flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5 text-primary"}),t("recentAchievements")||"Recent Achievements"]})}),e.jsx(j,{children:e.jsx("div",{className:"space-y-3",children:i.map(t=>e.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-lg transition-all "+(t.unlocked?"bg-primary/10 border-2 border-primary":"bg-muted opacity-60"),children:[e.jsx("div",{className:"text-4xl",children:t.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold",children:t.title}),e.jsx("p",{className:"text-sm text-text-secondary",children:t.description})]}),t.unlocked&&e.jsxs(g,{className:"bg-green-500/20 text-green-300",children:[e.jsx(Ve,{className:"w-3 h-3 mr-1"}),"Unlocked"]})]},t.id))})})]}),e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsxs(N,{className:"text-lg flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5 text-primary"}),t("keepGoing")||"Keep Going!"]})}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-muted rounded-lg",children:[e.jsx(X,{className:"w-5 h-5 text-green-500 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"You're on the right track!"}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:"Your consistency over the past week shows real commitment. Keep it up!"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-muted rounded-lg",children:[e.jsx(ye,{className:"w-5 h-5 text-red-500 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Remember why you started"}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:"Your health journey is a marathon, not a sprint. Every day is a new opportunity!"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-muted rounded-lg",children:[e.jsx(q,{className:"w-5 h-5 text-yellow-500 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Small wins add up"}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:"Celebrate every milestone, no matter how small. Progress is progress!"})]})]})]})})]})]})},rc=()=>{const{t:t}=v(),{userProfile:n}=l(),[s,i]=r.useState(!0),[a,o]=r.useState("30"),[c,d]=r.useState([]),[f,p]=r.useState([]),[m,x]=r.useState(null),[y,w]=r.useState(null),[C,A]=r.useState("weight");r.useEffect(()=>{(null==n?void 0:n.id)&&S()},[null==n?void 0:n.id,a]);const S=async()=>{i(!0);try{const e=new Date,t=new Date;t.setDate(t.getDate()-parseInt(a));const{data:r,error:s}=await u.from("weight_logs").select("*").eq("user_id",n.id).gte("date",t.toISOString().split("T")[0]).lte("date",e.toISOString().split("T")[0]).order("date",{ascending:!0}),{data:i,error:o}=await u.from("sleep_logs").select("*").eq("user_id",n.id).gte("date",t.toISOString().split("T")[0]).lte("date",e.toISOString().split("T")[0]).order("date",{ascending:!0}),{data:l,error:c}=await u.from("workout_logs").select("*").eq("user_id",n.id).gte("date",t.toISOString().split("T")[0]).lte("date",e.toISOString().split("T")[0]).order("date",{ascending:!0}),{data:h,error:f}=await u.from("daily_macros").select("*").eq("user_id",n.id).gte("date",t.toISOString().split("T")[0]).lte("date",e.toISOString().split("T")[0]).order("date",{ascending:!0}),m=E(r,i,l,h);d(m);const g=I(m);p(g);const y=O(m);w(y);const v=R(m);x(v)}catch(e){h({title:t("error")||"Error",description:t("failedToLoadAnalytics")||"Failed to load analytics data",variant:"destructive"})}finally{i(!1)}},E=(e,t,r,n)=>{const s=new Map;return null==e||e.forEach(e=>{const t=e.date;s.has(t)||s.set(t,{date:t}),s.get(t).weight=e.weight_kg}),null==t||t.forEach(e=>{const t=e.date;s.has(t)||s.set(t,{date:t}),s.get(t).sleep=e.hours,s.get(t).sleepQuality=e.quality_rating}),null==r||r.forEach(e=>{const t=e.date;s.has(t)||s.set(t,{date:t}),s.get(t).workout=e.duration_minutes,s.get(t).calories_burned=e.calories_burned}),null==n||n.forEach(e=>{const t=e.date;s.has(t)||s.set(t,{date:t}),s.get(t).calories=e.calories,s.get(t).protein=e.protein,s.get(t).carbs=e.carbs,s.get(t).fat=e.fat}),Array.from(s.values()).sort((e,t)=>new Date(e.date)-new Date(t.date))},I=e=>{if(e.length<2)return[];const t=[],r=T(e.map(e=>e.sleep).filter(e=>void 0!==e),e.map(e=>e.weight).filter(e=>void 0!==e));t.push({metric1:"Sleep",metric2:"Weight",correlation:r,strength:D(r)});const n=T(e.map(e=>e.workout).filter(e=>void 0!==e),e.map(e=>e.weight).filter(e=>void 0!==e));t.push({metric1:"Workout Duration",metric2:"Weight",correlation:n,strength:D(n)});const s=T(e.map(e=>e.sleep).filter(e=>void 0!==e),e.map(e=>e.workout).filter(e=>void 0!==e));t.push({metric1:"Sleep",metric2:"Workout Performance",correlation:s,strength:D(s)});const i=T(e.map(e=>e.calories).filter(e=>void 0!==e),e.map(e=>e.weight).filter(e=>void 0!==e));return t.push({metric1:"Calorie Intake",metric2:"Weight",correlation:i,strength:D(i)}),t},T=(e,t)=>{if(e.length!==t.length||0===e.length)return 0;const r=e.length,n=e.reduce((e,t)=>e+t,0),s=t.reduce((e,t)=>e+t,0),i=e.reduce((e,r,n)=>e+r*t[n],0),a=e.reduce((e,t)=>e+t*t,0),o=t.reduce((e,t)=>e+t*t,0),l=r*i-n*s,c=Math.sqrt((r*a-n*n)*(r*o-s*s));return 0===c?0:l/c},D=e=>{const t=Math.abs(e);return t>=.7?"Strong":t>=.4?"Moderate":t>=.2?"Weak":"Very Weak"},O=e=>{if(e.length<2)return null;const t=e=>{const t=e.filter(e=>null!=e);if(t.length<2)return{trend:"stable",change:0,percentage:0};const r=t[0],n=t[t.length-1]-r,s=n/r*100;return{trend:n>0?"increasing":n<0?"decreasing":"stable",change:Math.abs(n).toFixed(2),percentage:Math.abs(s).toFixed(1),direction:n>0?"up":n<0?"down":"stable"}};return{weight:t(e.map(e=>e.weight)),sleep:t(e.map(e=>e.sleep)),workout:t(e.map(e=>e.workout)),calories:t(e.map(e=>e.calories))}},R=e=>{if(e.length<3)return null;const t=(e,t)=>{const n=e.filter(e=>null!=e);if(n.length<3)return null;const s=n.length,i=Array.from({length:s},(e,t)=>t),a=n,o=i.reduce((e,t)=>e+t,0),l=a.reduce((e,t)=>e+t,0),c=(s*i.reduce((e,t,r)=>e+t*a[r],0)-o*l)/(s*i.reduce((e,t)=>e+t*t,0)-o*o),d=c*s+(l-c*o)/s,u=r(n,d);return{label:t,current:n[n.length-1].toFixed(2),predicted:d.toFixed(2),confidence:u.toFixed(0)}},r=(e,t)=>{const r=e.reduce((e,r)=>e+Math.pow(r-t,2),0)/e.length,n=Math.sqrt(r)/t*100;return Math.max(0,100-n)};return{weight:t(e.map(e=>e.weight),"Weight"),sleep:t(e.map(e=>e.sleep),"Sleep"),workout:t(e.map(e=>e.workout),"Workout Duration")}},k=({title:t,trend:r,icon:n})=>{if(!r)return null;const s="up"===r.direction?X:"down"===r.direction?Y:xe,i="up"===r.direction?"text-green-500":"down"===r.direction?"text-red-500":"text-yellow-500";return e.jsx(_,{className:"glass-effect",children:e.jsxs(j,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:t})]}),e.jsx(s,{className:`w-5 h-5 ${i}`})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-2xl font-bold",children:r.change}),e.jsxs("p",{className:`text-xs ${i}`,children:[r.percentage,"% change"]})]})]})})},M=({correlation:t})=>{const r=Math.abs(t);let n="bg-gray-500/20 text-gray-300";return r>=.7?n="bg-green-500/20 text-green-300":r>=.4?n="bg-yellow-500/20 text-yellow-300":r>=.2&&(n="bg-orange-500/20 text-orange-300"),e.jsxs(g,{className:n,children:[t>0?"+":"",(100*t).toFixed(0),"%"]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(_,{className:"glass-effect",children:e.jsx(b,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-6 h-6 text-primary"}),t("advancedAnalytics")||"Advanced Analytics"]}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:t("advancedAnalyticsDescription")||"Deep insights, trends, and predictive analysis of your health data"})]}),e.jsxs(At,{value:a,onValueChange:o,children:[e.jsx(St,{className:"w-[180px]",children:e.jsx(Et,{})}),e.jsxs(It,{children:[e.jsx(Tt,{value:"7",children:t("last7Days")||"Last 7 Days"}),e.jsx(Tt,{value:"30",children:t("last30Days")||"Last 30 Days"}),e.jsx(Tt,{value:"90",children:t("last90Days")||"Last 90 Days"}),e.jsx(Tt,{value:"180",children:t("last6Months")||"Last 6 Months"}),e.jsx(Tt,{value:"365",children:t("lastYear")||"Last Year"})]})]})]})})}),s?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(re,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs(Dt,{defaultValue:"trends",className:"w-full",children:[e.jsxs(Ot,{className:"grid w-full grid-cols-4",children:[e.jsx(Rt,{value:"trends",children:t("trends")||"Trends"}),e.jsx(Rt,{value:"correlations",children:t("correlations")||"Correlations"}),e.jsx(Rt,{value:"predictions",children:t("predictions")||"Predictions"}),e.jsx(Rt,{value:"detailed",children:t("detailed")||"Detailed"})]}),e.jsxs(kt,{value:"trends",className:"space-y-6",children:[y&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(k,{title:"Weight",trend:y.weight,icon:Me}),e.jsx(k,{title:"Sleep",trend:y.sleep,icon:xe}),e.jsx(k,{title:"Workout",trend:y.workout,icon:$}),e.jsx(k,{title:"Calories",trend:y.calories,icon:X})]}),e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsx(N,{className:"text-lg",children:t("multiMetricTrends")||"Multi-Metric Trends"})}),e.jsx(j,{children:e.jsx(be,{width:"100%",height:400,children:e.jsxs(Ye,{data:c,children:[e.jsx(Ie,{strokeDasharray:"3 3"}),e.jsx(Te,{dataKey:"date",tickFormatter:e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(De,{yAxisId:"left"}),e.jsx(De,{yAxisId:"right",orientation:"right"}),e.jsx(Ae,{}),e.jsx(Se,{}),e.jsx(qe,{yAxisId:"left",type:"monotone",dataKey:"sleep",fill:"#3b82f6",stroke:"#3b82f6",name:"Sleep (hrs)"}),e.jsx(ke,{yAxisId:"right",dataKey:"workout",fill:"#22c55e",name:"Workout (min)"}),e.jsx(Oe,{yAxisId:"left",type:"monotone",dataKey:"weight",stroke:"#ef4444",name:"Weight (kg)",strokeWidth:2})]})})})]})]}),e.jsxs(kt,{value:"correlations",className:"space-y-6",children:[e.jsxs(_,{className:"glass-effect",children:[e.jsxs(b,{children:[e.jsx(N,{className:"text-lg",children:t("metricCorrelations")||"Metric Correlations"}),e.jsx("p",{className:"text-sm text-text-secondary",children:t("correlationDescription")||"Discover how different health metrics influence each other"})]}),e.jsx(j,{children:e.jsx("div",{className:"space-y-4",children:f.map((t,r)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-medium",children:[t.metric1," vs ",t.metric2]}),e.jsxs("p",{className:"text-sm text-text-secondary",children:[t.strength," correlation"]})]}),e.jsx(M,{correlation:t.correlation})]},r))})})]}),e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsx(N,{className:"text-lg",children:t("correlationVisualization")||"Correlation Visualization"})}),e.jsx(j,{children:e.jsx(be,{width:"100%",height:350,children:e.jsxs(Ke,{children:[e.jsx(Ie,{strokeDasharray:"3 3"}),e.jsx(Te,{dataKey:"sleep",name:"Sleep (hrs)"}),e.jsx(De,{dataKey:"weight",name:"Weight (kg)"}),e.jsx(Ae,{cursor:{strokeDasharray:"3 3"}}),e.jsx(Se,{}),e.jsx(Ze,{name:"Sleep vs Weight",data:c,fill:"#8884d8"})]})})})]})]}),e.jsxs(kt,{value:"predictions",className:"space-y-6",children:[e.jsxs(_,{className:"glass-effect",children:[e.jsxs(b,{children:[e.jsxs(N,{className:"text-lg flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5 text-primary"}),t("predictiveInsights")||"Predictive Insights"]}),e.jsx("p",{className:"text-sm text-text-secondary",children:t("predictionsDescription")||"AI-powered predictions based on your historical data"})]}),e.jsx(j,{children:m&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.values(m).filter(e=>e).map((r,n)=>e.jsx(_,{className:"glass-effect border-primary/30",children:e.jsxs(j,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:r.label}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-text-secondary",children:t("current")||"Current"}),e.jsx("p",{className:"text-2xl font-bold",children:r.current})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-text-secondary",children:t("predicted")||"Predicted"}),e.jsx("p",{className:"text-xl font-semibold text-primary",children:r.predicted})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all",style:{width:`${r.confidence}%`}})}),e.jsxs("span",{className:"text-xs",children:[r.confidence,"%"]})]})]})]})},n))})})]}),e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsx(N,{className:"text-lg",children:t("trendProjection")||"Trend Projection"})}),e.jsx(j,{children:e.jsx(be,{width:"100%",height:350,children:e.jsxs(Ee,{data:c,children:[e.jsx(Ie,{strokeDasharray:"3 3"}),e.jsx(Te,{dataKey:"date",tickFormatter:e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(De,{}),e.jsx(Ae,{}),e.jsx(Se,{}),e.jsx(Oe,{type:"monotone",dataKey:"weight",stroke:"#ef4444",name:"Actual Weight",strokeWidth:2}),e.jsx(Oe,{type:"monotone",dataKey:"sleep",stroke:"#3b82f6",name:"Actual Sleep",strokeWidth:2})]})})})]})]}),e.jsx(kt,{value:"detailed",className:"space-y-6",children:e.jsxs(_,{className:"glass-effect",children:[e.jsxs(b,{children:[e.jsx(N,{className:"text-lg",children:t("detailedMetrics")||"Detailed Metrics Analysis"}),e.jsxs(At,{value:C,onValueChange:A,children:[e.jsx(St,{className:"w-[200px]",children:e.jsx(Et,{})}),e.jsxs(It,{children:[e.jsx(Tt,{value:"weight",children:t("weight")||"Weight"}),e.jsx(Tt,{value:"sleep",children:t("sleep")||"Sleep"}),e.jsx(Tt,{value:"workout",children:t("workout")||"Workout"}),e.jsx(Tt,{value:"calories",children:t("calories")||"Calories"})]})]})]}),e.jsx(j,{children:e.jsx(be,{width:"100%",height:400,children:e.jsxs($e,{data:c,children:[e.jsx(Ie,{strokeDasharray:"3 3"}),e.jsx(Te,{dataKey:"date",tickFormatter:e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(De,{}),e.jsx(Ae,{}),e.jsx(qe,{type:"monotone",dataKey:C,stroke:"#22c55e",fill:"#22c55e",fillOpacity:.3})]})})})]})})]})]})},nc=({previewMode:t=!1})=>{const{t:n}=v(),{userProfile:s}=l(),[i,a]=r.useState(!0),[c,d]=r.useState("weekly"),[f,p]=r.useState(null),[m,x]=r.useState(null);r.useEffect(()=>{t?(y("weekly"),y("monthly")):(null==s?void 0:s.id)&&w()},[null==s?void 0:s.id,c,t]);const y=e=>{a(!0);const t="weekly"===e?7:30,r=new Date,n=new Date;n.setDate(n.getDate()-t);const s=(e=>{const t=[],r=new Date;let n=82.5;for(let s=e-1;s>=0;s--){const e=new Date(r);e.setDate(e.getDate()-s),n-=.3*Math.random()-.1,t.push({date:e.toISOString().split("T")[0],weight_kg:parseFloat(n.toFixed(1)),user_id:"preview-user"})}return t})(t),i=(e=>{const t=[],r=new Date;for(let n=e-1;n>=0;n--){const e=new Date(r);e.setDate(e.getDate()-n);const s=6+2.5*Math.random();t.push({date:e.toISOString().split("T")[0],hours:parseFloat(s.toFixed(1)),quality:s>7?"good":s>6?"fair":"poor",user_id:"preview-user"})}return t})(t),o=(e=>{const t=[],r=new Date,n=["Strength Training","Cardio","Yoga","HIIT","Running","Cycling"],s=Math.floor(e/7*4);for(let i=0;i<s;i++){const s=Math.floor(Math.random()*e),i=new Date(r);i.setDate(i.getDate()-s),t.push({date:i.toISOString().split("T")[0],type:n[Math.floor(Math.random()*n.length)],duration_minutes:30+Math.floor(60*Math.random()),calories_burned:200+Math.floor(400*Math.random()),user_id:"preview-user"})}return t.sort((e,t)=>e.date.localeCompare(t.date))})(t),l=(e=>{const t=[],r=new Date;for(let n=e-1;n>=0;n--){const e=new Date(r);e.setDate(e.getDate()-n);const s=2e3,i=400*Math.random()-200,a=Math.round(s+i);t.push({date:e.toISOString().split("T")[0],calories:a,protein:Math.round(.3*a/4),carbs:Math.round(.4*a/4),fat:Math.round(.3*a/9),user_id:"preview-user"})}return t})(t),c=(e=>{const t=[],r=new Date;for(let n=e-1;n>=0;n--){const e=new Date(r);e.setDate(e.getDate()-n);const s=5+Math.floor(6*Math.random());t.push({date:e.toISOString().split("T")[0],glasses:s,user_id:"preview-user"})}return t})(t),d={period:e,startDate:n.toISOString().split("T")[0],endDate:r.toISOString().split("T")[0],summary:A(s,i,o,l,c),achievements:S(s,i,o,l,c),improvements:E(s,i,o,l,c),charts:{weight:s,sleep:i,workout:o}};"weekly"===e?p(d):x(d),a(!1)},w=async()=>{a(!0);try{const e=new Date,t=new Date;"weekly"===c?t.setDate(t.getDate()-7):t.setDate(t.getDate()-30);const[r,n,s,i,a]=await Promise.all([C("weight_logs",t,e),C("sleep_logs",t,e),C("workout_logs",t,e),C("daily_macros",t,e),C("water_logs",t,e)]),o={period:c,startDate:t.toISOString().split("T")[0],endDate:e.toISOString().split("T")[0],summary:A(r,n,s,i,a),achievements:S(r,n,s,i,a),improvements:E(r,n,s,i,a),charts:{weight:r,sleep:n,workout:s}};"weekly"===c?p(o):x(o)}catch(e){h({title:n("error")||"Error",description:n("failedToGenerateReport")||"Failed to generate report",variant:"destructive"})}finally{a(!1)}},C=async(e,t,r)=>{const{data:n,error:i}=await u.from(e).select("*").eq("user_id",s.id).gte("date",t.toISOString().split("T")[0]).lte("date",r.toISOString().split("T")[0]).order("date",{ascending:!0});if(i)throw i;return n||[]},A=(e,t,r,n,s)=>({totalWorkouts:r.length,avgSleep:t.length>0?(t.reduce((e,t)=>e+t.hours,0)/t.length).toFixed(1):0,avgCalories:n.length>0?Math.round(n.reduce((e,t)=>e+t.calories,0)/n.length):0,totalWater:s.reduce((e,t)=>e+t.glasses,0),weightChange:e.length>=2?(e[e.length-1].weight_kg-e[0].weight_kg).toFixed(1):0,workoutMinutes:r.reduce((e,t)=>e+(t.duration_minutes||0),0)}),S=(e,t,r,n,s)=>{const i=[];r.length>=5&&i.push({icon:"ðŸ’ª",title:"Workout Warrior",description:`Completed ${r.length} workouts this period`,type:"success"});const a=t.length>0?t.reduce((e,t)=>e+t.hours,0)/t.length:0;a>=7&&i.push({icon:"ðŸ˜´",title:"Sleep Champion",description:`Averaged ${a.toFixed(1)} hours of sleep`,type:"success"});const o=s.reduce((e,t)=>e+t.glasses,0);if(o>=56&&i.push({icon:"ðŸ’§",title:"Hydration Hero",description:`Drank ${o} glasses of water`,type:"success"}),e.length>=2){const t=e[e.length-1].weight_kg-e[0].weight_kg;Math.abs(t)>=.5&&i.push({icon:t<0?"ðŸ“‰":"ðŸ“ˆ",title:"Weight Progress",description:`${Math.abs(t).toFixed(1)} kg ${t<0?"lost":"gained"}`,type:t<0?"success":"info"})}return i},E=(e,t,r,n,s)=>{const i=[],a=t.length>0?t.reduce((e,t)=>e+t.hours,0)/t.length:0;a<7&&i.push({icon:"ðŸ˜´",title:"Improve Sleep",description:`Average ${a.toFixed(1)} hrs/night. Aim for 7-9 hours`,priority:"high"}),r.length<3&&i.push({icon:"ðŸ’ª",title:"Increase Activity",description:"Try to workout at least 3-4 times per week",priority:"medium"});const o=s.reduce((e,t)=>e+t.glasses,0);if((s.length>0?o/s.length:0)<6&&i.push({icon:"ðŸ’§",title:"Increase Hydration",description:"Aim for at least 8 glasses of water daily",priority:"medium"}),n.length>0){I(n.map(e=>e.calories))>500&&i.push({icon:"ðŸ½ï¸",title:"Stabilize Calorie Intake",description:"Try to maintain more consistent daily calories",priority:"low"})}return i},I=e=>{const t=e.reduce((e,t)=>e+t,0)/e.length,r=e.map(e=>Math.pow(e-t,2));return Math.sqrt(r.reduce((e,t)=>e+t,0)/e.length)},T=e=>{let t="GREENOFIG PROGRESS REPORT\n";return t+=`Period: ${e.startDate} to ${e.endDate}\n`,t+=`Generated: ${(new Date).toLocaleString()}\n\n`,t+="=== SUMMARY ===\n",t+=`Total Workouts: ${e.summary.totalWorkouts}\n`,t+=`Average Sleep: ${e.summary.avgSleep} hours\n`,t+=`Average Calories: ${e.summary.avgCalories} kcal\n`,t+=`Total Water: ${e.summary.totalWater} glasses\n`,t+=`Weight Change: ${e.summary.weightChange} kg\n`,t+=`Total Workout Minutes: ${e.summary.workoutMinutes} min\n\n`,t+="=== ACHIEVEMENTS ===\n",e.achievements.forEach(e=>{t+=`${e.icon} ${e.title}: ${e.description}\n`}),t+="\n=== AREAS FOR IMPROVEMENT ===\n",e.improvements.forEach(e=>{t+=`${e.icon} ${e.title}: ${e.description}\n`}),t},D="weekly"===c?f:m;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(_,{className:"glass-effect",children:e.jsx(b,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs(N,{className:"flex items-center gap-2 text-xl",children:[e.jsx(Qe,{className:"w-6 h-6 text-primary"}),n("progressReports")||"Progress Reports"]}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:n("progressReportsDescription")||"Automated weekly and monthly progress summaries"})]})})})}),i?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(re,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs(Dt,{defaultValue:"weekly",className:"w-full",onValueChange:d,children:[e.jsxs(Ot,{className:"grid w-full grid-cols-2",children:[e.jsx(Rt,{value:"weekly",children:n("weeklyReport")||"Weekly Report"}),e.jsx(Rt,{value:"monthly",children:n("monthlyReport")||"Monthly Report"})]}),D&&e.jsx(e.Fragment,{children:e.jsxs(kt,{value:c,className:"space-y-6",children:[e.jsx(_,{className:"glass-effect",children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-1",children:"weekly"===c?n("weeklyReport")||"Weekly Report":n("monthlyReport")||"Monthly Report"}),e.jsxs("p",{className:"text-sm text-text-secondary",children:[new Date(D.startDate).toLocaleDateString()," - ",new Date(D.endDate).toLocaleDateString()]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(o,{variant:"outline",onClick:()=>{const e="weekly"===c?f:m,t=T(e),r=new Blob([t],{type:"text/plain"}),s=window.URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download=`progress-report-${e.startDate}-to-${e.endDate}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(s),h({title:n("reportDownloaded")||"Report Downloaded",description:n("progressReportDownloaded")||"Your progress report has been downloaded"})},children:[e.jsx(Je,{className:"w-4 h-4 mr-2"}),n("download")||"Download"]})})]})})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[e.jsx(_,{className:"glass-effect",children:e.jsxs(j,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:D.summary.totalWorkouts}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:n("workouts")||"Workouts"})]})}),e.jsx(_,{className:"glass-effect",children:e.jsxs(j,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:D.summary.avgSleep}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:n("avgSleep")||"Avg Sleep (hrs)"})]})}),e.jsx(_,{className:"glass-effect",children:e.jsxs(j,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:D.summary.avgCalories}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:n("avgCalories")||"Avg Calories"})]})}),e.jsx(_,{className:"glass-effect",children:e.jsxs(j,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:D.summary.totalWater}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:n("waterGlasses")||"Water Glasses"})]})}),e.jsx(_,{className:"glass-effect",children:e.jsxs(j,{className:"p-4 text-center",children:[e.jsxs("div",{className:"text-3xl font-bold "+(D.summary.weightChange<0?"text-green-500":"text-orange-500"),children:[D.summary.weightChange>0?"+":"",D.summary.weightChange]}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:n("weightChange")||"Weight Change (kg)"})]})}),e.jsx(_,{className:"glass-effect",children:e.jsxs(j,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:D.summary.workoutMinutes}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:n("activeMinutes")||"Active Minutes"})]})})]}),D.achievements.length>0&&e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsxs(N,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5 text-primary"}),n("achievements")||"Achievements"]})}),e.jsx(j,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:D.achievements.map((t,r)=>e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-muted rounded-lg",children:[e.jsx("span",{className:"text-3xl",children:t.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold",children:t.title}),e.jsx(ee,{className:"w-4 h-4 text-green-500"})]}),e.jsx("p",{className:"text-sm text-text-secondary",children:t.description})]})]},r))})})]}),D.improvements.length>0&&e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsxs(N,{className:"text-lg flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5 text-primary"}),n("areasForImprovement")||"Areas for Improvement"]})}),e.jsx(j,{children:e.jsx("div",{className:"space-y-3",children:D.improvements.map((t,r)=>e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-muted rounded-lg",children:[e.jsx("span",{className:"text-2xl",children:t.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold",children:t.title}),e.jsx(g,{className:"high"===t.priority?"bg-red-500/20 text-red-300":"medium"===t.priority?"bg-yellow-500/20 text-yellow-300":"bg-blue-500/20 text-blue-300",children:t.priority})]}),e.jsx("p",{className:"text-sm text-text-secondary",children:t.description})]})]},r))})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[D.charts.weight.length>0&&e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsx(N,{className:"text-lg",children:n("weightTrend")||"Weight Trend"})}),e.jsx(j,{children:e.jsx(be,{width:"100%",height:250,children:e.jsxs(Ee,{data:D.charts.weight,children:[e.jsx(Ie,{strokeDasharray:"3 3"}),e.jsx(Te,{dataKey:"date",tickFormatter:e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(De,{}),e.jsx(Ae,{}),e.jsx(Oe,{type:"monotone",dataKey:"weight_kg",stroke:"#22c55e",strokeWidth:2})]})})})]}),D.charts.sleep.length>0&&e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsx(N,{className:"text-lg",children:n("sleepPattern")||"Sleep Pattern"})}),e.jsx(j,{children:e.jsx(be,{width:"100%",height:250,children:e.jsxs(Re,{data:D.charts.sleep,children:[e.jsx(Ie,{strokeDasharray:"3 3"}),e.jsx(Te,{dataKey:"date",tickFormatter:e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(De,{}),e.jsx(Ae,{}),e.jsx(ke,{dataKey:"hours",fill:"#3b82f6"})]})})})]})]})]})})]})]})},sc=()=>{const{t:t}=v(),{userProfile:n}=l(),[s,i]=r.useState(!0),[a,o]=r.useState("30"),[c,d]=r.useState([]),[f,p]=r.useState(null),[m,g]=r.useState([]);r.useEffect(()=>{(null==n?void 0:n.id)&&x()},[null==n?void 0:n.id,a]);const x=async()=>{i(!0);try{const e=new Date,t=new Date;t.setDate(t.getDate()-parseInt(a));const{data:r,error:s}=await u.from("workout_logs").select("*").eq("user_id",n.id).gte("date",t.toISOString().split("T")[0]).lte("date",e.toISOString().split("T")[0]).order("date",{ascending:!0});if(s)throw s;d(r||[]),y(r||[]),w(r||[])}catch(e){h({title:t("error")||"Error",description:t("failedToLoadWorkoutAnalytics")||"Failed to load workout analytics",variant:"destructive"})}finally{i(!1)}},y=e=>{if(0===e.length)return void p(null);const t=e.length,r=e.reduce((e,t)=>e+(t.duration_minutes||0),0),n=e.reduce((e,t)=>e+(t.calories_burned||0),0),s=Math.round(r/t),i=Math.round(n/t),o=e.reduce((e,t)=>(e[t.type]=(e[t.type]||0)+1,e),{}),l=e.reduce((e,t)=>(e[t.intensity||"moderate"]=(e[t.intensity||"moderate"]||0)+1,e),{}),c=Math.round(t/parseInt(a)*7);p({totalWorkouts:t,totalDuration:r,totalCalories:n,avgDuration:s,avgCalories:i,workoutsByType:o,intensityDistribution:l,weeklyFrequency:c})},w=e=>{const t=[],r=Math.max(...e.map(e=>e.duration_minutes||0)),n=Math.max(...e.map(e=>e.calories_burned||0)),s=Math.max(...e.map(e=>e.distance_km||0));if(r>0){const n=e.find(e=>e.duration_minutes===r);t.push({title:"Longest Workout",value:`${r} min`,date:null==n?void 0:n.date,icon:"â±ï¸"})}if(n>0){const r=e.find(e=>e.calories_burned===n);t.push({title:"Most Calories Burned",value:`${n} kcal`,date:null==r?void 0:r.date,icon:"ðŸ”¥"})}if(s>0){const r=e.find(e=>e.distance_km===s);t.push({title:"Longest Distance",value:`${s.toFixed(1)} km`,date:null==r?void 0:r.date,icon:"ðŸƒ"})}const i=C(e);i>0&&t.push({title:"Best Streak",value:`${i} days`,icon:"ðŸ”¥"}),g(t)},C=e=>{if(0===e.length)return 0;const t=[...new Set(e.map(e=>e.date))].sort();let r=1,n=1;for(let s=1;s<t.length;s++){const e=new Date(t[s-1]);1===(new Date(t[s])-e)/864e5?(n++,r=Math.max(r,n)):n=1}return r},A=f?Object.keys(f.workoutsByType).map(e=>({type:e,count:f.workoutsByType[e]})):[],S=f?Object.keys(f.intensityDistribution).map(e=>({intensity:e,count:f.intensityDistribution[e]})):[];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(_,{className:"glass-effect",children:e.jsx(b,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(N,{className:"flex items-center gap-2 text-xl",children:[e.jsx(xe,{className:"w-6 h-6 text-primary"}),t("workoutAnalytics")||"Workout Analytics"]}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:t("workoutAnalyticsDescription")||"Advanced performance metrics and insights"})]}),e.jsxs(At,{value:a,onValueChange:o,children:[e.jsx(St,{className:"w-[180px]",children:e.jsx(Et,{})}),e.jsxs(It,{children:[e.jsx(Tt,{value:"7",children:t("last7Days")||"Last 7 Days"}),e.jsx(Tt,{value:"30",children:t("last30Days")||"Last 30 Days"}),e.jsx(Tt,{value:"90",children:t("last90Days")||"Last 90 Days"})]})]})]})})}),s?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(re,{className:"w-8 h-8 animate-spin text-primary"})}):f?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(_,{className:"glass-effect",children:e.jsxs(j,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:f.totalWorkouts}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:t("totalWorkouts")||"Total Workouts"})]})}),e.jsx(_,{className:"glass-effect",children:e.jsxs(j,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:f.totalDuration}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:t("totalMinutes")||"Total Minutes"})]})}),e.jsx(_,{className:"glass-effect",children:e.jsxs(j,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:f.totalCalories}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:t("caloriesBurned")||"Calories Burned"})]})}),e.jsx(_,{className:"glass-effect",children:e.jsxs(j,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:f.weeklyFrequency}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:t("workoutsPerWeek")||"Workouts/Week"})]})})]}),m.length>0&&e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsxs(N,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5 text-primary"}),t("personalRecords")||"Personal Records"]})}),e.jsx(j,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:m.map((t,r)=>e.jsxs("div",{className:"p-4 bg-muted rounded-lg text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:t.icon}),e.jsx("p",{className:"font-semibold",children:t.value}),e.jsx("p",{className:"text-xs text-text-secondary",children:t.title}),t.date&&e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:new Date(t.date).toLocaleDateString()})]},r))})})]}),e.jsxs(Dt,{defaultValue:"overview",className:"w-full",children:[e.jsxs(Ot,{className:"grid w-full grid-cols-3",children:[e.jsx(Rt,{value:"overview",children:t("overview")||"Overview"}),e.jsx(Rt,{value:"types",children:t("types")||"Types"}),e.jsx(Rt,{value:"intensity",children:t("intensity")||"Intensity"})]}),e.jsx(kt,{value:"overview",className:"space-y-6",children:e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsx(N,{className:"text-lg",children:t("workoutTrends")||"Workout Trends"})}),e.jsx(j,{children:e.jsx(be,{width:"100%",height:300,children:e.jsxs(Ee,{data:c,children:[e.jsx(Ie,{strokeDasharray:"3 3"}),e.jsx(Te,{dataKey:"date",tickFormatter:e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(De,{}),e.jsx(Ae,{}),e.jsx(Se,{}),e.jsx(Oe,{type:"monotone",dataKey:"duration_minutes",stroke:"#22c55e",name:"Duration (min)"}),e.jsx(Oe,{type:"monotone",dataKey:"calories_burned",stroke:"#ef4444",name:"Calories"})]})})})]})}),e.jsx(kt,{value:"types",className:"space-y-6",children:e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsx(N,{className:"text-lg",children:t("workoutsByType")||"Workouts by Type"})}),e.jsx(j,{children:e.jsx(be,{width:"100%",height:300,children:e.jsxs(Re,{data:A,children:[e.jsx(Ie,{strokeDasharray:"3 3"}),e.jsx(Te,{dataKey:"type"}),e.jsx(De,{}),e.jsx(Ae,{}),e.jsx(ke,{dataKey:"count",fill:"#3b82f6"})]})})})]})}),e.jsx(kt,{value:"intensity",className:"space-y-6",children:e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsx(N,{className:"text-lg",children:t("intensityDistribution")||"Intensity Distribution"})}),e.jsx(j,{children:e.jsx(be,{width:"100%",height:300,children:e.jsxs(et,{data:S,children:[e.jsx(tt,{}),e.jsx(rt,{dataKey:"intensity"}),e.jsx(nt,{}),e.jsx(st,{name:"Workouts",dataKey:"count",stroke:"#22c55e",fill:"#22c55e",fillOpacity:.6}),e.jsx(Ae,{})]})})})]})})]})]}):e.jsx(_,{className:"glass-effect",children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(xe,{className:"w-16 h-16 mb-4 text-text-secondary opacity-50"}),e.jsx("p",{className:"text-text-secondary",children:t("noWorkoutData")||"No workout data available for this period"})]})})]})},ic=()=>{const{t:t}=v(),{userProfile:n}=l(),[i,a]=r.useState(!1),[f,p]=r.useState({from:new Date((new Date).setMonth((new Date).getMonth()-1)),to:new Date}),[m,x]=r.useState({weight:!0,sleep:!0,meals:!0,workouts:!0,water:!0,macros:!0,goals:!0,profile:!0}),[y,w]=r.useState("csv"),[C,O]=r.useState((null==n?void 0:n.email)||""),[R,k]=r.useState([]);s.useEffect(()=>{(null==n?void 0:n.id)&&M()},[null==n?void 0:n.id]);const M=async()=>{try{const{data:e,error:t}=await u.from("export_history").select("*").eq("user_id",n.id).order("created_at",{ascending:!1}).limit(10);if(t)throw t;k(e||[])}catch(e){}},P=e=>{x(t=>({...t,[e]:!t[e]}))},B=async()=>{const e={},t=f.from.toISOString().split("T")[0],r=f.to.toISOString().split("T")[0];try{if(m.profile){const{data:t}=await u.from("user_profiles").select("*").eq("id",n.id).single();e.profile=t}if(m.weight){const{data:s}=await u.from("weight_logs").select("*").eq("user_id",n.id).gte("date",t).lte("date",r).order("date",{ascending:!0});e.weight=s}if(m.sleep){const{data:s}=await u.from("sleep_logs").select("*").eq("user_id",n.id).gte("date",t).lte("date",r).order("date",{ascending:!0});e.sleep=s}if(m.meals){const{data:s}=await u.from("meal_logs").select("*").eq("user_id",n.id).gte("date",t).lte("date",r).order("date",{ascending:!0});e.meals=s}if(m.workouts){const{data:s}=await u.from("workout_logs").select("*").eq("user_id",n.id).gte("date",t).lte("date",r).order("date",{ascending:!0});e.workouts=s}if(m.water){const{data:s}=await u.from("water_logs").select("*").eq("user_id",n.id).gte("date",t).lte("date",r).order("date",{ascending:!0});e.water=s}if(m.macros){const{data:s}=await u.from("daily_macros").select("*").eq("user_id",n.id).gte("date",t).lte("date",r).order("date",{ascending:!0});e.macros=s}if(m.goals){const{data:t}=await u.from("user_goals_tracking").select("*").eq("user_id",n.id);e.goals=t}return e}catch(s){throw s}},F=e=>{let t="";return Object.keys(e).forEach(r=>{if(e[r]&&(!Array.isArray(e[r])||0!==e[r].length))if(t+=`\n\n=== ${r.toUpperCase()} ===\n\n`,Array.isArray(e[r])){const n=e[r];if(n.length>0){const e=Object.keys(n[0]);t+=e.join(",")+"\n",n.forEach(r=>{const n=e.map(e=>{const t=r[e];return null==t?"":"string"==typeof t&&t.includes(",")?`"${t}"`:t});t+=n.join(",")+"\n"})}}else{const n=Object.keys(e[r]);t+="Field,Value\n",n.forEach(n=>{t+=`${n},${e[r][n]}\n`})}}),t},L=e=>JSON.stringify(e,null,2);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(_,{className:"glass-effect",children:e.jsxs(b,{children:[e.jsxs(N,{className:"flex items-center gap-2 text-xl",children:[e.jsx(Je,{className:"w-6 h-6 text-primary"}),t("dataExport")||"Data Export"]}),e.jsx("p",{className:"text-sm text-text-secondary",children:t("dataExportDescription")||"Export your health data in multiple formats"})]})}),e.jsxs(Dt,{defaultValue:"export",className:"w-full",children:[e.jsxs(Ot,{className:"grid w-full grid-cols-2",children:[e.jsx(Rt,{value:"export",children:t("newExport")||"New Export"}),e.jsx(Rt,{value:"history",children:t("exportHistory")||"Export History"})]}),e.jsxs(kt,{value:"export",className:"space-y-6",children:[e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsxs(N,{className:"text-lg flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5 text-primary"}),t("selectDateRange")||"Select Date Range"]})}),e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"date-from",children:t("from")||"From"}),e.jsx(d,{id:"date-from",type:"date",value:f.from.toISOString().split("T")[0],onChange:e=>{const t=new Date(e.target.value);p(e=>({...e,from:t}))}})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"date-to",children:t("to")||"To"}),e.jsx(d,{id:"date-to",type:"date",value:f.to.toISOString().split("T")[0],onChange:e=>{const t=new Date(e.target.value);p(e=>({...e,to:t}))}})]})]})})]}),e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsx(N,{className:"text-lg",children:t("selectDataToExport")||"Select Data to Export"})}),e.jsx(j,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[{id:"weight",label:"Weight Logs",icon:"âš–ï¸"},{id:"sleep",label:"Sleep Logs",icon:"ðŸ˜´"},{id:"meals",label:"Meal Logs",icon:"ðŸ½ï¸"},{id:"workouts",label:"Workout Logs",icon:"ðŸ’ª"},{id:"water",label:"Water Intake",icon:"ðŸ’§"},{id:"macros",label:"Macro Tracking",icon:"ðŸ“Š"},{id:"goals",label:"Goals & Achievements",icon:"ðŸŽ¯"},{id:"profile",label:"Profile Information",icon:"ðŸ‘¤"}].map(t=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-muted rounded-lg hover:bg-muted/80 transition-colors cursor-pointer",onClick:()=>P(t.id),children:[e.jsx(Kt,{id:t.id,checked:m[t.id],onCheckedChange:()=>P(t.id)}),e.jsxs(c,{htmlFor:t.id,className:"flex items-center gap-2 cursor-pointer flex-1",children:[e.jsx("span",{className:"text-xl",children:t.icon}),e.jsx("span",{children:t.label})]})]},t.id))})})]}),e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsx(N,{className:"text-lg",children:t("selectExportFormat")||"Select Export Format"})}),e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(_,{className:"cursor-pointer transition-all "+("csv"===y?"border-primary border-2":""),onClick:()=>w("csv"),children:e.jsxs(j,{className:"p-6 text-center",children:[e.jsx(it,{className:"w-12 h-12 mx-auto mb-2 "+("csv"===y?"text-primary":"text-text-secondary")}),e.jsx("h3",{className:"font-semibold",children:"CSV"}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Excel compatible"})]})}),e.jsx(_,{className:"cursor-pointer transition-all "+("json"===y?"border-primary border-2":""),onClick:()=>w("json"),children:e.jsxs(j,{className:"p-6 text-center",children:[e.jsx(at,{className:"w-12 h-12 mx-auto mb-2 "+("json"===y?"text-primary":"text-text-secondary")}),e.jsx("h3",{className:"font-semibold",children:"JSON"}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Developer friendly"})]})}),e.jsx(_,{className:"cursor-pointer transition-all "+("pdf"===y?"border-primary border-2":""),onClick:()=>w("pdf"),children:e.jsxs(j,{className:"p-6 text-center",children:[e.jsx(Qe,{className:"w-12 h-12 mx-auto mb-2 "+("pdf"===y?"text-primary":"text-text-secondary")}),e.jsx("h3",{className:"font-semibold",children:"PDF"}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Printable report"}),e.jsx(g,{className:"mt-2",variant:"secondary",children:"Coming Soon"})]})})]})})]}),e.jsx(_,{className:"glass-effect",children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx(o,{onClick:async()=>{a(!0);try{const e=await B();let r,s,i;switch(y){case"csv":r=F(e),s=`greenofig-health-data-${(new Date).toISOString().split("T")[0]}.csv`,i="text/csv";break;case"json":r=L(e),s=`greenofig-health-data-${(new Date).toISOString().split("T")[0]}.json`,i="application/json";break;case"pdf":return h({title:t("comingSoon")||"Coming Soon",description:t("pdfExportComingSoon")||"PDF export will be available soon"}),void a(!1);default:throw new Error("Invalid export format")}((e,t,r)=>{const n=new Blob([e],{type:r}),s=window.URL.createObjectURL(n),i=document.createElement("a");i.href=s,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(s)})(r,s,i),await u.from("export_history").insert({user_id:n.id,export_type:y,data_types:Object.keys(m).filter(e=>m[e]),date_range_start:f.from.toISOString().split("T")[0],date_range_end:f.to.toISOString().split("T")[0]}),await M(),h({title:t("exportSuccessful")||"Export Successful",description:t("dataExportedSuccessfully")||"Your data has been exported successfully"})}catch(e){h({title:t("error")||"Error",description:t("failedToExportData")||"Failed to export data",variant:"destructive"})}finally{a(!1)}},disabled:i||Object.values(m).every(e=>!e),className:"flex-1",children:i?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-4 h-4 mr-2 animate-spin"}),t("exporting")||"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"w-4 h-4 mr-2"}),t("downloadExport")||"Download Export"]})}),e.jsxs(A,{children:[e.jsx(S,{asChild:!0,children:e.jsxs(o,{variant:"outline",disabled:i||Object.values(m).every(e=>!e),className:"flex-1",children:[e.jsx(ot,{className:"w-4 h-4 mr-2"}),t("emailExport")||"Email Export"]})}),e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(T,{children:t("emailExport")||"Email Export"}),e.jsx(D,{children:t("emailExportDescription")||"Enter the email address where you want to receive the export"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"email",children:t("emailAddress")||"Email Address"}),e.jsx(d,{id:"email",type:"email",value:C,onChange:e=>O(e.target.value),placeholder:"your@email.com"})]}),e.jsx(o,{onClick:async()=>{a(!0);try{const e=await B();"json"===y?L(e):F(e);h({title:t("emailSent")||"Email Sent",description:t("exportEmailSent")||`Export has been sent to ${C}`}),await u.from("export_history").insert({user_id:n.id,export_type:y,data_types:Object.keys(m).filter(e=>m[e]),date_range_start:f.from.toISOString().split("T")[0],date_range_end:f.to.toISOString().split("T")[0],sent_via_email:!0,email_address:C}),await M()}catch(e){h({title:t("error")||"Error",description:t("failedToEmailExport")||"Failed to email export",variant:"destructive"})}finally{a(!1)}},className:"w-full",disabled:i||!C,children:i?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-4 h-4 mr-2 animate-spin"}),t("sending")||"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ot,{className:"w-4 h-4 mr-2"}),t("sendEmail")||"Send Email"]})})]})]})]})]})})})]}),e.jsx(kt,{value:"history",className:"space-y-6",children:e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsx(N,{className:"text-lg",children:t("recentExports")||"Recent Exports"})}),e.jsx(j,{children:R.length>0?e.jsx("div",{className:"space-y-3",children:R.map((r,n)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ee,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[r.export_type.toUpperCase()," Export"]}),e.jsxs("p",{className:"text-sm text-text-secondary",children:[new Date(r.created_at).toLocaleDateString()," - ",r.data_types.length," data types"]})]})]}),e.jsx(g,{variant:"outline",children:r.sent_via_email?t("emailSent")||"Email Sent":t("downloaded")||"Downloaded"})]},n))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Je,{className:"w-16 h-16 mx-auto mb-4 text-text-secondary opacity-50"}),e.jsx("p",{className:"text-text-secondary",children:t("noExportHistory")||"No export history yet"})]})})]})})]})]})},ac=()=>{const{t:t}=v(),{userProfile:n}=l(),[s,i]=r.useState(!0),[a,p]=r.useState([]),[m,x]=r.useState([]),[y,w]=r.useState([]),[C,R]=r.useState(!1),[k,M]=r.useState({doctor_id:"",consultation_type:"video",date:"",time:"",reason:"",notes:""});r.useEffect(()=>{(null==n?void 0:n.id)&&(P(),B(),F())},[null==n?void 0:n.id]);const P=async()=>{try{const{data:e,error:t}=await u.from("doctor_consultations").select("*, health_professionals(*)").eq("user_id",n.id).order("scheduled_datetime",{ascending:!1});if(t)throw t;p(e||[])}catch(e){}finally{i(!1)}},B=async()=>{try{const{data:e,error:t}=await u.from("health_professionals").select("*").eq("is_active",!0).order("name",{ascending:!0});if(t)throw t;x(e||[])}catch(e){}},F=async()=>{try{const{data:e,error:t}=await u.from("prescriptions").select("*, doctor_consultations(*, health_professionals(*))").eq("user_id",n.id).order("prescribed_date",{ascending:!1});if(t)throw t;w(e||[])}catch(e){}},L=()=>{M({doctor_id:"",consultation_type:"video",date:"",time:"",reason:"",notes:""})},U=e=>({scheduled:"bg-blue-500/20 text-blue-300",completed:"bg-green-500/20 text-green-300",cancelled:"bg-red-500/20 text-red-300",inProgress:"bg-yellow-500/20 text-yellow-300"}[e]||"bg-gray-500/20 text-gray-300"),V=a.filter(e=>"scheduled"===e.status&&new Date(e.scheduled_datetime)>new Date),H=a.filter(e=>"completed"===e.status||new Date(e.scheduled_datetime)<new Date);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(_,{className:"glass-effect",children:e.jsx(b,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(N,{className:"flex items-center gap-2 text-xl",children:[e.jsx(lt,{className:"w-6 h-6 text-primary"}),t("doctorConsultations")||"Doctor Consultations"]}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:t("doctorConsultationsDescription")||"Schedule and manage virtual consultations with healthcare professionals"})]}),e.jsxs(A,{open:C,onOpenChange:R,children:[e.jsx(S,{asChild:!0,children:e.jsxs(o,{children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),t("bookConsultation")||"Book Consultation"]})}),e.jsxs(E,{className:"max-w-2xl",children:[e.jsxs(I,{children:[e.jsx(T,{children:t("scheduleConsultation")||"Schedule Consultation"}),e.jsx(D,{children:t("consultationDescription")||"Book a virtual consultation with a healthcare professional"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"doctor",children:t("selectDoctor")||"Select Doctor"}),e.jsxs(At,{value:k.doctor_id,onValueChange:e=>M(t=>({...t,doctor_id:e})),children:[e.jsx(St,{children:e.jsx(Et,{placeholder:t("chooseDoctor")||"Choose a doctor"})}),e.jsx(It,{children:m.map(t=>e.jsxs(Tt,{value:t.id,children:[t.name," - ",t.specialization]},t.id))})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"type",children:t("consultationType")||"Consultation Type"}),e.jsxs(At,{value:k.consultation_type,onValueChange:e=>M(t=>({...t,consultation_type:e})),children:[e.jsx(St,{children:e.jsx(Et,{})}),e.jsxs(It,{children:[e.jsxs(Tt,{value:"video",children:[e.jsx(ct,{className:"w-4 h-4 inline mr-2"}),t("videoCall")||"Video Call"]}),e.jsxs(Tt,{value:"chat",children:[e.jsx(dt,{className:"w-4 h-4 inline mr-2"}),t("chat")||"Chat"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"date",children:t("date")||"Date"}),e.jsx(d,{id:"date",type:"date",value:k.date,onChange:e=>M(t=>({...t,date:e.target.value})),min:(new Date).toISOString().split("T")[0]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"time",children:t("time")||"Time"}),e.jsx(d,{id:"time",type:"time",value:k.time,onChange:e=>M(t=>({...t,time:e.target.value}))})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"reason",children:t("reason")||"Reason for Consultation"}),e.jsx(d,{id:"reason",value:k.reason,onChange:e=>M(t=>({...t,reason:e.target.value})),placeholder:t("enterReason")||"Enter reason"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"notes",children:t("additionalNotes")||"Additional Notes"}),e.jsx(f,{id:"notes",value:k.notes,onChange:e=>M(t=>({...t,notes:e.target.value})),placeholder:t("enterNotes")||"Any additional information..."})]}),e.jsxs(o,{onClick:async()=>{try{const e=`${k.date}T${k.time}:00`,{error:r}=await u.from("doctor_consultations").insert({user_id:n.id,doctor_id:k.doctor_id,consultation_type:k.consultation_type,scheduled_datetime:e,reason:k.reason,notes:k.notes,status:"scheduled"});if(r)throw r;h({title:t("consultationBooked")||"Consultation Booked",description:t("consultationBookedSuccessfully")||"Your consultation has been scheduled successfully"}),R(!1),L(),P()}catch(e){h({title:t("error")||"Error",description:t("failedToBookConsultation")||"Failed to book consultation",variant:"destructive"})}},className:"w-full",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),t("confirmBooking")||"Confirm Booking"]})]})]})]})]})})}),s?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(re,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs(Dt,{defaultValue:"upcoming",className:"w-full",children:[e.jsxs(Ot,{className:"grid w-full grid-cols-3",children:[e.jsxs(Rt,{value:"upcoming",children:[t("upcoming")||"Upcoming"," (",V.length,")"]}),e.jsxs(Rt,{value:"past",children:[t("past")||"Past"," (",H.length,")"]}),e.jsxs(Rt,{value:"prescriptions",children:[t("prescriptions")||"Prescriptions"," (",y.length,")"]})]}),e.jsx(kt,{value:"upcoming",className:"space-y-4",children:V.length>0?V.map(r=>{var n,s;return e.jsx(_,{className:"glass-effect",children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:"p-3 bg-primary/20 rounded-full",children:e.jsx(lt,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:null==(n=r.health_professionals)?void 0:n.name}),e.jsx("p",{className:"text-sm text-text-secondary mb-2",children:null==(s=r.health_professionals)?void 0:s.specialization}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-text-secondary mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"w-4 h-4"}),new Date(r.scheduled_datetime).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"w-4 h-4"}),new Date(r.scheduled_datetime).toLocaleTimeString()]}),e.jsxs(g,{className:U(r.consultation_type),children:["video"===r.consultation_type?e.jsx(ct,{className:"w-3 h-3 mr-1"}):e.jsx(dt,{className:"w-3 h-3 mr-1"}),r.consultation_type]})]}),e.jsxs("p",{className:"text-sm",children:[e.jsxs("strong",{children:[t("reason")||"Reason",":"]})," ",r.reason]})]})]}),e.jsx(g,{className:U(r.status),children:r.status})]})})},r.id)}):e.jsx(_,{className:"glass-effect",children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(ie,{className:"w-16 h-16 mb-4 text-text-secondary opacity-50"}),e.jsx("p",{className:"text-text-secondary",children:t("noUpcomingConsultations")||"No upcoming consultations"})]})})}),e.jsx(kt,{value:"past",className:"space-y-4",children:H.length>0?H.map(r=>{var n,s;return e.jsx(_,{className:"glass-effect opacity-80",children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:"p-3 bg-muted rounded-full",children:e.jsx(lt,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:null==(n=r.health_professionals)?void 0:n.name}),e.jsx("p",{className:"text-sm text-text-secondary mb-2",children:null==(s=r.health_professionals)?void 0:s.specialization}),e.jsx("div",{className:"flex items-center gap-4 text-sm text-text-secondary",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"w-4 h-4"}),new Date(r.scheduled_datetime).toLocaleDateString()]})})]})]}),e.jsx(g,{className:"bg-green-500/20 text-green-300",children:t("completed")||"Completed"})]})})},r.id)}):e.jsx(_,{className:"glass-effect",children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Qe,{className:"w-16 h-16 mb-4 text-text-secondary opacity-50"}),e.jsx("p",{className:"text-text-secondary",children:t("noPastConsultations")||"No past consultations"})]})})}),e.jsx(kt,{value:"prescriptions",className:"space-y-4",children:y.length>0?y.map(r=>e.jsx(_,{className:"glass-effect",children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(ut,{className:"w-6 h-6 text-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold mb-2",children:r.medication_name}),e.jsxs("p",{className:"text-sm text-text-secondary mb-1",children:[e.jsxs("strong",{children:[t("dosage")||"Dosage",":"]})," ",r.dosage]}),e.jsxs("p",{className:"text-sm text-text-secondary mb-1",children:[e.jsxs("strong",{children:[t("duration")||"Duration",":"]})," ",r.duration]}),e.jsxs("p",{className:"text-sm text-text-secondary",children:[e.jsxs("strong",{children:[t("prescribed")||"Prescribed",":"]})," ",new Date(r.prescribed_date).toLocaleDateString()]})]})]})})},r.id)):e.jsx(_,{className:"glass-effect",children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(ut,{className:"w-16 h-16 mb-4 text-text-secondary opacity-50"}),e.jsx("p",{className:"text-text-secondary",children:t("noPrescriptions")||"No prescriptions yet"})]})})})]})]})},oc=()=>{const{t:t}=v(),{userProfile:n}=l(),[s,i]=r.useState(!0),[a,p]=r.useState([]),[m,x]=r.useState([]),[y,w]=r.useState(!1),[C,R]=r.useState({professional_id:"",appointment_type:"checkup",date:"",time:"",location:"",notes:"",reminder_time:"24"});r.useEffect(()=>{(null==n?void 0:n.id)&&(k(),M())},[null==n?void 0:n.id]);const k=async()=>{try{const{data:e,error:t}=await u.from("doctor_appointments").select("*, health_professionals(*)").eq("user_id",n.id).order("appointment_datetime",{ascending:!0});if(t)throw t;p(e||[])}catch(e){h({title:t("error")||"Error",description:t("failedToLoadAppointments")||"Failed to load appointments",variant:"destructive"})}finally{i(!1)}},M=async()=>{try{const{data:e,error:t}=await u.from("health_professionals").select("*").eq("is_active",!0).order("name",{ascending:!0});if(t)throw t;x(e||[])}catch(e){}},P=()=>{R({professional_id:"",appointment_type:"checkup",date:"",time:"",location:"",notes:"",reminder_time:"24"})},B=e=>({scheduled:"bg-blue-500/20 text-blue-300",completed:"bg-green-500/20 text-green-300",cancelled:"bg-red-500/20 text-red-300",missed:"bg-orange-500/20 text-orange-300"}[e]||"bg-gray-500/20 text-gray-300"),F=[{value:"checkup",label:t("generalCheckup")||"General Checkup",icon:"ðŸ©º"},{value:"followup",label:t("followUp")||"Follow-up",icon:"ðŸ“‹"},{value:"consultation",label:t("consultation")||"Consultation",icon:"ðŸ’¬"},{value:"therapy",label:t("therapy")||"Therapy",icon:"ðŸ§˜"},{value:"vaccination",label:t("vaccination")||"Vaccination",icon:"ðŸ’‰"},{value:"labwork",label:t("labWork")||"Lab Work",icon:"ðŸ”¬"}],L=a.filter(e=>"scheduled"===e.status&&new Date(e.appointment_datetime)>new Date),U=a.filter(e=>"completed"===e.status||new Date(e.appointment_datetime)<new Date);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(_,{className:"glass-effect",children:e.jsx(b,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(N,{className:"flex items-center gap-2 text-xl",children:[e.jsx(ie,{className:"w-6 h-6 text-primary"}),t("appointmentScheduling")||"Appointment Scheduling"]}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:t("appointmentSchedulingDescription")||"Manage your healthcare appointments and reminders"})]}),e.jsxs(A,{open:y,onOpenChange:e=>{w(e),e||P()},children:[e.jsx(S,{asChild:!0,children:e.jsxs(o,{children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),t("newAppointment")||"New Appointment"]})}),e.jsxs(E,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(I,{children:[e.jsx(T,{children:t("scheduleAppointment")||"Schedule Appointment"}),e.jsx(D,{children:t("appointmentDescription")||"Book an appointment with a healthcare professional"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"professional",children:t("selectProfessional")||"Select Healthcare Professional"}),e.jsxs(At,{value:C.professional_id,onValueChange:e=>R(t=>({...t,professional_id:e})),children:[e.jsx(St,{children:e.jsx(Et,{placeholder:t("chooseProfessional")||"Choose a professional"})}),e.jsx(It,{children:m.map(t=>e.jsx(Tt,{value:t.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ht,{className:"w-4 h-4"}),t.name," - ",t.specialization]})},t.id))})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"type",children:t("appointmentType")||"Appointment Type"}),e.jsxs(At,{value:C.appointment_type,onValueChange:e=>R(t=>({...t,appointment_type:e})),children:[e.jsx(St,{children:e.jsx(Et,{})}),e.jsx(It,{children:F.map(t=>e.jsxs(Tt,{value:t.value,children:[t.icon," ",t.label]},t.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"date",children:t("date")||"Date"}),e.jsx(d,{id:"date",type:"date",value:C.date,onChange:e=>R(t=>({...t,date:e.target.value})),min:(new Date).toISOString().split("T")[0]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"time",children:t("time")||"Time"}),e.jsx(d,{id:"time",type:"time",value:C.time,onChange:e=>R(t=>({...t,time:e.target.value}))})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"location",children:t("location")||"Location"}),e.jsx(d,{id:"location",value:C.location,onChange:e=>R(t=>({...t,location:e.target.value})),placeholder:t("enterLocation")||"Enter location or clinic address"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"reminder",children:t("reminder")||"Reminder"}),e.jsxs(At,{value:C.reminder_time,onValueChange:e=>R(t=>({...t,reminder_time:e})),children:[e.jsx(St,{children:e.jsx(Et,{})}),e.jsxs(It,{children:[e.jsx(Tt,{value:"1",children:"1 hour before"}),e.jsx(Tt,{value:"24",children:"1 day before"}),e.jsx(Tt,{value:"48",children:"2 days before"}),e.jsx(Tt,{value:"168",children:"1 week before"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"notes",children:t("notes")||"Notes"}),e.jsx(f,{id:"notes",value:C.notes,onChange:e=>R(t=>({...t,notes:e.target.value})),placeholder:t("enterNotes")||"Any special notes or preparations..."})]}),e.jsxs(o,{onClick:async()=>{try{const e=`${C.date}T${C.time}:00`,{error:r}=await u.from("doctor_appointments").insert({user_id:n.id,professional_id:C.professional_id,appointment_type:C.appointment_type,appointment_datetime:e,location:C.location,notes:C.notes,reminder_hours_before:parseInt(C.reminder_time),status:"scheduled"});if(r)throw r;h({title:t("appointmentScheduled")||"Appointment Scheduled",description:t("appointmentScheduledSuccessfully")||"Your appointment has been scheduled successfully"}),w(!1),P(),k()}catch(e){h({title:t("error")||"Error",description:t("failedToScheduleAppointment")||"Failed to schedule appointment",variant:"destructive"})}},className:"w-full",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),t("scheduleAppointment")||"Schedule Appointment"]})]})]})]})]})})}),s?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(re,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs(Dt,{defaultValue:"upcoming",className:"w-full",children:[e.jsxs(Ot,{className:"grid w-full grid-cols-2",children:[e.jsxs(Rt,{value:"upcoming",children:[t("upcoming")||"Upcoming"," (",L.length,")"]}),e.jsxs(Rt,{value:"past",children:[t("past")||"Past"," (",U.length,")"]})]}),e.jsx(kt,{value:"upcoming",className:"space-y-4",children:L.length>0?L.map(r=>{var n,s;return e.jsx(_,{className:"glass-effect",children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:"p-3 bg-primary/20 rounded-lg",children:e.jsx(ie,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:(null==(n=F.find(e=>e.value===r.appointment_type))?void 0:n.label)||r.appointment_type}),e.jsx(g,{className:B(r.status),children:r.status})]}),e.jsxs("p",{className:"text-sm text-text-secondary mb-2",children:[t("with")||"with"," ",null==(s=r.health_professionals)?void 0:s.name]}),e.jsxs("div",{className:"space-y-1 text-sm text-text-secondary",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),new Date(r.appointment_datetime).toLocaleString()]}),r.location&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"w-4 h-4"}),r.location]}),r.reminder_hours_before&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4"}),"Reminder ",r.reminder_hours_before,"h before"]})]}),r.notes&&e.jsx("p",{className:"text-sm mt-2 p-2 bg-muted rounded",children:r.notes})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>(async e=>{var t;R({professional_id:e.professional_id,appointment_type:e.appointment_type,date:e.appointment_datetime.split("T")[0],time:e.appointment_datetime.split("T")[1].substring(0,5),location:e.location||"",notes:e.notes||"",reminder_time:(null==(t=e.reminder_hours_before)?void 0:t.toString())||"24"}),w(!0)})(r),children:[e.jsx(Fe,{className:"w-4 h-4 mr-1"}),t("reschedule")||"Reschedule"]}),e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>(async e=>{try{const{error:r}=await u.from("doctor_appointments").update({status:"cancelled"}).eq("id",e);if(r)throw r;h({title:t("appointmentCancelled")||"Appointment Cancelled",description:t("appointmentCancelledSuccessfully")||"The appointment has been cancelled"}),k()}catch(r){h({title:t("error")||"Error",description:t("failedToCancelAppointment")||"Failed to cancel appointment",variant:"destructive"})}})(r.id),children:[e.jsx(Le,{className:"w-4 h-4 mr-1"}),t("cancel")||"Cancel"]})]})]})})},r.id)}):e.jsx(_,{className:"glass-effect",children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(ie,{className:"w-16 h-16 mb-4 text-text-secondary opacity-50"}),e.jsx("p",{className:"text-text-secondary mb-4",children:t("noUpcomingAppointments")||"No upcoming appointments"}),e.jsxs(o,{onClick:()=>w(!0),children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),t("scheduleFirst")||"Schedule Your First Appointment"]})]})})}),e.jsx(kt,{value:"past",className:"space-y-4",children:U.length>0?U.map(t=>{var r,n;return e.jsx(_,{className:"glass-effect opacity-80",children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(de,{className:"w-6 h-6 text-green-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold mb-1",children:(null==(r=F.find(e=>e.value===t.appointment_type))?void 0:r.label)||t.appointment_type}),e.jsxs("p",{className:"text-sm text-text-secondary",children:[null==(n=t.health_professionals)?void 0:n.name," - ",new Date(t.appointment_datetime).toLocaleDateString()]})]}),e.jsx(g,{className:B(t.status),children:t.status})]})})},t.id)}):e.jsx(_,{className:"glass-effect",children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(ie,{className:"w-16 h-16 mb-4 text-text-secondary opacity-50"}),e.jsx("p",{className:"text-text-secondary",children:t("noPastAppointments")||"No past appointments"})]})})})]})]})},lc=({compact:t=!1})=>{const{user:n}=l(),[s,i]=r.useState([]),[a,o]=r.useState([]),[c,d]=r.useState(null),[h,f]=r.useState(!0),[p,m]=r.useState(null);r.useEffect(()=>{(null==n?void 0:n.id)&&x()},[n]);const x=async()=>{try{f(!0);const{data:e}=await u.from("user_streaks").select("*").eq("user_id",n.id);i(e||[]);const{data:t}=await u.from("user_achievements").select("*").eq("user_id",n.id).order("unlocked_at",{ascending:!1});o(t||[]);const{data:r}=await u.from("user_levels").select("*").eq("user_id",n.id).single();d(r)}catch(e){}finally{f(!1)}},y=t=>{switch(t){case"logging":return e.jsx($,{className:"w-5 h-5 text-yellow-500"});case"workouts":return e.jsx(Be,{className:"w-5 h-5 text-blue-500"});case"meals":return e.jsx(Me,{className:"w-5 h-5 text-green-500"});case"water":return e.jsx(q,{className:"w-5 h-5 text-cyan-500"});default:return e.jsx(_e,{className:"w-5 h-5 text-orange-500"})}},v=e=>{switch(e){case"bronze":return"bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200";case"silver":return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200";case"gold":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";case"platinum":return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200";default:return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"}};return h?e.jsx(_,{className:"glass-effect",children:e.jsx(j,{className:"p-6 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):t?e.jsxs("div",{className:"flex items-center gap-4",children:[c&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-primary/10 rounded-full",children:[e.jsx(pt,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"font-semibold text-sm",children:["Level ",c.current_level]})]}),s.length>0&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-orange-500/10 rounded-full",children:[e.jsx(_e,{className:"w-4 h-4 text-orange-500"}),e.jsxs("span",{className:"font-semibold text-sm",children:[Math.max(...s.map(e=>e.current_streak))," day streak"]})]}),a.length>0&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-yellow-500/10 rounded-full",children:[e.jsx(Be,{className:"w-4 h-4 text-yellow-500"}),e.jsxs("span",{className:"font-semibold text-sm",children:[a.length," achievements"]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(mt,{children:p&&e.jsx(gt.div,{initial:{opacity:0,y:-20,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.9},className:"fixed top-20 right-4 z-50 bg-gradient-to-r from-yellow-400 to-orange-500 text-white p-6 rounded-xl shadow-2xl max-w-sm",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"text-5xl",children:p.achievement_icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:"Achievement Unlocked!"}),e.jsx("p",{className:"font-semibold",children:p.achievement_name}),e.jsx("p",{className:"text-sm opacity-90",children:p.achievement_description}),e.jsxs("p",{className:"text-sm font-bold mt-2",children:["+",p.points_earned," XP"]})]})]})})}),c&&e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(pt,{className:"w-6 h-6 text-primary"}),"Your Progress"]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-3xl font-bold",children:["Level ",c.current_level]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c.level_name})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-semibold",children:[c.total_xp," XP"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[100*Math.pow(c.current_level,2)-c.total_xp," XP to next level"]})]})]}),e.jsx(Xt,{value:(()=>{if(!c)return 0;const e=100*Math.pow(c.current_level-1,2),t=100*Math.pow(c.current_level,2);return(c.total_xp-e)/(t-e)*100})(),className:"h-3"})]})]}),e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-6 h-6 text-orange-500"}),"Your Streaks"]})}),e.jsx(j,{children:0===s.length?e.jsx("p",{className:"text-muted-foreground text-center py-4",children:"Start logging activities to build your streaks!"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg bg-gradient-to-r from-orange-500/10 to-red-500/10 border border-orange-500/20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[y(t.streak_type),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold capitalize",children:t.streak_type}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Longest: ",t.longest_streak," days"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-orange-500",children:t.current_streak}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"days"})]})]},t.id))})})]}),e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-6 h-6 text-yellow-500"}),"Achievements (",a.length,")"]})}),e.jsx(j,{children:0===a.length?e.jsx("p",{className:"text-muted-foreground text-center py-4",children:"Complete activities to unlock achievements!"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(t=>e.jsx(gt.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"p-4 rounded-lg border border-border hover:shadow-lg transition-all",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-4xl",children:t.achievement_icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"font-semibold truncate",children:t.achievement_name}),e.jsx(g,{className:v(t.tier),children:t.tier})]}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:t.achievement_description}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-primary",children:[e.jsx($,{className:"w-3 h-3"}),e.jsxs("span",{children:["+",t.points_earned," XP"]})]})]})]})},t.id))})})]})]})};var cc={};!function e(t,r,n,s){var i=!!(t.Worker&&t.Blob&&t.Promise&&t.OffscreenCanvas&&t.OffscreenCanvasRenderingContext2D&&t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype.transferControlToOffscreen&&t.URL&&t.URL.createObjectURL),a="function"==typeof Path2D&&"function"==typeof DOMMatrix,o=function(){if(!t.OffscreenCanvas)return!1;try{var e=new OffscreenCanvas(1,1),r=e.getContext("2d");r.fillRect(0,0,1,1);var n=e.transferToImageBitmap();r.createPattern(n,"no-repeat")}catch(s){return!1}return!0}();function l(){}function c(e){var n=r.exports.Promise,s=void 0!==n?n:t.Promise;return"function"==typeof s?new s(e):(e(l,l),null)}var d,u,h,f,p,m,g,x,y,v,w,_=(d=o,u=new Map,{transform:function(e){if(d)return e;if(u.has(e))return u.get(e);var t=new OffscreenCanvas(e.width,e.height);return t.getContext("2d").drawImage(e,0,0),u.set(e,t),t},clear:function(){u.clear()}}),b=(p=Math.floor(1e3/60),m={},g=0,"function"==typeof requestAnimationFrame&&"function"==typeof cancelAnimationFrame?(h=function(e){var t=Math.random();return m[t]=requestAnimationFrame(function r(n){g===n||g+p-1<n?(g=n,delete m[t],e()):m[t]=requestAnimationFrame(r)}),t},f=function(e){m[e]&&cancelAnimationFrame(m[e])}):(h=function(e){return setTimeout(e,p)},f=function(e){return clearTimeout(e)}),{frame:h,cancel:f}),N=(v={},function(){if(x)return x;if(!n&&i){var t=["var CONFETTI, SIZE = {}, module = {};","("+e.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join("\n");try{x=new Worker(URL.createObjectURL(new Blob([t])))}catch(r){return"undefined"!=typeof console&&console.warn,null}!function(e){function t(t,r){e.postMessage({options:t||{},callback:r})}e.init=function(t){var r=t.transferControlToOffscreen();e.postMessage({canvas:r},[r])},e.fire=function(r,n,s){if(y)return t(r,null),y;var i=Math.random().toString(36).slice(2);return y=c(function(n){function a(t){t.data.callback===i&&(delete v[i],e.removeEventListener("message",a),y=null,_.clear(),s(),n())}e.addEventListener("message",a),t(r,i),v[i]=a.bind(null,{data:{callback:i}})})},e.reset=function(){for(var t in e.postMessage({reset:!0}),v)v[t](),delete v[t]}}(x)}return x}),j={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function C(e,t,r){return function(e,t){return t?t(e):e}(e&&null!=e[t]?e[t]:j[t],r)}function A(e){return e<0?0:Math.floor(e)}function S(e,t){return Math.floor(Math.random()*(t-e))+e}function E(e){return parseInt(e,16)}function I(e){return e.map(T)}function T(e){var t=String(e).replace(/[^0-9a-f]/gi,"");return t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),{r:E(t.substring(0,2)),g:E(t.substring(2,4)),b:E(t.substring(4,6))}}function D(e){e.width=document.documentElement.clientWidth,e.height=document.documentElement.clientHeight}function O(e){var t=e.getBoundingClientRect();e.width=t.width,e.height=t.height}function R(e){var t=e.angle*(Math.PI/180),r=e.spread*(Math.PI/180);return{x:e.x,y:e.y,wobble:10*Math.random(),wobbleSpeed:Math.min(.11,.1*Math.random()+.05),velocity:.5*e.startVelocity+Math.random()*e.startVelocity,angle2D:-t+(.5*r-Math.random()*r),tiltAngle:(.5*Math.random()+.25)*Math.PI,color:e.color,shape:e.shape,tick:0,totalTicks:e.ticks,decay:e.decay,drift:e.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:3*e.gravity,ovalScalar:.6,scalar:e.scalar,flat:e.flat}}function k(e,t){t.x+=Math.cos(t.angle2D)*t.velocity+t.drift,t.y+=Math.sin(t.angle2D)*t.velocity+t.gravity,t.velocity*=t.decay,t.flat?(t.wobble=0,t.wobbleX=t.x+10*t.scalar,t.wobbleY=t.y+10*t.scalar,t.tiltSin=0,t.tiltCos=0,t.random=1):(t.wobble+=t.wobbleSpeed,t.wobbleX=t.x+10*t.scalar*Math.cos(t.wobble),t.wobbleY=t.y+10*t.scalar*Math.sin(t.wobble),t.tiltAngle+=.1,t.tiltSin=Math.sin(t.tiltAngle),t.tiltCos=Math.cos(t.tiltAngle),t.random=Math.random()+2);var r=t.tick++/t.totalTicks,n=t.x+t.random*t.tiltCos,s=t.y+t.random*t.tiltSin,i=t.wobbleX+t.random*t.tiltCos,o=t.wobbleY+t.random*t.tiltSin;if(e.fillStyle="rgba("+t.color.r+", "+t.color.g+", "+t.color.b+", "+(1-r)+")",e.beginPath(),a&&"path"===t.shape.type&&"string"==typeof t.shape.path&&Array.isArray(t.shape.matrix))e.fill(function(e,t,r,n,s,i,a){var o=new Path2D(e),l=new Path2D;l.addPath(o,new DOMMatrix(t));var c=new Path2D;return c.addPath(l,new DOMMatrix([Math.cos(a)*s,Math.sin(a)*s,-Math.sin(a)*i,Math.cos(a)*i,r,n])),c}(t.shape.path,t.shape.matrix,t.x,t.y,.1*Math.abs(i-n),.1*Math.abs(o-s),Math.PI/10*t.wobble));else if("bitmap"===t.shape.type){var l=Math.PI/10*t.wobble,c=.1*Math.abs(i-n),d=.1*Math.abs(o-s),u=t.shape.bitmap.width*t.scalar,h=t.shape.bitmap.height*t.scalar,f=new DOMMatrix([Math.cos(l)*c,Math.sin(l)*c,-Math.sin(l)*d,Math.cos(l)*d,t.x,t.y]);f.multiplySelf(new DOMMatrix(t.shape.matrix));var p=e.createPattern(_.transform(t.shape.bitmap),"no-repeat");p.setTransform(f),e.globalAlpha=1-r,e.fillStyle=p,e.fillRect(t.x-u/2,t.y-h/2,u,h),e.globalAlpha=1}else if("circle"===t.shape)e.ellipse?e.ellipse(t.x,t.y,Math.abs(i-n)*t.ovalScalar,Math.abs(o-s)*t.ovalScalar,Math.PI/10*t.wobble,0,2*Math.PI):function(e,t,r,n,s,i,a,o,l){e.save(),e.translate(t,r),e.rotate(i),e.scale(n,s),e.arc(0,0,1,a,o,l),e.restore()}(e,t.x,t.y,Math.abs(i-n)*t.ovalScalar,Math.abs(o-s)*t.ovalScalar,Math.PI/10*t.wobble,0,2*Math.PI);else if("star"===t.shape)for(var m=Math.PI/2*3,g=4*t.scalar,x=8*t.scalar,y=t.x,v=t.y,w=5,b=Math.PI/w;w--;)y=t.x+Math.cos(m)*x,v=t.y+Math.sin(m)*x,e.lineTo(y,v),m+=b,y=t.x+Math.cos(m)*g,v=t.y+Math.sin(m)*g,e.lineTo(y,v),m+=b;else e.moveTo(Math.floor(t.x),Math.floor(t.y)),e.lineTo(Math.floor(t.wobbleX),Math.floor(s)),e.lineTo(Math.floor(i),Math.floor(o)),e.lineTo(Math.floor(n),Math.floor(t.wobbleY));return e.closePath(),e.fill(),t.tick<t.totalTicks}function M(e,r){var a,o=!e,l=!!C(r||{},"resize"),d=!1,u=C(r,"disableForReducedMotion",Boolean),h=i&&!!C(r||{},"useWorker")?N():null,f=o?D:O,p=!(!e||!h)&&!!e.__confetti_initialized,m="function"==typeof matchMedia&&matchMedia("(prefers-reduced-motion)").matches;function g(t,r,i){for(var o=C(t,"particleCount",A),l=C(t,"angle",Number),d=C(t,"spread",Number),u=C(t,"startVelocity",Number),h=C(t,"decay",Number),p=C(t,"gravity",Number),m=C(t,"drift",Number),g=C(t,"colors",I),x=C(t,"ticks",Number),y=C(t,"shapes"),v=C(t,"scalar"),w=!!C(t,"flat"),N=function(e){var t=C(e,"origin",Object);return t.x=C(t,"x",Number),t.y=C(t,"y",Number),t}(t),j=o,E=[],T=e.width*N.x,D=e.height*N.y;j--;)E.push(R({x:T,y:D,angle:l,spread:d,startVelocity:u,color:g[j%g.length],shape:y[S(0,y.length)],ticks:x,decay:h,gravity:p,drift:m,scalar:v,flat:w}));return a?a.addFettis(E):(a=function(e,t,r,i,a){var o,l,d=t.slice(),u=e.getContext("2d"),h=c(function(t){function c(){o=l=null,u.clearRect(0,0,i.width,i.height),_.clear(),a(),t()}o=b.frame(function t(){!n||i.width===s.width&&i.height===s.height||(i.width=e.width=s.width,i.height=e.height=s.height),i.width||i.height||(r(e),i.width=e.width,i.height=e.height),u.clearRect(0,0,i.width,i.height),(d=d.filter(function(e){return k(u,e)})).length?o=b.frame(t):c()}),l=c});return{addFettis:function(e){return d=d.concat(e),h},canvas:e,promise:h,reset:function(){o&&b.cancel(o),l&&l()}}}(e,E,f,r,i),a.promise)}function x(r){var n=u||C(r,"disableForReducedMotion",Boolean),s=C(r,"zIndex",Number);if(n&&m)return c(function(e){e()});o&&a?e=a.canvas:o&&!e&&(e=function(e){var t=document.createElement("canvas");return t.style.position="fixed",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.zIndex=e,t}(s),document.body.appendChild(e)),l&&!p&&f(e);var i={width:e.width,height:e.height};function x(){if(h){var t={getBoundingClientRect:function(){if(!o)return e.getBoundingClientRect()}};return f(t),void h.postMessage({resize:{width:t.width,height:t.height}})}i.width=i.height=null}function y(){a=null,l&&(d=!1,t.removeEventListener("resize",x)),o&&e&&(document.body.contains(e)&&document.body.removeChild(e),e=null,p=!1)}return h&&!p&&h.init(e),p=!0,h&&(e.__confetti_initialized=!0),l&&!d&&(d=!0,t.addEventListener("resize",x,!1)),h?h.fire(r,i,y):g(r,i,y)}return x.reset=function(){h&&h.reset(),a&&a.reset()},x}function P(){return w||(w=M(null,{useWorker:!0,resize:!0})),w}r.exports=function(){return P().apply(this,arguments)},r.exports.reset=function(){P().reset()},r.exports.create=M,r.exports.shapeFromPath=function(e){if(!a)throw new Error("path confetti are not supported in this browser");var t,r;"string"==typeof e?t=e:(t=e.path,r=e.matrix);var n=new Path2D(t),s=document.createElement("canvas").getContext("2d");if(!r){for(var i,o,l=1e3,c=l,d=l,u=0,h=0,f=0;f<l;f+=2)for(var p=0;p<l;p+=2)s.isPointInPath(n,f,p,"nonzero")&&(c=Math.min(c,f),d=Math.min(d,p),u=Math.max(u,f),h=Math.max(h,p));i=u-c,o=h-d;var m=Math.min(10/i,10/o);r=[m,0,0,m,-Math.round(i/2+c)*m,-Math.round(o/2+d)*m]}return{type:"path",path:t,matrix:r}},r.exports.shapeFromText=function(e){var t,r=1,n="#000000",s='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';"string"==typeof e?t=e:(t=e.text,r="scalar"in e?e.scalar:r,s="fontFamily"in e?e.fontFamily:s,n="color"in e?e.color:n);var i=10*r,a=i+"px "+s,o=new OffscreenCanvas(i,i),l=o.getContext("2d");l.font=a;var c=l.measureText(t),d=Math.ceil(c.actualBoundingBoxRight+c.actualBoundingBoxLeft),u=Math.ceil(c.actualBoundingBoxAscent+c.actualBoundingBoxDescent),h=c.actualBoundingBoxLeft+2,f=c.actualBoundingBoxAscent+2;d+=4,u+=4,(l=(o=new OffscreenCanvas(d,u)).getContext("2d")).font=a,l.fillStyle=n,l.fillText(t,h,f);var p=1/r;return{type:"bitmap",bitmap:o.transferToImageBitmap(),matrix:[p,0,0,p,-d*p/2,-u*p/2]}}}(function(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:this||{}}(),cc,!1);const dc=cc.exports;cc.exports.create;const uc=({compact:t=!1})=>{const{user:n}=l(),[s,i]=r.useState(null),[a,o]=r.useState(!0),[c,d]=r.useState(!1),[h,f]=r.useState(null);r.useEffect(()=>{(null==n?void 0:n.id)&&(p(),m())},[n]);const p=async()=>{try{o(!0);const{data:e,error:t}=await u.from("user_levels").select("*").eq("user_id",n.id).single();if(t&&"PGRST116"!==t.code)throw t;if(e)i(e);else{const{data:e,error:t}=await u.from("user_levels").insert({user_id:n.id,current_level:1,current_xp:0,total_xp:0,level_name:"Bronze Beginner"}).select().single();t||i(e)}}catch(e){}finally{o(!1)}},m=()=>{const e=u.channel(`level-${n.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"user_levels",filter:`user_id=eq.${n.id}`},e=>{const t=null==s?void 0:s.current_level;e.new.current_level>t?g(e.new):i(e.new)}).subscribe();return()=>{u.removeChannel(e)}},g=e=>{f(s),i(e),d(!0),x(),setTimeout(()=>{d(!1),f(null)},3e3)},x=()=>{const e=Date.now()+3e3,t=()=>{dc({particleCount:7,angle:60,spread:55,origin:{x:0},colors:["#FFD700","#FFA500","#FF8C00"]}),dc({particleCount:7,angle:120,spread:55,origin:{x:1},colors:["#FFD700","#FFA500","#FF8C00"]}),Date.now()<e&&requestAnimationFrame(t)};t();try{const e=new Audio("/sounds/level-up.mp3");e.volume=.4,e.play().catch(()=>{})}catch(r){}},y=()=>{if(!s)return 0;const e=100*Math.pow(s.current_level-1,2),t=100*Math.pow(s.current_level,2),r=s.total_xp-e,n=t-e;return Math.min(r/n*100,100)},v=()=>{if(!s)return 0;return 100*Math.pow(s.current_level,2)-s.total_xp},w=()=>{const e=(null==s?void 0:s.current_level)||1;return e>=30?"ðŸ’Ž":e>=20?"ðŸ‘‘":e>=10?"ðŸ†":e>=5?"â­":"ðŸ¥‰"};return a?e.jsx(_,{className:"glass-effect animate-pulse",children:e.jsx(j,{className:"p-6",children:e.jsx("div",{className:"h-20 bg-muted rounded"})})}):t?e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-gradient-to-r from-primary/10 to-purple-500/10",children:[e.jsx(gt.div,{className:"flex items-center justify-center w-10 h-10 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500 text-white font-bold",animate:c?{scale:[1,1.2,1],rotate:[0,360]}:{},transition:{duration:.6},children:null==s?void 0:s.current_level}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Level ",null==s?void 0:s.current_level]}),e.jsx(Xt,{value:y(),className:"h-2"})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-xs font-semibold",children:[null==s?void 0:s.total_xp," XP"]})})]}):e.jsxs("div",{className:"relative",children:[e.jsx(mt,{children:c&&e.jsx(gt.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:e.jsxs(gt.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:1.5,opacity:0},transition:{type:"spring",stiffness:200,damping:20},className:"bg-gradient-to-br from-yellow-400 via-orange-500 to-pink-500 p-8 rounded-2xl shadow-2xl text-white text-center max-w-md mx-4",children:[e.jsx(gt.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"text-6xl mb-4",children:w()}),e.jsx("h2",{className:"text-4xl font-bold mb-2",children:"LEVEL UP!"}),e.jsxs("p",{className:"text-2xl font-semibold mb-4",children:["Level ",null==h?void 0:h.current_level," â†’ Level ",null==s?void 0:s.current_level]}),e.jsx("p",{className:"text-lg mb-4",children:null==s?void 0:s.level_name}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm",children:[e.jsx(q,{className:"w-5 h-5"}),e.jsx("span",{children:"Keep up the great work!"}),e.jsx(q,{className:"w-5 h-5"})]})]})})}),e.jsx(_,{className:"glass-effect overflow-hidden",children:e.jsxs("div",{className:`relative bg-gradient-to-r ${(()=>{const e=(null==s?void 0:s.current_level)||1;return e>=30?"from-purple-500 to-pink-500":e>=20?"from-blue-400 to-purple-500":e>=10?"from-yellow-400 to-yellow-600":e>=5?"from-gray-400 to-gray-600":"from-amber-600 to-amber-800"})()} p-6 text-white`,children:[e.jsx(b,{className:"p-0 mb-4",children:e.jsxs(N,{className:"flex items-center gap-2 text-white",children:[e.jsx(pt,{className:"w-5 h-5"}),"Your Level"]})}),e.jsxs(j,{className:"p-0",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx(gt.div,{className:"flex items-center justify-center w-20 h-20 rounded-full bg-white/20 backdrop-blur-sm text-4xl font-bold",whileHover:{scale:1.1},children:w()}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-3xl font-bold mb-1",children:["Level ",null==s?void 0:s.current_level]}),e.jsx("p",{className:"text-sm opacity-90",children:null==s?void 0:s.level_name})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-semibold",children:[null==s?void 0:s.total_xp," XP"]}),e.jsx("p",{className:"text-xs opacity-75",children:"Total Experience"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"opacity-90",children:["Progress to Level ",(null==s?void 0:s.current_level)+1]}),e.jsxs("span",{className:"font-semibold",children:[Math.round(y()),"%"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-3 bg-white/20 rounded-full overflow-hidden backdrop-blur-sm",children:e.jsx(gt.div,{className:"h-full bg-gradient-to-r from-yellow-300 to-yellow-500 rounded-full",initial:{width:0},animate:{width:`${y()}%`},transition:{duration:1,ease:"easeOut"}})}),e.jsx(gt.div,{className:"absolute -top-8 right-0 bg-white text-gray-900 px-3 py-1 rounded-full text-xs font-semibold shadow-lg",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5},children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($,{className:"w-3 h-3 text-yellow-500"}),e.jsxs("span",{children:[v()," XP to go"]})]})})]}),e.jsxs("p",{className:"text-xs opacity-75 text-right",children:[v()," XP needed for next level"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-4 pt-4 border-t border-white/20",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center gap-1 mb-1",children:e.jsx(X,{className:"w-4 h-4"})}),e.jsx("p",{className:"text-lg font-bold",children:null==s?void 0:s.current_xp}),e.jsx("p",{className:"text-xs opacity-75",children:"Current Level XP"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center gap-1 mb-1",children:e.jsx(Ve,{className:"w-4 h-4"})}),e.jsx("p",{className:"text-lg font-bold",children:100*Math.pow((null==s?void 0:s.current_level)||1,2)}),e.jsx("p",{className:"text-xs opacity-75",children:"Next Level"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center gap-1 mb-1",children:e.jsx(q,{className:"w-4 h-4"})}),e.jsx("p",{className:"text-lg font-bold",children:null==s?void 0:s.total_xp}),e.jsx("p",{className:"text-xs opacity-75",children:"Total XP"})]})]})]})]})})]})},hc=({compact:t=!1})=>{const{user:n}=l(),[s,i]=r.useState([]),[a,c]=r.useState([]),[d,h]=r.useState(!0),[f,p]=r.useState("all"),[m,x]=r.useState("all");r.useEffect(()=>{(null==n?void 0:n.id)&&(y(),v())},[n]);const y=async()=>{try{const{data:e,error:t}=await u.from("achievements").select("*").order("tier",{ascending:!0}).order("points_required",{ascending:!0});t||i(e||[])}catch(e){}},v=async()=>{try{h(!0);const{data:e,error:t}=await u.from("user_achievements").select("achievement_id, unlocked_at, points_earned").eq("user_id",n.id);t||c(e||[])}catch(e){}finally{h(!1)}},w=e=>{switch(e){case"bronze":return"from-amber-600 to-amber-800";case"silver":return"from-gray-400 to-gray-600";case"gold":return"from-yellow-400 to-yellow-600";case"platinum":return"from-purple-400 to-purple-600";default:return"from-blue-500 to-purple-600"}},C=e=>{switch(e){case"bronze":return"ðŸ¥‰";case"silver":return"ðŸ¥ˆ";case"gold":return"ðŸ¥‡";case"platinum":return"ðŸ’Ž";default:return"ðŸ†"}},A=e=>{switch(e){case"streaks":return"ðŸ”¥";case"goals":return"ðŸŽ¯";case"social":return"ðŸ‘¥";case"learning":return"ðŸ“š";case"elite":return"ðŸ‘‘";default:return"â­"}},S=s.filter(e=>{const t="all"===f||e.tier===f,r="all"===m||e.category===m;return t&&r}),E={total:s.length,unlocked:a.length,totalPoints:a.reduce((e,t)=>e+(t.points_earned||0),0),bronze:a.filter(e=>{const t=s.find(t=>t.id===e.achievement_id);return"bronze"===(null==t?void 0:t.tier)}).length,silver:a.filter(e=>{const t=s.find(t=>t.id===e.achievement_id);return"silver"===(null==t?void 0:t.tier)}).length,gold:a.filter(e=>{const t=s.find(t=>t.id===e.achievement_id);return"gold"===(null==t?void 0:t.tier)}).length,platinum:a.filter(e=>{const t=s.find(t=>t.id===e.achievement_id);return"platinum"===(null==t?void 0:t.tier)}).length};return d?e.jsx(_,{className:"glass-effect animate-pulse",children:e.jsx(j,{className:"p-6",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:[...Array(8)].map((t,r)=>e.jsx("div",{className:"h-40 bg-muted rounded-lg"},r))})})}):t?e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[e.jsxs("div",{className:"text-center p-3 rounded-lg bg-gradient-to-br from-amber-500/10 to-amber-600/10",children:[e.jsx("p",{className:"text-2xl font-bold text-amber-600",children:E.bronze}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bronze"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-gradient-to-br from-gray-400/10 to-gray-600/10",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-600",children:E.silver}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Silver"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-gradient-to-br from-yellow-400/10 to-yellow-600/10",children:[e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:E.gold}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Gold"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-gradient-to-br from-purple-400/10 to-purple-600/10",children:[e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:E.platinum}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Platinum"})]})]}):e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full",children:e.jsx(Be,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs(N,{className:"flex items-center gap-2",children:["Achievement Gallery",e.jsxs(g,{variant:"secondary",className:"ml-2",children:[E.unlocked,"/",E.total]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[E.totalPoints," total XP earned"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-semibold",children:[Math.round(E.unlocked/E.total*100),"% Complete"]}),e.jsx("div",{className:"w-24 h-2 bg-muted rounded-full overflow-hidden mt-1",children:e.jsx(gt.div,{className:"h-full bg-gradient-to-r from-yellow-400 to-orange-500",initial:{width:0},animate:{width:E.unlocked/E.total*100+"%"},transition:{duration:1,ease:"easeOut"}})})]})})]})}),e.jsxs(j,{children:[e.jsxs("div",{className:"mb-6 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(xt,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Tier:"}),["all","bronze","silver","gold","platinum"].map(t=>e.jsxs(o,{size:"sm",variant:f===t?"default":"outline",onClick:()=>p(t),className:"capitalize",children:["all"===t?"All":C(t)," ",t]},t))]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(Ve,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Category:"}),["all","streaks","goals","social","learning","elite"].map(t=>e.jsxs(o,{size:"sm",variant:m===t?"default":"outline",onClick:()=>x(t),className:"capitalize",children:["all"===t?"All":A(t)," ",t]},t))]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6",children:[e.jsxs("div",{className:"text-center p-4 rounded-lg bg-gradient-to-br from-amber-500/10 to-amber-600/10 border border-amber-200 dark:border-amber-800",children:[e.jsx("div",{className:"text-3xl mb-1",children:C("bronze")}),e.jsx("p",{className:"text-2xl font-bold text-amber-600",children:E.bronze}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bronze Badges"})]}),e.jsxs("div",{className:"text-center p-4 rounded-lg bg-gradient-to-br from-gray-400/10 to-gray-600/10 border border-gray-200 dark:border-gray-800",children:[e.jsx("div",{className:"text-3xl mb-1",children:C("silver")}),e.jsx("p",{className:"text-2xl font-bold text-gray-600",children:E.silver}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Silver Badges"})]}),e.jsxs("div",{className:"text-center p-4 rounded-lg bg-gradient-to-br from-yellow-400/10 to-yellow-600/10 border border-yellow-200 dark:border-yellow-800",children:[e.jsx("div",{className:"text-3xl mb-1",children:C("gold")}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:E.gold}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Gold Badges"})]}),e.jsxs("div",{className:"text-center p-4 rounded-lg bg-gradient-to-br from-purple-400/10 to-purple-600/10 border border-purple-200 dark:border-purple-800",children:[e.jsx("div",{className:"text-3xl mb-1",children:C("platinum")}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:E.platinum}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Platinum Badges"})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:S.map((t,r)=>{const n=(s=t.id,a.some(e=>e.achievement_id===s));var s;const i=(e=>{const t=a.find(t=>t.achievement_id===e);return t?new Date(t.unlocked_at).toLocaleDateString():null})(t.id);return e.jsx(gt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*r},whileHover:{scale:n?1.05:1},className:"relative",children:e.jsxs("div",{className:"relative overflow-hidden rounded-xl p-6 text-center "+(n?`bg-gradient-to-br ${w(t.tier)} text-white shadow-lg`:"bg-muted border-2 border-dashed border-muted-foreground/30"),children:[!n&&e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center",children:e.jsx(yt,{className:"w-8 h-8 text-white/80"})}),e.jsx("div",{className:`text-5xl mb-3 ${!n&&"opacity-30"}`,children:t.icon||C(t.tier)}),e.jsx("h3",{className:"font-bold mb-2 "+(n?"text-white":"text-muted-foreground"),children:t.name}),e.jsx("p",{className:"text-xs mb-3 line-clamp-2 "+(n?"text-white/90":"text-muted-foreground/70"),children:t.description}),e.jsxs("div",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold "+(n?"bg-white/20 text-white":"bg-muted-foreground/10 text-muted-foreground"),children:[e.jsx($,{className:"w-3 h-3"}),t.points_required," XP"]}),n&&i&&e.jsx("div",{className:"mt-3 pt-3 border-t border-white/20",children:e.jsxs("p",{className:"text-xs text-white/70",children:["Unlocked ",i]})}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs "+(n?"bg-white/20":"bg-muted-foreground/20"),children:C(t.tier)})}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs "+(n?"bg-white/20":"bg-muted-foreground/20"),children:A(t.category)})}),n&&e.jsx(gt.div,{className:"absolute top-1 right-1",animate:{opacity:[.5,1,.5],scale:[1,1.2,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.jsx(q,{className:"w-4 h-4 text-yellow-300"})})]})},t.id)})}),0===S.length&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ue,{className:"w-16 h-16 mx-auto text-muted-foreground/30 mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No achievements found with selected filters"}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{p("all"),x("all")},className:"mt-4",children:"Clear Filters"})]})]})]})},fc=()=>{const{userProfile:t}=l(),[n,s]=r.useState(null),[i,a]=r.useState(!0),o=(new Date).toISOString().split("T")[0];r.useEffect(()=>{(null==t?void 0:t.id)&&c()},[null==t?void 0:t.id]);const c=async()=>{try{const{data:e,error:r}=await u.from("daily_habits").select("*").eq("user_id",t.id).eq("habit_date",o).maybeSingle();if(r&&"PGRST116"!==r.code)return;if(e)s(e);else{const{data:e,error:r}=await u.from("daily_habits").insert({user_id:t.id,habit_date:o}).select().single();if(r)return;s(e)}a(!1)}catch(e){a(!1)}},d=[{key:"water_intake_completed",label:"Drink 8 glasses of water",icon:H,color:"text-blue-500"},{key:"steps_goal_completed",label:"10,000 steps",icon:xe,color:"text-green-500"},{key:"sleep_goal_completed",label:"8 hours of sleep",icon:z,color:"text-purple-500"},{key:"meal_logged",label:"Log all meals",icon:Z,color:"text-orange-500"},{key:"workout_completed",label:"Complete workout",icon:V,color:"text-red-500"},{key:"weight_logged",label:"Log weight",icon:U,color:"text-yellow-500"}],f=n?d.filter(e=>n[e.key]).length:0,p=n?Math.round(f/d.length*100):0;return i?e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-primary"}),"Daily Habits"]})}),e.jsx(j,{children:e.jsx("div",{className:"animate-pulse space-y-3",children:[...Array(6)].map((t,r)=>e.jsx("div",{className:"h-10 bg-muted rounded"},r))})})]}):e.jsxs(_,{className:"glass-effect",children:[e.jsxs(b,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-primary"}),"Daily Habits"]}),e.jsxs("div",{className:"text-sm font-semibold text-primary",children:[f,"/",d.length," completed"]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground mb-1",children:[e.jsx("span",{children:"Today's Progress"}),e.jsxs("span",{children:[p,"%"]})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx(gt.div,{className:"h-full bg-gradient-to-r from-primary to-primary/80",initial:{width:0},animate:{width:`${p}%`},transition:{duration:.5,ease:"easeOut"}})})]})]}),e.jsxs(j,{className:"space-y-2",children:[e.jsx(mt,{children:d.map((t,r)=>{const i=t.icon,a=(null==n?void 0:n[t.key])||!1;return e.jsxs(gt.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.05*r},className:"flex items-center gap-3 p-3 rounded-lg transition-all "+(a?"bg-primary/10 border border-primary/30":"bg-muted hover:bg-muted/80"),children:[e.jsx(Kt,{id:t.key,checked:a,onCheckedChange:()=>(async e=>{if(!n)return;const t=!n[e];s(r=>({...r,[e]:t}));try{const{error:r}=await u.from("daily_habits").update({[e]:t,updated_at:(new Date).toISOString()}).eq("id",n.id);r?(s(r=>({...r,[e]:!t})),h({title:"Error",description:"Failed to update habit",variant:"destructive"})):t&&h({title:"âœ… Habit completed!",description:"Keep up the great work!"})}catch(r){}})(t.key),className:"h-5 w-5"}),e.jsxs("label",{htmlFor:t.key,className:"flex items-center gap-2 flex-1 cursor-pointer",children:[e.jsx(i,{className:`w-4 h-4 ${t.color}`}),e.jsx("span",{className:"text-sm font-medium "+(a?"line-through text-muted-foreground":"text-text-primary"),children:t.label})]}),a&&e.jsx(gt.span,{initial:{scale:0},animate:{scale:1},className:"text-lg",children:"âœ…"})]},t.key)})}),f===d.length&&e.jsx(gt.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-4 p-4 bg-gradient-to-r from-green-500/20 to-emerald-500/20 rounded-lg border border-green-500/30",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-1",children:"ðŸŽ‰"}),e.jsx("div",{className:"font-semibold text-green-400",children:"Perfect Day!"}),e.jsx("div",{className:"text-xs text-green-300/80",children:"You've completed all your daily habits!"})]})})]})]})},pc=()=>{const{userProfile:t}=l(),[n,s]=r.useState([]),[i,a]=r.useState(!0),[f,p]=r.useState(!1),[m,g]=r.useState({goal_description:"",target_metric:"",target_value:""}),x=()=>{const e=new Date,t=e.getDay(),r=new Date(e);r.setDate(e.getDate()-t),r.setHours(0,0,0,0);const n=new Date(r);return n.setDate(r.getDate()+6),n.setHours(23,59,59,999),{start:r.toISOString().split("T")[0],end:n.toISOString().split("T")[0]}};r.useEffect(()=>{(null==t?void 0:t.id)&&y()},[null==t?void 0:t.id]);const y=async()=>{try{const{start:e,end:r}=x(),{data:n,error:i}=await u.from("weekly_goals").select("*").eq("user_id",t.id).eq("week_start_date",e).order("created_at",{ascending:!1});if(i)return;s(n||[]),a(!1)}catch(e){a(!1)}},v=n.filter(e=>e.completed).length,w=n.length;return i?e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5 text-primary"}),"Weekly Goals"]})}),e.jsx(j,{children:e.jsx("div",{className:"animate-pulse space-y-3",children:[...Array(3)].map((t,r)=>e.jsx("div",{className:"h-20 bg-muted rounded"},r))})})]}):e.jsxs(_,{className:"glass-effect",children:[e.jsxs(b,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5 text-primary"}),"Weekly Goals"]}),e.jsxs(A,{open:f,onOpenChange:p,children:[e.jsx(S,{asChild:!0,children:e.jsxs(o,{size:"sm",className:"gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Add Goal"]})}),e.jsxs(E,{children:[e.jsx(I,{children:e.jsx(T,{children:"Add New Weekly Goal"})}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"goal-description",children:"Goal Description *"}),e.jsx(d,{id:"goal-description",placeholder:"e.g., Lose 2 lbs this week",value:m.goal_description,onChange:e=>g(t=>({...t,goal_description:e.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"target-metric",children:"Target Metric (Optional)"}),e.jsx(d,{id:"target-metric",placeholder:"e.g., Weight, Workouts, Steps",value:m.target_metric,onChange:e=>g(t=>({...t,target_metric:e.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"target-value",children:"Target Value (Optional)"}),e.jsx(d,{id:"target-value",type:"number",placeholder:"e.g., 5 (for 5 workouts)",value:m.target_value,onChange:e=>g(t=>({...t,target_value:e.target.value}))})]}),e.jsx(o,{onClick:async()=>{if(m.goal_description.trim())try{const{start:e,end:r}=x(),{data:n,error:i}=await u.from("weekly_goals").insert({user_id:t.id,week_start_date:e,week_end_date:r,goal_description:m.goal_description,target_metric:m.target_metric||null,target_value:m.target_value?parseFloat(m.target_value):null,current_value:0,completed:!1}).select().single();if(i)return void h({title:"Error",description:"Failed to add goal",variant:"destructive"});s(e=>[n,...e]),g({goal_description:"",target_metric:"",target_value:""}),p(!1),h({title:"ðŸŽ¯ Goal Added!",description:"Your weekly goal has been set"})}catch(e){}else h({title:"Error",description:"Please enter a goal description",variant:"destructive"})},className:"w-full",children:"Add Goal"})]})]})]})]}),w>0&&e.jsxs("div",{className:"text-sm text-muted-foreground mt-2",children:[v," of ",w," goals completed this week"]})]}),e.jsx(j,{className:"space-y-3",children:e.jsx(mt,{children:0===n.length?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Me,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No weekly goals set yet"}),e.jsx("p",{className:"text-xs mt-1",children:'Click "Add Goal" to get started!'})]}):n.map((t,r)=>{const n=(e=>e.target_value?Math.min(Math.round(e.current_value/e.target_value*100),100):0)(t);return e.jsx(gt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,x:-100},transition:{delay:.05*r},className:"p-4 rounded-lg border "+(t.completed?"bg-green-500/10 border-green-500/30":"bg-muted border-border"),children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold "+(t.completed?"line-through text-muted-foreground":""),children:t.goal_description}),t.completed&&e.jsx(de,{className:"w-4 h-4 text-green-500"})]}),t.target_metric&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Target: ",t.target_value," ",t.target_metric]}),t.target_value&&!t.completed&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progress"}),e.jsxs("span",{className:"font-semibold text-primary",children:[n,"%"]})]}),e.jsx("div",{className:"h-1.5 bg-muted-foreground/20 rounded-full overflow-hidden",children:e.jsx(gt.div,{className:"h-full bg-primary",initial:{width:0},animate:{width:`${n}%`},transition:{duration:.5}})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{size:"sm",variant:t.completed?"outline":"default",onClick:()=>(async e=>{const t=!e.completed;s(r=>r.map(r=>r.id===e.id?{...r,completed:t}:r));try{const{error:r}=await u.from("weekly_goals").update({completed:t,current_value:t?e.target_value:e.current_value,updated_at:(new Date).toISOString()}).eq("id",e.id);r?(s(r=>r.map(r=>r.id===e.id?{...r,completed:!t}:r)),h({title:"Error",description:"Failed to update goal",variant:"destructive"})):t&&h({title:"ðŸŽ‰ Goal Completed!",description:"Congratulations on achieving your goal!"})}catch(r){}})(t),children:t.completed?"Undo":"Complete"}),e.jsx(o,{size:"sm",variant:"ghost",onClick:()=>(async e=>{try{const{error:t}=await u.from("weekly_goals").delete().eq("id",e);if(t)return void h({title:"Error",description:"Failed to delete goal",variant:"destructive"});s(t=>t.filter(t=>t.id!==e)),h({title:"Goal Deleted",description:"Your goal has been removed"})}catch(t){}})(t.id),children:e.jsx(Le,{className:"w-4 h-4 text-red-500"})})]})]})},t.id)})})})]})},mc=()=>{const{userProfile:t}=l(),[n,s]=r.useState([]),[i,a]=r.useState(!0),[p,m]=r.useState(!1),[g,x]=r.useState(!1),[y,v]=r.useState({photo_url:"",photo_type:"front",weight_kg:"",body_fat_percentage:"",notes:""}),[w,C]=r.useState(null);r.useEffect(()=>{(null==t?void 0:t.id)&&D()},[null==t?void 0:t.id]);const D=async()=>{try{const{data:e,error:r}=await u.from("progress_photos").select("*").eq("user_id",t.id).order("taken_at",{ascending:!1});if(r)return;s(e||[]),a(!1)}catch(e){a(!1)}},O=(()=>{const e={};return n.forEach(t=>{const r=new Date(t.taken_at).toLocaleDateString();e[r]||(e[r]=[]),e[r].push(t)}),e})();return i?e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-primary"}),"Progress Photos"]})}),e.jsx(j,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[...Array(6)].map((t,r)=>e.jsx("div",{className:"aspect-square bg-muted rounded-lg animate-pulse"},r))})})]}):e.jsxs(_,{className:"glass-effect",children:[e.jsxs(b,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-primary"}),"Progress Photos"]}),e.jsxs(A,{open:p,onOpenChange:m,children:[e.jsx(S,{asChild:!0,children:e.jsxs(o,{className:"gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Upload Photo"]})}),e.jsxs(E,{className:"max-w-2xl",children:[e.jsx(I,{children:e.jsx(T,{children:"Add Progress Photo"})}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx("div",{className:"border-2 border-dashed border-border rounded-lg p-8 text-center",children:y.photo_url?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:y.photo_url,alt:"Preview",className:"max-h-64 mx-auto rounded-lg"}),e.jsx(o,{size:"sm",variant:"outline",onClick:()=>v(e=>({...e,photo_url:""})),className:"mt-2",children:"Change Photo"})]}):e.jsxs("div",{children:[e.jsx(le,{className:"w-12 h-12 mx-auto mb-3 text-muted-foreground"}),e.jsxs(c,{htmlFor:"photo-upload",className:"cursor-pointer",children:[e.jsx("div",{className:"text-sm font-medium mb-1",children:"Click to upload or drag and drop"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"PNG, JPG up to 5MB"})]}),e.jsx(d,{id:"photo-upload",type:"file",accept:"image/*",className:"hidden",onChange:async e=>{var r;const n=null==(r=e.target.files)?void 0:r[0];if(n)if(n.type.startsWith("image/"))if(n.size>5242880)h({title:"Error",description:"Image must be less than 5MB",variant:"destructive"});else{x(!0);try{const e=n.name.split(".").pop(),r=`progress-photos/${`${t.id}/${Date.now()}.${e}`}`,{data:s,error:i}=await u.storage.from("user-uploads").upload(r,n);if(i)return h({title:"Upload Failed",description:"Failed to upload image. Please try again.",variant:"destructive"}),void x(!1);const{data:{publicUrl:a}}=u.storage.from("user-uploads").getPublicUrl(r);v(e=>({...e,photo_url:a})),x(!1),h({title:"âœ… Image Uploaded",description:"Now fill in additional details"})}catch(s){x(!1),h({title:"Error",description:"Failed to upload image",variant:"destructive"})}}else h({title:"Error",description:"Please upload an image file",variant:"destructive"})},disabled:g}),g&&e.jsx("div",{className:"mt-2 text-sm text-primary",children:"Uploading..."})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"photo-type",children:"Photo Type"}),e.jsxs(At,{value:y.photo_type,onValueChange:e=>v(t=>({...t,photo_type:e})),children:[e.jsx(St,{id:"photo-type",children:e.jsx(Et,{})}),e.jsxs(It,{children:[e.jsx(Tt,{value:"front",children:"Front"}),e.jsx(Tt,{value:"back",children:"Back"}),e.jsx(Tt,{value:"side",children:"Side"}),e.jsx(Tt,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"weight",children:"Weight (kg)"}),e.jsx(d,{id:"weight",type:"number",step:"0.1",placeholder:"e.g., 75.5",value:y.weight_kg,onChange:e=>v(t=>({...t,weight_kg:e.target.value}))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"body-fat",children:"Body Fat % (Optional)"}),e.jsx(d,{id:"body-fat",type:"number",step:"0.1",placeholder:"e.g., 18.5",value:y.body_fat_percentage,onChange:e=>v(t=>({...t,body_fat_percentage:e.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"notes",children:"Notes (Optional)"}),e.jsx(f,{id:"notes",placeholder:"How are you feeling? Any milestones?",value:y.notes,onChange:e=>v(t=>({...t,notes:e.target.value}))})]}),e.jsx(o,{onClick:async()=>{if(y.photo_url)try{const{data:e,error:r}=await u.from("progress_photos").insert({user_id:t.id,photo_url:y.photo_url,photo_type:y.photo_type,weight_kg:y.weight_kg?parseFloat(y.weight_kg):null,body_fat_percentage:y.body_fat_percentage?parseFloat(y.body_fat_percentage):null,notes:y.notes||null,taken_at:(new Date).toISOString()}).select().single();if(r)return void h({title:"Error",description:"Failed to save progress photo",variant:"destructive"});s(t=>[e,...t]),v({photo_url:"",photo_type:"front",weight_kg:"",body_fat_percentage:"",notes:""}),m(!1),h({title:"ðŸ“¸ Progress Photo Saved!",description:"Your progress has been documented"})}catch(e){}else h({title:"Error",description:"Please upload a photo first",variant:"destructive"})},disabled:!y.photo_url||g,className:"w-full",children:"Save Progress Photo"})]})]})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-2",children:[n.length," photo",1!==n.length?"s":""," in your gallery"]})]}),e.jsx(j,{children:0===n.length?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(vt,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-sm mb-2",children:"No progress photos yet"}),e.jsx("p",{className:"text-xs",children:"Start documenting your journey by uploading your first photo!"})]}):e.jsx("div",{className:"space-y-6",children:e.jsx(mt,{children:Object.entries(O).map(([t,r])=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ie,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("h3",{className:"font-semibold text-sm",children:t})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:r.map((t,r)=>e.jsxs(gt.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{delay:.05*r},className:"relative group cursor-pointer",onClick:()=>C(t),children:[e.jsx("div",{className:"aspect-square rounded-lg overflow-hidden bg-muted",children:e.jsx("img",{src:t.photo_url,alt:`Progress photo - ${t.photo_type}`,className:"w-full h-full object-cover transition-transform group-hover:scale-110"})}),e.jsxs("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex flex-col items-center justify-center text-white text-xs p-2",children:[e.jsx("div",{className:"font-semibold capitalize mb-1",children:t.photo_type}),t.weight_kg&&e.jsxs("div",{className:"mb-1",children:[t.weight_kg," kg"]}),t.body_fat_percentage&&e.jsxs("div",{children:[t.body_fat_percentage,"% BF"]})]}),e.jsx(o,{size:"sm",variant:"destructive",className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",onClick:e=>{e.stopPropagation(),(async(e,t)=>{try{const{error:n}=await u.from("progress_photos").delete().eq("id",e);if(n)return void h({title:"Error",description:"Failed to delete photo",variant:"destructive"});try{const e=t.split("/user-uploads/");if(e.length>1){const t=e[1];await u.storage.from("user-uploads").remove([t])}}catch(r){}s(t=>t.filter(t=>t.id!==e)),h({title:"Photo Deleted",description:"Progress photo has been removed"})}catch(n){}})(t.id,t.photo_url)},children:e.jsx(Le,{className:"w-3 h-3"})})]},t.id))})]},t))})})}),w&&e.jsx(A,{open:!!w,onOpenChange:()=>C(null),children:e.jsxs(E,{className:"max-w-4xl",children:[e.jsx(I,{children:e.jsxs(T,{className:"capitalize",children:[w.photo_type," - ",new Date(w.taken_at).toLocaleDateString()]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("img",{src:w.photo_url,alt:"Progress photo",className:"w-full rounded-lg"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[w.weight_kg&&e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Weight"}),e.jsxs("div",{className:"font-semibold",children:[w.weight_kg," kg"]})]}),w.body_fat_percentage&&e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Body Fat"}),e.jsxs("div",{className:"font-semibold",children:[w.body_fat_percentage,"%"]})]})]}),w.notes&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground mb-1",children:"Notes"}),e.jsx("p",{className:"text-sm",children:w.notes})]})]})]})})]})},gc=()=>{const{userProfile:t}=l(),[n,s]=r.useState(null),[i,a]=r.useState(!0),[c,d]=r.useState(!1);r.useEffect(()=>{(null==t?void 0:t.id)&&h()},[null==t?void 0:t.id]);const h=async()=>{a(!0);try{const{data:e,error:r}=await u.from("ai_meal_plans").select("*").eq("user_id",t.id).order("created_at",{ascending:!1}).limit(1).single();if(r&&"PGRST116"!==r.code)throw r;s(e)}catch(e){}finally{a(!1)}};if(i)return e.jsx(_,{className:"glass-effect",children:e.jsx(j,{className:"p-6 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});if(!n)return e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(wt,{className:"w-5 h-5"}),"My Meal Plan"]})}),e.jsxs(j,{className:"text-center py-8",children:[e.jsx(wt,{className:"w-12 h-12 mx-auto text-muted-foreground opacity-50 mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"No meal plan assigned yet"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Your nutritionist will assign a personalized meal plan for you"})]})]});const f=(new Date).toLocaleDateString("en-US",{weekday:"long"}).toLowerCase(),p=n.daily_meals||{},m=p[f]||p.day1||{};return e.jsxs(e.Fragment,{children:[e.jsx(gt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs(_,{className:"glass-effect hover:shadow-lg transition-all",children:[e.jsx(b,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(wt,{className:"w-5 h-5"}),"My Meal Plan"]}),e.jsx(g,{children:n.tier_name||"Custom"})]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:n.plan_name}),n.plan_description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:n.plan_description})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Calories"}),e.jsx("p",{className:"font-semibold text-sm",children:n.target_calories||0})]}),e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Protein"}),e.jsxs("p",{className:"font-semibold text-sm",children:[n.target_protein_g||0,"g"]})]}),e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Carbs"}),e.jsxs("p",{className:"font-semibold text-sm",children:[n.target_carbs_g||0,"g"]})]}),e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Fat"}),e.jsxs("p",{className:"font-semibold text-sm",children:[n.target_fat_g||0,"g"]})]})]}),Object.keys(m).length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ie,{className:"w-4 h-4"}),"Today's Meals"]}),e.jsxs("div",{className:"space-y-1",children:[m.breakfast&&e.jsxs("div",{className:"flex justify-between text-sm p-2 bg-muted/30 rounded",children:[e.jsx("span",{className:"text-muted-foreground",children:"Breakfast:"}),e.jsx("span",{className:"font-medium",children:m.breakfast.name})]}),m.lunch&&e.jsxs("div",{className:"flex justify-between text-sm p-2 bg-muted/30 rounded",children:[e.jsx("span",{className:"text-muted-foreground",children:"Lunch:"}),e.jsx("span",{className:"font-medium",children:m.lunch.name})]}),m.dinner&&e.jsxs("div",{className:"flex justify-between text-sm p-2 bg-muted/30 rounded",children:[e.jsx("span",{className:"text-muted-foreground",children:"Dinner:"}),e.jsx("span",{className:"font-medium",children:m.dinner.name})]})]})]}),e.jsxs(o,{className:"w-full",variant:"outline",onClick:()=>d(!0),children:[e.jsx(_t,{className:"w-4 h-4 mr-2"}),"View Full ",n.duration_days||7,"-Day Plan"]})]})]})}),e.jsx(A,{open:c,onOpenChange:d,children:e.jsxs(E,{className:"glass-effect max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(I,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(wt,{className:"w-5 h-5"}),n.plan_name]})}),e.jsxs(Dt,{defaultValue:"day1",className:"w-full",children:[e.jsx(Ot,{className:"grid w-full grid-cols-7",children:Array.from({length:n.duration_days||7},(t,r)=>e.jsxs(Rt,{value:`day${r+1}`,children:["Day ",r+1]},`day${r+1}`))}),Array.from({length:n.duration_days||7},(t,r)=>{const n=`day${r+1}`,s=p[n]||{};return e.jsx(kt,{value:n,className:"space-y-4",children:0===Object.keys(s).length?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No meals planned for this day"}):e.jsxs("div",{className:"space-y-3",children:[s.breakfast&&e.jsxs(_,{children:[e.jsx(b,{className:"pb-3",children:e.jsx(N,{className:"text-sm",children:"Breakfast"})}),e.jsxs(j,{children:[e.jsx("p",{className:"font-medium mb-2",children:s.breakfast.name}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Calories:"}),e.jsx("span",{className:"font-medium ml-1",children:s.breakfast.calories})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Protein:"}),e.jsxs("span",{className:"font-medium ml-1",children:[s.breakfast.protein,"g"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Carbs:"}),e.jsxs("span",{className:"font-medium ml-1",children:[s.breakfast.carbs,"g"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Fat:"}),e.jsxs("span",{className:"font-medium ml-1",children:[s.breakfast.fat,"g"]})]})]})]})]}),s.lunch&&e.jsxs(_,{children:[e.jsx(b,{className:"pb-3",children:e.jsx(N,{className:"text-sm",children:"Lunch"})}),e.jsxs(j,{children:[e.jsx("p",{className:"font-medium mb-2",children:s.lunch.name}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Calories:"}),e.jsx("span",{className:"font-medium ml-1",children:s.lunch.calories})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Protein:"}),e.jsxs("span",{className:"font-medium ml-1",children:[s.lunch.protein,"g"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Carbs:"}),e.jsxs("span",{className:"font-medium ml-1",children:[s.lunch.carbs,"g"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Fat:"}),e.jsxs("span",{className:"font-medium ml-1",children:[s.lunch.fat,"g"]})]})]})]})]}),s.dinner&&e.jsxs(_,{children:[e.jsx(b,{className:"pb-3",children:e.jsx(N,{className:"text-sm",children:"Dinner"})}),e.jsxs(j,{children:[e.jsx("p",{className:"font-medium mb-2",children:s.dinner.name}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Calories:"}),e.jsx("span",{className:"font-medium ml-1",children:s.dinner.calories})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Protein:"}),e.jsxs("span",{className:"font-medium ml-1",children:[s.dinner.protein,"g"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Carbs:"}),e.jsxs("span",{className:"font-medium ml-1",children:[s.dinner.carbs,"g"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Fat:"}),e.jsxs("span",{className:"font-medium ml-1",children:[s.dinner.fat,"g"]})]})]})]})]}),s.snack1&&e.jsxs(_,{children:[e.jsx(b,{className:"pb-3",children:e.jsx(N,{className:"text-sm",children:"Snack 1"})}),e.jsxs(j,{children:[e.jsx("p",{className:"font-medium mb-2",children:s.snack1.name}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Calories:"}),e.jsx("span",{className:"font-medium ml-1",children:s.snack1.calories})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Protein:"}),e.jsxs("span",{className:"font-medium ml-1",children:[s.snack1.protein,"g"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Carbs:"}),e.jsxs("span",{className:"font-medium ml-1",children:[s.snack1.carbs,"g"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Fat:"}),e.jsxs("span",{className:"font-medium ml-1",children:[s.snack1.fat,"g"]})]})]})]})]}),s.snack2&&e.jsxs(_,{children:[e.jsx(b,{className:"pb-3",children:e.jsx(N,{className:"text-sm",children:"Snack 2"})}),e.jsxs(j,{children:[e.jsx("p",{className:"font-medium mb-2",children:s.snack2.name}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Calories:"}),e.jsx("span",{className:"font-medium ml-1",children:s.snack2.calories})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Protein:"}),e.jsxs("span",{className:"font-medium ml-1",children:[s.snack2.protein,"g"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Carbs:"}),e.jsxs("span",{className:"font-medium ml-1",children:[s.snack2.carbs,"g"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Fat:"}),e.jsxs("span",{className:"font-medium ml-1",children:[s.snack2.fat,"g"]})]})]})]})]})]})},n)})]})]})})]})},xc=()=>{const{userProfile:t}=l(),[n,s]=r.useState(null),[i,a]=r.useState(!0);r.useEffect(()=>{(null==t?void 0:t.id)&&c()},[null==t?void 0:t.id]);const c=async()=>{try{const{data:e,error:r}=await u.from("dna_analysis").select("*").eq("user_id",t.id).maybeSingle();if(r&&"PGRST116"!==r.code)return;s(e),a(!1)}catch(e){a(!1)}},d=()=>{h({title:"Coming Soon!",description:"DNA upload integration with 23andMe, AncestryDNA, and MyHeritage is coming soon."})};return i?e.jsxs(_,{className:"glass-effect border-purple-500/30",children:[e.jsx(b,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(bt,{className:"w-5 h-5 text-purple-500"}),"DNA-Based Nutrition Analysis"]})}),e.jsx(j,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-20 bg-muted rounded"}),e.jsx("div",{className:"h-32 bg-muted rounded"})]})})]}):e.jsxs(_,{className:"glass-effect border-purple-500/30",children:[e.jsxs(b,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(bt,{className:"w-5 h-5 text-purple-500"}),"DNA-Based Nutrition Analysis"]}),e.jsx(g,{variant:"outline",className:"bg-purple-500/20 text-purple-400 border-purple-500/50",children:"Elite Feature"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Get personalized nutrition recommendations based on your genetic profile"})]}),e.jsx(j,{className:"space-y-6",children:n?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-green-500/10 rounded-lg border border-green-500/30",children:[e.jsx(de,{className:"w-5 h-5 text-green-500 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-green-400",children:"Analysis Complete"}),e.jsxs("div",{className:"text-xs text-green-300/80",children:["Uploaded ",new Date(n.upload_date).toLocaleDateString()," â€¢ Provider: ",n.test_provider]})]}),e.jsxs(o,{size:"sm",variant:"outline",onClick:d,children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Re-upload"]})]}),n.metabolism_type&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4 text-yellow-500"}),"Metabolism Type"]}),e.jsx(_,{children:e.jsxs(j,{className:"p-4",children:[e.jsx("div",{className:"text-lg font-semibold capitalize mb-1",children:n.metabolism_type}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Your body processes nutrients at a ",n.metabolism_type," rate"]})]})})]}),n.optimal_macros&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-blue-500"}),"Optimal Macro Distribution"]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:Object.entries(n.optimal_macros).map(([t,r])=>e.jsx(_,{children:e.jsxs(j,{className:"p-3 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-primary mb-1",children:[r,"%"]}),e.jsx("div",{className:"text-xs text-muted-foreground capitalize",children:t})]})},t))})]}),n.food_sensitivities&&n.food_sensitivities.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-orange-500"}),"Genetic Food Sensitivities"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n.food_sensitivities.map((t,r)=>e.jsx(g,{variant:"outline",className:"bg-orange-500/10 text-orange-400 border-orange-500/30",children:t},r))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Consider limiting or avoiding these foods based on your genetic markers"})]}),n.vitamin_recommendations&&Object.keys(n.vitamin_recommendations).length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(Nt,{className:"w-4 h-4 text-green-500"}),"Personalized Vitamin Needs"]}),e.jsx("div",{className:"space-y-2",children:Object.entries(n.vitamin_recommendations).map(([t,r])=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t}),e.jsx("div",{className:"text-xs text-muted-foreground",children:r.reason||"Genetically indicated"})]}),e.jsx(g,{variant:"outline",children:r.dosage||"Recommended"})]},t))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{variant:"outline",className:"flex-1 gap-2",children:[e.jsx(Je,{className:"w-4 h-4"}),"Download Full Report"]}),e.jsxs(o,{variant:"outline",className:"flex-1 gap-2",children:[e.jsx(bt,{className:"w-4 h-4"}),"View Detailed Analysis"]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground p-3 bg-muted rounded-lg",children:[e.jsx(Q,{className:"w-3 h-3 inline mr-1"}),"This analysis is for informational purposes only. Always consult with a healthcare professional before making significant dietary changes."]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(gt.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"w-20 h-20 mx-auto mb-4 rounded-full bg-purple-500/20 flex items-center justify-center",children:e.jsx(bt,{className:"w-10 h-10 text-purple-500"})}),e.jsx("h3",{className:"font-semibold mb-2",children:"No DNA Analysis Yet"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Upload your DNA data from 23andMe, AncestryDNA, or MyHeritage to get started"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{onClick:d,className:"gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Upload DNA Data"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Your data is encrypted and never shared"})]})]})})]})},yc=()=>{const{userProfile:t}=l(),[n,s]=r.useState([]),[i,a]=r.useState([]),[c,h]=r.useState(!0),[f,p]=r.useState(null),[m,x]=r.useState(""),[y,v]=r.useState("all");r.useEffect(()=>{w()},[]),r.useEffect(()=>{C()},[m,y,n]);const w=async()=>{try{const{data:e,error:t}=await u.from("masterclass_videos").select("*").order("published_at",{ascending:!1});if(t)return;s(e||[]),a(e||[]),h(!1)}catch(e){h(!1)}},C=()=>{let e=n;m.trim()&&(e=e.filter(e=>{var t,r;return e.title.toLowerCase().includes(m.toLowerCase())||(null==(t=e.description)?void 0:t.toLowerCase().includes(m.toLowerCase()))||(null==(r=e.instructor_name)?void 0:r.toLowerCase().includes(m.toLowerCase()))})),"all"!==y&&(e=e.filter(e=>e.category===y)),a(e)};return c?e.jsxs(_,{className:"glass-effect border-purple-500/30",children:[e.jsx(b,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-purple-500"}),"Masterclass Videos"]})}),e.jsx(j,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[...Array(4)].map((t,r)=>e.jsx("div",{className:"aspect-video bg-muted rounded-lg animate-pulse"},r))})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(_,{className:"glass-effect border-purple-500/30",children:[e.jsxs(b,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-purple-500"}),"Masterclass Videos"]}),e.jsx(g,{variant:"outline",className:"bg-purple-500/20 text-purple-400 border-purple-500/50",children:"Elite Exclusive"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Learn from world-class experts in nutrition, fitness, and wellness"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(d,{placeholder:"Search videos...",value:m,onChange:e=>x(e.target.value),className:"pl-10"})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto",children:["all","nutrition","cooking","mindset","fitness","lifestyle"].map(t=>e.jsx(o,{size:"sm",variant:y===t?"default":"outline",onClick:()=>v(t),className:"capitalize whitespace-nowrap",children:t},t))})]})]}),e.jsx(j,{children:0===i.length?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(ve,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No videos found"}),e.jsx("p",{className:"text-xs mt-1",children:"Try adjusting your search or filters"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.jsx(mt,{children:i.map((r,n)=>e.jsxs(gt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:.05*n},className:"group cursor-pointer",onClick:()=>(async e=>{if(p(e),null==t?void 0:t.id)try{await u.from("masterclass_videos").update({view_count:(e.view_count||0)+1}).eq("id",e.id);const{data:r}=await u.from("user_video_progress").select("*").eq("user_id",t.id).eq("video_id",e.id).maybeSingle();r||await u.from("user_video_progress").insert({user_id:t.id,video_id:e.id,progress_seconds:0,completed:!1})}catch(r){}})(r),children:[e.jsxs("div",{className:"relative aspect-video rounded-lg overflow-hidden bg-muted mb-3",children:[r.thumbnail_url?e.jsx("img",{src:r.thumbnail_url,alt:r.title,className:"w-full h-full object-cover transition-transform group-hover:scale-110"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-purple-500/20 to-pink-500/20",children:e.jsx(P,{className:"w-16 h-16 text-purple-500/50"})}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsx("div",{className:"w-16 h-16 rounded-full bg-white/90 flex items-center justify-center",children:e.jsx(P,{className:"w-8 h-8 text-black ml-1"})})}),r.duration_minutes&&e.jsxs("div",{className:"absolute bottom-2 right-2 bg-black/80 text-white text-xs px-2 py-1 rounded",children:[r.duration_minutes," min"]})]}),e.jsx("h3",{className:"font-semibold mb-1 group-hover:text-primary transition-colors",children:r.title}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 mb-2",children:r.description}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ht,{className:"w-3 h-3"}),r.instructor_name]}),e.jsxs("div",{className:"flex items-center gap-3",children:[r.view_count>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"w-3 h-3"}),r.view_count," views"]}),r.category&&e.jsx(g,{variant:"outline",className:"text-xs capitalize",children:r.category})]})]})]},r.id))})})})]}),f&&e.jsx(A,{open:!!f,onOpenChange:()=>p(null),children:e.jsxs(E,{className:"max-w-5xl",children:[e.jsx(I,{children:e.jsx(T,{children:f.title})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"aspect-video bg-black rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx(P,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-sm opacity-80",children:"Video player integration coming soon"}),e.jsx("p",{className:"text-xs opacity-60 mt-1",children:"Will support YouTube, Vimeo, and direct video uploads"})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold mb-1",children:f.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:f.description})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(O,{className:"w-4 h-4"}),f.duration_minutes," min"]})]}),f.instructor_name&&e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center",children:e.jsx(Ue,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:f.instructor_name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Instructor"})]})]}),f.instructor_bio&&e.jsx("p",{className:"text-sm text-muted-foreground",children:f.instructor_bio})]})]})]})]})})]})},vc=r.memo(({logoUrl:t,previewMode:n=!1})=>{const i=l(),a=s.useContext(Vl),c=n&&a?a:i,{userProfile:d}=c,{t:f}=v(),p=y(),m=s.useContext(Hl),g=n&&m?m:p,{hasAds:x,planName:C,hasAccess:A,planKey:S}=g,[E,I]=r.useState(null),[T,D]=r.useState([]),[O,R]=r.useState([]),[k,P]=r.useState(!0),[B,F]=r.useState(0),[L,G]=r.useState(!0),[W,X]=r.useState(!1),[Y,q]=r.useState(!1),[K,Q]=r.useState(0);r.useEffect(()=>{if(n){const e=(e=>{const t=(new Date).toISOString().split("T")[0];return{todayMetrics:{id:"preview-metrics-1",user_id:"preview-user-id",date:t,calories:1450,protein_g:95,carbs_g:150,fat_g:45,fiber_g:28,water_ml:1800,steps:8500,exercise_minutes:45,sleep_hours:7.5,weight_kg:75,created_at:(new Date).toISOString()},recentActivity:[{id:"activity-1",user_id:"preview-user-id",activity_type:"meal_logged",description:"Logged breakfast: Oatmeal with berries",created_at:new Date(Date.now()-72e5).toISOString()},{id:"activity-2",user_id:"preview-user-id",activity_type:"workout_completed",description:"Completed 30-min cardio workout",created_at:new Date(Date.now()-18e6).toISOString()},{id:"activity-3",user_id:"preview-user-id",activity_type:"weight_logged",description:"Updated weight: 75 kg",created_at:new Date(Date.now()-864e5).toISOString()},{id:"activity-4",user_id:"preview-user-id",activity_type:"meal_logged",description:"Logged lunch: Grilled chicken salad",created_at:new Date(Date.now()-936e5).toISOString()},{id:"activity-5",user_id:"preview-user-id",activity_type:"goal_achieved",description:"Achieved daily water goal!",created_at:new Date(Date.now()-1728e5).toISOString()}],streaks:[{id:"streak-1",user_id:"preview-user-id",streak_type:"daily_logging",current_count:12,best_count:18,last_activity_date:t},{id:"streak-2",user_id:"preview-user-id",streak_type:"workout",current_count:5,best_count:14,last_activity_date:t},{id:"streak-3",user_id:"preview-user-id",streak_type:"water_goal",current_count:7,best_count:21,last_activity_date:t}],mealPlans:"free"===e?[]:[{id:"meal-plan-1",user_id:"preview-user-id",name:"Mediterranean Diet Plan",description:"Healthy, balanced meals inspired by Mediterranean cuisine",created_at:new Date(Date.now()-6048e5).toISOString(),meals:[{name:"Greek Yogurt Parfait",type:"breakfast",calories:320,protein_g:18},{name:"Mediterranean Quinoa Bowl",type:"lunch",calories:450,protein_g:22},{name:"Grilled Salmon with Vegetables",type:"dinner",calories:520,protein_g:38}]}],workoutPlans:"free"===e?[]:[{id:"workout-plan-1",user_id:"preview-user-id",name:"Full Body Strength Training",description:"3-day per week full body workout routine",created_at:new Date(Date.now()-12096e5).toISOString(),workouts:[{name:"Day 1: Upper Body",exercises:["Push-ups","Dumbbell Rows","Shoulder Press"],duration_minutes:45},{name:"Day 2: Lower Body",exercises:["Squats","Lunges","Calf Raises"],duration_minutes:50},{name:"Day 3: Core & Cardio",exercises:["Planks","Mountain Climbers","Burpees"],duration_minutes:40}]}],progressData:{weightHistory:zl(),calorieHistory:Xl(),workoutHistory:Yl()},aiMessagesRemaining:{free:3,premium:50,ultimate:200,elite:999}[e]||3}})((null==d?void 0:d.subscription_tier)||"free");I(e.todayMetrics),D(e.recentActivity),R(e.streaks),P(!1)}else(null==d?void 0:d.id)&&J()},[null==d?void 0:d.id,B,n]);const J=async()=>{if(!n)try{const e=(new Date).toISOString().split("T")[0],{data:t,error:r}=await u.from("daily_metrics").select("*").eq("user_id",d.id).eq("date",e).maybeSingle();r&&r.code,I(t);const{data:n}=await u.from("activity_feed").select("*").eq("user_id",d.id).order("created_at",{ascending:!1}).limit(5);D(n||[]);const{data:s}=await u.from("user_streaks").select("*").eq("user_id",d.id);R(s||[]),P(!1)}catch(e){P(!1)}},ee=()=>{n?h({title:"Preview Mode",description:"Data refresh is disabled in preview mode"}):F(e=>e+1)},te=t=>{switch(t){case"lose_weight":return e.jsx(U,{className:"w-6 h-6 text-primary"});case"build_muscle":return e.jsx(V,{className:"w-6 h-6 text-primary"});case"improve_endurance":return e.jsx(jt,{className:"w-6 h-6 text-primary"});case"eat_healthier":return e.jsx(Fe,{className:"w-6 h-6 text-primary"});case"increase_energy":return e.jsx($,{className:"w-6 h-6 text-primary"});default:return e.jsx(Me,{className:"w-6 h-6 text-primary"})}},{bmi:re,category:ne}=r.useMemo(()=>((e,t)=>{if(!e||!t)return{bmi:"N/A",category:"N/A"};const r=t/100,n=(e/(r*r)).toFixed(1);let s="";return s=n<18.5?"Underweight":n>=18.5&&n<=24.9?"Normal":n>=25&&n<=29.9?"Overweight":"Obese",{bmi:n,category:s}})(null==d?void 0:d.weight_kg,null==d?void 0:d.height_cm),[null==d?void 0:d.weight_kg,null==d?void 0:d.height_cm]),se=r.useMemo(()=>({hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}}),[]),ie=r.useMemo(()=>({hidden:{y:20,opacity:0},visible:{y:0,opacity:1}}),[]);return e.jsxs(e.Fragment,{children:[e.jsxs(w,{children:[e.jsx("title",{children:"Dashboard - GreenoFig"}),e.jsx("meta",{name:"description",content:"Your personal health and wellness dashboard."})]}),e.jsxs(gt.div,{variants:se,initial:"hidden",animate:"visible",className:"w-full space-y-6 sm:space-y-8 lg:space-y-10 xl:space-y-12 px-4 sm:px-0",children:[e.jsxs(gt.div,{variants:ie,children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl xl:text-6xl font-bold leading-tight",children:["Welcome back, ",e.jsxs("span",{className:"gradient-text",children:[((null==d?void 0:d.full_name)||"User").split(" ")[0],"!"]})]}),e.jsxs("p",{className:"text-sm sm:text-base lg:text-lg xl:text-xl text-text-secondary mt-2",children:["Here's your wellness snapshot for today. Let's make it a great one!",C&&e.jsxs("span",{className:"ml-2 text-xs font-semibold text-primary",children:["(",C," Plan)"]}),K>0&&e.jsxs("span",{className:"ml-2 text-xs font-semibold text-green-500",children:["ðŸŽ +",K," bonus AI message",K>1?"s":""]})]})]}),x&&L&&e.jsx(gt.div,{variants:ie,children:e.jsx(cr,{onDismiss:()=>G(!1)})}),x&&e.jsx(gt.div,{variants:ie,children:e.jsx(_,{className:"glass-effect border-yellow-500/30 bg-gradient-to-r from-yellow-500/10 to-orange-500/10",children:e.jsx(j,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(M,{className:"w-8 h-8 text-yellow-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white text-sm sm:text-base",children:"Earn Bonus Features!"}),e.jsx("p",{className:"text-xs sm:text-sm text-yellow-200/80",children:"Watch a short video to get +1 extra AI message"})]})]}),e.jsx(o,{onClick:()=>X(!0),className:"bg-yellow-500 hover:bg-yellow-600 text-black font-semibold",children:"Watch Ad"})]})})})}),e.jsxs(gt.div,{variants:se,className:"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8",children:[e.jsx(gt.div,{variants:ie,className:"lg:col-span-2",children:e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{className:"p-4 sm:p-6 lg:p-8",children:e.jsx(N,{className:"text-lg sm:text-xl lg:text-2xl xl:text-3xl font-bold",children:"Quick Actions"})}),e.jsxs(j,{className:"grid grid-cols-2 md:grid-cols-4 gap-2 sm:gap-3 lg:gap-4 p-4 sm:p-6 lg:p-8 pt-0",children:[e.jsx(Qt,{onSuccess:ee}),e.jsx(Ct,{onSuccess:ee}),e.jsx(Jt,{onSuccess:ee}),e.jsx(tr,{onSuccess:ee})]})]})}),e.jsx(gt.div,{variants:ie,children:e.jsx(er,{onSuccess:ee})})]}),e.jsxs(gt.div,{variants:se,className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 lg:gap-8",children:[e.jsx(gt.div,{variants:ie,children:e.jsxs(_,{className:"glass-effect h-full",children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2 p-4 sm:p-6 lg:p-8 lg:pb-4",children:[e.jsx(N,{className:"text-xs sm:text-sm lg:text-base xl:text-lg font-medium",children:"Weight"}),e.jsx(U,{className:"h-4 w-4 sm:h-5 sm:w-5 lg:h-6 lg:w-6 text-muted-foreground"})]}),e.jsxs(j,{className:"p-4 sm:p-6 lg:p-8 pt-0 lg:pt-0",children:[e.jsxs("div",{className:"text-xl sm:text-2xl lg:text-3xl xl:text-4xl font-bold",children:[(null==E?void 0:E.weight_kg)||(null==d?void 0:d.weight_kg)||"N/A",((null==E?void 0:E.weight_kg)||(null==d?void 0:d.weight_kg))&&" kg"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:(null==E?void 0:E.weight_kg)?"Today's weight":"Last logged weight"})]})]})}),e.jsx(gt.div,{variants:ie,children:e.jsxs(_,{className:"glass-effect h-full",children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2 p-4 sm:p-6",children:[e.jsx(N,{className:"text-xs sm:text-sm font-medium",children:"BMI"}),e.jsx(jt,{className:"h-4 w-4 sm:h-5 sm:w-5 text-muted-foreground"})]}),e.jsxs(j,{className:"p-4 sm:p-6 pt-0",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold",children:re}),e.jsx("p",{className:"text-xs text-muted-foreground",children:ne})]})]})}),e.jsx(gt.div,{variants:ie,children:e.jsxs(_,{className:"glass-effect h-full",children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2 p-4 sm:p-6",children:[e.jsx(N,{className:"text-xs sm:text-sm font-medium",children:"Calories Today"}),e.jsx(_e,{className:"h-4 w-4 sm:h-5 sm:w-5 text-muted-foreground"})]}),e.jsxs(j,{className:"p-4 sm:p-6 pt-0",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold",children:(null==E?void 0:E.calories_burned)||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Burned â€¢ ",(null==E?void 0:E.calories_consumed)||0," consumed"]})]})]})}),e.jsx(gt.div,{variants:ie,children:e.jsxs(_,{className:"glass-effect h-full",children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2 p-4 sm:p-6",children:[e.jsx(N,{className:"text-xs sm:text-sm font-medium",children:"Sleep"}),e.jsx(z,{className:"h-4 w-4 sm:h-5 sm:w-5 text-muted-foreground"})]}),e.jsxs(j,{className:"p-4 sm:p-6 pt-0",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold",children:(null==E?void 0:E.sleep_hours)?`${E.sleep_hours}h`:"Not logged"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:(null==E?void 0:E.sleep_quality)||"Log your sleep"})]})]})})]}),(A("photoRecognition")||A("wearableIntegration")||"free"!==S)&&e.jsx(gt.div,{variants:ie,children:e.jsxs(_,{className:"glass-effect border-primary/30",children:[e.jsxs(b,{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(N,{className:"text-lg sm:text-xl font-bold flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5 text-yellow-500"}),f("userDashboard.premiumFeatures")]}),"free"===S&&e.jsx(o,{size:"sm",onClick:()=>window.location.href="/pricing",children:f("userDashboard.upgradeButton")})]}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:f("free"===S?"userDashboard.unlockPowerfulTools":"userDashboard.advancedToolsAvailable")})]}),e.jsxs(j,{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4 sm:p-6 pt-0",children:[A("photoRecognition")&&e.jsxs(o,{variant:"outline",className:"h-24 flex flex-col gap-2 relative overflow-hidden group",onClick:()=>{var e;return null==(e=document.getElementById("photo-food-recognition"))?void 0:e.scrollIntoView({behavior:"smooth"})},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-500/10 to-pink-500/10 opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsx(le,{className:"h-6 w-6 text-purple-500"}),e.jsx("span",{className:"text-sm font-medium",children:f("userDashboard.photoFoodRecognition")}),e.jsx("span",{className:"text-xs text-text-secondary",children:f("userDashboard.photoFoodRecognitionTier")})]}),(A("photoRecognition")||"free"!==S)&&e.jsxs(o,{variant:"outline",className:"h-24 flex flex-col gap-2 relative overflow-hidden group",onClick:()=>{var e;return null==(e=document.getElementById("barcode-scanner"))?void 0:e.scrollIntoView({behavior:"smooth"})},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/10 to-cyan-500/10 opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsx(ue,{className:"h-6 w-6 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium",children:f("userDashboard.barcodeScanner")}),e.jsx("span",{className:"text-xs text-text-secondary",children:f("userDashboard.barcodeScannerTier")})]}),A("wearableIntegration")&&e.jsxs(o,{variant:"outline",className:"h-24 flex flex-col gap-2 relative overflow-hidden group",onClick:()=>{var e;return null==(e=document.getElementById("wearable-sync"))?void 0:e.scrollIntoView({behavior:"smooth"})},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-green-500/10 to-emerald-500/10 opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsx(fe,{className:"h-6 w-6 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:f("userDashboard.wearableDevices")}),e.jsx("span",{className:"text-xs text-text-secondary",children:f("userDashboard.wearableDevicesTier")})]}),"free"!==S&&e.jsxs(o,{variant:"outline",className:"h-24 flex flex-col gap-2 relative overflow-hidden group",onClick:()=>{var e;return null==(e=document.getElementById("food-database"))?void 0:e.scrollIntoView({behavior:"smooth"})},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-500/10 to-red-500/10 opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsx(he,{className:"h-6 w-6 text-orange-500"}),e.jsx("span",{className:"text-sm font-medium",children:f("userDashboard.foodDatabase")}),e.jsx("span",{className:"text-xs text-text-secondary",children:f("userDashboard.foodDatabaseTier")})]}),A("nutritionistAccess")&&e.jsxs(o,{variant:"outline",className:"h-24 flex flex-col gap-2 relative overflow-hidden group",onClick:()=>{var e;return null==(e=document.getElementById("messaging-center"))?void 0:e.scrollIntoView({behavior:"smooth"})},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/10 to-purple-500/10 opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsx(dt,{className:"h-6 w-6 text-indigo-500"}),e.jsx("span",{className:"text-sm font-medium",children:f("userDashboard.messageNutritionist")}),e.jsx("span",{className:"text-xs text-text-secondary",children:f("userDashboard.messageNutritionistTier")})]}),"free"===S&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"h-24 flex flex-col gap-2 items-center justify-center border-2 border-dashed border-border rounded-lg opacity-50",children:[e.jsx(le,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs",children:f("userDashboard.photoFoodRecognition")}),e.jsx("span",{className:"text-xs text-text-secondary",children:f("userDashboard.photoFoodRecognitionTier")})]}),e.jsxs("div",{className:"h-24 flex flex-col gap-2 items-center justify-center border-2 border-dashed border-border rounded-lg opacity-50",children:[e.jsx(fe,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs",children:f("userDashboard.wearableDevices")}),e.jsx("span",{className:"text-xs text-text-secondary",children:f("userDashboard.wearableDevicesTier")})]}),e.jsxs("div",{className:"h-24 flex flex-col gap-2 items-center justify-center border-2 border-dashed border-border rounded-lg opacity-50",children:[e.jsx(dt,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs",children:f("userDashboard.messageNutritionist")}),e.jsx("span",{className:"text-xs text-text-secondary",children:f("userDashboard.messageNutritionistTier")})]})]})]})]})}),e.jsx(gt.div,{variants:ie,children:e.jsx(uc,{})}),"free"!==S&&e.jsx(gt.div,{variants:ie,children:e.jsx(hc,{})}),1===O.length&&e.jsx(gt.div,{variants:ie,children:e.jsx(_,{className:"glass-effect",children:e.jsx(j,{className:"py-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx(Be,{className:"w-5 h-5 text-yellow-500"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-2xl font-bold text-primary",children:O[0].current_streak}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"day"}),e.jsxs("span",{className:"text-sm font-medium capitalize",children:[O[0].streak_type.replace(/_/g," ")," streak"]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Best: ",O[0].longest_streak," days"]})]})})})}),O.length>=2&&e.jsx(gt.div,{variants:ie,children:e.jsxs(_,{className:"glass-effect",children:[e.jsx(b,{className:"p-4 sm:p-6",children:e.jsxs(N,{className:"text-lg sm:text-xl font-bold flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4 sm:w-5 sm:h-5 text-yellow-500"}),"Your Streaks"]})}),e.jsx(j,{className:"grid grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4 p-4 sm:p-6 pt-0",children:O.map(t=>e.jsxs("div",{className:"text-center p-3 sm:p-4 bg-muted rounded-lg",children:[e.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-primary",children:t.current_streak}),e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground capitalize",children:t.streak_type.replace(/_/g," ")}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Best: ",t.longest_streak]})]},t.id))})]})}),e.jsxs(gt.div,{variants:se,className:"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6",children:[e.jsx(gt.div,{variants:ie,className:"lg:col-span-2",children:e.jsxs(_,{className:"glass-effect h-full",children:[e.jsx(b,{className:"p-4 sm:p-6",children:e.jsxs(N,{className:"text-lg sm:text-xl font-bold flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Recent Activity"]})}),e.jsx(j,{className:"space-y-3 p-4 sm:p-6 pt-0",children:T.length>0?T.map(t=>e.jsxs(gt.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"flex items-start gap-3 p-3 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex-shrink-0 p-2 rounded-full bg-primary/20",children:["logged_meal"===t.activity_type&&e.jsx(Z,{className:"w-4 h-4 text-primary"}),"completed_workout"===t.activity_type&&e.jsx(V,{className:"w-4 h-4 text-primary"}),"weight_update"===t.activity_type&&e.jsx(U,{className:"w-4 h-4 text-primary"}),"sleep_log"===t.activity_type&&e.jsx(z,{className:"w-4 h-4 text-primary"}),"water_intake"===t.activity_type&&e.jsx(H,{className:"w-4 h-4 text-primary"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:t.activity_title}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.activity_description}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:new Date(t.created_at).toLocaleString()})]})]},t.id)):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(xe,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No activity yet. Start logging your health data!"})]})})]})}),e.jsx(gt.div,{variants:ie,children:e.jsxs(_,{className:"glass-effect h-full",children:[e.jsx(b,{className:"p-4 sm:p-6",children:e.jsx(N,{className:"text-lg sm:text-xl font-bold",children:"Your Goals"})}),e.jsx(j,{className:"space-y-3 sm:space-y-4 p-4 sm:p-6 pt-0",children:(null==d?void 0:d.health_goals)&&d.health_goals.length>0?d.health_goals.map(t=>e.jsxs(gt.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4},className:"flex items-center gap-3 sm:gap-4 bg-muted p-3 rounded-lg",children:[te(t),e.jsx("span",{className:"text-sm sm:text-base font-medium text-text-primary capitalize",children:t.replace(/_/g," ")})]},t)):e.jsx("p",{className:"text-sm sm:text-base text-text-secondary",children:"No goals set yet. Update your profile to add goals!"})})]})})]}),e.jsx(gt.div,{variants:ie,children:e.jsx(rr,{})}),"free"!==S&&e.jsxs(gt.div,{variants:se,className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[e.jsx(gt.div,{variants:ie,children:e.jsx(fc,{})}),e.jsx(gt.div,{variants:ie,children:e.jsx(pc,{})})]}),e.jsxs(gt.div,{variants:se,className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[e.jsx(gt.div,{variants:ie,children:e.jsx(or,{})}),e.jsx(gt.div,{variants:ie,children:e.jsxs(_,{className:"glass-effect h-full",children:[e.jsx(b,{className:"p-4 sm:p-6",children:e.jsx(N,{className:"text-lg sm:text-xl font-bold",children:"AI-Powered Tools"})}),e.jsxs(j,{className:"space-y-3 p-4 sm:p-6 pt-0",children:[e.jsx(nr,{onSuccess:ee}),e.jsx(ir,{onSuccess:ee})]})]})})]}),A("photoRecognition")&&e.jsx(gt.div,{variants:ie,id:"photo-food-recognition",children:e.jsx(dr,{})}),"free"!==S&&e.jsx(gt.div,{variants:ie,id:"barcode-scanner",children:e.jsx(Fl,{onFoodAdded:ee})}),A("wearableIntegration")&&e.jsx(gt.div,{variants:ie,id:"wearable-sync",children:e.jsx(Ll,{})}),"free"!==S&&e.jsx(gt.div,{variants:ie,id:"food-database",children:e.jsx(Ul,{onFoodAdded:ee})}),e.jsx(gt.div,{variants:ie,id:"meal-plan-widget",children:e.jsx(gc,{})}),"free"!==S&&e.jsx(gt.div,{variants:ie,id:"messaging-center",children:e.jsxs(_,{className:"glass-effect",children:[e.jsxs(b,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(dt,{className:"h-5 w-5"}),f("userDashboard.nutritionistMessaging")]}),e.jsx("p",{className:"text-sm text-text-secondary",children:f("userDashboard.connectWithNutritionist")})]}),e.jsx(j,{children:e.jsx(qt,{})})]})}),"free"!==S&&e.jsx(gt.div,{variants:ie,children:e.jsx(Kl,{previewMode:n})}),"free"!==S&&e.jsx(gt.div,{variants:ie,children:e.jsx(Zl,{})}),"free"!==S&&e.jsx(gt.div,{variants:ie,children:e.jsx($l,{})}),"free"!==S&&e.jsx(gt.div,{variants:ie,children:e.jsx(Ql,{})}),"free"!==S&&e.jsx(gt.div,{variants:ie,children:e.jsx(Jl,{})}),"free"!==S&&e.jsx(gt.div,{variants:ie,children:e.jsx(ec,{})}),"free"!==S&&e.jsx(gt.div,{variants:ie,children:e.jsx(tc,{})}),("ultimate"===S||"elite"===S)&&e.jsx(gt.div,{variants:ie,children:e.jsx(rc,{})}),("ultimate"===S||"elite"===S)&&e.jsx(gt.div,{variants:ie,children:e.jsx(nc,{previewMode:n})}),("ultimate"===S||"elite"===S)&&e.jsx(gt.div,{variants:ie,children:e.jsx(sc,{})}),("ultimate"===S||"elite"===S)&&e.jsx(gt.div,{variants:ie,children:e.jsx(ic,{})}),"free"!==S&&e.jsx(gt.div,{variants:ie,children:e.jsx(mc,{})}),"elite"===S&&e.jsx(gt.div,{variants:ie,children:e.jsx(xc,{})}),"elite"===S&&e.jsx(gt.div,{variants:ie,children:e.jsx(yc,{})}),"elite"===S&&e.jsx(gt.div,{variants:ie,children:e.jsx(ac,{})}),"elite"===S&&e.jsx(gt.div,{variants:ie,children:e.jsx(oc,{})}),"free"!==S&&e.jsx(gt.div,{variants:ie,children:e.jsx(lc,{})}),e.jsx(gt.div,{variants:ie,children:e.jsx(lr,{})}),x&&e.jsx(gt.div,{variants:ie,children:e.jsx(Gt,{placementName:"dashboard_sidebar"})})]}),W&&e.jsx($t,{placementName:"rewarded_video",onClose:()=>X(!1),onRewardEarned:()=>{n?h({title:"Preview Mode",description:"This is a demo - no actual changes are made"}):(Q(e=>e+1),h({title:"ðŸŽ Reward Earned!",description:"You've earned +1 bonus AI message!"}))},rewardDescription:"Get +1 bonus AI message"}),Y&&e.jsx(Zt,{placementName:"after_ai_generation",onClose:()=>q(!1),forceCountdown:3})]})});vc.displayName="UserDashboard";const wc=Object.freeze(Object.defineProperty({__proto__:null,default:vc},Symbol.toStringTag,{value:"Module"}));export{Gl as U,wc as a};
