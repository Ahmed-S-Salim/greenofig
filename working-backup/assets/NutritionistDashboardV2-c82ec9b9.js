import{j as e,g as s,h as t,u as a,i as l,k as i,l as r,m as n,n as c,o as d,p as o,q as m,r as x,t as u,v as h,w as p}from"./vendor-ui-8934955f.js";import{r as g,L as j,u as f,l as v,f as b}from"./vendor-react-c35372bd.js";import{b as N,a as y,s as w,B as _,c as k,t as C,L as S,T as M,I as A,u as P,g as E,l as R,H as D}from"./index-05934966.js";import{E as T,a as F}from"./EnhancedBlogManager-8bca7b42.js";import{C as I,a as z,b as L,c as B,e as O}from"./card-5ef2c077.js";import{S as $,V as q,a2 as W,a3 as V,m as G,u as U,a4 as H,x as K,a5 as Y,a6 as Q,a7 as Z,a8 as J,a9 as X,aa as ee,ab as se,ac as te,ad as ae,ae as le,s as ie,af as re,ag as ne,ah as ce,B as de,ai as oe,_ as me,P as xe,i as ue,v as he,aj as pe,M as ge,F as je,k as fe,g as ve,ak as be,D as Ne,al as ye,am as we,an as _e,ao as ke,ap as Ce,aq as Se,ar as Me,as as Ae,at as Pe,au as Ee,av as Re,aw as De,ax as Te,X as Fe,ay as Ie,az as ze,aA as Le,aB as Be,aC as Oe,aD as $e,L as qe,aE as We,aF as Ve,aG as Ge,aH as Ue,aI as He,aJ as Ke,aK as Ye,aL as Qe,U as Ze,A as Je,aM as Xe,h as es,C as ss,Z as ts,aN as as,aO as ls,aP as is,aQ as rs,aR as ns,aS as cs,aT as ds,aU as os,aV as ms,aW as xs,aX as us,O as hs,aY as ps,aZ as gs,w as js,a_ as fs,a$ as vs,z as bs}from"./vendor-utils-1c9b7ece.js";import{T as Ns,a as ys,b as ws,c as _s}from"./tabs-2a9eaf96.js";import{D as ks,a as Cs,b as Ss,c as Ms,d as As,f as Ps}from"./dialog-f70f7e7c.js";import{D as Es,a as Rs,b as Ds,c as Ts,d as Fs}from"./dropdown-menu-0d9d9d7b.js";import{P as Is,A as zs,a as Ls}from"./progress-4bfc6d82.js";import{S as Bs,a as Os,b as $s,c as qs,d as Ws}from"./select-b96110db.js";import{S as Vs}from"./switch-6cba4f79.js";import"./vendor-editor-7586347a.js";import"./checkbox-50f8b8bc.js";const Gs=({tier:s,size:t="default",showIcon:a=!0})=>{const l={Base:{color:"bg-gray-500/10 text-gray-700 dark:bg-gray-500/20 dark:text-gray-300 border-gray-500/20",icon:$,label:"Base"},Premium:{color:"bg-blue-500/10 text-blue-700 dark:bg-blue-500/20 dark:text-blue-300 border-blue-500/20",icon:q,label:"Premium"},Elite:{color:"bg-gradient-to-r from-yellow-500/10 to-orange-500/10 text-yellow-700 dark:from-yellow-500/20 dark:to-orange-500/20 dark:text-yellow-300 border-yellow-500/20",icon:W,label:"Elite"}},i=l[s]||l.Base,r=i.icon;return e.jsxs(N,{className:`${i.color} ${{sm:"text-xs px-2 py-0.5",default:"text-sm px-3 py-1",lg:"text-base px-4 py-1.5"}[t]} font-semibold border`,variant:"outline",children:[a&&e.jsx(r,{className:"w-3 h-3 mr-1"}),i.label]})},Us=()=>{const{userProfile:s}=y(),[t,a]=g.useState([]),[l,i]=g.useState(null),[r,n]=g.useState(!0);g.useEffect(()=>{(null==s?void 0:s.id)&&c()},[null==s?void 0:s.id]);const c=async()=>{try{const{data:e,error:t}=await w.from("client_retention_metrics").select("*").eq("nutritionist_id",s.id).order("month_year",{ascending:!1}).limit(6);if(t)return;a((e||[]).reverse()),i((null==e?void 0:e[0])||null),n(!1)}catch(e){n(!1)}},d=t.map(e=>({month:e.month_year,clients:e.total_clients,active:e.active_clients,retention:e.retention_rate,revenue:e.total_revenue}));return r?e.jsxs(I,{className:"glass-effect",children:[e.jsx(z,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5 text-primary"}),"Client Retention Metrics"]})}),e.jsx(B,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-40 bg-muted rounded"}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:[...Array(4)].map((s,t)=>e.jsx("div",{className:"h-20 bg-muted rounded"},t))})]})})]}):e.jsxs(I,{className:"glass-effect",children:[e.jsxs(z,{children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5 text-primary"}),"Client Retention Analytics"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Track your client retention, tier distribution, and revenue over time"})]}),e.jsxs(B,{className:"space-y-6",children:[l&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(G.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"p-4 bg-gradient-to-br from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(U,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Total Clients"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-400",children:l.total_clients}),e.jsxs("div",{className:"text-xs text-green-400 mt-1",children:["+",l.new_clients," new this month"]})]}),e.jsxs(G.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"p-4 bg-gradient-to-br from-green-500/10 to-emerald-500/10 rounded-lg border border-green-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(H,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Retention Rate"})]}),e.jsxs("div",{className:"text-2xl font-bold text-green-400",children:[l.retention_rate||0,"%"]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[l.active_clients," active clients"]})]}),e.jsxs(G.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"p-4 bg-gradient-to-br from-purple-500/10 to-pink-500/10 rounded-lg border border-purple-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(K,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Monthly Revenue"})]}),e.jsxs("div",{className:"text-2xl font-bold text-purple-400",children:["$",l.total_revenue||0]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["$",l.revenue_per_client||0,"/client"]})]}),e.jsxs(G.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"p-4 bg-gradient-to-br from-orange-500/10 to-red-500/10 rounded-lg border border-orange-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(q,{className:"w-4 h-4 text-orange-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Elite Clients"})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-400",children:l.elite_clients}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Premium: ",l.premium_clients," | Pro: ",l.pro_clients]})]})]}),l&&e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-3 text-sm",children:"Client Tier Distribution"}),e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Base"}),e.jsx("div",{className:"text-lg font-bold",children:l.base_clients}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[Math.round(l.base_clients/l.total_clients*100),"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-xs text-muted-foreground mb-1 flex items-center justify-center gap-1",children:[e.jsx($,{className:"w-3 h-3"}),"Premium"]}),e.jsx("div",{className:"text-lg font-bold text-blue-400",children:l.premium_clients}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[Math.round(l.premium_clients/l.total_clients*100),"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-xs text-muted-foreground mb-1 flex items-center justify-center gap-1",children:[e.jsx(q,{className:"w-3 h-3"}),"Pro"]}),e.jsx("div",{className:"text-lg font-bold text-purple-400",children:l.pro_clients}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[Math.round(l.pro_clients/l.total_clients*100),"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-xs text-muted-foreground mb-1 flex items-center justify-center gap-1",children:[e.jsx(W,{className:"w-3 h-3"}),"Elite"]}),e.jsx("div",{className:"text-lg font-bold text-yellow-400",children:l.elite_clients}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[Math.round(l.elite_clients/l.total_clients*100),"%"]})]})]})]}),t.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3 text-sm",children:"6-Month Retention Trend"}),e.jsx(Y,{width:"100%",height:200,children:e.jsxs(Q,{data:d,children:[e.jsx(Z,{strokeDasharray:"3 3",stroke:"#333"}),e.jsx(J,{dataKey:"month",stroke:"#888",style:{fontSize:"12px"}}),e.jsx(X,{stroke:"#888",style:{fontSize:"12px"}}),e.jsx(ee,{contentStyle:{backgroundColor:"#1a1a1a",border:"1px solid #333",borderRadius:"8px"}}),e.jsx(se,{}),e.jsx(te,{type:"monotone",dataKey:"clients",stroke:"#3b82f6",strokeWidth:2,name:"Total Clients"}),e.jsx(te,{type:"monotone",dataKey:"active",stroke:"#10b981",strokeWidth:2,name:"Active Clients"}),e.jsx(te,{type:"monotone",dataKey:"retention",stroke:"#a855f7",strokeWidth:2,name:"Retention %"})]})})]}),0===t.length&&e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(V,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No retention metrics yet"}),e.jsx("p",{className:"text-xs mt-1",children:"Metrics will automatically calculate at the end of each month"})]})]})]})},Hs=()=>{const{user:s}=y(),[t,a]=g.useState({totalClients:0,baseClients:0,premiumClients:0,eliteClients:0,activeClients:0,activeMealPlans:0,upcomingAppointments:0,monthlyRevenue:0}),[l,i]=g.useState([]),[r,n]=g.useState([]),[c,d]=g.useState([]),[o,m]=g.useState(!0);g.useEffect(()=>{s&&x()},[s]);const x=async()=>{m(!0);try{const{data:e,error:t}=await w.from("user_profiles").select("id, full_name, email, created_at, tier").eq("role","user");if(t)throw t;const l=(null==e?void 0:e.filter(e=>"Base"===(e.tier||"Base")).length)||0,r=(null==e?void 0:e.filter(e=>"Premium"===e.tier).length)||0,c=(null==e?void 0:e.filter(e=>"Elite"===e.tier).length)||0,o=29*r+59*c,m=new Date;m.setDate(m.getDate()-7);let x=0;if(e)for(const s of e){const{data:e}=await w.from("client_progress").select("date").eq("client_id",s.id).gte("date",m.toISOString().split("T")[0]).limit(1);e&&e.length>0&&x++}const{data:u,error:h}=await w.from("meal_plans_v2").select("id, name, status").eq("nutritionist_id",s.id).eq("status","active"),p=new Date;p.setHours(0,0,0,0);const g=new Date(p);g.setDate(g.getDate()+1);const{data:j,error:f}=await w.from("appointments").select("*, user_profiles!appointments_client_id_fkey(full_name, tier)").eq("nutritionist_id",s.id).gte("appointment_date",p.toISOString()).order("appointment_date",{ascending:!0}).limit(10),v=(null==j?void 0:j.filter(e=>{const s=new Date(e.appointment_date);return s>=p&&s<g}))||[];a({totalClients:(null==e?void 0:e.length)||0,baseClients:l,premiumClients:r,eliteClients:c,activeClients:x,activeMealPlans:(null==u?void 0:u.length)||0,upcomingAppointments:(null==j?void 0:j.length)||0,monthlyRevenue:o}),i(v);const b=[],N=(null==e?void 0:e.filter(e=>!0).length)||0;N>0&&b.push({id:1,message:`${N} clients need follow-up this week`,priority:"high",tier:null}),l>0&&b.push({id:2,message:`${l} Base tier clients could benefit from Premium features`,priority:"medium",tier:"Base"}),r>0&&b.push({id:3,message:`${r} Premium clients eligible for Elite upgrade`,priority:"low",tier:"Premium"}),d(b),n([{id:1,type:"client_joined",message:"New client registered",time:"2 hours ago",tier:"Base"},{id:2,type:"meal_plan",message:"Meal plan created for Elite client",time:"5 hours ago",tier:"Elite"},{id:3,type:"appointment",message:"Premium consultation completed",time:"1 day ago",tier:"Premium"}])}catch(e){}finally{m(!1)}},u=({icon:s,label:t,value:a,change:l,color:i,bgColor:r})=>e.jsx(I,{className:"bg-card border-border",children:e.jsx(B,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:t}),e.jsx("h3",{className:"text-3xl font-bold text-foreground",children:a}),l&&e.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400 mt-1 flex items-center gap-1",children:[e.jsx(V,{className:"w-4 h-4"}),l]})]}),e.jsx("div",{className:`p-4 rounded-full ${r||"bg-primary/10"}`,children:e.jsx(s,{className:`w-6 h-6 ${i||"text-primary"}`})})]})})}),h=[{name:"Base",value:t.baseClients,color:"#6b7280"},{name:"Premium",value:t.premiumClients,color:"#3b82f6"},{name:"Elite",value:t.eliteClients,color:"#eab308"}].filter(e=>e.value>0);return o?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Nutritionist Dashboard"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your clients across all subscription tiers"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(u,{icon:U,label:"Total Clients",value:t.totalClients,change:"+12% this month",color:"text-primary",bgColor:"bg-primary/10"}),e.jsx(u,{icon:ae,label:"Active Clients",value:t.activeClients,color:"text-green-600 dark:text-green-400",bgColor:"bg-green-600/10 dark:bg-green-700/10"}),e.jsx(u,{icon:le,label:"Active Meal Plans",value:t.activeMealPlans,color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-600/10 dark:bg-blue-700/10"}),e.jsx(u,{icon:K,label:"Monthly Revenue",value:`$${t.monthlyRevenue}`,change:"+8% this month",color:"text-purple-600 dark:text-purple-400",bgColor:"bg-purple-600/10 dark:bg-purple-700/10"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(I,{className:"lg:col-span-2 bg-card border-border",children:[e.jsx(z,{children:e.jsxs(L,{className:"flex items-center gap-2 text-foreground",children:[e.jsx(ie,{className:"w-5 h-5"}),"Client Tier Distribution"]})}),e.jsx(B,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"flex items-center justify-center",children:h.length>0?e.jsx(Y,{width:"100%",height:200,children:e.jsxs(re,{children:[e.jsx(ne,{data:h,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,value:s})=>`${e}: ${s}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:h.map((s,t)=>e.jsx(ce,{fill:s.color},`cell-${t}`))}),e.jsx(ee,{})]})}):e.jsx("p",{className:"text-muted-foreground",children:"No clients yet"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-500/10 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"}),e.jsx("span",{className:"font-semibold",children:"Base Tier"})]}),e.jsx("span",{className:"text-xl font-bold",children:t.baseClients})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-500/10 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"}),e.jsx("span",{className:"font-semibold",children:"Premium Tier"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-xl font-bold",children:t.premiumClients}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["$",29*t.premiumClients,"/mo"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-yellow-500/10 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400"}),e.jsx("span",{className:"font-semibold",children:"Elite Tier"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-xl font-bold",children:t.eliteClients}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["$",59*t.eliteClients,"/mo"]})]})]})]})]})})]}),e.jsxs(I,{className:"bg-card border-border",children:[e.jsx(z,{children:e.jsxs(L,{className:"flex items-center gap-2 text-foreground",children:[e.jsx(de,{className:"w-5 h-5"}),"Action Items"]})}),e.jsx(B,{children:e.jsx("div",{className:"space-y-3",children:c.length>0?c.map(s=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg border "+("high"===s.priority?"bg-red-50/50 dark:bg-red-950/20 border-red-200 dark:border-red-900":"medium"===s.priority?"bg-yellow-50/50 dark:bg-yellow-950/20 border-yellow-200 dark:border-yellow-900":"bg-blue-50/50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-900"),children:[e.jsx(oe,{className:"w-5 h-5 flex-shrink-0 "+("high"===s.priority?"text-red-600 dark:text-red-400":"medium"===s.priority?"text-yellow-600 dark:text-yellow-400":"text-blue-600 dark:text-blue-400")}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-foreground",children:s.message}),s.tier&&e.jsx("div",{className:"mt-2",children:e.jsx(Gs,{tier:s.tier,size:"sm"})})]})]},s.id)):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No action items"})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(I,{className:"lg:col-span-2 bg-card border-border",children:[e.jsx(z,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(L,{className:"flex items-center gap-2 text-foreground",children:[e.jsx(me,{className:"w-5 h-5"}),"Today's Schedule"]}),e.jsx(_,{variant:"ghost",size:"sm",asChild:!0,children:e.jsxs(j,{to:"/app/nutritionist/schedule",children:["View All ",e.jsx(xe,{className:"w-4 h-4 ml-1"})]})})]})}),e.jsx(B,{children:l.length>0?e.jsx("div",{className:"space-y-3",children:l.map(s=>{var t,a;return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg hover:bg-muted transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-600 dark:bg-green-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold text-foreground",children:(null==(t=s.user_profiles)?void 0:t.full_name)||"Client"}),(null==(a=s.user_profiles)?void 0:a.tier)&&e.jsx(Gs,{tier:s.user_profiles.tier,size:"sm"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.consultation_type||"Consultation"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:ue(new Date(s.appointment_date),"h:mm a")}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.duration_minutes," min"]})]})]},s.id)})}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(he,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No appointments scheduled for today"})]})})]}),e.jsxs(I,{className:"bg-card border-border",children:[e.jsx(z,{children:e.jsx(L,{className:"text-foreground",children:"Recent Activity"})}),e.jsx(B,{children:e.jsx("div",{className:"space-y-4",children:r.map(s=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary mt-2"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-foreground",children:s.message}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:s.time}),s.tier&&e.jsx(Gs,{tier:s.tier,size:"sm"})]})]}),e.jsx(pe,{className:"w-4 h-4 text-green-600 dark:text-green-400 flex-shrink-0"})]},s.id))})})]})]}),e.jsx(Us,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(_,{asChild:!0,className:"h-20 text-lg",variant:"outline",children:e.jsxs(j,{to:"/app/nutritionist/clients",children:[e.jsx(U,{className:"w-5 h-5 mr-2"}),"Manage Clients"]})}),e.jsx(_,{asChild:!0,className:"h-20 text-lg",variant:"outline",children:e.jsxs(j,{to:"/app/nutritionist/meals",children:[e.jsx(le,{className:"w-5 h-5 mr-2"}),"Create Meal Plan"]})}),e.jsx(_,{asChild:!0,className:"h-20 text-lg",variant:"outline",children:e.jsxs(j,{to:"/app/nutritionist/schedule",children:[e.jsx(he,{className:"w-5 h-5 mr-2"}),"Schedule Appointment"]})})]})]})};var[Ks,Ys]=s("Tooltip",[t]),Qs=t(),Zs="TooltipProvider",Js=700,Xs="tooltip.open",[et,st]=Ks(Zs),tt=s=>{const{__scopeTooltip:t,delayDuration:a=Js,skipDelayDuration:l=300,disableHoverableContent:i=!1,children:r}=s,n=g.useRef(!0),c=g.useRef(!1),d=g.useRef(0);return g.useEffect(()=>{const e=d.current;return()=>window.clearTimeout(e)},[]),e.jsx(et,{scope:t,isOpenDelayedRef:n,delayDuration:a,onOpen:g.useCallback(()=>{window.clearTimeout(d.current),n.current=!1},[]),onClose:g.useCallback(()=>{window.clearTimeout(d.current),d.current=window.setTimeout(()=>n.current=!0,l)},[l]),isPointerInTransitRef:c,onPointerInTransitChange:g.useCallback(e=>{c.current=e},[]),disableHoverableContent:i,children:r})};tt.displayName=Zs;var at="Tooltip",[lt,it]=Ks(at),rt=s=>{const{__scopeTooltip:t,children:a,open:l,defaultOpen:i,onOpenChange:r,disableHoverableContent:n,delayDuration:c}=s,d=st(at,s.__scopeTooltip),o=Qs(t),[m,x]=g.useState(null),j=u(),f=g.useRef(0),v=n??d.disableHoverableContent,b=c??d.delayDuration,N=g.useRef(!1),[y,w]=h({prop:l,defaultProp:i??!1,onChange:e=>{e?(d.onOpen(),document.dispatchEvent(new CustomEvent(Xs))):d.onClose(),null==r||r(e)},caller:at}),_=g.useMemo(()=>y?N.current?"delayed-open":"instant-open":"closed",[y]),k=g.useCallback(()=>{window.clearTimeout(f.current),f.current=0,N.current=!1,w(!0)},[w]),C=g.useCallback(()=>{window.clearTimeout(f.current),f.current=0,w(!1)},[w]),S=g.useCallback(()=>{window.clearTimeout(f.current),f.current=window.setTimeout(()=>{N.current=!0,w(!0),f.current=0},b)},[b,w]);return g.useEffect(()=>()=>{f.current&&(window.clearTimeout(f.current),f.current=0)},[]),e.jsx(p,{...o,children:e.jsx(lt,{scope:t,contentId:j,open:y,stateAttribute:_,trigger:m,onTriggerChange:x,onTriggerEnter:g.useCallback(()=>{d.isOpenDelayedRef.current?S():k()},[d.isOpenDelayedRef,S,k]),onTriggerLeave:g.useCallback(()=>{v?C():(window.clearTimeout(f.current),f.current=0)},[C,v]),onOpen:k,onClose:C,disableHoverableContent:v,children:a})})};rt.displayName=at;var nt="TooltipTrigger",ct=g.forwardRef((s,t)=>{const{__scopeTooltip:n,...c}=s,d=it(nt,n),o=st(nt,n),m=Qs(n),x=g.useRef(null),u=a(t,x,d.onTriggerChange),h=g.useRef(!1),p=g.useRef(!1),j=g.useCallback(()=>h.current=!1,[]);return g.useEffect(()=>()=>document.removeEventListener("pointerup",j),[j]),e.jsx(l,{asChild:!0,...m,children:e.jsx(i.button,{"aria-describedby":d.open?d.contentId:void 0,"data-state":d.stateAttribute,...c,ref:u,onPointerMove:r(s.onPointerMove,e=>{"touch"!==e.pointerType&&(p.current||o.isPointerInTransitRef.current||(d.onTriggerEnter(),p.current=!0))}),onPointerLeave:r(s.onPointerLeave,()=>{d.onTriggerLeave(),p.current=!1}),onPointerDown:r(s.onPointerDown,()=>{d.open&&d.onClose(),h.current=!0,document.addEventListener("pointerup",j,{once:!0})}),onFocus:r(s.onFocus,()=>{h.current||d.onOpen()}),onBlur:r(s.onBlur,d.onClose),onClick:r(s.onClick,d.onClose)})})});ct.displayName=nt;var[dt,ot]=Ks("TooltipPortal",{forceMount:void 0}),mt="TooltipContent",xt=g.forwardRef((s,t)=>{const a=ot(mt,s.__scopeTooltip),{forceMount:l=a.forceMount,side:i="top",...r}=s,c=it(mt,s.__scopeTooltip);return e.jsx(n,{present:l||c.open,children:c.disableHoverableContent?e.jsx(jt,{side:i,...r,ref:t}):e.jsx(ut,{side:i,...r,ref:t})})}),ut=g.forwardRef((s,t)=>{const l=it(mt,s.__scopeTooltip),i=st(mt,s.__scopeTooltip),r=g.useRef(null),n=a(t,r),[c,d]=g.useState(null),{trigger:o,onClose:m}=l,x=r.current,{onPointerInTransitChange:u}=i,h=g.useCallback(()=>{d(null),u(!1)},[u]),p=g.useCallback((e,s)=>{const t=e.currentTarget,a={x:e.clientX,y:e.clientY},l=function(e,s,t=5){const a=[];switch(s){case"top":a.push({x:e.x-t,y:e.y+t},{x:e.x+t,y:e.y+t});break;case"bottom":a.push({x:e.x-t,y:e.y-t},{x:e.x+t,y:e.y-t});break;case"left":a.push({x:e.x+t,y:e.y-t},{x:e.x+t,y:e.y+t});break;case"right":a.push({x:e.x-t,y:e.y-t},{x:e.x-t,y:e.y+t})}return a}(a,function(e,s){const t=Math.abs(s.top-e.y),a=Math.abs(s.bottom-e.y),l=Math.abs(s.right-e.x),i=Math.abs(s.left-e.x);switch(Math.min(t,a,l,i)){case i:return"left";case l:return"right";case t:return"top";case a:return"bottom";default:throw new Error("unreachable")}}(a,t.getBoundingClientRect())),i=function(e){const s=e.slice();return s.sort((e,s)=>e.x<s.x?-1:e.x>s.x?1:e.y<s.y?-1:e.y>s.y?1:0),function(e){if(e.length<=1)return e.slice();const s=[];for(let a=0;a<e.length;a++){const t=e[a];for(;s.length>=2;){const e=s[s.length-1],a=s[s.length-2];if(!((e.x-a.x)*(t.y-a.y)>=(e.y-a.y)*(t.x-a.x)))break;s.pop()}s.push(t)}s.pop();const t=[];for(let a=e.length-1;a>=0;a--){const s=e[a];for(;t.length>=2;){const e=t[t.length-1],a=t[t.length-2];if(!((e.x-a.x)*(s.y-a.y)>=(e.y-a.y)*(s.x-a.x)))break;t.pop()}t.push(s)}return t.pop(),1===s.length&&1===t.length&&s[0].x===t[0].x&&s[0].y===t[0].y?s:s.concat(t)}(s)}([...l,...function(e){const{top:s,right:t,bottom:a,left:l}=e;return[{x:l,y:s},{x:t,y:s},{x:t,y:a},{x:l,y:a}]}(s.getBoundingClientRect())]);d(i),u(!0)},[u]);return g.useEffect(()=>()=>h(),[h]),g.useEffect(()=>{if(o&&x){const e=e=>p(e,x),s=e=>p(e,o);return o.addEventListener("pointerleave",e),x.addEventListener("pointerleave",s),()=>{o.removeEventListener("pointerleave",e),x.removeEventListener("pointerleave",s)}}},[o,x,p,h]),g.useEffect(()=>{if(c){const e=e=>{const s=e.target,t={x:e.clientX,y:e.clientY},a=(null==o?void 0:o.contains(s))||(null==x?void 0:x.contains(s)),l=!function(e,s){const{x:t,y:a}=e;let l=!1;for(let i=0,r=s.length-1;i<s.length;r=i++){const e=s[i],n=s[r],c=e.x,d=e.y,o=n.x,m=n.y;d>a!=m>a&&t<(o-c)*(a-d)/(m-d)+c&&(l=!l)}return l}(t,c);a?h():l&&(h(),m())};return document.addEventListener("pointermove",e),()=>document.removeEventListener("pointermove",e)}},[o,x,c,m,h]),e.jsx(jt,{...s,ref:n})}),[ht,pt]=Ks(at,{isInside:!1}),gt=x("TooltipContent"),jt=g.forwardRef((s,t)=>{const{__scopeTooltip:a,children:l,"aria-label":i,onEscapeKeyDown:r,onPointerDownOutside:n,...m}=s,x=it(mt,a),u=Qs(a),{onClose:h}=x;return g.useEffect(()=>(document.addEventListener(Xs,h),()=>document.removeEventListener(Xs,h)),[h]),g.useEffect(()=>{if(x.trigger){const e=e=>{const s=e.target;(null==s?void 0:s.contains(x.trigger))&&h()};return window.addEventListener("scroll",e,{capture:!0}),()=>window.removeEventListener("scroll",e,{capture:!0})}},[x.trigger,h]),e.jsx(c,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:r,onPointerDownOutside:n,onFocusOutside:e=>e.preventDefault(),onDismiss:h,children:e.jsxs(d,{"data-state":x.stateAttribute,...u,...m,ref:t,style:{...m.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[e.jsx(gt,{children:l}),e.jsx(ht,{scope:a,isInside:!0,children:e.jsx(o,{id:x.contentId,role:"tooltip",children:i||l})})]})})});xt.displayName=mt;var ft="TooltipArrow";g.forwardRef((s,t)=>{const{__scopeTooltip:a,...l}=s,i=Qs(a);return pt(ft,a).isInside?null:e.jsx(m,{...i,...l,ref:t})}).displayName=ft;var vt=xt;const bt=tt,Nt=rt,yt=ct,wt=g.forwardRef(({className:s,sideOffset:t=4,...a},l)=>e.jsx(vt,{ref:l,sideOffset:t,className:k("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a}));wt.displayName=vt.displayName;const _t=({client:s,onAction:t})=>{const a=s.tier||"Base",l=(e,l)=>{i(a,l)?t&&t(e,s):C({title:"Upgrade Required",description:`This feature requires the client to be on ${l} tier or higher.`,variant:"destructive"})},i=(e,s)=>{const t={Base:1,Premium:2,Elite:3};return t[e]>=t[s]},r=({icon:s,label:t,onClick:a,disabled:l,variant:i="outline"})=>e.jsxs(_,{variant:i,size:"sm",onClick:a,disabled:l,className:"w-full justify-start",children:[e.jsx(s,{className:"w-4 h-4 mr-2"}),t]});return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold mb-2 text-muted-foreground",children:"Basic Actions"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{icon:ge,label:"Send Message",onClick:()=>l("message","Base")}),e.jsx(r,{icon:je,label:"View Meal Logs",onClick:()=>l("viewMealLogs","Base")})]})]}),i(a,"Premium")&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold mb-2 text-muted-foreground",children:"Premium Actions"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{icon:fe,label:"Create Meal Plan",onClick:()=>l("createMealPlan","Premium"),variant:"default"}),e.jsx(r,{icon:he,label:"Schedule Check-in",onClick:()=>l("scheduleCheckin","Premium"),variant:"default"}),e.jsx(r,{icon:V,label:"View Progress Charts",onClick:()=>l("viewProgress","Premium"),variant:"default"}),e.jsx(r,{icon:ve,label:"Send Quick Response",onClick:()=>l("quickMessage","Premium"),variant:"default"})]})]}),i(a,"Elite")&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold mb-2 text-muted-foreground flex items-center gap-1",children:["Elite Actions",e.jsx("span",{className:"text-xs text-yellow-600 dark:text-yellow-400",children:"(Priority)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{icon:be,label:"Schedule Video Call",onClick:()=>l("scheduleVideo","Elite"),variant:"default"}),e.jsx(r,{icon:Ne,label:"Create Workout Plan",onClick:()=>l("createWorkout","Elite"),variant:"default"}),e.jsx(r,{icon:ve,label:"Real-time Chat",onClick:()=>l("realtimeChat","Elite"),variant:"default"}),e.jsx(r,{icon:pe,label:"Generate Report",onClick:()=>l("generateReport","Elite"),variant:"default"})]})]}),"Base"===a&&e.jsx("div",{className:"p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:e.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:"Suggest Premium upgrade to unlock meal planning and progress tracking"})}),"Premium"===a&&e.jsx("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-lg",children:e.jsx("p",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:"Suggest Elite upgrade for 1-on-1 video calls and priority support"})})]})},kt=({client:s,open:t,onOpenChange:a,onUpdate:l})=>{const{user:i}=y(),[r,n]=g.useState([]),[c,d]=g.useState([]),[o,m]=g.useState(""),[x,u]=g.useState(""),[h,p]=g.useState(!1),[j,f]=g.useState("overview");g.useEffect(()=>{s&&t&&v()},[s,t]);const v=async()=>{p(!0);try{const{data:e,error:t}=await w.from("client_progress").select("*").eq("client_id",s.id).order("date",{ascending:!0}).limit(30);t||n(e||[]);const{data:a,error:l}=await w.from("meals").select("*").eq("user_id",s.id).order("created_at",{ascending:!1}).limit("Base"===s.tier?5:20);l||d(a||[]);const{data:r,error:c}=await w.from("nutritionist_notes").select("*").eq("client_id",s.id).eq("nutritionist_id",i.id).maybeSingle();!c&&r&&m(r.notes||"")}catch(e){}finally{p(!1)}},b=r.map(e=>({date:ue(new Date(e.date),"MMM d"),weight:e.weight_kg})),N=r[r.length-1],k=r[r.length-2],A=N&&k?(N.weight_kg-k.weight_kg).toFixed(1):null;return e.jsx(ks,{open:t,onOpenChange:a,children:e.jsxs(Cs,{className:"max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ss,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(Ms,{className:"text-2xl",children:s.full_name}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.email})]}),e.jsx(Gs,{tier:s.tier||"Base",size:"lg"})]})}),e.jsxs(Ns,{value:j,onValueChange:f,className:"w-full",children:[e.jsxs(ys,{className:"grid w-full grid-cols-4",children:[e.jsx(ws,{value:"overview",children:"Overview"}),e.jsx(ws,{value:"progress",children:"Progress"}),e.jsx(ws,{value:"meals",children:"Meal Logs"}),e.jsx(ws,{value:"actions",children:"Actions"})]}),e.jsxs(_s,{value:"overview",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(I,{children:e.jsx(B,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Current Weight"}),e.jsxs("p",{className:"text-3xl font-bold",children:[(null==N?void 0:N.weight_kg)||"N/A",N&&e.jsx("span",{className:"text-lg",children:" kg"})]}),A&&e.jsxs("p",{className:"text-sm mt-2 flex items-center justify-center gap-1 "+(parseFloat(A)<0?"text-green-600":"text-red-600"),children:[parseFloat(A)<0?e.jsx(ye,{className:"w-4 h-4"}):e.jsx(V,{className:"w-4 h-4"}),Math.abs(A)," kg"]})]})})}),e.jsx(I,{children:e.jsx(B,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"BMI"}),e.jsx("p",{className:"text-3xl font-bold",children:((e,s)=>{if(!e||!s)return"N/A";const t=s/100;return(e/(t*t)).toFixed(1)})(null==N?void 0:N.weight_kg,s.height_cm)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Height: ",s.height_cm?`${s.height_cm} cm`:"N/A"]})]})})}),e.jsx(I,{children:e.jsx(B,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Last Update"}),e.jsx("p",{className:"text-lg font-bold",children:(null==N?void 0:N.date)?ue(new Date(N.date),"MMM d, yyyy"):"No updates"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Member since ",s.created_at?ue(new Date(s.created_at),"MMM yyyy"):"N/A"]})]})})})]}),e.jsxs(I,{children:[e.jsx(z,{children:e.jsx(L,{className:"text-lg",children:"Nutritionist Notes"})}),e.jsxs(B,{className:"space-y-4",children:[o&&e.jsx("div",{className:"p-4 bg-muted rounded-lg",children:e.jsx("pre",{className:"whitespace-pre-wrap text-sm font-sans",children:o})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"newNote",children:"Add Note"}),e.jsx(M,{id:"newNote",placeholder:"Add a new note about this client...",value:x,onChange:e=>u(e.target.value),rows:3}),e.jsxs(_,{onClick:async()=>{if(x.trim())try{const e=o?`${o}\n\n[${ue(new Date,"MMM d, yyyy HH:mm")}]\n${x}`:x,{error:t}=await w.from("nutritionist_notes").upsert({client_id:s.id,nutritionist_id:i.id,notes:e,updated_at:(new Date).toISOString()},{onConflict:"client_id,nutritionist_id"});if(t)throw t;m(e),u(""),C({title:"Note saved",description:"Your note has been saved successfully."})}catch(e){C({title:"Error",description:"Failed to save note.",variant:"destructive"})}},disabled:!x.trim(),children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Save Note"]})]})]})]})]}),e.jsx(_s,{value:"progress",className:"space-y-4",children:"Base"===s.tier?e.jsx(I,{children:e.jsxs(B,{className:"p-8 text-center",children:[e.jsx(ae,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Progress Tracking Unavailable"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Progress tracking is available for Premium and Elite tier clients"}),e.jsx(Gs,{tier:"Premium"})]})}):e.jsx(e.Fragment,{children:e.jsxs(I,{children:[e.jsx(z,{children:e.jsx(L,{children:"Weight Progress (Last 30 Days)"})}),e.jsx(B,{children:b.length>0?e.jsx(Y,{width:"100%",height:300,children:e.jsxs(Q,{data:b,children:[e.jsx(Z,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"date"}),e.jsx(X,{}),e.jsx(ee,{}),e.jsx(te,{type:"monotone",dataKey:"weight",stroke:"#3b82f6",strokeWidth:2,dot:{r:4}})]})}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(V,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No progress data available"})]})})]})})}),e.jsx(_s,{value:"meals",className:"space-y-4",children:e.jsxs(I,{children:[e.jsx(z,{children:e.jsxs(L,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Recent Meal Logs"}),"Base"===s.tier&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"(Limited to 5)"})]})}),e.jsx(B,{children:c.length>0?e.jsx("div",{className:"space-y-3",children:c.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.meal_name||"Meal"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.created_at?ue(new Date(s.created_at),"MMM d, yyyy HH:mm"):"Unknown date"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold",children:[s.calories||0," cal"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["P: ",s.protein||0,"g | C: ",s.carbs||0,"g | F: ",s.fat||0,"g"]})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(je,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No meal logs available"})]})})]})}),e.jsx(_s,{value:"actions",className:"space-y-4",children:e.jsxs(I,{children:[e.jsxs(z,{children:[e.jsx(L,{children:"Available Actions"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Actions available based on client's ",s.tier," tier"]})]}),e.jsx(B,{children:e.jsx(_t,{client:s,onAction:(e,s)=>{switch(e){case"message":C({title:"Message",description:"Opening message composer..."});break;case"createMealPlan":C({title:"Meal Plan",description:"Redirecting to meal plan creator..."});break;case"scheduleVideo":C({title:"Video Call",description:"Opening scheduler..."});break;default:C({title:e,description:`Action: ${e}`})}}})})]})})]})]})})},Ct=()=>{const{user:s}=y(),t=f(),[a,l]=g.useState([]),[i,r]=g.useState([]),[n,c]=g.useState(""),[d,o]=g.useState("all"),[m,x]=g.useState("all"),[u,h]=g.useState(null),[p,j]=g.useState(!1),[v,b]=g.useState(!0),[N,k]=g.useState({total:0,base:0,premium:0,elite:0,active:0,inactive:0,atRisk:0});g.useEffect(()=>{C()},[s]),g.useEffect(()=>{M(),S()},[n,d,m,a]);const C=async()=>{b(!0);try{const{data:e,error:s}=await w.from("user_profiles").select("*").eq("role","user").order("created_at",{ascending:!1});if(s)throw s;const t=await Promise.all((e||[]).map(async e=>{const{data:s}=await w.from("client_progress").select("*").eq("client_id",e.id).order("date",{ascending:!1}).limit(2),{data:t}=await w.from("messages").select("created_at").or(`sender_id.eq.${e.id},recipient_id.eq.${e.id}`).order("created_at",{ascending:!1}).limit(1).maybeSingle(),{data:a}=await w.from("client_goals").select("*").eq("client_id",e.id).eq("status","active").limit(3),l=null==s?void 0:s[0],i=null==s?void 0:s[1],r=new Date;r.setDate(r.getDate()-7);const n=new Date;n.setDate(n.getDate()-14);const c=(null==l?void 0:l.date)?new Date(l.date):null,d=c&&c>r,o=c?we(new Date,c):999,m=o>=7&&o<14||l&&i&&parseFloat(l.weight_kg)>parseFloat(i.weight_kg)&&"weight_loss"===e.goal_type;return{...e,tier:e.tier||"Base",latestWeight:null==l?void 0:l.weight_kg,weightChange:l&&i?(l.weight_kg-i.weight_kg).toFixed(1):null,lastUpdate:null==l?void 0:l.date,lastContact:null==t?void 0:t.created_at,daysSinceContact:(null==t?void 0:t.created_at)?we(new Date,new Date(t.created_at)):null,isActive:d,isAtRisk:m,goals:a||[],goalCount:(null==a?void 0:a.length)||0}}));l(t)}catch(e){}finally{b(!1)}},S=()=>{const e={total:a.length,base:a.filter(e=>"Base"===e.tier).length,premium:a.filter(e=>"Premium"===e.tier).length,elite:a.filter(e=>"Elite"===e.tier).length,active:a.filter(e=>e.isActive).length,inactive:a.filter(e=>!e.isActive&&!e.isAtRisk).length,atRisk:a.filter(e=>e.isAtRisk).length};k(e)},M=()=>{let e=a;n&&(e=e.filter(e=>{var s,t;return(null==(s=e.full_name)?void 0:s.toLowerCase().includes(n.toLowerCase()))||(null==(t=e.email)?void 0:t.toLowerCase().includes(n.toLowerCase()))})),"all"!==d&&(e=e.filter(e=>e.tier===d)),"active"===m?e=e.filter(e=>e.isActive):"inactive"===m?e=e.filter(e=>!e.isActive&&!e.isAtRisk):"at-risk"===m&&(e=e.filter(e=>e.isAtRisk)),r(e)},P=(e,s)=>{s.stopPropagation(),t(`/app/nutritionist/messages?conversation=${e.id}`)},E=e=>{h(e),j(!0)},R=({client:s})=>{var a;const l=((e,s)=>{if(!e||!s)return"N/A";const t=s/100;return(e/(t*t)).toFixed(1)})(s.latestWeight,s.height_cm),i=s.weightChange&&parseFloat(s.weightChange)<0;return e.jsx(bt,{children:e.jsx(I,{className:"glass-effect hover:shadow-lg transition-all cursor-pointer h-full flex flex-col "+(s.isAtRisk?"border-orange-500/50 bg-orange-500/5":""),onClick:()=>E(s),children:e.jsxs(B,{className:"p-6 flex flex-col h-full",children:[s.isAtRisk&&e.jsxs("div",{className:"flex items-center gap-2 mb-3 p-2 bg-orange-100 dark:bg-orange-900/30 rounded-lg text-orange-700 dark:text-orange-300 text-xs",children:[e.jsx(_e,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"At Risk - Needs attention"})]}),e.jsxs("div",{className:"flex items-start justify-between mb-4 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsxs("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 relative",children:[e.jsx("span",{className:"text-lg font-bold text-primary",children:(null==(a=s.full_name)?void 0:a.split(" ").map(e=>e[0]).join(""))||"?"}),s.isActive&&e.jsx("span",{className:"absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 bg-green-500 border-2 border-background rounded-full"})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg truncate",children:s.full_name||"Unknown"}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.email})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 items-end flex-shrink-0",children:[e.jsx(Gs,{tier:s.tier,size:"sm"}),e.jsx("div",{className:"px-2 py-1 rounded-full text-xs font-medium whitespace-nowrap "+(s.isAtRisk?"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200":s.isActive?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"),children:s.isAtRisk?"At Risk":s.isActive?"Active":"Inactive"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Current Weight"}),e.jsx("p",{className:"text-lg font-bold",children:s.latestWeight?`${s.latestWeight} kg`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"BMI"}),e.jsx("p",{className:"text-lg font-bold",children:l})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Progress"}),s.weightChange?e.jsxs("p",{className:"text-lg font-bold flex items-center gap-1 "+(i?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[i?e.jsx(ye,{className:"w-4 h-4"}):e.jsx(V,{className:"w-4 h-4"}),Math.abs(s.weightChange)," kg"]}):e.jsx("p",{className:"text-lg font-bold text-muted-foreground",children:"-"})]})]}),s.goalCount>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-3 text-xs text-muted-foreground",children:[e.jsx(H,{className:"w-3.5 h-3.5 text-primary"}),e.jsxs("span",{children:[s.goalCount," active goal",s.goalCount>1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground mb-4",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"w-3.5 h-3.5"}),s.lastUpdate?ue(new Date(s.lastUpdate),"MMM d"):"No updates"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"w-3.5 h-3.5"}),null!==s.daysSinceContact?0===s.daysSinceContact?"Contacted today":`${s.daysSinceContact}d since contact`:"No messages"]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-auto pt-3 border-t border-border",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(Nt,{children:[e.jsx(yt,{asChild:!0,children:e.jsx(_,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:e=>P(s,e),children:e.jsx(ve,{className:"w-4 h-4 text-blue-500"})})}),e.jsx(wt,{children:"Send Message"})]}),e.jsxs(Nt,{children:[e.jsx(yt,{asChild:!0,children:e.jsx(_,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:e=>((e,s)=>{s.stopPropagation(),t(`/app/nutritionist/meals?assign=${e.id}`)})(s,e),children:e.jsx(fe,{className:"w-4 h-4 text-green-500"})})}),e.jsx(wt,{children:"Assign Meal Plan"})]}),e.jsxs(Nt,{children:[e.jsx(yt,{asChild:!0,children:e.jsx(_,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:e=>((e,s)=>{s.stopPropagation(),t(`/app/nutritionist/schedule?client=${e.id}`)})(s,e),children:e.jsx(Ce,{className:"w-4 h-4 text-purple-500"})})}),e.jsx(wt,{children:"Schedule Call"})]}),e.jsxs(Es,{children:[e.jsx(Rs,{asChild:!0,children:e.jsx(_,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:e=>e.stopPropagation(),children:e.jsx(Se,{className:"w-4 h-4"})})}),e.jsxs(Ds,{align:"end",children:[e.jsx(Ts,{onClick:e=>{e.stopPropagation(),E(s)},children:"View Full Profile"}),e.jsxs(Ts,{onClick:e=>P(s,e),children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Send Email"]}),e.jsx(Fs,{}),e.jsx(Ts,{onClick:e=>{e.stopPropagation()},children:"Add Note"})]})]})]}),e.jsx(_,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),E(s)},children:"View Details"})]})]})})})},D=({icon:s,label:t,value:a,color:l,bgColor:i})=>e.jsx(I,{className:"glass-effect",children:e.jsx(B,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:t}),e.jsx("p",{className:"text-3xl font-bold",children:a})]}),e.jsx("div",{className:`p-3 rounded-full ${i}`,children:e.jsx(s,{className:`w-6 h-6 ${l}`})})]})})});return v?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(U,{className:"w-8 h-8 text-primary"}),"Client Management"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage and track your clients by subscription tier"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(D,{icon:U,label:"Total Clients",value:N.total,color:"text-primary",bgColor:"bg-primary/10"}),e.jsx(D,{icon:$,label:"Base Tier",value:N.base,color:"text-gray-600 dark:text-gray-400",bgColor:"bg-gray-500/10"}),e.jsx(D,{icon:q,label:"Premium Tier",value:N.premium,color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-500/10"}),e.jsx(D,{icon:W,label:"Elite Tier",value:N.elite,color:"text-yellow-600 dark:text-yellow-400",bgColor:"bg-yellow-500/10"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(I,{className:"glass-effect",children:e.jsxs(B,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Active Clients"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:N.active}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Activity in last 7 days"})]}),e.jsx("div",{className:"p-3 rounded-full bg-green-500/10",children:e.jsx(ae,{className:"w-6 h-6 text-green-600 dark:text-green-400"})})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 transition-all",style:{width:(N.total?N.active/N.total*100:0)+"%"}})})]})}),e.jsx(I,{className:"glass-effect "+(N.atRisk>0?"border-orange-500/50":""),children:e.jsxs(B,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"At-Risk Clients"}),e.jsx("p",{className:"text-3xl font-bold "+(N.atRisk>0?"text-orange-600":"text-muted-foreground"),children:N.atRisk}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Needs attention"})]}),e.jsx("div",{className:"p-3 rounded-full "+(N.atRisk>0?"bg-orange-500/10":"bg-muted"),children:e.jsx(_e,{className:"w-6 h-6 "+(N.atRisk>0?"text-orange-600":"text-muted-foreground")})})]}),N.atRisk>0&&e.jsx(_,{variant:"outline",size:"sm",className:"w-full text-orange-600 border-orange-300 hover:bg-orange-50",onClick:()=>x("at-risk"),children:"View At-Risk Clients"})]})}),e.jsx(I,{className:"glass-effect",children:e.jsxs(B,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Revenue Estimate"}),e.jsxs("p",{className:"text-3xl font-bold",children:["$",(29*N.premium+59*N.elite).toFixed(0)]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Monthly recurring revenue"})]}),e.jsx("div",{className:"p-3 rounded-full bg-primary/10",children:e.jsx(ie,{className:"w-6 h-6 text-primary"})})]}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),e.jsxs("span",{children:["Premium: $",29*N.premium]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),e.jsxs("span",{children:["Elite: $",59*N.elite]})]})]})]})})]}),e.jsx(I,{className:"glass-effect",children:e.jsx(B,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(A,{placeholder:"Search clients by name or email...",value:n,onChange:e=>c(e.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(_,{variant:"all"===d?"default":"outline",size:"sm",onClick:()=>o("all"),className:"whitespace-nowrap",children:"All Tiers"}),e.jsxs(_,{variant:"Base"===d?"default":"outline",size:"sm",onClick:()=>o("Base"),className:"whitespace-nowrap "+("Base"===d?"":"border-gray-500/20"),children:[e.jsx($,{className:"w-3 h-3 mr-1 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Base"})," (",N.base,")"]}),e.jsxs(_,{variant:"Premium"===d?"default":"outline",size:"sm",onClick:()=>o("Premium"),className:"whitespace-nowrap "+("Premium"===d?"":"border-blue-500/20"),children:[e.jsx(q,{className:"w-3 h-3 mr-1 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Premium"})," (",N.premium,")"]}),e.jsxs(_,{variant:"Elite"===d?"default":"outline",size:"sm",onClick:()=>o("Elite"),className:"whitespace-nowrap "+("Elite"===d?"":"border-yellow-500/20"),children:[e.jsx(W,{className:"w-3 h-3 mr-1 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Elite"})," (",N.elite,")"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 sm:ml-auto",children:[e.jsx(_,{variant:"all"===m?"default":"outline",size:"sm",onClick:()=>x("all"),className:"whitespace-nowrap",children:"All"}),e.jsxs(_,{variant:"active"===m?"default":"outline",size:"sm",onClick:()=>x("active"),className:"whitespace-nowrap",children:[e.jsx(ae,{className:"w-3 h-3 mr-1"}),"Active (",N.active,")"]}),e.jsxs(_,{variant:"at-risk"===m?"default":"outline",size:"sm",onClick:()=>x("at-risk"),className:"whitespace-nowrap "+("at-risk"===m?"bg-orange-500 hover:bg-orange-600":"text-orange-600 border-orange-300 hover:bg-orange-50"),children:[e.jsx(_e,{className:"w-3 h-3 mr-1"}),"At Risk (",N.atRisk,")"]}),e.jsxs(_,{variant:"inactive"===m?"default":"outline",size:"sm",onClick:()=>x("inactive"),className:"whitespace-nowrap",children:["Inactive (",N.inactive,")"]})]})]})]})})}),i.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 md:gap-6",children:i.map(s=>e.jsx(R,{client:s},s.id))}):e.jsx(I,{className:"glass-effect",children:e.jsxs(B,{className:"p-12 text-center",children:[e.jsx(U,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No clients found"}),e.jsx("p",{className:"text-muted-foreground",children:n||"all"!==d||"all"!==m?"Try adjusting your filters or search":"Your clients will appear here"})]})}),u&&e.jsx(kt,{client:u,open:p,onOpenChange:j,onUpdate:C})]})},St=()=>{var s,t,a,l,i,r,n,c,d;const{user:o}=y();P();const[m,x]=g.useState([]),[u,h]=g.useState([]),[p,j]=g.useState(""),[f,v]=g.useState("pending"),[b,k]=g.useState(null),[C,S]=g.useState(!1),[E,R]=g.useState(!0),[D,T]=g.useState(""),[F,z]=g.useState("Base");g.useEffect(()=>{L()},[]),g.useEffect(()=>{O()},[p,f,m]);const L=async()=>{R(!0);try{const{data:e,error:s}=await w.from("client_intake_forms").select("\n          *,\n          user_profiles!client_intake_forms_client_id_fkey (\n            id,\n            full_name,\n            email,\n            avatar_url\n          )\n        ").order("submitted_at",{ascending:!1});if(s)throw s;x(e||[])}catch(e){}finally{R(!1)}},O=()=>{let e=m;"all"!==f&&(e=e.filter(e=>e.status===f)),p&&(e=e.filter(e=>{var s,t,a,l;return(null==(t=null==(s=e.user_profiles)?void 0:s.full_name)?void 0:t.toLowerCase().includes(p.toLowerCase()))||(null==(l=null==(a=e.user_profiles)?void 0:a.email)?void 0:l.toLowerCase().includes(p.toLowerCase()))})),h(e)},$=s=>{switch(s){case"pending":return e.jsx(me,{className:"w-4 h-4 text-yellow-500"});case"approved":return e.jsx(pe,{className:"w-4 h-4 text-green-500"});case"rejected":return e.jsx(Pe,{className:"w-4 h-4 text-red-500"});default:return e.jsx(oe,{className:"w-4 h-4 text-gray-500"})}},q=e=>({weight_loss:"Weight Loss",muscle_gain:"Muscle Gain",maintenance:"Maintenance",athletic_performance:"Athletic Performance",health_improvement:"Health Improvement"}[e]||e);return E?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Me,{className:"w-6 h-6 text-primary"}),"Client Onboarding"]}),e.jsx("p",{className:"text-text-secondary mt-1",children:"Review and approve new client intake forms"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(I,{children:e.jsx(B,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold",children:m.filter(e=>"pending"===e.status).length})]}),e.jsx(me,{className:"w-8 h-8 text-yellow-500"})]})})}),e.jsx(I,{children:e.jsx(B,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Approved"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:m.filter(e=>"approved"===e.status).length})]}),e.jsx(pe,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(I,{children:e.jsx(B,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Under Review"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:m.filter(e=>"reviewed"===e.status).length})]}),e.jsx(Ae,{className:"w-8 h-8 text-blue-500"})]})})}),e.jsx(I,{children:e.jsx(B,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Rejected"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:m.filter(e=>"rejected"===e.status).length})]}),e.jsx(Pe,{className:"w-8 h-8 text-red-500"})]})})})]}),e.jsx(I,{children:e.jsx(B,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-text-secondary w-4 h-4"}),e.jsx(A,{placeholder:"Search by name or email...",value:p,onChange:e=>j(e.target.value),className:"pl-10"})]})}),e.jsx(Ns,{value:f,onValueChange:v,children:e.jsxs(ys,{children:[e.jsx(ws,{value:"pending",children:"Pending"}),e.jsx(ws,{value:"reviewed",children:"Reviewed"}),e.jsx(ws,{value:"approved",children:"Approved"}),e.jsx(ws,{value:"rejected",children:"Rejected"}),e.jsx(ws,{value:"all",children:"All"})]})})]})})}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:0===u.length?e.jsx(I,{children:e.jsxs(B,{className:"pt-12 pb-12 text-center",children:[e.jsx(je,{className:"w-12 h-12 text-text-secondary mx-auto mb-4"}),e.jsx("p",{className:"text-text-secondary",children:"No intake forms found"})]})}):u.map(s=>{var t,a,l,i,r;return e.jsx(I,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(B,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:(null==(t=s.user_profiles)?void 0:t.avatar_url)?e.jsx("img",{src:s.user_profiles.avatar_url,alt:s.user_profiles.full_name,className:"w-12 h-12 rounded-full object-cover"}):e.jsx("span",{className:"text-primary font-bold text-lg",children:(null==(l=null==(a=s.user_profiles)?void 0:a.full_name)?void 0:l.charAt(0))||"?"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:(null==(i=s.user_profiles)?void 0:i.full_name)||"Unknown"}),e.jsx("p",{className:"text-sm text-text-secondary",children:null==(r=s.user_profiles)?void 0:r.email})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[$(s.status),e.jsx(N,{variant:"approved"===s.status?"success":"rejected"===s.status?"destructive":"secondary",children:s.status})]}),e.jsxs("p",{className:"text-xs text-text-secondary",children:["Submitted ",ue(new Date(s.submitted_at),"MMM dd, yyyy")]})]}),e.jsxs(_,{onClick:()=>(e=>{var s;k(e),T(""),z((null==(s=e.user_profiles)?void 0:s.tier)||"Base"),S(!0)})(s),variant:"outline",size:"sm",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Review"]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mt-4 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Goal"}),e.jsx("p",{className:"text-sm font-medium",children:q(s.primary_goal)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Target Weight"}),e.jsxs("p",{className:"text-sm font-medium",children:[s.target_weight_kg," kg"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Activity"}),e.jsx("p",{className:"text-sm font-medium capitalize",children:s.activity_level})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Deadline"}),e.jsx("p",{className:"text-sm font-medium",children:s.goal_deadline?ue(new Date(s.goal_deadline),"MMM dd, yyyy"):"Not set"})]})]})]})]})},s.id)})}),e.jsx(ks,{open:C,onOpenChange:S,children:e.jsxs(Cs,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ss,{children:[e.jsx(Ms,{children:"Client Intake Form Review"}),e.jsx(As,{children:"Review the client's health information and assign them to your practice"})]}),b&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-muted rounded-lg",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center",children:(null==(s=b.user_profiles)?void 0:s.avatar_url)?e.jsx("img",{src:b.user_profiles.avatar_url,alt:b.user_profiles.full_name,className:"w-16 h-16 rounded-full object-cover"}):e.jsx("span",{className:"text-primary font-bold text-2xl",children:(null==(a=null==(t=b.user_profiles)?void 0:t.full_name)?void 0:a.charAt(0))||"?"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-xl",children:null==(l=b.user_profiles)?void 0:l.full_name}),e.jsx("p",{className:"text-text-secondary",children:null==(i=b.user_profiles)?void 0:i.email}),e.jsxs(N,{className:"mt-2",children:[b.age," years old  ",b.gender]})]})]}),e.jsxs(Ns,{defaultValue:"personal",className:"w-full",children:[e.jsxs(ys,{className:"grid w-full grid-cols-4",children:[e.jsx(ws,{value:"personal",children:"Personal"}),e.jsx(ws,{value:"health",children:"Health"}),e.jsx(ws,{value:"lifestyle",children:"Lifestyle"}),e.jsx(ws,{value:"goals",children:"Goals"})]}),e.jsx(_s,{value:"personal",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Height"}),e.jsxs("p",{className:"text-lg",children:[b.height_cm," cm"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Current Weight"}),e.jsxs("p",{className:"text-lg",children:[b.current_weight_kg," kg"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Target Weight"}),e.jsxs("p",{className:"text-lg",children:[b.target_weight_kg," kg"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"BMI"}),e.jsx("p",{className:"text-lg",children:(b.current_weight_kg/(b.height_cm/100)**2).toFixed(1)})]})]})}),e.jsxs(_s,{value:"health",className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Medical Conditions"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:(null==(r=b.medical_conditions)?void 0:r.length)>0?b.medical_conditions.map((s,t)=>e.jsx(N,{variant:"outline",children:s},t)):e.jsx("p",{className:"text-text-secondary",children:"None reported"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Allergies"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:(null==(n=b.allergies)?void 0:n.length)>0?b.allergies.map((s,t)=>e.jsx(N,{variant:"outline",children:s},t)):e.jsx("p",{className:"text-text-secondary",children:"None reported"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Medications"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:(null==(c=b.medications)?void 0:c.length)>0?b.medications.map((s,t)=>e.jsx(N,{variant:"outline",children:s},t)):e.jsx("p",{className:"text-text-secondary",children:"None reported"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Dietary Restrictions"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:(null==(d=b.dietary_restrictions)?void 0:d.length)>0?b.dietary_restrictions.map((s,t)=>e.jsx(N,{variant:"outline",children:s},t)):e.jsx("p",{className:"text-text-secondary",children:"None"})})]})]}),e.jsx(_s,{value:"lifestyle",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Activity Level"}),e.jsx("p",{className:"text-lg",children:(W=b.activity_level,{sedentary:"Sedentary (Little to no exercise)",light:"Light (1-3 days/week)",moderate:"Moderate (3-5 days/week)",very_active:"Very Active (6-7 days/week)",extremely_active:"Extremely Active (2x/day)"}[W]||W)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Sleep Hours"}),e.jsxs("p",{className:"text-lg",children:[b.sleep_hours," hours/night"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Stress Level"}),e.jsx(N,{variant:"high"===b.stress_level?"destructive":"secondary",children:b.stress_level})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Water Intake"}),e.jsxs("p",{className:"text-lg",children:[b.water_intake_liters," L/day"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Cooking Skill"}),e.jsx("p",{className:"text-lg capitalize",children:b.cooking_skill_level})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Weekly Budget"}),e.jsxs("p",{className:"text-lg",children:["$",b.budget_per_week]})]})]})}),e.jsxs(_s,{value:"goals",className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Primary Goal"}),e.jsx("p",{className:"text-lg",children:q(b.primary_goal)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Goal Deadline"}),e.jsx("p",{className:"text-lg",children:b.goal_deadline?ue(new Date(b.goal_deadline),"MMMM dd, yyyy"):"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Motivation Level"}),e.jsx(N,{variant:"high"===b.motivation_level?"success":"secondary",children:b.motivation_level})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Previous Diet Experience"}),e.jsx("p",{className:"text-sm mt-2 p-3 bg-muted rounded",children:b.previous_diet_experience||"None provided"})]})]})]}),"pending"===b.status&&e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-semibold",children:"Assignment Details"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Assign Tier"}),e.jsx("div",{className:"flex gap-2 mt-2",children:["Base","Premium","Elite"].map(s=>e.jsx(_,{variant:F===s?"default":"outline",onClick:()=>z(s),size:"sm",children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Review Notes (Optional)"}),e.jsx(M,{placeholder:"Add any notes about this client...",value:D,onChange:e=>T(e.target.value),rows:3})]})]})]}),e.jsxs(Ps,{children:["pending"===(null==b?void 0:b.status)&&e.jsxs(e.Fragment,{children:[e.jsxs(_,{variant:"outline",onClick:async()=>{if(b)try{const{error:e}=await w.from("client_intake_forms").update({status:"rejected",reviewed_at:(new Date).toISOString(),reviewed_by:o.id}).eq("id",b.id);if(e)throw e;await w.rpc("create_notification",{p_user_id:b.client_id,p_type:"new_client",p_title:"Intake Form Update",p_message:"Your intake form needs additional information. Please update and resubmit.",p_action_url:"/app/survey",p_priority:"normal"}),await L(),S(!1)}catch(e){alert("Failed to reject form. Please try again.")}},children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Reject"]}),e.jsxs(_,{onClick:async()=>{if(b)try{const{error:e}=await w.from("client_intake_forms").update({status:"approved",reviewed_at:(new Date).toISOString(),reviewed_by:o.id}).eq("id",b.id);if(e)throw e;const{error:s}=await w.from("nutritionist_client_assignments").insert({nutritionist_id:o.id,client_id:b.client_id,tier:F,notes:D,status:"active"});if(s&&!s.message.includes("duplicate"))throw s;await w.rpc("create_notification",{p_user_id:b.client_id,p_type:"new_client",p_title:"Welcome to GreenoFig!",p_message:`You've been assigned to ${o.full_name}. Let's start your transformation journey!`,p_action_url:"/app/messages",p_priority:"high"}),await L(),S(!1)}catch(e){alert("Failed to approve form. Please try again.")}},children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Approve & Assign"]})]}),"pending"!==(null==b?void 0:b.status)&&e.jsx(_,{variant:"outline",onClick:()=>S(!1),children:"Close"})]})]})})]});var W},Mt=({clientId:s})=>{const{user:t}=y(),[a,l]=g.useState([]),[i,r]=g.useState(null),[n,c]=g.useState(!1),[d,o]=g.useState(!1),[m,x]=g.useState(!0),[u,h]=g.useState([]),[p,j]=g.useState({goal_type:"weight",title:"",description:"",target_value:"",current_value:"",unit:"kg",difficulty:"moderate",priority:"medium",start_date:(new Date).toISOString().split("T")[0],target_date:""});g.useEffect(()=>{s&&f()},[s]);const f=async()=>{x(!0);try{const{data:e,error:t}=await w.from("client_goals").select("*").eq("client_id",s).order("created_at",{ascending:!1});if(t)throw t;l(e||[])}catch(e){}finally{x(!1)}},v=async(e,t)=>{try{const l={status:t};"completed"===t&&(l.completed_at=(new Date).toISOString(),l.progress_percentage=100);const{error:i}=await w.from("client_goals").update(l).eq("id",e);if(i)throw i;if("completed"===t){const t=a.find(s=>s.id===e);await w.rpc("create_notification",{p_user_id:s,p_type:"achievement",p_title:"Goal Achieved! ",p_message:`Congratulations on completing: ${t.title}`,p_action_url:"/app/progress",p_priority:"high"}),await w.from("client_achievements").insert({client_id:s,achievement_type:"first_goal_completed",title:"Goal Achiever",description:`Completed goal: ${t.title}`,icon:"trophy",points:100})}await f()}catch(l){}},b=e=>we(new Date(e),new Date),k=()=>{j({goal_type:"weight",title:"",description:"",target_value:"",current_value:"",unit:"kg",difficulty:"moderate",priority:"medium",start_date:(new Date).toISOString().split("T")[0],target_date:""}),o(!1)},C=s=>{switch(s){case"active":return e.jsx(ae,{className:"w-4 h-4 text-blue-500"});case"completed":return e.jsx(pe,{className:"w-4 h-4 text-green-500"});case"paused":return e.jsx(me,{className:"w-4 h-4 text-yellow-500"});case"cancelled":case"failed":return e.jsx(oe,{className:"w-4 h-4 text-red-500"});default:return e.jsx(H,{className:"w-4 h-4 text-gray-500"})}},S=e=>{switch(e){case"critical":return"text-red-600";case"high":return"text-orange-600";case"medium":return"text-yellow-600";default:return"text-gray-600"}},P=e=>{r(e),(async e=>{try{const{data:s,error:t}=await w.from("goal_progress_updates").select("*").eq("goal_id",e).order("created_at",{ascending:!0});if(t)throw t;const a=s.map(e=>({date:ue(new Date(e.created_at),"MMM dd"),value:parseFloat(e.current_value),mood:e.mood}));h(a)}catch(s){}})(e.id),o(!1),c(!0)},E=()=>{k(),r(null),o(!0),c(!0)};return m?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(H,{className:"w-6 h-6 text-primary"}),"Goal Management"]}),e.jsx("p",{className:"text-text-secondary mt-1",children:"Track and manage client goals"})]}),e.jsxs(_,{onClick:E,children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Create Goal"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(I,{children:e.jsx(B,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Active Goals"}),e.jsx("p",{className:"text-2xl font-bold",children:a.filter(e=>"active"===e.status).length})]}),e.jsx(ae,{className:"w-8 h-8 text-blue-500"})]})})}),e.jsx(I,{children:e.jsx(B,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:a.filter(e=>"completed"===e.status).length})]}),e.jsx(pe,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(I,{children:e.jsx(B,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Avg Progress"}),e.jsxs("p",{className:"text-2xl font-bold",children:[a.length>0?Math.round(a.reduce((e,s)=>e+(s.progress_percentage||0),0)/a.length):0,"%"]})]}),e.jsx(ie,{className:"w-8 h-8 text-purple-500"})]})})}),e.jsx(I,{children:e.jsx(B,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Achievements"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:100*a.filter(e=>"completed"===e.status).length})]}),e.jsx(Re,{className:"w-8 h-8 text-yellow-500"})]})})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:0===a.length?e.jsx(I,{children:e.jsxs(B,{className:"pt-12 pb-12 text-center",children:[e.jsx(H,{className:"w-12 h-12 text-text-secondary mx-auto mb-4"}),e.jsx("p",{className:"text-text-secondary mb-4",children:"No goals set yet"}),e.jsxs(_,{onClick:E,children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Create First Goal"]})]})}):a.map(s=>{const t=s.progress_percentage||(e=>{if(!e.target_value||!e.current_value)return 0;const s=parseFloat(e.current_value),t=parseFloat(e.target_value),a=parseFloat(e.current_value);return"weight"===e.goal_type&&s>t?Math.min(100,Math.max(0,(s-a)/(s-t)*100)):Math.min(100,Math.max(0,(a-s)/(t-s)*100))})(s),a=b(s.target_date),l=a<0&&"active"===s.status;return e.jsx(I,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(B,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[C(s.status),e.jsx("h3",{className:"font-semibold text-lg",children:s.title}),e.jsx(N,{variant:"completed"===s.status?"success":"active"===s.status?"default":"secondary",children:s.status}),e.jsxs(N,{variant:"outline",className:S(s.priority),children:[s.priority," priority"]})]}),s.description&&e.jsx("p",{className:"text-sm text-text-secondary mb-3",children:s.description})]}),e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>P(s),children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"View"]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-text-secondary",children:"Progress"}),e.jsxs("span",{className:"font-semibold",children:[Math.round(t),"%"]})]}),e.jsx(Is,{value:t,className:"h-2"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Current"}),e.jsxs("p",{className:"text-sm font-semibold",children:[s.current_value," ",s.unit]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Target"}),e.jsxs("p",{className:"text-sm font-semibold",children:[s.target_value," ",s.unit]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-text-secondary",children:l?"Overdue by":"Days left"}),e.jsxs("p",{className:"text-sm font-semibold "+(l?"text-red-600":""),children:[Math.abs(a)," days"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-text-secondary",children:"Deadline"}),e.jsx("p",{className:"text-sm font-semibold",children:ue(new Date(s.target_date),"MMM dd")})]})]}),"active"===s.status&&e.jsxs("div",{className:"flex gap-2 mt-4 pt-4 border-t",children:[e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>v(s.id,"paused"),children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Pause"]}),e.jsxs(_,{variant:"default",size:"sm",onClick:()=>v(s.id,"completed"),children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Mark Complete"]})]})]})},s.id)})}),e.jsx(ks,{open:n,onOpenChange:c,children:e.jsxs(Cs,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ss,{children:[e.jsx(Ms,{children:d?"Create New Goal":"Goal Details"}),e.jsx(As,{children:d?"Set a SMART goal for your client":"View and manage goal progress"})]}),d?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Goal Type"}),e.jsxs(Bs,{value:p.goal_type,onValueChange:e=>j({...p,goal_type:e}),children:[e.jsx(Os,{children:e.jsx($s,{})}),e.jsxs(qs,{children:[e.jsx(Ws,{value:"weight",children:"Weight"}),e.jsx(Ws,{value:"body_fat",children:"Body Fat %"}),e.jsx(Ws,{value:"muscle_mass",children:"Muscle Mass"}),e.jsx(Ws,{value:"measurements",children:"Measurements"}),e.jsx(Ws,{value:"habit",children:"Habit Building"}),e.jsx(Ws,{value:"nutrition",children:"Nutrition Goal"}),e.jsx(Ws,{value:"fitness",children:"Fitness Goal"}),e.jsx(Ws,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Unit"}),e.jsx(A,{value:p.unit,onChange:e=>j({...p,unit:e.target.value}),placeholder:"kg, %, cm, etc."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Goal Title"}),e.jsx(A,{value:p.title,onChange:e=>j({...p,title:e.target.value}),placeholder:"e.g., Lose 10kg in 3 months"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Description"}),e.jsx(M,{value:p.description,onChange:e=>j({...p,description:e.target.value}),placeholder:"Detailed goal description...",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Current Value"}),e.jsx(A,{type:"number",step:"0.01",value:p.current_value,onChange:e=>j({...p,current_value:e.target.value}),placeholder:"75.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Target Value"}),e.jsx(A,{type:"number",step:"0.01",value:p.target_value,onChange:e=>j({...p,target_value:e.target.value}),placeholder:"65.0"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Start Date"}),e.jsx(A,{type:"date",value:p.start_date,onChange:e=>j({...p,start_date:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Target Date"}),e.jsx(A,{type:"date",value:p.target_date,onChange:e=>j({...p,target_date:e.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Difficulty"}),e.jsxs(Bs,{value:p.difficulty,onValueChange:e=>j({...p,difficulty:e}),children:[e.jsx(Os,{children:e.jsx($s,{})}),e.jsxs(qs,{children:[e.jsx(Ws,{value:"easy",children:"Easy"}),e.jsx(Ws,{value:"moderate",children:"Moderate"}),e.jsx(Ws,{value:"challenging",children:"Challenging"}),e.jsx(Ws,{value:"very_challenging",children:"Very Challenging"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Priority"}),e.jsxs(Bs,{value:p.priority,onValueChange:e=>j({...p,priority:e}),children:[e.jsx(Os,{children:e.jsx($s,{})}),e.jsxs(qs,{children:[e.jsx(Ws,{value:"low",children:"Low"}),e.jsx(Ws,{value:"medium",children:"Medium"}),e.jsx(Ws,{value:"high",children:"High"}),e.jsx(Ws,{value:"critical",children:"Critical"})]})]})]})]})]}):i&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[C(i.status),e.jsx("h3",{className:"font-bold text-xl",children:i.title}),e.jsx(N,{variant:"completed"===i.status?"success":"default",children:i.status})]}),i.description&&e.jsx("p",{className:"text-sm text-text-secondary",children:i.description})]}),u.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Progress Chart"}),e.jsx(Y,{width:"100%",height:300,children:e.jsxs(Q,{data:u,children:[e.jsx(Z,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"date"}),e.jsx(X,{}),e.jsx(ee,{}),e.jsx(De,{y:parseFloat(i.target_value),label:"Target",stroke:"green",strokeDasharray:"3 3"}),e.jsx(te,{type:"monotone",dataKey:"value",stroke:"#10b981",strokeWidth:2,dot:{r:4}})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("p",{className:"text-sm text-text-secondary mb-1",children:"Current Value"}),e.jsxs("p",{className:"text-2xl font-bold",children:[i.current_value," ",i.unit]})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("p",{className:"text-sm text-text-secondary mb-1",children:"Target Value"}),e.jsxs("p",{className:"text-2xl font-bold",children:[i.target_value," ",i.unit]})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("p",{className:"text-sm text-text-secondary mb-1",children:"Progress"}),e.jsxs("p",{className:"text-2xl font-bold",children:[i.progress_percentage||0,"%"]})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("p",{className:"text-sm text-text-secondary mb-1",children:"Days Remaining"}),e.jsxs("p",{className:"text-2xl font-bold",children:[b(i.target_date)," days"]})]})]})]}),e.jsx(Ps,{children:d?e.jsxs(e.Fragment,{children:[e.jsx(_,{variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsx(_,{onClick:async()=>{try{const{error:e}=await w.from("client_goals").insert({client_id:s,nutritionist_id:t.id,...p,target_value:parseFloat(p.target_value),current_value:parseFloat(p.current_value)});if(e)throw e;await w.rpc("create_notification",{p_user_id:s,p_type:"goal_milestone",p_title:"New Goal Set!",p_message:`Your nutritionist set a new goal: ${p.title}`,p_action_url:"/app/progress",p_priority:"normal"}),await f(),c(!1),k()}catch(e){alert("Failed to create goal")}},children:"Create Goal"})]}):e.jsx(_,{variant:"outline",onClick:()=>c(!1),children:"Close"})})]})})]})},At=({onSelectRecipe:s})=>{const{user:t}=y(),[a,l]=g.useState([]),[i,r]=g.useState([]),[n,c]=g.useState(""),[d,o]=g.useState("all"),[m,x]=g.useState(!1),[u,h]=g.useState(null),[p,j]=g.useState(!0),[f,v]=g.useState(!1),[b,k]=g.useState({name:"",description:"",category:"breakfast",servings:1,prep_time_minutes:0,cook_time_minutes:0,ingredients:[{name:"",amount:"",unit:""}],instructions:[""],calories_per_serving:0,protein_g:0,carbs_g:0,fat_g:0,fiber_g:0,tags:[],is_public:!1}),S=["breakfast","lunch","dinner","snack","dessert"];g.useEffect(()=>{P()},[t]),g.useEffect(()=>{E()},[n,d,a]);const P=async()=>{j(!0);try{const{data:e,error:s}=await w.from("recipes").select("*").or(`nutritionist_id.eq.${t.id},is_public.eq.true`).order("created_at",{ascending:!1});if(s)throw s;l(e||[])}catch(e){C({variant:"destructive",title:"Error",description:"Failed to fetch recipes"})}finally{j(!1)}},E=()=>{let e=a;n&&(e=e.filter(e=>{var s,t;return(null==(s=e.name)?void 0:s.toLowerCase().includes(n.toLowerCase()))||(null==(t=e.description)?void 0:t.toLowerCase().includes(n.toLowerCase()))})),"all"!==d&&(e=e.filter(e=>e.category===d)),r(e)},R=(e=null)=>{e?(h(e),k({...e,ingredients:e.ingredients||[{name:"",amount:"",unit:""}],instructions:e.instructions||[""],tags:e.tags||[]})):(h(null),k({name:"",description:"",category:"breakfast",servings:1,prep_time_minutes:0,cook_time_minutes:0,ingredients:[{name:"",amount:"",unit:""}],instructions:[""],calories_per_serving:0,protein_g:0,carbs_g:0,fat_g:0,fiber_g:0,tags:[],is_public:!1})),x(!0)},D=(e,s,t)=>{const a=[...b.ingredients];a[e][s]=t,k({...b,ingredients:a})},T=({recipe:a})=>{var l;return e.jsx(I,{className:"glass-effect hover:shadow-lg transition-all cursor-pointer group",children:e.jsxs(B,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",onClick:()=>s&&s(a),children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:a.description})]}),e.jsxs("div",{className:"flex gap-1 ml-2",children:[e.jsx(_,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),R(a)},children:e.jsx(ze,{className:"w-4 h-4"})}),a.nutritionist_id===t.id&&e.jsx(_,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),(async e=>{if(confirm("Are you sure you want to delete this recipe?"))try{const{error:s}=await w.from("recipes").delete().eq("id",e);if(s)throw s;C({title:"Recipe deleted successfully"}),P()}catch(s){C({variant:"destructive",title:"Error",description:"Failed to delete recipe"})}})(a.id)},className:"text-destructive hover:text-destructive",children:e.jsx(Le,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx(N,{variant:"outline",className:"capitalize",children:a.category}),null==(l=a.tags)?void 0:l.slice(0,2).map(s=>e.jsx(N,{variant:"secondary",children:s},s))]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:[(a.prep_time_minutes||0)+(a.cook_time_minutes||0)," min"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:[a.servings," servings"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Be,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:[a.calories_per_serving||0," cal"]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[a.protein_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Protein"})]}),e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[a.carbs_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Carbs"})]}),e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[a.fat_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Fat"})]}),e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[a.fiber_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Fiber"})]})]})]})})};return p?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(Te,{className:"w-8 h-8 text-primary"}),"Recipe Database"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Create and manage your recipe library"})]}),e.jsxs(_,{onClick:()=>R(),children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"New Recipe"]})]}),e.jsx(I,{className:"glass-effect",children:e.jsx(B,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(A,{placeholder:"Search recipes...",value:n,onChange:e=>c(e.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(_,{variant:"all"===d?"default":"outline",onClick:()=>o("all"),size:"sm",children:"All"}),S.map(s=>e.jsx(_,{variant:d===s?"default":"outline",onClick:()=>o(s),size:"sm",className:"capitalize",children:s},s))]})]})})}),i.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map(s=>e.jsx(T,{recipe:s},s.id))}):e.jsx(I,{className:"glass-effect",children:e.jsxs(B,{className:"p-12 text-center",children:[e.jsx(Te,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No recipes found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:n||"all"!==d?"Try adjusting your filters":"Create your first recipe to get started"}),e.jsxs(_,{onClick:()=>R(),children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Create Recipe"]})]})}),e.jsx(ks,{open:m,onOpenChange:x,children:e.jsxs(Cs,{className:"glass-effect custom-scrollbar max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ss,{children:e.jsx(Ms,{children:u?"Edit Recipe":"Create New Recipe"})}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Recipe Name *"}),e.jsx(A,{value:b.name,onChange:e=>k({...b,name:e.target.value}),placeholder:"e.g., Grilled Chicken Salad"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Description"}),e.jsx(M,{value:b.description,onChange:e=>k({...b,description:e.target.value}),placeholder:"Brief description of the recipe",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Category"}),e.jsx("select",{value:b.category,onChange:e=>k({...b,category:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:S.map(s=>e.jsx("option",{value:s,className:"capitalize",children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Servings"}),e.jsx(A,{type:"number",min:"1",value:b.servings,onChange:e=>k({...b,servings:parseInt(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Prep Time (min)"}),e.jsx(A,{type:"number",min:"0",value:b.prep_time_minutes,onChange:e=>k({...b,prep_time_minutes:parseInt(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Cook Time (min)"}),e.jsx(A,{type:"number",min:"0",value:b.cook_time_minutes,onChange:e=>k({...b,cook_time_minutes:parseInt(e.target.value)})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Nutrition (per serving)"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Calories"}),e.jsx(A,{type:"number",step:"0.1",value:b.calories_per_serving,onChange:e=>k({...b,calories_per_serving:parseFloat(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Protein (g)"}),e.jsx(A,{type:"number",step:"0.1",value:b.protein_g,onChange:e=>k({...b,protein_g:parseFloat(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Carbs (g)"}),e.jsx(A,{type:"number",step:"0.1",value:b.carbs_g,onChange:e=>k({...b,carbs_g:parseFloat(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Fat (g)"}),e.jsx(A,{type:"number",step:"0.1",value:b.fat_g,onChange:e=>k({...b,fat_g:parseFloat(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Fiber (g)"}),e.jsx(A,{type:"number",step:"0.1",value:b.fiber_g,onChange:e=>k({...b,fiber_g:parseFloat(e.target.value)})})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold",children:"Ingredients"}),e.jsxs(_,{onClick:()=>{k({...b,ingredients:[...b.ingredients,{name:"",amount:"",unit:""}]})},size:"sm",variant:"outline",children:[e.jsx(Ee,{className:"w-4 h-4 mr-1"}),"Add"]})]}),e.jsx("div",{className:"space-y-2",children:b.ingredients.map((s,t)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{placeholder:"Ingredient name",value:s.name,onChange:e=>D(t,"name",e.target.value),className:"flex-1"}),e.jsx(A,{placeholder:"Amount",value:s.amount,onChange:e=>D(t,"amount",e.target.value),className:"w-24"}),e.jsx(A,{placeholder:"Unit",value:s.unit,onChange:e=>D(t,"unit",e.target.value),className:"w-24"}),e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>(e=>{k({...b,ingredients:b.ingredients.filter((s,t)=>t!==e)})})(t),disabled:1===b.ingredients.length,children:e.jsx(Fe,{className:"w-4 h-4"})})]},t))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold",children:"Instructions"}),e.jsxs(_,{onClick:()=>{k({...b,instructions:[...b.instructions,""]})},size:"sm",variant:"outline",children:[e.jsx(Ee,{className:"w-4 h-4 mr-1"}),"Add Step"]})]}),e.jsx("div",{className:"space-y-2",children:b.instructions.map((s,t)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-sm font-medium text-muted-foreground pt-2",children:[t+1,"."]}),e.jsx(M,{placeholder:"Instruction step",value:s,onChange:e=>((e,s)=>{const t=[...b.instructions];t[e]=s,k({...b,instructions:t})})(t,e.target.value),rows:2,className:"flex-1"}),e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>(e=>{k({...b,instructions:b.instructions.filter((s,t)=>t!==e)})})(t),disabled:1===b.instructions.length,children:e.jsx(Fe,{className:"w-4 h-4"})})]},t))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["vegetarian","vegan","gluten-free","dairy-free","high-protein","low-carb","keto","paleo"].map(s=>e.jsx(N,{variant:b.tags.includes(s)?"default":"outline",className:"cursor-pointer",onClick:()=>(e=>{const s=b.tags.includes(e)?b.tags.filter(s=>s!==e):[...b.tags,e];k({...b,tags:s})})(s),children:s},s))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"is_public",checked:b.is_public,onChange:e=>k({...b,is_public:e.target.checked}),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"is_public",className:"text-sm font-medium",children:"Make this recipe public (visible to other nutritionists)"})]})]}),e.jsxs(Ps,{children:[e.jsx(_,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsxs(_,{onClick:async()=>{if(b.name){v(!0);try{const e={...b,nutritionist_id:t.id,ingredients:b.ingredients.filter(e=>e.name),instructions:b.instructions.filter(e=>e.trim())};if(u){const{error:s}=await w.from("recipes").update(e).eq("id",u.id);if(s)throw s;C({title:"Recipe updated successfully"})}else{const{error:s}=await w.from("recipes").insert(e);if(s)throw s;C({title:"Recipe created successfully"})}x(!1),P()}catch(e){C({variant:"destructive",title:"Error",description:"Failed to save recipe"})}finally{v(!1)}}else C({variant:"destructive",title:"Error",description:"Recipe name is required"})},disabled:f,children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),f?"Saving...":"Save Recipe"]})]})]})})]})},Pt=()=>{const{user:s}=y(),[t,a]=g.useState([]),[l,i]=g.useState([]),[r,n]=g.useState([]),[c,d]=g.useState([]),[o,m]=g.useState(""),[x,u]=g.useState("all"),[h,p]=g.useState(!1),[j,f]=g.useState(null),[v,b]=g.useState(!0),[k,S]=g.useState(!1),[P,E]=g.useState(!1),[R,D]=g.useState(null),[T,F]=g.useState(null),[O,$]=g.useState(!1),[q,W]=g.useState(null),[V,G]=g.useState({client_id:"",name:"",description:"",start_date:"",end_date:"",target_calories:2e3,target_protein_g:150,target_carbs_g:200,target_fat_g:60,meal_schedule:{},notes:"",status:"active"}),K=["breakfast","lunch","dinner","snack"];g.useEffect(()=>{Y(),Q(),Z()},[s]),g.useEffect(()=>{J()},[o,x,t]);const Y=async()=>{b(!0);try{const{data:e,error:t}=await w.from("meal_plans_v2").select("\n          *,\n          client:user_profiles!meal_plans_v2_client_id_fkey(id, full_name, email)\n        ").eq("nutritionist_id",s.id).order("created_at",{ascending:!1});if(t)throw t;a(e||[])}catch(e){C({variant:"destructive",title:"Error",description:"Failed to fetch meal plans"})}finally{b(!1)}},Q=async()=>{try{const{data:e,error:s}=await w.from("user_profiles").select("id, full_name, email").eq("role","user").order("full_name",{ascending:!0});if(s)throw s;n(e||[])}catch(e){}},Z=async()=>{try{const{data:e,error:s}=await w.from("tier_default_meal_plans").select("*").order("tier_name",{ascending:!0});if(s)throw s;i(e||[])}catch(e){}},J=()=>{let e=t;o&&(e=e.filter(e=>{var s,t,a;return(null==(s=e.name)?void 0:s.toLowerCase().includes(o.toLowerCase()))||(null==(a=null==(t=e.client)?void 0:t.full_name)?void 0:a.toLowerCase().includes(o.toLowerCase()))})),"all"!==x&&(e=e.filter(e=>e.status===x)),d(e)},X=(e=null)=>{if(e)f(e),G({client_id:e.client_id,name:e.name,description:e.description||"",start_date:e.start_date,end_date:e.end_date,target_calories:e.target_calories||2e3,target_protein_g:e.target_protein_g||150,target_carbs_g:e.target_carbs_g||200,target_fat_g:e.target_fat_g||60,meal_schedule:e.meal_schedule||{},notes:e.notes||"",status:e.status});else{f(null);const e=(new Date).toISOString().split("T")[0],s=new Date(Date.now()+6048e5).toISOString().split("T")[0];G({client_id:"",name:"",description:"",start_date:e,end_date:s,target_calories:2e3,target_protein_g:150,target_carbs_g:200,target_fat_g:60,meal_schedule:{},notes:"",status:"active"})}p(!0)},ee=({plan:s})=>{const t=s.client,a=Math.ceil((new Date(s.end_date)-new Date(s.start_date))/864e5);return e.jsx(I,{className:"glass-effect hover:shadow-lg transition-all",children:e.jsxs(B,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(U,{className:"w-3 h-3"}),(null==t?void 0:t.full_name)||"Unknown Client"]})]}),e.jsx(N,{variant:"active"===s.status?"default":"secondary",children:s.status})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(he,{className:"w-4 h-4"}),"Duration:"]}),e.jsxs("span",{className:"font-medium",children:[a," days"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(H,{className:"w-4 h-4"}),"Daily Calories:"]}),e.jsxs("span",{className:"font-medium",children:[s.target_calories||0," kcal"]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4 text-xs",children:[e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[s.target_protein_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Protein"})]}),e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[s.target_carbs_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Carbs"})]}),e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[s.target_fat_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Fat"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>X(s),className:"flex-1",children:[e.jsx(ze,{className:"w-4 h-4 mr-1"}),"Edit"]}),e.jsx(_,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this meal plan?"))try{const{error:s}=await w.from("meal_plans_v2").delete().eq("id",e);if(s)throw s;C({title:"Meal plan deleted successfully"}),Y()}catch(s){C({variant:"destructive",title:"Error",description:"Failed to delete meal plan"})}})(s.id),className:"text-destructive",children:e.jsx(Le,{className:"w-4 h-4"})})]})]})})};return v?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(le,{className:"w-8 h-8 text-primary"}),"Meal Planning"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Create and manage personalized meal plans"})]}),e.jsxs(_,{onClick:()=>X(),children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"New Meal Plan"]})]}),e.jsx(I,{className:"glass-effect",children:e.jsx(B,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(A,{placeholder:"Search meal plans...",value:o,onChange:e=>m(e.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(_,{variant:"all"===x?"default":"outline",onClick:()=>u("all"),size:"sm",children:["All (",t.length,")"]}),e.jsx(_,{variant:"active"===x?"default":"outline",onClick:()=>u("active"),size:"sm",children:"Active"}),e.jsx(_,{variant:"completed"===x?"default":"outline",onClick:()=>u("completed"),size:"sm",children:"Completed"}),e.jsx(_,{variant:"archived"===x?"default":"outline",onClick:()=>u("archived"),size:"sm",children:"Archived"})]})]})})}),e.jsxs(I,{className:"glass-effect",children:[e.jsxs(z,{children:[e.jsxs(L,{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Meal Plan Templates"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pre-made meal plans for each tier that you can assign to clients"})]}),e.jsx(B,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:l.map(s=>e.jsx(I,{className:"border-2 hover:border-primary transition-colors",children:e.jsxs(B,{className:"p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx(N,{variant:"Base"===s.tier_name?"secondary":("Premium"===s.tier_name||s.tier_name,"default"),children:s.tier_name})}),e.jsx("h4",{className:"font-semibold text-sm mb-1",children:s.plan_name}),e.jsx("p",{className:"text-xs text-muted-foreground mb-3 line-clamp-2",children:s.description}),e.jsxs("div",{className:"space-y-1 text-xs mb-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Duration:"}),e.jsxs("span",{className:"font-medium",children:[s.duration_days," days"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Calories:"}),e.jsxs("span",{className:"font-medium",children:[s.target_calories," kcal"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Protein:"}),e.jsxs("span",{className:"font-medium",children:[s.target_protein_g,"g"]})]})]}),e.jsxs(_,{size:"sm",className:"w-full",onClick:()=>{W(s),$(!0)},children:[e.jsx(U,{className:"w-3 h-3 mr-1"}),"Assign to Client"]})]})},s.id))})})]}),c.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map(s=>e.jsx(ee,{plan:s},s.id))}):e.jsx(I,{className:"glass-effect",children:e.jsxs(B,{className:"p-12 text-center",children:[e.jsx(le,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No meal plans found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:o||"all"!==x?"Try adjusting your filters":"Create your first meal plan to get started"}),e.jsxs(_,{onClick:()=>X(),children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Create Meal Plan"]})]})}),e.jsx(ks,{open:h,onOpenChange:p,children:e.jsxs(Cs,{className:"glass-effect custom-scrollbar max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ss,{children:e.jsx(Ms,{children:j?"Edit Meal Plan":"Create New Meal Plan"})}),e.jsxs(Ns,{defaultValue:"basic",className:"mt-4",children:[e.jsxs(ys,{className:"grid w-full grid-cols-3",children:[e.jsx(ws,{value:"basic",children:"Basic Info"}),e.jsx(ws,{value:"schedule",children:"Meal Schedule"}),e.jsx(ws,{value:"targets",children:"Nutrition Targets"})]}),e.jsx(_s,{value:"basic",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Client *"}),e.jsxs("select",{value:V.client_id,onChange:e=>G({...V,client_id:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"",children:"Select a client"}),r.map(s=>e.jsxs("option",{value:s.id,children:[s.full_name," (",s.email,")"]},s.id))]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Plan Name *"}),e.jsx(A,{value:V.name,onChange:e=>G({...V,name:e.target.value}),placeholder:"e.g., Weight Loss Plan - Week 1"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Description"}),e.jsx(M,{value:V.description,onChange:e=>G({...V,description:e.target.value}),placeholder:"Brief description of the meal plan goals and approach",rows:3})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Start Date *"}),e.jsx(A,{type:"date",value:V.start_date,onChange:e=>G({...V,start_date:e.target.value}),className:"w-full min-w-0"})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"End Date *"}),e.jsx(A,{type:"date",value:V.end_date,onChange:e=>G({...V,end_date:e.target.value}),className:"w-full min-w-0"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Notes"}),e.jsx(M,{value:V.notes,onChange:e=>G({...V,notes:e.target.value}),placeholder:"Additional notes, instructions, or guidelines",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Status"}),e.jsxs("select",{value:V.status,onChange:e=>G({...V,status:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"archived",children:"Archived"})]})]})]})}),e.jsxs(_s,{value:"schedule",className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground mb-4",children:"Click on a meal slot to assign a recipe from your database"}),e.jsx("div",{className:"space-y-4",children:["monday","tuesday","wednesday","thursday","friday","saturday","sunday"].map(s=>e.jsxs("div",{className:"border border-border rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold capitalize mb-3",children:s}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:K.map(t=>{var a,l;return e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>((e,s)=>{D(e),F(s),E(!0)})(s,t),className:"h-auto py-3 flex flex-col items-start",children:[e.jsx("span",{className:"text-xs text-muted-foreground capitalize",children:t}),e.jsx("span",{className:"text-xs mt-1",children:(null==(l=null==(a=V.meal_schedule)?void 0:a[s])?void 0:l[t])?" Assigned":"+ Add Recipe"})]},t)})})]},s))})]}),e.jsxs(_s,{value:"targets",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Daily Calories Target"}),e.jsx(A,{type:"number",value:V.target_calories,onChange:e=>G({...V,target_calories:parseInt(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Protein Target (g)"}),e.jsx(A,{type:"number",value:V.target_protein_g,onChange:e=>G({...V,target_protein_g:parseInt(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Carbs Target (g)"}),e.jsx(A,{type:"number",value:V.target_carbs_g,onChange:e=>G({...V,target_carbs_g:parseInt(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Fat Target (g)"}),e.jsx(A,{type:"number",value:V.target_fat_g,onChange:e=>G({...V,target_fat_g:parseInt(e.target.value)})})]})]}),e.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Macro Distribution"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Protein"}),e.jsxs("p",{className:"font-semibold",children:[(4*V.target_protein_g/V.target_calories*100).toFixed(0),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Carbs"}),e.jsxs("p",{className:"font-semibold",children:[(4*V.target_carbs_g/V.target_calories*100).toFixed(0),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Fat"}),e.jsxs("p",{className:"font-semibold",children:[(9*V.target_fat_g/V.target_calories*100).toFixed(0),"%"]})]})]})]})]})]}),e.jsxs(Ps,{className:"mt-6",children:[e.jsx(_,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsxs(_,{onClick:async()=>{if(V.client_id&&V.name&&V.start_date&&V.end_date){S(!0);try{const e={...V,nutritionist_id:s.id};if(j){const{error:s}=await w.from("meal_plans_v2").update(e).eq("id",j.id);if(s)throw s;C({title:"Meal plan updated successfully"})}else{const{error:s}=await w.from("meal_plans_v2").insert(e);if(s)throw s;C({title:"Meal plan created successfully"})}p(!1),Y()}catch(e){C({variant:"destructive",title:"Error",description:"Failed to save meal plan"})}finally{S(!1)}}else C({variant:"destructive",title:"Error",description:"Please fill in all required fields"})},disabled:k,children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),k?"Saving...":"Save Meal Plan"]})]})]})}),e.jsx(ks,{open:P,onOpenChange:E,children:e.jsxs(Cs,{className:"glass-effect custom-scrollbar max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ss,{children:e.jsxs(Ms,{children:["Select Recipe for ",R&&T&&e.jsxs("span",{className:"capitalize",children:[R," - ",T]})]})}),e.jsx(At,{onSelectRecipe:e=>{if(R&&T){const s={...V.meal_schedule};s[R]||(s[R]={}),s[R][T]=e.id,G({...V,meal_schedule:s}),E(!1),D(null),F(null),C({title:"Recipe added to meal plan"})}}})]})}),e.jsx(ks,{open:O,onOpenChange:$,children:e.jsxs(Cs,{className:"glass-effect",children:[e.jsx(Ss,{children:e.jsx(Ms,{children:"Assign Meal Plan Template"})}),q&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(N,{children:q.tier_name}),e.jsx("h3",{className:"font-semibold",children:q.plan_name})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:q.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Duration:"}),e.jsxs("span",{className:"font-medium ml-2",children:[q.duration_days," days"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Calories:"}),e.jsxs("span",{className:"font-medium ml-2",children:[q.target_calories," kcal"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Protein:"}),e.jsxs("span",{className:"font-medium ml-2",children:[q.target_protein_g,"g"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Carbs:"}),e.jsxs("span",{className:"font-medium ml-2",children:[q.target_carbs_g,"g"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Fat:"}),e.jsxs("span",{className:"font-medium ml-2",children:[q.target_fat_g,"g"]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Select Client"}),e.jsxs("select",{id:"client-select",className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"",children:"Choose a client"}),r.map(s=>e.jsxs("option",{value:s.id,children:[s.full_name," (",s.email,")"]},s.id))]})]}),e.jsxs(Ps,{children:[e.jsx(_,{variant:"outline",onClick:()=>$(!1),children:"Cancel"}),e.jsx(_,{onClick:()=>{(async e=>{if(q&&e){S(!0);try{const{error:s}=await w.from("ai_meal_plans").insert({user_id:e,plan_name:q.plan_name,plan_description:q.description,duration_days:q.duration_days,daily_meals:q.meal_structure,target_calories:q.target_calories,target_protein_g:q.target_protein_g,target_carbs_g:q.target_carbs_g,target_fat_g:q.target_fat_g,tier_name:q.tier_name});if(s)throw s;C({title:"Success",description:"Meal plan template assigned to client"}),$(!1),W(null)}catch(s){C({variant:"destructive",title:"Error",description:"Failed to assign meal plan template"})}finally{S(!1)}}else C({variant:"destructive",title:"Error",description:"Please select a client"})})(document.getElementById("client-select").value)},disabled:k,children:k?"Assigning...":"Assign to Client"})]})]})]})})]})},Et=()=>{const{user:s}=y(),[t,a]=g.useState([]),[l,i]=g.useState([]),[r,n]=g.useState(new Date),[c,d]=g.useState(new Date),[o,m]=g.useState(!1),[x,u]=g.useState(null),[h,p]=g.useState(!0),[j,f]=g.useState(!1);g.useState("month");const[v,b]=g.useState({client_id:"",title:"",description:"",appointment_date:"",appointment_time:"",duration_minutes:60,consultation_type:"follow_up",meeting_link:"",status:"scheduled",notes:""}),k=[{value:"scheduled",label:"Scheduled",color:"bg-blue-500"},{value:"completed",label:"Completed",color:"bg-green-500"},{value:"cancelled",label:"Cancelled",color:"bg-red-500"},{value:"no_show",label:"No Show",color:"bg-gray-500"}];g.useEffect(()=>{S(),P()},[s,r]);const S=async()=>{p(!0);try{const e=Oe(r),t=$e(r),{data:l,error:i}=await w.from("appointments").select("\n          *,\n          client:user_profiles!appointments_client_id_fkey(id, full_name, email)\n        ").eq("nutritionist_id",s.id).gte("appointment_date",e.toISOString()).lte("appointment_date",t.toISOString()).order("appointment_date",{ascending:!0});if(i)throw i;a(l||[])}catch(e){C({variant:"destructive",title:"Error",description:"Failed to fetch appointments"})}finally{p(!1)}},P=async()=>{try{const{data:e,error:s}=await w.from("user_profiles").select("id, full_name, email").eq("role","user").order("full_name",{ascending:!0});if(s)throw s;i(e||[])}catch(e){}},E=(e=null,s=null)=>{if(e){const s=new Date(e.appointment_date);u(e),b({client_id:e.client_id,title:e.title,description:e.description||"",appointment_date:ue(s,"yyyy-MM-dd"),appointment_time:ue(s,"HH:mm"),duration_minutes:e.duration_minutes||60,consultation_type:e.consultation_type||"follow_up",meeting_link:e.meeting_link||"",status:e.status||"scheduled",notes:e.notes||""})}else{const e=s||c;u(null),b({client_id:"",title:"",description:"",appointment_date:ue(e,"yyyy-MM-dd"),appointment_time:"10:00",duration_minutes:60,consultation_type:"follow_up",meeting_link:"",status:"scheduled",notes:""})}m(!0)},R=e=>t.filter(s=>Ge(Ke(s.appointment_date),e)),D=({appointment:s,compact:t=!1})=>{var a;const l=k.find(e=>e.value===s.status),i=new Date(s.appointment_date);return t?e.jsxs("div",{onClick:()=>E(s),className:"text-xs p-1 mb-1 rounded cursor-pointer hover:opacity-80 transition-opacity truncate",style:{backgroundColor:(null==l?void 0:l.color.replace("bg-",""))+"30"},children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:ue(i,"h:mm a")})]}),e.jsx("div",{className:"truncate",children:s.title})]}):e.jsx(I,{className:"glass-effect hover:shadow-lg transition-all",children:e.jsxs(B,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(me,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm font-semibold",children:[ue(i,"MMM d, yyyy")," at ",ue(i,"h:mm a")]})]}),e.jsx("h3",{className:"font-semibold text-lg",children:s.title}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(Ze,{className:"w-3 h-3"}),(null==(a=s.client)?void 0:a.full_name)||"Unknown Client"]})]}),e.jsx(N,{variant:"completed"===s.status?"default":"secondary",children:null==l?void 0:l.label})]}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Duration: ",s.duration_minutes," min"]}),s.meeting_link&&e.jsxs("span",{className:"flex items-center gap-1 text-primary",children:[e.jsx(be,{className:"w-4 h-4"}),"Video call"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{variant:"outline",size:"sm",onClick:()=>E(s),children:e.jsx(ze,{className:"w-4 h-4"})}),e.jsx(_,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this appointment?"))try{const{error:s}=await w.from("appointments").delete().eq("id",e);if(s)throw s;C({title:"Appointment deleted successfully"}),S()}catch(s){C({variant:"destructive",title:"Error",description:"Failed to delete appointment"})}})(s.id),className:"text-destructive",children:e.jsx(Le,{className:"w-4 h-4"})})]})]})]})})};return h?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(qe,{className:"w-12 h-12 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(he,{className:"w-8 h-8 text-primary"}),"Schedule"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your appointments and consultations"})]}),e.jsxs(_,{onClick:()=>E(),children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"New Appointment"]})]}),e.jsxs(I,{className:"glass-effect",children:[e.jsx(z,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(_,{variant:"outline",size:"sm",onClick:()=>n(Ye(r,1)),children:e.jsx(We,{className:"w-4 h-4"})}),e.jsx("h3",{className:"text-xl font-semibold min-w-[200px] text-center",children:ue(r,"MMMM yyyy")}),e.jsx(_,{variant:"outline",size:"sm",onClick:()=>n(Qe(r,1)),children:e.jsx(Ve,{className:"w-4 h-4"})})]}),e.jsx(_,{variant:"outline",size:"sm",onClick:()=>n(new Date),children:"Today"})]})}),e.jsx(B,{children:e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(s=>e.jsx("div",{className:"text-center font-semibold text-sm py-2",children:s},s)),(()=>{const e=Oe(r),s=$e(r);return He({start:e,end:s})})().map(s=>{const t=R(s),a=Ge(s,c),l=Ue(s);return e.jsxs("div",{onClick:()=>d(s),className:`min-h-[100px] p-2 border rounded-lg cursor-pointer transition-colors ${a?"border-primary bg-primary/10":"border-border hover:bg-muted/50"} ${l?"bg-primary/5":""}`,children:[e.jsx("div",{className:"text-sm font-semibold mb-1 "+(l?"text-primary":""),children:ue(s,"d")}),e.jsxs("div",{className:"space-y-1",children:[t.slice(0,2).map(s=>e.jsx(D,{appointment:s,compact:!0},s.id)),t.length>2&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["+",t.length-2," more"]})]})]},s.toISOString())})]})})]}),e.jsxs(I,{className:"glass-effect",children:[e.jsx(z,{children:e.jsxs(L,{children:["Appointments for ",ue(c,"EEEE, MMMM d, yyyy")]})}),e.jsx(B,{children:R(c).length>0?e.jsx("div",{className:"space-y-4",children:R(c).map(s=>e.jsx(D,{appointment:s},s.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(he,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No appointments scheduled for this date"}),e.jsxs(_,{variant:"outline",onClick:()=>E(null,c),className:"mt-4",children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Schedule Appointment"]})]})})]}),e.jsx(ks,{open:o,onOpenChange:m,children:e.jsxs(Cs,{className:"glass-effect custom-scrollbar max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ss,{children:e.jsx(Ms,{children:x?"Edit Appointment":"New Appointment"})}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Client *"}),e.jsxs("select",{value:v.client_id,onChange:e=>b({...v,client_id:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"",children:"Select a client"}),l.map(s=>e.jsxs("option",{value:s.id,children:[s.full_name," (",s.email,")"]},s.id))]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Title *"}),e.jsx(A,{value:v.title,onChange:e=>b({...v,title:e.target.value}),placeholder:"e.g., Initial Consultation"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Description"}),e.jsx(M,{value:v.description,onChange:e=>b({...v,description:e.target.value}),placeholder:"Brief description of the appointment",rows:3})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Date *"}),e.jsx(A,{type:"date",value:v.appointment_date,onChange:e=>b({...v,appointment_date:e.target.value}),className:"w-full min-w-0"})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Time *"}),e.jsx(A,{type:"time",value:v.appointment_time,onChange:e=>b({...v,appointment_time:e.target.value}),className:"w-full min-w-0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Duration (minutes)"}),e.jsx(A,{type:"number",min:"15",step:"15",value:v.duration_minutes,onChange:e=>b({...v,duration_minutes:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Type"}),e.jsx("select",{value:v.consultation_type,onChange:e=>b({...v,consultation_type:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[{value:"initial",label:"Initial Consultation"},{value:"follow_up",label:"Follow-up"},{value:"check_in",label:"Check-in"}].map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Status"}),e.jsx("select",{value:v.status,onChange:e=>b({...v,status:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:k.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Meeting Link (optional)"}),e.jsx(A,{value:v.meeting_link,onChange:e=>b({...v,meeting_link:e.target.value}),placeholder:"https://zoom.us/j/..."})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Notes"}),e.jsx(M,{value:v.notes,onChange:e=>b({...v,notes:e.target.value}),placeholder:"Additional notes about this appointment",rows:3})]})]})}),e.jsxs(Ps,{children:[e.jsx(_,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(_,{onClick:async()=>{if(v.client_id&&v.title&&v.appointment_date&&v.appointment_time){f(!0);try{const e=new Date(`${v.appointment_date}T${v.appointment_time}`),t={nutritionist_id:s.id,client_id:v.client_id,title:v.title,description:v.description,appointment_date:e.toISOString(),duration_minutes:parseInt(v.duration_minutes),consultation_type:v.consultation_type,meeting_link:v.meeting_link,status:v.status,notes:v.notes};if(x){const{error:e}=await w.from("appointments").update(t).eq("id",x.id);if(e)throw e;C({title:"Appointment updated successfully"})}else{const{error:e}=await w.from("appointments").insert(t);if(e)throw e;C({title:"Appointment created successfully"})}m(!1),S()}catch(e){C({variant:"destructive",title:"Error",description:"Failed to save appointment"})}finally{f(!1)}}else C({variant:"destructive",title:"Error",description:"Please fill in all required fields"})},disabled:j,children:j?e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Save Appointment"]})})]})]})})]})},Rt=()=>{var s,t,a;const{user:l}=y(),[i]=v(),[r,n]=g.useState([]),[c,d]=g.useState([]),[o,m]=g.useState(null),[x,u]=g.useState([]),[h,p]=g.useState(""),[j,f]=g.useState(""),[b,k]=g.useState(!0),[S,P]=g.useState(!1),[E,R]=g.useState(!1),[D,T]=g.useState(""),[F,L]=g.useState(""),[O]=g.useState(new Audio("data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuEzvLaizsIGmi77eamUBELTKXh8bllHAU2jdXyzn0vBSR2xe/glEILElyx6OyrWBQLRp3e8cFuJAUpgs/z3I4+CRhnvO7op1YSCEE="));g.useEffect(()=>{if(q(),W(),null==l?void 0:l.id){const e=w.channel("nutritionist_messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`recipient_id=eq.${l.id}`},e=>{O.play().catch(e=>{}),C({title:"New Message",description:"You received a new message from a client"}),W(),o&&e.new.sender_id===o.partnerId&&G(o)}).subscribe();return()=>{w.removeChannel(e)}}},[l]),g.useEffect(()=>{o&&(G(o),U(o))},[o]);const $=g.useRef(!1);g.useEffect(()=>{const e=i.get("conversation");if(e&&c.length>0&&!$.current){const s=c.find(s=>s.partnerId===e);s&&($.current=!0,m(s))}},[c.length,i]);const q=async()=>{try{const{data:e,error:s}=await w.from("user_profiles").select("id, full_name, email, profile_picture_url").eq("role","user").order("full_name",{ascending:!0});if(s)throw s;n(e||[])}catch(e){}},W=async()=>{k(!0);try{let e=w.from("messages").select("*").or(`sender_id.eq.${l.id},recipient_id.eq.${l.id}`).order("created_at",{ascending:!1});const{data:s,error:t}=await e;if(t)return d([]),void k(!1);if(s&&s.length>0){const e=new Set;s.forEach(s=>{s.sender_id&&e.add(s.sender_id),s.recipient_id&&e.add(s.recipient_id)});const{data:t,error:a}=await w.from("user_profiles").select("id, full_name, email, profile_picture_url").in("id",Array.from(e));if(!a&&t){const e=new Map(t.map(e=>[e.id,e])),a=s.map(s=>({...s,sender:e.get(s.sender_id),recipient:e.get(s.recipient_id)}));V(a)}else V(s)}else d([]),k(!1)}catch(e){d([]),k(!1)}},V=e=>{try{const s=new Map;(e||[]).forEach(e=>{const t=e.sender_id===l.id?e.recipient_id:e.sender_id,a=e.sender_id===l.id?e.recipient:e.sender;s.has(t)||s.set(t,{partnerId:t,partner:a,lastMessage:e,unreadCount:0}),e.recipient_id!==l.id||e.is_read||s.get(t).unreadCount++}),d(Array.from(s.values()))}catch(s){d([])}finally{k(!1)}},G=async e=>{try{const s=e.partnerId,{data:t,error:a}=await w.from("messages").select("*").or(`and(sender_id.eq.${l.id},recipient_id.eq.${s}),and(sender_id.eq.${s},recipient_id.eq.${l.id})`).order("created_at",{ascending:!0});if(a)return void u([]);if(t&&t.length>0){const e=new Set([l.id,s]),{data:a,error:i}=await w.from("user_profiles").select("id, full_name, email, profile_picture_url").in("id",Array.from(e));if(!i&&a){const e=new Map(a.map(e=>[e.id,e])),s=t.map(s=>({...s,sender:e.get(s.sender_id),recipient:e.get(s.recipient_id)}));u(s)}else u(t)}else u([])}catch(s){u([])}},U=async e=>{try{const{error:s}=await w.from("messages").update({is_read:!0}).eq("sender_id",e.partnerId).eq("recipient_id",l.id).eq("is_read",!1);if(s)throw s;W()}catch(s){}},H=async()=>{if(h.trim()&&o){P(!0);try{const{error:e}=await w.from("messages").insert({sender_id:l.id,recipient_id:o.partnerId,message_text:h.trim(),is_read:!1});if(e)throw e;p(""),await G(o),await W()}catch(e){C({variant:"destructive",title:"Error",description:"Failed to send message"})}finally{P(!1)}}},K=c.filter(e=>{var s,t,a,l;return(null==(t=null==(s=e.partner)?void 0:s.full_name)?void 0:t.toLowerCase().includes(j.toLowerCase()))||(null==(l=null==(a=e.partner)?void 0:a.email)?void 0:l.toLowerCase().includes(j.toLowerCase()))}),Y=({conversation:s})=>{var t,a;return e.jsx("div",{onClick:()=>m(s),className:"p-4 border-b border-border cursor-pointer hover:bg-muted/50 transition-colors "+((null==o?void 0:o.partnerId)===s.partnerId?"bg-muted":""),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:(null==(t=s.partner)?void 0:t.profile_picture_url)?e.jsx("img",{src:s.partner.profile_picture_url,alt:s.partner.full_name,className:"w-12 h-12 rounded-full object-cover"}):e.jsx(Ze,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h4",{className:"font-semibold text-sm truncate",children:(null==(a=s.partner)?void 0:a.full_name)||"Unknown"}),e.jsx("span",{className:"text-xs text-muted-foreground flex-shrink-0 ml-2",children:ue(new Date(s.lastMessage.created_at),"MMM d")})]}),e.jsx("p",{className:"text-sm truncate "+(s.unreadCount>0?"font-semibold":"text-muted-foreground"),children:s.lastMessage.message_text}),s.unreadCount>0&&e.jsxs(N,{variant:"default",className:"mt-1",children:[s.unreadCount," new"]})]})]})})},Q=({message:s})=>{var t,a;const i=s.sender_id===l.id;return e.jsx("div",{className:`flex ${i?"justify-end":"justify-start"} mb-4`,children:e.jsxs("div",{className:"max-w-[70%] "+(i?"order-2":"order-1"),children:[!i&&e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center",children:(null==(t=s.sender)?void 0:t.profile_picture_url)?e.jsx("img",{src:s.sender.profile_picture_url,alt:s.sender.full_name,className:"w-6 h-6 rounded-full object-cover"}):e.jsx(Ze,{className:"w-3 h-3 text-primary"})}),e.jsx("span",{className:"text-xs text-muted-foreground",children:null==(a=s.sender)?void 0:a.full_name})]}),e.jsxs("div",{className:"rounded-lg p-3 "+(i?"bg-primary text-primary-foreground":"bg-muted"),children:[e.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:s.message_text}),e.jsxs("div",{className:"flex items-center justify-end gap-1 mt-1 "+(i?"text-primary-foreground/70":"text-muted-foreground"),children:[e.jsx("span",{className:"text-xs",children:ue(new Date(s.created_at),"h:mm a")}),i&&(s.is_read?e.jsx(ss,{className:"w-3 h-3"}):e.jsx(ts,{className:"w-3 h-3"}))]})]})]})})};return b?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(qe,{className:"w-12 h-12 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(ve,{className:"w-8 h-8 text-primary"}),"Messages",c.reduce((e,s)=>e+(s.unreadCount||0),0)>0&&e.jsxs(N,{variant:"destructive",className:"ml-2 text-sm",children:[c.reduce((e,s)=>e+(s.unreadCount||0),0)," unread"]})]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Communicate with your clients"})]}),e.jsxs(_,{onClick:()=>R(!0),children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"New Message"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(I,{className:"glass-effect lg:col-span-1",children:[e.jsx(z,{className:"pb-3",children:e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(A,{placeholder:"Search conversations...",value:j,onChange:e=>f(e.target.value),className:"pl-10"})]})}),e.jsx(B,{className:"p-0",children:e.jsx("div",{className:"max-h-[600px] overflow-y-auto",children:K.length>0?K.map(s=>e.jsx(Y,{conversation:s},s.partnerId)):e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx(ve,{className:"w-12 h-12 mx-auto text-muted-foreground mb-3 opacity-50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:j?"No conversations found":"No messages yet"}),e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>R(!0),className:"mt-3",children:[e.jsx(Ee,{className:"w-4 h-4 mr-1"}),"Start a conversation"]})]})})})]}),e.jsx(I,{className:"glass-effect lg:col-span-2",children:o?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"border-b border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>m(null),className:"lg:hidden",children:e.jsx(Je,{className:"w-4 h-4"})}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:(null==(s=o.partner)?void 0:s.profile_picture_url)?e.jsx("img",{src:o.partner.profile_picture_url,alt:o.partner.full_name,className:"w-10 h-10 rounded-full object-cover"}):e.jsx(Ze,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:null==(t=o.partner)?void 0:t.full_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:null==(a=o.partner)?void 0:a.email})]})]})}),e.jsxs(B,{className:"p-0",children:[e.jsx("div",{className:"h-[450px] overflow-y-auto p-4",children:x.map(s=>e.jsx(Q,{message:s},s.id))}),e.jsxs("div",{className:"border-t border-border p-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{placeholder:"Type your message...",value:h,onChange:e=>p(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),H())},className:"min-h-[60px] resize-none"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(_,{variant:"outline",size:"icon",disabled:!0,title:"File attachment (coming soon)",children:e.jsx(Xe,{className:"w-4 h-4"})}),e.jsx(_,{onClick:H,disabled:!h.trim()||S,size:"icon",children:S?e.jsx(qe,{className:"w-4 h-4 animate-spin"}):e.jsx(es,{className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Press Enter to send, Shift+Enter for new line"})]})]})]}):e.jsx(B,{className:"flex items-center justify-center h-[600px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ve,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No conversation selected"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Choose a conversation from the list or start a new one"}),e.jsxs(_,{onClick:()=>R(!0),children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"New Message"]})]})})})]}),e.jsx(ks,{open:E,onOpenChange:R,children:e.jsxs(Cs,{className:"glass-effect custom-scrollbar max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ss,{children:e.jsx(Ms,{children:"New Message"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"To:"}),e.jsxs("select",{value:D,onChange:e=>T(e.target.value),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"",children:"Select a client"}),r.map(s=>e.jsxs("option",{value:s.id,children:[s.full_name," (",s.email,")"]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Message:"}),e.jsx(M,{value:F,onChange:e=>L(e.target.value),placeholder:"Type your message here...",rows:6})]})]}),e.jsxs(Ps,{children:[e.jsx(_,{variant:"outline",onClick:()=>R(!1),children:"Cancel"}),e.jsx(_,{onClick:async()=>{if(D&&F.trim()){P(!0);try{const{error:e}=await w.from("messages").insert({sender_id:l.id,recipient_id:D,message_text:F.trim(),is_read:!1});if(e)throw e;C({title:"Message sent",description:"Your message has been sent successfully"}),R(!1),T(""),L(""),await W()}catch(e){C({variant:"destructive",title:"Error",description:"Failed to send message"})}finally{P(!1)}}else C({variant:"destructive",title:"Error",description:"Please select a client and enter a message"})},disabled:S,children:S?e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(es,{className:"w-4 h-4 mr-2"}),"Send Message"]})})]})]})})]})},Dt=()=>{const{toast:s}=E(),[t,a]=g.useState(!0),[l,i]=g.useState(!1),[r,n]=g.useState("30"),[c,d]=g.useState({totalClients:0,activeClients:0,totalAppointments:0,completedAppointments:0,averageSuccessRate:0,totalRevenue:0}),[o,m]=g.useState([]),[x,u]=g.useState([]),[h,p]=g.useState([]),[j,f]=g.useState([]),[v,b]=g.useState([]),[N,y]=g.useState([]);g.useEffect(()=>{k()},[r]);const k=async()=>{a(!0);try{await Promise.all([C(),S(),M(),A(),P(),R(),D()])}catch(e){s({title:"Error",description:"Failed to load analytics data",variant:"destructive"})}finally{a(!1)}},C=async()=>{const e=new Date;e.setDate(e.getDate()-parseInt(r));const{data:s}=await w.from("user_profiles").select("id, role, created_at").eq("role","user"),t=(null==s?void 0:s.length)||0,a=(null==s?void 0:s.filter(s=>new Date(s.created_at)>=e).length)||0,{data:l}=await w.from("appointments").select("*").gte("appointment_date",e.toISOString()),i=(null==l?void 0:l.length)||0,n=(null==l?void 0:l.filter(e=>"completed"===e.status).length)||0,{data:c}=await w.from("client_progress").select("*").gte("date",e.toISOString()),o=(null==c?void 0:c.length)>0?c.filter(e=>e.weight_kg&&e.weight_kg>0).length/c.length*100:0;d({totalClients:t,activeClients:a,totalAppointments:i,completedAppointments:n,averageSuccessRate:Math.round(o),totalRevenue:75*i})},S=async()=>{const e=as(new Date,parseInt(r)),{data:s}=await w.from("client_progress").select("\n        *,\n        user_profiles!client_progress_user_id_fkey(full_name)\n      ").gte("date",e.toISOString()).order("date",{ascending:!0});if(s){const e=s.reduce((e,s)=>{const t=ue(new Date(s.date),"MMM dd");return e[t]||(e[t]={date:t,totalWeight:0,count:0}),s.weight_kg&&(e[t].totalWeight+=s.weight_kg,e[t].count+=1),e},{}),t=Object.values(e).map(e=>({date:e.date,avgWeight:e.count>0?(e.totalWeight/e.count).toFixed(1):0}));m(t)}},M=async()=>{const e=as(new Date,parseInt(r)),{data:s}=await w.from("appointments").select("*").gte("appointment_date",e.toISOString()).order("appointment_date",{ascending:!0});if(s){const e=s.reduce((e,s)=>{const t=ue(new Date(s.appointment_date),"MMM dd");return e[t]||(e[t]={date:t,scheduled:0,completed:0,cancelled:0}),"scheduled"===s.status&&(e[t].scheduled+=1),"completed"===s.status&&(e[t].completed+=1),"cancelled"===s.status&&(e[t].cancelled+=1),e},{});u(Object.values(e))}},A=async()=>{const{data:e}=await w.from("client_health_data").select("goals");if(e){const s=e.reduce((e,s)=>((s.goals||[]).forEach(s=>{e[s]=(e[s]||0)+1}),e),{}),t=Object.entries(s).map(([e,s])=>({name:e.replace("_"," ").toUpperCase(),value:s}));p(t)}},P=async()=>{const e=as(new Date,parseInt(r)),{data:s}=await w.from("habit_logs").select("\n        *,\n        client_habits!habit_logs_habit_id_fkey(habit_name)\n      ").gte("log_date",e.toISOString()).order("log_date",{ascending:!0});if(s){const e=s.reduce((e,s)=>{const t=ue(new Date(s.log_date),"MMM dd");return e[t]||(e[t]={date:t,total:0,completed:0}),e[t].total+=1,s.completed&&(e[t].completed+=1),e},{}),t=Object.values(e).map(e=>({date:e.date,rate:e.total>0?Math.round(e.completed/e.total*100):0}));f(t)}},R=async()=>{const e=as(new Date,parseInt(r)),{data:s}=await w.from("client_progress").select("\n        user_id,\n        weight_kg,\n        date,\n        user_profiles!client_progress_user_id_fkey(full_name, email)\n      ").gte("date",e.toISOString()).order("date",{ascending:!0});if(s){const e=s.reduce((e,s)=>{var t,a;return e[s.user_id]||(e[s.user_id]={userId:s.user_id,name:(null==(t=s.user_profiles)?void 0:t.full_name)||"Unknown",email:(null==(a=s.user_profiles)?void 0:a.email)||"",weights:[]}),s.weight_kg&&e[s.user_id].weights.push(s.weight_kg),e},{}),t=Object.values(e).map(e=>{const s=e.weights;if(s.length<2)return null;const t=s[0],a=t-s[s.length-1],l=(a/t*100).toFixed(1);return{...e,weightChange:a.toFixed(1),percentChange:parseFloat(l)}}).filter(Boolean).sort((e,s)=>Math.abs(s.percentChange)-Math.abs(e.percentChange)).slice(0,5);b(t)}},D=async()=>{const e=as(new Date,parseInt(r)),{data:s}=await w.from("appointments").select("appointment_date, consultation_type").eq("status","completed").gte("appointment_date",e.toISOString()).order("appointment_date",{ascending:!0});if(s){const e=s.reduce((e,s)=>{const t=ue(new Date(s.appointment_date),"MMM dd");e[t]||(e[t]={date:t,revenue:0});const a="initial"===s.consultation_type?100:"check_in"===s.consultation_type?50:75;return e[t].revenue+=a,e},{});y(Object.values(e))}},T=["hsl(142, 76%, 36%)","hsl(217, 91%, 60%)","hsl(38, 92%, 50%)","hsl(0, 84%, 60%)","hsl(258, 90%, 66%)","hsl(330, 81%, 60%)"];return t?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-foreground",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Track performance and client success metrics"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("select",{value:r,onChange:e=>n(e.target.value),className:"px-4 py-2 rounded-lg border border-border bg-card text-foreground whitespace-nowrap",children:[e.jsx("option",{value:"7",children:"Last 7 days"}),e.jsx("option",{value:"30",children:"Last 30 days"}),e.jsx("option",{value:"90",children:"Last 90 days"})]}),e.jsxs(_,{variant:"outline",onClick:async()=>{i(!0),await k(),i(!1),s({title:"Success",description:"Analytics data refreshed"})},disabled:l,className:"whitespace-nowrap",children:[e.jsx(ls,{className:"h-4 w-4 mr-2 flex-shrink-0 "+(l?"animate-spin":"")}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]}),e.jsxs(_,{onClick:()=>{s({title:"Export Started",description:"Generating analytics report..."})},className:"whitespace-nowrap",children:[e.jsx(is,{className:"h-4 w-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Export"})," Report"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(Tt,{icon:U,title:"Total Clients",value:c.totalClients,change:`+${c.activeClients} this period`,trend:"up",color:"blue"}),e.jsx(Tt,{icon:he,title:"Appointments",value:c.totalAppointments,change:`${c.completedAppointments} completed`,trend:"up",color:"green"}),e.jsx(Tt,{icon:H,title:"Success Rate",value:`${c.averageSuccessRate}%`,change:"Average client progress",trend:"up",color:"purple"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(G.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Average Client Progress"}),e.jsx(ie,{className:"h-5 w-5 text-muted-foreground"})]}),e.jsx(Y,{width:"100%",height:300,children:e.jsxs(rs,{data:o,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorWeight",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"hsl(217, 91%, 60%)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"hsl(217, 91%, 60%)",stopOpacity:0})]})}),e.jsx(Z,{strokeDasharray:"3 3",className:"stroke-border"}),e.jsx(J,{dataKey:"date",className:"stroke-muted-foreground"}),e.jsx(X,{className:"stroke-muted-foreground"}),e.jsx(ee,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--popover-foreground))"}}),e.jsx(ns,{type:"monotone",dataKey:"avgWeight",stroke:"hsl(217, 91%, 60%)",fillOpacity:1,fill:"url(#colorWeight)"})]})})]}),e.jsxs(G.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Appointment Trends"}),e.jsx(ae,{className:"h-5 w-5 text-gray-400"})]}),e.jsx(Y,{width:"100%",height:300,children:e.jsxs(cs,{data:x,children:[e.jsx(Z,{strokeDasharray:"3 3",className:"stroke-border"}),e.jsx(J,{dataKey:"date",className:"stroke-muted-foreground"}),e.jsx(X,{className:"stroke-muted-foreground"}),e.jsx(ee,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--popover-foreground))"}}),e.jsx(se,{}),e.jsx(ds,{dataKey:"scheduled",fill:"hsl(217, 91%, 60%)",name:"Scheduled"}),e.jsx(ds,{dataKey:"completed",fill:"hsl(142, 76%, 36%)",name:"Completed"}),e.jsx(ds,{dataKey:"cancelled",fill:"hsl(0, 84%, 60%)",name:"Cancelled"})]})})]}),e.jsxs(G.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Client Goals Distribution"}),e.jsx(os,{className:"h-5 w-5 text-gray-400"})]}),e.jsx(Y,{width:"100%",height:300,children:e.jsxs(re,{children:[e.jsx(ne,{data:h,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,percent:s})=>`${e} ${(100*s).toFixed(0)}%`,outerRadius:80,fill:"hsl(217, 91%, 60%)",dataKey:"value",children:h.map((s,t)=>e.jsx(ce,{fill:T[t%T.length]},`cell-${t}`))}),e.jsx(ee,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--popover-foreground))"}})]})})]}),e.jsxs(G.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Client Compliance Rate"}),e.jsx(Re,{className:"h-5 w-5 text-gray-400"})]}),e.jsx(Y,{width:"100%",height:300,children:e.jsxs(Q,{data:j,children:[e.jsx(Z,{strokeDasharray:"3 3",className:"stroke-border"}),e.jsx(J,{dataKey:"date",className:"stroke-muted-foreground"}),e.jsx(X,{className:"stroke-muted-foreground"}),e.jsx(ee,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--popover-foreground))"}}),e.jsx(te,{type:"monotone",dataKey:"rate",stroke:"hsl(142, 76%, 36%)",strokeWidth:2,dot:{fill:"hsl(142, 76%, 36%)"}})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(G.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Top Performers"}),e.jsx(Re,{className:"h-5 w-5 text-yellow-500"})]}),0===v.length?e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No progress data available"}):e.jsx("div",{className:"space-y-4",children:v.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 text-primary font-bold",children:t+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold "+(s.weightChange>0?"text-destructive":"text-primary"),children:[s.weightChange>0?"+":"",s.weightChange," kg"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[Math.abs(s.percentChange),"% change"]})]})]},s.userId))})]}),e.jsxs(G.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Revenue Trends"}),e.jsx(K,{className:"h-5 w-5 text-green-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-3xl font-bold text-foreground",children:["$",c.totalRevenue.toLocaleString()]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total revenue this period"})]}),e.jsx(Y,{width:"100%",height:200,children:e.jsxs(rs,{data:N,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorRevenue",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"hsl(142, 76%, 36%)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"hsl(142, 76%, 36%)",stopOpacity:0})]})}),e.jsx(Z,{strokeDasharray:"3 3",className:"stroke-border"}),e.jsx(J,{dataKey:"date",className:"stroke-muted-foreground"}),e.jsx(X,{className:"stroke-muted-foreground"}),e.jsx(ee,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--popover-foreground))"}}),e.jsx(ns,{type:"monotone",dataKey:"revenue",stroke:"hsl(142, 76%, 36%)",fillOpacity:1,fill:"url(#colorRevenue)"})]})})]})]})]})},Tt=({icon:s,title:t,value:a,change:l,trend:i,color:r})=>e.jsx(G.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:t}),e.jsx("p",{className:"text-3xl font-bold text-card-foreground mb-2",children:a}),e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:["up"===i?e.jsx(V,{className:"h-4 w-4 text-primary"}):e.jsx(ye,{className:"h-4 w-4 text-destructive"}),e.jsx("span",{className:"up"===i?"text-primary":"text-destructive",children:l})]})]}),e.jsx("div",{className:`p-3 rounded-lg ${{blue:"bg-blue-500/10 text-blue-500",green:"bg-primary/10 text-primary",purple:"bg-violet-500/10 text-violet-500",red:"bg-destructive/10 text-destructive"}[r]}`,children:e.jsx(s,{className:"h-6 w-6"})})]})}),Ft=()=>{const{toast:s}=E(),[t,a]=g.useState(!0),[l,i]=g.useState([]),[r,n]=g.useState([]),[c,d]=g.useState(""),[o,m]=g.useState("all"),[x,u]=g.useState(null),[h,p]=g.useState(!1),[j,f]=g.useState(!1),[v,b]=g.useState({title:"",description:"",content:"",resource_type:"article",category:"nutrition",url:"",file_url:"",tags:[],is_public:!0}),[y,k]=g.useState(""),C=[{value:"all",label:"All Resources",icon:ps},{value:"nutrition",label:"Nutrition",icon:ms},{value:"exercise",label:"Exercise",icon:ms},{value:"wellness",label:"Wellness",icon:ms},{value:"recipes",label:"Recipes",icon:ms},{value:"guides",label:"Guides",icon:je}],S=[{value:"article",label:"Article",icon:je},{value:"video",label:"Video",icon:be},{value:"pdf",label:"PDF Document",icon:is},{value:"link",label:"External Link",icon:gs}];g.useEffect(()=>{M()},[]),g.useEffect(()=>{A()},[l,c,o]);const M=async()=>{a(!0);try{const{data:e,error:s}=await w.from("educational_resources").select("*").order("created_at",{ascending:!1});if(s)throw s;i(e||[])}catch(e){s({title:"Error",description:"Failed to load resources",variant:"destructive"})}finally{a(!1)}},A=()=>{let e=l;if("all"!==o&&(e=e.filter(e=>e.category===o)),c){const s=c.toLowerCase();e=e.filter(e=>{var t,a;return e.title.toLowerCase().includes(s)||(null==(t=e.description)?void 0:t.toLowerCase().includes(s))||(null==(a=e.tags)?void 0:a.some(e=>e.toLowerCase().includes(s)))})}n(e)},P=async e=>{s({title:"Share Link Copied",description:"Resource link copied to clipboard"})},R=()=>{y&&!v.tags.includes(y)&&(b({...v,tags:[...v.tags,y]}),k(""))},D=()=>{b({title:"",description:"",content:"",resource_type:"article",category:"nutrition",url:"",file_url:"",tags:[],is_public:!0}),u(null)},T=e=>{const s={article:"bg-blue-500/10 text-blue-600 dark:text-blue-400",video:"bg-purple-500/10 text-purple-600 dark:text-purple-400",pdf:"bg-red-500/10 text-red-600 dark:text-red-400",link:"bg-green-500/10 text-green-600 dark:text-green-400"};return s[e]||s.article};return t?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-foreground",children:"Resource Library"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage educational content and resources for clients"})]}),e.jsxs(_,{onClick:()=>{D(),p(!0)},children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Add Resource"]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Search resources...",value:c,onChange:e=>d(e.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border border-border bg-background text-foreground"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:C.map(s=>{const t=s.icon;return e.jsxs(_,{variant:o===s.value?"default":"outline",onClick:()=>m(s.value),className:"whitespace-nowrap",size:"sm",children:[e.jsx(t,{className:"h-4 w-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:s.label}),e.jsx("span",{className:"sm:hidden",children:s.label.split(" ")[0]})]},s.value)})})]}),0===r.length?e.jsxs(G.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-12 bg-card rounded-xl border border-border",children:[e.jsx(ms,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No Resources Found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:c||"all"!==o?"Try adjusting your filters":"Get started by creating your first resource"}),e.jsxs(_,{onClick:()=>{D(),p(!0)},children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Add Resource"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map((t,a)=>{const l=(e=>{const s=S.find(s=>s.value===e);return s?s.icon:je})(t.resource_type);return e.jsxs(G.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*a},className:"bg-card rounded-xl shadow-lg border border-border overflow-hidden hover:shadow-xl transition-shadow",children:[e.jsx("div",{className:`p-4 ${T(t.resource_type)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(l,{className:"h-8 w-8"}),e.jsx(N,{variant:t.is_public?"default":"secondary",children:t.is_public?"Public":"Private"})]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2 line-clamp-2",children:t.title}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-3",children:t.description||"No description available"}),t.tags&&t.tags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[t.tags.slice(0,3).map((s,t)=>e.jsxs(N,{variant:"outline",className:"text-xs",children:[e.jsx(xs,{className:"h-3 w-3 mr-1"}),s]},t)),t.tags.length>3&&e.jsxs(N,{variant:"outline",className:"text-xs",children:["+",t.tags.length-3]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground mb-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"h-3 w-3"}),ue(new Date(t.created_at),"MMM dd, yyyy")]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ae,{className:"h-3 w-3"}),t.view_count||0," views"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(_,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>(async e=>{u(e),f(!0);try{await w.from("educational_resources").update({view_count:(e.view_count||0)+1}).eq("id",e.id)}catch(s){}})(t),children:[e.jsx(Ae,{className:"h-4 w-4 mr-1"}),"View"]}),e.jsx(_,{size:"sm",variant:"outline",onClick:()=>(e=>{u(e),b({title:e.title,description:e.description||"",content:e.content||"",resource_type:e.resource_type,category:e.category,url:e.url||"",file_url:e.file_url||"",tags:e.tags||[],is_public:e.is_public}),p(!0)})(t),children:e.jsx(ze,{className:"h-4 w-4"})}),e.jsx(_,{size:"sm",variant:"outline",onClick:()=>P(),children:e.jsx(us,{className:"h-4 w-4"})}),e.jsx(_,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this resource?"))try{const{error:t}=await w.from("educational_resources").delete().eq("id",e);if(t)throw t;s({title:"Success",description:"Resource deleted successfully"}),M()}catch(t){s({title:"Error",description:"Failed to delete resource",variant:"destructive"})}})(t.id),children:e.jsx(Le,{className:"h-4 w-4"})})]})]})]},t.id)})}),e.jsx(ks,{open:h,onOpenChange:p,children:e.jsxs(Cs,{className:"glass-effect custom-scrollbar max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ss,{children:e.jsx(Ms,{children:x?"Edit Resource":"Add New Resource"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Title *"}),e.jsx("input",{type:"text",value:v.title,onChange:e=>b({...v,title:e.target.value}),className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",placeholder:"Resource title"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Type *"}),e.jsx("select",{value:v.resource_type,onChange:e=>b({...v,resource_type:e.target.value}),className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",children:S.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Category"}),e.jsx("select",{value:v.category,onChange:e=>b({...v,category:e.target.value}),className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",children:C.filter(e=>"all"!==e.value).map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Description"}),e.jsx("textarea",{value:v.description,onChange:e=>b({...v,description:e.target.value}),rows:3,className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",placeholder:"Brief description"})]}),("link"===v.resource_type||"video"===v.resource_type)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"URL"}),e.jsx("input",{type:"url",value:v.url,onChange:e=>b({...v,url:e.target.value}),className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",placeholder:"https://example.com"})]}),"pdf"===v.resource_type&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"File URL"}),e.jsx("input",{type:"url",value:v.file_url,onChange:e=>b({...v,file_url:e.target.value}),className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",placeholder:"Upload file and paste URL"})]}),"article"===v.resource_type&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Content"}),e.jsx("textarea",{value:v.content,onChange:e=>b({...v,content:e.target.value}),rows:10,className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground font-mono text-sm",placeholder:"Write your article content here (supports Markdown)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Tags"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",value:y,onChange:e=>k(e.target.value),onKeyPress:e=>"Enter"===e.key&&(e.preventDefault(),R()),className:"flex-1 px-4 py-2 rounded-lg border border-border bg-background text-foreground",placeholder:"Add a tag and press Enter"}),e.jsx(_,{onClick:R,children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:v.tags.map((s,t)=>e.jsxs(N,{className:"flex items-center gap-1",children:[s,e.jsx(Fe,{className:"h-3 w-3 cursor-pointer",onClick:()=>{return e=s,void b({...v,tags:v.tags.filter(s=>s!==e)});var e}})]},t))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"is_public",checked:v.is_public,onChange:e=>b({...v,is_public:e.target.checked}),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"is_public",className:"text-sm font-medium text-foreground",children:"Make this resource public to all clients"})]})]}),e.jsxs(Ps,{children:[e.jsx(_,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsxs(_,{onClick:async()=>{if(v.title&&v.resource_type)try{const{data:{user:e}}=await w.auth.getUser(),t={...v,created_by:null==e?void 0:e.id,view_count:0};let a;if(x){const{data:e,error:l}=await w.from("educational_resources").update(t).eq("id",x.id).select().single();if(l)throw l;a=e,s({title:"Success",description:"Resource updated successfully"})}else{const{data:e,error:l}=await w.from("educational_resources").insert([t]).select().single();if(l)throw l;a=e,s({title:"Success",description:"Resource created successfully"})}p(!1),D(),M()}catch(e){s({title:"Error",description:"Failed to save resource",variant:"destructive"})}else s({title:"Validation Error",description:"Please fill in required fields",variant:"destructive"})},children:[x?"Update":"Create"," Resource"]})]})]})}),e.jsx(ks,{open:j,onOpenChange:f,children:e.jsx(Cs,{className:"glass-effect custom-scrollbar max-w-3xl max-h-[90vh] overflow-y-auto",children:x&&e.jsxs(e.Fragment,{children:[e.jsx(Ss,{children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx(Ms,{className:"text-2xl mb-2 text-foreground",children:x.title}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(N,{children:x.resource_type}),e.jsx(N,{variant:"outline",children:x.category}),e.jsx("span",{children:""}),e.jsx("span",{children:ue(new Date(x.created_at),"MMMM dd, yyyy")}),e.jsx("span",{children:""}),e.jsxs("span",{children:[x.view_count||0," views"]})]})]})})}),e.jsxs("div",{className:"space-y-4",children:[x.description&&e.jsx("div",{children:e.jsx("p",{className:"text-muted-foreground",children:x.description})}),x.tags&&x.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:x.tags.map((s,t)=>e.jsxs(N,{variant:"outline",children:[e.jsx(xs,{className:"h-3 w-3 mr-1"}),s]},t))}),"article"===x.resource_type&&x.content&&e.jsx("div",{className:"prose dark:prose-invert max-w-none",children:e.jsx("div",{className:"whitespace-pre-wrap text-foreground",children:x.content})}),"link"===x.resource_type&&x.url&&e.jsx("div",{className:"p-4 bg-muted/50 rounded-lg",children:e.jsxs("a",{href:x.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-primary hover:underline",children:[e.jsx(hs,{className:"h-4 w-4"}),"Open External Link"]})}),"video"===x.resource_type&&x.url&&e.jsx("div",{className:"aspect-video bg-muted rounded-lg flex items-center justify-center",children:e.jsxs("a",{href:x.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-primary hover:underline",children:[e.jsx(be,{className:"h-6 w-6"}),"Watch Video"]})}),"pdf"===x.resource_type&&x.file_url&&e.jsx("div",{className:"p-4 bg-muted/50 rounded-lg",children:e.jsxs("a",{href:x.file_url,download:!0,className:"flex items-center gap-2 text-primary hover:underline",children:[e.jsx(is,{className:"h-4 w-4"}),"Download PDF"]})})]}),e.jsxs(Ps,{children:[e.jsx(_,{variant:"outline",onClick:()=>f(!1),children:"Close"}),e.jsxs(_,{onClick:()=>P(),children:[e.jsx(us,{className:"h-4 w-4 mr-2"}),"Share"]})]})]})})})]})},It=()=>{const{user:s,userProfile:t}=y(),[a,l]=g.useState(!0),[i,r]=g.useState(!1),[n,c]=g.useState("business"),[d,o]=g.useState({business_name:"",business_address:"",business_phone:"",license_number:"",specializations:[],consultation_duration_default:60,buffer_time_minutes:15,working_hours:{monday:{enabled:!0,start:"09:00",end:"17:00"},tuesday:{enabled:!0,start:"09:00",end:"17:00"},wednesday:{enabled:!0,start:"09:00",end:"17:00"},thursday:{enabled:!0,start:"09:00",end:"17:00"},friday:{enabled:!0,start:"09:00",end:"17:00"},saturday:{enabled:!1,start:"09:00",end:"13:00"},sunday:{enabled:!1,start:"09:00",end:"13:00"}},time_zone:Intl.DateTimeFormat().resolvedOptions().timeZone,booking_advance_days:30,hourly_rate:"",initial_consultation_fee:"",follow_up_fee:"",package_pricing:[],email_notifications:!0,sms_notifications:!1,appointment_reminders:!0,reminder_hours_before:24,brand_color:"#10b981",logo_url:"",custom_email_signature:""}),[m,x]=g.useState(""),[u,h]=g.useState({name:"",sessions:"",price:""});g.useEffect(()=>{p()},[s]);const p=async()=>{l(!0);try{const{data:e,error:t}=await w.from("nutritionist_settings").select("*").eq("nutritionist_id",s.id).single();if(t&&"PGRST116"!==t.code)throw t;e&&o({...d,...e,specializations:e.specializations||[],working_hours:e.working_hours||d.working_hours,package_pricing:e.package_pricing||[]})}catch(e){}finally{l(!1)}},j=async()=>{r(!0);try{const{data:e}=await w.from("nutritionist_settings").select("id").eq("nutritionist_id",s.id).single(),t={...d,nutritionist_id:s.id};if(e){const{error:e}=await w.from("nutritionist_settings").update(t).eq("nutritionist_id",s.id);if(e)throw e}else{const{error:e}=await w.from("nutritionist_settings").insert(t);if(e)throw e}C({title:"Settings saved",description:"Your settings have been updated successfully"})}catch(e){C({variant:"destructive",title:"Error",description:"Failed to save settings"})}finally{r(!1)}},f=()=>{m.trim()&&!d.specializations.includes(m.trim())&&(o({...d,specializations:[...d.specializations,m.trim()]}),x(""))},v=(e,s,t)=>{o({...d,working_hours:{...d.working_hours,[e]:{...d.working_hours[e],[s]:t}}})};return a?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(qe,{className:"w-12 h-12 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(js,{className:"w-8 h-8 text-primary"}),"Settings"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your business settings and preferences"})]}),e.jsx(_,{onClick:j,disabled:i,children:i?e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Save Changes"]})})]}),e.jsxs(Ns,{value:n,onValueChange:c,children:[e.jsxs(ys,{className:"grid w-full grid-cols-5",children:[e.jsx(ws,{value:"business",children:"Business"}),e.jsx(ws,{value:"availability",children:"Availability"}),e.jsx(ws,{value:"pricing",children:"Pricing"}),e.jsx(ws,{value:"notifications",children:"Notifications"}),e.jsx(ws,{value:"branding",children:"Branding"})]}),e.jsx(_s,{value:"business",className:"space-y-4",children:e.jsxs(I,{children:[e.jsxs(z,{children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(fs,{className:"w-5 h-5"}),"Business Information"]}),e.jsx(O,{children:"Manage your professional business details"})]}),e.jsxs(B,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Business Name"}),e.jsx(A,{value:d.business_name,onChange:e=>o({...d,business_name:e.target.value}),placeholder:"Your Nutrition Practice"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"License Number"}),e.jsx(A,{value:d.license_number,onChange:e=>o({...d,license_number:e.target.value}),placeholder:"License #"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Business Address"}),e.jsx(M,{value:d.business_address,onChange:e=>o({...d,business_address:e.target.value}),placeholder:"123 Main St, City, State, ZIP",rows:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Business Phone"}),e.jsx(A,{value:d.business_phone,onChange:e=>o({...d,business_phone:e.target.value}),placeholder:"+1 (555) 000-0000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Specializations"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(A,{value:m,onChange:e=>x(e.target.value),placeholder:"e.g., Weight Loss, Sports Nutrition",onKeyPress:e=>"Enter"===e.key&&f()}),e.jsx(_,{onClick:f,children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.specializations.map((s,t)=>e.jsxs("span",{className:"px-3 py-1 bg-primary/10 text-primary rounded-full text-sm flex items-center gap-2",children:[s,e.jsx("button",{onClick:()=>(e=>{o({...d,specializations:d.specializations.filter(s=>s!==e)})})(s),className:"text-primary/60 hover:text-primary",children:""})]},t))})]})]})]})}),e.jsx(_s,{value:"availability",className:"space-y-4",children:e.jsxs(I,{children:[e.jsxs(z,{children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5"}),"Working Hours"]}),e.jsx(O,{children:"Set your available hours for client bookings"})]}),e.jsxs(B,{className:"space-y-4",children:[["monday","tuesday","wednesday","thursday","friday","saturday","sunday"].map(s=>{var t,a,l,i;return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-32",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx(Vs,{checked:(null==(t=d.working_hours[s])?void 0:t.enabled)||!1,onCheckedChange:e=>v(s,"enabled",e)}),e.jsx("span",{className:"capitalize font-medium",children:s})]})}),(null==(a=d.working_hours[s])?void 0:a.enabled)&&e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(A,{type:"time",value:(null==(l=d.working_hours[s])?void 0:l.start)||"09:00",onChange:e=>v(s,"start",e.target.value),className:"w-32 min-w-0"}),e.jsx("span",{children:"to"}),e.jsx(A,{type:"time",value:(null==(i=d.working_hours[s])?void 0:i.end)||"17:00",onChange:e=>v(s,"end",e.target.value),className:"w-32 min-w-0"})]})]},s)}),e.jsxs("div",{className:"pt-4 border-t border-border grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Default Consultation Duration"}),e.jsxs("select",{value:d.consultation_duration_default,onChange:e=>o({...d,consultation_duration_default:parseInt(e.target.value)}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"30",children:"30 minutes"}),e.jsx("option",{value:"45",children:"45 minutes"}),e.jsx("option",{value:"60",children:"60 minutes"}),e.jsx("option",{value:"90",children:"90 minutes"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Buffer Time (minutes)"}),e.jsx(A,{type:"number",value:d.buffer_time_minutes,onChange:e=>o({...d,buffer_time_minutes:parseInt(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Booking Advance (days)"}),e.jsx(A,{type:"number",value:d.booking_advance_days,onChange:e=>o({...d,booking_advance_days:parseInt(e.target.value)})})]})]})]})]})}),e.jsx(_s,{value:"pricing",className:"space-y-4",children:e.jsxs(I,{children:[e.jsxs(z,{children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"Consultation Pricing"]}),e.jsx(O,{children:"Set your consultation fees and package pricing"})]}),e.jsxs(B,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Hourly Rate"}),e.jsx(A,{type:"number",step:"0.01",value:d.hourly_rate,onChange:e=>o({...d,hourly_rate:e.target.value}),placeholder:"100.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Initial Consultation Fee"}),e.jsx(A,{type:"number",step:"0.01",value:d.initial_consultation_fee,onChange:e=>o({...d,initial_consultation_fee:e.target.value}),placeholder:"150.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Follow-up Fee"}),e.jsx(A,{type:"number",step:"0.01",value:d.follow_up_fee,onChange:e=>o({...d,follow_up_fee:e.target.value}),placeholder:"75.00"})]})]}),e.jsxs("div",{className:"pt-4 border-t border-border",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Package Pricing"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 mb-4",children:[e.jsx(A,{placeholder:"Package name",value:u.name,onChange:e=>h({...u,name:e.target.value})}),e.jsx(A,{type:"number",placeholder:"Sessions",value:u.sessions,onChange:e=>h({...u,sessions:e.target.value})}),e.jsx(A,{type:"number",step:"0.01",placeholder:"Price",value:u.price,onChange:e=>h({...u,price:e.target.value})}),e.jsx(_,{onClick:()=>{u.name&&u.sessions&&u.price&&(o({...d,package_pricing:[...d.package_pricing,{name:u.name,sessions:parseInt(u.sessions),price:parseFloat(u.price)}]}),h({name:"",sessions:"",price:""}))},children:"Add Package"})]}),d.package_pricing.length>0&&e.jsx("div",{className:"space-y-2",children:d.package_pricing.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.sessions," sessions  $",s.price]})]}),e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>(e=>{o({...d,package_pricing:d.package_pricing.filter((s,t)=>t!==e)})})(t),children:"Remove"})]},t))})]})]})]})}),e.jsx(_s,{value:"notifications",className:"space-y-4",children:e.jsxs(I,{children:[e.jsxs(z,{children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5"}),"Notification Preferences"]}),e.jsx(O,{children:"Manage how you receive notifications and reminders"})]}),e.jsxs(B,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Email Notifications"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive notifications via email"})]}),e.jsx(Vs,{checked:d.email_notifications,onCheckedChange:e=>o({...d,email_notifications:e})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"SMS Notifications"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive notifications via text message"})]}),e.jsx(Vs,{checked:d.sms_notifications,onCheckedChange:e=>o({...d,sms_notifications:e})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Appointment Reminders"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Send reminders for upcoming appointments"})]}),e.jsx(Vs,{checked:d.appointment_reminders,onCheckedChange:e=>o({...d,appointment_reminders:e})})]}),d.appointment_reminders&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Send reminders (hours before appointment)"}),e.jsx(A,{type:"number",value:d.reminder_hours_before,onChange:e=>o({...d,reminder_hours_before:parseInt(e.target.value)})})]})]})]})}),e.jsx(_s,{value:"branding",className:"space-y-4",children:e.jsxs(I,{children:[e.jsxs(z,{children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(vs,{className:"w-5 h-5"}),"Branding & Customization"]}),e.jsx(O,{children:"Customize your brand appearance and communications"})]}),e.jsxs(B,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Brand Color"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{type:"color",value:d.brand_color,onChange:e=>o({...d,brand_color:e.target.value}),className:"w-20 h-10"}),e.jsx(A,{value:d.brand_color,onChange:e=>o({...d,brand_color:e.target.value}),placeholder:"#10b981"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Logo URL"}),e.jsx(A,{value:d.logo_url,onChange:e=>o({...d,logo_url:e.target.value}),placeholder:"https://example.com/logo.png"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Custom Email Signature"}),e.jsx(M,{value:d.custom_email_signature,onChange:e=>o({...d,custom_email_signature:e.target.value}),placeholder:"Best regards,\nYour Name\nCertified Nutritionist",rows:4})]})]})]})})]}),e.jsx("div",{className:"flex justify-end sticky bottom-4",children:e.jsx(_,{onClick:j,disabled:i,size:"lg",children:i?e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Save All Changes"]})})})]})},zt=R({}.VITE_STRIPE_PUBLISHABLE_KEY||"pk_test_..."),Lt=()=>{const{user:s,userProfile:t}=y(),[a,l]=g.useState(null),[i,r]=g.useState([]),[n,c]=g.useState(!0),[d,o]=g.useState(null),[m,x]=g.useState(!1),[u,h]=g.useState(!1),p=[{id:"base",name:"Base",price:9.99,priceId:"price_base_monthly",icon:$,color:"gray",features:["Basic meal plans","Weekly check-ins","Email support (24-48hr response)","Limited messaging (5/week)","Basic progress tracking","Recipe library access"]},{id:"premium",name:"Premium",price:19.99,priceId:"price_premium_monthly",icon:q,color:"blue",popular:!0,features:["Everything in Base","Custom meal plans","Priority support (24-48hr)","Enhanced messaging (20/week)","Advanced analytics","Workout integration","Monthly progress reports","Meal prep guides"]},{id:"elite",name:"Elite",price:29.99,priceId:"price_elite_monthly",icon:W,color:"yellow",features:["Everything in Premium","Real-time messaging (unlimited)","Video consultations (2/month)","Priority support (same-day)","Personalized workout plans","24/7 AI coach access","Weekly progress calls","Custom supplement advice","VIP community access"]}];g.useEffect(()=>{j()},[s]);const j=async()=>{c(!0);try{const{data:e,error:t}=await w.from("subscriptions").select("*").eq("client_id",s.id).eq("status","active").single();if(t&&"PGRST116"!==t.code)throw t;l(e);const{data:a,error:i}=await w.from("payment_history").select("*").eq("client_id",s.id).order("created_at",{ascending:!1}).limit(10);if(i)throw i;r(a||[])}catch(e){}finally{c(!1)}};return n?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-8",children:[a&&e.jsxs(I,{children:[e.jsxs(z,{children:[e.jsx(L,{children:"Current Subscription"}),e.jsx(O,{children:"Manage your active subscription plan"})]}),e.jsxs(B,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(W,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg",children:[a.tier," Plan"]}),e.jsxs("p",{className:"text-sm text-text-secondary",children:["$",a.price_per_month,"/month"]})]})]}),e.jsx(N,{variant:"active"===a.status?"success":"secondary",children:a.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Next billing date"}),e.jsx("p",{className:"font-semibold",children:ue(new Date(a.next_billing_date),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Billing period"}),e.jsx("p",{className:"font-semibold capitalize",children:a.billing_period})]})]}),a.cancel_at_period_end&&e.jsxs(zs,{variant:"destructive",className:"mb-4",children:[e.jsx(oe,{className:"w-4 h-4"}),e.jsxs(Ls,{children:["Your subscription will end on ",ue(new Date(a.current_period_end),"MMM dd, yyyy")]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{variant:"outline",onClick:async()=>{if(!a)return;if(confirm("Are you sure you want to cancel your subscription? You will lose access to premium features at the end of your billing period."))try{const{error:e}=await w.from("subscriptions").update({cancel_at_period_end:!0}).eq("id",a.id);if(e)throw e;alert("Subscription will be cancelled at the end of the current billing period."),await j()}catch(e){alert("Failed to cancel subscription. Please try again.")}},disabled:a.cancel_at_period_end,children:"Cancel Subscription"}),e.jsxs(_,{variant:"outline",children:[e.jsx(bs,{className:"w-4 h-4 mr-2"}),"Update Payment Method"]})]})]})]}),(!a||a.cancel_at_period_end)&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Choose Your Plan"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:p.map(s=>{const t=s.icon,l=(null==a?void 0:a.tier)===s.name;return e.jsxs(I,{className:`relative ${s.popular?"border-primary border-2":""} ${l?"bg-primary/5":""}`,children:[s.popular&&e.jsx("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:e.jsx(N,{className:"bg-primary",children:"Most Popular"})}),e.jsx(z,{children:e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(t,{className:`w-8 h-8 text-${s.color}-500`}),e.jsxs("div",{children:[e.jsx(L,{children:s.name}),e.jsxs(O,{children:[e.jsxs("span",{className:"text-2xl font-bold text-foreground",children:["$",s.price]}),e.jsx("span",{className:"text-text-secondary",children:"/month"})]})]})]})}),e.jsxs(B,{children:[e.jsx("ul",{className:"space-y-3 mb-6",children:s.features.map((s,t)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(ts,{className:"w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm",children:s})]},t))}),e.jsx(_,{className:"w-full",variant:s.popular?"default":"outline",onClick:()=>(async e=>{o(e),x(!0)})(s),disabled:l,children:l?"Current Plan":`Subscribe to ${s.name}`})]})]},s.id)})})]}),i.length>0&&e.jsxs(I,{children:[e.jsxs(z,{children:[e.jsx(L,{children:"Payment History"}),e.jsx(O,{children:"View your past transactions"})]}),e.jsx(B,{children:e.jsx("div",{className:"space-y-4",children:i.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center "+("succeeded"===s.status?"bg-green-100":"bg-red-100"),children:"succeeded"===s.status?e.jsx(ts,{className:"w-5 h-5 text-green-600"}):e.jsx(Fe,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold",children:["$",s.amount]}),e.jsx("p",{className:"text-sm text-text-secondary",children:ue(new Date(s.created_at),"MMM dd, yyyy")})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N,{variant:"succeeded"===s.status?"success":"destructive",children:s.status}),"succeeded"===s.status&&e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>(async e=>{window.open(e,"_blank")})(s.stripe_invoice_id),children:[e.jsx(is,{className:"w-4 h-4 mr-2"}),"Invoice"]})]})]},s.id))})})]}),e.jsx(ks,{open:m,onOpenChange:x,children:e.jsxs(Cs,{children:[e.jsxs(Ss,{children:[e.jsx(Ms,{children:"Confirm Subscription"}),e.jsxs(As,{children:["You are about to subscribe to the ",null==d?void 0:d.name," plan"]})]}),d&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-semibold",children:[d.name," Plan"]}),e.jsxs("span",{className:"text-xl font-bold",children:["$",d.price,"/month"]})]}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Billed monthly  Cancel anytime"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold mb-2",children:"What you'll get:"}),e.jsx("ul",{className:"space-y-2",children:d.features.slice(0,5).map((s,t)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ts,{className:"w-4 h-4 text-green-500"}),s]},t))})]})]}),e.jsxs(Ps,{children:[e.jsx(_,{variant:"outline",onClick:()=>x(!1),disabled:u,children:"Cancel"}),e.jsx(_,{onClick:async()=>{if(d){h(!0);try{const e=await fetch("/api/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({priceId:d.priceId,userId:s.id,tier:d.name})}),{sessionId:t}=await e.json(),a=await zt,{error:l}=await a.redirectToCheckout({sessionId:t});l&&alert("Payment failed. Please try again.")}catch(e){alert("Failed to process payment. Please try again.")}finally{h(!1)}}},disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(bs,{className:"w-4 h-4 mr-2"}),"Proceed to Payment"]})})]})]})})]})},Bt=({user:s})=>{const t=b(),[a,l]=g.useState("dashboard");g.useEffect(()=>{const e=t.pathname.split("/"),s=e[e.length-1];l("nutritionist"===s||""===s?"dashboard":s)},[t.pathname]);return e.jsx(T,{children:e.jsx(G.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:(()=>{switch(a){case"dashboard":default:return e.jsx(Hs,{user:s});case"clients":return e.jsx(Ct,{});case"onboarding":return e.jsx(St,{});case"goals":return e.jsx(Mt,{});case"meals":return e.jsx(Pt,{});case"schedule":return e.jsx(Et,{});case"messages":return e.jsx(Rt,{});case"analytics":return e.jsx(Dt,{});case"payments":return e.jsx(Lt,{});case"resources":return e.jsx(Ft,{});case"blog":return e.jsx(F,{user:s});case"settings":return e.jsx(It,{})}})()},a)})},Ot=()=>{var s;const{userProfile:t}=y(),a={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}};return e.jsxs(e.Fragment,{children:[e.jsxs(D,{children:[e.jsx("title",{children:"Nutritionist Dashboard - GreenoFig"}),e.jsx("meta",{name:"description",content:"Manage your nutrition practice and clients"})]}),e.jsxs(G.div,{variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"visible",className:"space-y-8",children:[e.jsxs(G.div,{variants:a,children:[e.jsxs("h1",{className:"text-4xl font-bold",children:["Nutritionist ",e.jsx("span",{className:"gradient-text",children:"Portal"})]}),e.jsxs("p",{className:"text-text-secondary mt-2",children:["Welcome, ",(null==(s=null==t?void 0:t.full_name)?void 0:s.split(" ")[0])||"Nutritionist",". Manage your clients and practice from here."]})]}),e.jsx(G.div,{variants:a,children:e.jsx(Bt,{user:t})})]})]})};export{Ot as default};
