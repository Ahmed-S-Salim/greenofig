const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/HomePage-BFuhBfQ-.js","assets/vendor-ui-B996hA52.js","assets/vendor-react-sNAoBuc2.js","assets/vendor-utils-cF2MmNet.js","assets/vendor-editor-DcuCxt3Z.js","assets/FeaturesPage-Du5NLV5T.js","assets/SiteLayout-BSLeMeVr.js","assets/OnboardingSurvey-Bn8L8s2Y.js","assets/dialog-CyP9ia9L.js","assets/PricingPage-BRJWCn1l.js","assets/index-1v_AfJpO.js","assets/BlogPage-CNufxHT8.js","assets/card-Dj6Wluye.js","assets/tabs-AhH-42aO.js","assets/purify.es-BLKhEpFv.js","assets/ReviewsPage-BKY0T30e.js","assets/ContactPage-d0-T8ZOc.js","assets/FaqPage-Cdrw4aGo.js","assets/AboutPage-C6g6tYGT.js","assets/UserDashboard-C95dFTHq.js","assets/QuickLogMeal-Ccbb39ti.js","assets/select-UEGCGcgW.js","assets/NutritionistDashboardV2-BgdYCrva.js","assets/EnhancedBlogManager-BsutDCpL.js","assets/checkbox-BBwF7pja.js","assets/switch-DW7jYx9U.js","assets/AdminDashboard-BT9X742f.js","assets/dropdown-menu-Bt0S0CEa.js","assets/RevenueAnalyticsPage-CfXrOJlp.js","assets/ProfilePage-l10gZz_i.js","assets/EnhancedBlogPostEditor-YzhXN-XO.js","assets/BlogTagsManager-DhEzrbX9.js","assets/AiCoachPage-CVdP03BB.js","assets/SurveyPage-DuFAzrwS.js","assets/BillingPage-vVZRw2r8.js","assets/SupportPage-ChnPFUy6.js","assets/ResetPasswordPage-BLHvNtJA.js","assets/NutritionPageFunctional-DnseFQge.js","assets/FitnessPage-D8y3tE0y.js","assets/ProgressPage-DLeMvUmP.js","assets/MessagingCenter-C8TkWWKh.js","assets/PrivacyPolicyPage-DZBkBnhC.js","assets/TermsOfServicePage-B9ZIpb8N.js","assets/AdminFAQPage-C8g2bFgF.js"])))=>i.map(i=>d[i]);
import{j as e,a8 as t,a9 as r,aa as s,ab as n,ac as i,ad as o,ae as a,af as l,ag as c,ah as u,ai as d,aj as h}from"./vendor-ui-B996hA52.js";import{j as f,g as p,r as m,R as g,a as y,k as b,i as v,u as w,e as _,L as x,O as j,N as k,l as T,m as S,n as E,B as O}from"./vendor-react-sNAoBuc2.js";import{bP as N,bQ as P,ah as C,m as A,r as I,c as R,U as $,g as L,k as D,A as U,H as B,b4 as M,bR as F,bS as z,bT as H,w as q,h as V,f as W,G as J,a2 as G,ae as K,N as Y,ax as Q,a9 as X,bU as Z,bG as ee,bM as te,q as re,C as se,D as ne,al as ie,K as oe,s as ae,ak as le,bq as ce,y as ue,bN as de,a1 as he,bO as fe,bt as pe,bw as me,a8 as ge,b1 as ye,bu as be,L as ve}from"./vendor-utils-cF2MmNet.js";import"./vendor-editor-DcuCxt3Z.js";function we(e,t){for(var r=0;r<t.length;r++){const s=t[r];if("string"!=typeof s&&!Array.isArray(s))for(const t in s)if("default"!==t&&!(t in e)){const r=Object.getOwnPropertyDescriptor(s,t);r&&Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:()=>s[t]})}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}(),window.onerror=(e,t,r,s,n)=>{const i=n?JSON.stringify({name:n.name,message:n.message,stack:n.stack,source:t,lineno:r,colno:s}):null;window.parent.postMessage({type:"horizons-runtime-error",message:e,error:i},"*")};function _e(e){if(!e.shadowRoot)return;const t=e.shadowRoot.querySelector(".backdrop");if(t){const e=t.outerHTML,r=(new DOMParser).parseFromString(e,"text/html"),s=r.querySelector(".message-body"),n=r.querySelector(".file"),i=s?s.textContent.trim():"",o=n?n.textContent.trim():"",a=i+(o?" File:"+o:"");window.parent.postMessage({type:"horizons-vite-error",error:a},"*")}}new MutationObserver(e=>{for(const t of e)for(const e of t.addedNodes)e.nodeType!==Node.ELEMENT_NODE||"vite-error-overlay"!==e.tagName?.toLowerCase()&&!e.classList?.contains("backdrop")||_e(e)}).observe(document.documentElement,{childList:!0,subtree:!0});const xe=console.error;console.error=function(...e){xe.apply(console,e);let t="";for(let r=0;r<e.length;r++){const s=e[r];if(s instanceof Error){t=s.stack||`${s.name}: ${s.message}`;break}}t||(t=e.map(e=>"object"==typeof e?JSON.stringify(e):String(e)).join(" ")),window.parent.postMessage({type:"horizons-console-error",error:t},"*")};const je=window.fetch;window.fetch=function(...e){const t=e[0]instanceof Request?e[0].url:e[0];return t.startsWith("ws:")||t.startsWith("wss:")?je.apply(this,e):je.apply(this,e).then(async e=>{const t=e.headers.get("Content-Type")||"",r=t.includes("text/html")||t.includes("application/xhtml+xml");if(!e.ok&&!r){const t=e.clone(),r=await t.text(),s=e.url;console.error(`Fetch error from ${s}: ${r}`)}return e}).catch(e=>{throw t.match(/.html?$/i)||console.error(e),e})},window.navigation&&window.self!==window.top&&window.navigation.addEventListener("navigate",e=>{const t=e.destination.url;try{const e=new URL(t).origin;if(e===window.location.origin)return}catch(r){return}window.parent.postMessage({type:"horizons-navigation-error",url:t},"*")});var ke,Te={};const Se=p(function(){if(ke)return Te;ke=1;var e=f();return Te.createRoot=e.createRoot,Te.hydrateRoot=e.hydrateRoot,Te}()),Ee={},Oe=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),n=r?.nonce||r?.getAttribute("nonce");s=e(t.map(e=>{if((e=function(e){return"/"+e}(e))in Ee)return;Ee[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const s=document.createElement("link");return s.rel=t?"stylesheet":"modulepreload",t||(s.as="script"),s.crossOrigin="",s.href=e,n&&s.setAttribute("nonce",n),document.head.appendChild(s),t?new Promise((t,r)=>{s.addEventListener("load",t),s.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then(t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)})};var Ne,Pe,Ce,Ae,Ie,Re={exports:{}};function $e(){if(Pe)return Ne;Pe=1;return Ne="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}function Le(){if(Ae)return Ce;Ae=1;var e=$e();function t(){}function r(){}return r.resetWarningCache=t,Ce=function(){function s(t,r,s,n,i,o){if(o!==e){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function n(){return s}s.isRequired=s;var i={array:s,bigint:s,bool:s,func:s,number:s,object:s,string:s,symbol:s,any:s,arrayOf:n,element:s,elementType:s,instanceOf:n,node:s,objectOf:n,oneOf:n,oneOfType:n,shape:n,exact:n,checkPropTypes:r,resetWarningCache:t};return i.PropTypes=i,i}}function De(){return Ie||(Ie=1,Re.exports=Le()()),Re.exports}const Ue=p(De());var Be,Me;const Fe=p(function(){if(Me)return Be;Me=1;var e,t=m(),r=(e=t)&&"object"==typeof e&&"default"in e?e.default:e;function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var n=!("undefined"==typeof window||!window.document||!window.document.createElement);return Be=function(e,i,o){if("function"!=typeof e)throw new Error("Expected reducePropsToState to be a function.");if("function"!=typeof i)throw new Error("Expected handleStateChangeOnClient to be a function.");if(void 0!==o&&"function"!=typeof o)throw new Error("Expected mapStateOnServer to either be undefined or a function.");return function(a){if("function"!=typeof a)throw new Error("Expected WrappedComponent to be a React component.");var l,c=[];function u(){l=e(c.map(function(e){return e.props})),d.canUseDOM?i(l):o&&(l=o(l))}var d=function(e){var t,s;function n(){return e.apply(this,arguments)||this}s=e,(t=n).prototype=Object.create(s.prototype),t.prototype.constructor=t,t.__proto__=s,n.peek=function(){return l},n.rewind=function(){if(n.canUseDOM)throw new Error("You may only call rewind() on the server. Call peek() to read the current state.");var e=l;return l=void 0,c=[],e};var i=n.prototype;return i.UNSAFE_componentWillMount=function(){c.push(this),u()},i.componentDidUpdate=function(){u()},i.componentWillUnmount=function(){var e=c.indexOf(this);c.splice(e,1),u()},i.render=function(){return r.createElement(a,this.props)},n}(t.PureComponent);return s(d,"displayName","SideEffect("+function(e){return e.displayName||e.name||"Component"}(a)+")"),s(d,"canUseDOM",n),d}}}());var ze,He;const qe=p(function(){if(He)return ze;He=1;var e="undefined"!=typeof Element,t="function"==typeof Map,r="function"==typeof Set,s="function"==typeof ArrayBuffer&&!!ArrayBuffer.isView;function n(i,o){if(i===o)return!0;if(i&&o&&"object"==typeof i&&"object"==typeof o){if(i.constructor!==o.constructor)return!1;var a,l,c,u;if(Array.isArray(i)){if((a=i.length)!=o.length)return!1;for(l=a;0!==l--;)if(!n(i[l],o[l]))return!1;return!0}if(t&&i instanceof Map&&o instanceof Map){if(i.size!==o.size)return!1;for(u=i.entries();!(l=u.next()).done;)if(!o.has(l.value[0]))return!1;for(u=i.entries();!(l=u.next()).done;)if(!n(l.value[1],o.get(l.value[0])))return!1;return!0}if(r&&i instanceof Set&&o instanceof Set){if(i.size!==o.size)return!1;for(u=i.entries();!(l=u.next()).done;)if(!o.has(l.value[0]))return!1;return!0}if(s&&ArrayBuffer.isView(i)&&ArrayBuffer.isView(o)){if((a=i.length)!=o.length)return!1;for(l=a;0!==l--;)if(i[l]!==o[l])return!1;return!0}if(i.constructor===RegExp)return i.source===o.source&&i.flags===o.flags;if(i.valueOf!==Object.prototype.valueOf&&"function"==typeof i.valueOf&&"function"==typeof o.valueOf)return i.valueOf()===o.valueOf();if(i.toString!==Object.prototype.toString&&"function"==typeof i.toString&&"function"==typeof o.toString)return i.toString()===o.toString();if((a=(c=Object.keys(i)).length)!==Object.keys(o).length)return!1;for(l=a;0!==l--;)if(!Object.prototype.hasOwnProperty.call(o,c[l]))return!1;if(e&&i instanceof Element)return!1;for(l=a;0!==l--;)if(("_owner"!==c[l]&&"__v"!==c[l]&&"__o"!==c[l]||!i.$$typeof)&&!n(i[c[l]],o[c[l]]))return!1;return!0}return i!=i&&o!=o}return ze=function(e,t){try{return n(e,t)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}}}());
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var Ve,We;const Je=p(function(){if(We)return Ve;We=1;var e=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;return Ve=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var s={};return"abcdefghijklmnopqrst".split("").forEach(function(e){s[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},s)).join("")}catch(n){return!1}}()?Object.assign:function(s,n){for(var i,o,a=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(s),l=1;l<arguments.length;l++){for(var c in i=Object(arguments[l]))t.call(i,c)&&(a[c]=i[c]);if(e){o=e(i);for(var u=0;u<o.length;u++)r.call(i,o[u])&&(a[o[u]]=i[o[u]])}}return a}}());var Ge="bodyAttributes",Ke="htmlAttributes",Ye="titleAttributes",Qe={BASE:"base",BODY:"body",HEAD:"head",HTML:"html",LINK:"link",META:"meta",NOSCRIPT:"noscript",SCRIPT:"script",STYLE:"style",TITLE:"title"};Object.keys(Qe).map(function(e){return Qe[e]});var Xe,Ze,et,tt,rt="charset",st="cssText",nt="href",it="http-equiv",ot="innerHTML",at="itemprop",lt="name",ct="property",ut="rel",dt="src",ht="target",ft={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},pt="defaultTitle",mt="defer",gt="encodeSpecialCharacters",yt="onChangeClientState",bt="titleTemplate",vt=Object.keys(ft).reduce(function(e,t){return e[ft[t]]=t,e},{}),wt=[Qe.NOSCRIPT,Qe.SCRIPT,Qe.STYLE],_t="data-react-helmet",xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jt=function(){function e(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,r,s){return r&&e(t.prototype,r),s&&e(t,s),t}}(),kt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Tt=function(e,t){var r={};for(var s in e)t.indexOf(s)>=0||Object.prototype.hasOwnProperty.call(e,s)&&(r[s]=e[s]);return r},St=function(e){return!1===(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])?String(e):String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},Et=function(e){var t=At(e,Qe.TITLE),r=At(e,bt);if(r&&t)return r.replace(/%s/g,function(){return Array.isArray(t)?t.join(""):t});var s=At(e,pt);return t||s||void 0},Ot=function(e){return At(e,yt)||function(){}},Nt=function(e,t){return t.filter(function(t){return void 0!==t[e]}).map(function(t){return t[e]}).reduce(function(e,t){return kt({},e,t)},{})},Pt=function(e,t){return t.filter(function(e){return void 0!==e[Qe.BASE]}).map(function(e){return e[Qe.BASE]}).reverse().reduce(function(t,r){if(!t.length)for(var s=Object.keys(r),n=0;n<s.length;n++){var i=s[n].toLowerCase();if(-1!==e.indexOf(i)&&r[i])return t.concat(r)}return t},[])},Ct=function(e,t,r){var s={};return r.filter(function(t){return!!Array.isArray(t[e])||(void 0!==t[e]&&Dt("Helmet: "+e+' should be of type "Array". Instead found type "'+xt(t[e])+'"'),!1)}).map(function(t){return t[e]}).reverse().reduce(function(e,r){var n={};r.filter(function(e){for(var r=void 0,i=Object.keys(e),o=0;o<i.length;o++){var a=i[o],l=a.toLowerCase();-1===t.indexOf(l)||r===ut&&"canonical"===e[r].toLowerCase()||l===ut&&"stylesheet"===e[l].toLowerCase()||(r=l),-1===t.indexOf(a)||a!==ot&&a!==st&&a!==at||(r=a)}if(!r||!e[r])return!1;var c=e[r].toLowerCase();return s[r]||(s[r]={}),n[r]||(n[r]={}),!s[r][c]&&(n[r][c]=!0,!0)}).reverse().forEach(function(t){return e.push(t)});for(var i=Object.keys(n),o=0;o<i.length;o++){var a=i[o],l=Je({},s[a],n[a]);s[a]=l}return e},[]).reverse()},At=function(e,t){for(var r=e.length-1;r>=0;r--){var s=e[r];if(s.hasOwnProperty(t))return s[t]}return null},It=(Xe=Date.now(),function(e){var t=Date.now();t-Xe>16?(Xe=t,e(t)):setTimeout(function(){It(e)},0)}),Rt=function(e){return clearTimeout(e)},$t="undefined"!=typeof window?window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||It:global.requestAnimationFrame||It,Lt="undefined"!=typeof window?window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||Rt:global.cancelAnimationFrame||Rt,Dt=function(e){return console&&"function"==typeof console.warn&&console.warn(e)},Ut=null,Bt=function(e,t){var r=e.baseTag,s=e.bodyAttributes,n=e.htmlAttributes,i=e.linkTags,o=e.metaTags,a=e.noscriptTags,l=e.onChangeClientState,c=e.scriptTags,u=e.styleTags,d=e.title,h=e.titleAttributes;zt(Qe.BODY,s),zt(Qe.HTML,n),Ft(d,h);var f={baseTag:Ht(Qe.BASE,r),linkTags:Ht(Qe.LINK,i),metaTags:Ht(Qe.META,o),noscriptTags:Ht(Qe.NOSCRIPT,a),scriptTags:Ht(Qe.SCRIPT,c),styleTags:Ht(Qe.STYLE,u)},p={},m={};Object.keys(f).forEach(function(e){var t=f[e],r=t.newTags,s=t.oldTags;r.length&&(p[e]=r),s.length&&(m[e]=f[e].oldTags)}),t&&t(),l(e,p,m)},Mt=function(e){return Array.isArray(e)?e.join(""):e},Ft=function(e,t){void 0!==e&&document.title!==e&&(document.title=Mt(e)),zt(Qe.TITLE,t)},zt=function(e,t){var r=document.getElementsByTagName(e)[0];if(r){for(var s=r.getAttribute(_t),n=s?s.split(","):[],i=[].concat(n),o=Object.keys(t),a=0;a<o.length;a++){var l=o[a],c=t[l]||"";r.getAttribute(l)!==c&&r.setAttribute(l,c),-1===n.indexOf(l)&&n.push(l);var u=i.indexOf(l);-1!==u&&i.splice(u,1)}for(var d=i.length-1;d>=0;d--)r.removeAttribute(i[d]);n.length===i.length?r.removeAttribute(_t):r.getAttribute(_t)!==o.join(",")&&r.setAttribute(_t,o.join(","))}},Ht=function(e,t){var r=document.head||document.querySelector(Qe.HEAD),s=r.querySelectorAll(e+"["+_t+"]"),n=Array.prototype.slice.call(s),i=[],o=void 0;return t&&t.length&&t.forEach(function(t){var r=document.createElement(e);for(var s in t)if(t.hasOwnProperty(s))if(s===ot)r.innerHTML=t.innerHTML;else if(s===st)r.styleSheet?r.styleSheet.cssText=t.cssText:r.appendChild(document.createTextNode(t.cssText));else{var a=void 0===t[s]?"":t[s];r.setAttribute(s,a)}r.setAttribute(_t,"true"),n.some(function(e,t){return o=t,r.isEqualNode(e)})?n.splice(o,1):i.push(r)}),n.forEach(function(e){return e.parentNode.removeChild(e)}),i.forEach(function(e){return r.appendChild(e)}),{oldTags:n,newTags:i}},qt=function(e){return Object.keys(e).reduce(function(t,r){var s=void 0!==e[r]?r+'="'+e[r]+'"':""+r;return t?t+" "+s:s},"")},Vt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(e).reduce(function(t,r){return t[ft[r]||r]=e[r],t},t)},Wt=function(e,t,r){switch(e){case Qe.TITLE:return{toComponent:function(){return e=t.title,r=t.titleAttributes,(s={key:e})[_t]=!0,n=Vt(r,s),[g.createElement(Qe.TITLE,n,e)];var e,r,s,n},toString:function(){return function(e,t,r,s){var n=qt(r),i=Mt(t);return n?"<"+e+" "+_t+'="true" '+n+">"+St(i,s)+"</"+e+">":"<"+e+" "+_t+'="true">'+St(i,s)+"</"+e+">"}(e,t.title,t.titleAttributes,r)}};case Ge:case Ke:return{toComponent:function(){return Vt(t)},toString:function(){return qt(t)}};default:return{toComponent:function(){return function(e,t){return t.map(function(t,r){var s,n=((s={key:r})[_t]=!0,s);return Object.keys(t).forEach(function(e){var r=ft[e]||e;if(r===ot||r===st){var s=t.innerHTML||t.cssText;n.dangerouslySetInnerHTML={__html:s}}else n[r]=t[e]}),g.createElement(e,n)})}(e,t)},toString:function(){return function(e,t,r){return t.reduce(function(t,s){var n=Object.keys(s).filter(function(e){return!(e===ot||e===st)}).reduce(function(e,t){var n=void 0===s[t]?t:t+'="'+St(s[t],r)+'"';return e?e+" "+n:n},""),i=s.innerHTML||s.cssText||"",o=-1===wt.indexOf(e);return t+"<"+e+" "+_t+'="true" '+n+(o?"/>":">"+i+"</"+e+">")},"")}(e,t,r)}}}},Jt=function(e){var t=e.baseTag,r=e.bodyAttributes,s=e.encode,n=e.htmlAttributes,i=e.linkTags,o=e.metaTags,a=e.noscriptTags,l=e.scriptTags,c=e.styleTags,u=e.title,d=void 0===u?"":u,h=e.titleAttributes;return{base:Wt(Qe.BASE,t,s),bodyAttributes:Wt(Ge,r,s),htmlAttributes:Wt(Ke,n,s),link:Wt(Qe.LINK,i,s),meta:Wt(Qe.META,o,s),noscript:Wt(Qe.NOSCRIPT,a,s),script:Wt(Qe.SCRIPT,l,s),style:Wt(Qe.STYLE,c,s),title:Wt(Qe.TITLE,{title:d,titleAttributes:h},s)}},Gt=Fe(function(e){return{baseTag:Pt([nt,ht],e),bodyAttributes:Nt(Ge,e),defer:At(e,mt),encode:At(e,gt),htmlAttributes:Nt(Ke,e),linkTags:Ct(Qe.LINK,[ut,nt],e),metaTags:Ct(Qe.META,[lt,rt,it,ct,at],e),noscriptTags:Ct(Qe.NOSCRIPT,[ot],e),onChangeClientState:Ot(e),scriptTags:Ct(Qe.SCRIPT,[dt,ot],e),styleTags:Ct(Qe.STYLE,[st],e),title:Et(e),titleAttributes:Nt(Ye,e)}},function(e){Ut&&Lt(Ut),e.defer?Ut=$t(function(){Bt(e,function(){Ut=null})}):(Bt(e),Ut=null)},Jt)(function(){return null}),Kt=(Ze=Gt,tt=et=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.shouldComponentUpdate=function(e){return!qe(this.props,e)},t.prototype.mapNestedChildrenToProps=function(e,t){if(!t)return null;switch(e.type){case Qe.SCRIPT:case Qe.NOSCRIPT:return{innerHTML:t};case Qe.STYLE:return{cssText:t}}throw new Error("<"+e.type+" /> elements are self-closing and can not contain children. Refer to our API for more information.")},t.prototype.flattenArrayTypeChildren=function(e){var t,r=e.child,s=e.arrayTypeChildren,n=e.newChildProps,i=e.nestedChildren;return kt({},s,((t={})[r.type]=[].concat(s[r.type]||[],[kt({},n,this.mapNestedChildrenToProps(r,i))]),t))},t.prototype.mapObjectTypeChildren=function(e){var t,r,s=e.child,n=e.newProps,i=e.newChildProps,o=e.nestedChildren;switch(s.type){case Qe.TITLE:return kt({},n,((t={})[s.type]=o,t.titleAttributes=kt({},i),t));case Qe.BODY:return kt({},n,{bodyAttributes:kt({},i)});case Qe.HTML:return kt({},n,{htmlAttributes:kt({},i)})}return kt({},n,((r={})[s.type]=kt({},i),r))},t.prototype.mapArrayTypeChildrenToProps=function(e,t){var r=kt({},t);return Object.keys(e).forEach(function(t){var s;r=kt({},r,((s={})[t]=e[t],s))}),r},t.prototype.warnOnInvalidChildren=function(e,t){return!0},t.prototype.mapChildrenToProps=function(e,t){var r=this,s={};return g.Children.forEach(e,function(e){if(e&&e.props){var n=e.props,i=n.children,o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(e).reduce(function(t,r){return t[vt[r]||r]=e[r],t},t)}(Tt(n,["children"]));switch(r.warnOnInvalidChildren(e,i),e.type){case Qe.LINK:case Qe.META:case Qe.NOSCRIPT:case Qe.SCRIPT:case Qe.STYLE:s=r.flattenArrayTypeChildren({child:e,arrayTypeChildren:s,newChildProps:o,nestedChildren:i});break;default:t=r.mapObjectTypeChildren({child:e,newProps:t,newChildProps:o,nestedChildren:i})}}}),t=this.mapArrayTypeChildrenToProps(s,t)},t.prototype.render=function(){var e=this.props,t=e.children,r=Tt(e,["children"]),s=kt({},r);return t&&(s=this.mapChildrenToProps(t,s)),g.createElement(Ze,s)},jt(t,null,[{key:"canUseDOM",set:function(e){Ze.canUseDOM=e}}]),t}(g.Component),et.propTypes={base:Ue.object,bodyAttributes:Ue.object,children:Ue.oneOfType([Ue.arrayOf(Ue.node),Ue.node]),defaultTitle:Ue.string,defer:Ue.bool,encodeSpecialCharacters:Ue.bool,htmlAttributes:Ue.object,link:Ue.arrayOf(Ue.object),meta:Ue.arrayOf(Ue.object),noscript:Ue.arrayOf(Ue.object),onChangeClientState:Ue.func,script:Ue.arrayOf(Ue.object),style:Ue.arrayOf(Ue.object),title:Ue.string,titleAttributes:Ue.object,titleTemplate:Ue.string},et.defaultProps={defer:!0,encodeSpecialCharacters:!0},et.peek=Ze.peek,et.rewind=function(){var e=Ze.rewind();return e||(e=Jt({baseTag:[],bodyAttributes:{},htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}})),e},tt);function Yt(...e){return N(P(e))}Kt.renderStatic=Kt.rewind;const Qt=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,Xt=P,Zt=(e,t)=>r=>{var s;if(null==(null==t?void 0:t.variants))return Xt(e,null==r?void 0:r.class,null==r?void 0:r.className);const{variants:n,defaultVariants:i}=t,o=Object.keys(n).map(e=>{const t=null==r?void 0:r[e],s=null==i?void 0:i[e];if(null===t)return null;const o=Qt(t)||Qt(s);return n[e][o]}),a=r&&Object.entries(r).reduce((e,t)=>{let[r,s]=t;return void 0===s||(e[r]=s),e},{}),l=null==t||null===(s=t.compoundVariants)||void 0===s?void 0:s.reduce((e,t)=>{let{class:r,className:s,...n}=t;return Object.entries(n).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...i,...a}[t]):{...i,...a}[t]===r})?[...e,r,s]:e},[]);return Xt(e,o,l,null==r?void 0:r.class,null==r?void 0:r.className)},er=a,tr=g.forwardRef(({className:r,...s},n)=>e.jsx(t,{ref:n,className:Yt("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",r),...s}));tr.displayName=t.displayName;const rr=Zt("data-[swipe=move]:transition-none group relative pointer-events-auto flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full data-[state=closed]:slide-out-to-right-full",{variants:{variant:{default:"bg-background border",destructive:"group destructive border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),sr=g.forwardRef(({className:t,variant:s,...n},i)=>e.jsx(r,{ref:i,className:Yt(rr({variant:s}),t),...n}));sr.displayName=r.displayName;g.forwardRef(({className:t,...r},n)=>e.jsx(s,{ref:n,className:Yt("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-destructive/30 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...r})).displayName=s.displayName;const nr=g.forwardRef(({className:t,...r},s)=>e.jsx(n,{ref:s,className:Yt("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...r,children:e.jsx(C,{className:"h-4 w-4"})}));nr.displayName=n.displayName;const ir=g.forwardRef(({className:t,...r},s)=>e.jsx(i,{ref:s,className:Yt("text-sm font-semibold",t),...r}));ir.displayName=i.displayName;const or=g.forwardRef(({className:t,...r},s)=>e.jsx(o,{ref:s,className:Yt("text-sm opacity-90",t),...r}));or.displayName=o.displayName;let ar=0;const lr={state:{toasts:[]},listeners:[],getState:()=>lr.state,setState:e=>{lr.state="function"==typeof e?e(lr.state):{...lr.state,...e},lr.listeners.forEach(e=>e(lr.state))},subscribe:e=>(lr.listeners.push(e),()=>{lr.listeners=lr.listeners.filter(t=>t!==e)})},cr=({...e})=>{const t=(ar=(ar+1)%Number.MAX_VALUE,ar.toString()),r=()=>lr.setState(e=>({...e,toasts:e.toasts.filter(e=>e.id!==t)}));return lr.setState(s=>({...s,toasts:[{...e,id:t,dismiss:r},...s.toasts].slice(0,1)})),{id:t,dismiss:r,update:e=>lr.setState(r=>({...r,toasts:r.toasts.map(r=>r.id===t?{...r,...e}:r)}))}};function ur(){const[e,t]=y.useState(lr.getState());return y.useEffect(()=>lr.subscribe(e=>{t(e)}),[]),y.useEffect(()=>{const t=[];return e.toasts.forEach(e=>{if(e.duration===1/0)return;const r=setTimeout(()=>{e.dismiss()},e.duration||5e3);t.push(r)}),()=>{t.forEach(e=>clearTimeout(e))}},[e.toasts]),{toast:cr,toasts:e.toasts}}function dr(){const{toasts:t}=ur();return e.jsxs(er,{children:[t.map(({id:t,title:r,description:s,action:n,...i})=>e.jsxs(sr,{...i,children:[e.jsxs("div",{className:"grid gap-1",children:[r&&e.jsx(ir,{children:r}),s&&e.jsx(or,{children:s})]}),n,e.jsx(nr,{})]},t)),e.jsx(tr,{})]})}class hr extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class fr extends hr{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class pr extends hr{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class mr extends hr{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var gr,yr;(yr=gr||(gr={})).Any="any",yr.ApNortheast1="ap-northeast-1",yr.ApNortheast2="ap-northeast-2",yr.ApSouth1="ap-south-1",yr.ApSoutheast1="ap-southeast-1",yr.ApSoutheast2="ap-southeast-2",yr.CaCentral1="ca-central-1",yr.EuCentral1="eu-central-1",yr.EuWest1="eu-west-1",yr.EuWest2="eu-west-2",yr.EuWest3="eu-west-3",yr.SaEast1="sa-east-1",yr.UsEast1="us-east-1",yr.UsWest1="us-west-1",yr.UsWest2="us-west-2";var br=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};class vr{constructor(e,{headers:t={},customFetch:r,region:s=gr.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=(e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Oe(async()=>{const{default:e}=await Promise.resolve().then(()=>Ar);return{default:e}},void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)})(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return br(this,arguments,void 0,function*(e,t={}){var r;try{const{headers:s,method:n,body:i,signal:o}=t;let a={},{region:l}=t;l||(l=this.region);const c=new URL(`${this.url}/${e}`);let u;l&&"any"!==l&&(a["x-region"]=l,c.searchParams.set("forceFunctionRegion",l)),i&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&("undefined"!=typeof Blob&&i instanceof Blob||i instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",u=i):"string"==typeof i?(a["Content-Type"]="text/plain",u=i):"undefined"!=typeof FormData&&i instanceof FormData?u=i:(a["Content-Type"]="application/json",u=JSON.stringify(i)));const d=yield this.fetch(c.toString(),{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:u,signal:o}).catch(e=>{if("AbortError"===e.name)throw e;throw new fr(e)}),h=d.headers.get("x-relay-error");if(h&&"true"===h)throw new pr(d);if(!d.ok)throw new mr(d);let f,p=(null!==(r=d.headers.get("Content-Type"))&&void 0!==r?r:"text/plain").split(";")[0].trim();return f="application/json"===p?yield d.json():"application/octet-stream"===p?yield d.blob():"text/event-stream"===p?d:"multipart/form-data"===p?yield d.formData():yield d.text(),{data:f,error:null,response:d}}catch(s){return s instanceof Error&&"AbortError"===s.name?{data:null,error:new fr(s)}:{data:null,error:s,response:s instanceof mr||s instanceof pr?s.context:void 0}}})}}var wr={},_r={},xr={},jr={},kr={},Tr={},Sr=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();const Er=Sr.fetch,Or=Sr.fetch.bind(Sr),Nr=Sr.Headers,Pr=Sr.Request,Cr=Sr.Response,Ar=Object.freeze(Object.defineProperty({__proto__:null,Headers:Nr,Request:Pr,Response:Cr,default:Or,fetch:Er},Symbol.toStringTag,{value:"Module"})),Ir=b(Ar);var Rr,$r,Lr,Dr,Ur,Br,Mr,Fr={};function zr(){if(Rr)return Fr;Rr=1,Object.defineProperty(Fr,"__esModule",{value:!0});class e extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}return Fr.default=e,Fr}function Hr(){if($r)return Tr;$r=1;var e=Tr&&Tr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Tr,"__esModule",{value:!0});const t=e(Ir),r=e(zr());return Tr.default=class{constructor(e){var r,s;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!==(r=e.shouldThrowOnError)&&void 0!==r&&r,this.signal=e.signal,this.isMaybeSingle=null!==(s=e.isMaybeSingle)&&void 0!==s&&s,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=t.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{var t,s,n,i;let o=null,a=null,l=null,c=e.status,u=e.statusText;if(e.ok){if("HEAD"!==this.method){const r=await e.text();""===r||(a="text/csv"===this.headers.get("Accept")||this.headers.get("Accept")&&(null===(t=this.headers.get("Accept"))||void 0===t?void 0:t.includes("application/vnd.pgrst.plan+text"))?r:JSON.parse(r))}const r=null===(s=this.headers.get("Prefer"))||void 0===s?void 0:s.match(/count=(exact|planned|estimated)/),i=null===(n=e.headers.get("content-range"))||void 0===n?void 0:n.split("/");r&&i&&i.length>1&&(l=parseInt(i[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(a)&&(a.length>1?(o={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,l=null,c=406,u="Not Acceptable"):a=1===a.length?a[0]:null)}else{const t=await e.text();try{o=JSON.parse(t),Array.isArray(o)&&404===e.status&&(a=[],o=null,c=200,u="OK")}catch(d){404===e.status&&""===t?(c=204,u="No Content"):o={message:t}}if(o&&this.isMaybeSingle&&(null===(i=null==o?void 0:o.details)||void 0===i?void 0:i.includes("0 rows"))&&(o=null,c=200,u="OK"),o&&this.shouldThrowOnError)throw new r.default(o)}return{error:o,data:a,count:l,status:c,statusText:u}});return this.shouldThrowOnError||(s=s.catch(e=>{var t,r,s;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(r=null==e?void 0:e.stack)&&void 0!==r?r:""}`,hint:"",code:`${null!==(s=null==e?void 0:e.code)&&void 0!==s?s:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}returns(){return this}overrideTypes(){return this}},Tr}function qr(){if(Lr)return kr;Lr=1;var e=kr&&kr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(kr,"__esModule",{value:!0});const t=e(Hr());class r extends t.default{select(e){let t=!1;const r=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s,referencedTable:n=s}={}){const i=n?`${n}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${void 0===r?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const s=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:s=r}={}){const n=void 0===s?"offset":`${s}.offset`,i=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(i,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:n=!1,format:i="text"}={}){var o;const a=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=null!==(o=this.headers.get("Accept"))&&void 0!==o?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${l}"; options=${a};`),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}}return kr.default=r,kr}function Vr(){if(Dr)return jr;Dr=1;var e=jr&&jr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(jr,"__esModule",{value:!0});const t=e(qr());class r extends t.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let n="";"plain"===s?n="pl":"phrase"===s?n="ph":"websearch"===s&&(n="w");const i=void 0===r?"":`(${r})`;return this.url.searchParams.append(e,`${n}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}}return jr.default=r,jr}function Wr(){if(Ur)return xr;Ur=1;var e=xr&&xr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(xr,"__esModule",{value:!0});const t=e(Vr());return xr.default=class{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=new Headers(t),this.schema=r,this.fetch=s}select(e,{head:r=!1,count:s}={}){const n=r?"HEAD":"GET";let i=!1;const o=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!i?"":('"'===e&&(i=!i),e)).join("");return this.url.searchParams.set("select",o),s&&this.headers.append("Prefer",`count=${s}`),new t.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:r,defaultToNull:s=!0}={}){var n;if(r&&this.headers.append("Prefer",`count=${r}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new t.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(n=this.fetch)&&void 0!==n?n:fetch})}upsert(e,{onConflict:r,ignoreDuplicates:s=!1,count:n,defaultToNull:i=!0}={}){var o;if(this.headers.append("Prefer",`resolution=${s?"ignore":"merge"}-duplicates`),void 0!==r&&this.url.searchParams.set("on_conflict",r),n&&this.headers.append("Prefer",`count=${n}`),i||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new t.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(o=this.fetch)&&void 0!==o?o:fetch})}update(e,{count:r}={}){var s;return r&&this.headers.append("Prefer",`count=${r}`),new t.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(s=this.fetch)&&void 0!==s?s:fetch})}delete({count:e}={}){var r;return e&&this.headers.append("Prefer",`count=${e}`),new t.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!==(r=this.fetch)&&void 0!==r?r:fetch})}},xr}const Jr=p(function(){if(Mr)return wr;Mr=1;var e=wr&&wr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(wr,"__esModule",{value:!0}),wr.PostgrestError=wr.PostgrestBuilder=wr.PostgrestTransformBuilder=wr.PostgrestFilterBuilder=wr.PostgrestQueryBuilder=wr.PostgrestClient=void 0;const t=e(function(){if(Br)return _r;Br=1;var e=_r&&_r.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(_r,"__esModule",{value:!0});const t=e(Wr()),r=e(Vr());class s{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=new Headers(t),this.schemaName=r,this.fetch=s}from(e){const r=new URL(`${this.url}/${e}`);return new t.default(r,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new s(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:n=!1,count:i}={}){var o;let a;const l=new URL(`${this.url}/rpc/${e}`);let c;s||n?(a=s?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{l.searchParams.append(e,t)})):(a="POST",c=t);const u=new Headers(this.headers);return i&&u.set("Prefer",`count=${i}`),new r.default({method:a,url:l,headers:u,schema:this.schemaName,body:c,fetch:null!==(o=this.fetch)&&void 0!==o?o:fetch})}}return _r.default=s,_r}());wr.PostgrestClient=t.default;const r=e(Wr());wr.PostgrestQueryBuilder=r.default;const s=e(Vr());wr.PostgrestFilterBuilder=s.default;const n=e(qr());wr.PostgrestTransformBuilder=n.default;const i=e(Hr());wr.PostgrestBuilder=i.default;const o=e(zr());return wr.PostgrestError=o.default,wr.default={PostgrestClient:t.default,PostgrestQueryBuilder:r.default,PostgrestFilterBuilder:s.default,PostgrestTransformBuilder:n.default,PostgrestBuilder:i.default,PostgrestError:o.default},wr}()),{PostgrestClient:Gr,PostgrestQueryBuilder:Kr,PostgrestFilterBuilder:Yr,PostgrestTransformBuilder:Qr,PostgrestBuilder:Xr,PostgrestError:Zr}=Jr;class es{static detectEnvironment(){var e;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!=typeof global&&void 0!==global.WebSocket)return{type:"native",constructor:global.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if("undefined"!=typeof process){const e=process.versions;if(e&&e.node){const t=e.node,r=parseInt(t.replace(/^v/,"").split(".")[0]);return r>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`\n\nSuggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}}const ts=1e4;var rs,ss,ns,is,os,as,ls,cs,us,ds,hs;(ss=rs||(rs={}))[ss.connecting=0]="connecting",ss[ss.open=1]="open",ss[ss.closing=2]="closing",ss[ss.closed=3]="closed",(is=ns||(ns={})).closed="closed",is.errored="errored",is.joined="joined",is.joining="joining",is.leaving="leaving",(as=os||(os={})).close="phx_close",as.error="phx_error",as.join="phx_join",as.reply="phx_reply",as.leave="phx_leave",as.access_token="access_token",(ls||(ls={})).websocket="websocket",(us=cs||(cs={})).Connecting="connecting",us.Open="open",us.Closing="closing",us.Closed="closed";class fs{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),n=t.getUint8(2);let i=this.HEADER_LENGTH+2;const o=r.decode(e.slice(i,i+s));i+=s;const a=r.decode(e.slice(i,i+n));i+=n;return{ref:null,topic:o,event:a,payload:JSON.parse(r.decode(e.slice(i,e.byteLength)))}}}class ps{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(hs=ds||(ds={})).abstime="abstime",hs.bool="bool",hs.date="date",hs.daterange="daterange",hs.float4="float4",hs.float8="float8",hs.int2="int2",hs.int4="int4",hs.int4range="int4range",hs.int8="int8",hs.int8range="int8range",hs.json="json",hs.jsonb="jsonb",hs.money="money",hs.numeric="numeric",hs.oid="oid",hs.reltime="reltime",hs.text="text",hs.time="time",hs.timestamp="timestamp",hs.timestamptz="timestamptz",hs.timetz="timetz",hs.tsrange="tsrange",hs.tstzrange="tstzrange";const ms=(e,t,r={})=>{var s;const n=null!==(s=r.skipTypes)&&void 0!==s?s:[];return t?Object.keys(t).reduce((r,s)=>(r[s]=gs(s,e,t,n),r),{}):{}},gs=(e,t,r,s)=>{const n=t.find(t=>t.name===e),i=null==n?void 0:n.type,o=r[e];return i&&!s.includes(i)?ys(i,o):bs(o)},ys=(e,t)=>{if("_"===e.charAt(0)){const r=e.slice(1,e.length);return xs(t,r)}switch(e){case ds.bool:return vs(t);case ds.float4:case ds.float8:case ds.int2:case ds.int4:case ds.int8:case ds.numeric:case ds.oid:return ws(t);case ds.json:case ds.jsonb:return _s(t);case ds.timestamp:return js(t);case ds.abstime:case ds.date:case ds.daterange:case ds.int4range:case ds.int8range:case ds.money:case ds.reltime:case ds.text:case ds.time:case ds.timestamptz:case ds.timetz:case ds.tsrange:case ds.tstzrange:default:return bs(t)}},bs=e=>e,vs=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},ws=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},_s=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},xs=(e,t)=>{if("string"!=typeof e)return e;const r=e.length-1,s=e[r];if("{"===e[0]&&"}"===s){let s;const i=e.slice(1,r);try{s=JSON.parse("["+i+"]")}catch(n){s=i?i.split(","):[]}return s.map(e=>ys(t,e))}return e},js=e=>"string"==typeof e?e.replace(" ","T"):e,ks=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"};class Ts{constructor(e,t,r={},s=1e4){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t(null===(r=this.receivedResp)||void 0===r?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Ss,Es,Os,Ns,Ps,Cs,As,Is;(Es=Ss||(Ss={})).SYNC="sync",Es.JOIN="join",Es.LEAVE="leave";class Rs{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},e=>{const{onJoin:t,onLeave:r,onSync:s}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Rs.syncState(this.state,e,t,r),this.pendingDiffs.forEach(e=>{this.state=Rs.syncDiff(this.state,e,t,r)}),this.pendingDiffs=[],s()}),this.channel._on(r.diff,{},e=>{const{onJoin:t,onLeave:r,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=Rs.syncDiff(this.state,e,t,r),s())}),this.onJoin((e,t,r)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:r})}),this.onLeave((e,t,r)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:r})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const n=this.cloneDeep(e),i=this.transformState(t),o={},a={};return this.map(n,(e,t)=>{i[e]||(a[e]=t)}),this.map(i,(e,t)=>{const r=n[e];if(r){const s=t.map(e=>e.presence_ref),n=r.map(e=>e.presence_ref),i=t.filter(e=>n.indexOf(e.presence_ref)<0),l=r.filter(e=>s.indexOf(e.presence_ref)<0);i.length>0&&(o[e]=i),l.length>0&&(a[e]=l)}else o[e]=t}),this.syncDiff(n,{joins:o,leaves:a},r,s)}static syncDiff(e,t,r,s){const{joins:n,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(n,(t,s)=>{var n;const i=null!==(n=e[t])&&void 0!==n?n:[];if(e[t]=this.cloneDeep(s),i.length>0){const r=e[t].map(e=>e.presence_ref),s=i.filter(e=>r.indexOf(e.presence_ref)<0);e[t].unshift(...s)}r(t,i,s)}),this.map(i,(t,r)=>{let n=e[t];if(!n)return;const i=r.map(e=>e.presence_ref);n=n.filter(e=>i.indexOf(e.presence_ref)<0),e[t]=n,s(t,n,r),0===n.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return t[r]="metas"in s?s.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(Ns=Os||(Os={})).ALL="*",Ns.INSERT="INSERT",Ns.UPDATE="UPDATE",Ns.DELETE="DELETE",(Cs=Ps||(Ps={})).BROADCAST="broadcast",Cs.PRESENCE="presence",Cs.POSTGRES_CHANGES="postgres_changes",Cs.SYSTEM="system",(Is=As||(As={})).SUBSCRIBED="SUBSCRIBED",Is.TIMED_OUT="TIMED_OUT",Is.CLOSED="CLOSED",Is.CHANNEL_ERROR="CHANNEL_ERROR";class $s{constructor(e,t={config:{}},r){var s,n;if(this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=ns.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Ts(this,os.join,this.params,this.timeout),this.rejoinTimer=new ps(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=ns.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=ns.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=ns.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=ns.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=ns.errored,this.rejoinTimer.scheduleTimeout())}),this._on(os.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new Rs(this),this.broadcastEndpointURL=ks(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null===(n=null===(s=this.params.config)||void 0===s?void 0:s.broadcast)||void 0===n?void 0:n.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var r,s,n;if(this.socket.isConnected()||this.socket.connect(),this.state==ns.closed){const{config:{broadcast:i,presence:o,private:a}}=this.params,l=null!==(s=null===(r=this.bindings.postgres_changes)||void 0===r?void 0:r.map(e=>e.filter))&&void 0!==s?s:[],c=!!this.bindings[Ps.PRESENCE]&&this.bindings[Ps.PRESENCE].length>0||!0===(null===(n=this.params.config.presence)||void 0===n?void 0:n.enabled),u={},d={broadcast:i,presence:Object.assign(Object.assign({},o),{enabled:c}),postgres_changes:l,private:a};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this._onError(t=>null==e?void 0:e(As.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(As.CLOSED)),this.updateJoinPayload(Object.assign({config:d},u)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:t})=>{var r;if(this.socket.setAuth(),void 0!==t){const s=this.bindings.postgres_changes,n=null!==(r=null==s?void 0:s.length)&&void 0!==r?r:0,i=[];for(let r=0;r<n;r++){const n=s[r],{filter:{event:o,schema:a,table:l,filter:c}}=n,u=t&&t[r];if(!u||u.event!==o||u.schema!==a||u.table!==l||u.filter!==c)return this.unsubscribe(),this.state=ns.errored,void(null==e||e(As.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));i.push(Object.assign(Object.assign({},n),{id:u.id}))}return this.bindings.postgres_changes=i,void(e&&e(As.SUBSCRIBED))}null==e||e(As.SUBSCRIBED)}).receive("error",t=>{this.state=ns.errored,null==e||e(As.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(As.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===ns.joined&&e===Ps.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}async send(e,t={}){var r,s;if(this._canPush()||"broadcast"!==e.type)return new Promise(r=>{var s,n,i;const o=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(i=null===(n=null===(s=this.params)||void 0===s?void 0:s.config)||void 0===n?void 0:n.broadcast)||void 0===i?void 0:i.ack)||r("ok"),o.receive("ok",()=>r("ok")),o.receive("error",()=>r("error")),o.receive("timeout",()=>r("timed out"))});{const{event:i,payload:o}=e,a={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,a,null!==(r=t.timeout)&&void 0!==r?r:this.timeout);return await(null===(s=e.body)||void 0===s?void 0:s.cancel()),e.ok?"ok":"error"}catch(n){return"AbortError"===n.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=ns.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(os.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new Ts(this,os.leave,{},e),r.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{null==r||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=ns.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const s=new AbortController,n=setTimeout(()=>s.abort(),r),i=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(n),i}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Ts(this,e,t,r);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,n;const i=e.toLocaleLowerCase(),{close:o,error:a,leave:l,join:c}=os;if(r&&[o,a,l,c].indexOf(i)>=0&&r!==this._joinRef())return;let u=this._onMessage(i,t,r);if(t&&!u)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?null===(s=this.bindings.postgres_changes)||void 0===s||s.filter(e=>{var t,r,s;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(s=null===(r=e.filter)||void 0===r?void 0:r.event)||void 0===s?void 0:s.toLocaleLowerCase())===i}).map(e=>e.callback(u,r)):null===(n=this.bindings[i])||void 0===n||n.filter(e=>{var r,s,n,o,a,l;if(["broadcast","presence","postgres_changes"].includes(i)){if("id"in e){const i=e.id,o=null===(r=e.filter)||void 0===r?void 0:r.event;return i&&(null===(s=t.ids)||void 0===s?void 0:s.includes(i))&&("*"===o||(null==o?void 0:o.toLocaleLowerCase())===(null===(n=t.data)||void 0===n?void 0:n.type.toLocaleLowerCase()))}{const r=null===(a=null===(o=null==e?void 0:e.filter)||void 0===o?void 0:o.event)||void 0===a?void 0:a.toLocaleLowerCase();return"*"===r||r===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===i}).map(e=>{if("object"==typeof u&&"ids"in u){const e=u.data,{schema:t,table:r,commit_timestamp:s,type:n,errors:i}=e,o={schema:t,table:r,commit_timestamp:s,eventType:n,new:{},old:{},errors:i};u=Object.assign(Object.assign({},o),this._getPayloadRecords(e))}e.callback(u,r)})}_isClosed(){return this.state===ns.closed}_isJoined(){return this.state===ns.joined}_isJoining(){return this.state===ns.joining}_isLeaving(){return this.state===ns.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),n={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(n):this.bindings[s]=[n],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(e=>{var s;return!((null===(s=e.type)||void 0===s?void 0:s.toLocaleLowerCase())===r&&$s.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(os.close,{},e)}_onError(e){this._on(os.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=ns.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=ms(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=ms(e.columns,e.old_record)),t}}const Ls=()=>{},Ds=25e3,Us=10,Bs=100,Ms=[1e3,2e3,5e3,1e4];class Fs{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=ts,this.transport=null,this.heartbeatIntervalMs=Ds,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Ls,this.ref=0,this.reconnectTimer=null,this.logger=Ls,this.conn=null,this.sendBuffer=[],this.serializer=new fs,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Oe(async()=>{const{default:e}=await Promise.resolve().then(()=>Ar);return{default:e}},void 0).then(({default:t})=>t(...e)).catch(e=>{throw new Error(`Failed to load @supabase/node-fetch: ${e.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):fetch),(...e)=>t(...e)},!(null===(r=null==t?void 0:t.params)||void 0===r?void 0:r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${ls.websocket}`,this.httpEndpoint=ks(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=es.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;if(t.includes("Node.js"))throw new Error(`${t}\n\nTo use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })`);throw new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case rs.connecting:return cs.Connecting;case rs.open:return cs.Open;case rs.closing:return cs.Closing;default:return cs.Closed}}isConnected(){return this.connectionState()===cs.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e,t={config:{}}){const r=`realtime:${e}`,s=this.getChannels().find(e=>e.topic===r);if(s)return s;{const r=new $s(`realtime:${e}`,t,this);return this.channels.push(r),r}}push(e){const{topic:t,event:r,payload:s,ref:n}=e,i=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push",`${t} ${r} (${n})`,s),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}return this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},Bs)}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}else try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{if("phoenix"===e.topic&&"phx_reply"===e.event)try{this.heartbeatCallback("ok"===e.payload.status?"ok":"error")}catch(a){this.log("error","error in heartbeat callback",a)}e.ref&&e.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:t,event:r,payload:s,ref:n}=e,i=n?`(${n})`:"",o=s.status||"";this.log("receive",`${o} ${t} ${r} ${i}`.trim(),s),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(r,s,n)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(os.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const r=e.match(/\?/)?"&":"?";return`${e}${r}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e,t=!1){this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;t=e||(this.accessToken?await this.accessToken():this.accessTokenValue),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{const r={access_token:t,version:"realtime-js/2.75.0"};t&&e.updateJoinPayload(r),e.joinedOnce&&e._isJoined()&&e._push(os.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new ps(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Us)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,s,n,i,o,a,l,c;if(this.transport=null!==(t=null==e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(r=null==e?void 0:e.timeout)&&void 0!==r?r:ts,this.heartbeatIntervalMs=null!==(s=null==e?void 0:e.heartbeatIntervalMs)&&void 0!==s?s:Ds,this.worker=null!==(n=null==e?void 0:e.worker)&&void 0!==n&&n,this.accessToken=null!==(i=null==e?void 0:e.accessToken)&&void 0!==i?i:null,this.heartbeatCallback=null!==(o=null==e?void 0:e.heartbeatCallback)&&void 0!==o?o:Ls,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(a=null==e?void 0:e.reconnectAfterMs)&&void 0!==a?a:e=>Ms[e-1]||1e4,this.encode=null!==(l=null==e?void 0:e.encode)&&void 0!==l?l:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(c=null==e?void 0:e.decode)&&void 0!==c?c:this.serializer.decode.bind(this.serializer),this.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null==e?void 0:e.workerUrl}}}class zs extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Hs(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class qs extends zs{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Vs extends zs{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Ws=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};const Js=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Oe(async()=>{const{default:e}=await Promise.resolve().then(()=>Ar);return{default:e}},void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},Gs=e=>{if(Array.isArray(e))return e.map(e=>Gs(e));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([e,r])=>{const s=e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[s]=Gs(r)}),t};var Ks=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};const Ys=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Qs=(e,t,r)=>Ks(void 0,void 0,void 0,function*(){const s=yield Ws(void 0,void 0,void 0,function*(){return"undefined"==typeof Response?(yield Oe(()=>Promise.resolve().then(()=>Ar),void 0)).Response:Response});e instanceof s&&!(null==r?void 0:r.noResolveJson)?e.json().then(r=>{const s=e.status||500,n=(null==r?void 0:r.statusCode)||s+"";t(new qs(Ys(r),s,n))}).catch(e=>{t(new Vs(Ys(e),e))}):t(new Vs(Ys(e),e))}),Xs=(e,t,r,s)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&s?((e=>{if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)})(s)?(n.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),n.body=JSON.stringify(s)):n.body=s,(null==t?void 0:t.duplex)&&(n.duplex=t.duplex),Object.assign(Object.assign({},n),r)):n};function Zs(e,t,r,s,n,i){return Ks(this,void 0,void 0,function*(){return new Promise((o,a)=>{e(r,Xs(t,s,n,i)).then(e=>{if(!e.ok)throw e;return(null==s?void 0:s.noResolveJson)?e:e.json()}).then(e=>o(e)).catch(e=>Qs(e,a,s))})})}function en(e,t,r,s){return Ks(this,void 0,void 0,function*(){return Zs(e,"GET",t,r,s)})}function tn(e,t,r,s,n){return Ks(this,void 0,void 0,function*(){return Zs(e,"POST",t,s,n,r)})}function rn(e,t,r,s,n){return Ks(this,void 0,void 0,function*(){return Zs(e,"PUT",t,s,n,r)})}function sn(e,t,r,s,n){return Ks(this,void 0,void 0,function*(){return Zs(e,"DELETE",t,s,n,r)})}var nn=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};class on{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return nn(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Hs(e))return{data:null,error:e};throw e}})}}var an=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};class ln{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}asStream(){return new on(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.execute().then(e,t)}execute(){return an(this,void 0,void 0,function*(){try{const e=yield this.downloadFn();return{data:yield e.blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Hs(e))return{data:null,error:e};throw e}})}}var cn=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};const un={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},dn={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class hn{constructor(e,t={},r,s){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=r,this.fetch=Js(s)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,r,s){return cn(this,void 0,void 0,function*(){try{let n;const i=Object.assign(Object.assign({},dn),s);let o=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(i.upsert)});const a=i.metadata;"undefined"!=typeof Blob&&r instanceof Blob?(n=new FormData,n.append("cacheControl",i.cacheControl),a&&n.append("metadata",this.encodeMetadata(a)),n.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(n=r,n.append("cacheControl",i.cacheControl),a&&n.append("metadata",this.encodeMetadata(a))):(n=r,o["cache-control"]=`max-age=${i.cacheControl}`,o["content-type"]=i.contentType,a&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),(null==s?void 0:s.headers)&&(o=Object.assign(Object.assign({},o),s.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),u=yield("PUT"==e?rn:tn)(this.fetch,`${this.url}/object/${c}`,n,Object.assign({headers:o},(null==i?void 0:i.duplex)?{duplex:i.duplex}:{}));return{data:{path:l,id:u.Id,fullPath:u.Key},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Hs(n))return{data:null,error:n};throw n}})}upload(e,t,r){return cn(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return cn(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),i=this._getFinalPath(n),o=new URL(this.url+`/object/upload/sign/${i}`);o.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:dn.upsert},s),i=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&r instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(e=r,e.append("cacheControl",t.cacheControl)):(e=r,i["cache-control"]=`max-age=${t.cacheControl}`,i["content-type"]=t.contentType);return{data:{path:n,fullPath:(yield rn(this.fetch,o.toString(),e,{headers:i})).Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Hs(a))return{data:null,error:a};throw a}})}createSignedUploadUrl(e,t){return cn(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(s["x-upsert"]="true");const n=yield tn(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),i=new URL(this.url+n.url),o=i.searchParams.get("token");if(!o)throw new zs("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:o},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Hs(r))return{data:null,error:r};throw r}})}update(e,t,r){return cn(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return cn(this,void 0,void 0,function*(){try{return{data:yield tn(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Hs(s))return{data:null,error:s};throw s}})}copy(e,t,r){return cn(this,void 0,void 0,function*(){try{return{data:{path:(yield tn(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Hs(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,r){return cn(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),n=yield tn(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},(null==r?void 0:r.transform)?{transform:r.transform}:{}),{headers:this.headers});const i=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${i}`)},{data:n,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Hs(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return cn(this,void 0,void 0,function*(){try{const s=yield tn(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return{data:s.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${n}`):null})),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Hs(s))return{data:null,error:s};throw s}})}download(e,t){const r=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",s=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),n=s?`?${s}`:"",i=this._getFinalPath(e);return new ln(()=>en(this.fetch,`${this.url}/${r}/${i}${n}`,{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}info(e){return cn(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const e=yield en(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Gs(e),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Hs(r))return{data:null,error:r};throw r}})}exists(e){return cn(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield function(e,t,r,s){return Ks(this,void 0,void 0,function*(){return Zs(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),s)})}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Hs(r)&&r instanceof Vs){const e=r.originalError;if([400,404].includes(null==e?void 0:e.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],n=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==n&&s.push(n);const i=void 0!==(null==t?void 0:t.transform)?"render/image":"object",o=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==o&&s.push(o);let a=s.join("&");return""!==a&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${r}${a}`)}}}remove(e){return cn(this,void 0,void 0,function*(){try{return{data:yield sn(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Hs(t))return{data:null,error:t};throw t}})}list(e,t,r){return cn(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},un),t),{prefix:e||""});return{data:yield tn(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Hs(s))return{data:null,error:s};throw s}})}listV2(e,t){return cn(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield tn(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Hs(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const fn={"X-Client-Info":"storage-js/2.75.0"};var pn=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};class mn{constructor(e,t={},r,s){this.shouldThrowOnError=!1;const n=new URL(e);if(null==s?void 0:s.useNewHostname){/supabase\.(co|in|red)$/.test(n.hostname)&&!n.hostname.includes("storage.supabase.")&&(n.hostname=n.hostname.replace("supabase.","storage.supabase."))}this.url=n.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},fn),t),this.fetch=Js(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return pn(this,void 0,void 0,function*(){try{return{data:yield en(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Hs(e))return{data:null,error:e};throw e}})}getBucket(e){return pn(this,void 0,void 0,function*(){try{return{data:yield en(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Hs(t))return{data:null,error:t};throw t}})}createBucket(e){return pn(this,arguments,void 0,function*(e,t={public:!1}){try{return{data:yield tn(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Hs(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return pn(this,void 0,void 0,function*(){try{return{data:yield rn(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Hs(r))return{data:null,error:r};throw r}})}emptyBucket(e){return pn(this,void 0,void 0,function*(){try{return{data:yield tn(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Hs(t))return{data:null,error:t};throw t}})}deleteBucket(e){return pn(this,void 0,void 0,function*(){try{return{data:yield sn(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Hs(t))return{data:null,error:t};throw t}})}}class gn extends mn{constructor(e,t={},r,s){super(e,t,r,s)}from(e){return new hn(this.url,this.headers,e,this.fetch)}}const yn={"X-Client-Info":"supabase-js/2.30.0"};var bn,vn={exports:{}};var wn=(bn||(bn=1,function(e,t){var r,s="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==v&&v,n=function(){function e(){this.fetch=!1,this.DOMException=s.DOMException}return e.prototype=s,new e}();r=n,function(e){var t=void 0!==r&&r||"undefined"!=typeof self&&self||void 0!==v&&v||{},s="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,i="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(e){return!1}}(),o="FormData"in t,a="ArrayBuffer"in t;if(a)var l=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],c=ArrayBuffer.isView||function(e){return e&&l.indexOf(Object.prototype.toString.call(e))>-1};function u(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function d(e){return"string"!=typeof e&&(e=String(e)),e}function h(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function f(e){this.map={},e instanceof f?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){if(2!=e.length)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function p(e){if(!e._noBody)return e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function m(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function g(e){var t=new FileReader,r=m(t);return t.readAsArrayBuffer(e),r}function y(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:i&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:o&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:s&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():a&&i&&(t=e)&&DataView.prototype.isPrototypeOf(t)?(this._bodyArrayBuffer=y(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a&&(ArrayBuffer.prototype.isPrototypeOf(e)||c(e))?this._bodyArrayBuffer=y(e):this._bodyText=e=Object.prototype.toString.call(e):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):s&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},i&&(this.blob=function(){var e=p(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=p(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}if(i)return this.blob().then(g);throw new Error("could not read as ArrayBuffer")},this.text=function(){var e,t,r,s,n,i=p(this);if(i)return i;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=m(t),s=/charset=([A-Za-z0-9_-]+)/.exec(e.type),n=s?s[1]:"utf-8",t.readAsText(e,n),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),s=0;s<t.length;s++)r[s]=String.fromCharCode(t[s]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o&&(this.formData=function(){return this.text().then(x)}),this.json=function(){return this.text().then(JSON.parse)},this}f.prototype.append=function(e,t){e=u(e),t=d(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},f.prototype.delete=function(e){delete this.map[u(e)]},f.prototype.get=function(e){return e=u(e),this.has(e)?this.map[e]:null},f.prototype.has=function(e){return this.map.hasOwnProperty(u(e))},f.prototype.set=function(e,t){this.map[u(e)]=d(t)},f.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},f.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),h(e)},f.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),h(e)},f.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),h(e)},n&&(f.prototype[Symbol.iterator]=f.prototype.entries);var w=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function _(e,r){if(!(this instanceof _))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var s,n,i=(r=r||{}).body;if(e instanceof _){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,r.headers||(this.headers=new f(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=r.credentials||this.credentials||"same-origin",!r.headers&&this.headers||(this.headers=new f(r.headers)),this.method=(s=r.method||this.method||"GET",n=s.toUpperCase(),w.indexOf(n)>-1?n:s),this.mode=r.mode||this.mode||null,this.signal=r.signal||this.signal||function(){if("AbortController"in t)return(new AbortController).signal}(),this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(i),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==r.cache&&"no-cache"!==r.cache)){var o=/([?&])_=[^&]*/;o.test(this.url)?this.url=this.url.replace(o,"$1_="+(new Date).getTime()):this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}function x(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),s=r.shift().replace(/\+/g," "),n=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(s),decodeURIComponent(n))}}),t}function j(e,t){if(!(this instanceof j))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new f(t.headers),this.url=t.url||"",this._initBody(e)}_.prototype.clone=function(){return new _(this,{body:this._bodyInit})},b.call(_.prototype),b.call(j.prototype),j.prototype.clone=function(){return new j(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new f(this.headers),url:this.url})},j.error=function(){var e=new j(null,{status:200,statusText:""});return e.ok=!1,e.status=0,e.type="error",e};var k=[301,302,303,307,308];j.redirect=function(e,t){if(-1===k.indexOf(t))throw new RangeError("Invalid status code");return new j(null,{status:t,headers:{location:e}})},e.DOMException=t.DOMException;try{new e.DOMException}catch(S){e.DOMException=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},e.DOMException.prototype=Object.create(Error.prototype),e.DOMException.prototype.constructor=e.DOMException}function T(r,s){return new Promise(function(n,o){var l=new _(r,s);if(l.signal&&l.signal.aborted)return o(new e.DOMException("Aborted","AbortError"));var c=new XMLHttpRequest;function h(){c.abort()}if(c.onload=function(){var e,t,r={statusText:c.statusText,headers:(e=c.getAllResponseHeaders()||"",t=new f,e.replace(/\r?\n[\t ]+/g," ").split("\r").map(function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e}).forEach(function(e){var r=e.split(":"),s=r.shift().trim();if(s){var n=r.join(":").trim();try{t.append(s,n)}catch(i){console.warn("Response "+i.message)}}}),t)};0===l.url.indexOf("file://")&&(c.status<200||c.status>599)?r.status=200:r.status=c.status,r.url="responseURL"in c?c.responseURL:r.headers.get("X-Request-URL");var s="response"in c?c.response:c.responseText;setTimeout(function(){n(new j(s,r))},0)},c.onerror=function(){setTimeout(function(){o(new TypeError("Network request failed"))},0)},c.ontimeout=function(){setTimeout(function(){o(new TypeError("Network request timed out"))},0)},c.onabort=function(){setTimeout(function(){o(new e.DOMException("Aborted","AbortError"))},0)},c.open(l.method,function(e){try{return""===e&&t.location.href?t.location.href:e}catch(r){return e}}(l.url),!0),"include"===l.credentials?c.withCredentials=!0:"omit"===l.credentials&&(c.withCredentials=!1),"responseType"in c&&(i?c.responseType="blob":a&&(c.responseType="arraybuffer")),s&&"object"==typeof s.headers&&!(s.headers instanceof f||t.Headers&&s.headers instanceof t.Headers)){var p=[];Object.getOwnPropertyNames(s.headers).forEach(function(e){p.push(u(e)),c.setRequestHeader(e,d(s.headers[e]))}),l.headers.forEach(function(e,t){-1===p.indexOf(t)&&c.setRequestHeader(t,e)})}else l.headers.forEach(function(e,t){c.setRequestHeader(t,e)});l.signal&&(l.signal.addEventListener("abort",h),c.onreadystatechange=function(){4===c.readyState&&l.signal.removeEventListener("abort",h)}),c.send(void 0===l._bodyInit?null:l._bodyInit)})}T.polyfill=!0,t.fetch||(t.fetch=T,t.Headers=f,t.Request=_,t.Response=j),e.Headers=f,e.Request=_,e.Response=j,e.fetch=T,Object.defineProperty(e,"__esModule",{value:!0})}({}),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var i=s.fetch?s:n;(t=i.fetch).default=i.fetch,t.fetch=i.fetch,t.Headers=i.Headers,t.Request=i.Request,t.Response=i.Response,e.exports=t}(vn,vn.exports)),vn.exports);const _n=p(wn),xn=we({__proto__:null,default:_n},[wn]);var jn=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};const kn=(e,t,r)=>{const s=(e=>{let t;return t=e||("undefined"==typeof fetch?_n:fetch),(...e)=>t(...e)})(r),n="undefined"==typeof Headers?wn.Headers:Headers;return(r,i)=>jn(void 0,void 0,void 0,function*(){var o;const a=null!==(o=yield t())&&void 0!==o?o:e;let l=new n(null==i?void 0:i.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${a}`),s(r,Object.assign(Object.assign({},i),{headers:l}))})};const Tn=()=>"undefined"!=typeof document,Sn={tested:!1,writable:!1},En=()=>{if(!Tn())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(t){return!1}if(Sn.tested)return Sn.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Sn.tested=!0,Sn.writable=!0}catch(t){Sn.tested=!0,Sn.writable=!1}return Sn.writable};function On(e,t){var r;t||(t=(null===(r=null===window||void 0===window?void 0:window.location)||void 0===r?void 0:r.href)||""),e=e.replace(/[\[\]]/g,"\\$&");const s=new RegExp("[?&#]"+e+"(=([^&#]*)|&|#|$)").exec(t);return s?s[2]?decodeURIComponent(s[2].replace(/\+/g," ")):"":null}const Nn=e=>{let t;return t=e||("undefined"==typeof fetch?async(...e)=>await(await Oe(async()=>{const{fetch:e}=await Promise.resolve().then(()=>xn);return{fetch:e}},void 0)).fetch(...e):fetch),(...e)=>t(...e)},Pn=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},Cn=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch(s){return r}},An=async(e,t)=>{await e.removeItem(t)};class In{constructor(){this.promise=new In.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function Rn(e){const t=e.split(".");if(3!==t.length)throw new Error("JWT is not valid: not a JWT structure");if(!/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(function(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let r,s,n,i,o,a,l,c="",u=0;for(e=e.replace("-","+").replace("_","/");u<e.length;)i=t.indexOf(e.charAt(u++)),o=t.indexOf(e.charAt(u++)),a=t.indexOf(e.charAt(u++)),l=t.indexOf(e.charAt(u++)),r=i<<2|o>>4,s=(15&o)<<4|a>>2,n=(3&a)<<6|l,c+=String.fromCharCode(r),64!=a&&0!=s&&(c+=String.fromCharCode(s)),64!=l&&0!=n&&(c+=String.fromCharCode(n));return c}(r))}function $n(e){return("0"+e.toString(16)).substr(-2)}function Ln(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let r="";for(let s=0;s<56;s++)r+=e.charAt(Math.floor(Math.random()*t));return r}return crypto.getRandomValues(e),Array.from(e,$n).join("")}async function Dn(e){if("undefined"==typeof crypto)return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(e=>String.fromCharCode(e)).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}In.promiseConstructor=Promise;const Un=/__stack_guard__([a-zA-Z0-9_-]+)__/;let Bn,Mn=!1;function Fn(e){var t,r;let s;Bn();try{throw new Error}catch(i){s=i}const n=null!==(r=null===(t=s.stack)||void 0===t?void 0:t.split("\n"))&&void 0!==r?r:[];for(let o=0;o<n.length;o+=1){const t=n[o].match(Un);if(t&&t[1]===e)return!0}return!1}async function zn(e,t){await Bn();const r=`__stack_guard__${e}__`,s={[r]:async()=>await t()};return await s[r]()}Bn=async()=>{Mn||(Mn=!0,await zn("ENV_CHECK",async()=>{const e=Fn("ENV_CHECK");return e||console.warn("@supabase/gotrue-js: Stack guards not supported in this environment. Generally not an issue but may point to a very conservative transpilation environment (use ES2017 or above) that implements async/await with generators, or this is a JavaScript engine that does not support async/await stack traces."),e}))};class Hn extends Error{constructor(e,t){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t}}function qn(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class Vn extends Hn{constructor(e,t){super(e,t),this.name="AuthApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Wn extends Hn{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Jn extends Hn{constructor(e,t,r){super(e),this.name=t,this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Gn extends Jn{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}}class Kn extends Jn{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500)}}class Yn extends Jn{constructor(e){super(e,"AuthInvalidCredentialsError",400)}}class Qn extends Jn{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Xn extends Jn{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Zn extends Jn{constructor(e,t){super(e,"AuthRetryableFetchError",t)}}function ei(e){return qn(e)&&"AuthRetryableFetchError"===e.name}const ti=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),ri=[502,503,504];async function si(e){if(!("object"==typeof(t=e)&&null!==t&&"status"in t&&"ok"in t&&"json"in t&&"function"==typeof t.json))throw new Zn(ti(e),0);var t;if(ri.includes(e.status))throw new Zn(ti(e),e.status);let r;try{r=await e.json()}catch(s){throw new Wn(ti(s),s)}throw new Vn(ti(r),e.status||500)}async function ni(e,t,r,s){var n;const i=Object.assign({},null==s?void 0:s.headers);(null==s?void 0:s.jwt)&&(i.Authorization=`Bearer ${s.jwt}`);const o=null!==(n=null==s?void 0:s.query)&&void 0!==n?n:{};(null==s?void 0:s.redirectTo)&&(o.redirect_to=s.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await async function(e,t,r,s,n,i){const o=((e,t,r,s)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),r))})(t,s,n,i);let a;try{a=await e(r,o)}catch(l){throw console.error(l),new Zn(ti(l),0)}a.ok||await si(a);if(null==s?void 0:s.noResolveJson)return a;try{return await a.json()}catch(l){await si(l)}}(e,t,r+a,{headers:i,noResolveJson:null==s?void 0:s.noResolveJson},{},null==s?void 0:s.body);return(null==s?void 0:s.xform)?null==s?void 0:s.xform(l):{data:Object.assign({},l),error:null}}function ii(e){var t;let r=null;var s;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(r=Object.assign({},e),r.expires_at=(s=e.expires_in,Math.round(Date.now()/1e3)+s));return{data:{session:r,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function oi(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function ai(e){return{data:e,error:null}}function li(e){const{action_link:t,email_otp:r,hashed_token:s,redirect_to:n,verification_type:i}=e,o=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r}(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:r,hashed_token:s,redirect_to:n,verification_type:i},user:Object.assign({},o)},error:null}}function ci(e){return e}class ui{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Nn(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await ni(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(qn(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await ni(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:oi})}catch(r){if(qn(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r}(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=null==r?void 0:r.newEmail,delete s.newEmail),await ni(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:li,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(qn(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await ni(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:oi})}catch(t){if(qn(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,n,i,o,a;try{const l={nextPage:null,lastPage:0,total:0},c=await ni(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==r?r:"",per_page:null!==(n=null===(s=null==e?void 0:e.perPage)||void 0===s?void 0:s.toString())&&void 0!==n?n:""},xform:ci});if(c.error)throw c.error;const u=await c.json(),d=null!==(i=c.headers.get("x-total-count"))&&void 0!==i?i:0,h=null!==(a=null===(o=c.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);l[`${r}Page`]=t}),l.total=parseInt(d)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(l){if(qn(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){try{return await ni(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:oi})}catch(t){if(qn(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await ni(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:oi})}catch(r){if(qn(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){try{return await ni(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:oi})}catch(r){if(qn(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{const{data:t,error:r}=await ni(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:r}}catch(t){if(qn(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await ni(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(qn(t))return{data:null,error:t};throw t}}}const di={"X-Client-Info":"gotrue-js/2.43.1"},hi={getItem:e=>En()?globalThis.localStorage.getItem(e):null,setItem:(e,t)=>{En()&&globalThis.localStorage.setItem(e,t)},removeItem:e=>{En()&&globalThis.localStorage.removeItem(e)}};!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const fi={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:di,flowType:"implicit",debug:!1},pi=3e4;class mi{constructor(e){var t;this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.broadcastChannel=null,this.instanceID=mi.nextInstanceID,mi.nextInstanceID+=1,this.instanceID>0&&Tn()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},fi),e);if(this.logDebugMessages=r.debug,this.inMemorySession=null,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.persistSession=r.persistSession,this.storage=r.storage||hi,this.admin=new ui({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=Nn(r.fetch),this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession&&this.storage===hi&&!En()&&console.warn("No storage option exists to persist the session, which may result in unexpected behavior when using auth.\n        If you want to set persistSession to true, please provide a storage option or you may set persistSession to false to disable this warning."),Tn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}null===(t=this.broadcastChannel)||void 0===t||t.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&console.log(`GoTrueClient@${this.instanceID} ${(new Date).toISOString()}`,...e),this}initialize(){return this.initializePromise?this.initializePromise:this._initialize()}async _initialize(){if(this.initializePromise)throw new Error("Double call of #_initialize()");return this.initializePromise=zn("_initialize",async()=>{try{const e=!!Tn()&&await this._isPKCEFlow();if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:r}=await this._getSessionFromUrl(e);if(r)return this._debug("#_initialize()","error detecting session from URL",r),await this._removeSession(),{error:r};const{session:s,redirectType:n}=t;return this._debug("#_initialize()","detected session in URL",s,"redirect type",n),await this._saveSession(s),setTimeout(async()=>{"recovery"===n?await this._notifyAllSubscribers("PASSWORD_RECOVERY",s):await this._notifyAllSubscribers("SIGNED_IN",s)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return qn(e)?{error:e}:{error:new Wn("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}),await this.initializePromise}async signUp(e){var t,r,s;try{let n;if(await this._removeSession(),"email"in e){const{email:r,password:s,options:i}=e;let o=null,a=null;if("pkce"===this.flowType){const e=Ln();await Pn(this.storage,`${this.storageKey}-code-verifier`,e),o=await Dn(e),a=e===o?"plain":"s256"}n=await ni(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==i?void 0:i.emailRedirectTo,body:{email:r,password:s,data:null!==(t=null==i?void 0:i.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:o,code_challenge_method:a},xform:ii})}else{if(!("phone"in e))throw new Yn("You must provide either an email or phone number and a password");{const{phone:t,password:i,options:o}=e;n=await ni(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:i,data:null!==(r=null==o?void 0:o.data)&&void 0!==r?r:{},channel:null!==(s=null==o?void 0:o.channel)&&void 0!==s?s:"sms",gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken}},xform:ii})}}const{data:i,error:o}=n;if(o||!i)return{data:{user:null,session:null},error:o};const a=i.session,l=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(n){if(qn(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(e){try{let t;if(await this._removeSession(),"email"in e){const{email:r,password:s,options:n}=e;t=await ni(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:ii})}else{if(!("phone"in e))throw new Yn("You must provide either an email or phone number and a password");{const{phone:r,password:s,options:n}=e;t=await ni(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:ii})}}const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:r&&r.session&&r.user?(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:{user:r.user,session:r.session},error:s}):{data:{user:null,session:null},error:new Kn}}catch(t){if(qn(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,n;return await this._removeSession(),await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(s=e.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:null===(n=e.options)||void 0===n?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){const t=await Cn(this.storage,`${this.storageKey}-code-verifier`),{data:r,error:s}=await ni(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:t},xform:ii});return await An(this.storage,`${this.storageKey}-code-verifier`),s?{data:{user:null,session:null},error:s}:r&&r.session&&r.user?(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:r,error:s}):{data:{user:null,session:null},error:new Kn}}async signInWithIdToken(e){await this._removeSession();try{const{options:t,provider:r,token:s,access_token:n,nonce:i}=e,o=await ni(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:n,nonce:i,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:ii}),{data:a,error:l}=o;return l?{data:{user:null,session:null},error:l}:a&&a.session&&a.user?(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:l}):{data:{user:null,session:null},error:new Kn}}catch(t){if(qn(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,n,i;try{if(await this._removeSession(),"email"in e){const{email:s,options:n}=e;let i=null,o=null;if("pkce"===this.flowType){const e=Ln();await Pn(this.storage,`${this.storageKey}-code-verifier`,e),i=await Dn(e),o=e===i?"plain":"s256"}const{error:a}=await ni(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:s,data:null!==(t=null==n?void 0:n.data)&&void 0!==t?t:{},create_user:null===(r=null==n?void 0:n.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:i,code_challenge_method:o},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in e){const{phone:t,options:r}=e,{data:o,error:a}=await ni(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(s=null==r?void 0:r.data)&&void 0!==s?s:{},create_user:null===(n=null==r?void 0:r.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},channel:null!==(i=null==r?void 0:r.channel)&&void 0!==i?i:"sms"}});return{data:{user:null,session:null,messageId:null==o?void 0:o.message_id},error:a}}throw new Yn("You must provide either an email or phone number.")}catch(o){if(qn(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,r;try{"email_change"!==e.type&&"phone_change"!==e.type&&await this._removeSession();const{data:s,error:n}=await ni(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:null===(t=e.options)||void 0===t?void 0:t.captchaToken}}),redirectTo:null===(r=e.options)||void 0===r?void 0:r.redirectTo,xform:ii});if(n)throw n;if(!s)throw new Error("An error occurred on token verification.");const i=s.session,o=s.user;return(null==i?void 0:i.access_token)&&(await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)),{data:{user:o,session:i},error:null}}catch(s){if(qn(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{return await this._removeSession(),await ni(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==r?r:void 0}),(null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0}),headers:this.headers,xform:ai})}catch(n){if(qn(n))return{data:null,error:n};throw n}}async reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new Gn;const{error:s}=await ni(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(qn(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{"email_change"!=e.type&&"phone_change"!=e.type&&await this._removeSession();const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:n}=e,{error:i}=await ni(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:i}}if("phone"in e){const{phone:r,type:s,options:n}=e,{data:i,error:o}=await ni(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:o}}throw new Yn("You must provide either an email or phone number and a type")}catch(t){if(qn(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return this._useSession(async e=>e)}async _useSession(e){return await zn("_useSession",async()=>{const t=await this.__loadSession();return await e(t)})}async __loadSession(){if(this._debug("#__loadSession()","begin"),this.logDebugMessages&&!Fn("_useSession"))throw new Error("Please use #_useSession()");Fn("_initialize")||await this.initializePromise;try{let e=null;if(this.persistSession){const t=await Cn(this.storage,this.storageKey);this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession()))}else e=this.inMemorySession,this._debug("#getSession()","session from memory",e);if(!e)return{data:{session:null},error:null};const t=!!e.expires_at&&e.expires_at<=Date.now()/1e3;if(this._debug("#__loadSession()",`session has${t?"":" not"} expired`,"expires_at",e.expires_at),!t)return{data:{session:e},error:null};const{session:r,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){try{return await this._useSession(async t=>{var r,s;if(!e){const{data:n,error:i}=t;if(i)throw i;e=null!==(s=null===(r=n.session)||void 0===r?void 0:r.access_token)&&void 0!==s?s:void 0}return await ni(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:oi})})}catch(t){if(qn(t))return{data:{user:null},error:t};throw t}}async updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:n}=r;if(n)throw n;if(!s.session)throw new Gn;const i=s.session,{data:o,error:a}=await ni(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:e,jwt:i.access_token,xform:oi});if(a)throw a;return i.user=o.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}})}catch(r){if(qn(r))return{data:{user:null},error:r};throw r}}_decodeJWT(e){return Rn(e)}async setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Gn;const t=Date.now()/1e3;let r=t,s=!0,n=null;const i=Rn(e.access_token);if(i.exp&&(r=i.exp,s=r<=t),s){const{session:t,error:r}=await this._callRefreshToken(e.refresh_token);if(r)return{data:{user:null,session:null},error:r};if(!t)return{data:{user:null,session:null},error:null};n=t}else{const{data:s,error:i}=await this.getUser(e.access_token);if(i)throw i;n={access_token:e.access_token,refresh_token:e.refresh_token,user:s.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if(qn(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:s,error:n}=t;if(n)throw n;e=null!==(r=s.session)&&void 0!==r?r:void 0}if(!(null==e?void 0:e.refresh_token))throw new Gn;const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(qn(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromUrl(e){try{if(!Tn())throw new Qn("No browser detected.");if("implicit"===this.flowType&&!this._isImplicitGrantFlow())throw new Qn("Not a valid implicit grant flow url.");if("pkce"==this.flowType&&!e)throw new Xn("Not a valid PKCE flow url.");if(e){const e=On("code");if(!e)throw new Xn("No code detected.");const{data:t,error:r}=await this.exchangeCodeForSession(e);if(r)throw r;if(!t.session)throw new Xn("No session detected.");let s=new URL(window.location.href);return s.searchParams.delete("code"),window.history.replaceState(window.history.state,"",s.toString()),{data:{session:t.session,redirectType:null},error:null}}const t=On("error_description");if(t){const e=On("error_code");if(!e)throw new Qn("No error_code detected.");const r=On("error");if(!r)throw new Qn("No error detected.");throw new Qn(t,{error:r,code:e})}const r=On("provider_token"),s=On("provider_refresh_token"),n=On("access_token");if(!n)throw new Qn("No access_token detected.");const i=On("expires_in");if(!i)throw new Qn("No expires_in detected.");const o=On("refresh_token");if(!o)throw new Qn("No refresh_token detected.");const a=On("token_type");if(!a)throw new Qn("No token_type detected.");const l=Math.round(Date.now()/1e3)+parseInt(i),{data:c,error:u}=await this.getUser(n);if(u)throw u;const d=c.user,h={provider_token:r,provider_refresh_token:s,access_token:n,expires_in:parseInt(i),expires_at:l,refresh_token:o,token_type:a,user:d},f=On("type");return window.location.hash="",this._debug("#_getSessionFromUrl()","clearing window.location.hash"),{data:{session:h,redirectType:f},error:null}}catch(t){if(qn(t))return{data:{session:null,redirectType:null},error:t};throw t}}_isImplicitGrantFlow(){return Tn()&&(Boolean(On("access_token"))||Boolean(On("error_description")))}async _isPKCEFlow(){const e=await Cn(this.storage,`${this.storageKey}-code-verifier`);return Boolean(On("code"))&&Boolean(e)}async signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n)return{error:n};const i=null===(r=s.session)||void 0===r?void 0:r.access_token;if(i){const{error:t}=await this.admin.signOut(i,e);if(t&&(!function(e){return qn(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status))return{error:t}}return"others"!==e&&(await this._removeSession(),await An(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),this._emitInitialSession(t),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:s},error:n}=t;if(n)throw n;await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(n){await(null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;if("pkce"===this.flowType){const e=Ln();await Pn(this.storage,`${this.storageKey}-code-verifier`,e),r=await Dn(e),s=e===r?"plain":"s256"}try{return await ni(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(qn(n))return{data:null,error:n};throw n}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await(r=async r=>{var s;return await(s=200*r,new Promise(e=>{setTimeout(()=>e(null),s)})),this._debug(t,"refreshing attempt",r),await ni(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ii})},s=(e,t,r)=>r&&r.error&&ei(r.error)&&Date.now()+200*(e+1)-n<pi,new Promise((e,t)=>{(async()=>{for(let i=0;i<1/0;i++)try{const t=await r(i);if(!s(i,null,t))return void e(t)}catch(n){if(!s(i,n))return void t(n)}})()}))}catch(n){if(this._debug(t,"error",n),qn(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}var r,s}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),Tn()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await Cn(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r))return this._debug(t,"session is not valid"),void(null!==r&&await this._removeSession());const s=Math.round(Date.now()/1e3),n=(null!==(e=r.expires_at)&&void 0!==e?e:1/0)<s+10;if(this._debug(t,`session has${n?"":" not"} expired with margin of 10s`),n){if(this.autoRefreshToken&&r.refresh_token){const{error:e}=await this._callRefreshToken(r.refresh_token);e&&(console.error(e),ei(e)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){return this._debug(t,"error",r),void console.error(r)}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new Gn;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new In;const{data:t,error:r}=await this._refreshAccessToken(e);if(r)throw r;if(!t.session)throw new Gn;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const s={session:t.session,error:null};return this.refreshingDeferred.resolve(s),s}catch(n){if(this._debug(s,"error",n),qn(n)){const e={session:null,error:n};return null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(r=this.refreshingDeferred)||void 0===r||r.reject(n),n}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const s=[],n=Array.from(this.stateChangeEmitters.values()).map(async r=>{try{await r.callback(e,t)}catch(n){s.push(n)}});if(await Promise.all(n),s.length>0){for(let e=0;e<s.length;e+=1)console.error(s[e]);throw s[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.persistSession||(this.inMemorySession=e),this.persistSession&&e.expires_at&&await this._persistSession(e)}_persistSession(e){return this._debug("#_persistSession()",e),Pn(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),this.persistSession?await An(this.storage,this.storageKey):this.inMemorySession=null}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Tn()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),pi);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),await this._autoRefreshTokenTick()}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{const t=Date.now();try{return await this._useSession(async e=>{const{data:{session:r}}=e;if(!r||!r.refresh_token||!r.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const s=Math.floor((1e3*r.expires_at-t)/pi);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),s<=3&&await this._callRefreshToken(r.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Tn()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){this._debug(`#_onVisibilityChanged(${e})`,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(e||(await this.initializePromise,await this._recoverAndRefresh(),this._debug("#_onVisibilityChanged()","finished waiting for initialize, _recoverAndRefresh")),this.autoRefreshToken&&this._startAutoRefresh()):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t){const r=[`provider=${encodeURIComponent(e)}`];if((null==t?void 0:t.redirectTo)&&r.push(`redirect_to=${encodeURIComponent(t.redirectTo)}`),(null==t?void 0:t.scopes)&&r.push(`scopes=${encodeURIComponent(t.scopes)}`),"pkce"===this.flowType){const e=Ln();await Pn(this.storage,`${this.storageKey}-code-verifier`,e);const t=await Dn(e),s=e===t?"plain":"s256";this._debug("PKCE","code verifier",`${e.substring(0,5)}...`,"code challenge",t,"method",s);const n=new URLSearchParams({code_challenge:`${encodeURIComponent(t)}`,code_challenge_method:`${encodeURIComponent(s)}`});r.push(n.toString())}if(null==t?void 0:t.queryParams){const e=new URLSearchParams(t.queryParams);r.push(e.toString())}return`${this.url}/authorize?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;return n?{data:null,error:n}:await ni(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token})})}catch(t){if(qn(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:n,error:i}=t;if(i)return{data:null,error:i};const{data:o,error:a}=await ni(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:null===(r=null==n?void 0:n.session)||void 0===r?void 0:r.access_token});return a?{data:null,error:a}:((null===(s=null==o?void 0:o.totp)||void 0===s?void 0:s.qr_code)&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})})}catch(t){if(qn(t))return{data:null,error:t};throw t}}async _verify(e){try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n)return{data:null,error:n};const{data:i,error:o}=await ni(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:o})})}catch(t){if(qn(t))return{data:null,error:t};throw t}}async _challenge(e){try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;return n?{data:null,error:n}:await ni(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token})})}catch(t){if(qn(t))return{data:null,error:t};throw t}}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(null==e?void 0:e.factors)||[],s=r.filter(e=>"totp"===e.factor_type&&"verified"===e.status);return{data:{all:r,totp:s},error:null}}async _getAuthenticatorAssuranceLevel(){return await this._useSession(async e=>{var t,r;const{data:{session:s},error:n}=e;if(n)return{data:null,error:n};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const i=this._decodeJWT(s.access_token);let o=null;i.aal&&(o=i.aal);let a=o;(null!==(r=null===(t=s.user.factors)||void 0===t?void 0:t.filter(e=>"verified"===e.status))&&void 0!==r?r:[]).length>0&&(a="aal2");return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:i.amr||[]},error:null}})}}mi.nextInstanceID=0;class gi extends mi{constructor(e){super(e)}}var yi=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};const bi={headers:yn},vi={schema:"public"},wi={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},_i={};class xi{constructor(e,t,r){var s,n,i,o,a,l,c,u;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const d=e.replace(/\/$/,"");this.realtimeUrl=`${d}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${d}/auth/v1`,this.storageUrl=`${d}/storage/v1`,this.functionsUrl=`${d}/functions/v1`;const h=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,f=function(e,t){const{db:r,auth:s,realtime:n,global:i}=e,{db:o,auth:a,realtime:l,global:c}=t;return{db:Object.assign(Object.assign({},o),r),auth:Object.assign(Object.assign({},a),s),realtime:Object.assign(Object.assign({},l),n),global:Object.assign(Object.assign({},c),i)}}(null!=r?r:{},{db:vi,realtime:_i,auth:Object.assign(Object.assign({},wi),{storageKey:h}),global:bi});this.storageKey=null!==(n=null===(s=f.auth)||void 0===s?void 0:s.storageKey)&&void 0!==n?n:"",this.headers=null!==(o=null===(i=f.global)||void 0===i?void 0:i.headers)&&void 0!==o?o:{},this.auth=this._initSupabaseAuthClient(null!==(a=f.auth)&&void 0!==a?a:{},this.headers,null===(l=f.global)||void 0===l?void 0:l.fetch),this.fetch=kn(t,this._getAccessToken.bind(this),null===(c=f.global)||void 0===c?void 0:c.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},f.realtime)),this.rest=new Gr(`${d}/rest/v1`,{headers:this.headers,schema:null===(u=f.db)||void 0===u?void 0:u.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new vr(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new gn(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}rpc(e,t={},r){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return yi(this,void 0,void 0,function*(){const{data:r}=yield this.auth.getSession();return null!==(t=null===(e=r.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:n,flowType:i,debug:o},a,l){const c={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new gi({url:this.authUrl,headers:Object.assign(Object.assign({},c),a),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:i,debug:o,fetch:l})}_initRealtimeClient(e){return new Fs(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,r){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===r?"SIGNED_OUT"===e&&(this.realtime.setAuth(this.supabaseKey),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):(this.realtime.setAuth(null!=r?r:null),this.changedAccessToken=r)}}const ji=(ki="https://xdzoikocriuvgkoenjqk.supabase.co",Ti="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhkem9pa29jcml1dmdrb2VuanFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAzMzg2NzUsImV4cCI6MjA3NTkxNDY3NX0.hh2GkNEdFHI9wlPfM6-oDraPz-s-zS1HlJpSTElQxHc",Si={auth:{storage:window.localStorage,storageKey:"greenofig-auth",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce"},realtime:{params:{eventsPerSecond:10}},global:{headers:{"X-Client-Info":"greenofig-web"}}},new xi(ki,Ti,Si));var ki,Ti,Si;const Ei=y.createContext(null),Oi=({children:t})=>{const[r,s]=y.useState(null),[n,i]=y.useState(null),[o,a]=y.useState(!0),{toast:l}=ur(),c=y.useCallback(async e=>{if(!e)return i(null),null;try{let{data:t,error:r}=await ji.from("user_profiles").select("*").eq("id",e.id).single();if(r&&"PGRST116"===r.code){const r=e.user_metadata?.full_name||e.user_metadata?.name||e.email?.split("@")[0]||"User",s=e.user_metadata?.avatar_url||e.user_metadata?.picture,{data:n,error:i}=await ji.from("user_profiles").insert({id:e.id,full_name:r,email:e.email,role:"user",profile_picture_url:s}).select().single();if(i)throw i;t=n}else if(r)throw r;return i(t),t}catch(t){return console.error("Error fetching profile:",t),l({variant:"destructive",title:"Error",description:"Could not load profile. Please refresh the page."}),null}},[l]),u=y.useCallback(()=>r?c(r):Promise.resolve(null),[r,c]);y.useEffect(()=>{(async()=>{a(!0);const{data:{session:e}}=await ji.auth.getSession();s(e?.user??null),e?.user&&await c(e.user),a(!1)})();const{data:e}=ji.auth.onAuthStateChange(async(e,t)=>{const r=t?.user??null;if(s(r),"SIGNED_IN"===e&&window.location.search.includes("code=")){const e=new URL(window.location.href);return e.searchParams.delete("code"),void(window.location.href=e.toString())}r?await c(r):i(null),a(!1)});return()=>{e?.subscription?.unsubscribe()}},[c]);const d=y.useCallback(async e=>{const{data:t,error:r}=await ji.auth.signInWithPassword(e);if(r)return l({variant:"destructive",title:"Login Failed",description:r.message}),{error:r};console.log("Login successful, user:",t.user);const n=await c(t.user);return console.log("Fetched profile:",n),s(t.user),i(n),l({title:"Login Successful",description:`Welcome back${n?.full_name?", "+n.full_name:""}!`}),{error:null,profile:n}},[c,l]),h=y.useCallback(async()=>{a(!0);const e=`${window.location.origin}/app`,{error:t}=await ji.auth.signInWithOAuth({provider:"google",options:{redirectTo:e}});t&&(a(!1),l({variant:"destructive",title:"Google Sign-In Failed",description:t.message}))},[l]),f=y.useCallback(async e=>{const{email:t,password:r,full_name:n}=e;let o="user";t.endsWith("@greenofig.com")&&(t.startsWith("nutritionist@")?o="nutritionist":t.startsWith("admin@")?o="admin":t.startsWith("superadmin@")&&(o="super_admin"));const{data:a,error:u}=await ji.auth.signUp({email:t,password:r,options:{data:{full_name:n,role:o}}});if(u)return l({variant:"destructive",title:"Sign Up Failed",description:u.message}),{user:null,error:u};const{data:d,error:h}=await ji.auth.signInWithPassword({email:t,password:r});if(h)return l({variant:"destructive",title:"Sign-in after sign-up failed.",description:h.message}),{user:null,error:h};await new Promise(e=>setTimeout(e,1500)),"user"!==o&&await ji.from("user_profiles").update({role:o}).eq("id",d.user.id);const f=await c(d.user);return s(d.user),i(f),{user:d.user,error:null,profile:f}},[c,l]),p=y.useCallback(async()=>{a(!0);try{await ji.auth.signOut(),s(null),i(null),localStorage.clear(),sessionStorage.clear(),l({title:"Signed Out",description:"You have been successfully signed out."})}catch(e){console.error("SignOut error:",e)}window.location.replace("/home")},[l]),m=y.useMemo(()=>({user:r,userProfile:n,loading:o,signIn:d,signInWithGoogle:h,signUp:f,signOut:p,refreshUserProfile:u}),[r,n,o,d,h,f,p,u]);return e.jsx(Ei.Provider,{value:m,children:t})},Ni=()=>{const e=y.useContext(Ei);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e},Pi="/assets/Remove%20background%20project-DdcfZIGG.png",Ci=Zt("inline-flex items-center justify-center whitespace-nowrap rounded-lg text-sm font-semibold ring-offset-background transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 active:scale-95",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 hover:shadow-lg hover:shadow-primary/20",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 hover:shadow-lg hover:shadow-destructive/20",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground hover:border-primary/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 hover:shadow-md",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline focus-visible:ring-offset-0"},size:{default:"h-9 px-3 text-sm",sm:"h-9 px-3 text-sm",lg:"h-11 px-4 text-base",icon:"h-9 w-9 p-0"}},defaultVariants:{variant:"default",size:"sm"}}),Ai=y.forwardRef(({className:t,variant:r,size:s,asChild:n=!1,...i},o)=>{const a=n?l:"button";return e.jsx(a,{className:Yt(Ci({variant:r,size:s,className:t})),ref:o,type:"button"!==a||i.type?i.type:"button",...i})});Ai.displayName="Button";const Ii=t=>e.jsxs("svg",{viewBox:"0 0 48 48",...t,children:[e.jsx("path",{fill:"#FFC107",d:"M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12s5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"}),e.jsx("path",{fill:"#FF3D00",d:"M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"}),e.jsx("path",{fill:"#4CAF50",d:"M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.222,0-9.651-3.356-11.303-8H6.306C9.656,39.663,16.318,44,24,44z"}),e.jsx("path",{fill:"#1976D2",d:"M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571l6.19,5.238C44.572,34.046,48,27.461,48,20C48,17.222,47.113,14.69,45.54,12.591L39.9,18.335C42.128,20.45,43.611,20.083,43.611,20.083z"})]}),Ri=({logoUrl:t,initialIsLogin:r=!0})=>{const{signIn:s,signUp:n,signInWithGoogle:i,user:o,userProfile:a}=Ni(),l=w(),c=_(),[u,d]=y.useState(r),[h,f]=y.useState(""),[p,m]=y.useState(""),[g,b]=y.useState(""),[v,j]=y.useState(!1),[k,T]=y.useState(!1),[S,E]=y.useState(null);y.useEffect(()=>{c.state?.selectedPlan&&E(c.state.selectedPlan)},[c.state]),y.useEffect(()=>{d("/login"===c.pathname)},[c.pathname]);return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-background touch-auto",children:e.jsx(A.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"w-full max-w-md",children:e.jsxs("div",{className:"glass-effect rounded-2xl p-4 sm:p-8 shadow-2xl",children:[e.jsxs("button",{onClick:()=>l(-1),className:"flex items-center gap-2 text-text-secondary hover:text-primary transition-colors mb-4 group",children:[e.jsx(I,{className:"w-5 h-5 group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{className:"text-sm font-medium",children:"Back"})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx(x,{to:"/home",className:"inline-block mb-4",children:e.jsx(A.div,{animate:{scale:[1,1.1,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.jsx("img",{src:t,alt:"GreenoFig Logo",className:"w-20 h-20"})})}),e.jsx("h1",{className:"text-4xl font-bold gradient-text mb-2",children:"GreenoFig"}),e.jsx("p",{className:"text-text-secondary",children:"Your Personal Wellness Companion"}),S&&!u&&e.jsxs("div",{className:"mt-4 bg-primary/10 text-primary font-semibold p-2 rounded-lg",children:["Signing up for the ",e.jsx("span",{className:"font-bold",children:S})," plan"]})]}),e.jsxs(Ai,{variant:"outline",className:"w-full py-3 min-h-[44px] rounded-lg shadow-lg flex items-center justify-center gap-2 touch-manipulation active:scale-95 transition-transform",onClick:async()=>{v||k||(T(!0),await i(),setTimeout(()=>T(!1),5e3))},disabled:k||v,type:"button",children:[k?e.jsx(R,{className:"h-5 w-5 animate-spin"}):e.jsx(Ii,{className:"w-5 h-5"}),e.jsxs("span",{children:["Sign ",u?"in":"up"," with Google"]})]}),e.jsxs("div",{className:"my-4 flex items-center",children:[e.jsx("div",{className:"flex-grow border-t border-border"}),e.jsx("span",{className:"flex-shrink mx-4 text-xs text-text-secondary uppercase",children:"Or continue with"}),e.jsx("div",{className:"flex-grow border-t border-border"})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!v&&!k)if(h&&p&&(u||g))if(j(!0),u){const{error:e,profile:t}=await s({email:h,password:p});if(!e&&t){const e=t.role;let r="/app/user";return"admin"===e||"super_admin"===e?r="/app/admin":"nutritionist"===e&&(r="/app/nutritionist"),void l(r,{replace:!0,state:{skipLoading:!0}})}j(!1)}else{const{user:e,error:t,profile:r}=await n({email:h,password:p,full_name:g});if(!t&&e&&r){cr({title:"Account created! ",description:"Welcome! Let's get you set up."});const e=r.role;let t="/app/user";return"admin"===e||"super_admin"===e?t="/app/admin":"nutritionist"===e&&(t="/app/nutritionist"),void l(t,{replace:!0,state:{skipLoading:!0}})}j(!1)}else cr({title:"Missing fields",description:"Please fill in all required fields",variant:"destructive"})},className:"space-y-4",children:[!u&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-primary"}),e.jsx("input",{type:"text",value:g,onChange:e=>b(e.target.value),className:"w-full pl-10 pr-4 py-3 min-h-[44px] bg-background border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring touch-manipulation",style:{fontSize:"16px"},placeholder:"John Doe",disabled:v||k,required:!0,autoComplete:"name"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-primary"}),e.jsx("input",{type:"email",value:h,onChange:e=>f(e.target.value),className:"w-full pl-10 pr-4 py-3 min-h-[44px] bg-background border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring touch-manipulation",style:{fontSize:"16px"},placeholder:"you@example.com",disabled:v||k,required:!0,autoComplete:"email",inputMode:"email"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-primary"}),e.jsx("input",{type:"password",value:p,onChange:e=>m(e.target.value),className:"w-full pl-10 pr-4 py-3 min-h-[44px] bg-background border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring touch-manipulation",style:{fontSize:"16px"},placeholder:"",disabled:v||k,required:!0,autoComplete:u?"current-password":"new-password"})]})]}),e.jsxs(Ai,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground font-semibold py-3 min-h-[44px] rounded-lg shadow-lg touch-manipulation active:scale-95 transition-transform",disabled:v||k,children:[v&&e.jsx(R,{className:"mr-2 h-4 w-4 animate-spin"}),v?"Processing...":u?"Login":"Sign Up"]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>{v||k||l(u?"/signup":"/login")},type:"button",className:"text-text-secondary hover:text-primary transition-colors disabled:opacity-50 min-h-[44px] py-2 px-4 touch-manipulation",disabled:v||k,children:u?"Don't have an account? Sign up":"Already have an account? Login"})})]})})})},$i=y.forwardRef(({className:t,...r},s)=>e.jsx(c,{ref:s,className:Yt("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...r}));$i.displayName=c.displayName;const Li=y.forwardRef(({className:t,...r},s)=>e.jsx(u,{ref:s,className:Yt("aspect-square h-full w-full",t),...r}));Li.displayName=u.displayName;const Di=y.forwardRef(({className:t,...r},s)=>e.jsx(d,{ref:s,className:Yt("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...r}));Di.displayName=d.displayName;const Ui=Zt("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"text-foreground hover:bg-accent"}},defaultVariants:{variant:"default"}});function Bi({className:t,variant:r,...s}){return e.jsx("div",{className:Yt(Ui({variant:r}),t),...s})}const Mi=y.forwardRef(({className:t,...r},s)=>e.jsx("textarea",{className:Yt("flex min-h-[120px] w-full rounded-2xl border border-input bg-background/50 backdrop-blur-sm px-4 py-3 text-base text-foreground ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:border-primary disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200 hover:border-primary/50 resize-y",t),style:{fontSize:"16px"},ref:s,"aria-invalid":r["aria-invalid"],...r}));Mi.displayName="Textarea";const Fi=y.forwardRef(({className:t,type:r,...s},n)=>e.jsx("input",{type:r,className:Yt("flex h-12 lg:h-14 w-full min-w-0 max-w-full rounded-2xl border border-input bg-background/50 backdrop-blur-sm px-4 lg:px-5 py-3 lg:py-3.5 text-base lg:text-lg text-foreground ring-offset-background file:border-0 file:bg-transparent file:text-base lg:file:text-lg file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:border-primary disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200 hover:border-primary/50",t),style:{fontSize:"16px"},ref:n,"aria-invalid":s["aria-invalid"],...s}));Fi.displayName="Input";const zi=Zt("text-sm font-semibold text-foreground mb-2 block tracking-wide leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Hi=y.forwardRef(({className:t,...r},s)=>e.jsx(h,{ref:s,className:Yt(zi(),t),...r}));Hi.displayName=h.displayName;const qi=()=>{const{userProfile:t,user:r}=Ni(),{toast:s}=ur(),[n,i]=y.useState(!1),[o,a]=y.useState(!1),[l,c]=y.useState("ai"),[u,d]=y.useState([]),[h,f]=y.useState(""),[p,m]=y.useState(!1),[g,b]=y.useState(!1),[v,w]=y.useState([]),[_,x]=y.useState(null),[j,k]=y.useState([]),[T,S]=y.useState(0),[E,O]=y.useState(!0),[N,P]=y.useState(window.innerHeight),[R,$]=y.useState(()=>localStorage.getItem("chatButtonPosition")||"right"),[D,G]=y.useState(!1),[K,Y]=y.useState(""),[Q,X]=y.useState(""),[Z,ee]=y.useState(""),[te,re]=y.useState(!1),[se,ne]=y.useState(!1),[ie,oe]=y.useState([]),[ae,le]=y.useState(""),ce=y.useRef(null),ue=y.useRef(null),de=y.useRef(null),he=!r;y.useEffect(()=>{const e=new(window.AudioContext||window.webkitAudioContext);return de.current=e,()=>{e&&"closed"!==e.state&&e.close()}},[]),y.useEffect(()=>{const e=()=>{window.visualViewport?P(window.visualViewport.height):P(window.innerHeight)};return window.visualViewport?(window.visualViewport.addEventListener("resize",e),window.visualViewport.addEventListener("scroll",e)):window.addEventListener("resize",e),()=>{window.visualViewport?(window.visualViewport.removeEventListener("resize",e),window.visualViewport.removeEventListener("scroll",e)):window.removeEventListener("resize",e)}},[]);y.useEffect(()=>{if(r?.id&&t?.role){fe();const e=ji.channel("messages-changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},e=>{if(e.new.recipient_id===r.id||e.new.sender_id===r.id){if(fe(),_){const r=t?.role;let s=!1;s="nutritionist"===r||"admin"===r||"super_admin"===r?e.new.sender_id===_||e.new.recipient_id===_:e.new.conversation_id===_,s&&pe(_)}e.new.recipient_id===r.id&&e.new.sender_id!==r.id&&((()=>{if(E&&de.current)try{const e=de.current.createOscillator(),t=de.current.createGain();e.connect(t),t.connect(de.current.destination),e.frequency.value=800,e.type="sine",t.gain.setValueAtTime(.3,de.current.currentTime),t.gain.exponentialRampToValueAtTime(.01,de.current.currentTime+.3),e.start(de.current.currentTime),e.stop(de.current.currentTime+.3)}catch(e){console.error("Error playing notification sound:",e)}})(),s({title:" New Message",description:"You have received a new message",duration:3e3}))}}).subscribe();return()=>{ji.removeChannel(e)}}},[r?.id,t?.role,_]);const fe=async()=>{if(r?.id)try{const e=t?.role;let s;s="nutritionist"===e||"admin"===e||"super_admin"===e?ji.from("messages").select("\n            *,\n            sender:user_profiles!messages_sender_id_fkey(id, full_name, email, profile_picture_url),\n            recipient:user_profiles!messages_recipient_id_fkey(id, full_name, email, profile_picture_url)\n          ").or(`sender_id.eq.${r.id},recipient_id.eq.${r.id}`).order("created_at",{ascending:!1}):ji.from("conversations").select("\n            *,\n            nutritionist:nutritionist_id (\n              id,\n              full_name,\n              email,\n              profile_picture_url\n            )\n          ").eq("user_id",r.id).order("last_message_at",{ascending:!1});const{data:n,error:i}=await s;if(i)throw i;if("nutritionist"===e||"admin"===e||"super_admin"===e){const e=new Map;n?.forEach(t=>{if(!t||!t.sender_id||!t.recipient_id)return;const s=t.sender_id===r.id?t.recipient_id:t.sender_id,n=t.sender_id===r.id?t.recipient||{}:t.sender||{};if(n&&n.id)if(e.has(s)){const n=e.get(s);new Date(t.created_at)>new Date(n.lastMessage.created_at)&&(n.lastMessage=t),t.recipient_id!==r.id||t.is_read||n.unreadCount++}else e.set(s,{id:s,partner:n,lastMessage:t,unreadCount:t.recipient_id!==r.id||t.is_read?0:1})}),w(Array.from(e.values())),S(Array.from(e.values()).reduce((e,t)=>e+t.unreadCount,0))}else w(n||[]),S(n?.reduce((e,t)=>e+(t.unread_count||0),0)||0)}catch(e){console.error("Error fetching conversations:",e)}},pe=async e=>{try{const s=t?.role;let n;n="nutritionist"===s||"admin"===s||"super_admin"===s?ji.from("messages").select("*").or(`and(sender_id.eq.${r.id},recipient_id.eq.${e}),and(sender_id.eq.${e},recipient_id.eq.${r.id})`).order("created_at",{ascending:!0}):ji.from("messages").select("*").eq("conversation_id",e).order("created_at",{ascending:!0});const{data:i,error:o}=await n;if(o)throw o;k(i||[]),"nutritionist"===s||"admin"===s||"super_admin"===s?await ji.from("messages").update({is_read:!0}).eq("recipient_id",r.id).eq("sender_id",e):await ji.from("messages").update({is_read:!0}).eq("conversation_id",e).eq("recipient_id",r.id),fe()}catch(s){console.error("Error fetching messages:",s)}},me=(()=>{if(he)return["What features does GreenoFig offer?","Tell me about the pricing plans","I'd like to speak with someone from your team"];const e=t?.role;return"admin"===e||"super_admin"===e?["Show me platform analytics overview","What are the best practices for user engagement?","Help me analyze subscription trends"]:"nutritionist"===e?["Suggest evidence-based nutrition strategies","Help me create a client meal plan template","What are current nutrition research trends?"]:["Give me a healthy breakfast idea","Suggest a quick 15-minute workout","How can I improve my sleep quality?"]})();y.useEffect(()=>{const e=setTimeout(()=>b(!0),3e3),t=setTimeout(()=>b(!1),8e3);return()=>{clearTimeout(e),clearTimeout(t)}},[]),y.useEffect(()=>{const e=e=>{ue.current&&!ue.current.contains(e.target)&&n&&i(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[n]);y.useEffect(()=>{ce.current?.scrollIntoView({behavior:"smooth"})},[u,j]),y.useEffect(()=>{if(n&&0===u.length&&"ai"===l){let e="";if(he)e="Hi there!  Welcome to GreenoFig! I'm your Website Assistant. I can help answer questions about our platform, features, pricing, and how we can support your health journey. If you'd like to speak with our team, just let me know!";else{const r=t?.role;e="admin"===r||"super_admin"===r?`Hi ${t?.full_name?.split(" ")[0]||"Admin"}!  I'm your AI Business Assistant. I can help with analytics, strategies, and platform insights.`:"nutritionist"===r?`Hi ${t?.full_name?.split(" ")[0]||"there"}!  I'm your AI Nutrition Assistant. I can help with evidence-based strategies, client plans, and research.`:`Hi ${t?.full_name?.split(" ")[0]||"there"}!  I'm your AI Health Coach. How can I help you today?`}const r={id:Date.now(),text:e,sender:"ai"};d([r])}},[n,he,t,l]);const ge=async(e,n)=>{if(e&&e.preventDefault(),"messages"===l)return void(async()=>{if(!h.trim()||!_)return;const e=h.trim();f("");try{const s=t?.role,n={message_text:e,sender_id:r.id,is_read:!1,created_at:(new Date).toISOString()};"nutritionist"===s||"admin"===s||"super_admin"===s?n.recipient_id=_:(n.conversation_id=_,n.recipient_id=v.find(e=>e.id===_)?.nutritionist?.id);const{error:i}=await ji.from("messages").insert([n]);if(i)throw i}catch(n){console.error("Error sending message:",n),s({title:"Error",description:"Failed to send message",variant:"destructive"})}})();const i=n||h;if(!i.trim()||p)return;const o={...{text:i,sender:"user",user_id:r?.id},id:Date.now(),created_at:(new Date).toISOString()},a=[...u,o];d(a),f(""),m(!0);try{if(he&&(i.toLowerCase().includes("talk to someone")||i.toLowerCase().includes("speak with")||i.toLowerCase().includes("contact")||i.toLowerCase().includes("representative")||i.toLowerCase().includes("human")||i.toLowerCase().includes("real person")||i.toLowerCase().includes("team member"))){const e={text:"I'd be happy to connect you with our team! Please provide your name and email address, and someone from our team will reach out to you shortly.",sender:"ai",id:Date.now()+1};return d(t=>[...t,e]),G(!0),void m(!1)}const{data:e,error:s}=await ji.functions.invoke("ai-coach-memory",{body:JSON.stringify({messages:a.slice(-10),userProfile:he?{isVisitor:!0,role:"visitor",systemPrompt:"You are a helpful Website Assistant for GreenoFig, an AI-powered health and wellness platform. You can ONLY answer questions about: the website features, pricing plans, how the platform works, subscription details, privacy and security, payment methods, and general information about our services. If asked about personal health advice, meal plans, or fitness routines, politely explain that users need to sign up to access our AI Health Coach. Keep responses friendly, concise, and focused on helping visitors understand our platform."}:{...t,isAdmin:"admin"===t?.role||"super_admin"===t?.role,isNutritionist:"nutritionist"===t?.role}})});if(s)throw s;const n={text:e.reply,sender:"ai",user_id:r?.id,id:Date.now()+1,created_at:(new Date).toISOString()};d(e=>[...e,n])}catch(c){console.error("AI Coach error:",c);const e={text:"I'm having trouble connecting right now. Please try again! ",sender:"ai",id:Date.now()+1};d(t=>[...t,e]),s({title:"Error",description:"Failed to get AI response. Please try again.",variant:"destructive"})}finally{m(!1)}},ye=e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),ge())},be=()=>{i(!n),a(!1)};return e.jsxs("div",{ref:ue,children:[e.jsx(U,{children:!n&&e.jsxs(A.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1,[R]:16},exit:{scale:0,opacity:0},transition:{type:"spring",stiffness:500,damping:30,mass:.8},className:"fixed bottom-6 z-[9999]",style:{[R]:"16px"},children:[e.jsx(U,{children:g&&e.jsxs(A.div,{initial:{opacity:0,x:"right"===R?20:-20,scale:.8},animate:{opacity:1,x:0,scale:1},exit:{opacity:0,x:"right"===R?20:-20,scale:.8},className:"absolute bottom-20 bg-card rounded-lg shadow-xl p-3 w-56 border border-primary/20 "+("right"===R?"right-0":"left-0"),children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(B,{className:"h-5 w-5 text-primary shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-card-foreground",children:"Need help?"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Chat with AI Coach or message your nutritionist!"})]})]}),e.jsx("div",{className:"absolute -bottom-2 w-4 h-4 bg-card border-r border-b border-primary/20 transform rotate-45 "+("right"===R?"right-6":"left-6")})]})}),e.jsxs(A.div,{drag:"x",dragConstraints:{left:-(window.innerWidth-96),right:window.innerWidth-96},dragElastic:.1,dragMomentum:!1,onDragEnd:(e,t)=>{const r=window.innerWidth,s=e.target.getBoundingClientRect(),n=s.left+s.width/2<r/2?"left":"right";$(n),localStorage.setItem("chatButtonPosition",n)},onClick:be,whileHover:{scale:1.05},whileTap:{scale:.95},className:"h-16 w-16 rounded-full shadow-2xl cursor-grab active:cursor-grabbing relative bg-gradient-to-br from-primary to-green-400 touch-none select-none",children:[T>0&&e.jsx(A.div,{initial:{scale:0},animate:{scale:1},className:"absolute -top-1 -right-1 h-6 w-6 rounded-full bg-red-500 flex items-center justify-center text-white text-xs font-bold shadow-lg z-10",children:T>9?"9+":T}),e.jsx(A.div,{animate:{boxShadow:["0 0 10px hsl(var(--primary) / 0.3)","0 0 20px hsl(var(--primary) / 0.4)","0 0 10px hsl(var(--primary) / 0.3)"]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:"absolute inset-0 rounded-full"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-2",children:e.jsx("img",{src:Pi,alt:"GreenoFig AI Coach",className:"h-12 w-12 object-contain drop-shadow-lg",style:{filter:"brightness(0.75) contrast(1.15)"}})})]})]})}),e.jsx(U,{children:n&&e.jsxs(A.div,{initial:{opacity:0,y:50,scale:.9},animate:{opacity:1,y:0,scale:1,[R]:16},exit:{opacity:0,y:50,scale:.9},transition:{type:"spring",stiffness:300,damping:30},className:"fixed w-[calc(100vw-32px)] max-w-[320px] md:max-w-[340px] bg-card rounded-2xl shadow-2xl z-[9999] border border-border overflow-hidden flex flex-col",style:{[R]:"16px",bottom:"16px",height:o?"60px":"auto",maxHeight:o?"60px":"550px"},children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary to-green-400 p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0 overflow-hidden",children:[e.jsx("div",{className:"rounded-full bg-white/20 flex items-center justify-center overflow-hidden flex-shrink-0 "+(o?"h-8 w-8":"h-10 w-10"),children:e.jsx("img",{src:Pi,alt:"GreenoFig",className:"rounded-full object-cover "+(o?"h-6 w-6":"h-8 w-8")})}),e.jsxs("div",{className:"flex-1 min-w-0 overflow-hidden",children:[e.jsx("h3",{className:"font-semibold text-white text-sm truncate whitespace-nowrap",children:he?"Website Assistant":"ai"===l?"AI Health Coach":"Messages"}),!o&&e.jsx("p",{className:"text-xs text-white/80 truncate whitespace-nowrap",children:he?"Ask me about GreenoFig!":"ai"===l?p?"Thinking...":"Online":`${v.length} conversations`})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ai,{variant:"ghost",size:"sm",onClick:()=>O(!E),className:"h-8 w-8 p-0 text-white hover:bg-white/20",title:E?"Mute notifications":"Unmute notifications",children:E?e.jsx(M,{className:"h-4 w-4"}):e.jsx(F,{className:"h-4 w-4"})}),e.jsx(Ai,{variant:"ghost",size:"sm",onClick:()=>{a(!o)},className:"h-8 w-8 p-0 text-white hover:bg-white/20",children:o?e.jsx(z,{className:"h-4 w-4"}):e.jsx(H,{className:"h-4 w-4"})}),e.jsx(Ai,{variant:"ghost",size:"sm",onClick:be,className:"h-8 w-8 p-0 text-white hover:bg-white/20",children:e.jsx(C,{className:"h-4 w-4"})})]})]}),!o&&!he&&e.jsxs("div",{className:"flex border-b border-border bg-muted/30",children:[e.jsxs("button",{onClick:()=>c("ai"),className:"flex-1 py-3 px-4 flex items-center justify-center gap-2 font-medium text-sm transition-all "+("ai"===l?"bg-background text-primary border-b-2 border-primary":"text-muted-foreground hover:text-foreground hover:bg-muted/50"),children:[e.jsx(q,{className:"h-4 w-4"}),"AI Coach"]}),e.jsxs("button",{onClick:()=>c("messages"),className:"flex-1 py-3 px-4 flex items-center justify-center gap-2 font-medium text-sm transition-all relative "+("messages"===l?"bg-background text-primary border-b-2 border-primary":"text-muted-foreground hover:text-foreground hover:bg-muted/50"),children:[e.jsx(V,{className:"h-4 w-4"}),"Messages",T>0&&e.jsx(Bi,{variant:"destructive",className:"h-5 min-w-[20px] px-1.5 text-[10px]",children:T>9?"9+":T})]})]}),!o&&"ai"===l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-muted/30",style:{maxHeight:"320px"},children:[e.jsx(U,{children:u.map((t,r)=>e.jsx(A.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex "+("user"===t.sender?"justify-end":"justify-start"),children:e.jsx("div",{className:"max-w-[85%] rounded-xl px-3 py-2.5 shadow-sm "+("user"===t.sender?"bg-gradient-to-br from-primary to-green-400 text-primary-foreground":"bg-card border border-border text-card-foreground"),children:e.jsx("p",{className:"text-[13px] leading-relaxed whitespace-pre-wrap break-words",children:t.text})})},t.id||r))}),p&&e.jsx(A.div,{initial:{opacity:0},animate:{opacity:1},className:"flex justify-start",children:e.jsx("div",{className:"bg-muted rounded-xl px-4 py-3 shadow-sm",children:e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 bg-primary/60 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-2 h-2 bg-primary/60 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-2 h-2 bg-primary/60 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})}),e.jsx("div",{ref:ce})]}),u.length<=1&&!p&&!D&&e.jsx("div",{className:"px-3 pb-2 pt-1",children:e.jsx("div",{className:"space-y-2",children:me.map((t,r)=>e.jsx(A.button,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{delay:.1*r},onClick:e=>ge(e,t),className:"w-full p-2 bg-muted hover:bg-accent rounded-lg text-left text-xs transition-colors",children:t},r))})}),e.jsx("div",{className:"p-4 bg-card border-t border-border",children:D?e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),Q.trim()&&K.trim()){re(!0);try{const{error:e}=await ji.from("visitor_inquiries").insert([{name:K,email:Q,question:Z||h,conversation_history:JSON.stringify(u),status:"pending",created_at:(new Date).toISOString()}]);if(e)throw e;s({title:"Thank you!",description:"Our team will get back to you shortly via email."});const t={id:Date.now(),text:`Thank you, ${K}! I've forwarded your information to our team. Someone will reach out to you at ${Q} shortly. Is there anything else I can help you with about our website?`,sender:"ai"};d(e=>[...e,t]),G(!1),Y(""),X(""),ee("")}catch(t){console.error("Error submitting lead:",t),s({title:"Error",description:"Failed to submit your information. Please try again or email us directly at support@greenofig.com",variant:"destructive"})}finally{re(!1)}}else s({title:"Missing Information",description:"Please provide your name and email",variant:"destructive"})},className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(Hi,{htmlFor:"visitor-name",className:"text-xs font-medium",children:"Name *"}),e.jsx(Fi,{id:"visitor-name",type:"text",value:K,onChange:e=>Y(e.target.value),placeholder:"Your name",className:"mt-1 text-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx(Hi,{htmlFor:"visitor-email",className:"text-xs font-medium",children:"Email *"}),e.jsx(Fi,{id:"visitor-email",type:"email",value:Q,onChange:e=>X(e.target.value),placeholder:"your@email.com",className:"mt-1 text-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx(Hi,{htmlFor:"visitor-question",className:"text-xs font-medium",children:"Question (Optional)"}),e.jsx(Mi,{id:"visitor-question",value:Z,onChange:e=>ee(e.target.value),placeholder:"Tell us how we can help...",className:"mt-1 text-sm resize-none",rows:2})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ai,{type:"button",variant:"outline",onClick:()=>G(!1),className:"flex-1",disabled:te,children:"Cancel"}),e.jsx(Ai,{type:"submit",disabled:te,className:"flex-1 bg-gradient-to-br from-primary to-green-400",children:te?"Sending...":"Submit"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:ge,className:"flex gap-3 items-end",children:[e.jsx(Mi,{value:h,onChange:e=>f(e.target.value),onKeyPress:ye,placeholder:he?"Ask about our platform...":"Ask me anything...",className:"flex-1 min-h-[48px] max-h-[120px] resize-none text-sm bg-background border-input focus:border-ring focus:ring-2 focus:ring-primary/20 rounded-lg p-3",rows:2}),e.jsx(Ai,{type:"submit",disabled:!h.trim()||p,size:"icon",className:"h-12 w-12 bg-gradient-to-br from-primary to-green-400 hover:from-primary/90 hover:to-green-400/90 shrink-0 shadow-md transition-all",children:e.jsx(W,{className:"h-5 w-5"})})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-2 text-center",children:"Press Enter to send  Shift+Enter for new line"})]})})]}),!o&&"messages"===l&&e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[!_&&!se&&("admin"===t?.role||"super_admin"===t?.role||"nutritionist"===t?.role)&&e.jsx("div",{className:"p-3 border-b border-border",children:e.jsxs(Ai,{onClick:()=>{ne(!0),(async()=>{try{const{data:e,error:t}=await ji.from("user_profiles").select("id, full_name, email, profile_picture_url, role").neq("id",r.id).order("full_name");if(t)throw t;oe(e||[])}catch(e){console.error("Error fetching users:",e)}})()},className:"w-full bg-gradient-to-br from-primary to-green-400",size:"sm",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"New Message"]})}),se&&e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ai,{variant:"ghost",size:"sm",onClick:()=>{ne(!1),le("")},className:"h-8 w-8 p-0",title:"Back to conversations",children:e.jsx(I,{className:"h-4 w-4"})}),e.jsx("h3",{className:"text-sm font-semibold",children:"Select User to Message"})]}),e.jsx(Fi,{placeholder:"Search users...",value:ae,onChange:e=>le(e.target.value),className:"text-sm"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto divide-y divide-border",children:ie.filter(e=>e.full_name?.toLowerCase().includes(ae.toLowerCase())||e.email?.toLowerCase().includes(ae.toLowerCase())).map(t=>e.jsxs(A.button,{onClick:()=>{return e=t.id,x(e),ne(!1),le(""),void pe(e);var e},className:"w-full p-3 hover:bg-muted/50 transition-colors text-left flex items-center gap-3",whileHover:{backgroundColor:"rgba(0,0,0,0.02)"},children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:t.profile_picture_url?e.jsx("img",{src:t.profile_picture_url,alt:t.full_name,className:"h-full w-full rounded-full object-cover"}):e.jsx("span",{className:"text-sm font-semibold text-primary",children:t.full_name?.charAt(0)||"?"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground truncate",children:t.full_name||"Unknown"}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:t.email})]}),e.jsx(Bi,{variant:"outline",className:"text-[10px]",children:t.role})]},t.id))})]}),!_&&!se&&e.jsx("div",{className:"flex-1 overflow-y-auto",children:0===v.length?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-6 text-center",children:[e.jsx(V,{className:"h-12 w-12 text-muted-foreground mb-3"}),e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"No conversations yet"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Start chatting with your ","user"===t?.role?"nutritionist":"clients","!"]})]}):e.jsx("div",{className:"divide-y divide-border",children:v.map(t=>{const r=t.partner||t.nutritionist,s=t.lastMessage||{message_text:t.last_message,created_at:t.last_message_at},n=t.unreadCount||t.unread_count||0;return e.jsxs(A.button,{onClick:()=>{return e=t.id,x(e),void pe(e);var e},className:"w-full p-3 hover:bg-muted/50 transition-colors text-left flex items-start gap-3",whileHover:{backgroundColor:"rgba(0,0,0,0.02)"},children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:r?.profile_picture_url?e.jsx("img",{src:r.profile_picture_url,alt:r.full_name,className:"h-full w-full rounded-full object-cover"}):e.jsx("span",{className:"text-sm font-semibold text-primary",children:r?.full_name?.charAt(0)||"?"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground truncate",children:r?.full_name||"Unknown"}),s?.created_at&&e.jsx("span",{className:"text-[10px] text-muted-foreground whitespace-nowrap ml-2",children:J(new Date(s.created_at),"MMM d")})]}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s?.message_text||"No messages yet"})]}),n>0&&e.jsx(Bi,{variant:"destructive",className:"h-5 min-w-[20px] px-1.5 text-[10px] flex-shrink-0",children:n})]},t.id)})})}),_&&e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"p-3 border-b border-border flex items-center gap-3 bg-muted/30",children:[e.jsx(Ai,{variant:"ghost",size:"sm",onClick:()=>{x(null),k([])},className:"h-8 w-8 p-0",title:"Back to conversations",children:e.jsx(I,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm font-semibold",children:v.find(e=>e.id===_)?.partner?.full_name||v.find(e=>e.id===_)?.nutritionist?.full_name||"Conversation"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-2 bg-muted/30",style:{maxHeight:"320px"},children:[j.map(t=>e.jsx(A.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex "+(t.sender_id===r.id?"justify-end":"justify-start"),children:e.jsxs("div",{className:"max-w-[85%] rounded-xl px-3 py-2 shadow-sm "+(t.sender_id===r.id?"bg-gradient-to-br from-primary to-green-400 text-primary-foreground":"bg-card border border-border text-card-foreground"),children:[e.jsx("p",{className:"text-[13px] leading-relaxed whitespace-pre-wrap break-words",children:t.message_text}),e.jsx("span",{className:"text-[10px] opacity-70 mt-1 block",children:J(new Date(t.created_at),"h:mm a")})]})},t.id)),e.jsx("div",{ref:ce})]}),e.jsx("div",{className:"p-4 bg-card border-t border-border",children:e.jsxs("form",{onSubmit:ge,className:"flex gap-3 items-end",children:[e.jsx(Mi,{value:h,onChange:e=>f(e.target.value),onKeyPress:ye,placeholder:"Type a message...",className:"flex-1 min-h-[48px] max-h-[120px] resize-none text-sm bg-background border-input focus:border-ring focus:ring-2 focus:ring-primary/20 rounded-lg p-3",rows:2}),e.jsx(Ai,{type:"submit",disabled:!h.trim(),size:"icon",className:"h-12 w-12 bg-gradient-to-br from-primary to-green-400 hover:from-primary/90 hover:to-green-400/90 shrink-0 shadow-md transition-all",children:e.jsx(W,{className:"h-5 w-5"})})]})})]})]})]})})]})},Vi=({targetId:t="main-content"})=>{const[r,s]=y.useState(!1);y.useEffect(()=>{document.getElementById(t)||window;const e=t?document.getElementById(t):null,r=()=>{e?e.scrollTop>300?s(!0):s(!1):window.pageYOffset>300?s(!0):s(!1)};return e?e.addEventListener("scroll",r):window.addEventListener("scroll",r),()=>{e?e.removeEventListener("scroll",r):window.removeEventListener("scroll",r)}},[t]);return e.jsx(U,{children:r&&e.jsx(A.div,{initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:20},className:"fixed bottom-6 left-1/2 -translate-x-1/2 md:left-6 md:translate-x-0 z-40",children:e.jsx(Ai,{onClick:()=>{const e=t?document.getElementById(t):null;e?e.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"})},size:"icon",className:"h-12 w-12 rounded-full shadow-lg bg-primary/60 hover:bg-primary/80 backdrop-blur-sm text-primary-foreground border border-primary/20","aria-label":"Scroll to top",children:e.jsx(G,{className:"h-5 w-5"})})})})},Wi=({user:t})=>{const[r,s]=y.useState([]),[n,i]=y.useState(0),[o,a]=y.useState(!1),[l,c]=y.useState(!1),u=y.useRef(null),d=w(),{toast:h}=ur();y.useEffect(()=>{const e=e=>{u.current&&!u.current.contains(e.target)&&a(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const f=async()=>{if(t?.id){c(!0);try{const{data:e,error:r}=await ji.from("notifications").select("*").eq("user_id",t.id).order("created_at",{ascending:!1}).limit(20);if(r)throw r;s(e||[]),i(e?.filter(e=>!e.is_read).length||0)}catch(e){console.error("Error loading notifications:",e)}finally{c(!1)}}};y.useEffect(()=>{if(!t?.id)return;f();const e=ji.channel("notifications").on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:`user_id=eq.${t.id}`},e=>{console.log("Notification update:",e),f()}).subscribe();return()=>{ji.removeChannel(e)}},[t?.id]);const p=(t,r)=>{const s="urgent"===r?"text-red-400":"high"===r?"text-orange-400":"text-blue-400";switch(t){case"blog_generated":case"new_user":case"user_login":case"nutritionist_login":return e.jsx(Q,{className:`w-5 h-5 ${s}`});case"queue_low":case"queue_empty":return e.jsx(X,{className:"w-5 h-5 text-yellow-400"});case"system_alert":return e.jsx(Y,{className:"w-5 h-5 text-red-400"});default:return e.jsx(M,{className:`w-5 h-5 ${s}`})}},m=e=>{const t=Math.floor((new Date-new Date(e))/1e3);if(t<60)return"Just now";const r=Math.floor(t/60);if(r<60)return`${r}m ago`;const s=Math.floor(r/60);if(s<24)return`${s}h ago`;return`${Math.floor(s/24)}d ago`};return e.jsxs("div",{className:"relative",ref:u,children:[e.jsxs("button",{onClick:()=>a(!o),className:"relative p-2 rounded-full hover:bg-accent transition-colors","aria-label":"Notifications",children:[e.jsx(M,{className:"w-6 h-6 text-foreground"}),n>0&&e.jsx("span",{className:"absolute top-0 right-0 flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-red-500 rounded-full",children:n>9?"9+":n})]}),o&&e.jsxs("div",{className:"absolute right-0 mt-2 w-96 bg-background border border-border rounded-2xl shadow-2xl z-50 max-h-[600px] overflow-hidden flex flex-col glass-effect",children:[e.jsxs("div",{className:"p-4 border-b border-border flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Notifications"}),e.jsx("div",{className:"flex items-center gap-2",children:n>0&&e.jsxs("button",{onClick:async()=>{try{const{error:e}=await ji.from("notifications").update({is_read:!0,read_at:(new Date).toISOString()}).eq("user_id",t.id).eq("is_read",!1);if(e)throw e;s(e=>e.map(e=>({...e,is_read:!0}))),i(0),h({title:"All notifications marked as read"})}catch(e){console.error("Error marking all as read:",e),h({title:"Error",description:"Failed to mark notifications as read",variant:"destructive"})}},className:"text-sm text-primary hover:underline flex items-center gap-1",children:[e.jsx(K,{className:"w-4 h-4"}),"Mark all read"]})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:l?e.jsx("div",{className:"p-8 text-center text-text-secondary",children:"Loading notifications..."}):0===r.length?e.jsxs("div",{className:"p-8 text-center text-text-secondary",children:[e.jsx(M,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No notifications yet"})]}):e.jsx("div",{className:"divide-y divide-border",children:r.map(t=>e.jsx("div",{className:"p-4 hover:bg-accent/50 transition-colors cursor-pointer "+(t.is_read?"":"bg-accent/20"),onClick:()=>(async(e,t)=>{try{const{error:r}=await ji.from("notifications").update({is_read:!0,read_at:(new Date).toISOString()}).eq("id",e);if(r)throw r;s(t=>t.map(t=>t.id===e?{...t,is_read:!0}:t)),i(e=>Math.max(0,e-1)),t&&(d(t),a(!1))}catch(r){console.error("Error marking notification as read:",r)}})(t.id,t.action_url),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:p(t.type,t.priority)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-foreground",children:t.title}),e.jsx("button",{onClick:e=>{e.stopPropagation(),(async e=>{try{const{error:t}=await ji.from("notifications").delete().eq("id",e);if(t)throw t;s(t=>t.filter(t=>t.id!==e))}catch(t){console.error("Error deleting notification:",t)}})(t.id)},className:"text-text-secondary hover:text-red-400 flex-shrink-0",children:e.jsx(C,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-sm text-text-secondary mt-1 line-clamp-2",children:t.message}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("span",{className:"text-xs text-text-secondary",children:m(t.created_at)}),!t.is_read&&e.jsx("span",{className:"w-2 h-2 bg-primary rounded-full"})]})]})]})},t.id))})}),r.length>0&&e.jsx("div",{className:"p-3 border-t border-border",children:e.jsx(Ai,{variant:"ghost",size:"sm",className:"w-full",onClick:()=>{d("/app/notifications"),a(!1)},children:"View all notifications"})})]})]})},Ji=({logoUrl:t})=>{const{userProfile:r,signOut:s}=Ni();w();const n=_(),[i,o]=y.useState(!1),[a,l]=y.useState(0);y.useEffect(()=>{if(r?.id){c();try{const e=ji.channel("conversations-changes").on("postgres_changes",{event:"*",schema:"public",table:"conversations",filter:"user"===r.role?`user_id=eq.${r.id}`:`nutritionist_id=eq.${r.id}`},()=>{c()}).subscribe(e=>{"CHANNEL_ERROR"===e&&console.warn("Realtime subscription error - will use polling instead")});return()=>{try{ji.removeChannel(e)}catch(t){}}}catch(e){console.warn("Realtime not available, using polling only:",e.message);const t=setInterval(c,3e4);return()=>clearInterval(t)}}},[r?.id]);const c=async()=>{if(r?.id)try{if("user"===r.role){const{data:e,error:t}=await ji.rpc("get_unread_message_count",{p_user_id:r.id});t||l(e||0)}else if(["nutritionist","admin","super_admin"].includes(r.role)){const{data:e,error:t}=await ji.rpc("get_nutritionist_unread_count",{p_nutritionist_id:r.id});t||l(e||0)}}catch(e){console.error("Error fetching unread count:",e)}},u=async()=>{await s()},d=[{icon:te,label:"Dashboard",path:"/app/user"},{icon:re,label:"AI Coach",path:"/app/ai-coach"},{icon:se,label:"Nutrition",path:"/app/nutrition"},{icon:ne,label:"Fitness",path:"/app/fitness"},{icon:ie,label:"Progress",path:"/app/progress"},{icon:L,label:"Messages",path:"/app/messages"},{icon:V,label:"Support",path:"/app/support"}],h=[{icon:te,label:"Dashboard",path:"/app/nutritionist?tab=dashboard"},{icon:oe,label:"Clients",path:"/app/nutritionist?tab=clients"},{icon:se,label:"Meal Plans",path:"/app/nutritionist?tab=meals"},{icon:ae,label:"Schedule",path:"/app/nutritionist?tab=schedule"},{icon:V,label:"Messages",path:"/app/nutritionist?tab=messages"},{icon:ie,label:"Analytics",path:"/app/nutritionist?tab=analytics"},{icon:le,label:"Resources",path:"/app/nutritionist?tab=resources"},{icon:le,label:"Blog",path:"/app/nutritionist?tab=blog"},{icon:ce,label:"Settings",path:"/app/nutritionist?tab=settings"}],f=[{icon:te,label:"Dashboard",path:"/app/admin"},{icon:ie,label:"Analytics",path:"/app/admin?tab=analytics"},{icon:ue,label:"Revenue",path:"/app/admin?tab=revenue"},{icon:de,label:"AI Errors",path:"/app/admin?tab=errors"},{icon:oe,label:"User Management",path:"/app/admin?tab=customers"},{icon:he,label:"Subscriptions",path:"/app/admin?tab=subscriptions"},{icon:fe,label:"Payments",path:"/app/admin?tab=payments"},{icon:pe,label:"Coupons",path:"/app/admin?tab=coupons"},{icon:me,label:"Referrals",path:"/app/admin?tab=referrals"},{icon:ge,label:"Support",path:"/app/admin?tab=issues"},{icon:V,label:"Messaging",path:"/app/admin?tab=messaging"},{icon:le,label:"Blog",path:"/app/admin?tab=blog"},{icon:ye,label:"Website",path:"/app/admin?tab=website"},{icon:re,label:"AI Coach",path:"/app/admin?tab=ai-coach"},{icon:be,label:"Database",path:"/app/admin?tab=studio"}],p=(()=>{switch(r?.role){case"admin":case"super_admin":return f;case"nutritionist":return h;default:return d}})(),m=({link:t,isActive:r})=>{const[s,n]=y.useState(!1),l="/app/messages"===t.path&&a>0;return e.jsxs(k,{to:t.path,end:!0,onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),className:`flex items-center gap-2 px-2 py-2 sm:py-1.5 rounded-md transition-all duration-200 text-sm sm:text-xs font-medium border min-h-[44px] sm:min-h-0 ${r||s?"bg-gradient-to-r from-primary to-green-400 text-primary-foreground border-primary/30":"bg-transparent text-muted-foreground border-transparent hover:border-primary/30"} ${s?"translate-x-1":"translate-x-0"}`,onClick:()=>i&&o(!1),children:[e.jsx(t.icon,{className:"w-4 h-4 sm:w-3.5 sm:h-3.5 flex-shrink-0"}),e.jsx("span",{className:"flex-1 truncate",children:t.label}),l&&e.jsx(Bi,{className:"bg-red-500 text-white text-xs px-1.5 py-0.5 min-w-[20px] h-5 sm:h-4 flex items-center justify-center",children:a>99?"99+":a})]})},g=()=>{return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"p-3 sm:p-2.5 border-b border-border flex items-center gap-2",children:e.jsxs(x,{to:"/home",className:"flex items-center gap-1.5",children:[e.jsx("img",{src:t,alt:"GreenoFig Logo",className:"w-7 h-7 sm:w-6 sm:h-6"}),e.jsx("span",{className:"text-base sm:text-sm font-bold gradient-text",children:"GreenoFig"})]})}),e.jsx("nav",{className:"flex-1 p-2 space-y-0.5 overflow-y-auto",children:p.map(t=>{let r=!1;return r=t.path.includes("?")?n.pathname+n.search===t.path:"/app/admin"===t.path?n.pathname===t.path&&!n.search:n.pathname===t.path,e.jsx(m,{link:t,isActive:r},t.path)})}),e.jsxs("div",{className:"p-3 border-t border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs($i,{className:"w-9 h-9 sm:w-8 sm:h-8",children:[e.jsx(Li,{src:r?.profile_picture_url}),e.jsx(Di,{className:"text-xs sm:text-[10px]",children:(s=r?.full_name,s?s.split(" ").map(e=>e[0]).join("").toUpperCase():"?")})]}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsx("p",{className:"text-sm sm:text-xs font-semibold truncate",children:r?.full_name}),e.jsx("p",{className:"text-xs sm:text-[10px] text-text-secondary truncate",children:r?.email})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(k,{to:"/app/profile",className:({isActive:e})=>"flex items-center gap-3 px-3 py-2.5 sm:py-2 rounded-lg transition-colors text-sm font-medium min-h-[44px] sm:min-h-0 "+(e?"bg-muted text-foreground":"text-text-secondary hover:bg-muted hover:text-foreground"),onClick:()=>i&&o(!1),children:[e.jsx($,{className:"w-4 h-4"}),"Profile"]}),e.jsxs("button",{onClick:u,className:"w-full flex items-center gap-3 px-3 py-2.5 sm:py-2 rounded-lg transition-colors text-sm font-medium text-text-secondary hover:bg-muted hover:text-foreground min-h-[44px] sm:min-h-0",children:[e.jsx(ve,{className:"w-4 h-4"}),"Sign Out"]})]})]})]});var s};return e.jsxs("div",{className:"flex h-screen bg-background text-foreground overflow-hidden",children:[e.jsx("aside",{className:"hidden lg:block w-64 bg-card border-r border-border flex-shrink-0",children:e.jsx(g,{})}),e.jsx(U,{children:i&&e.jsxs(e.Fragment,{children:[e.jsx(A.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-40 lg:hidden",onClick:()=>o(!1)}),e.jsx(A.aside,{variants:{open:{x:0,transition:{type:"spring",stiffness:300,damping:30}},closed:{x:"-100%",transition:{type:"spring",stiffness:300,damping:30}}},initial:"closed",animate:"open",exit:"closed",className:"fixed top-0 left-0 h-full w-72 sm:w-64 bg-card z-50 lg:hidden shadow-2xl",children:e.jsx(g,{})})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden min-w-0",children:[e.jsxs("header",{className:"sticky top-0 z-30 flex items-center justify-between lg:justify-end h-14 sm:h-16 px-4 border-b border-border bg-card/95 backdrop-blur supports-[backdrop-filter]:bg-card/60 flex-shrink-0",children:[e.jsx(Ai,{variant:"ghost",size:"icon",className:"lg:hidden min-h-[44px] min-w-[44px]",onClick:()=>o(!0),children:e.jsx(Z,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx(Wi,{user:r}),"admin"===r?.role||"super_admin"===r?.role?e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 text-xs sm:text-sm font-semibold text-primary",children:[e.jsx(ee,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Admin Mode"}),e.jsx("span",{className:"sm:hidden",children:"Admin"})]}):null]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 sm:p-6 lg:p-8",id:"main-content",children:e.jsx(j,{})})]}),e.jsx(qi,{}),e.jsx(Vi,{targetId:"main-content"})]})},Gi=y.lazy(()=>Oe(()=>import("./HomePage-BFuhBfQ-.js"),__vite__mapDeps([0,1,2,3,4]))),Ki=y.lazy(()=>Oe(()=>import("./FeaturesPage-Du5NLV5T.js"),__vite__mapDeps([5,1,2,3,4,6,7,8]))),Yi=y.lazy(()=>Oe(()=>import("./PricingPage-BRJWCn1l.js"),__vite__mapDeps([9,1,2,6,7,8,3,4,10]))),Qi=y.lazy(()=>Oe(()=>import("./BlogPage-CNufxHT8.js"),__vite__mapDeps([11,1,2,12,13,6,7,8,3,4,14]))),Xi=y.lazy(()=>Oe(()=>import("./ReviewsPage-BKY0T30e.js"),__vite__mapDeps([15,1,2,6,7,8,3,4,12]))),Zi=y.lazy(()=>Oe(()=>import("./ContactPage-d0-T8ZOc.js"),__vite__mapDeps([16,1,2,6,7,8,3,4]))),eo=y.lazy(()=>Oe(()=>import("./FaqPage-Cdrw4aGo.js"),__vite__mapDeps([17,1,2,6,7,8,3,4]))),to=y.lazy(()=>Oe(()=>import("./AboutPage-C6g6tYGT.js"),__vite__mapDeps([18,1,2,6,7,8,3,4]))),ro=y.lazy(()=>Oe(()=>import("./UserDashboard-C95dFTHq.js"),__vite__mapDeps([19,1,2,12,8,3,4,20,21,13]))),so=y.lazy(()=>Oe(()=>import("./NutritionistDashboardV2-BgdYCrva.js"),__vite__mapDeps([22,1,2,23,12,3,4,13,24,8,25]))),no=y.lazy(()=>Oe(()=>import("./AdminDashboard-BT9X742f.js"),__vite__mapDeps([26,1,2,23,12,3,4,13,24,8,21,27,25,28]))),io=y.lazy(()=>Oe(()=>import("./OnboardingSurvey-Bn8L8s2Y.js"),__vite__mapDeps([7,1,2,8,3,4]))),oo=y.lazy(()=>Oe(()=>import("./ProfilePage-l10gZz_i.js"),__vite__mapDeps([29,1,2,12,24,3,4]))),ao=y.lazy(()=>Oe(()=>import("./EnhancedBlogPostEditor-YzhXN-XO.js"),__vite__mapDeps([30,1,2,12,25,13,21,3,4,27,8]))),lo=y.lazy(()=>Oe(()=>import("./BlogTagsManager-DhEzrbX9.js"),__vite__mapDeps([31,1,2,12,13,8,3,4]))),co=y.lazy(()=>Oe(()=>import("./AiCoachPage-CVdP03BB.js"),__vite__mapDeps([32,1,2,3,4]))),uo=y.lazy(()=>Oe(()=>import("./SurveyPage-DuFAzrwS.js"),__vite__mapDeps([33,1,2,3,4]))),ho=y.lazy(()=>Oe(()=>import("./RevenueAnalyticsPage-CfXrOJlp.js"),__vite__mapDeps([28,1,2,12,13,3,4]))),fo=y.lazy(()=>Oe(()=>import("./BillingPage-vVZRw2r8.js").then(e=>e.B),__vite__mapDeps([34,1,2,12,13,3,4,10,8]))),po=y.lazy(()=>Oe(()=>import("./SupportPage-ChnPFUy6.js"),__vite__mapDeps([35,1,2,12,21,3,4,13]))),mo=y.lazy(()=>Oe(()=>import("./ResetPasswordPage-BLHvNtJA.js"),__vite__mapDeps([36,1,2,3,4]))),go=y.lazy(()=>Oe(()=>import("./NutritionPageFunctional-DnseFQge.js"),__vite__mapDeps([37,1,2,20,8,3,4,21]))),yo=y.lazy(()=>Oe(()=>import("./FitnessPage-D8y3tE0y.js"),__vite__mapDeps([38,1,2,3,4]))),bo=y.lazy(()=>Oe(()=>import("./ProgressPage-DLeMvUmP.js"),__vite__mapDeps([39,1,2,3,4]))),vo=y.lazy(()=>Oe(()=>import("./MessagingCenter-C8TkWWKh.js"),__vite__mapDeps([40,1,2,12,21,3,4,8]))),wo=y.lazy(()=>Oe(()=>import("./PrivacyPolicyPage-DZBkBnhC.js"),__vite__mapDeps([41,1,2,6,7,8,3,4]))),_o=y.lazy(()=>Oe(()=>import("./TermsOfServicePage-B9ZIpb8N.js"),__vite__mapDeps([42,1,2,6,7,8,3,4]))),xo=y.lazy(()=>Oe(()=>import("./AdminFAQPage-C8g2bFgF.js"),__vite__mapDeps([43,1,2,12,3,4]))),jo=()=>e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsx("img",{src:Pi,alt:"GreenoFig Logo",className:"w-24 h-24 animate-pulse"})}),ko=({children:t})=>{const{user:r,userProfile:s,loading:n}=Ni(),i=_();return r&&s?t:n&&!r?e.jsx(jo,{}):r?t:e.jsx(E,{to:"/login",state:{from:i},replace:!0})},To=({children:t})=>{const{user:r,userProfile:s,loading:n}=Ni();return n&&!r?e.jsx(jo,{}):"admin"!==s?.role&&"super_admin"!==s?.role?e.jsx(E,{to:"/app",replace:!0}):t},So=({children:t})=>{const{user:r,userProfile:s,loading:n}=Ni();return console.log("BlogEditorRoute - loading:",n,"userProfile:",s),n&&!r?(console.log("BlogEditorRoute: Still loading auth..."),e.jsx(jo,{})):["admin","super_admin","nutritionist"].includes(s?.role)?(console.log("BlogEditorRoute: Access granted for role:",s.role),t):(console.log("BlogEditorRoute: Access denied, role:",s?.role,"redirecting to /app"),e.jsx(E,{to:"/app",replace:!0}))},Eo=()=>{const{user:t,userProfile:r,loading:s}=Ni();if(s||t&&!r)return e.jsx(jo,{});if(!t)return e.jsx(E,{to:"/login",replace:!0});if(!r)return e.jsx(E,{to:"/login",replace:!0});const n=r.role;let i="/app/user";return"admin"===n||"super_admin"===n?i="/app/admin":"nutritionist"===n&&(i="/app/nutritionist"),e.jsx(E,{to:i,replace:!0})},Oo=()=>{const{user:t,loading:r}=Ni();return r?e.jsx(jo,{}):t?e.jsx(E,{to:"/app",replace:!0}):e.jsx(E,{to:"/home",replace:!0})};function No(){const t=_();return e.jsxs(e.Fragment,{children:[e.jsxs(Kt,{children:[e.jsx("title",{children:"GreenoFig - AI-Powered Health & Wellness"}),e.jsx("meta",{name:"description",content:"Your AI-Powered Health Companion. Achieve your wellness goals with personalized nutrition, fitness, and lifestyle coaching."})]}),e.jsx(y.Suspense,{fallback:e.jsx(jo,{}),children:e.jsx(U,{mode:"wait",children:e.jsxs(T,{location:t,children:[e.jsx(S,{path:"/login",element:e.jsx(Ri,{logoUrl:Pi})}),e.jsx(S,{path:"/signup",element:e.jsx(Ri,{logoUrl:Pi,initialIsLogin:!1})}),e.jsx(S,{path:"/reset-password",element:e.jsx(mo,{})}),e.jsxs(S,{path:"/app",element:e.jsx(ko,{children:e.jsx(Ji,{logoUrl:Pi})}),children:[e.jsx(S,{index:!0,element:e.jsx(Eo,{})}),e.jsx(S,{path:"user",element:e.jsx(ro,{logoUrl:Pi})}),e.jsx(S,{path:"nutritionist",element:e.jsx(so,{logoUrl:Pi})}),e.jsx(S,{path:"admin",element:e.jsx(no,{logoUrl:Pi})}),e.jsx(S,{path:"profile",element:e.jsx(oo,{logoUrl:Pi})}),e.jsx(S,{path:"billing",element:e.jsx(fo,{})}),e.jsx(S,{path:"support",element:e.jsx(po,{})}),e.jsx(S,{path:"ai-coach",element:e.jsx(co,{})}),e.jsx(S,{path:"nutrition",element:e.jsx(go,{})}),e.jsx(S,{path:"fitness",element:e.jsx(yo,{})}),e.jsx(S,{path:"progress",element:e.jsx(bo,{})}),e.jsx(S,{path:"messages",element:e.jsx(vo,{})}),e.jsx(S,{path:"admin/blog/new",element:e.jsx(So,{children:e.jsx(ao,{logoUrl:Pi})})}),e.jsx(S,{path:"admin/blog/edit/:postId",element:e.jsx(So,{children:e.jsx(ao,{logoUrl:Pi})})}),e.jsx(S,{path:"admin/blog/tags",element:e.jsx(To,{children:e.jsx(lo,{logoUrl:Pi})})}),e.jsx(S,{path:"nutritionist/blog/new",element:e.jsx(So,{children:e.jsx(ao,{logoUrl:Pi})})}),e.jsx(S,{path:"nutritionist/blog/edit/:postId",element:e.jsx(So,{children:e.jsx(ao,{logoUrl:Pi})})}),e.jsx(S,{path:"admin/faq",element:e.jsx(To,{children:e.jsx(xo,{})})}),e.jsx(S,{path:"admin/revenue",element:e.jsx(To,{children:e.jsx(ho,{})})})]}),e.jsx(S,{path:"/onboarding",element:e.jsx(ko,{children:e.jsx(io,{logoUrl:Pi})})}),e.jsx(S,{path:"/survey",element:e.jsx(uo,{logoUrl:Pi})}),e.jsx(S,{path:"/home",element:e.jsx(Gi,{logoUrl:Pi})}),e.jsx(S,{path:"/features",element:e.jsx(Ki,{logoUrl:Pi})}),e.jsx(S,{path:"/pricing",element:e.jsx(Yi,{logoUrl:Pi})}),e.jsx(S,{path:"/blog",element:e.jsx(Qi,{logoUrl:Pi})}),e.jsx(S,{path:"/blog/:postId",element:e.jsx(Qi,{logoUrl:Pi})}),e.jsx(S,{path:"/reviews",element:e.jsx(Xi,{logoUrl:Pi})}),e.jsx(S,{path:"/contact",element:e.jsx(Zi,{logoUrl:Pi})}),e.jsx(S,{path:"/faq",element:e.jsx(eo,{logoUrl:Pi})}),e.jsx(S,{path:"/about",element:e.jsx(to,{logoUrl:Pi})}),e.jsx(S,{path:"/privacy-policy",element:e.jsx(wo,{logoUrl:Pi})}),e.jsx(S,{path:"/terms-of-service",element:e.jsx(_o,{logoUrl:Pi})}),e.jsx(S,{path:"/",element:e.jsx(Oo,{})}),e.jsx(S,{path:"/*",element:e.jsx(E,{to:"/home",replace:!0})})]},t.pathname)})}),e.jsx(dr,{})]})}const Po=new class{constructor(){this.isInitialized=!1}init(){this.isInitialized||(window.onerror=(e,t,r,s,n)=>(this.logError({message:e.toString(),stack:n?.stack,type:"runtime_error",url:window.location.href,source:t,line:r,column:s}),!1),window.addEventListener("unhandledrejection",e=>{this.logError({message:`Unhandled Promise Rejection: ${e.reason}`,stack:e.reason?.stack,type:"promise_rejection",url:window.location.href})}),this.isInitialized=!0,console.log(" Error Logger initialized"))}async logError({message:e,stack:t="",type:r="unknown",componentName:s="unknown",severity:n="medium",url:i=window.location.href,source:o="",line:a=null,column:l=null,userId:c=null}){try{if(!c){const{data:{user:e}}=await ji.auth.getUser();c=e?.id||null}const u={error_message:e,error_stack:t,error_type:r,component_name:s,user_id:c,user_agent:navigator.userAgent,url:i,severity:n,status:"open",source_file:o,line_number:a,column_number:l,browser_info:{language:navigator.language,platform:navigator.platform,screen:{width:window.screen.width,height:window.screen.height}}},{error:d}=await ji.from("error_logs").insert([u]);d?console.error("Failed to log error to Supabase:",d):console.log("Error logged to database:",e)}catch(u){console.error("Error in errorLogger:",u)}}log(e,t="unknown",r="medium"){this.logError({message:e.message||e.toString(),stack:e.stack,type:"manual_log",componentName:t,severity:r})}};var Co;"undefined"!=typeof window&&Po.init(),Po.init(),Se.createRoot(document.getElementById("root")).render(e.jsx(g.StrictMode,{children:e.jsx(Oi,{children:e.jsx(O,{children:e.jsx(No,{})})})})),(Co=e=>{const{name:t,value:r,id:s}=e})&&Co instanceof Function&&Oe(async()=>{const{getCLS:e,getFID:t,getFCP:r,getLCP:s,getTTFB:n}=await Promise.resolve().then(()=>Ao);return{getCLS:e,getFID:t,getFCP:r,getLCP:s,getTTFB:n}},void 0).then(({getCLS:e,getFID:t,getFCP:r,getLCP:s,getTTFB:n})=>{e(Co),t(Co),r(Co),s(Co),n(Co)}).catch(()=>{}),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{console.log("Service Worker registered:",e.scope)}).catch(e=>{console.log("Service Worker registration failed:",e)})});const Ao=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{$i as A,Ai as B,qi as F,Kt as H,Fi as I,Hi as L,Mi as T,Oe as _,Vi as a,Li as b,Di as c,Yt as d,ur as e,Bi as f,Ci as g,Pi as l,ji as s,cr as t,Ni as u};
