import{j as e}from"./vendor-ui-B996hA52.js";import{a}from"./vendor-react-sNAoBuc2.js";import{D as s,a as t,b as l,c as r,d as i}from"./dialog-CyP9ia9L.js";import{u as n,B as c,L as m,I as o,T as d,s as p,t as g}from"./index-Bq0NAJfZ.js";import{S as x,a as _,b as h,c as u,d as j}from"./select-UEGCGcgW.js";import{t as f}from"./vendor-utils-cF2MmNet.js";const v=({onSuccess:v})=>{const{userProfile:b}=n(),[y,N]=a.useState(!1),[w,F]=a.useState(!1),[C,S]=a.useState({meal_type:"breakfast",meal_name:"",description:"",calories:"",protein_g:"",carbs_g:"",fats_g:"",date:(new Date).toISOString().split("T")[0]});return e.jsxs(s,{open:y,onOpenChange:N,children:[e.jsx(t,{asChild:!0,children:e.jsxs(c,{className:"w-full h-12 min-h-[44px] text-sm sm:text-base",children:[e.jsx(f,{className:"w-4 h-4 sm:w-5 sm:h-5 mr-2"}),e.jsx("span",{className:"truncate",children:"Log Meal"})]})}),e.jsxs(l,{className:"glass-effect custom-scrollbar sm:max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsx(r,{children:e.jsx(i,{children:"Log Your Meal"})}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),F(!0);try{const e={user_id:b.id,meal_type:C.meal_type,meal_name:C.meal_name,description:C.description,calories:C.calories?parseInt(C.calories):null,protein_g:C.protein_g?parseFloat(C.protein_g):null,carbs_g:C.carbs_g?parseFloat(C.carbs_g):null,fats_g:C.fats_g?parseFloat(C.fats_g):null,date:C.date},{error:a}=await p.from("meal_logs").insert(e);if(a)throw a;if(C.calories){const{data:e}=await p.from("daily_metrics").select("*").eq("user_id",b.id).eq("date",C.date).single(),a=(e?.calories_consumed||0)+parseInt(C.calories),s=(e?.protein_g||0)+(C.protein_g?parseFloat(C.protein_g):0),t=(e?.carbs_g||0)+(C.carbs_g?parseFloat(C.carbs_g):0),l=(e?.fats_g||0)+(C.fats_g?parseFloat(C.fats_g):0);e?await p.from("daily_metrics").update({calories_consumed:a,protein_g:s,carbs_g:t,fats_g:l}).eq("id",e.id):await p.from("daily_metrics").insert({user_id:b.id,date:C.date,calories_consumed:a,protein_g:s,carbs_g:t,fats_g:l})}await p.from("activity_feed").insert({user_id:b.id,activity_type:"logged_meal",activity_title:`Logged ${C.meal_type}`,activity_description:C.meal_name,metadata:{calories:C.calories?parseInt(C.calories):0}}),await p.rpc("update_user_streak",{p_user_id:b.id,p_streak_type:"meal_log",p_activity_date:C.date}),g({title:"Meal Logged!",description:`Successfully logged ${C.meal_name||C.meal_type}`}),S({meal_type:"breakfast",meal_name:"",description:"",calories:"",protein_g:"",carbs_g:"",fats_g:"",date:(new Date).toISOString().split("T")[0]}),N(!1),v&&v()}catch(a){console.error("Error logging meal:",a),g({title:"Error",description:"Failed to log meal. Please try again.",variant:"destructive"})}finally{F(!1)}},className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx(m,{htmlFor:"date",className:"text-sm sm:text-base",children:"Date"}),e.jsx(o,{id:"date",type:"date",value:C.date,onChange:e=>S({...C,date:e.target.value}),max:(new Date).toISOString().split("T")[0],required:!0,className:"mt-1.5 w-full min-w-0"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"meal_type",className:"text-sm sm:text-base",children:"Meal Type *"}),e.jsxs(x,{value:C.meal_type,onValueChange:e=>S({...C,meal_type:e}),children:[e.jsx(_,{className:"h-12 mt-1.5 text-base",children:e.jsx(h,{})}),e.jsxs(u,{children:[e.jsx(j,{value:"breakfast",children:"Breakfast"}),e.jsx(j,{value:"lunch",children:"Lunch"}),e.jsx(j,{value:"dinner",children:"Dinner"}),e.jsx(j,{value:"snack",children:"Snack"})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"meal_name",className:"text-sm sm:text-base",children:"Meal Name *"}),e.jsx(o,{id:"meal_name",placeholder:"e.g., Grilled Chicken Salad",value:C.meal_name,onChange:e=>S({...C,meal_name:e.target.value}),required:!0,className:"mt-1.5"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"description",className:"text-sm sm:text-base",children:"Description (optional)"}),e.jsx(d,{id:"description",placeholder:"Any additional details...",value:C.description,onChange:e=>S({...C,description:e.target.value}),rows:2,className:"mt-1.5 min-h-[44px] text-base"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"calories",className:"text-sm sm:text-base",children:"Calories"}),e.jsx(o,{id:"calories",type:"number",placeholder:"500",value:C.calories,onChange:e=>S({...C,calories:e.target.value}),className:"mt-1.5"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"protein",className:"text-sm sm:text-base",children:"Protein (g)"}),e.jsx(o,{id:"protein",type:"number",step:"0.1",placeholder:"25",value:C.protein_g,onChange:e=>S({...C,protein_g:e.target.value}),className:"mt-1.5"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"carbs",className:"text-sm sm:text-base",children:"Carbs (g)"}),e.jsx(o,{id:"carbs",type:"number",step:"0.1",placeholder:"50",value:C.carbs_g,onChange:e=>S({...C,carbs_g:e.target.value}),className:"mt-1.5"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"fats",className:"text-sm sm:text-base",children:"Fats (g)"}),e.jsx(o,{id:"fats",type:"number",step:"0.1",placeholder:"15",value:C.fats_g,onChange:e=>S({...C,fats_g:e.target.value}),className:"mt-1.5"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>N(!1),className:"flex-1 h-12 min-h-[44px] text-sm sm:text-base",children:"Cancel"}),e.jsx(c,{type:"submit",disabled:w,className:"flex-1 h-12 min-h-[44px] text-sm sm:text-base",children:w?"Logging...":"Log Meal"})]})]})]})]})};export{v as Q};
