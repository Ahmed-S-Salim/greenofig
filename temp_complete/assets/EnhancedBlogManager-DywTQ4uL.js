import{j as e}from"./vendor-ui-jbjsCjSW.js";import{R as s,u as t,a}from"./vendor-react-C4Yvcgue.js";import{B as l,s as r,t as i,e as n}from"./index-CJcmXEeE.js";import{C as c,a as o,b as d,c as m,e as h}from"./card-D1JrzjfW.js";import{J as x,ah as u,c as p,ai as g,ab as j,aj as f,ak as v,a8 as N,al as b,ag as w,o as y,G as _,g as C,j as k,z as P,p as S,ad as D,I as E,T as M,P as A}from"./vendor-utils-jh41mPu7.js";import{I as $}from"./input-Bpymy_1X.js";import{T as z,a as T,b as V,c as F}from"./tabs-DaNpauLq.js";import{C as I}from"./checkbox-ccrOBxuN.js";class R extends s.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,s){this.setState({error:e,errorInfo:s})}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(c,{className:"max-w-2xl w-full glass-effect",children:[e.jsx(o,{children:e.jsxs(d,{className:"flex items-center gap-3 text-2xl",children:[e.jsx(x,{className:"w-8 h-8 text-red-500"}),"Something Went Wrong"]})}),e.jsxs(m,{className:"space-y-4",children:[e.jsx("p",{className:"text-text-secondary",children:"We encountered an unexpected error. This has been logged and we'll look into it."}),this.state.error&&e.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-lg",children:e.jsx("p",{className:"font-mono text-sm text-red-400",children:this.state.error.toString()})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(l,{onClick:this.handleReset,className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4"}),"Try Again"]}),e.jsx(l,{variant:"outline",onClick:()=>{const e=window.location.hostname.includes("github.io")?"/greenofig":"";window.location.href=`${e}/app/admin`},children:"Go to Dashboard"})]}),!1]})]})}):this.props.children}}const L=({user:s})=>{const R=t(),[L,q]=a.useState([]),[B,W]=a.useState([]),[G,J]=a.useState([]),[O,U]=a.useState(""),[H,K]=a.useState("all"),[Q,X]=a.useState("all"),[Y,Z]=a.useState("all"),[ee,se]=a.useState(!0),[te,ae]=a.useState("posts"),[le,re]=a.useState([]),[ie,ne]=a.useState([]),[ce,oe]=a.useState([]),[de,me]=a.useState([]),[he,xe]=a.useState({totalPosts:0,publishedPosts:0,draftPosts:0,scheduledPosts:0,totalViews:0,totalComments:0,pendingComments:0,avgViewsPerPost:0});a.useEffect(()=>{ue(),pe(),ge(),je(),fe()},[]),a.useEffect(()=>{ve()},[O,H,Q,Y,L]);const ue=async()=>{se(!0);try{const{data:e,error:s}=await r.from("blog_posts").select("\n          *,\n          author:user_profiles!blog_posts_author_id_fkey(id, full_name, email)\n        ").order("created_at",{ascending:!1});if(s)throw s;q(e||[])}catch(e){i({variant:"destructive",title:"Error",description:"Failed to fetch blog posts"})}finally{se(!1)}},pe=async()=>{try{const{data:e,error:s}=await r.from("blog_categories").select("*").order("name",{ascending:!0});if(s)throw s;W(e||[])}catch(e){}},ge=async()=>{try{const{data:e,error:s}=await r.from("user_profiles").select("id, full_name, email, role").in("role",["nutritionist","admin","super_admin"]).order("full_name",{ascending:!0});if(s)throw s;ne(e||[])}catch(e){}},je=async()=>{try{const{data:e,error:s}=await r.from("blog_comments").select("\n          *,\n          blog_post:blog_posts(title, slug),\n          user:user_profiles(full_name)\n        ").order("created_at",{ascending:!1});if(s)throw s;oe(e||[]),me(e?.filter(e=>!e.is_approved)||[])}catch(e){}},fe=async()=>{try{const{data:e}=await r.from("blog_posts").select("status, view_count"),{data:s}=await r.from("blog_comments").select("is_approved");if(e){const t=e.reduce((e,s)=>e+(s.view_count||0),0),a={totalPosts:e.length,publishedPosts:e.filter(e=>"published"===e.status).length,draftPosts:e.filter(e=>"draft"===e.status).length,scheduledPosts:e.filter(e=>"scheduled"===e.status).length,totalViews:t,totalComments:s?.length||0,pendingComments:s?.filter(e=>!e.is_approved).length||0,avgViewsPerPost:e.length>0?Math.round(t/e.length):0};xe(a)}}catch(e){}},ve=()=>{let e=L;O&&(e=e.filter(e=>e.title?.toLowerCase().includes(O.toLowerCase())||e.excerpt?.toLowerCase().includes(O.toLowerCase()))),"all"!==H&&(e=e.filter(e=>e.status===H)),"all"!==Q&&(e=e.filter(e=>e.author_id===Q)),"all"!==Y&&(e=e.filter(e=>e.category===Y)),J(e)},Ne=async e=>{if(0!==le.length)try{switch(e){case"publish":await r.from("blog_posts").update({status:"published",published_at:(new Date).toISOString()}).in("id",le),i({title:`Published ${le.length} posts`});break;case"draft":await r.from("blog_posts").update({status:"draft"}).in("id",le),i({title:`Moved ${le.length} posts to draft`});break;case"archive":await r.from("blog_posts").update({status:"archived"}).in("id",le),i({title:`Archived ${le.length} posts`});break;case"delete":confirm(`Delete ${le.length} posts permanently?`)&&(await r.from("blog_posts").delete().in("id",le),i({title:`Deleted ${le.length} posts`}))}re([]),ue(),fe()}catch(s){i({variant:"destructive",title:"Error",description:"Failed to perform bulk action"})}else i({variant:"destructive",title:"No posts selected",description:"Please select posts to perform bulk actions"})},be=({icon:s,title:t,value:a,change:l,color:r})=>e.jsx(c,{children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:t}),e.jsx("h3",{className:"text-3xl font-bold text-foreground",children:a}),l&&e.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400 mt-1 flex items-center gap-1",children:[e.jsx(_,{className:"w-4 h-4"}),l]})]}),e.jsx("div",{className:`p-4 rounded-full ${r||"bg-primary/10"}`,children:e.jsx(s,{className:"w-6 h-6 text-primary"})})]})})}),we=({post:t})=>{const a=le.includes(t.id);return e.jsx(c,{className:"glass-effect hover:shadow-lg transition-all "+(a?"ring-2 ring-primary":""),children:e.jsxs(m,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx(I,{checked:a,onCheckedChange:()=>{return e=t.id,void re(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e]);var e}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:t.title}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:t.excerpt||"No excerpt"})]}),e.jsx(n,{className:{draft:"bg-gray-500",published:"bg-green-500",scheduled:"bg-blue-500",archived:"bg-red-500"}[t.status],children:t.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(E,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{children:t.author?.full_name||"Unknown"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:[t.view_count||0," views"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(C,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{children:t.published_at?P(new Date(t.published_at),"MMM d"):"Not published"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(M,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{children:t.focus_keyword||"No keyword"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{R(`/app/${"nutritionist"===s?.role?"nutritionist":"admin"}/blog/edit/${t.id}`)},className:"flex-1",children:[e.jsx(A,{className:"w-4 h-4 mr-1"}),"Edit"]}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this post?"))try{const{error:s}=await r.from("blog_posts").delete().eq("id",e);if(s)throw s;i({title:"Post deleted successfully"}),ue(),fe()}catch(s){i({variant:"destructive",title:"Error",description:"Failed to delete post"})}})(t.id),className:"text-destructive",children:e.jsx(w,{className:"w-4 h-4"})}),"published"===t.status&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{const e=window.location.hostname.includes("github.io")?"/greenofig":"";window.open(`${e}/blog/${t.slug}`,"_blank")},children:e.jsx(y,{className:"w-4 h-4"})})]})]})})};return ee?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(p,{className:"w-12 h-12 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(g,{className:"w-8 h-8 text-primary"}),"Blog Management"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage all blog posts, categories, and comments"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:"outline",onClick:ue,children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"Refresh"]}),e.jsxs(l,{onClick:()=>{R(`/app/${"nutritionist"===s?.role?"nutritionist":"admin"}/blog/new`)},children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Create Post"]})]})]}),e.jsxs(z,{value:te,onValueChange:ae,children:[e.jsxs(T,{className:"grid w-full grid-cols-4",children:[e.jsxs(V,{value:"posts",children:["Posts (",he.totalPosts,")"]}),e.jsxs(V,{value:"analytics",children:[e.jsx(f,{className:"w-4 h-4 mr-1"}),"Analytics"]}),e.jsxs(V,{value:"categories",children:["Categories (",B.length,")"]}),e.jsxs(V,{value:"comments",children:["Comments (",he.pendingComments," pending)"]})]}),e.jsxs(F,{value:"posts",className:"space-y-4",children:[e.jsx(c,{className:"glass-effect",children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(v,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx($,{placeholder:"Search posts...",value:O,onChange:e=>U(e.target.value),className:"pl-10"})]}),e.jsxs("select",{value:H,onChange:e=>K(e.target.value),className:"px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"published",children:"Published"}),e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"scheduled",children:"Scheduled"}),e.jsx("option",{value:"archived",children:"Archived"})]}),e.jsxs("select",{value:Q,onChange:e=>X(e.target.value),className:"px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"all",children:"All Authors"}),ie.map(s=>e.jsx("option",{value:s.id,children:s.full_name},s.id))]}),e.jsxs("select",{value:Y,onChange:e=>Z(e.target.value),className:"px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"all",children:"All Categories"}),B.map(s=>e.jsx("option",{value:s.slug,children:s.name},s.id))]})]}),le.length>0&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-primary/10 rounded-lg",children:[e.jsxs("span",{className:"text-sm font-medium",children:[le.length," posts selected"]}),e.jsxs("div",{className:"flex gap-2 ml-auto",children:[e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>Ne("publish"),children:[e.jsx(N,{className:"w-4 h-4 mr-1"}),"Publish"]}),e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>Ne("draft"),children:[e.jsx(g,{className:"w-4 h-4 mr-1"}),"Draft"]}),e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>Ne("archive"),children:[e.jsx(b,{className:"w-4 h-4 mr-1"}),"Archive"]}),e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>Ne("delete"),className:"text-destructive",children:[e.jsx(w,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{checked:le.length===G.length&&G.length>0,onCheckedChange:()=>{le.length===G.length?re([]):re(G.map(e=>e.id))}}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Select All (",G.length," posts)"]})]})]})})}),G.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:G.map(s=>e.jsx(we,{post:s},s.id))}):e.jsx(c,{className:"glass-effect",children:e.jsxs(m,{className:"p-12 text-center",children:[e.jsx(g,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No posts found"}),e.jsx("p",{className:"text-muted-foreground",children:O||"all"!==H?"Try adjusting your filters":"No blog posts yet"})]})})]}),e.jsxs(F,{value:"analytics",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(be,{icon:g,title:"Total Posts",value:he.totalPosts}),e.jsx(be,{icon:N,title:"Published",value:he.publishedPosts}),e.jsx(be,{icon:y,title:"Total Views",value:he.totalViews.toLocaleString()}),e.jsx(be,{icon:_,title:"Avg Views/Post",value:he.avgViewsPerPost})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(be,{icon:g,title:"Drafts",value:he.draftPosts}),e.jsx(be,{icon:C,title:"Scheduled",value:he.scheduledPosts}),e.jsx(be,{icon:k,title:"Total Comments",value:he.totalComments}),e.jsx(be,{icon:x,title:"Pending Comments",value:he.pendingComments})]}),e.jsxs(c,{children:[e.jsx(o,{children:e.jsx(d,{children:"Top Performing Posts"})}),e.jsx(m,{children:e.jsx("div",{className:"space-y-3",children:L.filter(e=>"published"===e.status).sort((e,s)=>(s.view_count||0)-(e.view_count||0)).slice(0,10).map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 text-primary font-bold",children:t+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.author?.full_name})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold",children:s.view_count||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"views"})]})]},s.id))})})]})]}),e.jsx(F,{value:"categories",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(o,{children:[e.jsx(d,{children:"Blog Categories"}),e.jsx(h,{children:"Manage content categories"})]}),e.jsx(m,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:B.map(s=>e.jsxs("div",{className:"p-4 bg-card border border-border rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.description||"No description"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[L.filter(e=>e.category===s.slug).length," posts"]}),e.jsx(n,{variant:"outline",children:s.slug})]})]},s.id))})})]})}),e.jsxs(F,{value:"comments",className:"space-y-4",children:[e.jsxs(c,{children:[e.jsxs(o,{children:[e.jsxs(d,{children:["Pending Comments (",de.length,")"]}),e.jsx(h,{children:"Review and moderate comments"})]}),e.jsx(m,{children:de.length>0?e.jsx("div",{className:"space-y-3",children:de.map(s=>e.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.author_name||s.user?.full_name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:['on "',s.blog_post?.title,'"']})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:P(new Date(s.created_at),"MMM d, yyyy")})]}),e.jsx("p",{className:"text-sm mb-3",children:s.content}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{size:"sm",onClick:()=>(async e=>{try{const{error:s}=await r.from("blog_comments").update({is_approved:!0}).eq("id",e);if(s)throw s;i({title:"Comment approved"}),je(),fe()}catch(s){i({variant:"destructive",title:"Error",description:"Failed to approve comment"})}})(s.id),children:[e.jsx(S,{className:"w-4 h-4 mr-1"}),"Approve"]}),e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(confirm("Delete this comment?"))try{const{error:s}=await r.from("blog_comments").delete().eq("id",e);if(s)throw s;i({title:"Comment deleted"}),je(),fe()}catch(s){i({variant:"destructive",title:"Error",description:"Failed to delete comment"})}})(s.id),children:[e.jsx(D,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]},s.id))}):e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No pending comments"})})]}),e.jsxs(c,{children:[e.jsx(o,{children:e.jsx(d,{children:"Recent Comments"})}),e.jsx(m,{children:e.jsx("div",{className:"space-y-3",children:ce.filter(e=>e.is_approved).slice(0,10).map(s=>e.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsx("p",{className:"font-medium text-sm",children:s.author_name||s.user?.full_name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:P(new Date(s.created_at),"MMM d")})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-1",children:['on "',s.blog_post?.title,'"']}),e.jsx("p",{className:"text-sm",children:s.content})]},s.id))})})]})]})]})]})};export{R as E,L as a};
