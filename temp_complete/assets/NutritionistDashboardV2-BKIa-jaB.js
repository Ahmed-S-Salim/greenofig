import{j as e}from"./vendor-ui-jbjsCjSW.js";import{a as s,L as t,h as a}from"./vendor-react-C4Yvcgue.js";import{u as l,s as r,B as i,T as n,t as c,e as d,d as o,H as m}from"./index-CJcmXEeE.js";import{E as x,a as u}from"./EnhancedBlogManager-DywTQ4uL.js";import{C as h,a as p,b as g,c as j,e as f}from"./card-D1JrzjfW.js";import{I as v,aO as b,g as N,G as y,a5 as _,a as w,z as k,aP as C,J as S,a8 as M,U as A,R as F,aQ as D,N as E,X as R,Y as I,O as P,aR as z,ab as q,ai as T,l as L,ak as O,aI as W,aJ as $,ad as U,P as B,ag as K,aM as V,T as G,aS as H,aT as Y,c as J,aU as Z,aV as Q,aW as X,aX as ee,y as se,aY as te,aZ as ae,a_ as le,a$ as re,j as ie,f as ne,b0 as ce,h as de,ac as oe,p as me,b1 as xe,m as ue,ah as he,F as pe,aj as ge,K as je,Q as fe,s as ve,b2 as be,b3 as Ne,b4 as ye,b5 as _e,V as we,W as ke,_ as Ce,aa as Se,w as Me,b6 as Ae,b7 as Fe,am as De,o as Ee,b8 as Re,b9 as Ie,ba as Pe,bb as ze,bc as qe,bd as Te}from"./vendor-utils-jh41mPu7.js";import{I as Le}from"./input-Bpymy_1X.js";import{T as Oe,a as We,b as $e,c as Ue}from"./tabs-DaNpauLq.js";import{D as Be,b as Ke,c as Ve,d as Ge,f as He}from"./dialog-DQGKHfp4.js";import{S as Ye}from"./switch-4Gm03jRy.js";import"./checkbox-ccrOBxuN.js";import"./vendor-editor-D6Zd0gNL.js";const Je=()=>{const{user:a}=l(),[n,c]=s.useState({totalClients:0,activeClients:0,activeMealPlans:0,upcomingAppointments:0}),[d,o]=s.useState([]),[m,x]=s.useState([]),[u,f]=s.useState([]),[A,F]=s.useState(!0);s.useEffect(()=>{a&&D()},[a]);const D=async()=>{F(!0);try{const{data:e,error:s}=await r.from("user_profiles").select("id, full_name, email, created_at").eq("role","user");if(s)throw s;const{data:t,error:l}=await r.from("meal_plans_v2").select("id, name, status").eq("nutritionist_id",a.id).eq("status","active"),i=new Date;i.setHours(0,0,0,0);const n=new Date(i);n.setDate(n.getDate()+1);const{data:d,error:m}=await r.from("appointments").select("*, user_profiles!appointments_client_id_fkey(full_name)").eq("nutritionist_id",a.id).gte("appointment_date",i.toISOString()).order("appointment_date",{ascending:!0}).limit(10),u=d?.filter(e=>{const s=new Date(e.appointment_date);return s>=i&&s<n})||[];c({totalClients:e?.length||0,activeClients:e?.length||0,activeMealPlans:t?.length||0,upcomingAppointments:d?.length||0}),o(u),x([{id:1,type:"client_joined",message:"New client registered",time:"2 hours ago"},{id:2,type:"meal_plan",message:"Meal plan created for Sarah Johnson",time:"5 hours ago"},{id:3,type:"appointment",message:"Consultation completed with Mike Chen",time:"1 day ago"}]),f([{id:1,message:"3 clients need follow-up this week",priority:"high"},{id:2,message:"2 meal plans pending review",priority:"medium"}])}catch(e){}finally{F(!1)}},E=({icon:s,label:t,value:a,change:l,color:r})=>e.jsx(h,{className:"bg-card border-border",children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:t}),e.jsx("h3",{className:"text-3xl font-bold text-foreground",children:a}),l&&e.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400 mt-1 flex items-center gap-1",children:[e.jsx(y,{className:"w-4 h-4"}),l]})]}),e.jsx("div",{className:`p-4 rounded-full ${r||"bg-primary/10"}`,children:e.jsx(s,{className:"w-6 h-6 "+(r?"text-primary-foreground":"text-primary")})})]})})});return A?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(E,{icon:v,label:"Total Clients",value:n.totalClients,change:"+12% this month"}),e.jsx(E,{icon:b,label:"Active Meal Plans",value:n.activeMealPlans,color:"bg-green-600 dark:bg-green-700"}),e.jsx(E,{icon:N,label:"Upcoming Appointments",value:n.upcomingAppointments,color:"bg-blue-600 dark:bg-blue-700"}),e.jsx(E,{icon:y,label:"Client Success Rate",value:"87%",change:"+5% this month",color:"bg-purple-600 dark:bg-purple-700"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(h,{className:"lg:col-span-2 bg-card border-border",children:[e.jsx(p,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(g,{className:"flex items-center gap-2 text-foreground",children:[e.jsx(_,{className:"w-5 h-5"}),"Today's Schedule"]}),e.jsx(i,{variant:"ghost",size:"sm",asChild:!0,children:e.jsxs(t,{to:"/app/nutritionist?tab=schedule",children:["View All ",e.jsx(w,{className:"w-4 h-4 ml-1"})]})})]})}),e.jsx(j,{children:d.length>0?e.jsx("div",{className:"space-y-3",children:d.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg hover:bg-muted transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-600 dark:bg-green-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground",children:s.user_profiles?.full_name||"Client"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.consultation_type||"Consultation"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:k(new Date(s.appointment_date),"h:mm a")}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.duration_minutes," min"]})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(N,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No appointments scheduled for today"})]})})]}),e.jsxs(h,{className:"bg-card border-border",children:[e.jsx(p,{children:e.jsxs(g,{className:"flex items-center gap-2 text-foreground",children:[e.jsx(C,{className:"w-5 h-5"}),"Action Items"]})}),e.jsx(j,{children:e.jsx("div",{className:"space-y-3",children:u.map(s=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg border "+("high"===s.priority?"bg-red-50/50 dark:bg-red-950/20 border-red-200 dark:border-red-900":"bg-yellow-50/50 dark:bg-yellow-950/20 border-yellow-200 dark:border-yellow-900"),children:[e.jsx(S,{className:"w-5 h-5 flex-shrink-0 "+("high"===s.priority?"text-red-600 dark:text-red-400":"text-yellow-600 dark:text-yellow-400")}),e.jsx("p",{className:"text-sm text-foreground",children:s.message})]},s.id))})})]})]}),e.jsxs(h,{className:"bg-card border-border",children:[e.jsx(p,{children:e.jsx(g,{className:"text-foreground",children:"Recent Activity"})}),e.jsx(j,{children:e.jsx("div",{className:"space-y-4",children:m.map(s=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-foreground",children:s.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.time})]}),e.jsx(M,{className:"w-4 h-4 text-green-600 dark:text-green-400"})]},s.id))})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(i,{asChild:!0,className:"h-20 text-lg",variant:"outline",children:e.jsxs(t,{to:"/app/nutritionist?tab=clients",children:[e.jsx(v,{className:"w-5 h-5 mr-2"}),"Manage Clients"]})}),e.jsx(i,{asChild:!0,className:"h-20 text-lg",variant:"outline",children:e.jsxs(t,{to:"/app/nutritionist?tab=meals",children:[e.jsx(b,{className:"w-5 h-5 mr-2"}),"Create Meal Plan"]})}),e.jsx(i,{asChild:!0,className:"h-20 text-lg",variant:"outline",children:e.jsxs(t,{to:"/app/nutritionist?tab=schedule",children:[e.jsx(N,{className:"w-5 h-5 mr-2"}),"Schedule Appointment"]})})]})]})},Ze=({client:t,open:a,onOpenChange:d,onUpdate:o})=>{const{user:m}=l(),[x,u]=s.useState("overview"),[f,v]=s.useState([]),[b,N]=s.useState(null),[y,_]=s.useState(""),[w,C]=s.useState({weight_kg:"",body_fat_percentage:"",waist_cm:"",hips_cm:""}),[S,M]=s.useState(!1);s.useEffect(()=>{a&&t&&O()},[a,t]);const O=async()=>{try{const{data:e}=await r.from("client_progress").select("*").eq("client_id",t.id).order("date",{ascending:!0});v(e||[]);const{data:s}=await r.from("client_health_data").select("*").eq("client_id",t.id).single();N(s),_(t.nutritionist_notes||"")}catch(e){}};return e.jsx(Be,{open:a,onOpenChange:d,children:e.jsxs(Ke,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ve,{children:e.jsxs(Ge,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5"}),t?.full_name]})}),e.jsxs(Oe,{value:x,onValueChange:u,children:[e.jsxs(We,{className:"grid w-full grid-cols-3",children:[e.jsx($e,{value:"overview",children:"Overview"}),e.jsx($e,{value:"progress",children:"Progress Tracking"}),e.jsx($e,{value:"notes",children:"Notes"})]}),e.jsxs(Ue,{value:"overview",className:"space-y-4",children:[e.jsxs(h,{children:[e.jsx(p,{children:e.jsx(g,{children:"Basic Information"})}),e.jsxs(j,{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Email"}),e.jsx("p",{className:"font-medium",children:t?.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Age"}),e.jsx("p",{className:"font-medium",children:t?.age||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Height"}),e.jsx("p",{className:"font-medium",children:t?.height_cm?`${t.height_cm} cm`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Current Weight"}),e.jsx("p",{className:"font-medium",children:t?.latestWeight?`${t.latestWeight} kg`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"BMI"}),e.jsx("p",{className:"font-medium",children:((e,s)=>{if(!e||!s)return"N/A";const t=s/100;return(e/(t*t)).toFixed(1)})(t?.latestWeight,t?.height_cm)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Activity Level"}),e.jsx("p",{className:"font-medium capitalize",children:t?.activity_level?.replace("_"," ")||"N/A"})]})]})]}),b&&e.jsxs(h,{children:[e.jsx(p,{children:e.jsx(g,{children:"Health Information"})}),e.jsxs(j,{className:"space-y-3",children:[b.allergies&&b.allergies.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Allergies"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:b.allergies.map((s,t)=>e.jsx("span",{className:"px-2 py-1 bg-destructive/10 text-destructive rounded text-sm",children:s},t))})]}),b.dietary_restrictions&&b.dietary_restrictions.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Dietary Restrictions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:b.dietary_restrictions.map((s,t)=>e.jsx("span",{className:"px-2 py-1 bg-amber-500/10 text-amber-600 rounded text-sm",children:s},t))})]})]})]})]}),e.jsxs(Ue,{value:"progress",className:"space-y-4",children:[f.length>0&&e.jsxs(h,{children:[e.jsx(p,{children:e.jsx(g,{children:"Weight Trend"})}),e.jsx(j,{children:e.jsx(F,{width:"100%",height:300,children:e.jsxs(D,{data:f,children:[e.jsx(E,{strokeDasharray:"3 3"}),e.jsx(R,{dataKey:"date",tickFormatter:e=>k(new Date(e),"MMM d")}),e.jsx(I,{}),e.jsx(P,{labelFormatter:e=>k(new Date(e),"MMM d, yyyy")}),e.jsx(z,{type:"monotone",dataKey:"weight_kg",stroke:"hsl(var(--primary))",strokeWidth:2,dot:{fill:"hsl(var(--primary))"}})]})})})]}),e.jsxs(h,{children:[e.jsx(p,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5"}),"Add Progress Entry"]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Weight (kg) *"}),e.jsx(Le,{type:"number",step:"0.1",value:w.weight_kg,onChange:e=>C({...w,weight_kg:e.target.value}),placeholder:"70.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Body Fat %"}),e.jsx(Le,{type:"number",step:"0.1",value:w.body_fat_percentage,onChange:e=>C({...w,body_fat_percentage:e.target.value}),placeholder:"20.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Waist (cm)"}),e.jsx(Le,{type:"number",step:"0.1",value:w.waist_cm,onChange:e=>C({...w,waist_cm:e.target.value}),placeholder:"80"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Hips (cm)"}),e.jsx(Le,{type:"number",step:"0.1",value:w.hips_cm,onChange:e=>C({...w,hips_cm:e.target.value}),placeholder:"95"})]})]}),e.jsx(i,{onClick:async()=>{if(w.weight_kg){M(!0);try{const{error:e}=await r.from("client_progress").insert({client_id:t.id,nutritionist_id:m.id,...w});if(e)throw e;c({title:"Progress added",description:"Client progress has been recorded"}),C({weight_kg:"",body_fat_percentage:"",waist_cm:"",hips_cm:""}),O(),o&&o()}catch(e){c({variant:"destructive",title:"Error",description:"Failed to add progress"})}finally{M(!1)}}else c({variant:"destructive",title:"Error",description:"Weight is required"})},disabled:S,className:"w-full",children:S?"Saving...":"Add Progress"})]})]}),f.length>0&&e.jsxs(h,{children:[e.jsx(p,{children:e.jsx(g,{children:"Progress History"})}),e.jsx(j,{children:e.jsx("div",{className:"space-y-2",children:f.slice().reverse().map(s=>e.jsx("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:k(new Date(s.date),"MMMM d, yyyy")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Weight: ",s.weight_kg," kg",s.body_fat_percentage&&` • Body Fat: ${s.body_fat_percentage}%`]})]})},s.id))})})]})]}),e.jsx(Ue,{value:"notes",className:"space-y-4",children:e.jsxs(h,{children:[e.jsx(p,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),"Private Notes"]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsx(n,{value:y,onChange:e=>_(e.target.value),placeholder:"Add private notes about this client...",rows:10}),e.jsxs(i,{onClick:async()=>{M(!0);try{const{error:e}=await r.from("user_profiles").update({nutritionist_notes:y}).eq("id",t.id);if(e)throw e;c({title:"Notes saved",description:"Your notes have been saved successfully"}),o&&o()}catch(e){c({variant:"destructive",title:"Error",description:"Failed to save notes"})}finally{M(!1)}},disabled:S,children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),S?"Saving...":"Save Notes"]})]})]})})]})]})})},Qe=()=>{const{user:t}=l(),[a,n]=s.useState([]),[c,d]=s.useState([]),[o,m]=s.useState(""),[x,u]=s.useState("all"),[p,g]=s.useState(null),[f,b]=s.useState(!1),[_,w]=s.useState(!0);s.useEffect(()=>{C()},[t]),s.useEffect(()=>{S()},[o,x,a]);const C=async()=>{w(!0);try{const{data:e,error:s}=await r.from("user_profiles").select("*").eq("role","user").order("created_at",{ascending:!1});if(s)throw s;const t=await Promise.all((e||[]).map(async e=>{const{data:s}=await r.from("client_progress").select("*").eq("client_id",e.id).order("date",{ascending:!1}).limit(2),t=s?.[0],a=s?.[1];return{...e,latestWeight:t?.weight_kg,weightChange:t&&a?(t.weight_kg-a.weight_kg).toFixed(1):null,lastUpdate:t?.date}}));n(t)}catch(e){}finally{w(!1)}},S=()=>{let e=a;o&&(e=e.filter(e=>e.full_name?.toLowerCase().includes(o.toLowerCase())||e.email?.toLowerCase().includes(o.toLowerCase()))),"active"===x?e=e.filter(e=>e.lastUpdate):"inactive"===x&&(e=e.filter(e=>!e.lastUpdate)),d(e)},M=e=>{g(e),b(!0)},A=({client:s})=>{const t=((e,s)=>{if(!e||!s)return"N/A";const t=s/100;return(e/(t*t)).toFixed(1)})(s.latestWeight,s.height_cm),a=s.weightChange&&parseFloat(s.weightChange)<0;return e.jsx(h,{className:"glass-effect hover:shadow-lg transition-all cursor-pointer h-full flex flex-col",onClick:()=>M(s),children:e.jsxs(j,{className:"p-6 flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-lg font-bold text-primary",children:s.full_name?.split(" ").map(e=>e[0]).join("")||"?"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg truncate",children:s.full_name||"Unknown"}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.email})]})]}),e.jsx("div",{className:"px-2 py-1 rounded-full text-xs font-medium whitespace-nowrap flex-shrink-0 ml-2 "+(s.lastUpdate?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"),children:s.lastUpdate?"Active":"Inactive"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Current Weight"}),e.jsx("p",{className:"text-lg font-bold",children:s.latestWeight?`${s.latestWeight} kg`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"BMI"}),e.jsx("p",{className:"text-lg font-bold",children:t})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Progress"}),s.weightChange?e.jsxs("p",{className:"text-lg font-bold flex items-center gap-1 "+(a?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[a?e.jsx(W,{className:"w-4 h-4"}):e.jsx(y,{className:"w-4 h-4"}),Math.abs(s.weightChange)," kg"]}):e.jsx("p",{className:"text-lg font-bold text-muted-foreground",children:"-"})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("span",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(N,{className:"w-4 h-4"}),s.lastUpdate?k(new Date(s.lastUpdate),"MMM d, yyyy"):"No updates"]})}),e.jsx(i,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),M(s)},children:"View Profile"})]})]})})};return _?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(v,{className:"w-8 h-8 text-primary"}),"Client Management"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage and track your clients' progress"})]})}),e.jsx(h,{className:"glass-effect",children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(O,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(Le,{placeholder:"Search clients by name or email...",value:o,onChange:e=>m(e.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{variant:"all"===x?"default":"outline",onClick:()=>u("all"),children:["All (",a.length,")"]}),e.jsx(i,{variant:"active"===x?"default":"outline",onClick:()=>u("active"),children:"Active"}),e.jsx(i,{variant:"inactive"===x?"default":"outline",onClick:()=>u("inactive"),children:"Inactive"})]})]})})}),c.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 md:gap-6",children:c.map(s=>e.jsx(A,{client:s},s.id))}):e.jsx(h,{className:"glass-effect",children:e.jsxs(j,{className:"p-12 text-center",children:[e.jsx(v,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No clients found"}),e.jsx("p",{className:"text-muted-foreground",children:o?"Try adjusting your search":"Your clients will appear here"})]})}),p&&e.jsx(Ze,{client:p,open:f,onOpenChange:b,onUpdate:C})]})},Xe=({onSelectRecipe:t})=>{const{user:a}=l(),[o,m]=s.useState([]),[x,u]=s.useState([]),[p,g]=s.useState(""),[f,b]=s.useState("all"),[N,y]=s.useState(!1),[w,k]=s.useState(null),[C,S]=s.useState(!0),[M,A]=s.useState(!1),[F,D]=s.useState({name:"",description:"",category:"breakfast",servings:1,prep_time_minutes:0,cook_time_minutes:0,ingredients:[{name:"",amount:"",unit:""}],instructions:[""],calories_per_serving:0,protein_g:0,carbs_g:0,fat_g:0,fiber_g:0,tags:[],is_public:!1}),E=["breakfast","lunch","dinner","snack","dessert"];s.useEffect(()=>{R()},[a]),s.useEffect(()=>{I()},[p,f,o]);const R=async()=>{S(!0);try{const{data:e,error:s}=await r.from("recipes").select("*").or(`nutritionist_id.eq.${a.id},is_public.eq.true`).order("created_at",{ascending:!1});if(s)throw s;m(e||[])}catch(e){c({variant:"destructive",title:"Error",description:"Failed to fetch recipes"})}finally{S(!1)}},I=()=>{let e=o;p&&(e=e.filter(e=>e.name?.toLowerCase().includes(p.toLowerCase())||e.description?.toLowerCase().includes(p.toLowerCase()))),"all"!==f&&(e=e.filter(e=>e.category===f)),u(e)},P=(e=null)=>{e?(k(e),D({...e,ingredients:e.ingredients||[{name:"",amount:"",unit:""}],instructions:e.instructions||[""],tags:e.tags||[]})):(k(null),D({name:"",description:"",category:"breakfast",servings:1,prep_time_minutes:0,cook_time_minutes:0,ingredients:[{name:"",amount:"",unit:""}],instructions:[""],calories_per_serving:0,protein_g:0,carbs_g:0,fat_g:0,fiber_g:0,tags:[],is_public:!1})),y(!0)},z=(e,s,t)=>{const a=[...F.ingredients];a[e][s]=t,D({...F,ingredients:a})},T=({recipe:s})=>e.jsx(h,{className:"glass-effect hover:shadow-lg transition-all cursor-pointer group",children:e.jsxs(j,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",onClick:()=>t&&t(s),children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.description})]}),e.jsxs("div",{className:"flex gap-1 ml-2",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),P(s)},children:e.jsx(B,{className:"w-4 h-4"})}),s.nutritionist_id===a.id&&e.jsx(i,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),(async e=>{if(confirm("Are you sure you want to delete this recipe?"))try{const{error:s}=await r.from("recipes").delete().eq("id",e);if(s)throw s;c({title:"Recipe deleted successfully"}),R()}catch(s){c({variant:"destructive",title:"Error",description:"Failed to delete recipe"})}})(s.id)},className:"text-destructive hover:text-destructive",children:e.jsx(K,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx(d,{variant:"outline",className:"capitalize",children:s.category}),s.tags?.slice(0,2).map(s=>e.jsx(d,{variant:"secondary",children:s},s))]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:[(s.prep_time_minutes||0)+(s.cook_time_minutes||0)," min"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(v,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:[s.servings," servings"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:[s.calories_per_serving||0," cal"]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[s.protein_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Protein"})]}),e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[s.carbs_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Carbs"})]}),e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[s.fat_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Fat"})]}),e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[s.fiber_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Fiber"})]})]})]})});return C?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx($,{className:"w-8 h-8 text-primary"}),"Recipe Database"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Create and manage your recipe library"})]}),e.jsxs(i,{onClick:()=>P(),children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"New Recipe"]})]}),e.jsx(h,{className:"glass-effect",children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(O,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(Le,{placeholder:"Search recipes...",value:p,onChange:e=>g(e.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(i,{variant:"all"===f?"default":"outline",onClick:()=>b("all"),size:"sm",children:"All"}),E.map(s=>e.jsx(i,{variant:f===s?"default":"outline",onClick:()=>b(s),size:"sm",className:"capitalize",children:s},s))]})]})})}),x.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:x.map(s=>e.jsx(T,{recipe:s},s.id))}):e.jsx(h,{className:"glass-effect",children:e.jsxs(j,{className:"p-12 text-center",children:[e.jsx($,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No recipes found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:p||"all"!==f?"Try adjusting your filters":"Create your first recipe to get started"}),e.jsxs(i,{onClick:()=>P(),children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Create Recipe"]})]})}),e.jsx(Be,{open:N,onOpenChange:y,children:e.jsxs(Ke,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ve,{children:e.jsx(Ge,{children:w?"Edit Recipe":"Create New Recipe"})}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Recipe Name *"}),e.jsx(Le,{value:F.name,onChange:e=>D({...F,name:e.target.value}),placeholder:"e.g., Grilled Chicken Salad"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Description"}),e.jsx(n,{value:F.description,onChange:e=>D({...F,description:e.target.value}),placeholder:"Brief description of the recipe",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Category"}),e.jsx("select",{value:F.category,onChange:e=>D({...F,category:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:E.map(s=>e.jsx("option",{value:s,className:"capitalize",children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Servings"}),e.jsx(Le,{type:"number",min:"1",value:F.servings,onChange:e=>D({...F,servings:parseInt(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Prep Time (min)"}),e.jsx(Le,{type:"number",min:"0",value:F.prep_time_minutes,onChange:e=>D({...F,prep_time_minutes:parseInt(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Cook Time (min)"}),e.jsx(Le,{type:"number",min:"0",value:F.cook_time_minutes,onChange:e=>D({...F,cook_time_minutes:parseInt(e.target.value)})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Nutrition (per serving)"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Calories"}),e.jsx(Le,{type:"number",step:"0.1",value:F.calories_per_serving,onChange:e=>D({...F,calories_per_serving:parseFloat(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Protein (g)"}),e.jsx(Le,{type:"number",step:"0.1",value:F.protein_g,onChange:e=>D({...F,protein_g:parseFloat(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Carbs (g)"}),e.jsx(Le,{type:"number",step:"0.1",value:F.carbs_g,onChange:e=>D({...F,carbs_g:parseFloat(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Fat (g)"}),e.jsx(Le,{type:"number",step:"0.1",value:F.fat_g,onChange:e=>D({...F,fat_g:parseFloat(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Fiber (g)"}),e.jsx(Le,{type:"number",step:"0.1",value:F.fiber_g,onChange:e=>D({...F,fiber_g:parseFloat(e.target.value)})})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold",children:"Ingredients"}),e.jsxs(i,{onClick:()=>{D({...F,ingredients:[...F.ingredients,{name:"",amount:"",unit:""}]})},size:"sm",variant:"outline",children:[e.jsx(q,{className:"w-4 h-4 mr-1"}),"Add"]})]}),e.jsx("div",{className:"space-y-2",children:F.ingredients.map((s,t)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Le,{placeholder:"Ingredient name",value:s.name,onChange:e=>z(t,"name",e.target.value),className:"flex-1"}),e.jsx(Le,{placeholder:"Amount",value:s.amount,onChange:e=>z(t,"amount",e.target.value),className:"w-24"}),e.jsx(Le,{placeholder:"Unit",value:s.unit,onChange:e=>z(t,"unit",e.target.value),className:"w-24"}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>(e=>{D({...F,ingredients:F.ingredients.filter((s,t)=>t!==e)})})(t),disabled:1===F.ingredients.length,children:e.jsx(U,{className:"w-4 h-4"})})]},t))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold",children:"Instructions"}),e.jsxs(i,{onClick:()=>{D({...F,instructions:[...F.instructions,""]})},size:"sm",variant:"outline",children:[e.jsx(q,{className:"w-4 h-4 mr-1"}),"Add Step"]})]}),e.jsx("div",{className:"space-y-2",children:F.instructions.map((s,t)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-sm font-medium text-muted-foreground pt-2",children:[t+1,"."]}),e.jsx(n,{placeholder:"Instruction step",value:s,onChange:e=>((e,s)=>{const t=[...F.instructions];t[e]=s,D({...F,instructions:t})})(t,e.target.value),rows:2,className:"flex-1"}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>(e=>{D({...F,instructions:F.instructions.filter((s,t)=>t!==e)})})(t),disabled:1===F.instructions.length,children:e.jsx(U,{className:"w-4 h-4"})})]},t))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["vegetarian","vegan","gluten-free","dairy-free","high-protein","low-carb","keto","paleo"].map(s=>e.jsx(d,{variant:F.tags.includes(s)?"default":"outline",className:"cursor-pointer",onClick:()=>(e=>{const s=F.tags.includes(e)?F.tags.filter(s=>s!==e):[...F.tags,e];D({...F,tags:s})})(s),children:s},s))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"is_public",checked:F.is_public,onChange:e=>D({...F,is_public:e.target.checked}),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"is_public",className:"text-sm font-medium",children:"Make this recipe public (visible to other nutritionists)"})]})]}),e.jsxs(He,{children:[e.jsx(i,{variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsxs(i,{onClick:async()=>{if(F.name){A(!0);try{const e={...F,nutritionist_id:a.id,ingredients:F.ingredients.filter(e=>e.name),instructions:F.instructions.filter(e=>e.trim())};if(w){const{error:s}=await r.from("recipes").update(e).eq("id",w.id);if(s)throw s;c({title:"Recipe updated successfully"})}else{const{error:s}=await r.from("recipes").insert(e);if(s)throw s;c({title:"Recipe created successfully"})}y(!1),R()}catch(e){c({variant:"destructive",title:"Error",description:"Failed to save recipe"})}finally{A(!1)}}else c({variant:"destructive",title:"Error",description:"Recipe name is required"})},disabled:M,children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),M?"Saving...":"Save Recipe"]})]})]})})]})},es=()=>{const{user:t}=l(),[a,o]=s.useState([]),[m,x]=s.useState([]),[u,p]=s.useState([]),[g,f]=s.useState(""),[y,_]=s.useState("all"),[w,k]=s.useState(!1),[C,S]=s.useState(null),[M,A]=s.useState(!0),[F,D]=s.useState(!1),[E,R]=s.useState(!1),[I,P]=s.useState(null),[z,T]=s.useState(null),[W,$]=s.useState({client_id:"",name:"",description:"",start_date:"",end_date:"",target_calories:2e3,target_protein_g:150,target_carbs_g:200,target_fat_g:60,meal_schedule:{},notes:"",status:"active"}),U=["breakfast","lunch","dinner","snack"];s.useEffect(()=>{V(),H()},[t]),s.useEffect(()=>{Y()},[g,y,a]);const V=async()=>{A(!0);try{const{data:e,error:s}=await r.from("meal_plans_v2").select("\n          *,\n          client:user_profiles!meal_plans_v2_client_id_fkey(id, full_name, email)\n        ").eq("nutritionist_id",t.id).order("created_at",{ascending:!1});if(s)throw s;o(e||[])}catch(e){c({variant:"destructive",title:"Error",description:"Failed to fetch meal plans"})}finally{A(!1)}},H=async()=>{try{const{data:e,error:s}=await r.from("user_profiles").select("id, full_name, email").eq("role","user").order("full_name",{ascending:!0});if(s)throw s;x(e||[])}catch(e){}},Y=()=>{let e=a;g&&(e=e.filter(e=>e.name?.toLowerCase().includes(g.toLowerCase())||e.client?.full_name?.toLowerCase().includes(g.toLowerCase()))),"all"!==y&&(e=e.filter(e=>e.status===y)),p(e)},J=(e=null)=>{if(e)S(e),$({client_id:e.client_id,name:e.name,description:e.description||"",start_date:e.start_date,end_date:e.end_date,target_calories:e.target_calories||2e3,target_protein_g:e.target_protein_g||150,target_carbs_g:e.target_carbs_g||200,target_fat_g:e.target_fat_g||60,meal_schedule:e.meal_schedule||{},notes:e.notes||"",status:e.status});else{S(null);const e=(new Date).toISOString().split("T")[0],s=new Date(Date.now()+6048e5).toISOString().split("T")[0];$({client_id:"",name:"",description:"",start_date:e,end_date:s,target_calories:2e3,target_protein_g:150,target_carbs_g:200,target_fat_g:60,meal_schedule:{},notes:"",status:"active"})}k(!0)},Z=({plan:s})=>{const t=s.client,a=Math.ceil((new Date(s.end_date)-new Date(s.start_date))/864e5);return e.jsx(h,{className:"glass-effect hover:shadow-lg transition-all",children:e.jsxs(j,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(v,{className:"w-3 h-3"}),t?.full_name||"Unknown Client"]})]}),e.jsx(d,{variant:"active"===s.status?"default":"secondary",children:s.status})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(N,{className:"w-4 h-4"}),"Duration:"]}),e.jsxs("span",{className:"font-medium",children:[a," days"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(G,{className:"w-4 h-4"}),"Daily Calories:"]}),e.jsxs("span",{className:"font-medium",children:[s.target_calories||0," kcal"]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4 text-xs",children:[e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[s.target_protein_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Protein"})]}),e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[s.target_carbs_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Carbs"})]}),e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsxs("p",{className:"font-semibold",children:[s.target_fat_g||0,"g"]}),e.jsx("p",{className:"text-muted-foreground",children:"Fat"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>J(s),className:"flex-1",children:[e.jsx(B,{className:"w-4 h-4 mr-1"}),"Edit"]}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this meal plan?"))try{const{error:s}=await r.from("meal_plans_v2").delete().eq("id",e);if(s)throw s;c({title:"Meal plan deleted successfully"}),V()}catch(s){c({variant:"destructive",title:"Error",description:"Failed to delete meal plan"})}})(s.id),className:"text-destructive",children:e.jsx(K,{className:"w-4 h-4"})})]})]})})};return M?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(b,{className:"w-8 h-8 text-primary"}),"Meal Planning"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Create and manage personalized meal plans"})]}),e.jsxs(i,{onClick:()=>J(),children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"New Meal Plan"]})]}),e.jsx(h,{className:"glass-effect",children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(O,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(Le,{placeholder:"Search meal plans...",value:g,onChange:e=>f(e.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{variant:"all"===y?"default":"outline",onClick:()=>_("all"),size:"sm",children:["All (",a.length,")"]}),e.jsx(i,{variant:"active"===y?"default":"outline",onClick:()=>_("active"),size:"sm",children:"Active"}),e.jsx(i,{variant:"completed"===y?"default":"outline",onClick:()=>_("completed"),size:"sm",children:"Completed"}),e.jsx(i,{variant:"archived"===y?"default":"outline",onClick:()=>_("archived"),size:"sm",children:"Archived"})]})]})})}),u.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:u.map(s=>e.jsx(Z,{plan:s},s.id))}):e.jsx(h,{className:"glass-effect",children:e.jsxs(j,{className:"p-12 text-center",children:[e.jsx(b,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No meal plans found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:g||"all"!==y?"Try adjusting your filters":"Create your first meal plan to get started"}),e.jsxs(i,{onClick:()=>J(),children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Create Meal Plan"]})]})}),e.jsx(Be,{open:w,onOpenChange:k,children:e.jsxs(Ke,{className:"max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ve,{children:e.jsx(Ge,{children:C?"Edit Meal Plan":"Create New Meal Plan"})}),e.jsxs(Oe,{defaultValue:"basic",className:"mt-4",children:[e.jsxs(We,{className:"grid w-full grid-cols-3",children:[e.jsx($e,{value:"basic",children:"Basic Info"}),e.jsx($e,{value:"schedule",children:"Meal Schedule"}),e.jsx($e,{value:"targets",children:"Nutrition Targets"})]}),e.jsx(Ue,{value:"basic",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Client *"}),e.jsxs("select",{value:W.client_id,onChange:e=>$({...W,client_id:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"",children:"Select a client"}),m.map(s=>e.jsxs("option",{value:s.id,children:[s.full_name," (",s.email,")"]},s.id))]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Plan Name *"}),e.jsx(Le,{value:W.name,onChange:e=>$({...W,name:e.target.value}),placeholder:"e.g., Weight Loss Plan - Week 1"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Description"}),e.jsx(n,{value:W.description,onChange:e=>$({...W,description:e.target.value}),placeholder:"Brief description of the meal plan goals and approach",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Start Date *"}),e.jsx(Le,{type:"date",value:W.start_date,onChange:e=>$({...W,start_date:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"End Date *"}),e.jsx(Le,{type:"date",value:W.end_date,onChange:e=>$({...W,end_date:e.target.value})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Notes"}),e.jsx(n,{value:W.notes,onChange:e=>$({...W,notes:e.target.value}),placeholder:"Additional notes, instructions, or guidelines",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Status"}),e.jsxs("select",{value:W.status,onChange:e=>$({...W,status:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"archived",children:"Archived"})]})]})]})}),e.jsxs(Ue,{value:"schedule",className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground mb-4",children:"Click on a meal slot to assign a recipe from your database"}),e.jsx("div",{className:"space-y-4",children:["monday","tuesday","wednesday","thursday","friday","saturday","sunday"].map(s=>e.jsxs("div",{className:"border border-border rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold capitalize mb-3",children:s}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:U.map(t=>e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>((e,s)=>{P(e),T(s),R(!0)})(s,t),className:"h-auto py-3 flex flex-col items-start",children:[e.jsx("span",{className:"text-xs text-muted-foreground capitalize",children:t}),e.jsx("span",{className:"text-xs mt-1",children:W.meal_schedule?.[s]?.[t]?"✓ Assigned":"+ Add Recipe"})]},t))})]},s))})]}),e.jsxs(Ue,{value:"targets",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Daily Calories Target"}),e.jsx(Le,{type:"number",value:W.target_calories,onChange:e=>$({...W,target_calories:parseInt(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Protein Target (g)"}),e.jsx(Le,{type:"number",value:W.target_protein_g,onChange:e=>$({...W,target_protein_g:parseInt(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Carbs Target (g)"}),e.jsx(Le,{type:"number",value:W.target_carbs_g,onChange:e=>$({...W,target_carbs_g:parseInt(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Fat Target (g)"}),e.jsx(Le,{type:"number",value:W.target_fat_g,onChange:e=>$({...W,target_fat_g:parseInt(e.target.value)})})]})]}),e.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Macro Distribution"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Protein"}),e.jsxs("p",{className:"font-semibold",children:[(4*W.target_protein_g/W.target_calories*100).toFixed(0),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Carbs"}),e.jsxs("p",{className:"font-semibold",children:[(4*W.target_carbs_g/W.target_calories*100).toFixed(0),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Fat"}),e.jsxs("p",{className:"font-semibold",children:[(9*W.target_fat_g/W.target_calories*100).toFixed(0),"%"]})]})]})]})]})]}),e.jsxs(He,{className:"mt-6",children:[e.jsx(i,{variant:"outline",onClick:()=>k(!1),children:"Cancel"}),e.jsxs(i,{onClick:async()=>{if(W.client_id&&W.name&&W.start_date&&W.end_date){D(!0);try{const e={...W,nutritionist_id:t.id};if(C){const{error:s}=await r.from("meal_plans_v2").update(e).eq("id",C.id);if(s)throw s;c({title:"Meal plan updated successfully"})}else{const{error:s}=await r.from("meal_plans_v2").insert(e);if(s)throw s;c({title:"Meal plan created successfully"})}k(!1),V()}catch(e){c({variant:"destructive",title:"Error",description:"Failed to save meal plan"})}finally{D(!1)}}else c({variant:"destructive",title:"Error",description:"Please fill in all required fields"})},disabled:F,children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),F?"Saving...":"Save Meal Plan"]})]})]})}),e.jsx(Be,{open:E,onOpenChange:R,children:e.jsxs(Ke,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ve,{children:e.jsxs(Ge,{children:["Select Recipe for ",I&&z&&e.jsxs("span",{className:"capitalize",children:[I," - ",z]})]})}),e.jsx(Xe,{onSelectRecipe:e=>{if(I&&z){const s={...W.meal_schedule};s[I]||(s[I]={}),s[I][z]=e.id,$({...W,meal_schedule:s}),R(!1),P(null),T(null),c({title:"Recipe added to meal plan"})}}})]})})]})},ss=()=>{const{user:t}=l(),[a,o]=s.useState([]),[m,x]=s.useState([]),[u,f]=s.useState(new Date),[v,b]=s.useState(new Date),[y,w]=s.useState(!1),[C,S]=s.useState(null),[M,F]=s.useState(!0),[D,E]=s.useState(!1),[R,I]=s.useState("month"),[P,z]=s.useState({client_id:"",title:"",description:"",appointment_date:"",appointment_time:"",duration_minutes:60,consultation_type:"follow_up",meeting_link:"",status:"scheduled",notes:""}),T=[{value:"scheduled",label:"Scheduled",color:"bg-blue-500"},{value:"completed",label:"Completed",color:"bg-green-500"},{value:"cancelled",label:"Cancelled",color:"bg-red-500"},{value:"no_show",label:"No Show",color:"bg-gray-500"}];s.useEffect(()=>{O(),W()},[t,u]);const O=async()=>{F(!0);try{const e=H(u),s=Y(u),{data:a,error:l}=await r.from("appointments").select("\n          *,\n          client:user_profiles!appointments_client_id_fkey(id, full_name, email)\n        ").eq("nutritionist_id",t.id).gte("appointment_date",e.toISOString()).lte("appointment_date",s.toISOString()).order("appointment_date",{ascending:!0});if(l)throw l;o(a||[])}catch(e){c({variant:"destructive",title:"Error",description:"Failed to fetch appointments"})}finally{F(!1)}},W=async()=>{try{const{data:e,error:s}=await r.from("user_profiles").select("id, full_name, email").eq("role","user").order("full_name",{ascending:!0});if(s)throw s;x(e||[])}catch(e){}},$=(e=null,s=null)=>{if(e){const s=new Date(e.appointment_date);S(e),z({client_id:e.client_id,title:e.title,description:e.description||"",appointment_date:k(s,"yyyy-MM-dd"),appointment_time:k(s,"HH:mm"),duration_minutes:e.duration_minutes||60,consultation_type:e.consultation_type||"follow_up",meeting_link:e.meeting_link||"",status:e.status||"scheduled",notes:e.notes||""})}else{const e=s||v;S(null),z({client_id:"",title:"",description:"",appointment_date:k(e,"yyyy-MM-dd"),appointment_time:"10:00",duration_minutes:60,consultation_type:"follow_up",meeting_link:"",status:"scheduled",notes:""})}w(!0)},U=e=>a.filter(s=>X(le(s.appointment_date),e)),V=({appointment:s,compact:t=!1})=>{const a=T.find(e=>e.value===s.status),l=new Date(s.appointment_date);return t?e.jsxs("div",{onClick:()=>$(s),className:"text-xs p-1 mb-1 rounded cursor-pointer hover:opacity-80 transition-opacity truncate",style:{backgroundColor:a?.color.replace("bg-","")+"30"},children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:k(l,"h:mm a")})]}),e.jsx("div",{className:"truncate",children:s.title})]}):e.jsx(h,{className:"glass-effect hover:shadow-lg transition-all",children:e.jsxs(j,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(_,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm font-semibold",children:[k(l,"MMM d, yyyy")," at ",k(l,"h:mm a")]})]}),e.jsx("h3",{className:"font-semibold text-lg",children:s.title}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(A,{className:"w-3 h-3"}),s.client?.full_name||"Unknown Client"]})]}),e.jsx(d,{variant:"completed"===s.status?"default":"secondary",children:a?.label})]}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Duration: ",s.duration_minutes," min"]}),s.meeting_link&&e.jsxs("span",{className:"flex items-center gap-1 text-primary",children:[e.jsx(re,{className:"w-4 h-4"}),"Video call"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>$(s),children:e.jsx(B,{className:"w-4 h-4"})}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this appointment?"))try{const{error:s}=await r.from("appointments").delete().eq("id",e);if(s)throw s;c({title:"Appointment deleted successfully"}),O()}catch(s){c({variant:"destructive",title:"Error",description:"Failed to delete appointment"})}})(s.id),className:"text-destructive",children:e.jsx(K,{className:"w-4 h-4"})})]})]})]})})};return M?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(J,{className:"w-12 h-12 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(N,{className:"w-8 h-8 text-primary"}),"Schedule"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your appointments and consultations"})]}),e.jsxs(i,{onClick:()=>$(),children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"New Appointment"]})]}),e.jsxs(h,{className:"glass-effect",children:[e.jsx(p,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>f(se(u,1)),children:e.jsx(Z,{className:"w-4 h-4"})}),e.jsx("h3",{className:"text-xl font-semibold min-w-[200px] text-center",children:k(u,"MMMM yyyy")}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>f(te(u,1)),children:e.jsx(Q,{className:"w-4 h-4"})})]}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>f(new Date),children:"Today"})]})}),e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(s=>e.jsx("div",{className:"text-center font-semibold text-sm py-2",children:s},s)),(()=>{const e=H(u),s=Y(u);return ae({start:e,end:s})})().map(s=>{const t=U(s),a=X(s,v),l=ee(s);return e.jsxs("div",{onClick:()=>b(s),className:`min-h-[100px] p-2 border rounded-lg cursor-pointer transition-colors ${a?"border-primary bg-primary/10":"border-border hover:bg-muted/50"} ${l?"bg-primary/5":""}`,children:[e.jsx("div",{className:"text-sm font-semibold mb-1 "+(l?"text-primary":""),children:k(s,"d")}),e.jsxs("div",{className:"space-y-1",children:[t.slice(0,2).map(s=>e.jsx(V,{appointment:s,compact:!0},s.id)),t.length>2&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["+",t.length-2," more"]})]})]},s.toISOString())})]})})]}),e.jsxs(h,{className:"glass-effect",children:[e.jsx(p,{children:e.jsxs(g,{children:["Appointments for ",k(v,"EEEE, MMMM d, yyyy")]})}),e.jsx(j,{children:U(v).length>0?e.jsx("div",{className:"space-y-4",children:U(v).map(s=>e.jsx(V,{appointment:s},s.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No appointments scheduled for this date"}),e.jsxs(i,{variant:"outline",onClick:()=>$(null,v),className:"mt-4",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Schedule Appointment"]})]})})]}),e.jsx(Be,{open:y,onOpenChange:w,children:e.jsxs(Ke,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ve,{children:e.jsx(Ge,{children:C?"Edit Appointment":"New Appointment"})}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Client *"}),e.jsxs("select",{value:P.client_id,onChange:e=>z({...P,client_id:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"",children:"Select a client"}),m.map(s=>e.jsxs("option",{value:s.id,children:[s.full_name," (",s.email,")"]},s.id))]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Title *"}),e.jsx(Le,{value:P.title,onChange:e=>z({...P,title:e.target.value}),placeholder:"e.g., Initial Consultation"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Description"}),e.jsx(n,{value:P.description,onChange:e=>z({...P,description:e.target.value}),placeholder:"Brief description of the appointment",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Date *"}),e.jsx(Le,{type:"date",value:P.appointment_date,onChange:e=>z({...P,appointment_date:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Time *"}),e.jsx(Le,{type:"time",value:P.appointment_time,onChange:e=>z({...P,appointment_time:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Duration (minutes)"}),e.jsx(Le,{type:"number",min:"15",step:"15",value:P.duration_minutes,onChange:e=>z({...P,duration_minutes:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Type"}),e.jsx("select",{value:P.consultation_type,onChange:e=>z({...P,consultation_type:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[{value:"initial",label:"Initial Consultation"},{value:"follow_up",label:"Follow-up"},{value:"check_in",label:"Check-in"}].map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Status"}),e.jsx("select",{value:P.status,onChange:e=>z({...P,status:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:T.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Meeting Link (optional)"}),e.jsx(Le,{value:P.meeting_link,onChange:e=>z({...P,meeting_link:e.target.value}),placeholder:"https://zoom.us/j/..."})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Notes"}),e.jsx(n,{value:P.notes,onChange:e=>z({...P,notes:e.target.value}),placeholder:"Additional notes about this appointment",rows:3})]})]})}),e.jsxs(He,{children:[e.jsx(i,{variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsx(i,{onClick:async()=>{if(P.client_id&&P.title&&P.appointment_date&&P.appointment_time){E(!0);try{const e=new Date(`${P.appointment_date}T${P.appointment_time}`),s={nutritionist_id:t.id,client_id:P.client_id,title:P.title,description:P.description,appointment_date:e.toISOString(),duration_minutes:parseInt(P.duration_minutes),consultation_type:P.consultation_type,meeting_link:P.meeting_link,status:P.status,notes:P.notes};if(C){const{error:e}=await r.from("appointments").update(s).eq("id",C.id);if(e)throw e;c({title:"Appointment updated successfully"})}else{const{error:e}=await r.from("appointments").insert(s);if(e)throw e;c({title:"Appointment created successfully"})}w(!1),O()}catch(e){c({variant:"destructive",title:"Error",description:"Failed to save appointment"})}finally{E(!1)}}else c({variant:"destructive",title:"Error",description:"Please fill in all required fields"})},disabled:D,children:D?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Save Appointment"]})})]})]})})]})},ts=()=>{const{user:t}=l(),[a,o]=s.useState([]),[m,x]=s.useState([]),[u,g]=s.useState(null),[f,v]=s.useState([]),[b,N]=s.useState(""),[y,_]=s.useState(""),[w,C]=s.useState(!0),[S,M]=s.useState(!1),[F,D]=s.useState(!1),[E,R]=s.useState(""),[I,P]=s.useState("");s.useEffect(()=>{z(),T()},[t]),s.useEffect(()=>{u&&(L(u),W(u))},[u]);const z=async()=>{try{const{data:e,error:s}=await r.from("user_profiles").select("id, full_name, email, profile_picture_url").eq("role","user").order("full_name",{ascending:!0});if(s)throw s;o(e||[])}catch(e){}},T=async()=>{C(!0);try{const{data:e,error:s}=await r.from("messages").select("\n          *,\n          sender:user_profiles!messages_sender_id_fkey(id, full_name, email, profile_picture_url),\n          recipient:user_profiles!messages_recipient_id_fkey(id, full_name, email, profile_picture_url)\n        ").or(`sender_id.eq.${t.id},recipient_id.eq.${t.id}`).order("created_at",{ascending:!1});if(s)throw s;const a=new Map;(e||[]).forEach(e=>{const s=e.sender_id===t.id?e.recipient_id:e.sender_id,l=e.sender_id===t.id?e.recipient:e.sender;a.has(s)||a.set(s,{partnerId:s,partner:l,lastMessage:e,unreadCount:0}),e.recipient_id!==t.id||e.is_read||a.get(s).unreadCount++}),x(Array.from(a.values()))}catch(e){c({variant:"destructive",title:"Error",description:"Failed to fetch conversations"})}finally{C(!1)}},L=async e=>{try{const s=e.partnerId,{data:a,error:l}=await r.from("messages").select("\n          *,\n          sender:user_profiles!messages_sender_id_fkey(id, full_name, profile_picture_url)\n        ").or(`and(sender_id.eq.${t.id},recipient_id.eq.${s}),and(sender_id.eq.${s},recipient_id.eq.${t.id})`).order("created_at",{ascending:!0});if(l)throw l;v(a||[])}catch(s){}},W=async e=>{try{const{error:s}=await r.from("messages").update({is_read:!0}).eq("sender_id",e.partnerId).eq("recipient_id",t.id).eq("is_read",!1);if(s)throw s;T()}catch(s){}},$=async()=>{if(b.trim()&&u){M(!0);try{const{error:e}=await r.from("messages").insert({sender_id:t.id,recipient_id:u.partnerId,message_text:b.trim(),is_read:!1});if(e)throw e;N(""),await L(u),await T()}catch(e){c({variant:"destructive",title:"Error",description:"Failed to send message"})}finally{M(!1)}}},U=m.filter(e=>e.partner?.full_name?.toLowerCase().includes(y.toLowerCase())||e.partner?.email?.toLowerCase().includes(y.toLowerCase())),B=({conversation:s})=>e.jsx("div",{onClick:()=>g(s),className:"p-4 border-b border-border cursor-pointer hover:bg-muted/50 transition-colors "+(u?.partnerId===s.partnerId?"bg-muted":""),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:s.partner?.profile_picture_url?e.jsx("img",{src:s.partner.profile_picture_url,alt:s.partner.full_name,className:"w-12 h-12 rounded-full object-cover"}):e.jsx(A,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h4",{className:"font-semibold text-sm truncate",children:s.partner?.full_name||"Unknown"}),e.jsx("span",{className:"text-xs text-muted-foreground flex-shrink-0 ml-2",children:k(new Date(s.lastMessage.created_at),"MMM d")})]}),e.jsx("p",{className:"text-sm truncate "+(s.unreadCount>0?"font-semibold":"text-muted-foreground"),children:s.lastMessage.message_text}),s.unreadCount>0&&e.jsxs(d,{variant:"default",className:"mt-1",children:[s.unreadCount," new"]})]})]})}),K=({message:s})=>{const a=s.sender_id===t.id;return e.jsx("div",{className:`flex ${a?"justify-end":"justify-start"} mb-4`,children:e.jsxs("div",{className:"max-w-[70%] "+(a?"order-2":"order-1"),children:[!a&&e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center",children:s.sender?.profile_picture_url?e.jsx("img",{src:s.sender.profile_picture_url,alt:s.sender.full_name,className:"w-6 h-6 rounded-full object-cover"}):e.jsx(A,{className:"w-3 h-3 text-primary"})}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.sender?.full_name})]}),e.jsxs("div",{className:"rounded-lg p-3 "+(a?"bg-primary text-primary-foreground":"bg-muted"),children:[e.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:s.message_text}),e.jsxs("div",{className:"flex items-center justify-end gap-1 mt-1 "+(a?"text-primary-foreground/70":"text-muted-foreground"),children:[e.jsx("span",{className:"text-xs",children:k(new Date(s.created_at),"h:mm a")}),a&&(s.is_read?e.jsx(oe,{className:"w-3 h-3"}):e.jsx(me,{className:"w-3 h-3"}))]})]})]})})};return w?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(J,{className:"w-12 h-12 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(ie,{className:"w-8 h-8 text-primary"}),"Messages"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Communicate with your clients"})]}),e.jsxs(i,{onClick:()=>D(!0),children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"New Message"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(h,{className:"glass-effect lg:col-span-1",children:[e.jsx(p,{className:"pb-3",children:e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(Le,{placeholder:"Search conversations...",value:y,onChange:e=>_(e.target.value),className:"pl-10"})]})}),e.jsx(j,{className:"p-0",children:e.jsx("div",{className:"max-h-[600px] overflow-y-auto",children:U.length>0?U.map(s=>e.jsx(B,{conversation:s},s.partnerId)):e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx(ie,{className:"w-12 h-12 mx-auto text-muted-foreground mb-3 opacity-50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:y?"No conversations found":"No messages yet"}),e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>D(!0),className:"mt-3",children:[e.jsx(q,{className:"w-4 h-4 mr-1"}),"Start a conversation"]})]})})})]}),e.jsx(h,{className:"glass-effect lg:col-span-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"border-b border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>g(null),className:"lg:hidden",children:e.jsx(ne,{className:"w-4 h-4"})}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:u.partner?.profile_picture_url?e.jsx("img",{src:u.partner.profile_picture_url,alt:u.partner.full_name,className:"w-10 h-10 rounded-full object-cover"}):e.jsx(A,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:u.partner?.full_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:u.partner?.email})]})]})}),e.jsxs(j,{className:"p-0",children:[e.jsx("div",{className:"h-[450px] overflow-y-auto p-4",children:f.map(s=>e.jsx(K,{message:s},s.id))}),e.jsxs("div",{className:"border-t border-border p-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{placeholder:"Type your message...",value:b,onChange:e=>N(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),$())},className:"min-h-[60px] resize-none"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(i,{variant:"outline",size:"icon",disabled:!0,title:"File attachment (coming soon)",children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsx(i,{onClick:$,disabled:!b.trim()||S,size:"icon",children:S?e.jsx(J,{className:"w-4 h-4 animate-spin"}):e.jsx(de,{className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Press Enter to send, Shift+Enter for new line"})]})]})]}):e.jsx(j,{className:"flex items-center justify-center h-[600px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ie,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No conversation selected"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Choose a conversation from the list or start a new one"}),e.jsxs(i,{onClick:()=>D(!0),children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"New Message"]})]})})})]}),e.jsx(Be,{open:F,onOpenChange:D,children:e.jsxs(Ke,{className:"max-w-2xl",children:[e.jsx(Ve,{children:e.jsx(Ge,{children:"New Message"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"To:"}),e.jsxs("select",{value:E,onChange:e=>R(e.target.value),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"",children:"Select a client"}),a.map(s=>e.jsxs("option",{value:s.id,children:[s.full_name," (",s.email,")"]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Message:"}),e.jsx(n,{value:I,onChange:e=>P(e.target.value),placeholder:"Type your message here...",rows:6})]})]}),e.jsxs(He,{children:[e.jsx(i,{variant:"outline",onClick:()=>D(!1),children:"Cancel"}),e.jsx(i,{onClick:async()=>{if(E&&I.trim()){M(!0);try{const{error:e}=await r.from("messages").insert({sender_id:t.id,recipient_id:E,message_text:I.trim(),is_read:!1});if(e)throw e;c({title:"Message sent",description:"Your message has been sent successfully"}),D(!1),R(""),P(""),await T()}catch(e){c({variant:"destructive",title:"Error",description:"Failed to send message"})}finally{M(!1)}}else c({variant:"destructive",title:"Error",description:"Please select a client and enter a message"})},disabled:S,children:S?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"Send Message"]})})]})]})})]})},as=()=>{const{toast:t}=o(),[a,l]=s.useState(!0),[n,c]=s.useState(!1),[d,m]=s.useState("30"),[x,u]=s.useState({totalClients:0,activeClients:0,totalAppointments:0,completedAppointments:0,averageSuccessRate:0,totalRevenue:0}),[h,p]=s.useState([]),[g,j]=s.useState([]),[f,b]=s.useState([]),[y,_]=s.useState([]),[w,C]=s.useState([]),[S,M]=s.useState([]);s.useEffect(()=>{A()},[d]);const A=async()=>{l(!0);try{await Promise.all([q(),T(),L(),O(),W(),$(),U()])}catch(e){t({title:"Error",description:"Failed to load analytics data",variant:"destructive"})}finally{l(!1)}},q=async()=>{const e=new Date;e.setDate(e.getDate()-parseInt(d));const{data:s}=await r.from("user_profiles").select("id, role, created_at").eq("role","user"),t=s?.length||0,a=s?.filter(s=>new Date(s.created_at)>=e).length||0,{data:l}=await r.from("appointments").select("*").gte("appointment_date",e.toISOString()),i=l?.length||0,n=l?.filter(e=>"completed"===e.status).length||0,{data:c}=await r.from("client_progress").select("*").gte("date",e.toISOString()),o=c?.length>0?c.filter(e=>e.weight_kg&&e.weight_kg>0).length/c.length*100:0;u({totalClients:t,activeClients:a,totalAppointments:i,completedAppointments:n,averageSuccessRate:Math.round(o),totalRevenue:75*i})},T=async()=>{const e=xe(new Date,parseInt(d)),{data:s}=await r.from("client_progress").select("\n        *,\n        user_profiles!client_progress_user_id_fkey(full_name)\n      ").gte("date",e.toISOString()).order("date",{ascending:!0});if(s){const e=s.reduce((e,s)=>{const t=k(new Date(s.date),"MMM dd");return e[t]||(e[t]={date:t,totalWeight:0,count:0}),s.weight_kg&&(e[t].totalWeight+=s.weight_kg,e[t].count+=1),e},{}),t=Object.values(e).map(e=>({date:e.date,avgWeight:e.count>0?(e.totalWeight/e.count).toFixed(1):0}));p(t)}},L=async()=>{const e=xe(new Date,parseInt(d)),{data:s}=await r.from("appointments").select("*").gte("appointment_date",e.toISOString()).order("appointment_date",{ascending:!0});if(s){const e=s.reduce((e,s)=>{const t=k(new Date(s.appointment_date),"MMM dd");return e[t]||(e[t]={date:t,scheduled:0,completed:0,cancelled:0}),"scheduled"===s.status&&(e[t].scheduled+=1),"completed"===s.status&&(e[t].completed+=1),"cancelled"===s.status&&(e[t].cancelled+=1),e},{});j(Object.values(e))}},O=async()=>{const{data:e}=await r.from("client_health_data").select("goals");if(e){const s=e.reduce((e,s)=>((s.goals||[]).forEach(s=>{e[s]=(e[s]||0)+1}),e),{}),t=Object.entries(s).map(([e,s])=>({name:e.replace("_"," ").toUpperCase(),value:s}));b(t)}},W=async()=>{const e=xe(new Date,parseInt(d)),{data:s}=await r.from("habit_logs").select("\n        *,\n        client_habits!habit_logs_habit_id_fkey(habit_name)\n      ").gte("log_date",e.toISOString()).order("log_date",{ascending:!0});if(s){const e=s.reduce((e,s)=>{const t=k(new Date(s.log_date),"MMM dd");return e[t]||(e[t]={date:t,total:0,completed:0}),e[t].total+=1,s.completed&&(e[t].completed+=1),e},{}),t=Object.values(e).map(e=>({date:e.date,rate:e.total>0?Math.round(e.completed/e.total*100):0}));_(t)}},$=async()=>{const e=xe(new Date,parseInt(d)),{data:s}=await r.from("client_progress").select("\n        user_id,\n        weight_kg,\n        date,\n        user_profiles!client_progress_user_id_fkey(full_name, email)\n      ").gte("date",e.toISOString()).order("date",{ascending:!0});if(s){const e=s.reduce((e,s)=>(e[s.user_id]||(e[s.user_id]={userId:s.user_id,name:s.user_profiles?.full_name||"Unknown",email:s.user_profiles?.email||"",weights:[]}),s.weight_kg&&e[s.user_id].weights.push(s.weight_kg),e),{}),t=Object.values(e).map(e=>{const s=e.weights;if(s.length<2)return null;const t=s[0],a=t-s[s.length-1],l=(a/t*100).toFixed(1);return{...e,weightChange:a.toFixed(1),percentChange:parseFloat(l)}}).filter(Boolean).sort((e,s)=>Math.abs(s.percentChange)-Math.abs(e.percentChange)).slice(0,5);C(t)}},U=async()=>{const e=xe(new Date,parseInt(d)),{data:s}=await r.from("appointments").select("appointment_date, consultation_type").eq("status","completed").gte("appointment_date",e.toISOString()).order("appointment_date",{ascending:!0});if(s){const e=s.reduce((e,s)=>{const t=k(new Date(s.appointment_date),"MMM dd");e[t]||(e[t]={date:t,revenue:0});const a="initial"===s.consultation_type?100:"check_in"===s.consultation_type?50:75;return e[t].revenue+=a,e},{});M(Object.values(e))}},B=["hsl(142, 76%, 36%)","hsl(217, 91%, 60%)","hsl(38, 92%, 50%)","hsl(0, 84%, 60%)","hsl(258, 90%, 66%)","hsl(330, 81%, 60%)"];return a?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ue.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-foreground",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Track performance and client success metrics"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:d,onChange:e=>m(e.target.value),className:"px-4 py-2 rounded-lg border border-border bg-card text-foreground",children:[e.jsx("option",{value:"7",children:"Last 7 days"}),e.jsx("option",{value:"30",children:"Last 30 days"}),e.jsx("option",{value:"90",children:"Last 90 days"})]}),e.jsxs(i,{variant:"outline",onClick:async()=>{c(!0),await A(),c(!1),t({title:"Success",description:"Analytics data refreshed"})},disabled:n,children:[e.jsx(he,{className:"h-4 w-4 mr-2 "+(n?"animate-spin":"")}),"Refresh"]}),e.jsxs(i,{onClick:()=>{t({title:"Export Started",description:"Generating analytics report..."})},children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Export Report"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(ls,{icon:v,title:"Total Clients",value:x.totalClients,change:`+${x.activeClients} this period`,trend:"up",color:"blue"}),e.jsx(ls,{icon:N,title:"Appointments",value:x.totalAppointments,change:`${x.completedAppointments} completed`,trend:"up",color:"green"}),e.jsx(ls,{icon:G,title:"Success Rate",value:`${x.averageSuccessRate}%`,change:"Average client progress",trend:"up",color:"purple"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(ue.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Average Client Progress"}),e.jsx(ge,{className:"h-5 w-5 text-muted-foreground"})]}),e.jsx(F,{width:"100%",height:300,children:e.jsxs(je,{data:h,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorWeight",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"hsl(217, 91%, 60%)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"hsl(217, 91%, 60%)",stopOpacity:0})]})}),e.jsx(E,{strokeDasharray:"3 3",className:"stroke-border"}),e.jsx(R,{dataKey:"date",className:"stroke-muted-foreground"}),e.jsx(I,{className:"stroke-muted-foreground"}),e.jsx(P,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--popover-foreground))"}}),e.jsx(fe,{type:"monotone",dataKey:"avgWeight",stroke:"hsl(217, 91%, 60%)",fillOpacity:1,fill:"url(#colorWeight)"})]})})]}),e.jsxs(ue.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Appointment Trends"}),e.jsx(ve,{className:"h-5 w-5 text-gray-400"})]}),e.jsx(F,{width:"100%",height:300,children:e.jsxs(be,{data:g,children:[e.jsx(E,{strokeDasharray:"3 3",className:"stroke-border"}),e.jsx(R,{dataKey:"date",className:"stroke-muted-foreground"}),e.jsx(I,{className:"stroke-muted-foreground"}),e.jsx(P,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--popover-foreground))"}}),e.jsx(Ne,{}),e.jsx(ye,{dataKey:"scheduled",fill:"hsl(217, 91%, 60%)",name:"Scheduled"}),e.jsx(ye,{dataKey:"completed",fill:"hsl(142, 76%, 36%)",name:"Completed"}),e.jsx(ye,{dataKey:"cancelled",fill:"hsl(0, 84%, 60%)",name:"Cancelled"})]})})]}),e.jsxs(ue.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Client Goals Distribution"}),e.jsx(_e,{className:"h-5 w-5 text-gray-400"})]}),e.jsx(F,{width:"100%",height:300,children:e.jsxs(we,{children:[e.jsx(ke,{data:f,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,percent:s})=>`${e} ${(100*s).toFixed(0)}%`,outerRadius:80,fill:"hsl(217, 91%, 60%)",dataKey:"value",children:f.map((s,t)=>e.jsx(Ce,{fill:B[t%B.length]},`cell-${t}`))}),e.jsx(P,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--popover-foreground))"}})]})})]}),e.jsxs(ue.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Client Compliance Rate"}),e.jsx(Se,{className:"h-5 w-5 text-gray-400"})]}),e.jsx(F,{width:"100%",height:300,children:e.jsxs(D,{data:y,children:[e.jsx(E,{strokeDasharray:"3 3",className:"stroke-border"}),e.jsx(R,{dataKey:"date",className:"stroke-muted-foreground"}),e.jsx(I,{className:"stroke-muted-foreground"}),e.jsx(P,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--popover-foreground))"}}),e.jsx(z,{type:"monotone",dataKey:"rate",stroke:"hsl(142, 76%, 36%)",strokeWidth:2,dot:{fill:"hsl(142, 76%, 36%)"}})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(ue.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Top Performers"}),e.jsx(Se,{className:"h-5 w-5 text-yellow-500"})]}),0===w.length?e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No progress data available"}):e.jsx("div",{className:"space-y-4",children:w.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 text-primary font-bold",children:t+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold "+(s.weightChange>0?"text-destructive":"text-primary"),children:[s.weightChange>0?"+":"",s.weightChange," kg"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[Math.abs(s.percentChange),"% change"]})]})]},s.userId))})]}),e.jsxs(ue.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Revenue Trends"}),e.jsx(Me,{className:"h-5 w-5 text-green-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-3xl font-bold text-foreground",children:["$",x.totalRevenue.toLocaleString()]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total revenue this period"})]}),e.jsx(F,{width:"100%",height:200,children:e.jsxs(je,{data:S,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorRevenue",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"hsl(142, 76%, 36%)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"hsl(142, 76%, 36%)",stopOpacity:0})]})}),e.jsx(E,{strokeDasharray:"3 3",className:"stroke-border"}),e.jsx(R,{dataKey:"date",className:"stroke-muted-foreground"}),e.jsx(I,{className:"stroke-muted-foreground"}),e.jsx(P,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--popover-foreground))"}}),e.jsx(fe,{type:"monotone",dataKey:"revenue",stroke:"hsl(142, 76%, 36%)",fillOpacity:1,fill:"url(#colorRevenue)"})]})})]})]})]})},ls=({icon:s,title:t,value:a,change:l,trend:r,color:i})=>e.jsx(ue.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:t}),e.jsx("p",{className:"text-3xl font-bold text-card-foreground mb-2",children:a}),e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:["up"===r?e.jsx(y,{className:"h-4 w-4 text-primary"}):e.jsx(W,{className:"h-4 w-4 text-destructive"}),e.jsx("span",{className:"up"===r?"text-primary":"text-destructive",children:l})]})]}),e.jsx("div",{className:`p-3 rounded-lg ${{blue:"bg-blue-500/10 text-blue-500",green:"bg-primary/10 text-primary",purple:"bg-violet-500/10 text-violet-500",red:"bg-destructive/10 text-destructive"}[i]}`,children:e.jsx(s,{className:"h-6 w-6"})})]})}),rs=()=>{const{toast:t}=o(),[a,l]=s.useState(!0),[n,c]=s.useState([]),[m,x]=s.useState([]),[u,h]=s.useState(""),[p,g]=s.useState("all"),[j,f]=s.useState(null),[v,b]=s.useState(!1),[N,y]=s.useState(!1),[w,C]=s.useState({title:"",description:"",content:"",resource_type:"article",category:"nutrition",url:"",file_url:"",tags:[],is_public:!0}),[S,M]=s.useState(""),A=[{value:"all",label:"All Resources",icon:Ae},{value:"nutrition",label:"Nutrition",icon:Fe},{value:"exercise",label:"Exercise",icon:Fe},{value:"wellness",label:"Wellness",icon:Fe},{value:"recipes",label:"Recipes",icon:Fe},{value:"guides",label:"Guides",icon:T}],F=[{value:"article",label:"Article",icon:T},{value:"video",label:"Video",icon:re},{value:"pdf",label:"PDF Document",icon:pe},{value:"link",label:"External Link",icon:Ie}];s.useEffect(()=>{D()},[]),s.useEffect(()=>{E()},[n,u,p]);const D=async()=>{l(!0);try{const{data:e,error:s}=await r.from("educational_resources").select("*").order("created_at",{ascending:!1});if(s)throw s;c(e||[])}catch(e){t({title:"Error",description:"Failed to load resources",variant:"destructive"})}finally{l(!1)}},E=()=>{let e=n;if("all"!==p&&(e=e.filter(e=>e.category===p)),u){const s=u.toLowerCase();e=e.filter(e=>e.title.toLowerCase().includes(s)||e.description?.toLowerCase().includes(s)||e.tags?.some(e=>e.toLowerCase().includes(s)))}x(e)},R=async e=>{t({title:"Share Link Copied",description:"Resource link copied to clipboard"})},I=()=>{S&&!w.tags.includes(S)&&(C({...w,tags:[...w.tags,S]}),M(""))},P=()=>{C({title:"",description:"",content:"",resource_type:"article",category:"nutrition",url:"",file_url:"",tags:[],is_public:!0}),f(null)},z=e=>{const s={article:"bg-blue-500/10 text-blue-600 dark:text-blue-400",video:"bg-purple-500/10 text-purple-600 dark:text-purple-400",pdf:"bg-red-500/10 text-red-600 dark:text-red-400",link:"bg-green-500/10 text-green-600 dark:text-green-400"};return s[e]||s.article};return a?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ue.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-foreground",children:"Resource Library"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage educational content and resources for clients"})]}),e.jsxs(i,{onClick:()=>{P(),b(!0)},children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Add Resource"]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Search resources...",value:u,onChange:e=>h(e.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border border-border bg-background text-foreground"})]}),e.jsx("div",{className:"flex gap-2",children:A.map(s=>{const t=s.icon;return e.jsxs(i,{variant:p===s.value?"default":"outline",onClick:()=>g(s.value),className:"whitespace-nowrap",children:[e.jsx(t,{className:"h-4 w-4 mr-2"}),s.label]},s.value)})})]}),0===m.length?e.jsxs(ue.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-12 bg-card rounded-xl border border-border",children:[e.jsx(Fe,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No Resources Found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:u||"all"!==p?"Try adjusting your filters":"Get started by creating your first resource"}),e.jsxs(i,{onClick:()=>{P(),b(!0)},children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Add Resource"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map((s,a)=>{const l=(e=>{const s=F.find(s=>s.value===e);return s?s.icon:T})(s.resource_type);return e.jsxs(ue.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*a},className:"bg-card rounded-xl shadow-lg border border-border overflow-hidden hover:shadow-xl transition-shadow",children:[e.jsx("div",{className:`p-4 ${z(s.resource_type)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(l,{className:"h-8 w-8"}),e.jsx(d,{variant:s.is_public?"default":"secondary",children:s.is_public?"Public":"Private"})]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2 line-clamp-2",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-3",children:s.description||"No description available"}),s.tags&&s.tags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[s.tags.slice(0,3).map((s,t)=>e.jsxs(d,{variant:"outline",className:"text-xs",children:[e.jsx(De,{className:"h-3 w-3 mr-1"}),s]},t)),s.tags.length>3&&e.jsxs(d,{variant:"outline",className:"text-xs",children:["+",s.tags.length-3]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground mb-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"h-3 w-3"}),k(new Date(s.created_at),"MMM dd, yyyy")]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ee,{className:"h-3 w-3"}),s.view_count||0," views"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>(async e=>{f(e),y(!0);try{await r.from("educational_resources").update({view_count:(e.view_count||0)+1}).eq("id",e.id)}catch(s){}})(s),children:[e.jsx(Ee,{className:"h-4 w-4 mr-1"}),"View"]}),e.jsx(i,{size:"sm",variant:"outline",onClick:()=>(e=>{f(e),C({title:e.title,description:e.description||"",content:e.content||"",resource_type:e.resource_type,category:e.category,url:e.url||"",file_url:e.file_url||"",tags:e.tags||[],is_public:e.is_public}),b(!0)})(s),children:e.jsx(B,{className:"h-4 w-4"})}),e.jsx(i,{size:"sm",variant:"outline",onClick:()=>R(),children:e.jsx(Re,{className:"h-4 w-4"})}),e.jsx(i,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this resource?"))try{const{error:s}=await r.from("educational_resources").delete().eq("id",e);if(s)throw s;t({title:"Success",description:"Resource deleted successfully"}),D()}catch(s){t({title:"Error",description:"Failed to delete resource",variant:"destructive"})}})(s.id),children:e.jsx(K,{className:"h-4 w-4"})})]})]})]},s.id)})}),e.jsx(Be,{open:v,onOpenChange:b,children:e.jsxs(Ke,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ve,{children:e.jsx(Ge,{children:j?"Edit Resource":"Add New Resource"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Title *"}),e.jsx("input",{type:"text",value:w.title,onChange:e=>C({...w,title:e.target.value}),className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",placeholder:"Resource title"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Type *"}),e.jsx("select",{value:w.resource_type,onChange:e=>C({...w,resource_type:e.target.value}),className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",children:F.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Category"}),e.jsx("select",{value:w.category,onChange:e=>C({...w,category:e.target.value}),className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",children:A.filter(e=>"all"!==e.value).map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Description"}),e.jsx("textarea",{value:w.description,onChange:e=>C({...w,description:e.target.value}),rows:3,className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",placeholder:"Brief description"})]}),("link"===w.resource_type||"video"===w.resource_type)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"URL"}),e.jsx("input",{type:"url",value:w.url,onChange:e=>C({...w,url:e.target.value}),className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",placeholder:"https://example.com"})]}),"pdf"===w.resource_type&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"File URL"}),e.jsx("input",{type:"url",value:w.file_url,onChange:e=>C({...w,file_url:e.target.value}),className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",placeholder:"Upload file and paste URL"})]}),"article"===w.resource_type&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Content"}),e.jsx("textarea",{value:w.content,onChange:e=>C({...w,content:e.target.value}),rows:10,className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground font-mono text-sm",placeholder:"Write your article content here (supports Markdown)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Tags"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",value:S,onChange:e=>M(e.target.value),onKeyPress:e=>"Enter"===e.key&&(e.preventDefault(),I()),className:"flex-1 px-4 py-2 rounded-lg border border-border bg-background text-foreground",placeholder:"Add a tag and press Enter"}),e.jsx(i,{onClick:I,children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:w.tags.map((s,t)=>e.jsxs(d,{className:"flex items-center gap-1",children:[s,e.jsx(U,{className:"h-3 w-3 cursor-pointer",onClick:()=>{return e=s,void C({...w,tags:w.tags.filter(s=>s!==e)});var e}})]},t))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"is_public",checked:w.is_public,onChange:e=>C({...w,is_public:e.target.checked}),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"is_public",className:"text-sm font-medium text-foreground",children:"Make this resource public to all clients"})]})]}),e.jsxs(He,{children:[e.jsx(i,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsxs(i,{onClick:async()=>{if(w.title&&w.resource_type)try{const{data:{user:e}}=await r.auth.getUser(),s={...w,created_by:e?.id,view_count:0};let a;if(j){const{data:e,error:l}=await r.from("educational_resources").update(s).eq("id",j.id).select().single();if(l)throw l;a=e,t({title:"Success",description:"Resource updated successfully"})}else{const{data:e,error:l}=await r.from("educational_resources").insert([s]).select().single();if(l)throw l;a=e,t({title:"Success",description:"Resource created successfully"})}b(!1),P(),D()}catch(e){t({title:"Error",description:"Failed to save resource",variant:"destructive"})}else t({title:"Validation Error",description:"Please fill in required fields",variant:"destructive"})},children:[j?"Update":"Create"," Resource"]})]})]})}),e.jsx(Be,{open:N,onOpenChange:y,children:e.jsx(Ke,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:j&&e.jsxs(e.Fragment,{children:[e.jsx(Ve,{children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx(Ge,{className:"text-2xl mb-2 text-foreground",children:j.title}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(d,{children:j.resource_type}),e.jsx(d,{variant:"outline",children:j.category}),e.jsx("span",{children:"•"}),e.jsx("span",{children:k(new Date(j.created_at),"MMMM dd, yyyy")}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[j.view_count||0," views"]})]})]})})}),e.jsxs("div",{className:"space-y-4",children:[j.description&&e.jsx("div",{children:e.jsx("p",{className:"text-muted-foreground",children:j.description})}),j.tags&&j.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:j.tags.map((s,t)=>e.jsxs(d,{variant:"outline",children:[e.jsx(De,{className:"h-3 w-3 mr-1"}),s]},t))}),"article"===j.resource_type&&j.content&&e.jsx("div",{className:"prose dark:prose-invert max-w-none",children:e.jsx("div",{className:"whitespace-pre-wrap text-foreground",children:j.content})}),"link"===j.resource_type&&j.url&&e.jsx("div",{className:"p-4 bg-muted/50 rounded-lg",children:e.jsxs("a",{href:j.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-primary hover:underline",children:[e.jsx(Pe,{className:"h-4 w-4"}),"Open External Link"]})}),"video"===j.resource_type&&j.url&&e.jsx("div",{className:"aspect-video bg-muted rounded-lg flex items-center justify-center",children:e.jsxs("a",{href:j.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-primary hover:underline",children:[e.jsx(re,{className:"h-6 w-6"}),"Watch Video"]})}),"pdf"===j.resource_type&&j.file_url&&e.jsx("div",{className:"p-4 bg-muted/50 rounded-lg",children:e.jsxs("a",{href:j.file_url,download:!0,className:"flex items-center gap-2 text-primary hover:underline",children:[e.jsx(pe,{className:"h-4 w-4"}),"Download PDF"]})})]}),e.jsxs(He,{children:[e.jsx(i,{variant:"outline",onClick:()=>y(!1),children:"Close"}),e.jsxs(i,{onClick:()=>R(),children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"Share"]})]})]})})})]})},is=()=>{const{user:t,userProfile:a}=l(),[d,o]=s.useState(!0),[m,x]=s.useState(!1),[u,v]=s.useState("business"),[b,N]=s.useState({business_name:"",business_address:"",business_phone:"",license_number:"",specializations:[],consultation_duration_default:60,buffer_time_minutes:15,working_hours:{monday:{enabled:!0,start:"09:00",end:"17:00"},tuesday:{enabled:!0,start:"09:00",end:"17:00"},wednesday:{enabled:!0,start:"09:00",end:"17:00"},thursday:{enabled:!0,start:"09:00",end:"17:00"},friday:{enabled:!0,start:"09:00",end:"17:00"},saturday:{enabled:!1,start:"09:00",end:"13:00"},sunday:{enabled:!1,start:"09:00",end:"13:00"}},time_zone:Intl.DateTimeFormat().resolvedOptions().timeZone,booking_advance_days:30,hourly_rate:"",initial_consultation_fee:"",follow_up_fee:"",package_pricing:[],email_notifications:!0,sms_notifications:!1,appointment_reminders:!0,reminder_hours_before:24,brand_color:"#10b981",logo_url:"",custom_email_signature:""}),[y,w]=s.useState(""),[k,S]=s.useState({name:"",sessions:"",price:""});s.useEffect(()=>{M()},[t]);const M=async()=>{o(!0);try{const{data:e,error:s}=await r.from("nutritionist_settings").select("*").eq("nutritionist_id",t.id).single();if(s&&"PGRST116"!==s.code)throw s;e&&N({...b,...e,specializations:e.specializations||[],working_hours:e.working_hours||b.working_hours,package_pricing:e.package_pricing||[]})}catch(e){}finally{o(!1)}},A=async()=>{x(!0);try{const{data:e}=await r.from("nutritionist_settings").select("id").eq("nutritionist_id",t.id).single(),s={...b,nutritionist_id:t.id};if(e){const{error:e}=await r.from("nutritionist_settings").update(s).eq("nutritionist_id",t.id);if(e)throw e}else{const{error:e}=await r.from("nutritionist_settings").insert(s);if(e)throw e}c({title:"Settings saved",description:"Your settings have been updated successfully"})}catch(e){c({variant:"destructive",title:"Error",description:"Failed to save settings"})}finally{x(!1)}},F=()=>{y.trim()&&!b.specializations.includes(y.trim())&&(N({...b,specializations:[...b.specializations,y.trim()]}),w(""))},D=(e,s,t)=>{N({...b,working_hours:{...b.working_hours,[e]:{...b.working_hours[e],[s]:t}}})};return d?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(J,{className:"w-12 h-12 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(ze,{className:"w-8 h-8 text-primary"}),"Settings"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your business settings and preferences"})]}),e.jsx(i,{onClick:A,disabled:m,children:m?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Save Changes"]})})]}),e.jsxs(Oe,{value:u,onValueChange:v,children:[e.jsxs(We,{className:"grid w-full grid-cols-5",children:[e.jsx($e,{value:"business",children:"Business"}),e.jsx($e,{value:"availability",children:"Availability"}),e.jsx($e,{value:"pricing",children:"Pricing"}),e.jsx($e,{value:"notifications",children:"Notifications"}),e.jsx($e,{value:"branding",children:"Branding"})]}),e.jsx(Ue,{value:"business",className:"space-y-4",children:e.jsxs(h,{children:[e.jsxs(p,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-5 h-5"}),"Business Information"]}),e.jsx(f,{children:"Manage your professional business details"})]}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Business Name"}),e.jsx(Le,{value:b.business_name,onChange:e=>N({...b,business_name:e.target.value}),placeholder:"Your Nutrition Practice"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"License Number"}),e.jsx(Le,{value:b.license_number,onChange:e=>N({...b,license_number:e.target.value}),placeholder:"License #"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Business Address"}),e.jsx(n,{value:b.business_address,onChange:e=>N({...b,business_address:e.target.value}),placeholder:"123 Main St, City, State, ZIP",rows:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Business Phone"}),e.jsx(Le,{value:b.business_phone,onChange:e=>N({...b,business_phone:e.target.value}),placeholder:"+1 (555) 000-0000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Specializations"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(Le,{value:y,onChange:e=>w(e.target.value),placeholder:"e.g., Weight Loss, Sports Nutrition",onKeyPress:e=>"Enter"===e.key&&F()}),e.jsx(i,{onClick:F,children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:b.specializations.map((s,t)=>e.jsxs("span",{className:"px-3 py-1 bg-primary/10 text-primary rounded-full text-sm flex items-center gap-2",children:[s,e.jsx("button",{onClick:()=>(e=>{N({...b,specializations:b.specializations.filter(s=>s!==e)})})(s),className:"text-primary/60 hover:text-primary",children:"×"})]},t))})]})]})]})}),e.jsx(Ue,{value:"availability",className:"space-y-4",children:e.jsxs(h,{children:[e.jsxs(p,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"}),"Working Hours"]}),e.jsx(f,{children:"Set your available hours for client bookings"})]}),e.jsxs(j,{className:"space-y-4",children:[["monday","tuesday","wednesday","thursday","friday","saturday","sunday"].map(s=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-32",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx(Ye,{checked:b.working_hours[s]?.enabled||!1,onCheckedChange:e=>D(s,"enabled",e)}),e.jsx("span",{className:"capitalize font-medium",children:s})]})}),b.working_hours[s]?.enabled&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{type:"time",value:b.working_hours[s]?.start||"09:00",onChange:e=>D(s,"start",e.target.value),className:"w-32"}),e.jsx("span",{children:"to"}),e.jsx(Le,{type:"time",value:b.working_hours[s]?.end||"17:00",onChange:e=>D(s,"end",e.target.value),className:"w-32"})]})]},s)),e.jsxs("div",{className:"pt-4 border-t border-border grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Default Consultation Duration"}),e.jsxs("select",{value:b.consultation_duration_default,onChange:e=>N({...b,consultation_duration_default:parseInt(e.target.value)}),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"30",children:"30 minutes"}),e.jsx("option",{value:"45",children:"45 minutes"}),e.jsx("option",{value:"60",children:"60 minutes"}),e.jsx("option",{value:"90",children:"90 minutes"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Buffer Time (minutes)"}),e.jsx(Le,{type:"number",value:b.buffer_time_minutes,onChange:e=>N({...b,buffer_time_minutes:parseInt(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Booking Advance (days)"}),e.jsx(Le,{type:"number",value:b.booking_advance_days,onChange:e=>N({...b,booking_advance_days:parseInt(e.target.value)})})]})]})]})]})}),e.jsx(Ue,{value:"pricing",className:"space-y-4",children:e.jsxs(h,{children:[e.jsxs(p,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5"}),"Consultation Pricing"]}),e.jsx(f,{children:"Set your consultation fees and package pricing"})]}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Hourly Rate"}),e.jsx(Le,{type:"number",step:"0.01",value:b.hourly_rate,onChange:e=>N({...b,hourly_rate:e.target.value}),placeholder:"100.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Initial Consultation Fee"}),e.jsx(Le,{type:"number",step:"0.01",value:b.initial_consultation_fee,onChange:e=>N({...b,initial_consultation_fee:e.target.value}),placeholder:"150.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Follow-up Fee"}),e.jsx(Le,{type:"number",step:"0.01",value:b.follow_up_fee,onChange:e=>N({...b,follow_up_fee:e.target.value}),placeholder:"75.00"})]})]}),e.jsxs("div",{className:"pt-4 border-t border-border",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Package Pricing"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 mb-4",children:[e.jsx(Le,{placeholder:"Package name",value:k.name,onChange:e=>S({...k,name:e.target.value})}),e.jsx(Le,{type:"number",placeholder:"Sessions",value:k.sessions,onChange:e=>S({...k,sessions:e.target.value})}),e.jsx(Le,{type:"number",step:"0.01",placeholder:"Price",value:k.price,onChange:e=>S({...k,price:e.target.value})}),e.jsx(i,{onClick:()=>{k.name&&k.sessions&&k.price&&(N({...b,package_pricing:[...b.package_pricing,{name:k.name,sessions:parseInt(k.sessions),price:parseFloat(k.price)}]}),S({name:"",sessions:"",price:""}))},children:"Add Package"})]}),b.package_pricing.length>0&&e.jsx("div",{className:"space-y-2",children:b.package_pricing.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.sessions," sessions • $",s.price]})]}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>(e=>{N({...b,package_pricing:b.package_pricing.filter((s,t)=>t!==e)})})(t),children:"Remove"})]},t))})]})]})]})}),e.jsx(Ue,{value:"notifications",className:"space-y-4",children:e.jsxs(h,{children:[e.jsxs(p,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5"}),"Notification Preferences"]}),e.jsx(f,{children:"Manage how you receive notifications and reminders"})]}),e.jsxs(j,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Email Notifications"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive notifications via email"})]}),e.jsx(Ye,{checked:b.email_notifications,onCheckedChange:e=>N({...b,email_notifications:e})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"SMS Notifications"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive notifications via text message"})]}),e.jsx(Ye,{checked:b.sms_notifications,onCheckedChange:e=>N({...b,sms_notifications:e})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Appointment Reminders"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Send reminders for upcoming appointments"})]}),e.jsx(Ye,{checked:b.appointment_reminders,onCheckedChange:e=>N({...b,appointment_reminders:e})})]}),b.appointment_reminders&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Send reminders (hours before appointment)"}),e.jsx(Le,{type:"number",value:b.reminder_hours_before,onChange:e=>N({...b,reminder_hours_before:parseInt(e.target.value)})})]})]})]})}),e.jsx(Ue,{value:"branding",className:"space-y-4",children:e.jsxs(h,{children:[e.jsxs(p,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5"}),"Branding & Customization"]}),e.jsx(f,{children:"Customize your brand appearance and communications"})]}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Brand Color"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{type:"color",value:b.brand_color,onChange:e=>N({...b,brand_color:e.target.value}),className:"w-20 h-10"}),e.jsx(Le,{value:b.brand_color,onChange:e=>N({...b,brand_color:e.target.value}),placeholder:"#10b981"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Logo URL"}),e.jsx(Le,{value:b.logo_url,onChange:e=>N({...b,logo_url:e.target.value}),placeholder:"https://example.com/logo.png"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Custom Email Signature"}),e.jsx(n,{value:b.custom_email_signature,onChange:e=>N({...b,custom_email_signature:e.target.value}),placeholder:"Best regards,\nYour Name\nCertified Nutritionist",rows:4})]})]})]})})]}),e.jsx("div",{className:"flex justify-end sticky bottom-4",children:e.jsx(i,{onClick:A,disabled:m,size:"lg",children:m?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Save All Changes"]})})})]})},ns=({user:t})=>{const[l]=a(),[r,i]=s.useState("dashboard");s.useEffect(()=>{const e=l.get("tab");i(e||"dashboard")},[l]);return e.jsx(x,{children:e.jsx(ue.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:(()=>{switch(r){case"dashboard":default:return e.jsx(Je,{user:t});case"clients":return e.jsx(Qe,{});case"meals":return e.jsx(es,{});case"schedule":return e.jsx(ss,{});case"messages":return e.jsx(ts,{});case"analytics":return e.jsx(as,{});case"resources":return e.jsx(rs,{});case"blog":return e.jsx(u,{user:t});case"settings":return e.jsx(is,{})}})()},r)})},cs=()=>{const{userProfile:s}=l(),t={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}};return e.jsxs(e.Fragment,{children:[e.jsxs(m,{children:[e.jsx("title",{children:"Nutritionist Dashboard - GreenoFig"}),e.jsx("meta",{name:"description",content:"Manage your nutrition practice and clients"})]}),e.jsxs(ue.div,{variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"visible",className:"space-y-8",children:[e.jsxs(ue.div,{variants:t,children:[e.jsxs("h1",{className:"text-4xl font-bold",children:["Nutritionist ",e.jsx("span",{className:"gradient-text",children:"Portal"})]}),e.jsxs("p",{className:"text-text-secondary mt-2",children:["Welcome, ",s?.full_name?.split(" ")[0]||"Nutritionist",". Manage your clients and practice from here."]})]}),e.jsx(ue.div,{variants:t,children:e.jsx(ns,{user:s})})]})]})};export{cs as default};
