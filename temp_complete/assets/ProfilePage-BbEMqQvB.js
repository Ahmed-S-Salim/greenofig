import{j as e}from"./vendor-ui-jbjsCjSW.js";import{a as s}from"./vendor-react-C4Yvcgue.js";import{u as t,H as a,B as r,A as l,a as i,b as d,s as n,t as o}from"./index-CJcmXEeE.js";import{C as c,c as m,a as u,b as x,e as h}from"./card-D1JrzjfW.js";import{I as p}from"./input-Bpymy_1X.js";import{C as f}from"./checkbox-ccrOBxuN.js";import{L as g}from"./label-DzfI_Yi5.js";import{c as j,m as b,U as N,P as v,k as y,T as w,l as _,n as k,E as C,o as P}from"./vendor-utils-jh41mPu7.js";import"./vendor-editor-D6Zd0gNL.js";const S=()=>{const{user:S,userProfile:F,refreshUserProfile:A}=t(),[E,U]=s.useState(null),[$,H]=s.useState(!1),[q,I]=s.useState(!0),[L,z]=s.useState(!1),[G,M]=s.useState(!1),W=s.useRef(null),[B,D]=s.useState(!1),[Y,R]=s.useState(""),[T,V]=s.useState(""),[J,K]=s.useState(""),[O,Q]=s.useState(!1),[X,Z]=s.useState(!1),[ee,se]=s.useState(!1);s.useEffect(()=>{F&&(U({...F}),I(!1))},[F]);const te=e=>{const{name:s,value:t}=e.target;U(e=>({...e,[s]:t}))},ae=()=>{$&&W.current.click()};return q||!E?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(j,{className:"h-12 w-12 animate-spin text-primary"})}):e.jsxs(e.Fragment,{children:[e.jsxs(a,{children:[e.jsx("title",{children:"My Profile - GreenoFig"}),e.jsx("meta",{name:"description",content:"Manage your profile and settings."})]}),e.jsxs(b.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},initial:"hidden",animate:"visible",className:"max-w-4xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl font-bold",children:["My ",e.jsx("span",{className:"gradient-text",children:"Profile"})]}),e.jsx("p",{className:"text-text-secondary mt-2",children:"View and manage your personal details."})]}),e.jsx(r,{onClick:()=>H(!$),disabled:L||G,children:$?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"mr-2 h-4 w-4"})," View Profile"]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"mr-2 h-4 w-4"})," Edit Profile"]})})]}),e.jsx(c,{className:"glass-effect",children:e.jsx(m,{className:"p-6",children:$?e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!S)return;z(!0);const{id:s,created_at:t,updated_at:a,role:r,email:l,profile_picture_url:i,...d}=E,{error:c}=await n.from("user_profiles").update(d).eq("id",S.id);c?o({variant:"destructive",title:"Error updating profile",description:c.message}):(await A(),o({title:"Profile Updated!",description:"Your information has been successfully saved."}),H(!1)),z(!1)},className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"relative group",children:[e.jsxs(l,{className:"h-24 w-24 cursor-pointer",onClick:ae,children:[e.jsx(i,{src:E?.profile_picture_url,alt:E?.full_name}),e.jsx(d,{className:"text-4xl",children:E?.full_name?.split(" ").map(e=>e[0]).join("")||"?"})]}),G?e.jsx("div",{className:"absolute inset-0 bg-background/80 flex items-center justify-center rounded-full",children:e.jsx(j,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center rounded-full opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer",onClick:ae,children:e.jsx(y,{className:"h-8 w-8 text-white"})}),e.jsx("input",{type:"file",ref:W,onChange:async e=>{const s=e.target.files[0];if(!s||!S)return;M(!0);const t=s.name.split(".").pop(),a=`avatars/${`${S.id}.${t}`}`,{error:r}=await n.storage.from("user-assets").upload(a,s,{upsert:!0});if(r)return o({variant:"destructive",title:"Upload failed",description:r.message}),void M(!1);const{data:{publicUrl:l}}=n.storage.from("user-assets").getPublicUrl(a),i=`${l}?t=${(new Date).getTime()}`,{error:d}=await n.from("user_profiles").update({profile_picture_url:i}).eq("id",S.id);d?o({variant:"destructive",title:"Failed to save avatar",description:d.message}):(await A(),o({title:"Avatar updated!",description:"Your new profile picture is now live."})),M(!1)},accept:"image/png, image/jpeg",className:"hidden"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"full_name",className:"block text-sm font-medium text-text-primary",children:"Full Name"}),e.jsx("input",{type:"text",name:"full_name",id:"full_name",value:E.full_name||"",onChange:te,className:"mt-1 block w-full bg-background border border-border rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-text-secondary",children:"Email"}),e.jsx("input",{type:"email",name:"email",id:"email",value:E.email||"",disabled:!0,className:"mt-1 block w-full bg-muted border-border rounded-md shadow-sm py-2 px-3 sm:text-sm cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"age",className:"block text-sm font-medium text-text-primary",children:"Age"}),e.jsx("input",{type:"number",name:"age",id:"age",value:E.age||"",onChange:te,className:"mt-1 block w-full bg-background border border-border rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"height_cm",className:"block text-sm font-medium text-text-primary",children:"Height (cm)"}),e.jsx("input",{type:"number",name:"height_cm",id:"height_cm",value:E.height_cm||"",onChange:te,className:"mt-1 block w-full bg-background border border-border rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"weight_kg",className:"block text-sm font-medium text-text-primary",children:"Weight (kg)"}),e.jsx("input",{type:"number",step:"0.1",name:"weight_kg",id:"weight_kg",value:E.weight_kg||"",onChange:te,className:"mt-1 block w-full bg-background border border-border rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-text-primary mb-3 flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4"}),"Health Goals"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[{id:"lose_weight",label:"Lose Weight"},{id:"build_muscle",label:"Build Muscle"},{id:"improve_endurance",label:"Improve Endurance"},{id:"eat_healthier",label:"Eat Healthier"},{id:"increase_energy",label:"Increase Energy"},{id:"reduce_stress",label:"Reduce Stress"},{id:"better_sleep",label:"Better Sleep"}].map(s=>e.jsxs("div",{className:"flex items-center space-x-2 p-3 rounded-lg border border-border hover:bg-muted/50 transition-colors",children:[e.jsx(f,{id:s.id,checked:(E.health_goals||[]).includes(s.id),onCheckedChange:()=>(e=>{const s=E.health_goals||[],t=s.includes(e)?s.filter(s=>s!==e):[...s,e];U(e=>({...e,health_goals:t}))})(s.id)}),e.jsx(g,{htmlFor:s.id,className:"text-sm font-medium cursor-pointer flex-1",children:s.label})]},s.id))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Select all that apply to personalize your experience"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(r,{type:"submit",disabled:L||G,children:[L?e.jsx(j,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(_,{className:"mr-2 h-4 w-4"}),"Save Changes"]})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs(l,{className:"h-24 w-24 border-2 border-primary",children:[e.jsx(i,{src:E?.profile_picture_url,alt:E?.full_name}),e.jsx(d,{className:"text-4xl",children:E?.full_name?.split(" ").map(e=>e[0]).join("")||"?"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-text-primary",children:E.full_name}),e.jsx("p",{className:"text-text-secondary",children:E.email}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize mt-1",children:E.role||"user"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-6 pt-6 border-t border-border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Age"}),e.jsx("p",{className:"text-lg font-semibold",children:E.age||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Gender"}),e.jsx("p",{className:"text-lg font-semibold capitalize",children:E.gender||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Height"}),e.jsx("p",{className:"text-lg font-semibold",children:E.height_cm?`${E.height_cm} cm`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Weight"}),e.jsx("p",{className:"text-lg font-semibold",children:E.weight_kg?`${E.weight_kg} kg`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Activity Level"}),e.jsx("p",{className:"text-lg font-semibold capitalize",children:E.activity_level?.replace("_"," ")||"N/A"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Health Goals"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:E.health_goals?.length>0?E.health_goals.map(s=>e.jsx("span",{className:"px-3 py-1 text-sm rounded-full bg-primary/10 text-primary font-medium",children:s},s)):e.jsx("p",{children:"No goals set."})})]})]})})}),e.jsxs(c,{className:"glass-effect",children:[e.jsxs(u,{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),"Change Password"]}),e.jsx(h,{children:"Update your password to keep your account secure"})]}),e.jsx(m,{children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),T.length<8)o({variant:"destructive",title:"Password too short",description:"Password must be at least 8 characters long."});else if(T===J){D(!0);try{const{error:e}=await n.auth.signInWithPassword({email:S.email,password:Y});if(e)return o({variant:"destructive",title:"Incorrect current password",description:"Please enter your correct current password."}),void D(!1);const{error:s}=await n.auth.updateUser({password:T});if(s)throw s;o({title:"Password updated successfully",description:"Your password has been changed."}),R(""),V(""),K("")}catch(s){o({variant:"destructive",title:"Error updating password",description:s.message})}finally{D(!1)}}else o({variant:"destructive",title:"Passwords do not match",description:"Please make sure both passwords are the same."})},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{type:O?"text":"password",value:Y,onChange:e=>R(e.target.value),placeholder:"Enter current password",disabled:B,required:!0,className:"pr-10"}),e.jsx("button",{type:"button",onClick:()=>Q(!O),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:O?e.jsx(C,{className:"w-4 h-4"}):e.jsx(P,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{type:X?"text":"password",value:T,onChange:e=>V(e.target.value),placeholder:"Enter new password",disabled:B,required:!0,minLength:8,className:"pr-10"}),e.jsx("button",{type:"button",onClick:()=>Z(!X),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:X?e.jsx(C,{className:"w-4 h-4"}):e.jsx(P,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"At least 8 characters"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{type:ee?"text":"password",value:J,onChange:e=>K(e.target.value),placeholder:"Confirm new password",disabled:B,required:!0,minLength:8,className:"pr-10"}),e.jsx("button",{type:"button",onClick:()=>se(!ee),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:ee?e.jsx(C,{className:"w-4 h-4"}):e.jsx(P,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(r,{type:"submit",disabled:B,children:[B&&e.jsx(j,{className:"mr-2 h-4 w-4 animate-spin"}),B?"Updating...":"Update Password"]})})]})})]})]})]})};export{S as default};
