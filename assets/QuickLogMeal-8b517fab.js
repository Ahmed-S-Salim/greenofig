import{j as e}from"./vendor-ui-fc6158c5.js";import{r as a}from"./vendor-react-c35372bd.js";import{D as s,e as r,a as t,b as i,c as l}from"./dialog-3cad693a.js";import{u as n,B as o,T as d,s as c,t as p}from"./index-05318a06.js";import{I as m}from"./input-a2afde68.js";import{L as g}from"./label-00b518b2.js";import{S as _,a as u,b as h,c as j,d as x}from"./select-74e79011.js";import{Y as v}from"./vendor-utils-1c344488.js";const f=({onSuccess:f})=>{const{userProfile:y}=n(),[b,F]=a.useState(!1),[C,S]=a.useState(!1),[w,k]=a.useState({meal_type:"breakfast",meal_name:"",description:"",calories:"",protein_g:"",carbs_g:"",fats_g:"",date:(new Date).toISOString().split("T")[0]});return e.jsxs(s,{open:b,onOpenChange:F,children:[e.jsx(r,{asChild:!0,children:e.jsxs(o,{className:"w-full",children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),"Log Meal"]})}),e.jsxs(t,{className:"max-h-[90vh] overflow-y-auto",children:[e.jsx(i,{children:e.jsx(l,{children:"Log Your Meal"})}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),S(!0);try{const e={user_id:y.id,meal_type:w.meal_type,meal_name:w.meal_name,description:w.description,calories:w.calories?parseInt(w.calories):null,protein_g:w.protein_g?parseFloat(w.protein_g):null,carbs_g:w.carbs_g?parseFloat(w.carbs_g):null,fats_g:w.fats_g?parseFloat(w.fats_g):null,date:w.date},{error:a}=await c.from("meal_logs").insert(e);if(a)throw a;if(w.calories){const{data:e}=await c.from("daily_metrics").select("*").eq("user_id",y.id).eq("date",w.date).single(),a=((null==e?void 0:e.calories_consumed)||0)+parseInt(w.calories),s=((null==e?void 0:e.protein_g)||0)+(w.protein_g?parseFloat(w.protein_g):0),r=((null==e?void 0:e.carbs_g)||0)+(w.carbs_g?parseFloat(w.carbs_g):0),t=((null==e?void 0:e.fats_g)||0)+(w.fats_g?parseFloat(w.fats_g):0);e?await c.from("daily_metrics").update({calories_consumed:a,protein_g:s,carbs_g:r,fats_g:t}).eq("id",e.id):await c.from("daily_metrics").insert({user_id:y.id,date:w.date,calories_consumed:a,protein_g:s,carbs_g:r,fats_g:t})}await c.from("activity_feed").insert({user_id:y.id,activity_type:"logged_meal",activity_title:`Logged ${w.meal_type}`,activity_description:w.meal_name,metadata:{calories:w.calories?parseInt(w.calories):0}}),await c.rpc("update_user_streak",{p_user_id:y.id,p_streak_type:"meal_log",p_activity_date:w.date}),p({title:"Meal Logged!",description:`Successfully logged ${w.meal_name||w.meal_type}`}),k({meal_type:"breakfast",meal_name:"",description:"",calories:"",protein_g:"",carbs_g:"",fats_g:"",date:(new Date).toISOString().split("T")[0]}),F(!1),f&&f()}catch(a){p({title:"Error",description:"Failed to log meal. Please try again.",variant:"destructive"})}finally{S(!1)}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"date",children:"Date"}),e.jsx(m,{id:"date",type:"date",value:w.date,onChange:e=>k({...w,date:e.target.value}),max:(new Date).toISOString().split("T")[0],required:!0})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"meal_type",children:"Meal Type *"}),e.jsxs(_,{value:w.meal_type,onValueChange:e=>k({...w,meal_type:e}),children:[e.jsx(u,{children:e.jsx(h,{})}),e.jsxs(j,{children:[e.jsx(x,{value:"breakfast",children:"Breakfast"}),e.jsx(x,{value:"lunch",children:"Lunch"}),e.jsx(x,{value:"dinner",children:"Dinner"}),e.jsx(x,{value:"snack",children:"Snack"})]})]})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"meal_name",children:"Meal Name *"}),e.jsx(m,{id:"meal_name",placeholder:"e.g., Grilled Chicken Salad",value:w.meal_name,onChange:e=>k({...w,meal_name:e.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"description",children:"Description (optional)"}),e.jsx(d,{id:"description",placeholder:"Any additional details...",value:w.description,onChange:e=>k({...w,description:e.target.value}),rows:2})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"calories",children:"Calories"}),e.jsx(m,{id:"calories",type:"number",placeholder:"500",value:w.calories,onChange:e=>k({...w,calories:e.target.value})})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"protein",children:"Protein (g)"}),e.jsx(m,{id:"protein",type:"number",step:"0.1",placeholder:"25",value:w.protein_g,onChange:e=>k({...w,protein_g:e.target.value})})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"carbs",children:"Carbs (g)"}),e.jsx(m,{id:"carbs",type:"number",step:"0.1",placeholder:"50",value:w.carbs_g,onChange:e=>k({...w,carbs_g:e.target.value})})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"fats",children:"Fats (g)"}),e.jsx(m,{id:"fats",type:"number",step:"0.1",placeholder:"15",value:w.fats_g,onChange:e=>k({...w,fats_g:e.target.value})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>F(!1),className:"flex-1",children:"Cancel"}),e.jsx(o,{type:"submit",disabled:C,className:"flex-1",children:C?"Logging...":"Log Meal"})]})]})]})]})};export{f as Q};
