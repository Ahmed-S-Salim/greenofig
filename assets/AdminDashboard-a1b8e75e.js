import{j as e,f as s,g as a,h as t,i,k as r,l,m as n,n as c,L as d,o,p as m,q as x,r as h,t as u,u as p,v as j}from"./vendor-ui-fc6158c5.js";import{r as g,u as f,l as v}from"./vendor-react-c35372bd.js";import{s as y,t as N,B as b,T as _,c as w,u as C,A as k,b as S,d as A,a as P,e as F,H as T}from"./index-05318a06.js";import{E as R,a as E}from"./EnhancedBlogManager-be32aa1f.js";import{C as M,c as I,a as q,b as U,e as L}from"./card-aef3fa8a.js";import{aO as D,l as O,a4 as $,aL as z,m as V,n as G,q as B,a5 as W,j as H,T as Q,aV as Y,aW as J,G as K,r as X,ai as Z,ak as ee,p as se,K as ae,A as te,z as ie,aX as re,aA as le,Q as ne,X as ce,V as de,_ as oe,Z as me,aY as xe,aN as he,ao as ue,aZ as pe,a_ as je,a8 as ge,F as fe,a$ as ve,b0 as ye,aw as Ne,e as be,ax as _e,aj as we,b1 as Ce,x as ke,b2 as Se,M as Ae,b3 as Pe,an as Fe,a9 as Te,b4 as Re,L as Ee,b5 as Me,o as Ie,az as qe,b6 as Ue,U as Le,b7 as De,k as Oe,b8 as $e,a6 as ze,b9 as Ve,w as Ge,ba as Be,E as We,bb as He,bc as Qe,I as Ye,bd as Je,g as Ke,be as Xe,bf as Ze,bg as es,aK as ss,S as as,$ as ts,B as is,bh as rs,i as ls,bi as ns}from"./vendor-utils-1c344488.js";import{D as cs,a as ds,b as os,c as ms,d as xs,f as hs,e as us}from"./dialog-3cad693a.js";import{I as ps}from"./input-a2afde68.js";import{L as js}from"./label-00b518b2.js";import{C as gs}from"./checkbox-4d0e9ce0.js";import{S as fs,a as vs,b as ys,c as Ns,d as bs}from"./select-74e79011.js";import{T as _s,a as ws,b as Cs,c as ks}from"./tabs-9cefe97b.js";import{S as Ss}from"./switch-96e6e5bd.js";import As from"./RevenueAnalyticsPage-7492c347.js";import"./vendor-editor-c22fa4d3.js";const Ps="super_admin",Fs="admin",Ts="content_editor",Rs="support_agent",Es="analyst",Ms="nutritionist",Is="user",qs="customers:view",Us="customers:edit",Ls="customers:export",Ds="subscriptions:view",Os="subscriptions:edit",$s="subscriptions:create",zs="payments:view",Vs="payments:refund",Gs="payments:export",Bs="revenue:view",Ws="revenue:export",Hs="analytics:view",Qs="analytics:export",Ys="blog:view",Js="blog:create",Ks="blog:edit",Xs="blog:delete",Zs="blog:publish",ea="website:view",sa="website:edit",aa="coupons:view",ta="coupons:create",ia="coupons:edit",ra="coupons:delete",la="referrals:view",na="referrals:manage",ca="support:view",da="support:respond",oa="support:assign",ma="database:view",xa="settings:view",ha="users:view_roles",ua={[Ps]:["*"],[Fs]:[qs,Us,Ls,Ds,Os,$s,zs,Vs,Gs,Bs,Ws,Hs,Qs,Ys,Js,Ks,Xs,Zs,ea,sa,aa,ta,ia,ra,la,na,ca,da,oa,xa,ha],[Ts]:[Ys,Js,Ks,Zs,ea,sa,Hs],[Rs]:[qs,ca,da,Ds],[Es]:[Hs,Qs,Bs,Ws,qs,Ls,Ds,zs,Gs],[Ms]:[qs,ca,da],[Is]:[]},pa=(e,s)=>{if(!e||!e.role)return!1;const a={dashboard:[Hs],analytics:[Hs],revenue:[Bs],customers:[qs],subscriptions:[Ds],payments:[zs],coupons:[aa],referrals:[la],issues:[ca],blog:[Ys],website:[ea],studio:[ma]}[s];return!a||0===a.length||a.some(s=>((e,s)=>{if(!e||!e.role)return!1;const a=e.role,t=ua[a]||[];return!!t.includes("*")||t.includes(s)})(e,s))},ja=({user:s,onNavigate:a})=>{const[t,i]=g.useState({totalRevenue:0,monthlyRevenue:0,totalUsers:0,activeUsers:0,totalVisitors:0,conversionRate:0,growthRate:0}),[r,l]=g.useState([]),[n,c]=g.useState({sources:[],conversions:0,clickThroughRate:0}),[d,o]=g.useState({premium:0,pro:0,elite:0});g.useEffect(()=>{(async()=>{const{data:e,count:s}=await y.from("user_profiles").select("*",{count:"exact"}).order("created_at",{ascending:!1}),{data:a}=await y.from("subscriptions").select("*");let t=0,r=0;const n=(new Date).getMonth();if(a){const e={premium:0,pro:0,elite:0};a.forEach(s=>{const a="elite"===s.plan?29.99:"pro"===s.plan?19.99:9.99;t+=a;new Date(s.created_at).getMonth()===n&&(r+=a),"premium"===s.plan?e.premium++:"pro"===s.plan?e.pro++:"elite"===s.plan&&e.elite++}),o(e)}if(e){const n=e.filter(e=>e.is_active).length,c=s>0?(((null==a?void 0:a.length)||0)/s*100).toFixed(1):0;i({totalUsers:s,activeUsers:n,totalRevenue:t,monthlyRevenue:r,totalVisitors:3.5*s,conversionRate:c,growthRate:n>0?(n/s*100).toFixed(1):0}),l(e.slice(0,5))}c({sources:[{name:"Organic Search",visitors:Math.floor(1.2*s),conversions:Math.floor(.4*s)},{name:"Social Media",visitors:Math.floor(.8*s),conversions:Math.floor(.25*s)},{name:"Direct",visitors:Math.floor(.6*s),conversions:Math.floor(.2*s)},{name:"Referral",visitors:Math.floor(.4*s),conversions:Math.floor(.15*s)}],conversions:(null==a?void 0:a.length)||0,clickThroughRate:3.2})})()},[]);const m=[{title:"Total Visitors",value:Math.floor(t.totalVisitors),icon:D,gradient:"from-purple-500 to-indigo-500",change:`${t.growthRate}%`},{title:"Total Users",value:t.totalUsers,icon:O,gradient:"from-blue-500 to-cyan-500",change:`${t.conversionRate}% conversion`},{title:"Active Users",value:t.activeUsers,icon:$,gradient:"from-green-500 to-emerald-500",change:`${(t.activeUsers/t.totalUsers*100).toFixed(1)}% active`},{title:"Total Revenue",value:`$${t.totalRevenue.toFixed(2)}`,icon:z,gradient:"from-orange-500 to-red-500",change:`$${t.monthlyRevenue.toFixed(2)} this month`}],x=[{title:"Create Blog Post",description:"Write a new article",icon:Y,action:()=>null==a?void 0:a("blog"),color:"from-blue-500 to-cyan-500"},{title:"Add Coupon Code",description:"Create discount code",icon:J,action:()=>null==a?void 0:a("coupons"),color:"from-purple-500 to-pink-500"},{title:"Manage Website",description:"Update site content",icon:K,action:()=>null==a?void 0:a("website"),color:"from-green-500 to-emerald-500"},{title:"View Support Tickets",description:"Check customer issues",icon:X,action:()=>null==a?void 0:a("issues"),color:"from-orange-500 to-red-500"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:m.map((s,a)=>{const t=s.icon;return e.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*a},className:"glass-effect rounded-xl p-6 shadow-xl",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg bg-gradient-to-br ${s.gradient} flex items-center justify-center mb-4`,children:e.jsx(t,{className:"w-6 h-6 text-white"})}),e.jsx("h3",{className:"text-sm text-text-secondary mb-1",children:s.title}),e.jsx("p",{className:"text-3xl font-bold mb-2",children:s.value}),e.jsx("p",{className:"text-sm text-primary",children:s.change})]},s.title)})}),e.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Quick Actions"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:x.map((s,a)=>{const t=s.icon;return e.jsxs("button",{onClick:s.action,className:"glass-effect p-6 rounded-xl hover:scale-105 transition-all duration-200 text-left group",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg bg-gradient-to-br ${s.color} flex items-center justify-center mb-4 group-hover:scale-110 transition-transform`,children:e.jsx(t,{className:"w-6 h-6 text-white"})}),e.jsx("h4",{className:"font-semibold mb-1",children:s.title}),e.jsx("p",{className:"text-sm text-text-secondary",children:s.description})]},s.title)})})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"glass-effect rounded-xl p-6 shadow-xl",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-primary"}),"Recent Users"]}),e.jsx("div",{className:"space-y-3",children:r.length>0?r.map((s,a)=>{var t;const i=s.created_at?new Date(Date.now()-new Date(s.created_at)).getHours():0;return e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-muted/30 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xs font-bold text-primary",children:(null==(t=s.full_name)?void 0:t[0])||"U"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:s.full_name||"User"}),e.jsxs("p",{className:"text-xs text-text-secondary",children:["signed up as ",s.role]})]}),e.jsx("span",{className:"text-xs text-text-secondary whitespace-nowrap",children:i>0?`${i}h ago`:"just now"})]},a)}):e.jsx("p",{className:"text-text-secondary text-sm",children:"No recent activity"})})]}),e.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"glass-effect rounded-xl p-6 shadow-xl",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-primary"}),"Subscription Distribution"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-text-secondary",children:"Premium Plan"}),e.jsxs("span",{className:"text-sm font-semibold text-green-400",children:[d.premium," subscribers"]})]}),e.jsx("div",{className:"w-full bg-muted/30 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-400 h-2 rounded-full",style:{width:d.premium/Math.max(d.premium+d.pro+d.elite,1)*100+"%"}})}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"$9.99/month"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-text-secondary",children:"Pro Plan"}),e.jsxs("span",{className:"text-sm font-semibold text-blue-400",children:[d.pro," subscribers"]})]}),e.jsx("div",{className:"w-full bg-muted/30 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-400 h-2 rounded-full",style:{width:d.pro/Math.max(d.premium+d.pro+d.elite,1)*100+"%"}})}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"$19.99/month"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-text-secondary",children:"Elite Plan"}),e.jsxs("span",{className:"text-sm font-semibold text-purple-400",children:[d.elite," subscribers"]})]}),e.jsx("div",{className:"w-full bg-muted/30 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-indigo-400 h-2 rounded-full",style:{width:d.elite/Math.max(d.premium+d.pro+d.elite,1)*100+"%"}})}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"$29.99/month"})]}),e.jsx("div",{className:"pt-4 border-t border-border/50",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-semibold",children:"Total MRR"}),e.jsxs("span",{className:"text-lg font-bold text-primary",children:["$",t.monthlyRevenue.toFixed(2)]})]})})]})]})]}),e.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"glass-effect rounded-xl p-6 shadow-xl",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(W,{className:"w-5 h-5 text-primary"}),"Marketing Analysis"]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-text-secondary mb-3",children:"Traffic Sources"}),e.jsx("div",{className:"space-y-3",children:n.sources.map((s,a)=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsxs("span",{className:"text-text-secondary",children:[s.visitors," visitors"]})]}),e.jsx("div",{className:"w-full bg-muted/30 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-primary to-green-400 h-2 rounded-full",style:{width:s.conversions/s.visitors*100+"%"}})}),e.jsxs("p",{className:"text-xs text-text-secondary",children:[s.conversions," conversions (",(s.conversions/s.visitors*100).toFixed(1),"%)"]})]},a))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-text-secondary mb-3",children:"Key Metrics"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-text-secondary",children:"Conversion Rate"}),e.jsx(H,{className:"w-4 h-4 text-primary"})]}),e.jsxs("p",{className:"text-2xl font-bold",children:[t.conversionRate,"%"]}),e.jsx("p",{className:"text-xs text-green-400 mt-1",children:"+2.3% from last week"})]}),e.jsxs("div",{className:"p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-text-secondary",children:"Total Conversions"}),e.jsx(W,{className:"w-4 h-4 text-primary"})]}),e.jsx("p",{className:"text-2xl font-bold",children:n.conversions}),e.jsx("p",{className:"text-xs text-green-400 mt-1",children:"Active subscriptions"})]}),e.jsxs("div",{className:"p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-text-secondary",children:"Avg. Click-Through"}),e.jsx(Q,{className:"w-4 h-4 text-primary"})]}),e.jsxs("p",{className:"text-2xl font-bold",children:[n.clickThroughRate,"%"]}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Industry avg: 2.5%"})]})]})]})]})]})]})},ga=({user:s})=>{const[a,t]=g.useState(""),[i,r]=g.useState([]),[l,n]=g.useState([]),[c,d]=g.useState(""),[o,m]=g.useState({dateFrom:"",dateTo:"",search:""}),[x,h]=g.useState([]),[u,p]=g.useState(!0),[j,f]=g.useState(!1),v=g.useRef(null);g.useEffect(()=>{const e=e=>{v.current&&!v.current.contains(e.target)&&f(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const _=g.useCallback(async()=>{p(!0);try{const{data:s,error:a}=await y.rpc("get_all_tables");if(a||!s){const s=["user_profiles","subscriptions","pricing_plans","features","site_content","blog_posts","ai_chat_messages","health_readings","health_devices","payment_transactions","workouts","exercises","meals","nutrition_plans"],a=[];for(const t of s)try{const{error:e}=await y.from(t).select("*").limit(0);e||a.push(t)}catch(e){}h(a),a.length>0&&t(a[0])}else{const e=s.map(e=>e.tablename||e.table_name).filter(Boolean);h(e),e.length>0&&t(e[0])}}catch(s){const e=["user_profiles","subscriptions"];h(e),t(e[0])}p(!1)},[]),w=g.useCallback(async()=>{if(!a)return;let e=y.from(a).select("*");const{data:s,error:t}=await e;t?(N({title:"Error fetching data",description:t.message,variant:"destructive"}),r([])):r(s)},[a]);g.useEffect(()=>{_();const e=localStorage.getItem("savedQueries");e&&n(JSON.parse(e))},[_]),g.useEffect(()=>{a&&w()},[a,w]);const C=e=>{if(!e||!e.length)return"";const s=Object.keys(e[0]),a=e.map(e=>s.map(s=>JSON.stringify(e[s]||"")).join(","));return[s.join(","),...a].join("\n")};return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs(V.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"glass-effect rounded-xl p-6 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5 text-purple-400"}),"Saved Queries"]}),e.jsx("div",{className:"space-y-2",children:0===l.length?e.jsx("p",{className:"text-sm text-purple-300",children:"No saved queries yet"}):l.map(s=>e.jsxs("div",{className:"p-3 bg-white/5 rounded-lg border border-white/10 hover:bg-white/10 transition-all",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("button",{onClick:()=>(e=>{t(e.table),m(e.filters),d(e.query||""),N({title:"Query loaded! 📂",description:`Loaded "${e.name}"`})})(s),className:"text-sm font-semibold text-white hover:text-purple-300 text-left flex-1",children:s.name}),e.jsx("button",{onClick:()=>(e=>{const s=l.filter(s=>s.id!==e);n(s),localStorage.setItem("savedQueries",JSON.stringify(s)),N({title:"Query deleted",description:"Saved query has been removed"})})(s.id),className:"text-red-400 hover:text-red-300",children:e.jsx(ee,{className:"w-4 h-4"})})]}),e.jsxs("p",{className:"text-xs text-purple-400",children:["Table: ",s.table]})]},s.id))})]}),e.jsxs("div",{className:"lg:col-span-3 space-y-6",children:[e.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"glass-effect rounded-xl p-6 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-purple-400"}),"Query Builder"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-purple-200 mb-2",children:"Select Table"}),e.jsxs("div",{className:"relative",ref:v,children:[e.jsxs("button",{onClick:()=>f(!j),disabled:u,className:"w-full px-4 py-3 bg-muted border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary flex items-center justify-between hover:bg-muted/80 transition-colors",children:[e.jsx("span",{className:"truncate",children:u?"Loading tables...":a||"Select a table"}),e.jsx(ae,{className:"w-4 h-4 transition-transform "+(j?"rotate-180":"")})]}),e.jsx(te,{children:j&&x.length>0&&e.jsx(V.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.15},className:"absolute z-50 w-full mt-2 bg-card border border-border rounded-lg shadow-xl max-h-64 overflow-y-auto",children:x.map(s=>e.jsxs("button",{onClick:()=>{t(s),f(!1)},className:"w-full px-4 py-3 text-left hover:bg-primary/10 transition-colors flex items-center justify-between group "+(a===s?"bg-primary/20 text-primary":"text-foreground"),children:[e.jsx("span",{className:"truncate",children:s}),a===s&&e.jsx(ie,{className:"w-4 h-4 text-primary flex-shrink-0"})]},s))})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-purple-200 mb-2",children:"Date From"}),e.jsx("input",{type:"date",value:o.dateFrom,onChange:e=>m({...o,dateFrom:e.target.value}),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-purple-200 mb-2",children:"Date To"}),e.jsx("input",{type:"date",value:o.dateTo,onChange:e=>m({...o,dateTo:e.target.value}),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-purple-200 mb-2",children:"Search"}),e.jsx("input",{type:"text",value:o.search,onChange:e=>m({...o,search:e.target.value}),placeholder:"Search...",className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500"})]})]}),"super_admin"===(null==s?void 0:s.role)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-purple-200 mb-2",children:"Custom SQL Query (Super Admin Only)"}),e.jsx("textarea",{value:c,onChange:e=>d(e.target.value),placeholder:"SELECT * FROM user_profiles WHERE...",className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500 font-mono text-sm",rows:4})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(b,{onClick:async()=>{if("super_admin"!==(null==s?void 0:s.role)&&c.trim()){const e=["DROP","DELETE","ALTER","TRUNCATE","UPDATE"],s=c.toUpperCase();if(e.some(e=>s.includes(e)))return void N({title:"Permission Denied",description:"Your role cannot run destructive/update queries.",variant:"destructive"})}if(c.trim())try{const{data:e,error:s}=await y.rpc("execute_sql",{sql:c});s?N({title:"Query Error",description:s.message,variant:"destructive"}):(r(e),N({title:"Custom query ran!",description:`Found ${e.length} results.`}))}catch(l){N({title:"RPC Error",description:"Ensure execute_sql function exists and is accessible.",variant:"destructive"})}else await w(),N({title:"Query ran!",description:`Found ${i.length} results.`});const e={id:Date.now().toString(),userId:s.id,action:c||`SELECT * FROM ${a}`,timestamp:(new Date).toISOString()},t=JSON.parse(localStorage.getItem("activityLogs")||"[]");t.push(e),localStorage.setItem("activityLogs",JSON.stringify(t))},className:"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Run Query"]}),e.jsxs(b,{onClick:()=>{const e=prompt("Enter a name for this query:");if(!e)return;const s={id:Date.now().toString(),name:e,table:a,filters:{...o},query:c,createdAt:(new Date).toISOString()},t=[...l,s];n(t),localStorage.setItem("savedQueries",JSON.stringify(t)),N({title:"Query saved! 💾",description:`"${e}" has been saved`})},className:"bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Save Query"]}),e.jsxs(b,{onClick:()=>{const e=C(i),s=new Blob([e],{type:"text/csv"}),t=window.URL.createObjectURL(s),r=document.createElement("a");r.href=t,r.download=`${a}_export_${Date.now()}.csv`,r.click(),N({title:"Export successful! 📥",description:"Data has been downloaded as CSV"})},disabled:!i||0===i.length,className:"bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Export CSV"]})]})]})]}),e.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"glass-effect rounded-xl p-6 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4",children:["Query Results (",(null==i?void 0:i.length)||0,")"]}),e.jsx("div",{className:"overflow-x-auto max-h-96",children:i&&0!==i.length?e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-white/10",children:Object.keys(i[0]).map(s=>e.jsx("th",{className:"text-left p-3 text-purple-300 font-semibold sticky top-0 bg-indigo-900/50 backdrop-blur-sm",children:s},s))})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:i.map((s,a)=>e.jsx("tr",{className:"hover:bg-white/5",children:Object.keys(i[0]).map(a=>e.jsx("td",{className:"p-3 text-white truncate max-w-xs",children:"object"==typeof s[a]?JSON.stringify(s[a]):String(s[a])},a))},a))})]}):e.jsx("p",{className:"text-purple-300 text-center py-8",children:"No results to display. Run a query to see data."})})]})]})]})},fa=({user:s})=>{const[a,t]=g.useState({totalUsers:0,activeUsers:0,totalWorkouts:0,totalMeals:0}),[i,r]=g.useState([]);g.useEffect(()=>{(async()=>{const{data:e,count:s,error:a}=await y.from("user_profiles").select("*",{count:"exact"});e&&t(a=>({...a,totalUsers:s,activeUsers:e.filter(e=>e.is_active).length}))})(),(async()=>{const e=JSON.parse(localStorage.getItem("activityLogs")||"[]");r(e)})()},[]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"glass-effect rounded-xl p-6 shadow-xl",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-purple-500 to-indigo-500 flex items-center justify-center mb-4",children:e.jsx(O,{className:"w-6 h-6 text-white"})}),e.jsx("h3",{className:"text-sm text-text-secondary mb-1",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold",children:a.totalUsers})]}),e.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"glass-effect rounded-xl p-6 shadow-xl",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-green-500 to-emerald-500 flex items-center justify-center mb-4",children:e.jsx($,{className:"w-6 h-6 text-white"})}),e.jsx("h3",{className:"text-sm text-text-secondary mb-1",children:"Active Users"}),e.jsx("p",{className:"text-3xl font-bold",children:a.activeUsers})]}),e.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"glass-effect rounded-xl p-6 shadow-xl",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-orange-500 to-red-500 flex items-center justify-center mb-4",children:e.jsx(Q,{className:"w-6 h-6 text-white"})}),e.jsx("h3",{className:"text-sm text-text-secondary mb-1",children:"Total Workouts"}),e.jsx("p",{className:"text-3xl font-bold",children:a.totalWorkouts})]}),e.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"glass-effect rounded-xl p-6 shadow-xl",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center mb-4",children:e.jsx(G,{className:"w-6 h-6 text-white"})}),e.jsx("h3",{className:"text-sm text-text-secondary mb-1",children:"Total Meals Logged"}),e.jsx("p",{className:"text-3xl font-bold",children:a.totalMeals})]})]}),e.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"glass-effect rounded-xl p-6 shadow-xl",children:[e.jsx("h3",{className:"text-2xl font-bold mb-6",children:"User Growth"}),e.jsx("div",{className:"h-64 flex items-end justify-between gap-4",children:[{month:"Jan",users:12},{month:"Feb",users:19},{month:"Mar",users:25},{month:"Apr",users:32},{month:"May",users:41},{month:"Jun",users:48}].map((s,a)=>e.jsxs(V.div,{initial:{height:0},animate:{height:s.users/50*100+"%"},transition:{duration:.5,delay:.5+.1*a},className:"flex-1 bg-gradient-to-t from-purple-500 to-indigo-500 rounded-t-lg relative group",children:[e.jsxs("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity bg-white/10 px-2 py-1 rounded text-xs whitespace-nowrap",children:[s.users," users"]}),e.jsx("div",{className:"absolute -bottom-6 left-1/2 -translate-x-1/2 text-xs text-text-secondary",children:s.month})]},s.month))})]}),e.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"glass-effect rounded-xl p-6 shadow-xl",children:[e.jsx("h3",{className:"text-2xl font-bold mb-4",children:"Recent Activity Logs"}),e.jsxs("div",{className:"space-y-2",children:[i.slice(-5).reverse().map(s=>e.jsxs("div",{className:"p-3 bg-white/5 rounded-lg border border-white/10",children:[e.jsx("p",{className:"text-sm text-white font-mono",children:s.action}),e.jsxs("p",{className:"text-xs text-purple-400 mt-1",children:[new Date(s.timestamp).toLocaleString()," - User ID: ",s.userId]})]},s.id)),0===i.length&&e.jsx("p",{className:"text-text-secondary text-center py-4",children:"No activity logs yet"})]})]})]})},va=[...["AI Personalized Plan","Basic Progress Tracking","Community Access","Smart Meal Logging","Workout Library & Planner","Adaptive Goal Setting","Lifestyle Habit Coaching","Recipe & Meal Suggestions"],...["All Base Features","Macronutrient Tracking","Wearable Device Sync","Custom Workout Builder","Advanced Analytics","Weekly & Monthly Reports","Priority Nutritionist Chat","Sleep Cycle Analysis","Grocery List Generator"],...["All Premium Features","Real-time Form Feedback","Biomarker Integration","1-on-1 Video Coaching (2/month)","Exclusive Challenges","Custom Meal Plans","Performance Optimization","Advanced Body Composition Analysis"],...["All Ultimate Features","Photo Food Recognition","Priority Support (24/7)","Doctor Consultations (2/month)","Unlimited Video Coaching","Personalized Supplement Plan","VIP Community Access","Concierge Service"]].filter((e,s,a)=>a.indexOf(e)===s),ya=({open:s,onOpenChange:a,onPlanAdded:t,editPlan:i=null})=>{const[r,l]=g.useState({name:"",description:"",price_monthly:"",price_yearly:"",is_popular:!1,is_active:!0,stripe_price_id:"",stripe_product_id:""}),[n,c]=g.useState([{type:"predefined",value:""}]),[d,o]=g.useState(!1);g.useEffect(()=>{var e;if(i){l({name:i.name||"",description:i.description||"",price_monthly:i.price_monthly||"",price_yearly:i.price_yearly||"",is_popular:i.is_popular||!1,is_active:!1!==i.is_active,stripe_price_id:i.stripe_price_id||"",stripe_product_id:i.stripe_product_id||""});const s=(null==(e=i.features)?void 0:e.length)>0?i.features.map(e=>({type:"predefined",value:e})):[{type:"predefined",value:""}];c(s)}else l({name:"",description:"",price_monthly:"",price_yearly:"",is_popular:!1,is_active:!0,stripe_price_id:"",stripe_product_id:""}),c([{type:"predefined",value:""}])},[i,s]);const m=e=>{const{name:s,value:a}=e.target;l(e=>({...e,[s]:a}))},x=(e,s)=>{l(a=>({...a,[e]:s}))},h=(e,s)=>{const a=[...n];a[e]={...a[e],value:s},c(a)},u=(e="predefined")=>{c([...n,{type:e,value:""}])};return e.jsx(cs,{open:s,onOpenChange:a,children:e.jsxs(ds,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(os,{children:[e.jsx(ms,{children:i?"Edit Plan":"Add New Subscription Plan"}),e.jsx(xs,{children:i?"Update the subscription plan details below.":"Create a new subscription plan for your customers."})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),o(!0);try{const e=n.map(e=>e.value).filter(e=>""!==e.trim());if(!r.name||!r.description||!r.price_monthly)return N({title:"Validation Error",description:"Please fill in all required fields (Name, Description, Monthly Price)",variant:"destructive"}),void o(!1);if(0===e.length)return N({title:"Validation Error",description:"Please add at least one feature",variant:"destructive"}),void o(!1);const s={name:r.name,description:r.description,price_monthly:parseFloat(r.price_monthly),price_yearly:r.price_yearly?parseFloat(r.price_yearly):null,features:e,is_popular:r.is_popular,is_active:r.is_active,stripe_price_id:r.stripe_price_id||null,stripe_product_id:r.stripe_product_id||null};let l;if(l=i?await y.from("subscription_plans").update(s).eq("id",i.id).select().single():await y.from("subscription_plans").insert([s]).select().single(),l.error)throw l.error;N({title:i?"Plan Updated!":"Plan Created!",description:`${r.name} has been ${i?"updated":"created"} successfully.`}),t(),a(!1)}catch(s){N({title:"Error",description:s.message||"Failed to save plan",variant:"destructive"})}finally{o(!1)}},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(js,{htmlFor:"name",children:"Plan Name *"}),e.jsx(ps,{id:"name",name:"name",value:r.name,onChange:m,placeholder:"e.g., Premium, Ultimate, Elite",required:!0})]}),e.jsxs("div",{children:[e.jsx(js,{htmlFor:"description",children:"Description *"}),e.jsx(_,{id:"description",name:"description",value:r.description,onChange:m,placeholder:"Brief description of the plan",rows:3,required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(js,{htmlFor:"price_monthly",children:"Monthly Price ($) *"}),e.jsx(ps,{id:"price_monthly",name:"price_monthly",type:"number",step:"0.01",min:"0",value:r.price_monthly,onChange:m,placeholder:"9.99",required:!0})]}),e.jsxs("div",{children:[e.jsx(js,{htmlFor:"price_yearly",children:"Yearly Price ($)"}),e.jsx(ps,{id:"price_yearly",name:"price_yearly",type:"number",step:"0.01",min:"0",value:r.price_yearly,onChange:m,placeholder:"99.00"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(js,{children:"Features *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{type:"button",onClick:()=>u("predefined"),size:"sm",variant:"outline",children:[e.jsx(ne,{className:"w-4 h-4 mr-1"}),"Add from List"]}),e.jsxs(b,{type:"button",onClick:()=>u("custom"),size:"sm",variant:"outline",children:[e.jsx(ne,{className:"w-4 h-4 mr-1"}),"Custom Feature"]})]})]}),e.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto pr-2",children:n.map((s,a)=>e.jsxs("div",{className:"flex gap-2 items-start p-3 border border-green-500/30 rounded-lg bg-background/50",children:[e.jsxs("div",{className:"flex-grow space-y-2",children:["predefined"===s.type?e.jsxs(fs,{value:s.value,onValueChange:e=>h(a,e),children:[e.jsx(vs,{className:"w-full",children:e.jsx(ys,{placeholder:"Select a feature..."})}),e.jsxs(Ns,{className:"max-h-[300px]",children:[e.jsx(bs,{value:"All Base Features",children:"All Base Features"}),e.jsx(bs,{value:"All Premium Features",children:"All Premium Features"}),e.jsx(bs,{value:"All Ultimate Features",children:"All Ultimate Features"}),va.map(s=>e.jsx(bs,{value:s,children:s},s))]})]}):e.jsx(ps,{value:s.value,onChange:e=>h(a,e.target.value),placeholder:"Enter custom feature...",className:"w-full"}),e.jsx(b,{type:"button",onClick:()=>((e,s)=>{const a=[...n];a[e]={type:s,value:""},c(a)})(a,"predefined"===s.type?"custom":"predefined"),size:"sm",variant:"ghost",className:"text-xs h-6 px-2",children:"predefined"===s.type?"Switch to Custom":"Switch to List"})]}),n.length>1&&e.jsx(b,{type:"button",onClick:()=>(e=>{n.length>1&&c(n.filter((s,a)=>a!==e))})(a),variant:"ghost",size:"icon",className:"mt-1 flex-shrink-0",children:e.jsx(ce,{className:"w-4 h-4"})})]},a))})]}),e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Stripe Integration (Optional)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(js,{htmlFor:"stripe_price_id",children:"Stripe Price ID"}),e.jsx(ps,{id:"stripe_price_id",name:"stripe_price_id",value:r.stripe_price_id,onChange:m,placeholder:"price_xxxxx"})]}),e.jsxs("div",{children:[e.jsx(js,{htmlFor:"stripe_product_id",children:"Stripe Product ID"}),e.jsx(ps,{id:"stripe_product_id",name:"stripe_product_id",value:r.stripe_product_id,onChange:m,placeholder:"prod_xxxxx"})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(gs,{id:"is_popular",checked:r.is_popular,onCheckedChange:e=>x("is_popular",e)}),e.jsxs("div",{children:[e.jsx(js,{htmlFor:"is_popular",children:"Mark as Popular"}),e.jsx("p",{className:"text-sm text-text-secondary",children:'Display a "Most Popular" badge'})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(gs,{id:"is_active",checked:r.is_active,onCheckedChange:e=>x("is_active",e)}),e.jsxs("div",{children:[e.jsx(js,{htmlFor:"is_active",children:"Active"}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Make this plan available to customers"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(b,{type:"button",variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsx(b,{type:"submit",disabled:d,children:d?"Saving...":i?"Update Plan":"Create Plan"})]})]})]})})},Na=()=>{const[s,a]=g.useState([]),[t,i]=g.useState(!0),[r,l]=g.useState(!1),[n,c]=g.useState(null),[d,o]=g.useState({totalActive:0,newThisMonth:0,canceledThisMonth:0,upgrades:0,downgrades:0,trialConversions:0,paymentFailures:0});g.useEffect(()=>{(async()=>{i(!0);const{data:e,error:s}=await y.from("subscription_plans").select("*").order("price_monthly",{ascending:!0});s?N({title:"Error fetching plans",description:s.message,variant:"destructive"}):a(e),i(!1)})(),(async()=>{const e=new Date,s=new Date(e.getFullYear(),e.getMonth(),1),{data:a}=await y.from("user_subscriptions").select("*").eq("status","active"),{data:t}=await y.from("user_subscriptions").select("*").gte("created_at",s.toISOString()),{data:i}=await y.from("user_subscriptions").select("*").eq("status","canceled").gte("canceled_at",s.toISOString()),{data:r}=await y.from("payment_transactions").select("*").eq("status","failed").gte("created_at",s.toISOString());o({totalActive:(null==a?void 0:a.length)||0,newThisMonth:(null==t?void 0:t.length)||0,canceledThisMonth:(null==i?void 0:i.length)||0,upgrades:0,downgrades:0,trialConversions:0,paymentFailures:(null==r?void 0:r.length)||0})})()},[]);const m={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},x={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}};return e.jsxs(V.div,{variants:m,initial:"hidden",animate:"visible",className:"space-y-6",children:[e.jsxs(V.div,{variants:x,className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Subscription Plans"}),e.jsxs(b,{onClick:()=>{c(null),l(!0)},children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Add New Plan"]})]}),e.jsxs(V.div,{variants:x,className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(M,{className:"glass-effect",children:e.jsx(I,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Active Subscriptions"}),e.jsx("p",{className:"text-3xl font-bold",children:d.totalActive})]}),e.jsx(O,{className:"w-8 h-8 text-primary"})]})})}),e.jsx(M,{className:"glass-effect",children:e.jsx(I,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"New This Month"}),e.jsx("p",{className:"text-3xl font-bold text-green-400",children:d.newThisMonth})]}),e.jsx(Q,{className:"w-8 h-8 text-green-400"})]})})}),e.jsx(M,{className:"glass-effect",children:e.jsx(I,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Canceled This Month"}),e.jsx("p",{className:"text-3xl font-bold text-red-400",children:d.canceledThisMonth})]}),e.jsx(de,{className:"w-8 h-8 text-red-400"})]})})}),e.jsx(M,{className:"glass-effect",children:e.jsx(I,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Payment Failures"}),e.jsx("p",{className:"text-3xl font-bold text-orange-400",children:d.paymentFailures})]}),e.jsx(oe,{className:"w-8 h-8 text-orange-400"})]})})})]}),t?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[...Array(4)].map((s,a)=>e.jsxs(M,{className:"glass-effect animate-pulse",children:[e.jsx(q,{children:e.jsx("div",{className:"h-8 bg-white/10 rounded w-3/4"})}),e.jsxs(I,{className:"space-y-4",children:[e.jsx("div",{className:"h-6 bg-white/10 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-white/10 rounded w-full"}),e.jsx("div",{className:"h-4 bg-white/10 rounded w-3/4"}),e.jsx("div",{className:"h-10 bg-white/10 rounded w-1/3 mt-4"})]})]},a))}):e.jsx(V.div,{variants:m,className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:s.map(s=>{var a,t;return e.jsx(V.div,{variants:x,children:e.jsxs(M,{className:"glass-effect h-full flex flex-col "+(s.is_popular?"border-purple-500 border-2":""),children:[s.is_popular&&e.jsx("div",{className:"text-center py-1 bg-purple-500 text-white font-bold text-sm",children:"Most Popular"}),e.jsx(q,{children:e.jsxs(U,{className:"flex items-center gap-3",children:[(t=s.name,t.toLowerCase().includes("pro")?e.jsx(me,{className:"w-6 h-6 text-yellow-400"}):t.toLowerCase().includes("enterprise")?e.jsx(xe,{className:"w-6 h-6 text-purple-400"}):e.jsx(he,{className:"w-6 h-6 text-green-400"})),e.jsx("span",{className:"text-2xl",children:s.name})]})}),e.jsxs(I,{className:"flex-grow flex flex-col",children:[e.jsxs("p",{className:"text-4xl font-bold mb-2",children:["$",s.price_monthly,e.jsx("span",{className:"text-lg font-normal text-text-secondary",children:"/month"})]}),e.jsx("p",{className:"text-text-secondary mb-4",children:s.description}),e.jsx("ul",{className:"space-y-2 mb-6 flex-grow",children:null==(a=s.features)?void 0:a.map((s,a)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(me,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{children:s})]},a))}),e.jsx(b,{onClick:()=>(e=>{c(e),l(!0)})(s),variant:"secondary",children:"Edit Plan"})]})]})},s.id)})}),e.jsx(ya,{open:r,onOpenChange:l,onPlanAdded:async()=>{const{data:e,error:s}=await y.from("subscription_plans").select("*").order("price_monthly",{ascending:!0});s?N({title:"Error fetching plans",description:s.message,variant:"destructive"}):a(e)},editPlan:n})]})},ba=m,_a=x;g.forwardRef(({className:a,inset:t,children:i,...r},l)=>e.jsxs(s,{ref:l,className:w("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",a),...r,children:[i,e.jsx(ue,{className:"ml-auto h-4 w-4"})]})).displayName=s.displayName;g.forwardRef(({className:s,...t},i)=>e.jsx(a,{ref:i,className:w("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...t})).displayName=a.displayName;const wa=g.forwardRef(({className:s,sideOffset:a=4,...r},l)=>e.jsx(t,{children:e.jsx(i,{ref:l,sideOffset:a,className:w("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...r})}));wa.displayName=i.displayName;const Ca=g.forwardRef(({className:s,inset:a,...t},i)=>e.jsx(r,{ref:i,className:w("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a&&"pl-8",s),...t}));Ca.displayName=r.displayName;g.forwardRef(({className:s,children:a,checked:t,...i},r)=>e.jsxs(l,{ref:r,className:w("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:t,...i,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(n,{children:e.jsx(ie,{className:"h-4 w-4"})})}),a]})).displayName=l.displayName;g.forwardRef(({className:s,children:a,...t},i)=>e.jsxs(c,{ref:i,className:w("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(n,{children:e.jsx(pe,{className:"h-2 w-2 fill-current"})})}),a]})).displayName=c.displayName;const ka=g.forwardRef(({className:s,inset:a,...t},i)=>e.jsx(d,{ref:i,className:w("px-2 py-1.5 text-sm font-semibold",a&&"pl-8",s),...t}));ka.displayName=d.displayName;const Sa=g.forwardRef(({className:s,...a},t)=>e.jsx(o,{ref:t,className:w("-mx-1 my-1 h-px bg-muted",s),...a}));Sa.displayName=o.displayName;const Aa=({isOpen:s,onClose:a,user:t,onOfferCreated:i})=>{var r;const[l,n]=g.useState(!1),[c,d]=g.useState(null),[o,m]=g.useState({customPrice:"",discountPercentage:"",discountAmount:"",couponCode:"",subscriptionType:"premium",billingCycle:"monthly",trialDays:"0",features:{aiPersonalizedPlan:!0,basicProgressTracking:!0,communityAccess:!0,smartMealLogging:!0,workoutLibrary:!0,adaptiveGoalSetting:!0,lifestyleHabitCoaching:!0,recipeMealSuggestions:!0,macronutrientTracking:!1,wearableDeviceSync:!1,customWorkoutBuilder:!1,advancedAnalytics:!1,weeklyMonthlyReports:!1,priorityNutritionistChat:!1,sleepCycleAnalysis:!1,groceryListGenerator:!1,realtimeFormFeedback:!1,biomarkerIntegration:!1,oneOnOneVideoCoaching:!1,exclusiveChallenges:!1,photoFoodRecognition:!1,prioritySupport:!1,doctorConsultations:!1},featureLimits:{aiMessages:"100",workouts:"50",videoCoachingSessions:"0",doctorConsultations:"0"},hasPrioritySupport:!1,hasBetaAccess:!1,removeBranding:!1,notes:"",internalNotes:"",offerEndDate:"",paymentPlanType:"full",numberOfPayments:"2",paymentFrequency:"monthly"});g.useEffect(()=>{s&&t&&x()},[s,t]);const x=async()=>{const{data:e,error:s}=await y.from("custom_offers").select("*").eq("user_id",t.id).eq("is_active",!0).single();e&&(d(e),m({customPrice:e.custom_price||"",discountPercentage:e.discount_percentage||"",discountAmount:e.discount_amount||"",couponCode:e.coupon_code||"",subscriptionType:e.subscription_type||"premium",billingCycle:e.billing_cycle||"monthly",trialDays:e.trial_days||"0",features:e.features||o.features,featureLimits:e.feature_limits||o.featureLimits,hasPrioritySupport:e.has_priority_support||!1,hasBetaAccess:e.has_beta_access||!1,removeBranding:e.remove_branding||!1,notes:e.notes||"",internalNotes:e.internal_notes||"",offerEndDate:e.offer_end_date?new Date(e.offer_end_date).toISOString().split("T")[0]:"",paymentPlanType:e.payment_plan_type||"full",numberOfPayments:e.number_of_payments||"2",paymentFrequency:e.payment_frequency||"monthly"}))};return e.jsx(cs,{open:s,onOpenChange:a,children:e.jsxs(ds,{className:"glass-effect max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(os,{children:e.jsx(ms,{children:(null==t?void 0:t.bulk)?`Create Bulk Offer for ${null==(r=t.users)?void 0:r.length} Customers`:`${c?"Edit":"Create"} Custom Offer for ${null==t?void 0:t.full_name}`})}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),n(!0);const s={custom_price:o.customPrice?parseFloat(o.customPrice):null,discount_percentage:o.discountPercentage?parseInt(o.discountPercentage):null,discount_amount:o.discountAmount?parseFloat(o.discountAmount):null,coupon_code:o.couponCode||null,subscription_type:o.subscriptionType,billing_cycle:o.billingCycle,trial_days:parseInt(o.trialDays),features:o.features,feature_limits:{aiMessages:parseInt(o.featureLimits.aiMessages),workouts:parseInt(o.featureLimits.workouts),videoCoachingSessions:parseInt(o.featureLimits.videoCoachingSessions),doctorConsultations:parseInt(o.featureLimits.doctorConsultations)},has_priority_support:o.hasPrioritySupport,has_beta_access:o.hasBetaAccess,remove_branding:o.removeBranding,notes:o.notes,internal_notes:o.internalNotes,offer_end_date:o.offerEndDate||null,payment_plan_type:o.paymentPlanType,number_of_payments:"full"!==o.paymentPlanType?parseInt(o.numberOfPayments):null,payment_frequency:"full"!==o.paymentPlanType?o.paymentFrequency:null,is_active:!0};let r;if((null==t?void 0:t.bulk)&&(null==t?void 0:t.users)){const e=t.users.map(e=>({...s,user_id:e.id}));r=(await y.from("custom_offers").insert(e)).error,r||N({title:`Bulk offer created for ${t.users.length} customers!`})}else{const e={...s,user_id:t.id};if(c){r=(await y.from("custom_offers").update(e).eq("id",c.id)).error}else{r=(await y.from("custom_offers").insert(e)).error}r||N({title:"Custom offer saved successfully!"})}r?N({title:"Error saving offer",description:r.message,variant:"destructive"}):(i&&i(),a()),n(!1)},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-primary"}),"Pricing"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(js,{children:"Custom Price ($)"}),e.jsx(ps,{type:"number",step:"0.01",value:o.customPrice,onChange:e=>m({...o,customPrice:e.target.value}),placeholder:"29.99",className:"glass-effect"})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Discount (%)"}),e.jsx(ps,{type:"number",value:o.discountPercentage,onChange:e=>m({...o,discountPercentage:e.target.value}),placeholder:"20",className:"glass-effect"})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Discount Amount ($)"}),e.jsx(ps,{type:"number",step:"0.01",value:o.discountAmount,onChange:e=>m({...o,discountAmount:e.target.value}),placeholder:"5.00",className:"glass-effect"})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Coupon Code (Optional)"}),e.jsx(ps,{type:"text",value:o.couponCode,onChange:e=>m({...o,couponCode:e.target.value.toUpperCase()}),placeholder:"SUMMER2024",className:"glass-effect"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-primary"}),"Subscription Details"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(js,{children:"Subscription Type"}),e.jsxs(fs,{value:o.subscriptionType,onValueChange:e=>m({...o,subscriptionType:e}),children:[e.jsx(vs,{className:"glass-effect",children:e.jsx(ys,{})}),e.jsxs(Ns,{className:"glass-effect",children:[e.jsx(bs,{value:"premium",children:"Premium"}),e.jsx(bs,{value:"pro",children:"Pro"}),e.jsx(bs,{value:"elite",children:"Elite"}),e.jsx(bs,{value:"custom",children:"Custom"})]})]})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Billing Cycle"}),e.jsxs(fs,{value:o.billingCycle,onValueChange:e=>m({...o,billingCycle:e}),children:[e.jsx(vs,{className:"glass-effect",children:e.jsx(ys,{})}),e.jsxs(Ns,{className:"glass-effect",children:[e.jsx(bs,{value:"monthly",children:"Monthly"}),e.jsx(bs,{value:"quarterly",children:"Quarterly"}),e.jsx(bs,{value:"annual",children:"Annual"}),e.jsx(bs,{value:"lifetime",children:"Lifetime"})]})]})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Trial Days"}),e.jsx(ps,{type:"number",value:o.trialDays,onChange:e=>m({...o,trialDays:e.target.value}),className:"glass-effect"})]})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Offer End Date (Optional)"}),e.jsx(ps,{type:"date",value:o.offerEndDate,onChange:e=>m({...o,offerEndDate:e.target.value}),className:"glass-effect"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5 text-primary"}),"Features & Limits"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(js,{className:"text-base font-semibold text-primary",children:"Base Features"}),e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.features.aiPersonalizedPlan,onCheckedChange:e=>m({...o,features:{...o.features,aiPersonalizedPlan:e}})}),e.jsx(js,{className:"cursor-pointer",children:"AI Personalized Plan"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.features.basicProgressTracking,onCheckedChange:e=>m({...o,features:{...o.features,basicProgressTracking:e}})}),e.jsx(js,{className:"cursor-pointer",children:"Basic Progress Tracking"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.features.communityAccess,onCheckedChange:e=>m({...o,features:{...o.features,communityAccess:e}})}),e.jsx(js,{className:"cursor-pointer",children:"Community Access"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.features.smartMealLogging,onCheckedChange:e=>m({...o,features:{...o.features,smartMealLogging:e}})}),e.jsx(js,{className:"cursor-pointer",children:"Smart Meal Logging"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.features.workoutLibrary,onCheckedChange:e=>m({...o,features:{...o.features,workoutLibrary:e}})}),e.jsx(js,{className:"cursor-pointer",children:"Workout Library & Planner"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.features.adaptiveGoalSetting,onCheckedChange:e=>m({...o,features:{...o.features,adaptiveGoalSetting:e}})}),e.jsx(js,{className:"cursor-pointer",children:"Adaptive Goal Setting"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.features.lifestyleHabitCoaching,onCheckedChange:e=>m({...o,features:{...o.features,lifestyleHabitCoaching:e}})}),e.jsx(js,{className:"cursor-pointer",children:"Lifestyle Habit Coaching"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.features.recipeMealSuggestions,onCheckedChange:e=>m({...o,features:{...o.features,recipeMealSuggestions:e}})}),e.jsx(js,{className:"cursor-pointer",children:"Recipe & Meal Suggestions"})]})]})]}),e.jsxs("div",{children:[e.jsx(js,{className:"text-base font-semibold text-green-400",children:"Premium Features"}),e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.features.macronutrientTracking,onCheckedChange:e=>m({...o,features:{...o.features,macronutrientTracking:e}})}),e.jsx(js,{className:"cursor-pointer",children:"Macronutrient Tracking"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.features.wearableDeviceSync,onCheckedChange:e=>m({...o,features:{...o.features,wearableDeviceSync:e}})}),e.jsx(js,{className:"cursor-pointer",children:"Wearable Device Sync"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.features.customWorkoutBuilder,onCheckedChange:e=>m({...o,features:{...o.features,customWorkoutBuilder:e}})}),e.jsx(js,{className:"cursor-pointer",children:"Custom Workout Builder"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.features.advancedAnalytics,onCheckedChange:e=>m({...o,features:{...o.features,advancedAnalytics:e}})}),e.jsx(js,{className:"cursor-pointer",children:"Advanced Analytics"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.features.weeklyMonthlyReports,onCheckedChange:e=>m({...o,features:{...o.features,weeklyMonthlyReports:e}})}),e.jsx(js,{className:"cursor-pointer",children:"Weekly & Monthly Reports"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.features.priorityNutritionistChat,onCheckedChange:e=>m({...o,features:{...o.features,priorityNutritionistChat:e}})}),e.jsx(js,{className:"cursor-pointer",children:"Priority Nutritionist Chat"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.features.sleepCycleAnalysis,onCheckedChange:e=>m({...o,features:{...o.features,sleepCycleAnalysis:e}})}),e.jsx(js,{className:"cursor-pointer",children:"Sleep Cycle Analysis"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.features.groceryListGenerator,onCheckedChange:e=>m({...o,features:{...o.features,groceryListGenerator:e}})}),e.jsx(js,{className:"cursor-pointer",children:"Grocery List Generator"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(js,{className:"text-base font-semibold text-blue-400",children:"Ultimate Features"}),e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.features.realtimeFormFeedback,onCheckedChange:e=>m({...o,features:{...o.features,realtimeFormFeedback:e}})}),e.jsx(js,{className:"cursor-pointer",children:"Real-time Form Feedback"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.features.biomarkerIntegration,onCheckedChange:e=>m({...o,features:{...o.features,biomarkerIntegration:e}})}),e.jsx(js,{className:"cursor-pointer",children:"Biomarker Integration"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.features.oneOnOneVideoCoaching,onCheckedChange:e=>m({...o,features:{...o.features,oneOnOneVideoCoaching:e}})}),e.jsx(js,{className:"cursor-pointer",children:"1-on-1 Video Coaching"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.features.exclusiveChallenges,onCheckedChange:e=>m({...o,features:{...o.features,exclusiveChallenges:e}})}),e.jsx(js,{className:"cursor-pointer",children:"Exclusive Challenges"})]})]})]}),e.jsxs("div",{children:[e.jsx(js,{className:"text-base font-semibold text-purple-400",children:"Elite Features"}),e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.features.photoFoodRecognition,onCheckedChange:e=>m({...o,features:{...o.features,photoFoodRecognition:e}})}),e.jsx(js,{className:"cursor-pointer",children:"Photo Food Recognition"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.features.prioritySupport,onCheckedChange:e=>m({...o,features:{...o.features,prioritySupport:e}})}),e.jsx(js,{className:"cursor-pointer",children:"Priority Support"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.features.doctorConsultations,onCheckedChange:e=>m({...o,features:{...o.features,doctorConsultations:e}})}),e.jsx(js,{className:"cursor-pointer",children:"Doctor Consultations"})]})]})]}),e.jsxs("div",{children:[e.jsx(js,{className:"text-base font-semibold",children:"Feature Limits"}),e.jsxs("div",{className:"space-y-3 mt-2",children:[e.jsxs("div",{children:[e.jsx(js,{className:"text-sm",children:"AI Messages Limit"}),e.jsx(ps,{type:"number",value:o.featureLimits.aiMessages,onChange:e=>m({...o,featureLimits:{...o.featureLimits,aiMessages:e.target.value}}),className:"glass-effect"})]}),e.jsxs("div",{children:[e.jsx(js,{className:"text-sm",children:"Workouts Limit"}),e.jsx(ps,{type:"number",value:o.featureLimits.workouts,onChange:e=>m({...o,featureLimits:{...o.featureLimits,workouts:e.target.value}}),className:"glass-effect"})]}),e.jsxs("div",{children:[e.jsx(js,{className:"text-sm",children:"Video Coaching Sessions"}),e.jsx(ps,{type:"number",value:o.featureLimits.videoCoachingSessions,onChange:e=>m({...o,featureLimits:{...o.featureLimits,videoCoachingSessions:e.target.value}}),className:"glass-effect"})]}),e.jsxs("div",{children:[e.jsx(js,{className:"text-sm",children:"Doctor Consultations"}),e.jsx(ps,{type:"number",value:o.featureLimits.doctorConsultations,onChange:e=>m({...o,featureLimits:{...o.featureLimits,doctorConsultations:e.target.value}}),className:"glass-effect"})]})]})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(js,{children:"Special Perks"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.hasPrioritySupport,onCheckedChange:e=>m({...o,hasPrioritySupport:e})}),e.jsx(js,{className:"cursor-pointer",children:"Priority Support"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.hasBetaAccess,onCheckedChange:e=>m({...o,hasBetaAccess:e})}),e.jsx(js,{className:"cursor-pointer",children:"Beta Features Access"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:o.removeBranding,onCheckedChange:e=>m({...o,removeBranding:e})}),e.jsx(js,{className:"cursor-pointer",children:"Remove Branding"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-primary"}),"Payment Plan"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(js,{children:"Payment Type"}),e.jsxs(fs,{value:o.paymentPlanType,onValueChange:e=>m({...o,paymentPlanType:e}),children:[e.jsx(vs,{className:"glass-effect",children:e.jsx(ys,{})}),e.jsxs(Ns,{className:"glass-effect",children:[e.jsx(bs,{value:"full",children:"Full Payment"}),e.jsx(bs,{value:"split_payment",children:"Split Payment"}),e.jsx(bs,{value:"installment",children:"Installment Plan"}),e.jsx(bs,{value:"pay_as_you_go",children:"Pay As You Go"})]})]})]}),"full"!==o.paymentPlanType&&"pay_as_you_go"!==o.paymentPlanType&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(js,{children:"Number of Payments"}),e.jsx(ps,{type:"number",value:o.numberOfPayments,onChange:e=>m({...o,numberOfPayments:e.target.value}),className:"glass-effect",min:"2"})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Payment Frequency"}),e.jsxs(fs,{value:o.paymentFrequency,onValueChange:e=>m({...o,paymentFrequency:e}),children:[e.jsx(vs,{className:"glass-effect",children:e.jsx(ys,{})}),e.jsxs(Ns,{className:"glass-effect",children:[e.jsx(bs,{value:"weekly",children:"Weekly"}),e.jsx(bs,{value:"biweekly",children:"Bi-weekly"}),e.jsx(bs,{value:"monthly",children:"Monthly"})]})]})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(js,{children:"Customer Notes (Visible to customer)"}),e.jsx(_,{value:o.notes,onChange:e=>m({...o,notes:e.target.value}),placeholder:"Special offer for being a loyal customer...",className:"glass-effect",rows:3})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Internal Notes (Admin only)"}),e.jsx(_,{value:o.internalNotes,onChange:e=>m({...o,internalNotes:e.target.value}),placeholder:"Notes for internal use...",className:"glass-effect",rows:2})]})]}),e.jsxs(hs,{children:[e.jsx(b,{type:"button",variant:"outline",onClick:a,children:"Cancel"}),e.jsx(b,{type:"submit",disabled:l,children:l?"Saving...":c?"Update Offer":"Create Offer"})]})]})]})})},Pa=p,Fa=j,Ta=g.forwardRef(({className:s,align:a="center",sideOffset:t=4,...i},r)=>e.jsx(h,{children:e.jsx(u,{ref:r,align:a,sideOffset:t,className:w("z-50 w-72 rounded-md border border-border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...i})}));Ta.displayName=u.displayName;const Ra=["👋","😊","👍","❤️","🎉","🔥","⭐","✅","💪","🙌","👏","🎊","💯","✨","🚀","🎯","😀","😃","😄","😁","🤗","🥳","😎","🤩"],Ea=({isOpen:s,onClose:a,customer:t})=>{const{userProfile:i}=C(),[r,l]=g.useState([]),[n,c]=g.useState(""),[d,o]=g.useState(!1),[m,x]=g.useState(!1),h=g.useRef(null);g.useRef(null),g.useEffect(()=>{s&&t&&(u(),j())},[s,t]);g.useEffect(()=>{var e;null==(e=h.current)||e.scrollIntoView({behavior:"smooth"})},[r]);const u=async()=>{const{data:e,error:s}=await y.from("messages").select("*").or(`and(sender_id.eq.${i.id},recipient_id.eq.${t.id}),and(sender_id.eq.${t.id},recipient_id.eq.${i.id})`).order("created_at",{ascending:!0});s?s.message.includes("does not exist")||"42P01"===s.code?(N({title:"Chat Feature Not Set Up",description:"The messages table needs to be created in the database.",variant:"default"}),l([])):N({title:"Error loading messages",description:s.message,variant:"destructive"}):(l(e||[]),p())},p=async()=>{await y.from("messages").update({is_read:!0}).eq("recipient_id",i.id).eq("sender_id",t.id).eq("is_read",!1)},j=()=>{const e=y.channel("messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`sender_id=eq.${t.id}`},e=>{l(s=>[...s,e.new]),p()}).subscribe();return()=>{y.removeChannel(e)}},f=async(e,s="text",a={})=>{if(e&&e.preventDefault(),!n.trim()&&"text"===s)return;o(!0);const r={sender_id:i.id,recipient_id:t.id,message_text:n,sender_role:i.role,recipient_role:t.role,message_type:s,is_read:!1,...a},{error:d}=await y.from("messages").insert(r);d?N({title:"Error sending message",description:d.message,variant:"destructive"}):(l(e=>[...e,{...r,id:Date.now(),created_at:(new Date).toISOString()}]),c(""),"offer"===s||N({title:"Message sent",description:`Your message was delivered to ${t.full_name}`,duration:2e3})),o(!1)},v=async e=>{await f(null,"offer",{message_text:{discount_10:"🎉 Special offer for you! Get 10% off your next subscription renewal. Use code: LOYAL10",discount_20:"🔥 Exclusive! 20% discount on all premium plans. Code: VIP20",free_month:"🎁 As a valued customer, enjoy 1 month FREE on us! Auto-applied to your account.",upgrade:"⭐ Upgrade to Premium and get 2 months for the price of 1!",trial:"✨ Try our Elite plan FREE for 14 days - no credit card required!"}[e],offer_type:e}),N({title:"Offer Sent!",description:"The special offer has been sent to the customer."})},_=e=>{c({welcome:"Hi! 👋 Thanks for reaching out. How can I help you today?",thanks:"Thank you for contacting us! We appreciate your patience. 🙏",checking:"Let me check that for you right away... ⏳",resolved:"Great! I'm glad we could resolve that for you. ✅",followup:"Is there anything else I can help you with today? 😊"}[e])},w=e=>e?e.split(" ").map(e=>e[0]).join("").toUpperCase():"U",F=s=>s.sender_id!==i.id?null:e.jsx("span",{className:"inline-flex items-center gap-1",children:s.is_read?e.jsx(_e,{className:"w-3 h-3 text-blue-400"}):e.jsx(ie,{className:"w-3 h-3 text-text-secondary"})}),T=s=>{const a=s.sender_id===i.id;return"offer"===s.message_type?e.jsxs("div",{className:"p-3 rounded-lg border-2 border-primary/50 "+(a?"bg-primary/20 text-primary-foreground":"bg-primary/10 text-foreground"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(je,{className:"w-4 h-4"}),e.jsx(P,{variant:"secondary",className:"text-xs",children:"Special Offer"})]}),e.jsx("p",{className:"text-sm",children:s.message_text})]}):e.jsx("div",{className:"p-3 rounded-lg "+(a?"bg-primary text-primary-foreground":"bg-muted text-foreground"),children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.message_text})})};return e.jsx(cs,{open:s,onOpenChange:a,children:e.jsxs(ds,{className:"glass-effect max-w-md h-[600px] flex flex-col p-0",children:[e.jsx(os,{className:"p-4 pb-3 border-b border-border",children:e.jsxs(ms,{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(k,{className:"w-8 h-8",children:[e.jsx(S,{src:null==t?void 0:t.profile_picture_url}),e.jsx(A,{className:"text-xs",children:w(null==t?void 0:t.full_name)})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-semibold text-sm truncate",children:null==t?void 0:t.full_name}),e.jsx("p",{className:"text-xs text-text-secondary truncate",children:null==t?void 0:t.email})]})]}),e.jsxs("div",{className:"flex gap-1 flex-shrink-0",children:[e.jsxs(ba,{children:[e.jsx(_a,{asChild:!0,children:e.jsx(b,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(je,{className:"w-4 h-4"})})}),e.jsxs(wa,{align:"end",className:"glass-effect w-48",children:[e.jsx(ka,{className:"text-xs",children:"Send Offer"}),e.jsx(Sa,{}),e.jsxs(Ca,{onClick:()=>v("discount_10"),className:"text-xs",children:[e.jsx(he,{className:"w-3 h-3 mr-2"}),"10% Discount"]}),e.jsxs(Ca,{onClick:()=>v("discount_20"),className:"text-xs",children:[e.jsx(he,{className:"w-3 h-3 mr-2"}),"20% VIP Discount"]}),e.jsxs(Ca,{onClick:()=>v("free_month"),className:"text-xs",children:[e.jsx(je,{className:"w-3 h-3 mr-2"}),"1 Month Free"]}),e.jsxs(Ca,{onClick:()=>v("upgrade"),className:"text-xs",children:[e.jsx(P,{className:"w-3 h-3 mr-2"}),"Premium Upgrade"]}),e.jsxs(Ca,{onClick:()=>v("trial"),className:"text-xs",children:[e.jsx(ge,{className:"w-3 h-3 mr-2"}),"14-Day Trial"]})]})]}),e.jsxs(ba,{children:[e.jsx(_a,{asChild:!0,children:e.jsx(b,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(fe,{className:"w-4 h-4"})})}),e.jsxs(wa,{align:"end",className:"glass-effect w-44",children:[e.jsx(ka,{className:"text-xs",children:"Quick Replies"}),e.jsx(Sa,{}),e.jsx(Ca,{onClick:()=>_("welcome"),className:"text-xs",children:"👋 Welcome"}),e.jsx(Ca,{onClick:()=>_("thanks"),className:"text-xs",children:"🙏 Thank You"}),e.jsx(Ca,{onClick:()=>_("checking"),className:"text-xs",children:"⏳ Checking..."}),e.jsx(Ca,{onClick:()=>_("resolved"),className:"text-xs",children:"✅ Resolved"}),e.jsx(Ca,{onClick:()=>_("followup"),className:"text-xs",children:"😊 Follow-up"})]})]})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 p-4 bg-muted/10 rounded-lg",children:[0===r.length?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-secondary",children:[e.jsx(ve,{className:"w-16 h-16 mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-semibold",children:"No messages yet"}),e.jsx("p",{className:"text-sm",children:"Start the conversation or send a quick offer!"})]}):r.map(s=>{const a=s.sender_id===i.id;return e.jsxs("div",{className:"flex gap-3 "+(a?"flex-row-reverse":"flex-row"),children:[e.jsx(k,{className:"w-8 h-8 flex-shrink-0",children:a?e.jsxs(e.Fragment,{children:[e.jsx(S,{src:i.profile_picture_url}),e.jsx(A,{className:"text-xs",children:w(i.full_name)})]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{src:t.profile_picture_url}),e.jsx(A,{className:"text-xs",children:w(t.full_name)})]})}),e.jsxs("div",{className:`max-w-[70%] ${a?"items-end":"items-start"} flex flex-col gap-1`,children:[T(s),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-text-secondary",children:new Date(s.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),F(s)]})]})]},s.id)}),e.jsx("div",{ref:h})]}),e.jsxs("form",{onSubmit:f,className:"flex gap-2 p-4 pt-3 border-t border-border",children:[e.jsxs("div",{className:"flex gap-2 flex-1",children:[e.jsxs(Pa,{open:m,onOpenChange:x,children:[e.jsx(Fa,{asChild:!0,children:e.jsx(b,{type:"button",variant:"ghost",size:"icon",className:"flex-shrink-0",children:e.jsx(ye,{className:"w-5 h-5"})})}),e.jsx(Ta,{className:"glass-effect w-80 p-2",align:"start",children:e.jsx("div",{className:"grid grid-cols-8 gap-1",children:Ra.map((s,a)=>e.jsx("button",{type:"button",onClick:()=>(e=>{c(s=>s+e),x(!1)})(s),className:"p-2 text-2xl hover:bg-muted rounded transition-colors",children:s},a))})})]}),e.jsx(b,{type:"button",variant:"ghost",size:"icon",className:"flex-shrink-0",onClick:()=>{N({title:"File Upload Coming Soon!",description:"File attachment feature will be available in the next update."})},children:e.jsx(Ne,{className:"w-5 h-5"})}),e.jsx(ps,{value:n,onChange:e=>c(e.target.value),placeholder:"Type your message...",className:"glass-effect flex-1",disabled:d})]}),e.jsx(b,{type:"submit",disabled:d||!n.trim(),className:"flex-shrink-0",children:e.jsx(be,{className:"w-4 h-4"})})]})]})})},Ma=()=>{var s,a,t,i;const[r,l]=g.useState([]),[n,c]=g.useState([]),[d,o]=g.useState([]),[m,x]=g.useState(!0),[h,u]=g.useState(""),[p,j]=g.useState(null),[f,v]=g.useState(!1),[_,w]=g.useState(!1),[C,F]=g.useState(null),[T,R]=g.useState(!1),[E,q]=g.useState(!1),[U,L]=g.useState(null),[W,H]=g.useState([]),[Q,Y]=g.useState(!1),[J,K]=g.useState([]),[X,Z]=g.useState([]),[se,ae]=g.useState(!1),[te,ie]=g.useState("all"),[re,ne]=g.useState("all"),[ce,de]=g.useState("all"),[oe,me]=g.useState(1),[xe,he]=g.useState({total:0,active:0,withSubscription:0,newThisMonth:0}),pe=async()=>{x(!0);const{data:e,error:s}=await y.from("user_profiles").select("*").order("created_at",{ascending:!1}),{data:a,error:t}=await y.from("subscriptions").select("*");if(s)N({title:"Error fetching users",description:s.message,variant:"destructive"});else{l(e||[]),c(a||[]);const s=new Date,t=s.getMonth(),i=s.getFullYear(),r=(null==e?void 0:e.filter(e=>e.is_active).length)||0,n=(null==e?void 0:e.filter(e=>null==a?void 0:a.some(s=>s.user_id===e.id)).length)||0,d=(null==e?void 0:e.filter(e=>{const s=new Date(e.created_at);return s.getMonth()===t&&s.getFullYear()===i}).length)||0;he({total:(null==e?void 0:e.length)||0,active:r,withSubscription:n,newThisMonth:d})}x(!1)};g.useEffect(()=>{pe()},[]);const fe=e=>n.find(s=>s.user_id===e);g.useEffect(()=>{let e=r.filter(e=>{var s,a;const t=((null==(s=e.full_name)?void 0:s.toLowerCase())||"").includes(h.toLowerCase())||((null==(a=e.email)?void 0:a.toLowerCase())||"").includes(h.toLowerCase()),i="all"===te||e.role===te,r="all"===ce||"active"===ce&&e.is_active||"inactive"===ce&&!e.is_active,l=fe(e.id);return t&&i&&r&&("all"===re||"with"===re&&l||"without"===re&&!l)});o(e),me(1)},[h,r,n,te,ce,re]);const ye=e=>e?e.split(" ").map(e=>e[0]).join("").toUpperCase():"U",Ne=10*oe,be=Ne-10,_e=d.slice(be,Ne),Me=Math.ceil(d.length/10),Ie=async(e,s)=>{const{error:a}=await y.from("user_profiles").update({role:s}).eq("id",e);a?N({title:"Failed to update role",description:a.message,variant:"destructive"}):(N({title:"User role updated successfully!"}),pe())},qe=async e=>{j(e),v(!0),ae(!0);try{const s=await(async(e,s=50)=>{const{data:a,error:t}=await y.from("activity_logs").select("\n      *,\n      user_profiles (full_name, email)\n    ").eq("user_id",e).order("created_at",{ascending:!1}).limit(s);return t?[]:a||[]})(e.id,20);K(s);const{data:a}=await y.from("payment_transactions").select("*").eq("user_id",e.id).order("created_at",{ascending:!1}).limit(10);Z(a||[])}catch(s){}finally{ae(!1)}},Ue={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}},Le={user:"secondary",nutritionist:"default",admin:"destructive",super_admin:"destructive"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(M,{className:"glass-effect",children:e.jsx(I,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold",children:xe.total})]}),e.jsx(O,{className:"w-8 h-8 text-primary"})]})})}),e.jsx(M,{className:"glass-effect",children:e.jsx(I,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Active Users"}),e.jsx("p",{className:"text-3xl font-bold text-green-400",children:xe.active})]}),e.jsx($,{className:"w-8 h-8 text-green-400"})]})})}),e.jsx(M,{className:"glass-effect",children:e.jsx(I,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"With Subscription"}),e.jsx("p",{className:"text-3xl font-bold text-blue-400",children:xe.withSubscription})]}),e.jsx(B,{className:"w-8 h-8 text-blue-400"})]})})}),e.jsx(M,{className:"glass-effect",children:e.jsx(I,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"New This Month"}),e.jsx("p",{className:"text-3xl font-bold text-purple-400",children:xe.newThisMonth})]}),e.jsx(G,{className:"w-8 h-8 text-purple-400"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"User Management"}),e.jsxs("div",{className:"flex gap-2",children:[Q&&W.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(b,{onClick:()=>{R(!0),L({bulk:!0,users:W})},variant:"default",className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4"}),"Create Bulk Offer (",W.length,")"]}),e.jsx(b,{onClick:()=>{Y(!1),H([])},variant:"outline",children:"Cancel"})]}),!Q&&e.jsxs(e.Fragment,{children:[e.jsxs(b,{onClick:()=>Y(!0),variant:"outline",className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),"Bulk Offers"]}),e.jsxs(b,{onClick:()=>{if(0===d.length)return void N({title:"No data to export",variant:"destructive"});const e=d.map(e=>{const s=fe(e.id);return{Name:e.full_name||"N/A",Email:e.email,Role:e.role,Status:e.is_active?"Active":"Inactive",Subscription:s?s.plan:"None",Joined:new Date(e.created_at).toLocaleDateString()}}),s=[Object.keys(e[0]).join(","),...e.map(e=>Object.values(e).join(","))].join("\n"),a=new Blob([s],{type:"text/csv"}),t=window.URL.createObjectURL(a),i=document.createElement("a");i.href=t,i.download=`users_${Date.now()}.csv`,i.click(),N({title:"Export successful!",description:"User data downloaded as CSV"})},className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Export CSV"]})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(ps,{placeholder:"Search users by name or email...",value:h,onChange:e=>u(e.target.value),className:"pl-10 glass-effect"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs(fs,{value:te,onValueChange:ie,children:[e.jsxs(vs,{className:"w-[180px] glass-effect",children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),e.jsx(ys,{placeholder:"Filter by role"})]}),e.jsxs(Ns,{className:"glass-effect",children:[e.jsx(bs,{value:"all",children:"All Roles"}),e.jsx(bs,{value:"user",children:"User"}),e.jsx(bs,{value:"nutritionist",children:"Nutritionist"}),e.jsx(bs,{value:"admin",children:"Admin"}),e.jsx(bs,{value:"super_admin",children:"Super Admin"})]})]}),e.jsxs(fs,{value:ce,onValueChange:de,children:[e.jsxs(vs,{className:"w-[180px] glass-effect",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),e.jsx(ys,{placeholder:"Filter by status"})]}),e.jsxs(Ns,{className:"glass-effect",children:[e.jsx(bs,{value:"all",children:"All Status"}),e.jsx(bs,{value:"active",children:"Active"}),e.jsx(bs,{value:"inactive",children:"Inactive"})]})]}),e.jsxs(fs,{value:re,onValueChange:ne,children:[e.jsxs(vs,{className:"w-[180px] glass-effect",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),e.jsx(ys,{placeholder:"Filter by subscription"})]}),e.jsxs(Ns,{className:"glass-effect",children:[e.jsx(bs,{value:"all",children:"All Subscriptions"}),e.jsx(bs,{value:"with",children:"With Subscription"}),e.jsx(bs,{value:"without",children:"No Subscription"})]})]})]}),e.jsxs("div",{className:"text-sm text-text-secondary",children:["Showing ",_e.length," of ",d.length," users"]}),m?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((s,a)=>e.jsxs("div",{className:"glass-effect p-4 rounded-lg flex items-center gap-4 animate-pulse",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/10"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-white/10 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-white/10 rounded w-1/2"})]})]},a))}):e.jsxs(e.Fragment,{children:[e.jsxs(V.div,{variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},initial:"hidden",animate:"visible",className:"space-y-4",children:[_e.map(s=>{var a;const t=fe(s.id),i=W.some(e=>e.id===s.id);return e.jsx(V.div,{variants:Ue,children:e.jsx(M,{className:"glass-effect hover:bg-white/10 transition-colors "+(i?"ring-2 ring-primary":""),children:e.jsx(I,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[Q&&e.jsx(gs,{checked:i,onCheckedChange:e=>{H(e?[...W,s]:W.filter(e=>e.id!==s.id))}}),e.jsxs(k,{className:"w-12 h-12",children:[e.jsx(S,{src:s.profile_picture_url,alt:s.full_name}),e.jsx(A,{children:ye(s.full_name)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"font-bold text-lg",children:s.full_name||"N/A"}),s.is_active?e.jsx(ke,{className:"w-4 h-4 text-green-400"}):e.jsx(Se,{className:"w-4 h-4 text-red-400"})]}),e.jsxs("p",{className:"text-sm text-text-secondary flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4"}),s.email]}),t&&e.jsxs("p",{className:"text-xs text-primary flex items-center gap-1 mt-1",children:[e.jsx(B,{className:"w-3 h-3"}),t.plan," subscription"]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx(P,{variant:Le[s.role]||"secondary",className:"capitalize mb-1",children:null==(a=s.role)?void 0:a.replace("_"," ")}),e.jsxs("p",{className:"text-xs text-text-secondary",children:["Joined ",new Date(s.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{variant:"ghost",size:"icon",onClick:()=>qe(s),title:"View Details",children:e.jsx(D,{className:"w-4 h-4"})}),e.jsx(b,{variant:"ghost",size:"icon",onClick:()=>{L(s),q(!0)},title:"Chat with Customer",children:e.jsx(ve,{className:"w-4 h-4"})}),e.jsxs(ba,{children:[e.jsx(_a,{asChild:!0,children:e.jsxs(b,{variant:"ghost",size:"icon",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),"•••"]})}),e.jsxs(wa,{align:"end",className:"glass-effect",children:[e.jsx(ka,{children:"Actions"}),e.jsx(Sa,{}),e.jsxs(Ca,{onClick:()=>{L(s),q(!0)},className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Chat with Customer"]}),e.jsxs(Ca,{onClick:()=>{L(s),R(!0)},className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4"}),"Create Custom Offer"]}),e.jsx(Sa,{}),e.jsx(ka,{children:"Change Role"}),e.jsx(Ca,{onClick:()=>Ie(s.id,"user"),children:"User"}),e.jsx(Ca,{onClick:()=>Ie(s.id,"nutritionist"),children:"Nutritionist"}),e.jsx(Ca,{onClick:()=>Ie(s.id,"admin"),children:"Admin"}),e.jsx(Sa,{}),e.jsxs(Ca,{onClick:()=>(async(e,s)=>{const{error:a}=await y.from("user_profiles").update({is_active:!s}).eq("id",e);a?N({title:"Failed to update status",description:a.message,variant:"destructive"}):(N({title:s?"User suspended":"User activated"}),pe())})(s.id,s.is_active),className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),s.is_active?"Suspend":"Activate"]}),e.jsxs(Ca,{onClick:()=>{F(s),w(!0)},className:"flex items-center gap-2 text-red-400",children:[e.jsx(ee,{className:"w-4 h-4"}),"Delete User"]})]})]})]})]})})})},s.id)}),0===d.length&&e.jsx("p",{className:"text-text-secondary text-center py-8",children:"No users found."})]}),Me>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-6",children:[e.jsx(b,{variant:"outline",size:"icon",onClick:()=>me(e=>Math.max(1,e-1)),disabled:1===oe,className:"glass-effect",children:e.jsx(Fe,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-sm text-text-secondary px-4",children:["Page ",oe," of ",Me]}),e.jsx(b,{variant:"outline",size:"icon",onClick:()=>me(e=>Math.min(Me,e+1)),disabled:oe===Me,className:"glass-effect",children:e.jsx(ue,{className:"w-4 h-4"})})]})]}),e.jsx(cs,{open:f,onOpenChange:v,children:e.jsxs(ds,{className:"glass-effect max-w-2xl max-h-[85vh] overflow-y-auto",children:[e.jsx(os,{children:e.jsx(ms,{children:"User Profile"})}),p&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(k,{className:"w-20 h-20",children:[e.jsx(S,{src:p.profile_picture_url}),e.jsx(A,{className:"text-2xl",children:ye(p.full_name)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:p.full_name}),e.jsxs("p",{className:"text-text-secondary flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4"}),p.email]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(P,{variant:p.is_active?"default":"destructive",children:p.is_active?"Active":"Inactive"}),e.jsx(P,{variant:"outline",className:"capitalize",children:null==(s=p.role)?void 0:s.replace("_"," ")})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{size:"sm",onClick:()=>{L(p),q(!0),v(!1)},children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Chat"]}),e.jsxs(b,{size:"sm",variant:"outline",onClick:()=>{L(p),R(!0),v(!1)},children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Offer"]})]})]}),e.jsxs(_s,{defaultValue:"overview",className:"w-full",children:[e.jsxs(ws,{className:"grid w-full grid-cols-3",children:[e.jsx(Cs,{value:"overview",children:"Overview"}),e.jsx(Cs,{value:"activity",children:"Activity Timeline"}),e.jsx(Cs,{value:"payments",children:"Payment History"})]}),e.jsxs(ks,{value:"overview",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(G,{className:"w-4 h-4 text-primary"}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Joined"})]}),e.jsx("p",{className:"font-semibold",children:Te(new Date(p.created_at),"MMM dd, yyyy")})]}),e.jsxs("div",{className:"p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(B,{className:"w-4 h-4 text-primary"}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Subscription"})]}),e.jsx("p",{className:"font-semibold capitalize",children:(null==(a=fe(p.id))?void 0:a.plan)||"None"})]}),e.jsxs("div",{className:"p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Re,{className:"w-4 h-4 text-primary"}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Payments"})]}),e.jsx("p",{className:"font-semibold",children:X.length})]}),e.jsxs("div",{className:"p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(z,{className:"w-4 h-4 text-primary"}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Total Spent"})]}),e.jsxs("p",{className:"font-semibold",children:["$",X.filter(e=>"succeeded"===e.status).reduce((e,s)=>e+parseFloat(s.amount||0),0).toFixed(2)]})]})]}),fe(p.id)&&e.jsxs("div",{className:"p-4 bg-muted/30 rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Current Subscription"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-secondary",children:"Plan:"}),e.jsx("span",{className:"font-medium capitalize",children:null==(t=fe(p.id))?void 0:t.plan})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-secondary",children:"Status:"}),e.jsx(P,{variant:"default",children:"Active"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-secondary",children:"Started:"}),e.jsx("span",{className:"font-medium",children:Te(new Date(null==(i=fe(p.id))?void 0:i.created_at),"MMM dd, yyyy")})]})]})]})]}),e.jsx(ks,{value:"activity",className:"space-y-4",children:se?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ee,{className:"w-8 h-8 animate-spin mx-auto text-primary"}),e.jsx("p",{className:"text-sm text-text-secondary mt-2",children:"Loading activity..."})]}):J.length>0?e.jsx("div",{className:"space-y-3",children:J.map((s,a)=>e.jsxs("div",{className:"flex gap-3 p-3 bg-muted/30 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center",children:e.jsx($,{className:"w-4 h-4 text-primary"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium capitalize",children:s.activity_type.replace(/_/g," ")}),s.details&&Object.keys(s.details).length>0&&e.jsx("p",{className:"text-xs text-text-secondary truncate",children:JSON.stringify(s.details)}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(ge,{className:"w-3 h-3 text-text-secondary"}),e.jsx("p",{className:"text-xs text-text-secondary",children:Te(new Date(s.created_at),"MMM dd, yyyy HH:mm")})]})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx($,{className:"w-12 h-12 mx-auto text-text-secondary mb-2"}),e.jsx("p",{className:"text-text-secondary",children:"No activity recorded yet"})]})}),e.jsx(ks,{value:"payments",className:"space-y-4",children:se?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ee,{className:"w-8 h-8 animate-spin mx-auto text-primary"}),e.jsx("p",{className:"text-sm text-text-secondary mt-2",children:"Loading payments..."})]}):X.length>0?e.jsx("div",{className:"space-y-3",children:X.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center "+("succeeded"===s.status?"bg-green-500/20":"failed"===s.status?"bg-red-500/20":"bg-yellow-500/20"),children:e.jsx(z,{className:"w-4 h-4 "+("succeeded"===s.status?"text-green-400":"failed"===s.status?"text-red-400":"text-yellow-400")})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["$",s.amount]}),e.jsx("p",{className:"text-xs text-text-secondary",children:Te(new Date(s.created_at),"MMM dd, yyyy HH:mm")})]})]}),e.jsx(P,{variant:"succeeded"===s.status?"default":"destructive",children:s.status})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(B,{className:"w-12 h-12 mx-auto text-text-secondary mb-2"}),e.jsx("p",{className:"text-text-secondary",children:"No payment history"})]})})]})]})]})}),e.jsx(cs,{open:_,onOpenChange:w,children:e.jsxs(ds,{className:"glass-effect",children:[e.jsxs(os,{children:[e.jsx(ms,{children:"Delete User"}),e.jsxs(xs,{children:["Are you sure you want to delete ",null==C?void 0:C.full_name,"? This action cannot be undone."]})]}),e.jsxs(hs,{children:[e.jsx(b,{variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsx(b,{variant:"destructive",onClick:async()=>{if(!C)return;const{error:e}=await y.from("user_profiles").delete().eq("id",C.id);e?N({title:"Failed to delete user",description:e.message,variant:"destructive"}):(N({title:"User deleted successfully"}),w(!1),F(null),pe())},children:"Delete"})]})]})}),e.jsx(Aa,{isOpen:T,onClose:()=>{R(!1),L(null)},user:U,onOfferCreated:()=>{pe()}}),e.jsx(Ea,{isOpen:E,onClose:()=>{q(!1),L(null)},customer:U})]})},Ia=()=>{const[s,a]=g.useState(null),[t,i]=g.useState(!0),[r,l]=g.useState(!1),[n,c]=g.useState(!1),[d,o]=g.useState(!1),[m,x]=g.useState({is_active:!1,is_test_mode:!0,public_key:"",secret_key:"",webhook_secret:""});g.useEffect(()=>{h()},[]);const h=async()=>{i(!0);const{data:e,error:s}=await y.from("payment_settings").select("*").eq("provider","stripe").single();s&&"PGRST116"!==s.code?N({title:"Error fetching settings",description:s.message,variant:"destructive"}):e&&(a(e),x({is_active:e.is_active||!1,is_test_mode:!1!==e.is_test_mode,public_key:e.public_key||"",secret_key:e.secret_key||"",webhook_secret:e.webhook_secret||""})),i(!1)},u=e=>{const{name:s,value:a}=e.target;x(e=>({...e,[s]:a}))},p=(e,s)=>{x(a=>({...a,[e]:s}))};return t?e.jsxs(M,{className:"glass-effect",children:[e.jsx(q,{children:e.jsx("div",{className:"h-8 bg-white/10 rounded w-1/3 animate-pulse"})}),e.jsx(I,{className:"space-y-4",children:[...Array(4)].map((s,a)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-white/10 rounded w-1/4 animate-pulse"}),e.jsx("div",{className:"h-10 bg-white/10 rounded w-full animate-pulse"})]},a))})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs(M,{className:"glass-effect",children:[e.jsx(q,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-6 h-6"}),"Stripe Payment Settings"]}),e.jsx(L,{className:"mt-2",children:"Configure your Stripe account to accept payments"})]}),m.is_active?e.jsx(P,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:"Active"}):e.jsx(P,{variant:"secondary",children:"Inactive"})]})}),e.jsxs(I,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border border-border bg-background/50",children:[e.jsxs("div",{children:[e.jsx(js,{htmlFor:"is_active",className:"text-base font-semibold",children:"Enable Stripe Payments"}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:"Accept payments through Stripe"})]}),e.jsx(gs,{id:"is_active",checked:m.is_active,onCheckedChange:e=>p("is_active",e)})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border border-border bg-background/50",children:[e.jsxs("div",{children:[e.jsx(js,{htmlFor:"is_test_mode",className:"text-base font-semibold",children:"Test Mode"}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:"Use test API keys instead of live keys"})]}),e.jsx(gs,{id:"is_test_mode",checked:m.is_test_mode,onCheckedChange:e=>p("is_test_mode",e)})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-border",children:[e.jsxs("div",{children:[e.jsxs(js,{htmlFor:"public_key",children:["Publishable Key ",m.is_test_mode?"(Test)":"(Live)"]}),e.jsx(ps,{id:"public_key",name:"public_key",value:m.public_key,onChange:u,placeholder:m.is_test_mode?"pk_test_...":"pk_live_...",className:"mt-2 font-mono text-sm"}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Used on the client-side to create payment forms"})]}),e.jsxs("div",{children:[e.jsxs(js,{htmlFor:"secret_key",children:["Secret Key ",m.is_test_mode?"(Test)":"(Live)"]}),e.jsxs("div",{className:"relative mt-2",children:[e.jsx(ps,{id:"secret_key",name:"secret_key",type:n?"text":"password",value:m.secret_key,onChange:u,placeholder:m.is_test_mode?"sk_test_...":"sk_live_...",className:"font-mono text-sm pr-10"}),e.jsx("button",{type:"button",onClick:()=>c(!n),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-secondary hover:text-text-primary",children:n?e.jsx(Me,{className:"w-4 h-4"}):e.jsx(D,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Used server-side to process payments"})]}),e.jsxs("div",{children:[e.jsx(js,{htmlFor:"webhook_secret",children:"Webhook Secret (Optional)"}),e.jsxs("div",{className:"relative mt-2",children:[e.jsx(ps,{id:"webhook_secret",name:"webhook_secret",type:d?"text":"password",value:m.webhook_secret,onChange:u,placeholder:"whsec_...",className:"font-mono text-sm pr-10"}),e.jsx("button",{type:"button",onClick:()=>o(!d),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-secondary hover:text-text-primary",children:d?e.jsx(Me,{className:"w-4 h-4"}):e.jsx(D,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Used to verify webhook events from Stripe"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-border",children:[e.jsxs(b,{onClick:async()=>{l(!0);try{const{error:e}=await y.from("payment_settings").upsert({provider:"stripe",is_active:m.is_active,is_test_mode:m.is_test_mode,public_key:m.public_key,secret_key:m.secret_key,webhook_secret:m.webhook_secret},{onConflict:"provider"});if(e)throw e;N({title:"Settings Saved!",description:"Stripe payment settings have been updated successfully."}),h()}catch(e){N({title:"Error",description:e.message||"Failed to save settings",variant:"destructive"})}finally{l(!1)}},disabled:r,className:"flex-1",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),r?"Saving...":"Save Settings"]}),e.jsxs(b,{onClick:async()=>{if(m.secret_key){N({title:"Testing Connection",description:"Verifying Stripe credentials..."});try{const e=m.secret_key.startsWith("sk_test_")||m.secret_key.startsWith("sk_live_");N(e?{title:"Connection Successful",description:"Stripe API key format is valid"}:{title:"Invalid Key Format",description:"Stripe secret key should start with sk_test_ or sk_live_",variant:"destructive"})}catch(e){N({title:"Connection Failed",description:e.message,variant:"destructive"})}}else N({title:"Missing Key",description:"Please enter a secret key first",variant:"destructive"})},variant:"outline",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Test Connection"]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-primary/10 border border-primary/20",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"How to get your Stripe API keys:"}),e.jsxs("ol",{className:"text-sm text-text-secondary space-y-1 list-decimal list-inside",children:[e.jsxs("li",{children:["Go to ",e.jsx("a",{href:"https://dashboard.stripe.com/apikeys",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"Stripe Dashboard"})]}),e.jsx("li",{children:"Navigate to Developers → API keys"}),e.jsx("li",{children:"Copy your Publishable key and Secret key"}),e.jsx("li",{children:"For webhooks: Developers → Webhooks → Add endpoint"}),e.jsxs("li",{children:["Use this URL: ",e.jsxs("code",{className:"px-2 py-1 bg-background/50 rounded text-xs",children:[window.location.origin,"/api/webhooks/stripe"]})]})]})]})]})]})})},qa=()=>{const[s,a]=g.useState([]),[t,i]=g.useState(!0),[r,l]=g.useState(!1),[n,c]=g.useState("all"),[d,o]=g.useState(""),[m,x]=g.useState({total:0,succeeded:0,pending:0,failed:0});g.useEffect(()=>{h()},[n]);const h=async()=>{i(!0);let e=y.from("payment_transactions").select("\n        *,\n        user_profiles (full_name, email)\n      ").order("created_at",{ascending:!1}).limit(100);"all"!==n&&(e=e.eq("status",n));const{data:s,error:t}=await e;t?N({title:"Error fetching payments",description:t.message,variant:"destructive"}):(a(s||[]),u(s||[])),i(!1)},u=e=>{const s=e.reduce((e,s)=>e+parseFloat(s.amount),0),a=e.filter(e=>"succeeded"===e.status).reduce((e,s)=>e+parseFloat(s.amount),0),t=e.filter(e=>"pending"===e.status).length,i=e.filter(e=>"failed"===e.status).length;x({total:s,succeeded:a,pending:t,failed:i})},p=s=>{switch(s){case"succeeded":return e.jsxs(P,{variant:"success",className:"bg-green-500/20 text-green-400 border-green-500/30",children:[e.jsx(ke,{className:"w-3 h-3 mr-1"}),"Succeeded"]});case"failed":return e.jsxs(P,{variant:"destructive",children:[e.jsx(Se,{className:"w-3 h-3 mr-1"}),"Failed"]});case"pending":return e.jsxs(P,{variant:"secondary",children:[e.jsx(ge,{className:"w-3 h-3 mr-1"}),"Pending"]});default:return e.jsx(P,{children:s})}},j={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},f=s.filter(e=>{var s,a,t,i,r;if(!d)return!0;const l=d.toLowerCase();return(null==(a=null==(s=e.user_profiles)?void 0:s.full_name)?void 0:a.toLowerCase().includes(l))||(null==(i=null==(t=e.user_profiles)?void 0:t.email)?void 0:i.toLowerCase().includes(l))||(null==(r=e.payment_intent_id)?void 0:r.toLowerCase().includes(l))});return r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Payment Settings"}),e.jsx(b,{onClick:()=>l(!1),variant:"outline",children:"Back to Payments"})]}),e.jsx(Ia,{})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(M,{className:"glass-effect",children:e.jsx(I,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Total Revenue"}),e.jsxs("p",{className:"text-2xl font-bold mt-1",children:["$",m.total.toFixed(2)]})]}),e.jsx(z,{className:"w-8 h-8 text-green-400"})]})})}),e.jsx(M,{className:"glass-effect",children:e.jsx(I,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Succeeded"}),e.jsxs("p",{className:"text-2xl font-bold mt-1",children:["$",m.succeeded.toFixed(2)]})]}),e.jsx(ke,{className:"w-8 h-8 text-green-400"})]})})}),e.jsx(M,{className:"glass-effect",children:e.jsx(I,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:m.pending})]}),e.jsx(ge,{className:"w-8 h-8 text-yellow-400"})]})})}),e.jsx(M,{className:"glass-effect",children:e.jsx(I,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Failed"}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:m.failed})]}),e.jsx(Se,{className:"w-8 h-8 text-red-400"})]})})})]}),e.jsxs(M,{className:"glass-effect",children:[e.jsxs(q,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsx(U,{className:"text-3xl font-bold",children:"Payment Transactions"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{onClick:()=>l(!0),variant:"outline",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Settings"]}),e.jsxs(b,{onClick:h,variant:"outline",children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Refresh"]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mt-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(we,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-text-secondary"}),e.jsx(ps,{placeholder:"Search by customer name, email, or transaction ID...",value:d,onChange:e=>o(e.target.value),className:"pl-10"})]}),e.jsxs(fs,{value:n,onValueChange:c,children:[e.jsx(vs,{className:"w-full md:w-[180px]",children:e.jsx(ys,{placeholder:"Filter by status"})}),e.jsxs(Ns,{children:[e.jsx(bs,{value:"all",children:"All Statuses"}),e.jsx(bs,{value:"succeeded",children:"Succeeded"}),e.jsx(bs,{value:"pending",children:"Pending"}),e.jsx(bs,{value:"failed",children:"Failed"}),e.jsx(bs,{value:"refunded",children:"Refunded"})]})]})]})]}),e.jsx(I,{children:t?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((s,a)=>e.jsxs("div",{className:"p-4 rounded-lg flex items-center gap-4 animate-pulse bg-white/5",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-white/10 rounded w-1/3"}),e.jsx("div",{className:"h-4 bg-white/10 rounded w-1/2"})]}),e.jsx("div",{className:"h-6 bg-white/10 rounded w-1/6"}),e.jsx("div",{className:"h-6 bg-white/10 rounded w-1/6"})]},a))}):e.jsxs(V.div,{variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},initial:"hidden",animate:"visible",className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("th",{className:"p-4",children:"Customer"}),e.jsx("th",{className:"p-4",children:"Amount"}),e.jsx("th",{className:"p-4",children:"Status"}),e.jsx("th",{className:"p-4",children:"Date"})]})}),e.jsx("tbody",{children:f.map(s=>{var a,t;return e.jsxs(V.tr,{variants:j,className:"border-b border-white/5 hover:bg-white/5",children:[e.jsxs("td",{className:"p-4",children:[e.jsx("div",{className:"font-medium",children:(null==(a=s.user_profiles)?void 0:a.full_name)||"Unknown"}),e.jsx("div",{className:"text-sm text-text-secondary",children:(null==(t=s.user_profiles)?void 0:t.email)||"No email"})]}),e.jsxs("td",{className:"p-4 font-semibold text-lg",children:["$",parseFloat(s.amount).toFixed(2)]}),e.jsx("td",{className:"p-4",children:p(s.status)}),e.jsx("td",{className:"p-4 text-text-secondary",children:new Date(s.created_at).toLocaleString()})]},s.id)})})]}),0===f.length&&!t&&e.jsx("p",{className:"text-text-secondary text-center py-8",children:d?"No transactions match your search":"No payment transactions found."})]})})]})]})},Ua=({user:s})=>{var a,t;const[i,r]=g.useState([]),[l,n]=g.useState([]),[c,d]=g.useState(!0),[o,m]=g.useState(null),[x,h]=g.useState([]),[u,p]=g.useState([]),[j,f]=g.useState(""),[v,w]=g.useState("all"),[C,k]=g.useState("all"),[S,A]=g.useState("all"),[F,T]=g.useState("all"),[R,E]=g.useState(null),[L,D]=g.useState(!1);g.useState(null);const[O,$]=g.useState([]),[z,G]=g.useState(""),[B,W]=g.useState(!1),[H,Y]=g.useState(!1),J=async()=>{d(!0);const{data:e,error:s}=await y.from("issues").select("*").order("created_at",{ascending:!1});if(s)return N({title:"Error fetching issues",description:s.message,variant:"destructive"}),void d(!1);const a=[...new Set([...e.map(e=>e.user_id),...e.filter(e=>e.assigned_to).map(e=>e.assigned_to)])].filter(Boolean);let t=[];if(a.length>0){const{data:e}=await y.from("user_profiles").select("id, full_name, email, profile_picture_url").in("id",a);t=e||[]}const i=e.map(e=>({...e,user_profiles:t.find(s=>s.id===e.user_id),assigned_user:e.assigned_to?t.find(s=>s.id===e.assigned_to):null}));r(i),n(i),d(!1)},K=async e=>{Y(!0);const{data:s}=await y.from("issue_comments").select("*").eq("issue_id",e).order("created_at",{ascending:!0}),a=[...new Set((null==s?void 0:s.map(e=>e.user_id))||[])].filter(Boolean);let t=[];if(a.length>0){const{data:e}=await y.from("user_profiles").select("id, full_name, email, profile_picture_url").in("id",a);t=e||[]}const i=(s||[]).map(e=>({...e,user_profiles:t.find(s=>s.id===e.user_id)}));$(i),Y(!1)};g.useEffect(()=>{J(),(async()=>{const{data:e,error:s}=await y.rpc("get_issue_statistics",{time_period:"all"});s||e&&e.length>0&&m(e[0])})(),(async()=>{const{data:e}=await y.from("issue_categories").select("*").eq("is_active",!0).order("display_order");e&&h(e)})(),(async()=>{const{data:e}=await y.from("user_profiles").select("id, full_name, email").in("role",["admin","super_admin"]);e&&p(e)})()},[]),g.useEffect(()=>{let e=i;j&&(e=e.filter(e=>{var s,a,t,i,r;return(null==(s=e.subject)?void 0:s.toLowerCase().includes(j.toLowerCase()))||(null==(t=null==(a=e.user_profiles)?void 0:a.full_name)?void 0:t.toLowerCase().includes(j.toLowerCase()))||(null==(r=null==(i=e.user_profiles)?void 0:i.email)?void 0:r.toLowerCase().includes(j.toLowerCase()))})),"all"!==v&&(e=e.filter(e=>e.status===v)),"all"!==C&&(e=e.filter(e=>e.priority===C)),"all"!==S&&(e=e.filter(e=>e.category===S)),"all"!==F&&(e="unassigned"===F?e.filter(e=>!e.assigned_to):"me"===F?e.filter(e=>e.assigned_to===(null==s?void 0:s.id)):e.filter(e=>e.assigned_to===F)),n(e)},[j,v,C,S,F,i,s]);const Z=async(e,s)=>{const{error:a}=await y.from("issues").update({status:s}).eq("id",e);a?N({title:"Error updating status",description:a.message,variant:"destructive"}):(N({title:"Status Updated",description:`Issue status changed to ${s}`}),J(),(null==R?void 0:R.id)===e&&E({...R,status:s}))},ee=async(e,s)=>{const{error:a}=await y.from("issues").update({priority:s}).eq("id",e);a?N({title:"Error updating priority",description:a.message,variant:"destructive"}):(N({title:"Priority Updated",description:`Priority changed to ${s}`}),J(),(null==R?void 0:R.id)===e&&E({...R,priority:s}))},se=e=>{E(e),D(!0),K(e.id)},ae=s=>{switch(s){case"open":return e.jsxs(P,{className:"bg-blue-500/20 text-blue-300 border-blue-500/30",children:[e.jsx(X,{className:"w-3 h-3 mr-1"}),"Open"]});case"in_progress":return e.jsxs(P,{className:"bg-yellow-500/20 text-yellow-300 border-yellow-500/30",children:[e.jsx(ge,{className:"w-3 h-3 mr-1"}),"In Progress"]});case"resolved":return e.jsxs(P,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:[e.jsx(ke,{className:"w-3 h-3 mr-1"}),"Resolved"]});case"closed":return e.jsx(P,{variant:"outline",children:"Closed"});default:return e.jsx(P,{children:s})}},ie=s=>{switch(s){case"urgent":return e.jsxs(P,{className:"bg-red-500/20 text-red-300 border-red-500/30 animate-pulse",children:[e.jsx(Ue,{className:"w-3 h-3 mr-1"}),"Urgent"]});case"high":return e.jsxs(P,{className:"bg-orange-500/20 text-orange-300 border-orange-500/30",children:[e.jsx(Ue,{className:"w-3 h-3 mr-1"}),"High"]});case"medium":return e.jsx(P,{className:"bg-yellow-500/20 text-yellow-300 border-yellow-500/30",children:"Medium"});case"low":return e.jsx(P,{className:"bg-gray-500/20 text-gray-300 border-gray-500/30",children:"Low"});default:return e.jsx(P,{children:s})}},re=s=>{const a=x.find(e=>e.slug===s);return a?e.jsx(P,{style:{backgroundColor:`${a.color}20`,color:a.color,borderColor:`${a.color}50`},children:a.name}):null};return e.jsxs("div",{className:"space-y-6",children:[o&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(M,{className:"glass-effect",children:e.jsx(I,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Total Issues"}),e.jsx("p",{className:"text-2xl font-bold",children:o.total_issues||0})]}),e.jsx(Q,{className:"w-8 h-8 text-primary opacity-50"})]})})}),e.jsx(M,{className:"glass-effect",children:e.jsx(I,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Open Issues"}),e.jsx("p",{className:"text-2xl font-bold text-blue-400",children:o.open_issues||0})]}),e.jsx(X,{className:"w-8 h-8 text-blue-400 opacity-50"})]})})}),e.jsx(M,{className:"glass-effect",children:e.jsx(I,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Avg Response Time"}),e.jsx("p",{className:"text-2xl font-bold text-green-400",children:o.avg_first_response_minutes?`${Math.round(o.avg_first_response_minutes)}m`:"N/A"})]}),e.jsx(ge,{className:"w-8 h-8 text-green-400 opacity-50"})]})})}),e.jsx(M,{className:"glass-effect",children:e.jsx(I,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Urgent Issues"}),e.jsx("p",{className:"text-2xl font-bold text-red-400",children:o.urgent_issues||0})]}),e.jsx(Ue,{className:"w-8 h-8 text-red-400 opacity-50"})]})})})]}),e.jsxs(M,{className:"glass-effect",children:[e.jsxs(q,{children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:e.jsxs("div",{children:[e.jsx(U,{className:"text-3xl font-bold",children:"Customer Issues"}),e.jsx("p",{className:"text-text-secondary",children:"Track and resolve customer support tickets"})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 mt-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(we,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-text-secondary"}),e.jsx(ps,{placeholder:"Search by subject, customer name, or email...",value:j,onChange:e=>f(e.target.value),className:"pl-10"})]}),e.jsxs(fs,{value:v,onValueChange:w,children:[e.jsx(vs,{className:"w-full md:w-[150px]",children:e.jsx(ys,{placeholder:"Status"})}),e.jsxs(Ns,{children:[e.jsx(bs,{value:"all",children:"All Status"}),e.jsx(bs,{value:"open",children:"Open"}),e.jsx(bs,{value:"in_progress",children:"In Progress"}),e.jsx(bs,{value:"resolved",children:"Resolved"}),e.jsx(bs,{value:"closed",children:"Closed"})]})]}),e.jsxs(fs,{value:C,onValueChange:k,children:[e.jsx(vs,{className:"w-full md:w-[150px]",children:e.jsx(ys,{placeholder:"Priority"})}),e.jsxs(Ns,{children:[e.jsx(bs,{value:"all",children:"All Priority"}),e.jsx(bs,{value:"urgent",children:"Urgent"}),e.jsx(bs,{value:"high",children:"High"}),e.jsx(bs,{value:"medium",children:"Medium"}),e.jsx(bs,{value:"low",children:"Low"})]})]}),e.jsxs(fs,{value:S,onValueChange:A,children:[e.jsx(vs,{className:"w-full md:w-[150px]",children:e.jsx(ys,{placeholder:"Category"})}),e.jsxs(Ns,{children:[e.jsx(bs,{value:"all",children:"All Categories"}),x.map(s=>e.jsx(bs,{value:s.slug,children:s.name},s.id))]})]}),e.jsxs(fs,{value:F,onValueChange:T,children:[e.jsx(vs,{className:"w-full md:w-[150px]",children:e.jsx(ys,{placeholder:"Assigned"})}),e.jsxs(Ns,{children:[e.jsx(bs,{value:"all",children:"All Assignments"}),e.jsx(bs,{value:"unassigned",children:"Unassigned"}),e.jsx(bs,{value:"me",children:"Assigned to Me"}),e.jsx(Sa,{}),u.map(s=>e.jsx(bs,{value:s.id,children:s.full_name},s.id))]})]})]})]}),e.jsx(I,{children:c?e.jsxs("div",{className:"flex justify-center items-center py-10",children:[e.jsx(Ee,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-4 text-lg",children:"Loading Issues..."})]}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("th",{className:"p-4",children:"Priority"}),e.jsx("th",{className:"p-4",children:"Subject"}),e.jsx("th",{className:"p-4",children:"Category"}),e.jsx("th",{className:"p-4",children:"Customer"}),e.jsx("th",{className:"p-4",children:"Assigned To"}),e.jsx("th",{className:"p-4",children:"Status"}),e.jsx("th",{className:"p-4",children:"Last Updated"}),e.jsx("th",{className:"p-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{children:l.map(s=>{var a,t;return e.jsxs(V.tr,{initial:{opacity:0},animate:{opacity:1},className:"border-b border-white/5 hover:bg-white/5 cursor-pointer",onClick:()=>se(s),children:[e.jsx("td",{className:"p-4",children:ie(s.priority)}),e.jsx("td",{className:"p-4 font-medium",children:s.subject}),e.jsx("td",{className:"p-4",children:re(s.category)}),e.jsxs("td",{className:"p-4",children:[e.jsx("div",{className:"font-medium",children:(null==(a=s.user_profiles)?void 0:a.full_name)||"N/A"}),e.jsx("div",{className:"text-sm text-text-secondary",children:(null==(t=s.user_profiles)?void 0:t.email)||"N/A"})]}),e.jsx("td",{className:"p-4",children:s.assigned_user?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:s.assigned_user.full_name})]}):e.jsx("span",{className:"text-text-secondary text-sm",children:"Unassigned"})}),e.jsx("td",{className:"p-4",children:ae(s.status)}),e.jsx("td",{className:"p-4 text-text-secondary",children:new Date(s.updated_at).toLocaleDateString()}),e.jsx("td",{className:"p-4 text-right",onClick:e=>e.stopPropagation(),children:e.jsxs(ba,{children:[e.jsx(_a,{asChild:!0,children:e.jsx(b,{variant:"ghost",className:"h-8 w-8 p-0",children:e.jsx(De,{className:"h-4 w-4"})})}),e.jsxs(wa,{align:"end",className:"glass-effect",children:[e.jsxs(Ca,{onClick:()=>se(s),children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"View Details"]}),e.jsx(Sa,{}),e.jsx(Ca,{onClick:()=>Z(s.id,"in_progress"),children:"Set to In Progress"}),e.jsx(Ca,{onClick:()=>Z(s.id,"resolved"),children:"Set to Resolved"}),e.jsx(Ca,{onClick:()=>Z(s.id,"closed"),children:"Set to Closed"}),e.jsx(Sa,{}),e.jsx(Ca,{onClick:()=>ee(s.id,"urgent"),children:"Set Priority: Urgent"}),e.jsx(Ca,{onClick:()=>ee(s.id,"high"),children:"Set Priority: High"})]})]})})]},s.id)})})]}),0===l.length&&e.jsx("p",{className:"text-text-secondary text-center py-8",children:j||"all"!==v||"all"!==C||"all"!==S?"No issues match your filters":"No customer issues found. Great job!"})]})})]}),e.jsx(te,{children:L&&R&&e.jsx(cs,{open:L,onOpenChange:D,children:e.jsxs(ds,{className:"max-w-4xl max-h-[90vh] overflow-y-auto glass-effect",children:[e.jsx(os,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(ms,{className:"text-2xl",children:R.subject}),e.jsxs(xs,{className:"mt-2",children:["Issue #",R.id.slice(0,8)," • Created ",new Date(R.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[ie(R.priority),ae(R.status)]})]})}),e.jsxs("div",{className:"space-y-6 mt-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Description"}),e.jsx("p",{className:"text-text-secondary whitespace-pre-wrap",children:R.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Customer"}),e.jsxs("div",{className:"text-text-secondary",children:[e.jsx("p",{children:null==(a=R.user_profiles)?void 0:a.full_name}),e.jsx("p",{className:"text-sm",children:null==(t=R.user_profiles)?void 0:t.email})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Assigned To"}),e.jsxs(fs,{value:R.assigned_to||"unassigned",onValueChange:e=>(async(e,s)=>{const{error:a}=await y.from("issues").update({assigned_to:s}).eq("id",e);a?N({title:"Error assigning issue",description:a.message,variant:"destructive"}):(N({title:"Issue Assigned",description:"Issue has been assigned successfully"}),J())})(R.id,"unassigned"===e?null:e),children:[e.jsx(vs,{children:e.jsx(ys,{})}),e.jsxs(Ns,{children:[e.jsx(bs,{value:"unassigned",children:"Unassigned"}),u.map(s=>e.jsx(bs,{value:s.id,children:s.full_name},s.id))]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5"}),"Conversation (",O.length,")"]}),H?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(Ee,{className:"w-6 h-6 animate-spin"})}):e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:O.map(s=>{var a;return e.jsxs("div",{className:"p-4 rounded-lg "+(s.is_internal?"bg-yellow-500/10 border border-yellow-500/30":"bg-muted/20"),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:null==(a=s.user_profiles)?void 0:a.full_name}),s.is_internal&&e.jsxs(P,{variant:"outline",className:"text-xs",children:[e.jsx($e,{className:"w-3 h-3 mr-1"}),"Internal Note"]})]}),e.jsx("span",{className:"text-xs text-text-secondary",children:new Date(s.created_at).toLocaleString()})]}),e.jsx("p",{className:"text-text-secondary whitespace-pre-wrap",children:s.comment_text})]},s.id)})}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx(_,{placeholder:"Type your response or internal note...",value:z,onChange:e=>G(e.target.value),rows:3}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:B,onChange:e=>W(e.target.checked),className:"rounded"}),e.jsx("span",{className:"text-sm text-text-secondary",children:"Internal note (not visible to customer)"})]}),e.jsxs(b,{onClick:async()=>{if(!z.trim()||!R)return;const{error:e}=await y.from("issue_comments").insert({issue_id:R.id,user_id:s.id,comment_text:z,is_internal:B});e?N({title:"Error adding comment",description:e.message,variant:"destructive"}):(N({title:"Comment Added",description:B?"Internal note added":"Comment added"}),G(""),W(!1),K(R.id))},disabled:!z.trim(),children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),B?"Add Note":"Send Reply"]})]})]})]})]})]})})})]})},La=()=>{const[s,a]=g.useState([]),[t,i]=g.useState(!0),[r,l]=g.useState(!1),[n,c]=g.useState(null),[d,o]=g.useState({category:"",category_icon:"",name:"",description:"",plan_tier:"",feature_icon:"",display_order:0}),m=async()=>{i(!0);const{data:e,error:s}=await y.from("features").select("*").order("display_order");s?N({title:"Error fetching features",description:s.message,variant:"destructive"}):a(e),i(!1)};g.useEffect(()=>{m()},[]);const x=e=>{const{name:s,value:a}=e.target;o(e=>({...e,[s]:a}))},h=(e=null)=>{c(e),o(e||{category:"",category_icon:"",name:"",description:"",plan_tier:"",feature_icon:"",display_order:0}),l(!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Manage Features"}),e.jsxs(b,{onClick:()=>h(),children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"New Feature"]})]}),e.jsx(cs,{open:r,onOpenChange:l,children:e.jsxs(ds,{className:"glass-effect",children:[e.jsx(os,{children:e.jsx(ms,{children:n?"Edit Feature":"Create New Feature"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"category",children:"Category"}),e.jsx(ps,{id:"category",name:"category",value:d.category,onChange:x})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"category_icon",children:"Category Icon"}),e.jsx(ps,{id:"category_icon",name:"category_icon",value:d.category_icon||"",onChange:x,placeholder:"e.g. Heart"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"name",children:"Name"}),e.jsx(ps,{id:"name",name:"name",value:d.name,onChange:x})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"description",children:"Description"}),e.jsx(_,{id:"description",name:"description",value:d.description,onChange:x})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"plan_tier",children:"Plan Tier"}),e.jsx(ps,{id:"plan_tier",name:"plan_tier",value:d.plan_tier||"",onChange:x,placeholder:"e.g. Premium"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"feature_icon",children:"Feature Icon"}),e.jsx(ps,{id:"feature_icon",name:"feature_icon",value:d.feature_icon||"",onChange:x,placeholder:"e.g. CheckCircle"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"display_order",children:"Display Order"}),e.jsx(ps,{id:"display_order",name:"display_order",type:"number",value:d.display_order,onChange:x})]})]})]}),e.jsxs(hs,{children:[e.jsx(b,{variant:"outline",onClick:()=>l(!1),children:"Cancel"}),e.jsx(b,{onClick:async()=>{const{error:e}=await y.from("features").upsert(d);e?N({title:"Error saving feature",description:e.message,variant:"destructive"}):(N({title:`Feature ${n?"updated":"created"} successfully`}),m(),l(!1))},children:"Save"})]})]})}),e.jsx(M,{className:"glass-effect",children:e.jsx(I,{className:"p-0",children:t?e.jsxs("div",{className:"flex justify-center items-center py-10",children:[e.jsx(Ee,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-4 text-lg",children:"Loading Features..."})]}):0===s.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(fe,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium",children:"No features found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new feature."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("th",{className:"p-4",children:"Name"}),e.jsx("th",{className:"p-4",children:"Category"}),e.jsx("th",{className:"p-4",children:"Description"}),e.jsx("th",{className:"p-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{children:s.map(s=>e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5",children:[e.jsx("td",{className:"p-4 font-medium",children:s.name}),e.jsx("td",{className:"p-4 text-text-secondary",children:s.category}),e.jsx("td",{className:"p-4 text-text-secondary truncate max-w-sm",children:s.description}),e.jsx("td",{className:"p-4 text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(b,{variant:"ghost",size:"icon",onClick:()=>h(s),children:e.jsx(ze,{className:"w-4 h-4"})}),e.jsx(b,{variant:"ghost",size:"icon",onClick:()=>(async e=>{const{error:s}=await y.from("features").delete().eq("id",e);s?N({title:"Error deleting feature",description:s.message,variant:"destructive"}):(N({title:"Feature deleted successfully"}),m())})(s.id),className:"text-red-400 hover:text-red-500",children:e.jsx(ee,{className:"w-4 h-4"})})]})})]},s.id))})]})})})})]})},Da=()=>{const[s,a]=g.useState([]),[t,i]=g.useState(!0),[r,l]=g.useState(!1),[n,c]=g.useState(null),[d,o]=g.useState({id:null,name:"",description:"",price_monthly:0,price_yearly:0,is_popular:!1,is_active:!0,features:"",display_order:0}),m=async()=>{i(!0);const{data:e,error:s}=await y.from("subscription_plans").select("*").order("display_order");s?N({title:"Error fetching pricing plans",description:s.message,variant:"destructive"}):a(e),i(!1)};g.useEffect(()=>{m()},[]);const x=e=>{const{name:s,value:a,type:t,checked:i}=e.target;o(e=>({...e,[s]:"checkbox"===t?i:a}))},h=(e=null)=>{c(e),o(e?{...e,features:Array.isArray(e.features)?e.features.join("\n"):""}:{id:null,name:"",description:"",price_monthly:0,price_yearly:0,is_popular:!1,is_active:!0,features:"",display_order:0}),l(!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Manage Pricing Plans"}),e.jsxs(b,{onClick:()=>h(),children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"New Plan"]})]}),e.jsx(cs,{open:r,onOpenChange:l,children:e.jsxs(ds,{className:"glass-effect",children:[e.jsx(os,{children:e.jsx(ms,{children:n?"Edit Plan":"Create New Plan"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"name",children:"Plan Name"}),e.jsx(ps,{id:"name",name:"name",value:d.name,onChange:x})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"description",children:"Description"}),e.jsx(ps,{id:"description",name:"description",value:d.description||"",onChange:x})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"price_monthly",children:"Monthly Price"}),e.jsx(ps,{id:"price_monthly",name:"price_monthly",type:"number",value:d.price_monthly,onChange:x})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"price_yearly",children:"Yearly Price (per month)"}),e.jsx(ps,{id:"price_yearly",name:"price_yearly",type:"number",value:d.price_yearly,onChange:x})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"features",children:"Features (one per line)"}),e.jsx(_,{id:"features",name:"features",value:d.features,onChange:e=>{o(s=>({...s,features:e.target.value}))},rows:8})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(gs,{id:"is_popular",name:"is_popular",checked:d.is_popular,onCheckedChange:e=>o(s=>({...s,is_popular:e}))}),e.jsx(js,{htmlFor:"is_popular",children:"Most Popular"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(gs,{id:"is_active",name:"is_active",checked:d.is_active,onCheckedChange:e=>o(s=>({...s,is_active:e}))}),e.jsx(js,{htmlFor:"is_active",children:"Active (shown on pricing page)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"display_order",children:"Display Order"}),e.jsx(ps,{id:"display_order",name:"display_order",type:"number",value:d.display_order,onChange:x})]})]}),e.jsxs(hs,{children:[e.jsx(b,{variant:"outline",onClick:()=>l(!1),children:"Cancel"}),e.jsx(b,{onClick:async()=>{const e={...d,features:"string"==typeof d.features?d.features.split("\n").filter(e=>""!==e.trim()):[]};e.id||delete e.id;const{error:s}=await y.from("subscription_plans").upsert(e);s?N({title:"Error saving plan",description:s.message,variant:"destructive"}):(N({title:`Plan ${n?"updated":"created"} successfully`}),m(),l(!1))},children:"Save"})]})]})}),e.jsx(M,{className:"glass-effect",children:e.jsx(I,{className:"p-0",children:t?e.jsxs("div",{className:"flex justify-center items-center py-10",children:[e.jsx(Ee,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-4 text-lg",children:"Loading Plans..."})]}):0===s.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(z,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium",children:"No plans found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new plan."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("th",{className:"p-4",children:"Name"}),e.jsx("th",{className:"p-4",children:"Monthly Price"}),e.jsx("th",{className:"p-4",children:"Yearly Price"}),e.jsx("th",{className:"p-4",children:"Popular"}),e.jsx("th",{className:"p-4",children:"Active"}),e.jsx("th",{className:"p-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{children:s.map(s=>e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5",children:[e.jsx("td",{className:"p-4 font-medium",children:s.name}),e.jsxs("td",{className:"p-4 text-text-secondary",children:["$",s.price_monthly]}),e.jsxs("td",{className:"p-4 text-text-secondary",children:["$",s.price_yearly]}),e.jsx("td",{className:"p-4",children:s.is_popular?"Yes":"No"}),e.jsx("td",{className:"p-4",children:s.is_active?e.jsx("span",{className:"text-green-400",children:"Yes"}):e.jsx("span",{className:"text-gray-500",children:"No"})}),e.jsx("td",{className:"p-4 text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(b,{variant:"ghost",size:"icon",onClick:()=>h(s),children:e.jsx(ze,{className:"w-4 h-4"})}),e.jsx(b,{variant:"ghost",size:"icon",onClick:()=>(async e=>{const{error:s}=await y.from("subscription_plans").delete().eq("id",e);s?N({title:"Error deleting plan",description:s.message,variant:"destructive"}):(N({title:"Plan deleted successfully"}),m())})(s.id),className:"text-red-400 hover:text-red-500",children:e.jsx(ee,{className:"w-4 h-4"})})]})})]},s.id))})]})})})})]})},Oa=()=>{const[s,a]=g.useState([]),[t,i]=g.useState(!0),[r,l]=g.useState(null),[n,c]=g.useState(!1),d=async()=>{try{i(!0);const{data:e,error:s}=await y.from("homepage_content").select("*").order("section_order",{ascending:!0});if(s)throw s;a(e||[])}catch(e){alert("Error loading homepage sections: "+e.message)}finally{i(!1)}};g.useEffect(()=>{d()},[]);return t?e.jsx("div",{className:"p-6",children:"Loading homepage sections..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Homepage Manager"}),e.jsx("p",{className:"text-text-secondary mt-1",children:"Manage hero sections, CTAs, and content blocks"})]}),e.jsxs(b,{onClick:()=>{l({section_type:"hero",section_order:s.length,is_active:!0,title:"",subtitle:"",description:"",cta_text:"",cta_link:""}),c(!0)},children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Add Section"]})]}),e.jsx("div",{className:"grid gap-4",children:0===s.length?e.jsx(M,{children:e.jsx(I,{className:"p-6",children:e.jsx("p",{className:"text-center text-text-secondary",children:'No sections yet. Click "Add Section" to create one.'})})}):s.map(s=>e.jsxs(M,{className:s.is_active?"":"opacity-60",children:[e.jsx(q,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(U,{className:"flex items-center gap-2",children:[s.title,e.jsx("span",{className:"text-xs font-normal px-2 py-1 bg-primary/10 rounded",children:s.section_type}),!s.is_active&&e.jsx("span",{className:"text-xs font-normal px-2 py-1 bg-yellow-500/10 text-yellow-600 rounded",children:"Inactive"})]}),s.subtitle&&e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:s.subtitle})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{size:"sm",variant:s.is_active?"outline":"default",onClick:()=>(async e=>{try{const{error:s}=await y.from("homepage_content").update({is_active:!e.is_active}).eq("id",e.id);if(s)throw s;d()}catch(s){alert("Error updating section: "+s.message)}})(s),children:s.is_active?"Hide":"Show"}),e.jsx(b,{size:"sm",variant:"outline",onClick:()=>(e=>{l({...e}),c(!0)})(s),children:e.jsx(Ve,{className:"w-4 h-4"})}),e.jsx(b,{size:"sm",variant:"destructive",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this section?"))try{const{error:s}=await y.from("homepage_content").delete().eq("id",e);if(s)throw s;d()}catch(s){alert("Error deleting section: "+s.message)}})(s.id),children:e.jsx(ee,{className:"w-4 h-4"})})]})]})}),e.jsxs(I,{children:[s.description&&e.jsx("p",{className:"text-sm text-text-secondary mb-2",children:s.description}),s.cta_text&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium",children:"CTA:"}),e.jsx("span",{className:"text-primary",children:s.cta_text}),s.cta_link&&e.jsxs("span",{className:"text-text-secondary",children:["→ ",s.cta_link]})]})]})]},s.id))}),e.jsx(cs,{open:n,onOpenChange:c,children:e.jsxs(ds,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(os,{children:e.jsx(ms,{children:(null==r?void 0:r.id)?"Edit Section":"Create New Section"})}),r&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(js,{children:"Section Type"}),e.jsxs(fs,{value:r.section_type,onValueChange:e=>l({...r,section_type:e}),children:[e.jsx(vs,{children:e.jsx(ys,{})}),e.jsxs(Ns,{children:[e.jsx(bs,{value:"hero",children:"Hero"}),e.jsx(bs,{value:"features",children:"Features"}),e.jsx(bs,{value:"cta",children:"Call to Action"}),e.jsx(bs,{value:"stats",children:"Statistics"}),e.jsx(bs,{value:"process",children:"Process"})]})]})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Title *"}),e.jsx(ps,{value:r.title,onChange:e=>l({...r,title:e.target.value}),placeholder:"Section title"})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Subtitle"}),e.jsx(ps,{value:r.subtitle||"",onChange:e=>l({...r,subtitle:e.target.value}),placeholder:"Section subtitle"})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Description"}),e.jsx(_,{value:r.description||"",onChange:e=>l({...r,description:e.target.value}),placeholder:"Section description",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(js,{children:"CTA Button Text"}),e.jsx(ps,{value:r.cta_text||"",onChange:e=>l({...r,cta_text:e.target.value}),placeholder:"Get Started"})]}),e.jsxs("div",{children:[e.jsx(js,{children:"CTA Button Link"}),e.jsx(ps,{value:r.cta_link||"",onChange:e=>l({...r,cta_link:e.target.value}),placeholder:"/signup"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ss,{checked:r.is_active,onCheckedChange:e=>l({...r,is_active:e})}),e.jsx(js,{children:"Active (visible on website)"})]})]}),e.jsxs(hs,{children:[e.jsxs(b,{variant:"outline",onClick:()=>c(!1),children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(b,{onClick:async()=>{try{if(!r.title)return void alert("Title is required");if(r.id){const{error:e}=await y.from("homepage_content").update({section_type:r.section_type,title:r.title,subtitle:r.subtitle,description:r.description,cta_text:r.cta_text,cta_link:r.cta_link,is_active:r.is_active}).eq("id",r.id);if(e)throw e}else{const{error:e}=await y.from("homepage_content").insert([r]);if(e)throw e}c(!1),l(null),d()}catch(e){alert("Error saving section: "+e.message)}},children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Save Section"]})]})]})})]})},$a=()=>{var s;const[a,t]=g.useState([]),[i,r]=g.useState(!0),[l,n]=g.useState(null),[c,d]=g.useState(!1),o=async()=>{try{r(!0);const{data:e,error:s}=await y.from("testimonials").select("*").order("display_order",{ascending:!0});if(s)throw s;t(e||[])}catch(e){alert("Error loading testimonials: "+e.message)}finally{r(!1)}};g.useEffect(()=>{o()},[]);return i?e.jsx("div",{className:"p-6",children:"Loading testimonials..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Testimonials Manager"}),e.jsx("p",{className:"text-text-secondary mt-1",children:"Manage customer reviews and testimonials"})]}),e.jsxs(b,{onClick:()=>{n({customer_name:"",customer_title:"",customer_company:"",quote:"",full_review:"",rating:5,category:"general",is_featured:!1,is_active:!0,verified:!1}),d(!0)},children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Add Testimonial"]})]}),e.jsx("div",{className:"grid gap-4",children:0===a.length?e.jsx(M,{children:e.jsx(I,{className:"p-6",children:e.jsx("p",{className:"text-center text-text-secondary",children:'No testimonials yet. Click "Add Testimonial" to create one.'})})}):a.map(s=>e.jsxs(M,{className:s.is_active?"":"opacity-60",children:[e.jsx(q,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(U,{className:"flex items-center gap-2",children:[s.customer_name,s.is_featured&&e.jsx("span",{className:"text-xs font-normal px-2 py-1 bg-yellow-500/10 text-yellow-600 rounded",children:"Featured"}),s.verified&&e.jsx("span",{className:"text-xs font-normal px-2 py-1 bg-green-500/10 text-green-600 rounded",children:"Verified"}),!s.is_active&&e.jsx("span",{className:"text-xs font-normal px-2 py-1 bg-gray-500/10 text-gray-600 rounded",children:"Hidden"})]}),s.customer_title&&e.jsxs("p",{className:"text-sm text-text-secondary",children:[s.customer_title,s.customer_company&&` at ${s.customer_company}`]}),e.jsx("div",{className:"flex items-center gap-1 mt-1",children:[...Array(5)].map((a,t)=>e.jsx(Ge,{className:"w-4 h-4 "+(t<s.rating?"fill-yellow-400 text-yellow-400":"text-gray-300")},t))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{size:"sm",variant:s.is_featured?"default":"outline",onClick:()=>(async e=>{try{const{error:s}=await y.from("testimonials").update({is_featured:!e.is_featured}).eq("id",e.id);if(s)throw s;o()}catch(s){alert("Error updating testimonial: "+s.message)}})(s),children:s.is_featured?"Unfeature":"Feature"}),e.jsx(b,{size:"sm",variant:"outline",onClick:()=>(e=>{n({...e}),d(!0)})(s),children:e.jsx(Ve,{className:"w-4 h-4"})}),e.jsx(b,{size:"sm",variant:"destructive",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this testimonial?"))try{const{error:s}=await y.from("testimonials").delete().eq("id",e);if(s)throw s;o()}catch(s){alert("Error deleting testimonial: "+s.message)}})(s.id),children:e.jsx(ee,{className:"w-4 h-4"})})]})]})}),e.jsxs(I,{children:[e.jsxs("p",{className:"italic text-text-secondary",children:['"',s.quote,'"']}),s.category&&e.jsxs("p",{className:"text-xs text-text-secondary mt-2",children:["Category: ",s.category]})]})]},s.id))}),e.jsx(cs,{open:c,onOpenChange:d,children:e.jsxs(ds,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(os,{children:e.jsx(ms,{children:(null==l?void 0:l.id)?"Edit Testimonial":"Create New Testimonial"})}),l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(js,{children:"Customer Name *"}),e.jsx(ps,{value:l.customer_name,onChange:e=>n({...l,customer_name:e.target.value}),placeholder:"John Doe"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(js,{children:"Title/Role"}),e.jsx(ps,{value:l.customer_title||"",onChange:e=>n({...l,customer_title:e.target.value}),placeholder:"CEO, Fitness Enthusiast, etc."})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Company"}),e.jsx(ps,{value:l.customer_company||"",onChange:e=>n({...l,customer_company:e.target.value}),placeholder:"Company Name"})]})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Quote *"}),e.jsx(_,{value:l.quote,onChange:e=>n({...l,quote:e.target.value}),placeholder:"Short testimonial quote...",rows:3})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Full Review (Optional)"}),e.jsx(_,{value:l.full_review||"",onChange:e=>n({...l,full_review:e.target.value}),placeholder:"Full detailed review...",rows:4})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(js,{children:"Rating"}),e.jsxs(fs,{value:(null==(s=l.rating)?void 0:s.toString())||"5",onValueChange:e=>n({...l,rating:parseInt(e)}),children:[e.jsx(vs,{children:e.jsx(ys,{})}),e.jsxs(Ns,{children:[e.jsx(bs,{value:"5",children:"5 Stars"}),e.jsx(bs,{value:"4",children:"4 Stars"}),e.jsx(bs,{value:"3",children:"3 Stars"}),e.jsx(bs,{value:"2",children:"2 Stars"}),e.jsx(bs,{value:"1",children:"1 Star"})]})]})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Category"}),e.jsxs(fs,{value:l.category,onValueChange:e=>n({...l,category:e}),children:[e.jsx(vs,{children:e.jsx(ys,{})}),e.jsxs(Ns,{children:[e.jsx(bs,{value:"general",children:"General"}),e.jsx(bs,{value:"nutrition",children:"Nutrition"}),e.jsx(bs,{value:"fitness",children:"Fitness"}),e.jsx(bs,{value:"wellness",children:"Wellness"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ss,{checked:l.is_featured,onCheckedChange:e=>n({...l,is_featured:e})}),e.jsx(js,{children:"Featured (show on homepage)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ss,{checked:l.verified,onCheckedChange:e=>n({...l,verified:e})}),e.jsx(js,{children:"Verified"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ss,{checked:l.is_active,onCheckedChange:e=>n({...l,is_active:e})}),e.jsx(js,{children:"Active (visible on website)"})]})]})]}),e.jsxs(hs,{children:[e.jsxs(b,{variant:"outline",onClick:()=>d(!1),children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(b,{onClick:async()=>{try{if(!l.customer_name||!l.quote)return void alert("Customer name and quote are required");if(l.id){const{error:e}=await y.from("testimonials").update({customer_name:l.customer_name,customer_title:l.customer_title,customer_company:l.customer_company,quote:l.quote,full_review:l.full_review,rating:l.rating,category:l.category,is_featured:l.is_featured,is_active:l.is_active,verified:l.verified}).eq("id",l.id);if(e)throw e}else{const{error:e}=await y.from("testimonials").insert([l]);if(e)throw e}d(!1),n(null),o()}catch(e){alert("Error saving testimonial: "+e.message)}},children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Save Testimonial"]})]})]})})]})},za=()=>{const[s,a]=g.useState(null),[t,i]=g.useState(!0),[r,l]=g.useState(!1),n=async()=>{try{i(!0);const{data:e,error:s}=await y.from("contact_info").select("*").eq("is_active",!0).single();if(s&&"PGRST116"!==s.code)throw s;a(e||{email:"",phone:"",address:"",city:"",state:"",country:"",postal_code:"",facebook_url:"",twitter_url:"",instagram_url:"",linkedin_url:"",youtube_url:"",tiktok_url:"",is_active:!0})}catch(e){alert("Error loading contact info: "+e.message)}finally{i(!1)}};g.useEffect(()=>{n()},[]);const c=(e,t)=>{a({...s,[e]:t})};return t?e.jsx("div",{className:"p-6",children:"Loading contact information..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Contact Information Manager"}),e.jsx("p",{className:"text-text-secondary mt-1",children:"Update contact details and social media links"})]}),e.jsxs(b,{onClick:async()=>{try{if(l(!0),s.id){const{error:e}=await y.from("contact_info").update({email:s.email,phone:s.phone,address:s.address,city:s.city,state:s.state,country:s.country,postal_code:s.postal_code,facebook_url:s.facebook_url,twitter_url:s.twitter_url,instagram_url:s.instagram_url,linkedin_url:s.linkedin_url,youtube_url:s.youtube_url,tiktok_url:s.tiktok_url}).eq("id",s.id);if(e)throw e}else{const{error:e}=await y.from("contact_info").insert([s]);if(e)throw e}alert("Contact information saved successfully!"),n()}catch(e){alert("Error saving contact info: "+e.message)}finally{l(!1)}},disabled:r,children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),r?"Saving...":"Save Changes"]})]}),s&&e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(M,{children:[e.jsx(q,{children:e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5"}),"Contact Details"]})}),e.jsx(I,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(js,{children:"Email Address"}),e.jsx(ps,{type:"email",value:s.email||"",onChange:e=>c("email",e.target.value),placeholder:"support@example.com"})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Phone Number"}),e.jsx(ps,{type:"tel",value:s.phone||"",onChange:e=>c("phone",e.target.value),placeholder:"+1 (555) 123-4567"})]})]})})]}),e.jsxs(M,{children:[e.jsx(q,{children:e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5"}),"Physical Address"]})}),e.jsxs(I,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(js,{children:"Street Address"}),e.jsx(ps,{value:s.address||"",onChange:e=>c("address",e.target.value),placeholder:"123 Main Street"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(js,{children:"City"}),e.jsx(ps,{value:s.city||"",onChange:e=>c("city",e.target.value),placeholder:"San Francisco"})]}),e.jsxs("div",{children:[e.jsx(js,{children:"State/Province"}),e.jsx(ps,{value:s.state||"",onChange:e=>c("state",e.target.value),placeholder:"CA"})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Postal Code"}),e.jsx(ps,{value:s.postal_code||"",onChange:e=>c("postal_code",e.target.value),placeholder:"94102"})]})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Country"}),e.jsx(ps,{value:s.country||"",onChange:e=>c("country",e.target.value),placeholder:"USA"})]})]})]}),e.jsxs(M,{children:[e.jsx(q,{children:e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"Social Media Links"]})}),e.jsx(I,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(js,{children:"Facebook URL"}),e.jsx(ps,{type:"url",value:s.facebook_url||"",onChange:e=>c("facebook_url",e.target.value),placeholder:"https://facebook.com/yourpage"})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Twitter/X URL"}),e.jsx(ps,{type:"url",value:s.twitter_url||"",onChange:e=>c("twitter_url",e.target.value),placeholder:"https://twitter.com/yourhandle"})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Instagram URL"}),e.jsx(ps,{type:"url",value:s.instagram_url||"",onChange:e=>c("instagram_url",e.target.value),placeholder:"https://instagram.com/yourhandle"})]}),e.jsxs("div",{children:[e.jsx(js,{children:"LinkedIn URL"}),e.jsx(ps,{type:"url",value:s.linkedin_url||"",onChange:e=>c("linkedin_url",e.target.value),placeholder:"https://linkedin.com/company/yourcompany"})]}),e.jsxs("div",{children:[e.jsx(js,{children:"YouTube URL"}),e.jsx(ps,{type:"url",value:s.youtube_url||"",onChange:e=>c("youtube_url",e.target.value),placeholder:"https://youtube.com/@yourchannel"})]}),e.jsxs("div",{children:[e.jsx(js,{children:"TikTok URL"}),e.jsx(ps,{type:"url",value:s.tiktok_url||"",onChange:e=>c("tiktok_url",e.target.value),placeholder:"https://tiktok.com/@yourhandle"})]})]})})]})]})]})},Va=()=>{const[s,a]=g.useState([]),[t,i]=g.useState(!0),[r,l]=g.useState(null),[n,c]=g.useState(!1),d=async()=>{try{i(!0);const{data:e,error:s}=await y.from("seo_settings").select("*").order("page_path",{ascending:!0});if(s)throw s;a(e||[])}catch(e){alert("Error loading SEO settings: "+e.message)}finally{i(!1)}};g.useEffect(()=>{d()},[]);const o=(e,s)=>{l({...r,[e]:s})};return t?e.jsx("div",{className:"p-6",children:"Loading SEO settings..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"SEO Settings Manager"}),e.jsx("p",{className:"text-text-secondary mt-1",children:"Manage meta tags and SEO for each page"})]}),e.jsxs(b,{onClick:()=>{l({page_path:"/",page_name:"",meta_title:"",meta_description:"",og_title:"",og_description:"",og_image_url:"",twitter_title:"",twitter_description:"",twitter_image_url:"",canonical_url:"",robots_meta:"index,follow",sitemap_priority:.5,sitemap_changefreq:"weekly",is_active:!0}),c(!0)},children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Add Page SEO"]})]}),e.jsx("div",{className:"grid gap-4",children:0===s.length?e.jsx(M,{children:e.jsx(I,{className:"p-6",children:e.jsx("p",{className:"text-center text-text-secondary",children:'No SEO settings yet. Click "Add Page SEO" to create one.'})})}):s.map(s=>e.jsxs(M,{className:s.is_active?"":"opacity-60",children:[e.jsx(q,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(U,{className:"flex items-center gap-2",children:[s.page_name,e.jsx("span",{className:"text-xs font-normal px-2 py-1 bg-primary/10 rounded",children:s.page_path}),!s.is_active&&e.jsx("span",{className:"text-xs font-normal px-2 py-1 bg-gray-500/10 text-gray-600 rounded",children:"Inactive"})]}),s.meta_description&&e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:s.meta_description})]}),e.jsx(b,{size:"sm",variant:"outline",onClick:()=>(e=>{l({...e}),c(!0)})(s),children:e.jsx(Ve,{className:"w-4 h-4"})})]})}),e.jsx(I,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Meta Title:"}),e.jsx("p",{className:"text-text-secondary",children:s.meta_title||"Not set"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Sitemap Priority:"}),e.jsxs("p",{className:"text-text-secondary",children:[s.sitemap_priority," (",s.sitemap_changefreq,")"]})]})]})})]},s.id))}),e.jsx(cs,{open:n,onOpenChange:c,children:e.jsxs(ds,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(os,{children:e.jsx(ms,{children:(null==r?void 0:r.id)?"Edit SEO Settings":"Create New SEO Settings"})}),r&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold",children:"Page Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(js,{children:"Page Path *"}),e.jsx(ps,{value:r.page_path,onChange:e=>o("page_path",e.target.value),placeholder:"/about"})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Page Name *"}),e.jsx(ps,{value:r.page_name,onChange:e=>o("page_name",e.target.value),placeholder:"About Page"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold",children:"Meta Tags"}),e.jsxs("div",{children:[e.jsx(js,{children:"Meta Title"}),e.jsx(ps,{value:r.meta_title||"",onChange:e=>o("meta_title",e.target.value),placeholder:"Page Title - Site Name"})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Meta Description"}),e.jsx(_,{value:r.meta_description||"",onChange:e=>o("meta_description",e.target.value),placeholder:"Brief description of the page (150-160 characters)",rows:2})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold",children:"Open Graph (Facebook)"}),e.jsxs("div",{children:[e.jsx(js,{children:"OG Title"}),e.jsx(ps,{value:r.og_title||"",onChange:e=>o("og_title",e.target.value),placeholder:"Title for social media sharing"})]}),e.jsxs("div",{children:[e.jsx(js,{children:"OG Description"}),e.jsx(_,{value:r.og_description||"",onChange:e=>o("og_description",e.target.value),placeholder:"Description for social media sharing",rows:2})]}),e.jsxs("div",{children:[e.jsx(js,{children:"OG Image URL"}),e.jsx(ps,{type:"url",value:r.og_image_url||"",onChange:e=>o("og_image_url",e.target.value),placeholder:"https://example.com/image.jpg"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold",children:"Twitter Card"}),e.jsxs("div",{children:[e.jsx(js,{children:"Twitter Title"}),e.jsx(ps,{value:r.twitter_title||"",onChange:e=>o("twitter_title",e.target.value),placeholder:"Title for Twitter"})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Twitter Description"}),e.jsx(_,{value:r.twitter_description||"",onChange:e=>o("twitter_description",e.target.value),placeholder:"Description for Twitter",rows:2})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Twitter Image URL"}),e.jsx(ps,{type:"url",value:r.twitter_image_url||"",onChange:e=>o("twitter_image_url",e.target.value),placeholder:"https://example.com/image.jpg"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold",children:"Advanced Settings"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(js,{children:"Canonical URL"}),e.jsx(ps,{type:"url",value:r.canonical_url||"",onChange:e=>o("canonical_url",e.target.value),placeholder:"https://example.com/page"})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Robots Meta"}),e.jsx(ps,{value:r.robots_meta,onChange:e=>o("robots_meta",e.target.value),placeholder:"index,follow"})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Sitemap Priority (0.0-1.0)"}),e.jsx(ps,{type:"number",step:"0.1",min:"0",max:"1",value:r.sitemap_priority,onChange:e=>o("sitemap_priority",parseFloat(e.target.value))})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Change Frequency"}),e.jsxs("select",{className:"w-full border rounded px-3 py-2",value:r.sitemap_changefreq,onChange:e=>o("sitemap_changefreq",e.target.value),children:[e.jsx("option",{value:"always",children:"Always"}),e.jsx("option",{value:"hourly",children:"Hourly"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"yearly",children:"Yearly"}),e.jsx("option",{value:"never",children:"Never"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ss,{checked:r.is_active,onCheckedChange:e=>o("is_active",e)}),e.jsx(js,{children:"Active"})]})]})]}),e.jsxs(hs,{children:[e.jsxs(b,{variant:"outline",onClick:()=>c(!1),children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(b,{onClick:async()=>{try{if(!r.page_path||!r.page_name)return void alert("Page path and name are required");if(r.id){const{error:e}=await y.from("seo_settings").update({page_path:r.page_path,page_name:r.page_name,meta_title:r.meta_title,meta_description:r.meta_description,og_title:r.og_title,og_description:r.og_description,og_image_url:r.og_image_url,twitter_title:r.twitter_title,twitter_description:r.twitter_description,twitter_image_url:r.twitter_image_url,canonical_url:r.canonical_url,robots_meta:r.robots_meta,sitemap_priority:r.sitemap_priority,sitemap_changefreq:r.sitemap_changefreq,is_active:r.is_active}).eq("id",r.id);if(e)throw e}else{const{error:e}=await y.from("seo_settings").insert([r]);if(e)throw e}c(!1),l(null),d()}catch(e){alert("Error saving SEO settings: "+e.message)}},children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Save Settings"]})]})]})})]})},Ga=[{question:"What is GreenoFig and how does it work?",answer:"GreenoFig is an AI-powered health and wellness platform that creates personalized meal plans, workout routines, and provides 24/7 AI coaching. Simply complete our onboarding survey, and our AI will generate a customized plan based on your goals, dietary preferences, and fitness level."},{question:"How much does GreenoFig cost?",answer:"We offer three subscription tiers: Premium ($9.99/month), Pro ($19.99/month), and Elite ($29.99/month). All plans include access to personalized meal plans and workouts. Higher tiers unlock features like AI coach chat, wearable integration, and photo food recognition. Save 25% with annual billing!"},{question:"Can I cancel my subscription at any time?",answer:"Yes! You can cancel your GreenoFig subscription at any time from your account settings. There are no cancellation fees, and you'll continue to have access until the end of your current billing period."},{question:"Is GreenoFig suitable for people with dietary restrictions?",answer:"Absolutely! GreenoFig supports various dietary preferences including vegan, vegetarian, keto, paleo, gluten-free, dairy-free, and more. During onboarding, you can specify your dietary restrictions and food allergies, and our AI will create meal plans that fit your needs."},{question:"Do I need special equipment for the workout plans?",answer:"No special equipment is required! Our AI generates workout plans based on what you have available. During setup, you can specify if you have access to a gym, home equipment, or prefer bodyweight exercises only. The AI adapts accordingly."},{question:"How does the AI coach work?",answer:"Our AI coach (available in Pro and Elite plans) is available 24/7 to answer questions, provide motivation, and help you stay on track. You can chat about nutrition, workouts, progress, or general health questions. The AI learns from your interactions to provide increasingly personalized guidance."},{question:"Can I sync GreenoFig with my fitness tracker or smartwatch?",answer:"Yes! Pro and Elite plans include wearable integration. GreenoFig syncs with popular devices like Apple Watch, Fitbit, Garmin, and more. This allows us to track your activity, calories burned, and sleep patterns to optimize your personalized plan."},{question:"What makes GreenoFig different from other health apps?",answer:"GreenoFig combines advanced AI with comprehensive wellness features. Unlike basic calorie counters or generic workout apps, we provide hyper-personalized meal plans, adaptive workouts, 24/7 AI coaching, and real-time plan adjustments based on your progress. Everything is tailored specifically to you."},{question:"Is my health data secure and private?",answer:"Yes, your privacy is our top priority. We use industry-standard encryption to protect your data. We never sell your personal information to third parties. All health data is stored securely and used only to personalize your experience. See our Privacy Policy for full details."},{question:"How quickly will I see results?",answer:"Results vary based on your goals and commitment, but most users report feeling more energized within the first week and seeing physical changes within 2-4 weeks. Our AI tracks your progress and adjusts your plan to ensure steady, sustainable results. Consistency is key!"}],Ba=({pageKey:s,pageName:a})=>{var t,i,r,l,n,c;const[d,o]=g.useState(null),[m,x]=g.useState(!0),h=g.useCallback(async()=>{x(!0);const{data:e,error:t}=await y.from("site_content").select("content").eq("page_key",s).single();t&&"PGRST116"!==t.code?N({title:`Error fetching ${a} content`,description:t.message,variant:"destructive"}):o("faq_page"===s?(null==e?void 0:e.content)||{faqs:[]}:"privacy_policy"===s||"terms_of_service"===s?(null==e?void 0:e.content)||{sections:[]}:"about_page"===s?(null==e?void 0:e.content)||{title:"",description:"",sections:[]}:(null==e?void 0:e.content)||{}),x(!1)},[s,a]);g.useEffect(()=>{h()},[h]);const u=(e,s,a)=>{const t=[...d.faqs];t[e][s]=a,o({...d,faqs:t})},p=(e,s)=>{o(a=>({...a,[e]:s}))},j=(e,s,a)=>{const t=[...d.sections||[]];t[e][s]=a,o({...d,sections:t})},f=()=>{o({...d,sections:[...d.sections||[],{title:"",content:""}]})},v=e=>{const s=(d.sections||[]).filter((s,a)=>a!==e);o({...d,sections:s})};return m?e.jsxs("div",{className:"flex items-center justify-center py-10",children:[e.jsx(Ee,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-4 text-lg",children:"Loading Content..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"faq_page"===s?"FAQ Page Manager":"about_page"===s?"About Us Page Manager":"privacy_policy"===s?"Privacy Policy Manager":"terms_of_service"===s?"Terms of Service Manager":`Manage ${a}`}),e.jsxs("div",{className:"flex gap-2",children:["faq_page"===s&&e.jsxs(b,{onClick:()=>{o({faqs:Ga}),N({title:"✅ 10 Default FAQs loaded!",description:'⚠️ IMPORTANT: Click "Save Content" button now to store them in the database!',duration:1e4})},variant:"outline",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Load 10 Default FAQs"]}),e.jsx(b,{onClick:async()=>{const{data:e,error:t}=await y.from("site_content").upsert({page_key:s,content:d},{onConflict:"page_key"}).select();N(t?{title:`Error saving ${a} content`,description:`${t.message} (Code: ${t.code})`,variant:"destructive"}:{title:`${a} content saved successfully`})},children:"Save Content"})]})]}),"about_page"===s&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(M,{className:"glass-effect p-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"about-title",children:"Page Title"}),e.jsx(ps,{id:"about-title",value:(null==d?void 0:d.title)||"",onChange:e=>p("title",e.target.value),placeholder:"e.g., About GreenoFig"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"about-description",children:"Page Description"}),e.jsx(_,{id:"about-description",value:(null==d?void 0:d.description)||"",onChange:e=>p("description",e.target.value),rows:3,placeholder:"Brief description that appears below the title"})]})]}),e.jsx("div",{className:"glass-effect p-4 rounded-lg",children:e.jsxs("p",{className:"text-text-secondary",children:[e.jsx("strong",{children:"Total Sections:"})," ",(null==(t=null==d?void 0:d.sections)?void 0:t.length)||0]})}),null==(i=null==d?void 0:d.sections)?void 0:i.map((s,a)=>e.jsx(M,{className:"glass-effect",children:e.jsxs(I,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-lg font-bold text-primary",children:["Section #",a+1]}),e.jsx(b,{variant:"ghost",size:"icon",onClick:()=>v(a),className:"text-red-400 hover:text-red-500",children:e.jsx(ee,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:`about-section-title-${a}`,children:"Section Title"}),e.jsx(ps,{id:`about-section-title-${a}`,value:s.title,onChange:e=>j(a,"title",e.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:`about-section-content-${a}`,children:"Section Content"}),e.jsx(_,{id:`about-section-content-${a}`,value:s.content,onChange:e=>j(a,"content",e.target.value),rows:6})]})]})},a)),e.jsxs(b,{onClick:f,variant:"outline",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Add Section"]})]}),"faq_page"===s&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"glass-effect p-4 rounded-lg",children:e.jsxs("p",{className:"text-text-secondary",children:[e.jsx("strong",{children:"Total FAQs:"})," ",(null==(r=null==d?void 0:d.faqs)?void 0:r.length)||0]})}),null==(l=null==d?void 0:d.faqs)?void 0:l.map((s,a)=>e.jsx(M,{className:"glass-effect",children:e.jsxs(I,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-lg font-bold text-primary",children:["FAQ #",a+1]}),e.jsx(b,{variant:"ghost",size:"icon",onClick:()=>(e=>{const s=d.faqs.filter((s,a)=>a!==e);o({...d,faqs:s})})(a),className:"text-red-400 hover:text-red-500",children:e.jsx(ee,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:`question-${a}`,children:"Question"}),e.jsx(ps,{id:`question-${a}`,value:s.question,onChange:e=>u(a,"question",e.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:`answer-${a}`,children:"Answer"}),e.jsx(_,{id:`answer-${a}`,value:s.answer,onChange:e=>u(a,"answer",e.target.value),rows:4})]})]})},a)),e.jsxs(b,{onClick:()=>{o({...d,faqs:[...d.faqs||[],{question:"",answer:""}]})},variant:"outline",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Add FAQ"]})]}),("privacy_policy"===s||"terms_of_service"===s)&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"glass-effect p-4 rounded-lg",children:e.jsxs("p",{className:"text-text-secondary",children:[e.jsx("strong",{children:"Total Sections:"})," ",(null==(n=null==d?void 0:d.sections)?void 0:n.length)||0]})}),null==(c=null==d?void 0:d.sections)?void 0:c.map((s,a)=>e.jsx(M,{className:"glass-effect",children:e.jsxs(I,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-lg font-bold text-primary",children:["Section #",a+1]}),e.jsx(b,{variant:"ghost",size:"icon",onClick:()=>v(a),className:"text-red-400 hover:text-red-500",children:e.jsx(ee,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:`section-title-${a}`,children:"Section Title"}),e.jsx(ps,{id:`section-title-${a}`,value:s.title,onChange:e=>j(a,"title",e.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:`section-content-${a}`,children:"Section Content"}),e.jsx(_,{id:`section-content-${a}`,value:s.content,onChange:e=>j(a,"content",e.target.value),rows:6})]})]})},a)),e.jsxs(b,{onClick:f,variant:"outline",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Add Section"]})]})]})},Wa=()=>{const s=f();v();const[a,t]=g.useState("main"),[i,r]=g.useState(""),l={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},n={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}},c=e=>{r(e),t("siteContent")};return e.jsxs(V.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3},children:["main"!==a&&e.jsxs(b,{variant:"ghost",onClick:()=>t("main"),className:"mb-6",children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),"Back to Website Management"]}),(()=>{switch(a){case"features":return e.jsx(La,{});case"pricing":return e.jsx(Da,{});case"homepage":return e.jsx(Oa,{});case"testimonials":return e.jsx($a,{});case"contact":return e.jsx(za,{});case"seo":return e.jsx(Va,{});case"siteContent":return e.jsx(Ba,{pageKey:i,pageName:`${i.charAt(0).toUpperCase()+i.slice(1)} Page`});default:return e.jsxs(V.div,{variants:l,initial:"hidden",animate:"visible",className:"space-y-6",children:[e.jsx(V.div,{variants:n,children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Website Content Management"}),e.jsx("p",{className:"text-text-secondary mt-1",children:"Update content across your public-facing website pages."})]}),e.jsxs(b,{variant:"ghost",onClick:()=>s("/app/admin?tab=dashboard"),children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),"Back to Dashboard"]})]})}),e.jsxs(V.div,{variants:n,className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs(M,{className:"glass-effect hover:border-primary/50 transition-colors",children:[e.jsx(q,{children:e.jsxs(U,{className:"flex items-center gap-3",children:[e.jsx(He,{className:"w-6 h-6 text-primary"}),e.jsx("span",{children:"Homepage"})]})}),e.jsxs(I,{children:[e.jsx("p",{className:"text-text-secondary mb-4",children:"Manage homepage sections, hero, CTAs, and content blocks."}),e.jsx(b,{onClick:()=>t("homepage"),children:"Manage Homepage"})]})]}),e.jsxs(M,{className:"glass-effect hover:border-primary/50 transition-colors",children:[e.jsx(q,{children:e.jsxs(U,{className:"flex items-center gap-3",children:[e.jsx(fe,{className:"w-6 h-6 text-primary"}),e.jsx("span",{children:"Features Page"})]})}),e.jsxs(I,{children:[e.jsx("p",{className:"text-text-secondary mb-4",children:"Manage the list of features displayed on the features page."}),e.jsx(b,{onClick:()=>t("features"),children:"Manage Features"})]})]}),e.jsxs(M,{className:"glass-effect hover:border-primary/50 transition-colors",children:[e.jsx(q,{children:e.jsxs(U,{className:"flex items-center gap-3",children:[e.jsx(z,{className:"w-6 h-6 text-primary"}),e.jsx("span",{children:"Pricing Page"})]})}),e.jsxs(I,{children:[e.jsx("p",{className:"text-text-secondary mb-4",children:"Update pricing plans, features, and popular status."}),e.jsx(b,{onClick:()=>t("pricing"),children:"Manage Pricing"})]})]}),e.jsxs(M,{className:"glass-effect hover:border-primary/50 transition-colors",children:[e.jsx(q,{children:e.jsxs(U,{className:"flex items-center gap-3",children:[e.jsx(Oe,{className:"w-6 h-6 text-primary"}),e.jsx("span",{children:"Testimonials"})]})}),e.jsxs(I,{children:[e.jsx("p",{className:"text-text-secondary mb-4",children:"Manage customer reviews, ratings, and testimonials."}),e.jsx(b,{onClick:()=>t("testimonials"),children:"Manage Testimonials"})]})]}),e.jsxs(M,{className:"glass-effect hover:border-primary/50 transition-colors",children:[e.jsx(q,{children:e.jsxs(U,{className:"flex items-center gap-3",children:[e.jsx(Qe,{className:"w-6 h-6 text-primary"}),e.jsx("span",{children:"Contact Info"})]})}),e.jsxs(I,{children:[e.jsx("p",{className:"text-text-secondary mb-4",children:"Update contact details, social links, and business hours."}),e.jsx(b,{onClick:()=>t("contact"),children:"Manage Contact"})]})]}),e.jsxs(M,{className:"glass-effect hover:border-primary/50 transition-colors",children:[e.jsx(q,{children:e.jsxs(U,{className:"flex items-center gap-3",children:[e.jsx(Q,{className:"w-6 h-6 text-primary"}),e.jsx("span",{children:"SEO Settings"})]})}),e.jsxs(I,{children:[e.jsx("p",{className:"text-text-secondary mb-4",children:"Manage meta tags, Open Graph, and SEO for all pages."}),e.jsx(b,{onClick:()=>t("seo"),children:"Manage SEO"})]})]}),e.jsxs(M,{className:"glass-effect hover:border-primary/50 transition-colors",children:[e.jsx(q,{children:e.jsxs(U,{className:"flex items-center gap-3",children:[e.jsx(Ye,{className:"w-6 h-6 text-primary"}),e.jsx("span",{children:"About Page"})]})}),e.jsxs(I,{children:[e.jsx("p",{className:"text-text-secondary mb-4",children:"Edit the content of the About Us page."}),e.jsx(b,{onClick:()=>c("about_page"),children:"Manage About Page"})]})]}),e.jsxs(M,{className:"glass-effect hover:border-primary/50 transition-colors",children:[e.jsx(q,{children:e.jsxs(U,{className:"flex items-center gap-3",children:[e.jsx(Je,{className:"w-6 h-6 text-primary"}),e.jsx("span",{children:"FAQ Page"})]})}),e.jsxs(I,{children:[e.jsx("p",{className:"text-text-secondary mb-4",children:"Add, edit, or remove FAQ items."}),e.jsx(b,{onClick:()=>c("faq_page"),children:"Manage FAQs"})]})]}),e.jsxs(M,{className:"glass-effect hover:border-primary/50 transition-colors",children:[e.jsx(q,{children:e.jsxs(U,{className:"flex items-center gap-3",children:[e.jsx(Ke,{className:"w-6 h-6 text-primary"}),e.jsx("span",{children:"Privacy Policy"})]})}),e.jsxs(I,{children:[e.jsx("p",{className:"text-text-secondary mb-4",children:"Edit Privacy Policy content and sections."}),e.jsx(b,{onClick:()=>c("privacy_policy"),children:"Manage Privacy Policy"})]})]}),e.jsxs(M,{className:"glass-effect hover:border-primary/50 transition-colors",children:[e.jsx(q,{children:e.jsxs(U,{className:"flex items-center gap-3",children:[e.jsx(Xe,{className:"w-6 h-6 text-primary"}),e.jsx("span",{children:"Terms of Service"})]})}),e.jsxs(I,{children:[e.jsx("p",{className:"text-text-secondary mb-4",children:"Edit Terms of Service content and sections."}),e.jsx(b,{onClick:()=>c("terms_of_service"),children:"Manage Terms of Service"})]})]})]})]})}})()]},a)},Ha=()=>{const[s,a]=g.useState([]),[t,i]=g.useState([]),[r,l]=g.useState(!0),[n,c]=g.useState(""),[d,o]=g.useState(!1),[m,x]=g.useState(null),[h,u]=g.useState({code:"",discountType:"percentage",discountValue:"",isRecurring:!1,maxUses:"",maxUsesPerUser:"1",minPurchaseAmount:"",applicablePlans:[],validFrom:(new Date).toISOString().split("T")[0],validUntil:"",description:"",internalNotes:""}),p=async()=>{l(!0);const{data:e,error:s}=await y.from("coupon_codes").select("*, coupon_redemptions(count)").order("created_at",{ascending:!1});s?N({title:"Error fetching coupons",description:s.message,variant:"destructive"}):a(e||[]),l(!1)};g.useEffect(()=>{p()},[]),g.useEffect(()=>{const e=s.filter(e=>{var s;return e.code.toLowerCase().includes(n.toLowerCase())||(null==(s=e.description)?void 0:s.toLowerCase().includes(n.toLowerCase()))});i(e)},[n,s]);const j=()=>{u({code:"",discountType:"percentage",discountValue:"",isRecurring:!1,maxUses:"",maxUsesPerUser:"1",minPurchaseAmount:"",applicablePlans:[],validFrom:(new Date).toISOString().split("T")[0],validUntil:"",description:"",internalNotes:""}),x(null)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Coupon Codes"}),e.jsx("p",{className:"text-text-secondary",children:"Create and manage discount codes"})]}),e.jsxs(b,{onClick:()=>{j(),o(!0)},className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4"}),"New Coupon"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(ps,{placeholder:"Search coupons...",value:n,onChange:e=>c(e.target.value),className:"pl-10 glass-effect"})]}),r?e.jsx("div",{className:"text-center py-8",children:"Loading coupons..."}):e.jsxs("div",{className:"grid gap-4",children:[t.map(s=>e.jsx(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsx(M,{className:"glass-effect",children:e.jsx(I,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-primary"}),e.jsx("code",{className:"text-xl font-bold",children:s.code})]}),e.jsx(b,{variant:"ghost",size:"icon",onClick:()=>{return e=s.code,navigator.clipboard.writeText(e),void N({title:"Code copied to clipboard!"});var e},className:"h-6 w-6",children:e.jsx(Ze,{className:"w-3 h-3"})}),e.jsx(P,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"}),s.is_recurring&&e.jsx(P,{variant:"outline",children:"Recurring"})]}),s.description&&e.jsx("p",{className:"text-sm text-text-secondary mb-3",children:s.description}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:["percentage"===s.discount_type?e.jsx(es,{className:"w-4 h-4 text-green-400"}):e.jsx(z,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{children:"percentage"===s.discount_type?`${s.discount_value}% off`:`$${s.discount_value} off`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4 text-blue-400"}),e.jsxs("span",{children:[s.current_uses,"/",s.max_uses||"∞"," uses"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-purple-400"}),e.jsx("span",{children:s.valid_until?`Until ${new Date(s.valid_until).toLocaleDateString()}`:"No expiry"})]}),s.min_purchase_amount&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-yellow-400"}),e.jsxs("span",{children:["Min: $",s.min_purchase_amount]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{variant:"ghost",size:"icon",onClick:()=>(async e=>{const{error:s}=await y.from("coupon_codes").update({is_active:!e.is_active}).eq("id",e.id);s?N({title:"Error updating coupon",description:s.message,variant:"destructive"}):(N({title:e.is_active?"Coupon deactivated":"Coupon activated"}),p())})(s),title:s.is_active?"Deactivate":"Activate",children:s.is_active?e.jsx(ke,{className:"w-4 h-4 text-green-400"}):e.jsx(Se,{className:"w-4 h-4 text-gray-400"})}),e.jsx(b,{variant:"ghost",size:"icon",onClick:()=>(e=>{var s,a;x(e),u({code:e.code,discountType:e.discount_type,discountValue:e.discount_value.toString(),isRecurring:e.is_recurring,maxUses:(null==(s=e.max_uses)?void 0:s.toString())||"",maxUsesPerUser:e.max_uses_per_user.toString(),minPurchaseAmount:(null==(a=e.min_purchase_amount)?void 0:a.toString())||"",applicablePlans:e.applicable_plans||[],validFrom:e.valid_from?new Date(e.valid_from).toISOString().split("T")[0]:"",validUntil:e.valid_until?new Date(e.valid_until).toISOString().split("T")[0]:"",description:e.description||"",internalNotes:e.internal_notes||""}),o(!0)})(s),children:e.jsx(ze,{className:"w-4 h-4"})}),e.jsx(b,{variant:"ghost",size:"icon",onClick:()=>(async e=>{const{error:s}=await y.from("coupon_codes").delete().eq("id",e);s?N({title:"Error deleting coupon",description:s.message,variant:"destructive"}):(N({title:"Coupon deleted successfully"}),p())})(s.id),children:e.jsx(ee,{className:"w-4 h-4 text-red-400"})})]})]})})})},s.id)),0===t.length&&e.jsx("p",{className:"text-text-secondary text-center py-8",children:"No coupons found"})]}),e.jsx(cs,{open:d,onOpenChange:e=>{o(e),e||j()},children:e.jsxs(ds,{className:"glass-effect max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(os,{children:e.jsx(ms,{children:m?"Edit Coupon":"Create New Coupon"})}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();const s={code:h.code.toUpperCase(),discount_type:h.discountType,discount_value:parseFloat(h.discountValue),is_recurring:h.isRecurring,max_uses:h.maxUses?parseInt(h.maxUses):null,max_uses_per_user:parseInt(h.maxUsesPerUser),min_purchase_amount:h.minPurchaseAmount?parseFloat(h.minPurchaseAmount):null,applicable_plans:h.applicablePlans.length>0?h.applicablePlans:null,valid_from:h.validFrom,valid_until:h.validUntil||null,description:h.description,internal_notes:h.internalNotes,is_active:!0};let a;if(m){a=(await y.from("coupon_codes").update(s).eq("id",m.id)).error}else{a=(await y.from("coupon_codes").insert(s)).error}a?N({title:"Error saving coupon",description:a.message,variant:"destructive"}):(N({title:m?"Coupon updated!":"Coupon created!"}),o(!1),j(),p())},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(js,{children:"Coupon Code *"}),e.jsx(ps,{value:h.code,onChange:e=>u({...h,code:e.target.value.toUpperCase()}),placeholder:"SUMMER2024",className:"glass-effect font-mono",required:!0})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Discount Type *"}),e.jsxs(fs,{value:h.discountType,onValueChange:e=>u({...h,discountType:e}),children:[e.jsx(vs,{className:"glass-effect",children:e.jsx(ys,{})}),e.jsxs(Ns,{className:"glass-effect",children:[e.jsx(bs,{value:"percentage",children:"Percentage (%)"}),e.jsx(bs,{value:"fixed_amount",children:"Fixed Amount ($)"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(js,{children:"Discount Value *"}),e.jsx(ps,{type:"number",step:"0.01",value:h.discountValue,onChange:e=>u({...h,discountValue:e.target.value}),placeholder:"percentage"===h.discountType?"20":"10.00",className:"glass-effect",required:!0})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Min Purchase Amount"}),e.jsx(ps,{type:"number",step:"0.01",value:h.minPurchaseAmount,onChange:e=>u({...h,minPurchaseAmount:e.target.value}),placeholder:"50.00",className:"glass-effect"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(js,{children:"Max Total Uses"}),e.jsx(ps,{type:"number",value:h.maxUses,onChange:e=>u({...h,maxUses:e.target.value}),placeholder:"Unlimited",className:"glass-effect"})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Max Uses Per User *"}),e.jsx(ps,{type:"number",value:h.maxUsesPerUser,onChange:e=>u({...h,maxUsesPerUser:e.target.value}),className:"glass-effect",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(js,{children:"Valid From"}),e.jsx(ps,{type:"date",value:h.validFrom,onChange:e=>u({...h,validFrom:e.target.value}),className:"glass-effect"})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Valid Until"}),e.jsx(ps,{type:"date",value:h.validUntil,onChange:e=>u({...h,validUntil:e.target.value}),className:"glass-effect"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{checked:h.isRecurring,onCheckedChange:e=>u({...h,isRecurring:e})}),e.jsx(js,{className:"cursor-pointer",children:"Recurring Discount (applies to all future payments)"})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Description (visible to customers)"}),e.jsx(_,{value:h.description,onChange:e=>u({...h,description:e.target.value}),placeholder:"Get 20% off your first month!",className:"glass-effect",rows:2})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Internal Notes"}),e.jsx(_,{value:h.internalNotes,onChange:e=>u({...h,internalNotes:e.target.value}),placeholder:"Marketing campaign: Summer 2024",className:"glass-effect",rows:2})]}),e.jsxs(hs,{children:[e.jsx(b,{type:"button",variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsx(b,{type:"submit",children:m?"Update Coupon":"Create Coupon"})]})]})]})})]})},Qa=()=>{const[s,a]=g.useState([]),[t,i]=g.useState([]),[r,l]=g.useState(null),[n,c]=g.useState(!0),[d,o]=g.useState(""),[m,x]=g.useState(!1),[h,u]=g.useState("all"),[p,j]=g.useState({referrerRewardType:"credit",referrerRewardValue:"10.00",refereeRewardType:"discount_percentage",refereeRewardValue:"20.00",minRefereeSubscriptionMonths:"1"}),[f,v]=g.useState({totalReferrals:0,completedReferrals:0,pendingReferrals:0,totalRewardsGiven:0}),_=async()=>{c(!0);const{data:e,error:s}=await y.from("referrals").select("*").order("created_at",{ascending:!1});let t=[];if(e&&e.length>0){const s=[...new Set([...e.map(e=>e.referrer_id),...e.map(e=>e.referee_id)])],{data:a}=await y.from("user_profiles").select("id, full_name, email, profile_picture_url").in("id",s);t=e.map(e=>({...e,referrer:null==a?void 0:a.find(s=>s.id===e.referrer_id),referee:null==a?void 0:a.find(s=>s.id===e.referee_id)}))}const{data:i,error:r}=await y.from("referral_program").select("*").eq("is_active",!0).single();if(s)N({title:"Error fetching referrals",description:s.message,variant:"destructive"});else{a(t||[]);const e=(null==t?void 0:t.filter(e=>"completed"===e.status||"rewarded"===e.status).length)||0,s=(null==t?void 0:t.filter(e=>"pending"===e.status).length)||0;v({totalReferrals:(null==t?void 0:t.length)||0,completedReferrals:e,pendingReferrals:s,totalRewardsGiven:2*e})}i&&(l(i),j({referrerRewardType:i.referrer_reward_type,referrerRewardValue:i.referrer_reward_value.toString(),refereeRewardType:i.referee_reward_type,refereeRewardValue:i.referee_reward_value.toString(),minRefereeSubscriptionMonths:i.min_referee_subscription_months.toString()})),c(!1)};g.useEffect(()=>{_()},[]),g.useEffect(()=>{let e=s;d&&(e=e.filter(e=>{var s,a,t,i,r,l,n,c,o;return(null==(a=null==(s=e.referrer)?void 0:s.full_name)?void 0:a.toLowerCase().includes(d.toLowerCase()))||(null==(i=null==(t=e.referrer)?void 0:t.email)?void 0:i.toLowerCase().includes(d.toLowerCase()))||(null==(l=null==(r=e.referee)?void 0:r.full_name)?void 0:l.toLowerCase().includes(d.toLowerCase()))||(null==(c=null==(n=e.referee)?void 0:n.email)?void 0:c.toLowerCase().includes(d.toLowerCase()))||(null==(o=e.referral_code)?void 0:o.toLowerCase().includes(d.toLowerCase()))})),"all"!==h&&(e=e.filter(e=>e.status===h)),i(e)},[d,h,s]);const w=s=>{const a={pending:{variant:"secondary",label:"Pending",icon:ge},completed:{variant:"default",label:"Completed",icon:ke},rewarded:{variant:"default",label:"Rewarded",icon:je}},t=a[s]||a.pending,i=t.icon;return e.jsxs(P,{variant:t.variant,className:"flex items-center gap-1",children:[e.jsx(i,{className:"w-3 h-3"}),t.label]})},C=e=>e?e.split(" ").map(e=>e[0]).join("").toUpperCase():"U";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Referral Program"}),e.jsx("p",{className:"text-text-secondary",children:"Track and manage customer referrals"})]}),e.jsxs(b,{onClick:()=>x(!0),className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Program Settings"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(M,{className:"glass-effect",children:e.jsx(I,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Total Referrals"}),e.jsx("p",{className:"text-3xl font-bold",children:f.totalReferrals})]}),e.jsx(O,{className:"w-8 h-8 text-primary"})]})})}),e.jsx(M,{className:"glass-effect",children:e.jsx(I,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Completed"}),e.jsx("p",{className:"text-3xl font-bold text-green-400",children:f.completedReferrals})]}),e.jsx(ke,{className:"w-8 h-8 text-green-400"})]})})}),e.jsx(M,{className:"glass-effect",children:e.jsx(I,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Pending"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-400",children:f.pendingReferrals})]}),e.jsx(ge,{className:"w-8 h-8 text-yellow-400"})]})})}),e.jsx(M,{className:"glass-effect",children:e.jsx(I,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Rewards Given"}),e.jsx("p",{className:"text-3xl font-bold text-purple-400",children:f.totalRewardsGiven})]}),e.jsx(ss,{className:"w-8 h-8 text-purple-400"})]})})})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(we,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(ps,{placeholder:"Search referrals...",value:d,onChange:e=>o(e.target.value),className:"pl-10 glass-effect"})]}),e.jsxs(fs,{value:h,onValueChange:u,children:[e.jsx(vs,{className:"w-[180px] glass-effect",children:e.jsx(ys,{placeholder:"Filter by status"})}),e.jsxs(Ns,{className:"glass-effect",children:[e.jsx(bs,{value:"all",children:"All Status"}),e.jsx(bs,{value:"pending",children:"Pending"}),e.jsx(bs,{value:"completed",children:"Completed"}),e.jsx(bs,{value:"rewarded",children:"Rewarded"})]})]})]}),n?e.jsx("div",{className:"text-center py-8",children:"Loading referrals..."}):e.jsxs("div",{className:"space-y-4",children:[t.map(s=>{var a,t,i,r,l,n,c,d;return e.jsx(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsx(M,{className:"glass-effect",children:e.jsx(I,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(k,{className:"w-10 h-10",children:[e.jsx(S,{src:null==(a=s.referrer)?void 0:a.profile_picture_url}),e.jsx(A,{children:C(null==(t=s.referrer)?void 0:t.full_name)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:null==(i=s.referrer)?void 0:i.full_name}),e.jsx("p",{className:"text-xs text-text-secondary",children:null==(r=s.referrer)?void 0:r.email})]})]}),e.jsx(Q,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(k,{className:"w-10 h-10",children:[e.jsx(S,{src:null==(l=s.referee)?void 0:l.profile_picture_url}),e.jsx(A,{children:C(null==(n=s.referee)?void 0:n.full_name)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:null==(c=s.referee)?void 0:c.full_name}),e.jsx("p",{className:"text-xs text-text-secondary",children:null==(d=s.referee)?void 0:d.email})]})]}),e.jsxs("div",{className:"ml-auto flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("code",{className:"text-sm font-mono bg-white/10 px-2 py-1 rounded",children:s.referral_code}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:new Date(s.created_at).toLocaleDateString()})]}),w(s.status)]})]}),"completed"===s.status&&!s.referrer_rewarded&&e.jsx(b,{size:"sm",onClick:()=>(async e=>{const{error:s}=await y.from("referrals").update({status:"rewarded",referrer_rewarded:!0,referee_rewarded:!0,referrer_rewarded_at:(new Date).toISOString(),referee_rewarded_at:(new Date).toISOString()}).eq("id",e);s?N({title:"Error updating referral",description:s.message,variant:"destructive"}):(N({title:"Referral marked as rewarded!"}),_())})(s.id),className:"ml-4",children:"Mark as Rewarded"})]})})})},s.id)}),0===t.length&&e.jsx("p",{className:"text-text-secondary text-center py-8",children:"No referrals found"})]}),e.jsx(cs,{open:m,onOpenChange:x,children:e.jsxs(ds,{className:"glass-effect max-w-2xl",children:[e.jsx(os,{children:e.jsx(ms,{children:"Referral Program Settings"})}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();const{error:s}=await y.from("referral_program").update({referrer_reward_type:p.referrerRewardType,referrer_reward_value:parseFloat(p.referrerRewardValue),referee_reward_type:p.refereeRewardType,referee_reward_value:parseFloat(p.refereeRewardValue),min_referee_subscription_months:parseInt(p.minRefereeSubscriptionMonths)}).eq("id",r.id);s?N({title:"Error updating settings",description:s.message,variant:"destructive"}):(N({title:"Referral program settings updated!"}),x(!1),_())},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Referrer Rewards"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(js,{children:"Reward Type"}),e.jsxs(fs,{value:p.referrerRewardType,onValueChange:e=>j({...p,referrerRewardType:e}),children:[e.jsx(vs,{className:"glass-effect",children:e.jsx(ys,{})}),e.jsxs(Ns,{className:"glass-effect",children:[e.jsx(bs,{value:"credit",children:"Account Credit ($)"}),e.jsx(bs,{value:"discount_percentage",children:"Discount (%)"}),e.jsx(bs,{value:"free_months",children:"Free Months"})]})]})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Reward Value"}),e.jsx(ps,{type:"number",step:"0.01",value:p.referrerRewardValue,onChange:e=>j({...p,referrerRewardValue:e.target.value}),className:"glass-effect",required:!0})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Referee Rewards"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(js,{children:"Reward Type"}),e.jsxs(fs,{value:p.refereeRewardType,onValueChange:e=>j({...p,refereeRewardType:e}),children:[e.jsx(vs,{className:"glass-effect",children:e.jsx(ys,{})}),e.jsxs(Ns,{className:"glass-effect",children:[e.jsx(bs,{value:"credit",children:"Account Credit ($)"}),e.jsx(bs,{value:"discount_percentage",children:"Discount (%)"}),e.jsx(bs,{value:"free_months",children:"Free Months"})]})]})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Reward Value"}),e.jsx(ps,{type:"number",step:"0.01",value:p.refereeRewardValue,onChange:e=>j({...p,refereeRewardValue:e.target.value}),className:"glass-effect",required:!0})]})]})]}),e.jsxs("div",{children:[e.jsx(js,{children:"Minimum Subscription Months for Referee"}),e.jsx(ps,{type:"number",value:p.minRefereeSubscriptionMonths,onChange:e=>j({...p,minRefereeSubscriptionMonths:e.target.value}),className:"glass-effect",required:!0}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Referee must maintain subscription for this many months before rewards are given"})]}),e.jsxs(hs,{children:[e.jsx(b,{type:"button",variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(b,{type:"submit",children:"Update Settings"})]})]})]})})]})},Ya=g.forwardRef(({className:s,...a},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:w("w-full caption-bottom text-sm",s),...a})}));Ya.displayName="Table";const Ja=g.forwardRef(({className:s,...a},t)=>e.jsx("thead",{ref:t,className:w("[&_tr]:border-b",s),...a}));Ja.displayName="TableHeader";const Ka=g.forwardRef(({className:s,...a},t)=>e.jsx("tbody",{ref:t,className:w("[&_tr:last-child]:border-0",s),...a}));Ka.displayName="TableBody";g.forwardRef(({className:s,...a},t)=>e.jsx("tfoot",{ref:t,className:w("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...a})).displayName="TableFooter";const Xa=g.forwardRef(({className:s,...a},t)=>e.jsx("tr",{ref:t,className:w("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...a}));Xa.displayName="TableRow";const Za=g.forwardRef(({className:s,...a},t)=>e.jsx("th",{ref:t,className:w("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...a}));Za.displayName="TableHead";const et=g.forwardRef(({className:s,...a},t)=>e.jsx("td",{ref:t,className:w("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...a}));et.displayName="TableCell";g.forwardRef(({className:s,...a},t)=>e.jsx("caption",{ref:t,className:w("mt-4 text-sm text-muted-foreground",s),...a})).displayName="TableCaption";const st=({provider:s})=>{const{toast:a}=F(),[t,i]=g.useState(!1),[r,l]=g.useState({max_requests_per_user_per_day:50,max_requests_per_user_per_hour:10,enable_rate_limiting:!0,response_style:"balanced",response_length:"medium",enable_emojis:!0,language:"en",enable_content_filter:!0,prohibited_topics:[],medical_disclaimer:!0,require_user_consent:!1,welcome_message:"Hi! I'm your AI Health Coach. How can I help you today?",suggested_questions:["Give me a healthy breakfast idea","Suggest a quick 15-minute workout","How can I increase my energy levels?","What's a good way to de-stress?"],enable_typing_indicator:!0,enable_message_history:!0,webhook_url:"",enable_webhooks:!1,data_retention_days:90,enable_analytics:!0,fallback_response:"I'm having trouble responding right now. Please try again in a moment!",max_response_time_ms:1e4,enable_caching:!1,cache_duration_minutes:60,max_conversation_length:10,enable_context_memory:!0,conversation_timeout_minutes:30}),[n,c]=g.useState(""),[d,o]=g.useState("");g.useEffect(()=>{(null==s?void 0:s.id)&&m()},[s]);const m=async()=>{if(!(null==s?void 0:s.id))return;const{data:e,error:a}=await y.from("ai_coach_settings").select("*").eq("id",s.id).single();e&&!a&&l(s=>({...s,...e,prohibited_topics:e.prohibited_topics||[],suggested_questions:e.suggested_questions||s.suggested_questions}))},x=async()=>{if(!(null==s?void 0:s.id))return void a({title:"Error",description:"No provider selected",variant:"destructive"});i(!0);const{error:e}=await y.from("ai_coach_settings").update(r).eq("id",s.id);a(e?{title:"Error",description:e.message,variant:"destructive"}:{title:"Success",description:"Advanced settings saved successfully"}),i(!1)},h=()=>{n.trim()&&(l(e=>({...e,prohibited_topics:[...e.prohibited_topics,n.trim()]})),c(""))},u=()=>{d.trim()&&(l(e=>({...e,suggested_questions:[...e.suggested_questions,d.trim()]})),o(""))};return s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Ie,{className:"h-6 w-6"}),"Advanced Settings"]}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:["Configure ",s.display_name," behavior and limits"]})]}),e.jsxs(b,{onClick:x,disabled:t,children:[t?e.jsx(as,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Save All Settings"]})]}),e.jsxs(_s,{defaultValue:"rate-limiting",className:"w-full",children:[e.jsxs(ws,{className:"grid w-full grid-cols-6",children:[e.jsxs(Cs,{value:"rate-limiting",className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"Rate Limits"]}),e.jsxs(Cs,{value:"quality",className:"flex items-center gap-2",children:[e.jsx(as,{className:"h-4 w-4"}),"Quality"]}),e.jsxs(Cs,{value:"safety",className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-4 w-4"}),"Safety"]}),e.jsxs(Cs,{value:"ux",className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-4 w-4"}),"User Experience"]}),e.jsxs(Cs,{value:"performance",className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Performance"]}),e.jsxs(Cs,{value:"integration",className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"Integration"]})]}),e.jsx(ks,{value:"rate-limiting",children:e.jsxs(M,{children:[e.jsxs(q,{children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-5 w-5"}),"Rate Limiting & Usage Controls"]}),e.jsx(L,{children:"Prevent abuse and control API costs by limiting requests"})]}),e.jsxs(I,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-muted rounded-lg",children:[e.jsx(Ss,{id:"enable_rate_limiting",checked:r.enable_rate_limiting,onCheckedChange:e=>l(s=>({...s,enable_rate_limiting:e}))}),e.jsx(js,{htmlFor:"enable_rate_limiting",className:"cursor-pointer",children:"Enable rate limiting (recommended for production)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"max_per_day",children:"Max Requests Per User/Day"}),e.jsx(ps,{id:"max_per_day",type:"number",value:r.max_requests_per_user_per_day,onChange:e=>l(s=>({...s,max_requests_per_user_per_day:parseInt(e.target.value)}))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Recommended: 50-100 for regular users"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"max_per_hour",children:"Max Requests Per User/Hour"}),e.jsx(ps,{id:"max_per_hour",type:"number",value:r.max_requests_per_user_per_hour,onChange:e=>l(s=>({...s,max_requests_per_user_per_hour:parseInt(e.target.value)}))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Recommended: 10-20 to prevent spam"})]})]}),e.jsx("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-950 rounded-lg border border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ue,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400 shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-yellow-900 dark:text-yellow-100",children:"Rate Limiting Best Practices"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-yellow-800 dark:text-yellow-200",children:[e.jsx("li",{children:"• Start conservative (50/day) and increase based on usage"}),e.jsx("li",{children:"• Monitor API costs regularly"}),e.jsx("li",{children:"• Consider premium users with higher limits"}),e.jsx("li",{children:"• Track and alert on unusual spikes"})]})]})]})})]})]})}),e.jsx(ks,{value:"quality",children:e.jsxs(M,{children:[e.jsxs(q,{children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(as,{className:"h-5 w-5"}),"Response Quality & Style"]}),e.jsx(L,{children:"Control how the AI responds to users"})]}),e.jsx(I,{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"response_style",children:"Response Style"}),e.jsxs(fs,{value:r.response_style,onValueChange:e=>l(s=>({...s,response_style:e})),children:[e.jsx(vs,{children:e.jsx(ys,{})}),e.jsxs(Ns,{children:[e.jsx(bs,{value:"casual",children:"😊 Casual & Friendly"}),e.jsx(bs,{value:"balanced",children:"⚖️ Balanced (Recommended)"}),e.jsx(bs,{value:"professional",children:"👔 Professional"}),e.jsx(bs,{value:"technical",children:"🔬 Technical & Detailed"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"How formal or casual the AI should be"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"response_length",children:"Response Length"}),e.jsxs(fs,{value:r.response_length,onValueChange:e=>l(s=>({...s,response_length:e})),children:[e.jsx(vs,{children:e.jsx(ys,{})}),e.jsxs(Ns,{children:[e.jsx(bs,{value:"short",children:"📝 Short (50-100 words)"}),e.jsx(bs,{value:"medium",children:"📄 Medium (100-200 words)"}),e.jsx(bs,{value:"long",children:"📖 Long (200-400 words)"}),e.jsx(bs,{value:"comprehensive",children:"📚 Comprehensive (400+ words)"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Preferred response length"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"language",children:"Language"}),e.jsxs(fs,{value:r.language,onValueChange:e=>l(s=>({...s,language:e})),children:[e.jsx(vs,{children:e.jsx(ys,{})}),e.jsxs(Ns,{children:[e.jsx(bs,{value:"en",children:"🇺🇸 English"}),e.jsx(bs,{value:"es",children:"🇪🇸 Spanish"}),e.jsx(bs,{value:"fr",children:"🇫🇷 French"}),e.jsx(bs,{value:"de",children:"🇩🇪 German"}),e.jsx(bs,{value:"ar",children:"🇸🇦 Arabic"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-muted rounded-lg",children:[e.jsx(Ss,{id:"enable_emojis",checked:r.enable_emojis,onCheckedChange:e=>l(s=>({...s,enable_emojis:e}))}),e.jsx(js,{htmlFor:"enable_emojis",className:"cursor-pointer",children:"Use emojis in responses 😊"})]})]})})]})}),e.jsx(ks,{value:"safety",children:e.jsxs(M,{children:[e.jsxs(q,{children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-5 w-5"}),"Safety & Moderation"]}),e.jsx(L,{children:"Control what topics the AI can discuss"})]}),e.jsxs(I,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-muted rounded-lg",children:[e.jsx(Ss,{id:"enable_content_filter",checked:r.enable_content_filter,onCheckedChange:e=>l(s=>({...s,enable_content_filter:e}))}),e.jsxs(js,{htmlFor:"enable_content_filter",className:"cursor-pointer",children:[e.jsx(ts,{className:"h-4 w-4 inline mr-1"}),"Enable content filtering"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-muted rounded-lg",children:[e.jsx(Ss,{id:"medical_disclaimer",checked:r.medical_disclaimer,onCheckedChange:e=>l(s=>({...s,medical_disclaimer:e}))}),e.jsxs(js,{htmlFor:"medical_disclaimer",className:"cursor-pointer",children:[e.jsx(Ue,{className:"h-4 w-4 inline mr-1"}),"Show medical disclaimer"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{children:"Prohibited Topics"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ps,{placeholder:"e.g., prescription drugs, surgery, etc.",value:n,onChange:e=>c(e.target.value),onKeyPress:e=>"Enter"===e.key&&h()}),e.jsx(b,{onClick:h,variant:"outline",children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:r.prohibited_topics.map((s,a)=>e.jsxs(P,{variant:"destructive",className:"cursor-pointer",onClick:()=>(e=>{l(s=>({...s,prohibited_topics:s.prohibited_topics.filter((s,a)=>a!==e)}))})(a),children:[s," ×"]},a))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Topics the AI should refuse to discuss (e.g., prescribing medication, diagnosing conditions)"})]}),e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-950 rounded-lg border border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ke,{className:"h-5 w-5 text-red-600 dark:text-red-400 shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-red-900 dark:text-red-100",children:"Safety Recommendations"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-red-800 dark:text-red-200",children:[e.jsx("li",{children:"• Always keep content filtering enabled"}),e.jsx("li",{children:"• Add prohibited topics for medical advice beyond general wellness"}),e.jsx("li",{children:"• Include disclaimer about consulting healthcare professionals"}),e.jsx("li",{children:"• Regularly review AI responses for quality and safety"})]})]})]})})]})]})}),e.jsx(ks,{value:"ux",children:e.jsxs(M,{children:[e.jsxs(q,{children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-5 w-5"}),"User Experience"]}),e.jsx(L,{children:"Customize the conversation experience"})]}),e.jsxs(I,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"welcome_message",children:"Welcome Message"}),e.jsx(_,{id:"welcome_message",value:r.welcome_message,onChange:e=>l(s=>({...s,welcome_message:e.target.value})),rows:3}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"First message users see when opening the AI Coach"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{children:"Suggested Questions"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ps,{placeholder:"Add a suggested question...",value:d,onChange:e=>o(e.target.value),onKeyPress:e=>"Enter"===e.key&&u()}),e.jsx(b,{onClick:u,variant:"outline",children:"Add"})]}),e.jsx("div",{className:"space-y-2 mt-2",children:r.suggested_questions.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted rounded",children:[e.jsx("span",{className:"flex-1 text-sm",children:s}),e.jsx(b,{size:"sm",variant:"ghost",onClick:()=>(e=>{l(s=>({...s,suggested_questions:s.suggested_questions.filter((s,a)=>a!==e)}))})(a),children:"×"})]},a))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-muted rounded-lg",children:[e.jsx(Ss,{id:"enable_typing_indicator",checked:r.enable_typing_indicator,onCheckedChange:e=>l(s=>({...s,enable_typing_indicator:e}))}),e.jsx(js,{htmlFor:"enable_typing_indicator",className:"cursor-pointer",children:"Show typing indicator"})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-muted rounded-lg",children:[e.jsx(Ss,{id:"enable_message_history",checked:r.enable_message_history,onCheckedChange:e=>l(s=>({...s,enable_message_history:e}))}),e.jsx(js,{htmlFor:"enable_message_history",className:"cursor-pointer",children:"Enable message history"})]})]})]})]})}),e.jsx(ks,{value:"performance",children:e.jsxs(M,{children:[e.jsxs(q,{children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5"}),"Performance & Optimization"]}),e.jsx(L,{children:"Optimize AI response speed and reliability"})]}),e.jsxs(I,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"max_response_time",children:"Max Response Time (ms)"}),e.jsx(ps,{id:"max_response_time",type:"number",value:r.max_response_time_ms,onChange:e=>l(s=>({...s,max_response_time_ms:parseInt(e.target.value)}))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Timeout if AI takes longer than this"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"conversation_length",children:"Max Conversation Length"}),e.jsx(ps,{id:"conversation_length",type:"number",value:r.max_conversation_length,onChange:e=>l(s=>({...s,max_conversation_length:parseInt(e.target.value)}))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Number of messages to remember (context)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"conversation_timeout",children:"Conversation Timeout (minutes)"}),e.jsx(ps,{id:"conversation_timeout",type:"number",value:r.conversation_timeout_minutes,onChange:e=>l(s=>({...s,conversation_timeout_minutes:parseInt(e.target.value)}))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Reset context after this period of inactivity"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-muted rounded-lg",children:[e.jsx(Ss,{id:"enable_caching",checked:r.enable_caching,onCheckedChange:e=>l(s=>({...s,enable_caching:e}))}),e.jsx(js,{htmlFor:"enable_caching",className:"cursor-pointer flex-1",children:"Enable response caching (faster, cheaper)"})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-muted rounded-lg",children:[e.jsx(Ss,{id:"enable_context_memory",checked:r.enable_context_memory,onCheckedChange:e=>l(s=>({...s,enable_context_memory:e}))}),e.jsx(js,{htmlFor:"enable_context_memory",className:"cursor-pointer flex-1",children:"Remember conversation context"})]})]}),r.enable_caching&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"cache_duration",children:"Cache Duration (minutes)"}),e.jsx(ps,{id:"cache_duration",type:"number",value:r.cache_duration_minutes,onChange:e=>l(s=>({...s,cache_duration_minutes:parseInt(e.target.value)}))})]})]})]})}),e.jsx(ks,{value:"integration",children:e.jsxs(M,{children:[e.jsxs(q,{children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5"}),"Integration & Data"]}),e.jsx(L,{children:"Connect with external services and manage data"})]}),e.jsxs(I,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"fallback_response",children:"Fallback Response (Error Message)"}),e.jsx(_,{id:"fallback_response",value:r.fallback_response,onChange:e=>l(s=>({...s,fallback_response:e.target.value})),rows:2}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Shown when AI fails to respond"})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-muted rounded-lg",children:[e.jsx(Ss,{id:"enable_webhooks",checked:r.enable_webhooks,onCheckedChange:e=>l(s=>({...s,enable_webhooks:e}))}),e.jsx(js,{htmlFor:"enable_webhooks",className:"cursor-pointer",children:"Enable webhooks for external integrations"})]}),r.enable_webhooks&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"webhook_url",children:"Webhook URL"}),e.jsx(ps,{id:"webhook_url",type:"url",placeholder:"https://example.com/webhook",value:r.webhook_url,onChange:e=>l(s=>({...s,webhook_url:e.target.value}))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Receive notifications when users interact with AI"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"data_retention",children:"Data Retention (days)"}),e.jsx(ps,{id:"data_retention",type:"number",value:r.data_retention_days,onChange:e=>l(s=>({...s,data_retention_days:parseInt(e.target.value)}))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"How long to keep conversation history"})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-muted rounded-lg",children:[e.jsx(Ss,{id:"enable_analytics",checked:r.enable_analytics,onCheckedChange:e=>l(s=>({...s,enable_analytics:e}))}),e.jsx(js,{htmlFor:"enable_analytics",className:"cursor-pointer",children:"Track usage analytics"})]})]}),e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-950 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-blue-900 dark:text-blue-100",children:"Analytics & Insights"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-blue-800 dark:text-blue-200",children:[e.jsx("li",{children:"• Track user engagement and satisfaction"}),e.jsx("li",{children:"• Monitor AI performance and response quality"}),e.jsx("li",{children:"• Identify popular questions and topics"}),e.jsx("li",{children:"• Optimize based on usage patterns"})]})]})]})})]})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(b,{onClick:x,disabled:t,size:"lg",children:[t?e.jsx(as,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Save All Advanced Settings"]})})]}):e.jsx(M,{children:e.jsx(I,{className:"p-8",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(Ie,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Select a provider to configure advanced settings"})]})})})},at=()=>{const{toast:s}=F(),[a,t]=g.useState([]),[i,r]=g.useState(!0),[l,n]=g.useState(!1),[c,d]=g.useState(null),[o,m]=g.useState(null),[x,h]=g.useState({provider:"gemini",api_key:"",model_name:"",temperature:.7,max_tokens:500,display_name:"",description:"",system_prompt:"",api_endpoint:"",is_active:!1}),u={gemini:{models:["gemini-2.5-flash","gemini-2.5-pro","gemini-2.0-flash","gemini-pro-latest"],default_model:"gemini-2.5-flash",default_system_prompt:"You are a friendly and knowledgeable health and wellness AI coach for GreeonFig. Provide personalized health advice, meal suggestions, workout tips, and motivation. Keep responses concise, friendly, and actionable. Use emojis occasionally to be engaging."},openai:{models:["gpt-4o","gpt-4-turbo","gpt-4","gpt-3.5-turbo"],default_model:"gpt-3.5-turbo",default_system_prompt:"You are a professional health and wellness coach specializing in nutrition, fitness, and holistic well-being. Provide evidence-based, personalized guidance while being warm and supportive."},claude:{models:["claude-3-5-sonnet-20241022","claude-3-opus-20240229","claude-3-sonnet-20240229","claude-3-haiku-20240307"],default_model:"claude-3-haiku-20240307",default_system_prompt:"You are an empathetic health coach with expertise in nutrition, exercise, and mental wellness. Offer practical, science-backed advice in a friendly, conversational tone."}};g.useEffect(()=>{p()},[]);const p=async()=>{r(!0);const{data:e,error:a}=await y.from("ai_coach_settings").select("*").order("created_at",{ascending:!1});a?s({title:"Error",description:"Failed to load AI settings",variant:"destructive"}):t(e||[]),r(!1)},j=()=>{d(null),h({provider:"gemini",api_key:"",model_name:"",temperature:.7,max_tokens:500,display_name:"",description:"",system_prompt:"",api_endpoint:"",is_active:!1})};return i?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Ee,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(as,{className:"h-8 w-8 text-primary"}),"AI Coach Settings"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Configure AI providers for the health coaching chatbot"})]}),e.jsxs(cs,{open:l,onOpenChange:e=>{n(e),e||j()},children:[e.jsx(us,{asChild:!0,children:e.jsxs(b,{className:"gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),"Add AI Provider"]})}),e.jsxs(ds,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(os,{children:[e.jsx(ms,{children:c?"Edit AI Provider":"Add AI Provider"}),e.jsx(xs,{children:"Configure an AI provider for the health coaching feature"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"provider",children:"Provider *"}),e.jsxs(fs,{value:x.provider,onValueChange:e=>{const s=u[e];h(a=>({...a,provider:e,model_name:(null==s?void 0:s.default_model)||"",system_prompt:(null==s?void 0:s.default_system_prompt)||a.system_prompt,display_name:"custom"===e?"":`${e.charAt(0).toUpperCase()+e.slice(1)} AI Coach`,description:"custom"===e?"":`Powered by ${e.charAt(0).toUpperCase()+e.slice(1)} API`}))},children:[e.jsx(vs,{children:e.jsx(ys,{})}),e.jsxs(Ns,{children:[e.jsx(bs,{value:"gemini",children:"🔮 Google Gemini"}),e.jsx(bs,{value:"openai",children:"🤖 OpenAI (GPT)"}),e.jsx(bs,{value:"claude",children:"🧠 Anthropic Claude"}),e.jsx(bs,{value:"custom",children:"⚙️ Custom API"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"model_name",children:"Model"}),"custom"!==x.provider&&u[x.provider]?e.jsxs(fs,{value:x.model_name,onValueChange:e=>h(s=>({...s,model_name:e})),children:[e.jsx(vs,{children:e.jsx(ys,{})}),e.jsx(Ns,{children:u[x.provider].models.map(s=>e.jsx(bs,{value:s,children:s},s))})]}):e.jsx(ps,{id:"model_name",value:x.model_name,onChange:e=>h(s=>({...s,model_name:e.target.value})),placeholder:"e.g., custom-model-v1"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"display_name",children:"Display Name *"}),e.jsx(ps,{id:"display_name",value:x.display_name,onChange:e=>h(s=>({...s,display_name:e.target.value})),placeholder:"e.g., Gemini Health Coach"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"description",children:"Description"}),e.jsx(ps,{id:"description",value:x.description,onChange:e=>h(s=>({...s,description:e.target.value})),placeholder:"Brief description of this AI provider"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"api_key",children:"API Key *"}),e.jsx(ps,{id:"api_key",type:"password",value:x.api_key,onChange:e=>h(s=>({...s,api_key:e.target.value})),placeholder:"Enter your API key"})]}),"custom"===x.provider&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"api_endpoint",children:"API Endpoint *"}),e.jsx(ps,{id:"api_endpoint",value:x.api_endpoint,onChange:e=>h(s=>({...s,api_endpoint:e.target.value})),placeholder:"https://api.example.com/v1/chat"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"temperature",children:"Temperature"}),e.jsx(ps,{id:"temperature",type:"number",step:"0.1",min:"0",max:"2",value:x.temperature,onChange:e=>h(s=>({...s,temperature:parseFloat(e.target.value)}))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"0.0 = Focused, 1.0 = Balanced, 2.0 = Creative"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"max_tokens",children:"Max Tokens"}),e.jsx(ps,{id:"max_tokens",type:"number",value:x.max_tokens,onChange:e=>h(s=>({...s,max_tokens:parseInt(e.target.value)}))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Max response length (~4 chars/token)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{htmlFor:"system_prompt",children:"System Prompt"}),e.jsx(_,{id:"system_prompt",value:x.system_prompt,onChange:e=>h(s=>({...s,system_prompt:e.target.value})),placeholder:"Instructions for the AI coach's personality and behavior...",rows:5})]}),e.jsxs("div",{className:"flex items-center space-x-2 border rounded-lg p-4 bg-muted/30",children:[e.jsx(Ss,{id:"is_active",checked:x.is_active,onCheckedChange:e=>h(s=>({...s,is_active:e}))}),e.jsx(js,{htmlFor:"is_active",className:"cursor-pointer",children:"Set as active provider (only one can be active)"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(b,{variant:"outline",onClick:()=>{n(!1),j()},children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs(b,{onClick:async()=>{if(!x.api_key||!x.display_name)return void s({title:"Validation Error",description:"API Key and Display Name are required",variant:"destructive"});x.is_active&&await y.from("ai_coach_settings").update({is_active:!1}).neq("id",(null==c?void 0:c.id)||"");const e={...x};let a;if(c){a=(await y.from("ai_coach_settings").update(e).eq("id",c.id)).error}else{a=(await y.from("ai_coach_settings").insert(e)).error}a?s({title:"Error",description:a.message,variant:"destructive"}):(s({title:"Success",description:`AI provider ${c?"updated":"added"} successfully`}),n(!1),j(),p())},children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Save Provider"]})]})]})]})]}),e.jsxs(M,{children:[e.jsxs(q,{children:[e.jsx(U,{children:"Configured AI Providers"}),e.jsx(L,{children:"Manage AI providers for the health coaching chatbot. Only one can be active at a time."})]}),e.jsx(I,{children:0===a.length?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(is,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No AI providers configured yet."}),e.jsx("p",{className:"text-sm",children:'Click "Add AI Provider" to get started.'})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ya,{children:[e.jsx(Ja,{children:e.jsxs(Xa,{children:[e.jsx(Za,{children:"Provider"}),e.jsx(Za,{children:"Model"}),e.jsx(Za,{children:"Temperature"}),e.jsx(Za,{children:"Max Tokens"}),e.jsx(Za,{children:"Status"}),e.jsx(Za,{className:"text-right",children:"Actions"})]})}),e.jsx(Ka,{children:e.jsx(te,{children:a.map(a=>{return e.jsxs(V.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"border-b",children:[e.jsx(et,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:(t=a.provider,{gemini:"🔮",openai:"🤖",claude:"🧠",custom:"⚙️"}[t]||"🤖")}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.description})]})]})}),e.jsx(et,{children:e.jsx("code",{className:"text-xs bg-muted px-2 py-1 rounded",children:a.model_name||"default"})}),e.jsx(et,{children:a.temperature}),e.jsx(et,{children:a.max_tokens}),e.jsx(et,{children:e.jsx(P,{variant:a.is_active?"default":"secondary",className:"gap-1",children:a.is_active?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"h-3 w-3"})," Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"h-3 w-3"})," Inactive"]})})}),e.jsx(et,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(b,{size:"sm",variant:a.is_active?"secondary":"default",onClick:()=>(async(e,a)=>{a||await y.from("ai_coach_settings").update({is_active:!1}).neq("id",e);const{error:t}=await y.from("ai_coach_settings").update({is_active:!a}).eq("id",e);t?s({title:"Error",description:t.message,variant:"destructive"}):(s({title:"Success",description:"AI provider "+(a?"deactivated":"activated")}),p())})(a.id,a.is_active),children:a.is_active?"Deactivate":"Activate"}),e.jsx(b,{size:"sm",variant:"outline",onClick:()=>m(a),title:"Advanced Settings",children:e.jsx(Ie,{className:"h-4 w-4"})}),e.jsx(b,{size:"sm",variant:"outline",onClick:()=>(e=>{d(e),h({provider:e.provider,api_key:e.api_key,model_name:e.model_name||"",temperature:e.temperature||.7,max_tokens:e.max_tokens||500,display_name:e.display_name,description:e.description||"",system_prompt:e.system_prompt||"",api_endpoint:e.api_endpoint||"",is_active:e.is_active}),n(!0)})(a),children:e.jsx(ze,{className:"h-4 w-4"})}),e.jsx(b,{size:"sm",variant:"destructive",onClick:()=>(async e=>{if(!confirm("Are you sure you want to delete this AI provider?"))return;const{error:a}=await y.from("ai_coach_settings").delete().eq("id",e);a?s({title:"Error",description:a.message,variant:"destructive"}):(s({title:"Deleted",description:"AI provider removed successfully"}),p())})(a.id),children:e.jsx(ee,{className:"h-4 w-4"})})]})})]},a.id);var t})})})]})})})]}),o&&e.jsxs("div",{className:"mt-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Advanced Configuration"}),e.jsxs(b,{variant:"outline",onClick:()=>m(null),children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Close Advanced Settings"]})]}),e.jsx(st,{provider:o})]}),e.jsxs(M,{className:"bg-blue-50 dark:bg-blue-950 border-blue-200 dark:border-blue-800",children:[e.jsx(q,{children:e.jsx(U,{className:"text-blue-900 dark:text-blue-100",children:"💡 Tips"})}),e.jsxs(I,{className:"space-y-2 text-sm text-blue-800 dark:text-blue-200",children:[e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Gemini:"})," Fast, free tier available (60 req/min), great for development"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"OpenAI:"})," GPT-4 for best quality, GPT-3.5-turbo for cost-effectiveness"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Claude:"})," Excellent for empathetic responses, good context handling"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Temperature:"})," Lower (0.3-0.5) for consistent advice, higher (0.7-1.0) for varied responses"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Max Tokens:"})," 500 = ~200 words, 1000 = ~400 words"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"System Prompt:"})," Customize the AI's personality and expertise area"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Advanced Settings:"})," Click the ⚙️ Settings button to configure rate limits, safety, and more"]})]})]})]})},tt=()=>{const[s,a]=g.useState([]),[t,i]=g.useState(!0),[r,l]=g.useState(""),[n,c]=g.useState(!1),[d,o]=g.useState(!1),[m,x]=g.useState(null),[h,u]=g.useState(!1),[p,j]=g.useState({email:"",full_name:"",role:"user"}),[f,v]=g.useState({email:"",full_name:"",role:"user"}),[_,w]=g.useState(!1),[C,k]=g.useState(!1);g.useEffect(()=>{S()},[]);const S=async()=>{i(!0);try{const{data:e,error:s}=await y.from("user_profiles").select("*").order("created_at",{ascending:!1});if(s)throw s;a(e||[])}catch(e){N({variant:"destructive",title:"Error fetching users",description:e.message})}finally{i(!1)}},A=async e=>{k(!0);try{const{error:s}=await y.auth.resetPasswordForEmail(e,{redirectTo:`${window.location.origin}/reset-password`});if(s)throw s;N({title:"Password reset email sent",description:`An email has been sent to ${e} with instructions to set their password.`})}catch(s){N({variant:"destructive",title:"Error sending email",description:s.message})}finally{k(!1)}},P=s=>{switch(s){case"super_admin":return e.jsx(Ke,{className:"w-4 h-4 text-red-500"});case"admin":return e.jsx(Ke,{className:"w-4 h-4 text-orange-500"});case"nutritionist":return e.jsx(rs,{className:"w-4 h-4 text-green-500"});default:return e.jsx(Le,{className:"w-4 h-4 text-blue-500"})}},F=s=>{const a={super_admin:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",admin:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",nutritionist:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",user:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"};return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${a[s]||a.user}`,children:[P(s),s.replace("_"," ").toUpperCase()]})},T=s.filter(e=>{var s,a;return(null==(s=e.email)?void 0:s.toLowerCase().includes(r.toLowerCase()))||(null==(a=e.full_name)?void 0:a.toLowerCase().includes(r.toLowerCase()))});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(O,{className:"w-8 h-8 text-primary"}),"User Management"]}),e.jsx("p",{className:"text-text-secondary mt-1",children:"Manage platform users and roles"})]}),e.jsxs(b,{onClick:()=>c(!0),className:"gap-2",children:[e.jsx(ne,{className:"w-4 h-4"}),"Create User"]})]}),e.jsx(M,{children:e.jsx(I,{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(ps,{placeholder:"Search by email or name...",value:r,onChange:e=>l(e.target.value),className:"pl-10"})]})})}),t?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(Ee,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs("div",{className:"grid gap-4",children:[T.map(s=>e.jsx(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsx(M,{children:e.jsx(I,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(Le,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold",children:s.full_name||"N/A"}),F(s.role)]}),e.jsxs("p",{className:"text-sm text-text-secondary flex items-center gap-1",children:[e.jsx(Ae,{className:"w-3 h-3"}),s.email]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Created: ",new Date(s.created_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(b,{variant:"ghost",size:"sm",onClick:()=>A(s.email),children:[e.jsx(Ae,{className:"w-4 h-4 mr-1"}),"Reset Password"]}),e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>(e=>{x(e),v({email:e.email,full_name:e.full_name,role:e.role}),o(!0)})(s),children:e.jsx(ze,{className:"w-4 h-4"})}),e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{const{error:s}=await y.from("user_profiles").delete().eq("id",e);if(s)throw s;N({title:"User deleted",description:"User has been removed from the system"}),S()}catch(s){N({variant:"destructive",title:"Error deleting user",description:s.message})}})(s.id),className:"text-destructive hover:text-destructive",children:e.jsx(ee,{className:"w-4 h-4"})})]})]})})})},s.id)),0===T.length&&e.jsx(M,{children:e.jsxs(I,{className:"p-12 text-center",children:[e.jsx(O,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No users found"}),e.jsx("p",{className:"text-text-secondary",children:"Try adjusting your search"})]})})]}),e.jsx(cs,{open:n,onOpenChange:c,children:e.jsxs(ds,{children:[e.jsxs(os,{children:[e.jsx(ms,{children:"Create New User"}),e.jsx(xs,{children:"Create a new user account. They will receive an email to set their password."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Email"}),e.jsx(ps,{placeholder:"user@example.com",value:p.email,onChange:e=>j({...p,email:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Full Name"}),e.jsx(ps,{placeholder:"John Doe",value:p.full_name,onChange:e=>j({...p,full_name:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Role"}),e.jsxs(fs,{value:p.role,onValueChange:e=>j({...p,role:e}),children:[e.jsx(vs,{children:e.jsx(ys,{})}),e.jsxs(Ns,{children:[e.jsx(bs,{value:"user",children:"User"}),e.jsx(bs,{value:"nutritionist",children:"Nutritionist"}),e.jsx(bs,{value:"admin",children:"Admin"}),e.jsx(bs,{value:"super_admin",children:"Super Admin"})]})]})]})]}),e.jsxs(hs,{children:[e.jsx(b,{variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsxs(b,{onClick:async()=>{if(p.email&&p.full_name){w(!0);try{const e=Math.random().toString(36).slice(-12)+"A1!",{data:s,error:a}=await y.auth.signUp({email:p.email,password:e,options:{data:{full_name:p.full_name,role:p.role},emailRedirectTo:`${window.location.origin}/reset-password`}});if(a)throw a;if(await new Promise(e=>setTimeout(e,2e3)),"user"!==p.role){const{error:e}=await y.from("user_profiles").update({role:p.role}).eq("id",s.user.id)}N({title:"User created successfully",description:`${p.full_name} has been invited to set their password.`}),c(!1),j({email:"",full_name:"",role:"user"}),x({...p,tempPassword:e}),u(!0),S()}catch(e){N({variant:"destructive",title:"Error creating user",description:e.message})}finally{w(!1)}}else N({variant:"destructive",title:"Missing fields",description:"Please fill in email and full name"})},disabled:_,children:[_&&e.jsx(Ee,{className:"w-4 h-4 mr-2 animate-spin"}),"Create User"]})]})]})}),e.jsx(cs,{open:d,onOpenChange:o,children:e.jsxs(ds,{children:[e.jsxs(os,{children:[e.jsx(ms,{children:"Edit User"}),e.jsx(xs,{children:"Update user information and role"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Email"}),e.jsx(ps,{placeholder:"user@example.com",value:f.email,onChange:e=>v({...f,email:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Full Name"}),e.jsx(ps,{placeholder:"John Doe",value:f.full_name,onChange:e=>v({...f,full_name:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Role"}),e.jsxs(fs,{value:f.role,onValueChange:e=>v({...f,role:e}),children:[e.jsx(vs,{children:e.jsx(ys,{})}),e.jsxs(Ns,{children:[e.jsx(bs,{value:"user",children:"User"}),e.jsx(bs,{value:"nutritionist",children:"Nutritionist"}),e.jsx(bs,{value:"admin",children:"Admin"}),e.jsx(bs,{value:"super_admin",children:"Super Admin"})]})]})]})]}),e.jsxs(hs,{children:[e.jsx(b,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsx(b,{onClick:async()=>{if(f.email&&f.full_name)try{const{error:e}=await y.from("user_profiles").update({email:f.email,full_name:f.full_name,role:f.role}).eq("id",m.id);if(e)throw e;N({title:"User updated",description:"User information has been updated successfully"}),o(!1),S()}catch(e){N({variant:"destructive",title:"Error updating user",description:e.message})}else N({variant:"destructive",title:"Missing fields",description:"Please fill in all fields"})},children:"Update User"})]})]})}),e.jsx(cs,{open:h,onOpenChange:u,children:e.jsxs(ds,{children:[e.jsxs(os,{children:[e.jsxs(ms,{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"w-5 h-5 text-green-500"}),"User Created Successfully"]}),e.jsx(xs,{children:"The user has been created and can now set their password."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"User Details:"}),e.jsxs("p",{className:"text-sm",children:["Email: ",e.jsx("span",{className:"font-mono",children:null==m?void 0:m.email})]}),e.jsxs("p",{className:"text-sm",children:["Name: ",null==m?void 0:m.full_name]}),e.jsxs("p",{className:"text-sm",children:["Role: ",null==m?void 0:m.role]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-100 mb-2",children:"Next Steps:"}),e.jsxs("ol",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1 list-decimal list-inside",children:[e.jsx("li",{children:"The user will receive a confirmation email from Supabase"}),e.jsx("li",{children:'Click the "Send Password Reset" button below to send setup instructions'}),e.jsx("li",{children:"The user can then set their own password and login"})]})]})]}),e.jsxs(hs,{children:[e.jsx(b,{variant:"outline",onClick:()=>u(!1),children:"Close"}),e.jsxs(b,{onClick:()=>{A(null==m?void 0:m.email),u(!1)},disabled:C,children:[C&&e.jsx(Ee,{className:"w-4 h-4 mr-2 animate-spin"}),e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Send Password Reset"]})]})]})})]})},it=({user:s})=>{const[a]=v(),[t,i]=g.useState("dashboard");g.useEffect(()=>{const e=a.get("tab");i(e||"dashboard")},[a]);const r=[{id:"dashboard",label:"Dashboard",icon:ls},{id:"analytics",label:"Analytics",icon:H},{id:"revenue",label:"Revenue",icon:z},{id:"users",label:"Users",icon:rs},{id:"customers",label:"User Management",icon:O},{id:"subscriptions",label:"Subscriptions",icon:B},{id:"payments",label:"Payments",icon:ns},{id:"coupons",label:"Coupons",icon:J},{id:"referrals",label:"Referrals",icon:je},{id:"issues",label:"Support",icon:X},{id:"blog",label:"Blog",icon:fe},{id:"website",label:"Website",icon:K},{id:"ai-coach",label:"AI Coach",icon:is},{id:"studio",label:"Database",icon:se}],l=g.useMemo(()=>{if(!s||!s.role)return r;if("super_admin"===s.role||"admin"===s.role)return r;const e=((e,s)=>e&&e.role?s.filter(s=>pa(e,s.id)):[])(s,r);return 0===e.length?r:e},[s]);return e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:["dashboard"!==t&&!["website","blog"].includes(t)&&e.jsxs(b,{variant:"ghost",onClick:()=>i("dashboard"),className:"mb-4",children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"flex gap-2 p-2 glass-effect rounded-lg min-w-max",children:l.map(s=>{const a=s.icon;return e.jsxs("button",{onClick:()=>i(s.id),className:"flex items-center gap-2 px-4 py-2 rounded-lg transition-all whitespace-nowrap "+(t===s.id?"bg-primary text-primary-foreground shadow-lg":"hover:bg-muted/50 text-text-secondary hover:text-foreground"),children:[e.jsx(a,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:s.label})]},s.id)})})})]}),e.jsx(R,{children:e.jsx(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:(()=>{switch(t){case"dashboard":return e.jsx(ja,{user:s,onNavigate:i});case"analytics":return e.jsx(fa,{user:s});case"revenue":return e.jsx(As,{});case"users":return e.jsx(tt,{user:s});case"studio":return e.jsx(ga,{user:s});case"customers":return e.jsx(Ma,{user:s});case"subscriptions":return e.jsx(Na,{user:s});case"payments":return e.jsx(qa,{user:s});case"coupons":return e.jsx(Ha,{user:s});case"referrals":return e.jsx(Qa,{user:s});case"issues":return e.jsx(Ua,{user:s});case"blog":return e.jsx(E,{user:s});case"website":return e.jsx(Wa,{user:s});case"ai-coach":return e.jsx(at,{user:s});default:return e.jsx(ja,{user:s})}})()},t)})]})},rt=()=>{var s;const{userProfile:a}=C(),t={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}};return e.jsxs(e.Fragment,{children:[e.jsxs(T,{children:[e.jsx("title",{children:"Admin Dashboard - GreenoFig"}),e.jsx("meta",{name:"description",content:"Platform management and analytics."})]}),e.jsxs(V.div,{variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"visible",className:"space-y-8",children:[e.jsxs(V.div,{variants:t,children:[e.jsxs("h1",{className:"text-4xl font-bold",children:["Admin ",e.jsx("span",{className:"gradient-text",children:"Command Center"})]}),e.jsxs("p",{className:"text-text-secondary mt-2",children:["Welcome, ",(null==(s=null==a?void 0:a.full_name)?void 0:s.split(" ")[0])||"Admin",". Manage your platform from here."]})]}),e.jsx(V.div,{variants:t,children:e.jsx(it,{user:a})})]})]})};export{rt as default};
