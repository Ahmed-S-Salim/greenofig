import{s as e}from"./index-8b14cb79.js";var t,r="https://js.stripe.com",n="".concat(r,"/").concat("clover","/stripe.js"),a=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,s=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,o=function(e){return a.test(e)||s.test(e)},c=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",r=document.createElement("script");r.src="".concat(n).concat(t);var a=document.head||document.body;if(!a)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return a.appendChild(r),r},i=null,u=null,d=null,l=function(e){return null!==i?i:(i=new Promise(function(t,n){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.Stripe,window.Stripe)t(window.Stripe);else try{var a=function(){for(var e=document.querySelectorAll('script[src^="'.concat(r,'"]')),t=0;t<e.length;t++){var n=e[t];if(o(n.src))return n}return null}();if(a&&e);else if(a){if(a&&null!==d&&null!==u){var s;a.removeEventListener("load",d),a.removeEventListener("error",u),null===(s=a.parentNode)||void 0===s||s.removeChild(a),a=c(e)}}else a=c(e);d=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}}(t,n),u=function(e){return function(t){e(new Error("Failed to load Stripe.js",{cause:t}))}}(n),a.addEventListener("load",d),a.addEventListener("error",u)}catch(i){return void n(i)}else t(null)})).catch(function(e){return i=null,Promise.reject(e)})};Promise.resolve().then(function(){return t||(t=l(null).catch(function(e){return t=null,Promise.reject(e)}))}).catch(function(e){});const f=async t=>{try{const{data:r,error:n}=await e.from("user_subscriptions").select("\n        *,\n        subscription_plans (*)\n      ").eq("user_id",t).single();if(n&&"PGRST116"!==n.code)throw n;return r}catch(r){return null}},p=async(t,r=null,n=null)=>{try{const{data:a,error:s}=await e.from("user_subscriptions").update({cancel_at_period_end:!0,status:"canceled",canceled_at:(new Date).toISOString(),cancellation_reason:r,cancellation_feedback:n}).eq("user_id",t).select().single();if(s)throw s;return a}catch(a){throw a}},m=async t=>{try{const{data:r,error:n}=await e.from("payment_methods").select("*").eq("user_id",t).eq("status","active").order("is_default",{ascending:!1}).order("created_at",{ascending:!1});if(n)throw n;return r||[]}catch(r){return[]}},w=async(t,r)=>{try{await e.from("payment_methods").update({is_default:!1}).eq("user_id",t);const{data:n,error:a}=await e.from("payment_methods").update({is_default:!0}).eq("id",r).eq("user_id",t).select().single();if(a)throw a;return n}catch(n){throw n}},h=async(t,r)=>{try{const{data:n,error:a}=await e.from("payment_methods").update({status:"inactive"}).eq("id",r).eq("user_id",t).select().single();if(a)throw a;return n}catch(n){throw n}},_=async({userId:t,paymentTransactionId:r,amount:n,reason:a,refundType:s="full",customerNotes:o=null})=>{try{const{data:c,error:i}=await e.from("refunds").insert([{user_id:t,payment_transaction_id:r,amount:n,reason:a,refund_type:s,customer_notes:o,status:"pending",requested_by:t}]).select().single();if(i)throw i;return c}catch(c){throw c}},y=async t=>{try{const{data:r,error:n}=await e.from("refunds").select("\n        *,\n        payment_transactions (*)\n      ").eq("user_id",t).order("created_at",{ascending:!1});if(n)throw n;return r||[]}catch(r){return[]}};export{m as a,y as b,p as c,h as d,f as g,_ as r,w as s};
