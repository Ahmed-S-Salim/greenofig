var e=Object.defineProperty,__publicField=(s,t,l)=>((s,t,l)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[t]=l)(s,"symbol"!=typeof t?t+"":t,l),__async=(e,s,t)=>new Promise((l,r)=>{var fulfilled=e=>{try{step(t.next(e))}catch(s){r(s)}},rejected=e=>{try{step(t.throw(e))}catch(s){r(s)}},step=e=>e.done?l(e.value):Promise.resolve(e.value).then(fulfilled,rejected);step((t=t.apply(e,s)).next())});import{j as s}from"./vendor-ui-gkPPHEPH.js";import{R as t,u as l,a as r}from"./vendor-react-Dds8VpLH.js";import{B as a,s as i,t as n,e as o}from"./index-CKU5P2TY.js";import{C as c,a as d,b as m,c as u,e as h}from"./card-Pj_OUEuM.js";import{J as x,ah as p,c as g,ai as j,ab as f,aj as v,ak as N,a8 as b,al as y,ag as w,o as _,G as C,g as P,j as k,z as S,p as E,af as D,I as M,T as A,P as $}from"./vendor-utils-CisQTPNT.js";import{I as z}from"./input-EoRmzMlo.js";import{T,a as V,b as F,c as I}from"./tabs-rmIyZk1l.js";import{C as R}from"./checkbox-D0W6Xbvk.js";class L extends t.Component{constructor(e){super(e),__publicField(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})}),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,s){console.error("Error caught by boundary:",e,s),this.setState({error:e,errorInfo:s})}render(){return this.state.hasError?s.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:s.jsxs(c,{className:"max-w-2xl w-full glass-effect",children:[s.jsx(d,{children:s.jsxs(m,{className:"flex items-center gap-3 text-2xl",children:[s.jsx(x,{className:"w-8 h-8 text-red-500"}),"Something Went Wrong"]})}),s.jsxs(u,{className:"space-y-4",children:[s.jsx("p",{className:"text-text-secondary",children:"We encountered an unexpected error. This has been logged and we'll look into it."}),this.state.error&&s.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-lg",children:s.jsx("p",{className:"font-mono text-sm text-red-400",children:this.state.error.toString()})}),s.jsxs("div",{className:"flex gap-3",children:[s.jsxs(a,{onClick:this.handleReset,className:"flex items-center gap-2",children:[s.jsx(p,{className:"w-4 h-4"}),"Try Again"]}),s.jsx(a,{variant:"outline",onClick:()=>{const e=window.location.hostname.includes("github.io")?"/greenofig":"";window.location.href=`${e}/app/admin`},children:"Go to Dashboard"})]}),!1]})]})}):this.props.children}}const EnhancedBlogManager=({user:e})=>{const t=l(),[L,B]=r.useState([]),[q,W]=r.useState([]),[G,O]=r.useState([]),[J,U]=r.useState(""),[H,K]=r.useState("all"),[Q,X]=r.useState("all"),[Y,Z]=r.useState("all"),[ee,se]=r.useState(!0),[te,le]=r.useState("posts"),[re,ae]=r.useState([]),[ie,ne]=r.useState([]),[oe,ce]=r.useState([]),[de,me]=r.useState([]),[ue,he]=r.useState({totalPosts:0,publishedPosts:0,draftPosts:0,scheduledPosts:0,totalViews:0,totalComments:0,pendingComments:0,avgViewsPerPost:0});r.useEffect(()=>{fetchPosts(),fetchCategories(),fetchAuthors(),fetchComments(),fetchAnalytics()},[]),r.useEffect(()=>{filterPosts()},[J,H,Q,Y,L]);const fetchPosts=()=>__async(null,null,function*(){se(!0);try{const{data:e,error:s}=yield i.from("blog_posts").select("\n          *,\n          author:user_profiles!blog_posts_author_id_fkey(id, full_name, email)\n        ").order("created_at",{ascending:!1});if(s)throw s;B(e||[])}catch(e){console.error("Error fetching posts:",e),n({variant:"destructive",title:"Error",description:"Failed to fetch blog posts"})}finally{se(!1)}}),fetchCategories=()=>__async(null,null,function*(){try{const{data:e,error:s}=yield i.from("blog_categories").select("*").order("name",{ascending:!0});if(s)throw s;W(e||[])}catch(e){console.error("Error fetching categories:",e)}}),fetchAuthors=()=>__async(null,null,function*(){try{const{data:e,error:s}=yield i.from("user_profiles").select("id, full_name, email, role").in("role",["nutritionist","admin","super_admin"]).order("full_name",{ascending:!0});if(s)throw s;ne(e||[])}catch(e){console.error("Error fetching authors:",e)}}),fetchComments=()=>__async(null,null,function*(){try{const{data:e,error:s}=yield i.from("blog_comments").select("\n          *,\n          blog_post:blog_posts(title, slug),\n          user:user_profiles(full_name)\n        ").order("created_at",{ascending:!1});if(s)throw s;ce(e||[]),me((null==e?void 0:e.filter(e=>!e.is_approved))||[])}catch(e){console.error("Error fetching comments:",e)}}),fetchAnalytics=()=>__async(null,null,function*(){try{const{data:e}=yield i.from("blog_posts").select("status, view_count"),{data:s}=yield i.from("blog_comments").select("is_approved");if(e){const t=e.reduce((e,s)=>e+(s.view_count||0),0),l={totalPosts:e.length,publishedPosts:e.filter(e=>"published"===e.status).length,draftPosts:e.filter(e=>"draft"===e.status).length,scheduledPosts:e.filter(e=>"scheduled"===e.status).length,totalViews:t,totalComments:(null==s?void 0:s.length)||0,pendingComments:(null==s?void 0:s.filter(e=>!e.is_approved).length)||0,avgViewsPerPost:e.length>0?Math.round(t/e.length):0};he(l)}}catch(e){console.error("Error fetching analytics:",e)}}),filterPosts=()=>{let e=L;J&&(e=e.filter(e=>{var s,t;return(null==(s=e.title)?void 0:s.toLowerCase().includes(J.toLowerCase()))||(null==(t=e.excerpt)?void 0:t.toLowerCase().includes(J.toLowerCase()))})),"all"!==H&&(e=e.filter(e=>e.status===H)),"all"!==Q&&(e=e.filter(e=>e.author_id===Q)),"all"!==Y&&(e=e.filter(e=>e.category===Y)),O(e)},handleBulkAction=e=>__async(null,null,function*(){if(0!==re.length)try{switch(e){case"publish":yield i.from("blog_posts").update({status:"published",published_at:(new Date).toISOString()}).in("id",re),n({title:`Published ${re.length} posts`});break;case"draft":yield i.from("blog_posts").update({status:"draft"}).in("id",re),n({title:`Moved ${re.length} posts to draft`});break;case"archive":yield i.from("blog_posts").update({status:"archived"}).in("id",re),n({title:`Archived ${re.length} posts`});break;case"delete":confirm(`Delete ${re.length} posts permanently?`)&&(yield i.from("blog_posts").delete().in("id",re),n({title:`Deleted ${re.length} posts`}))}ae([]),fetchPosts(),fetchAnalytics()}catch(s){console.error("Bulk action error:",s),n({variant:"destructive",title:"Error",description:"Failed to perform bulk action"})}else n({variant:"destructive",title:"No posts selected",description:"Please select posts to perform bulk actions"})}),StatCard=({icon:e,title:t,value:l,change:r,color:a})=>s.jsx(c,{children:s.jsx(u,{className:"p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:t}),s.jsx("h3",{className:"text-3xl font-bold text-foreground",children:l}),r&&s.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400 mt-1 flex items-center gap-1",children:[s.jsx(C,{className:"w-4 h-4"}),r]})]}),s.jsx("div",{className:`p-4 rounded-full ${a||"bg-primary/10"}`,children:s.jsx(e,{className:"w-6 h-6 text-primary"})})]})})}),PostCard=({post:l})=>{var r;const d=re.includes(l.id);return s.jsx(c,{className:"glass-effect hover:shadow-lg transition-all "+(d?"ring-2 ring-primary":""),children:s.jsxs(u,{className:"p-6",children:[s.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[s.jsx(R,{checked:d,onCheckedChange:()=>{return e=l.id,void ae(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e]);var e}}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-semibold text-lg mb-1",children:l.title}),s.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:l.excerpt||"No excerpt"})]}),s.jsx(o,{className:{draft:"bg-gray-500",published:"bg-green-500",scheduled:"bg-blue-500",archived:"bg-red-500"}[l.status],children:l.status})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(M,{className:"w-4 h-4 text-muted-foreground"}),s.jsx("span",{children:(null==(r=l.author)?void 0:r.full_name)||"Unknown"})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(_,{className:"w-4 h-4 text-muted-foreground"}),s.jsxs("span",{children:[l.view_count||0," views"]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(P,{className:"w-4 h-4 text-muted-foreground"}),s.jsx("span",{children:l.published_at?S(new Date(l.published_at),"MMM d"):"Not published"})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(A,{className:"w-4 h-4 text-muted-foreground"}),s.jsx("span",{children:l.focus_keyword||"No keyword"})]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(a,{variant:"outline",size:"sm",onClick:()=>{const s="nutritionist"===(null==e?void 0:e.role)?"nutritionist":"admin";l.id,t(`/app/${s}/blog/edit/${l.id}`)},className:"flex-1",children:[s.jsx($,{className:"w-4 h-4 mr-1"}),"Edit"]}),s.jsx(a,{variant:"outline",size:"sm",onClick:()=>{return e=l.id,__async(null,null,function*(){if(confirm("Are you sure you want to delete this post?"))try{const{error:s}=yield i.from("blog_posts").delete().eq("id",e);if(s)throw s;n({title:"Post deleted successfully"}),fetchPosts(),fetchAnalytics()}catch(s){console.error("Error deleting post:",s),n({variant:"destructive",title:"Error",description:"Failed to delete post"})}});var e},className:"text-destructive",children:s.jsx(w,{className:"w-4 h-4"})}),"published"===l.status&&s.jsx(a,{variant:"outline",size:"sm",onClick:()=>{const e=window.location.hostname.includes("github.io")?"/greenofig":"";window.open(`${e}/blog/${l.slug}`,"_blank")},children:s.jsx(_,{className:"w-4 h-4"})})]})]})})};return ee?s.jsx("div",{className:"flex items-center justify-center h-96",children:s.jsx(g,{className:"w-12 h-12 animate-spin text-primary"})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[s.jsx(j,{className:"w-8 h-8 text-primary"}),"Blog Management"]}),s.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage all blog posts, categories, and comments"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(a,{variant:"outline",onClick:fetchPosts,children:[s.jsx(p,{className:"w-4 h-4 mr-2"}),"Refresh"]}),s.jsxs(a,{onClick:()=>{const s="nutritionist"===(null==e?void 0:e.role)?"nutritionist":"admin";t(`/app/${s}/blog/new`)},children:[s.jsx(f,{className:"w-4 h-4 mr-2"}),"Create Post"]})]})]}),s.jsxs(T,{value:te,onValueChange:le,children:[s.jsxs(V,{className:"grid w-full grid-cols-4",children:[s.jsxs(F,{value:"posts",children:["Posts (",ue.totalPosts,")"]}),s.jsxs(F,{value:"analytics",children:[s.jsx(v,{className:"w-4 h-4 mr-1"}),"Analytics"]}),s.jsxs(F,{value:"categories",children:["Categories (",q.length,")"]}),s.jsxs(F,{value:"comments",children:["Comments (",ue.pendingComments," pending)"]})]}),s.jsxs(I,{value:"posts",className:"space-y-4",children:[s.jsx(c,{className:"glass-effect",children:s.jsx(u,{className:"p-4",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx(N,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),s.jsx(z,{placeholder:"Search posts...",value:J,onChange:e=>U(e.target.value),className:"pl-10"})]}),s.jsxs("select",{value:H,onChange:e=>K(e.target.value),className:"px-3 py-2 bg-background border border-border rounded-md",children:[s.jsx("option",{value:"all",children:"All Status"}),s.jsx("option",{value:"published",children:"Published"}),s.jsx("option",{value:"draft",children:"Draft"}),s.jsx("option",{value:"scheduled",children:"Scheduled"}),s.jsx("option",{value:"archived",children:"Archived"})]}),s.jsxs("select",{value:Q,onChange:e=>X(e.target.value),className:"px-3 py-2 bg-background border border-border rounded-md",children:[s.jsx("option",{value:"all",children:"All Authors"}),ie.map(e=>s.jsx("option",{value:e.id,children:e.full_name},e.id))]}),s.jsxs("select",{value:Y,onChange:e=>Z(e.target.value),className:"px-3 py-2 bg-background border border-border rounded-md",children:[s.jsx("option",{value:"all",children:"All Categories"}),q.map(e=>s.jsx("option",{value:e.slug,children:e.name},e.id))]})]}),re.length>0&&s.jsxs("div",{className:"flex items-center gap-2 p-3 bg-primary/10 rounded-lg",children:[s.jsxs("span",{className:"text-sm font-medium",children:[re.length," posts selected"]}),s.jsxs("div",{className:"flex gap-2 ml-auto",children:[s.jsxs(a,{size:"sm",variant:"outline",onClick:()=>handleBulkAction("publish"),children:[s.jsx(b,{className:"w-4 h-4 mr-1"}),"Publish"]}),s.jsxs(a,{size:"sm",variant:"outline",onClick:()=>handleBulkAction("draft"),children:[s.jsx(j,{className:"w-4 h-4 mr-1"}),"Draft"]}),s.jsxs(a,{size:"sm",variant:"outline",onClick:()=>handleBulkAction("archive"),children:[s.jsx(y,{className:"w-4 h-4 mr-1"}),"Archive"]}),s.jsxs(a,{size:"sm",variant:"outline",onClick:()=>handleBulkAction("delete"),className:"text-destructive",children:[s.jsx(w,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(R,{checked:re.length===G.length&&G.length>0,onCheckedChange:()=>{re.length===G.length?ae([]):ae(G.map(e=>e.id))}}),s.jsxs("span",{className:"text-sm text-muted-foreground",children:["Select All (",G.length," posts)"]})]})]})})}),G.length>0?s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:G.map(e=>s.jsx(PostCard,{post:e},e.id))}):s.jsx(c,{className:"glass-effect",children:s.jsxs(u,{className:"p-12 text-center",children:[s.jsx(j,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),s.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No posts found"}),s.jsx("p",{className:"text-muted-foreground",children:J||"all"!==H?"Try adjusting your filters":"No blog posts yet"})]})})]}),s.jsxs(I,{value:"analytics",className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[s.jsx(StatCard,{icon:j,title:"Total Posts",value:ue.totalPosts}),s.jsx(StatCard,{icon:b,title:"Published",value:ue.publishedPosts}),s.jsx(StatCard,{icon:_,title:"Total Views",value:ue.totalViews.toLocaleString()}),s.jsx(StatCard,{icon:C,title:"Avg Views/Post",value:ue.avgViewsPerPost})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[s.jsx(StatCard,{icon:j,title:"Drafts",value:ue.draftPosts}),s.jsx(StatCard,{icon:P,title:"Scheduled",value:ue.scheduledPosts}),s.jsx(StatCard,{icon:k,title:"Total Comments",value:ue.totalComments}),s.jsx(StatCard,{icon:x,title:"Pending Comments",value:ue.pendingComments})]}),s.jsxs(c,{children:[s.jsx(d,{children:s.jsx(m,{children:"Top Performing Posts"})}),s.jsx(u,{children:s.jsx("div",{className:"space-y-3",children:L.filter(e=>"published"===e.status).sort((e,s)=>(s.view_count||0)-(e.view_count||0)).slice(0,10).map((e,t)=>{var l;return s.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 text-primary font-bold",children:t+1}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:e.title}),s.jsx("p",{className:"text-sm text-muted-foreground",children:null==(l=e.author)?void 0:l.full_name})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"font-bold",children:e.view_count||0}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"views"})]})]},e.id)})})})]})]}),s.jsx(I,{value:"categories",className:"space-y-4",children:s.jsxs(c,{children:[s.jsxs(d,{children:[s.jsx(m,{children:"Blog Categories"}),s.jsx(h,{children:"Manage content categories"})]}),s.jsx(u,{children:s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:q.map(e=>s.jsxs("div",{className:"p-4 bg-card border border-border rounded-lg",children:[s.jsx("h3",{className:"font-semibold mb-1",children:e.name}),s.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:e.description||"No description"}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("span",{className:"text-xs text-muted-foreground",children:[L.filter(s=>s.category===e.slug).length," posts"]}),s.jsx(o,{variant:"outline",children:e.slug})]})]},e.id))})})]})}),s.jsxs(I,{value:"comments",className:"space-y-4",children:[s.jsxs(c,{children:[s.jsxs(d,{children:[s.jsxs(m,{children:["Pending Comments (",de.length,")"]}),s.jsx(h,{children:"Review and moderate comments"})]}),s.jsx(u,{children:de.length>0?s.jsx("div",{className:"space-y-3",children:de.map(e=>{var t,l;return s.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg",children:[s.jsxs("div",{className:"flex items-start justify-between mb-2",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:e.author_name||(null==(t=e.user)?void 0:t.full_name)}),s.jsxs("p",{className:"text-sm text-muted-foreground",children:['on "',null==(l=e.blog_post)?void 0:l.title,'"']})]}),s.jsx("span",{className:"text-xs text-muted-foreground",children:S(new Date(e.created_at),"MMM d, yyyy")})]}),s.jsx("p",{className:"text-sm mb-3",children:e.content}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(a,{size:"sm",onClick:()=>{return s=e.id,__async(null,null,function*(){try{const{error:e}=yield i.from("blog_comments").update({is_approved:!0}).eq("id",s);if(e)throw e;n({title:"Comment approved"}),fetchComments(),fetchAnalytics()}catch(e){console.error("Error approving comment:",e),n({variant:"destructive",title:"Error",description:"Failed to approve comment"})}});var s},children:[s.jsx(E,{className:"w-4 h-4 mr-1"}),"Approve"]}),s.jsxs(a,{size:"sm",variant:"outline",onClick:()=>{return s=e.id,__async(null,null,function*(){if(confirm("Delete this comment?"))try{const{error:e}=yield i.from("blog_comments").delete().eq("id",s);if(e)throw e;n({title:"Comment deleted"}),fetchComments(),fetchAnalytics()}catch(e){console.error("Error deleting comment:",e),n({variant:"destructive",title:"Error",description:"Failed to delete comment"})}});var s},children:[s.jsx(D,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]},e.id)})}):s.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No pending comments"})})]}),s.jsxs(c,{children:[s.jsx(d,{children:s.jsx(m,{children:"Recent Comments"})}),s.jsx(u,{children:s.jsx("div",{className:"space-y-3",children:oe.filter(e=>e.is_approved).slice(0,10).map(e=>{var t,l;return s.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg",children:[s.jsxs("div",{className:"flex items-start justify-between mb-1",children:[s.jsx("p",{className:"font-medium text-sm",children:e.author_name||(null==(t=e.user)?void 0:t.full_name)}),s.jsx("span",{className:"text-xs text-muted-foreground",children:S(new Date(e.created_at),"MMM d")})]}),s.jsxs("p",{className:"text-sm text-muted-foreground mb-1",children:['on "',null==(l=e.blog_post)?void 0:l.title,'"']}),s.jsx("p",{className:"text-sm",children:e.content})]},e.id)})})})]})]})]})]})};export{L as E,EnhancedBlogManager as a};
