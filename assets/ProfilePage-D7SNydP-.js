var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,__defNormalProp=(s,t,r)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,__spreadValues=(e,s)=>{for(var t in s||(s={}))a.call(s,t)&&__defNormalProp(e,t,s[t]);if(r)for(var t of r(s))l.call(s,t)&&__defNormalProp(e,t,s[t]);return e},__spreadProps=(e,r)=>s(e,t(r)),__async=(e,s,t)=>new Promise((r,a)=>{var fulfilled=e=>{try{step(t.next(e))}catch(s){a(s)}},rejected=e=>{try{step(t.throw(e))}catch(s){a(s)}},step=e=>e.done?r(e.value):Promise.resolve(e.value).then(fulfilled,rejected);step((t=t.apply(e,s)).next())});import{j as i}from"./vendor-ui-gkPPHEPH.js";import{a as d}from"./vendor-react-Dds8VpLH.js";import{u as n,H as o,B as c,A as m,a as u,b as x,s as p,t as h}from"./index-CKU5P2TY.js";import{C as f,c as g,a as j,b,e as v}from"./card-Pj_OUEuM.js";import{I as y}from"./input-EoRmzMlo.js";import{C as N}from"./checkbox-D0W6Xbvk.js";import{L as w}from"./label-qLSsZ5R6.js";import{c as _,m as k,U as P,P as C,k as S,T as E,l as F,n as A,E as O,o as U}from"./vendor-utils-CisQTPNT.js";import"./vendor-editor-DGqHsWbs.js";const ProfilePage=()=>{var e,s,t,$;const{user:H,userProfile:I,refreshUserProfile:q}=n(),[L,z]=d.useState(null),[D,G]=d.useState(!1),[M,W]=d.useState(!0),[B,Y]=d.useState(!1),[R,T]=d.useState(!1),V=d.useRef(null),[J,K]=d.useState(!1),[Q,X]=d.useState(""),[Z,ee]=d.useState(""),[se,te]=d.useState(""),[re,ae]=d.useState(!1),[le,ie]=d.useState(!1),[de,ne]=d.useState(!1);d.useEffect(()=>{I&&(z(__spreadValues({},I)),W(!1))},[I]);const handleInputChange=e=>{const{name:s,value:t}=e.target;z(e=>__spreadProps(__spreadValues({},e),{[s]:t}))},handleAvatarClick=()=>{D&&V.current.click()};return M||!L?i.jsx("div",{className:"flex items-center justify-center h-full",children:i.jsx(_,{className:"h-12 w-12 animate-spin text-primary"})}):i.jsxs(i.Fragment,{children:[i.jsxs(o,{children:[i.jsx("title",{children:"My Profile - GreenoFig"}),i.jsx("meta",{name:"description",content:"Manage your profile and settings."})]}),i.jsxs(k.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},initial:"hidden",animate:"visible",className:"max-w-4xl mx-auto space-y-8",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[i.jsxs("div",{children:[i.jsxs("h1",{className:"text-4xl font-bold",children:["My ",i.jsx("span",{className:"gradient-text",children:"Profile"})]}),i.jsx("p",{className:"text-text-secondary mt-2",children:"View and manage your personal details."})]}),i.jsx(c,{onClick:()=>G(!D),disabled:B||R,children:D?i.jsxs(i.Fragment,{children:[i.jsx(P,{className:"mr-2 h-4 w-4"})," View Profile"]}):i.jsxs(i.Fragment,{children:[i.jsx(C,{className:"mr-2 h-4 w-4"})," Edit Profile"]})})]}),i.jsx(f,{className:"glass-effect",children:i.jsx(g,{className:"p-6",children:D?i.jsxs("form",{onSubmit:e=>__async(null,null,function*(){if(e.preventDefault(),!H)return;Y(!0);const s=L,{id:t,created_at:i,updated_at:d,role:n,email:o,profile_picture_url:c}=s,m=((e,s)=>{var t={};for(var i in e)a.call(e,i)&&s.indexOf(i)<0&&(t[i]=e[i]);if(null!=e&&r)for(var i of r(e))s.indexOf(i)<0&&l.call(e,i)&&(t[i]=e[i]);return t})(s,["id","created_at","updated_at","role","email","profile_picture_url"]),{error:u}=yield p.from("user_profiles").update(m).eq("id",H.id);u?h({variant:"destructive",title:"Error updating profile",description:u.message}):(yield q(),h({title:"Profile Updated!",description:"Your information has been successfully saved."}),G(!1)),Y(!1)}),className:"space-y-6",children:[i.jsxs("div",{className:"flex items-center space-x-6",children:[i.jsxs("div",{className:"relative group",children:[i.jsxs(m,{className:"h-24 w-24 cursor-pointer",onClick:handleAvatarClick,children:[i.jsx(u,{src:null==L?void 0:L.profile_picture_url,alt:null==L?void 0:L.full_name}),i.jsx(x,{className:"text-4xl",children:(null==(e=null==L?void 0:L.full_name)?void 0:e.split(" ").map(e=>e[0]).join(""))||"?"})]}),R?i.jsx("div",{className:"absolute inset-0 bg-background/80 flex items-center justify-center rounded-full",children:i.jsx(_,{className:"h-8 w-8 animate-spin text-primary"})}):i.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center rounded-full opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer",onClick:handleAvatarClick,children:i.jsx(S,{className:"h-8 w-8 text-white"})}),i.jsx("input",{type:"file",ref:V,onChange:e=>__async(null,null,function*(){const s=e.target.files[0];if(!s||!H)return;T(!0);const t=s.name.split(".").pop(),r=`avatars/${`${H.id}.${t}`}`,{error:a}=yield p.storage.from("user-assets").upload(r,s,{upsert:!0});if(a)return h({variant:"destructive",title:"Upload failed",description:a.message}),void T(!1);const{data:{publicUrl:l}}=p.storage.from("user-assets").getPublicUrl(r),i=`${l}?t=${(new Date).getTime()}`,{error:d}=yield p.from("user_profiles").update({profile_picture_url:i}).eq("id",H.id);d?h({variant:"destructive",title:"Failed to save avatar",description:d.message}):(yield q(),h({title:"Avatar updated!",description:"Your new profile picture is now live."})),T(!1)}),accept:"image/png, image/jpeg",className:"hidden"})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"full_name",className:"block text-sm font-medium text-text-primary",children:"Full Name"}),i.jsx("input",{type:"text",name:"full_name",id:"full_name",value:L.full_name||"",onChange:handleInputChange,className:"mt-1 block w-full bg-background border border-border rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{children:[i.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-text-secondary",children:"Email"}),i.jsx("input",{type:"email",name:"email",id:"email",value:L.email||"",disabled:!0,className:"mt-1 block w-full bg-muted border-border rounded-md shadow-sm py-2 px-3 sm:text-sm cursor-not-allowed"})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"age",className:"block text-sm font-medium text-text-primary",children:"Age"}),i.jsx("input",{type:"number",name:"age",id:"age",value:L.age||"",onChange:handleInputChange,className:"mt-1 block w-full bg-background border border-border rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"height_cm",className:"block text-sm font-medium text-text-primary",children:"Height (cm)"}),i.jsx("input",{type:"number",name:"height_cm",id:"height_cm",value:L.height_cm||"",onChange:handleInputChange,className:"mt-1 block w-full bg-background border border-border rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"weight_kg",className:"block text-sm font-medium text-text-primary",children:"Weight (kg)"}),i.jsx("input",{type:"number",step:"0.1",name:"weight_kg",id:"weight_kg",value:L.weight_kg||"",onChange:handleInputChange,className:"mt-1 block w-full bg-background border border-border rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"})]})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"block text-sm font-medium text-text-primary mb-3 flex items-center gap-2",children:[i.jsx(E,{className:"w-4 h-4"}),"Health Goals"]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[{id:"lose_weight",label:"Lose Weight"},{id:"build_muscle",label:"Build Muscle"},{id:"improve_endurance",label:"Improve Endurance"},{id:"eat_healthier",label:"Eat Healthier"},{id:"increase_energy",label:"Increase Energy"},{id:"reduce_stress",label:"Reduce Stress"},{id:"better_sleep",label:"Better Sleep"}].map(e=>i.jsxs("div",{className:"flex items-center space-x-2 p-3 rounded-lg border border-border hover:bg-muted/50 transition-colors",children:[i.jsx(N,{id:e.id,checked:(L.health_goals||[]).includes(e.id),onCheckedChange:()=>(e=>{const s=L.health_goals||[],t=s.includes(e)?s.filter(s=>s!==e):[...s,e];z(e=>__spreadProps(__spreadValues({},e),{health_goals:t}))})(e.id)}),i.jsx(w,{htmlFor:e.id,className:"text-sm font-medium cursor-pointer flex-1",children:e.label})]},e.id))}),i.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Select all that apply to personalize your experience"})]}),i.jsx("div",{className:"flex justify-end",children:i.jsxs(c,{type:"submit",disabled:B||R,children:[B?i.jsx(_,{className:"mr-2 h-4 w-4 animate-spin"}):i.jsx(F,{className:"mr-2 h-4 w-4"}),"Save Changes"]})})]}):i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex items-center space-x-6",children:[i.jsxs(m,{className:"h-24 w-24 border-2 border-primary",children:[i.jsx(u,{src:null==L?void 0:L.profile_picture_url,alt:null==L?void 0:L.full_name}),i.jsx(x,{className:"text-4xl",children:(null==(s=null==L?void 0:L.full_name)?void 0:s.split(" ").map(e=>e[0]).join(""))||"?"})]}),i.jsxs("div",{children:[i.jsx("h2",{className:"text-3xl font-bold text-text-primary",children:L.full_name}),i.jsx("p",{className:"text-text-secondary",children:L.email}),i.jsx("p",{className:"text-sm text-muted-foreground capitalize mt-1",children:L.role||"user"})]})]}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-6 pt-6 border-t border-border",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Age"}),i.jsx("p",{className:"text-lg font-semibold",children:L.age||"N/A"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Gender"}),i.jsx("p",{className:"text-lg font-semibold capitalize",children:L.gender||"N/A"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Height"}),i.jsx("p",{className:"text-lg font-semibold",children:L.height_cm?`${L.height_cm} cm`:"N/A"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Weight"}),i.jsx("p",{className:"text-lg font-semibold",children:L.weight_kg?`${L.weight_kg} kg`:"N/A"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Activity Level"}),i.jsx("p",{className:"text-lg font-semibold capitalize",children:(null==(t=L.activity_level)?void 0:t.replace("_"," "))||"N/A"})]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Health Goals"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:(null==($=L.health_goals)?void 0:$.length)>0?L.health_goals.map(e=>i.jsx("span",{className:"px-3 py-1 text-sm rounded-full bg-primary/10 text-primary font-medium",children:e},e)):i.jsx("p",{children:"No goals set."})})]})]})})}),i.jsxs(f,{className:"glass-effect",children:[i.jsxs(j,{children:[i.jsxs(b,{className:"flex items-center gap-2",children:[i.jsx(A,{className:"w-5 h-5"}),"Change Password"]}),i.jsx(v,{children:"Update your password to keep your account secure"})]}),i.jsx(g,{children:i.jsxs("form",{onSubmit:e=>__async(null,null,function*(){if(e.preventDefault(),Z.length<8)h({variant:"destructive",title:"Password too short",description:"Password must be at least 8 characters long."});else if(Z===se){K(!0);try{const{error:e}=yield p.auth.signInWithPassword({email:H.email,password:Q});if(e)return h({variant:"destructive",title:"Incorrect current password",description:"Please enter your correct current password."}),void K(!1);const{error:s}=yield p.auth.updateUser({password:Z});if(s)throw s;h({title:"Password updated successfully",description:"Your password has been changed."}),X(""),ee(""),te("")}catch(s){console.error("Error updating password:",s),h({variant:"destructive",title:"Error updating password",description:s.message})}finally{K(!1)}}else h({variant:"destructive",title:"Passwords do not match",description:"Please make sure both passwords are the same."})}),className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Current Password"}),i.jsxs("div",{className:"relative",children:[i.jsx(y,{type:re?"text":"password",value:Q,onChange:e=>X(e.target.value),placeholder:"Enter current password",disabled:J,required:!0,className:"pr-10"}),i.jsx("button",{type:"button",onClick:()=>ae(!re),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:re?i.jsx(O,{className:"w-4 h-4"}):i.jsx(U,{className:"w-4 h-4"})})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"New Password"}),i.jsxs("div",{className:"relative",children:[i.jsx(y,{type:le?"text":"password",value:Z,onChange:e=>ee(e.target.value),placeholder:"Enter new password",disabled:J,required:!0,minLength:8,className:"pr-10"}),i.jsx("button",{type:"button",onClick:()=>ie(!le),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:le?i.jsx(O,{className:"w-4 h-4"}):i.jsx(U,{className:"w-4 h-4"})})]}),i.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"At least 8 characters"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Confirm New Password"}),i.jsxs("div",{className:"relative",children:[i.jsx(y,{type:de?"text":"password",value:se,onChange:e=>te(e.target.value),placeholder:"Confirm new password",disabled:J,required:!0,minLength:8,className:"pr-10"}),i.jsx("button",{type:"button",onClick:()=>ne(!de),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:de?i.jsx(O,{className:"w-4 h-4"}):i.jsx(U,{className:"w-4 h-4"})})]})]}),i.jsx("div",{className:"flex justify-end pt-4",children:i.jsxs(c,{type:"submit",disabled:J,children:[J&&i.jsx(_,{className:"mr-2 h-4 w-4 animate-spin"}),J?"Updating...":"Update Password"]})})]})})]})]})]})};export{ProfilePage as default};
