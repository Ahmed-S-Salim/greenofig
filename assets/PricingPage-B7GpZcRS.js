var __async=(e,s,t)=>new Promise((r,a)=>{var fulfilled=e=>{try{step(t.next(e))}catch(s){a(s)}},rejected=e=>{try{step(t.throw(e))}catch(s){a(s)}},step=e=>e.done?r(e.value):Promise.resolve(e.value).then(fulfilled,rejected);step((t=t.apply(e,s)).next())});import{j as e}from"./vendor-ui-gkPPHEPH.js";import{a as s,u as t,f as r}from"./vendor-react-Dds8VpLH.js";import{s as a,u as l,e as n,B as i,t as c,H as o,c as d}from"./index-CKU5P2TY.js";import{S as m}from"./SiteLayout-B0FdKiSe.js";import{D as x,b as p,c as u,d as h,e as y}from"./dialog-D_VtZS95.js";import"./index-CRPgruNs.js";import{$ as f,p as g,c as j,n as b,m as N,e as v}from"./vendor-utils-CisQTPNT.js";import"./OnboardingSurvey-C6cZk74l.js";import"./vendor-editor-DGqHsWbs.js";const createPaymentTransaction=e=>__async(null,[e],function*({userId:e,subscriptionPlanId:s,amount:t,billingCycle:r,paymentIntentId:l,status:n="pending"}){try{const{data:i,error:c}=yield a.from("payment_transactions").insert([{user_id:e,subscription_plan_id:s,amount:t,billing_cycle:r,payment_intent_id:l,payment_method:"stripe",status:n,currency:"USD"}]).select().single();if(c)throw c;return i}catch(i){throw console.error("Error creating payment transaction:",i),i}}),CheckoutDialog=({open:t,onOpenChange:r,plan:o,billingCycle:d="monthly"})=>{var m,N;const{user:v}=l(),[_,w]=s.useState(!1);if(!o)return null;const P="yearly"===d?o.price_yearly:o.price_monthly;"yearly"===d?o.price_yearly:o.price_monthly;const C="yearly"===d?12*o.price_monthly-o.price_yearly:0;return e.jsx(x,{open:t,onOpenChange:r,children:e.jsxs(p,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs(u,{children:[e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5","aria-hidden":"true"}),"Checkout"]}),e.jsx(y,{children:"Complete your subscription purchase"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 rounded-lg border border-border bg-background/50",role:"region","aria-label":"Plan summary",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-2 mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-bold",children:o.name}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:o.description})]}),o.is_popular&&e.jsx(n,{className:"bg-primary/20 text-primary self-start",children:"Popular"})]}),e.jsxs("div",{className:"space-y-2 pt-4 border-t border-border",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Billing Cycle:"}),e.jsx("span",{className:"font-semibold capitalize",children:d})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Price:"}),e.jsxs("span",{className:"font-semibold",children:["$",P.toFixed(2),"/","yearly"===d?"year":"month"]})]}),"yearly"===d&&C>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-400",children:[e.jsx("span",{children:"You Save:"}),e.jsxs("span",{className:"font-semibold",children:["$",C.toFixed(2),"/year"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"What's included:"}),e.jsxs("ul",{className:"space-y-2",children:[null==(m=o.features)?void 0:m.slice(0,5).map((s,t)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(g,{className:"w-4 h-4 text-green-400 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:s})]},t)),(null==(N=o.features)?void 0:N.length)>5&&e.jsxs("li",{className:"text-sm text-text-secondary",children:["+ ",o.features.length-5," more features"]})]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-primary/10 border border-primary/20",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold",children:"Total Due Today:"}),e.jsxs("span",{className:"text-2xl font-bold",children:["$",P.toFixed(2)]})]}),"yearly"===d&&e.jsxs("p",{className:"text-xs text-text-secondary mt-2",children:["Billed annually ($",(P/12).toFixed(2),"/month)"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(i,{onClick:()=>__async(null,null,function*(){if(v){w(!0);try{const s=yield createPaymentTransaction({userId:v.id,subscriptionPlanId:o.id,amount:P,billingCycle:d,paymentIntentId:`mock_pi_${Date.now()}`,status:"pending"});yield new Promise(e=>setTimeout(e,2e3)),yield createPaymentTransaction({userId:v.id,subscriptionPlanId:o.id,amount:P,billingCycle:d,paymentIntentId:s.payment_intent_id,status:"succeeded"});const t=new Date,l=new Date(t);"yearly"===d?l.setFullYear(l.getFullYear()+1):l.setMonth(l.getMonth()+1),yield(e={userId:v.id,subscriptionPlanId:o.id,stripeSubscriptionId:`sub_${Date.now()}`,status:"active",billingCycle:d,currentPeriodStart:t.toISOString(),currentPeriodEnd:l.toISOString()},__async(null,[e],function*({userId:e,subscriptionPlanId:s,stripeSubscriptionId:t,status:r,billingCycle:l,currentPeriodStart:n,currentPeriodEnd:i}){try{const{data:c,error:o}=yield a.from("user_subscriptions").upsert({user_id:e,subscription_plan_id:s,stripe_subscription_id:t,status:r,billing_cycle:l,current_period_start:n,current_period_end:i},{onConflict:"user_id"}).select().single();if(o)throw o;return c}catch(c){throw console.error("Error updating subscription:",c),c}})),c({title:"Payment Successful!",description:`You've successfully subscribed to ${o.name}`}),r(!1)}catch(s){console.error("Checkout error:",s),c({title:"Payment Failed",description:s.message||"An error occurred during checkout",variant:"destructive"})}finally{w(!1)}var e}else c({title:"Not Logged In",description:"Please log in to purchase a subscription",variant:"destructive"})}),disabled:_,className:"w-full",size:"lg","aria-label":_?"Processing payment":"Complete purchase",children:_?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"w-4 h-4 mr-2 animate-spin","aria-hidden":"true"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Complete Purchase"]})}),e.jsx(i,{onClick:()=>r(!1),disabled:_,variant:"outline",className:"w-full","aria-label":"Cancel checkout",children:"Cancel"})]}),e.jsxs("div",{className:"text-center text-xs text-text-secondary",role:"note",children:[e.jsx(b,{className:"w-3 h-3 inline mr-1","aria-hidden":"true"}),"Secure payment powered by Stripe"]})]})]})})},PricingPage=({logoUrl:n})=>{const x=t(),p=r(),{user:u}=l(),[h,y]=s.useState("monthly"),[f,g]=s.useState([]),[b,_]=s.useState(!0),[w,P]=s.useState(null),[C,S]=s.useState(null),[I,k]=s.useState(!1);s.useEffect(()=>{var e;(null==(e=p.state)?void 0:e.recommendedPlan)&&(P(p.state.recommendedPlan),setTimeout(()=>{c({title:"Plan Recommended! âœ¨",description:`Based on your survey, we recommend the ${p.state.recommendedPlan} plan for you.`,duration:5e3})},500))},[p.state]),s.useEffect(()=>{__async(null,null,function*(){_(!0);const{data:e,error:s}=yield a.from("subscription_plans").select("*").eq("is_active",!0).order("price_monthly",{ascending:!0});s?c({title:"Error fetching pricing",description:s.message,variant:"destructive"}):g(e),_(!1)})},[]);const handleChoosePlan=e=>{u?x("/survey",{state:{selectedPlan:e}}):x("/signup",{state:{selectedPlan:e.name}})};return e.jsxs(m,{logoUrl:n,pageTitle:e.jsxs(e.Fragment,{children:["Simple, Transparent ",e.jsx("span",{className:"gradient-text",children:"Pricing"})]}),pageDescription:"Choose the perfect plan to kickstart your health transformation. No hidden fees.",children:[e.jsxs(o,{children:[e.jsx("title",{children:"Pricing - GreenoFig"}),e.jsx("meta",{name:"description",content:"Explore GreenoFig's flexible pricing plans and find the perfect fit for your health and wellness journey."}),e.jsx("link",{rel:"canonical",href:"https://greenofig.com/pricing"}),e.jsx("meta",{property:"og:title",content:"Pricing - GreenoFig"}),e.jsx("meta",{property:"og:description",content:"Explore GreenoFig's flexible pricing plans and find the perfect fit for your health and wellness journey."}),e.jsx("meta",{property:"og:url",content:"https://greenofig.com/pricing"}),e.jsx("meta",{property:"og:type",content:"website"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"mb-12 flex items-center gap-2 glass-effect p-1 rounded-full",children:[e.jsx(i,{onClick:()=>y("monthly"),variant:"monthly"===h?"default":"ghost",className:"rounded-full px-6",children:"Monthly"}),e.jsxs(i,{onClick:()=>y("yearly"),variant:"yearly"===h?"default":"ghost",className:"rounded-full px-6 relative",children:["Yearly",e.jsxs("span",{className:"absolute -top-2 -right-2 bg-destructive text-destructive-foreground text-xs font-bold px-2 py-0.5 rounded-full",children:["Save ",25,"%"]})]})]}),b?e.jsx("div",{className:"flex justify-center items-center h-96",children:e.jsx(j,{className:"w-12 h-12 animate-spin text-primary"})}):e.jsxs("div",{className:"w-full space-y-6",children:[f.filter(e=>0===e.price_monthly).map((s,t)=>{var r;const a=w===s.name;return e.jsxs(N.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.1*t},className:d("glass-effect p-4 rounded-xl flex flex-col md:flex-row items-center gap-4 border-2 relative max-w-5xl mx-auto",a?"border-primary ring-4 ring-primary/50":"border-border"),children:[a&&e.jsx("div",{className:"absolute top-0 -translate-y-1/2 left-1/2 -translate-x-1/2 px-3 py-1 text-xs font-semibold text-primary-foreground bg-green-500 rounded-full shadow-lg",children:"Recommended"}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h3",{className:"text-2xl font-bold mb-1",children:s.name}),e.jsx("p",{className:"text-text-secondary text-sm mb-2",children:s.description}),e.jsxs("div",{children:[e.jsx("span",{className:"text-3xl font-extrabold",children:"Free"}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Forever"})]})]}),e.jsxs("div",{className:"flex-1 md:border-l border-border md:pl-4",children:[e.jsx("ul",{className:"space-y-2 mb-3",children:null==(r=s.features)?void 0:r.slice(0,4).map(s=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(v,{className:"w-4 h-4 text-primary flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-xs",children:s})]},s))}),e.jsx(i,{onClick:()=>handleChoosePlan(s),className:"w-full",size:"sm",variant:a?"default":"outline",children:"Get Started"})]})]},s.id)}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-w-6xl mx-auto",children:(()=>{const s=f.filter(e=>e.price_monthly>0);let t=[...s].sort((e,s)=>e.price_monthly-s.price_monthly);if(w&&3===s.length){const e=s.findIndex(e=>e.name===w);if(-1!==e&&1!==e){const r=s[e],a=s.filter((s,t)=>t!==e);t=[a[0],r,a[1]].filter(Boolean)}}return t.map((s,t)=>{var r;const a=w===s.name;return e.jsxs(N.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.1*(t+1)},className:d("glass-effect p-4 rounded-xl flex flex-col border-2 relative",a?"border-primary ring-4 ring-primary/50":s.is_popular?"border-primary":"border-border"),children:[a&&e.jsx("div",{className:"absolute top-0 -translate-y-1/2 left-1/2 -translate-x-1/2 px-3 py-1 text-xs font-semibold text-primary-foreground bg-green-500 rounded-full shadow-lg",children:"Recommended"}),!a&&s.is_popular&&e.jsx("div",{className:"absolute top-0 -translate-y-1/2 left-1/2 -translate-x-1/2 px-3 py-1 text-xs font-semibold text-primary-foreground bg-primary rounded-full",children:"Most Popular"}),e.jsx("h3",{className:"text-lg font-bold text-center mb-1",children:s.name}),e.jsx("p",{className:"text-text-secondary text-center text-xs mb-3",children:s.description}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("span",{className:"text-3xl font-extrabold",children:"monthly"===h?`$${s.price_monthly}`:`$${(s.price_yearly/12).toFixed(2)}`}),e.jsx("span",{className:"text-sm font-medium text-text-secondary",children:"/mo"}),"yearly"===h&&e.jsxs("p",{className:"text-xs text-text-secondary mt-0.5",children:["billed $",s.price_yearly,"/year"]})]}),e.jsx("div",{className:"flex-grow",children:e.jsx("ul",{className:"space-y-2",children:null==(r=s.features)?void 0:r.map(s=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(v,{className:"w-3.5 h-3.5 text-primary flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-xs",children:s})]},s))})}),e.jsx(i,{onClick:()=>handleChoosePlan(s),className:"w-full mt-4",size:"sm",variant:a||s.is_popular?"default":"outline",children:"Choose Plan"})]},s.id)})})()})]})]}),e.jsx(CheckoutDialog,{open:I,onOpenChange:k,plan:C,billingCycle:h})]})};export{PricingPage as default};
