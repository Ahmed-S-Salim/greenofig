var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,__defNormalProp=(s,t,a)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,__spreadValues=(e,s)=>{for(var t in s||(s={}))l.call(s,t)&&__defNormalProp(e,t,s[t]);if(a)for(var t of a(s))r.call(s,t)&&__defNormalProp(e,t,s[t]);return e},__spreadProps=(e,a)=>s(e,t(a)),__async=(e,s,t)=>new Promise((a,l)=>{var fulfilled=e=>{try{step(t.next(e))}catch(s){l(s)}},rejected=e=>{try{step(t.throw(e))}catch(s){l(s)}},step=e=>e.done?a(e.value):Promise.resolve(e.value).then(fulfilled,rejected);step((t=t.apply(e,s)).next())});import{j as i}from"./vendor-ui-gkPPHEPH.js";import{a as n,L as c,h as d}from"./vendor-react-Dds8VpLH.js";import{u as o,s as m,B as u,T as x,t as h,e as p,d as g,H as j}from"./index-CKU5P2TY.js";import{E as f,a as v}from"./EnhancedBlogManager-CNYU-Gb2.js";import{C as b,a as N,b as y,c as _,e as w}from"./card-Pj_OUEuM.js";import{I as k,aO as C,g as S,G as M,a5 as E,a as A,z as F,aP as D,J as P,a8 as I,U as R,R as z,aQ as O,N as q,X as T,Y as L,O as W,aR as $,ab as U,ai as B,l as K,ak as V,aI as G,aJ as H,af as Y,P as J,ag as Z,aM as Q,T as X,aS as ee,aT as se,c as te,aU as ae,aV as le,aW as re,aX as ie,y as ne,aY as ce,aZ as de,a_ as oe,a$ as me,j as ue,f as xe,b0 as he,h as pe,ac as ge,p as je,b1 as fe,m as ve,ah as be,F as Ne,aj as ye,K as _e,Q as we,s as ke,b2 as Ce,b3 as Se,b4 as Me,b5 as Ee,V as Ae,W as Fe,_ as De,aa as Pe,w as Ie,b6 as Re,b7 as ze,am as Oe,o as qe,b8 as Te,b9 as Le,ba as We,bb as $e,bc as Ue,bd as Be}from"./vendor-utils-CisQTPNT.js";import{I as Ke}from"./input-EoRmzMlo.js";import{T as Ve,a as Ge,b as He,c as Ye}from"./tabs-rmIyZk1l.js";import{D as Je,b as Ze,c as Qe,d as Xe,f as es}from"./dialog-D_VtZS95.js";import{S as ss}from"./switch-oXOcT0uw.js";import"./checkbox-D0W6Xbvk.js";import"./vendor-editor-DGqHsWbs.js";const DashboardOverview=()=>{const{user:e}=o(),[s,t]=n.useState({totalClients:0,activeClients:0,activeMealPlans:0,upcomingAppointments:0}),[a,l]=n.useState([]),[r,d]=n.useState([]),[x,h]=n.useState([]),[p,g]=n.useState(!0);n.useEffect(()=>{e&&fetchDashboardData()},[e]);const fetchDashboardData=()=>__async(null,null,function*(){g(!0);try{const{data:s,error:a}=yield m.from("user_profiles").select("id, full_name, email, created_at").eq("role","user");if(a)throw a;const{data:r,error:i}=yield m.from("meal_plans_v2").select("id, name, status").eq("nutritionist_id",e.id).eq("status","active"),n=new Date;n.setHours(0,0,0,0);const c=new Date(n);c.setDate(c.getDate()+1);const{data:o,error:u}=yield m.from("appointments").select("*, user_profiles!appointments_client_id_fkey(full_name)").eq("nutritionist_id",e.id).gte("appointment_date",n.toISOString()).order("appointment_date",{ascending:!0}).limit(10),x=(null==o?void 0:o.filter(e=>{const s=new Date(e.appointment_date);return s>=n&&s<c}))||[];t({totalClients:(null==s?void 0:s.length)||0,activeClients:(null==s?void 0:s.length)||0,activeMealPlans:(null==r?void 0:r.length)||0,upcomingAppointments:(null==o?void 0:o.length)||0}),l(x),d([{id:1,type:"client_joined",message:"New client registered",time:"2 hours ago"},{id:2,type:"meal_plan",message:"Meal plan created for Sarah Johnson",time:"5 hours ago"},{id:3,type:"appointment",message:"Consultation completed with Mike Chen",time:"1 day ago"}]),h([{id:1,message:"3 clients need follow-up this week",priority:"high"},{id:2,message:"2 meal plans pending review",priority:"medium"}])}catch(s){console.error("Error fetching dashboard data:",s)}finally{g(!1)}}),StatCard=({icon:e,label:s,value:t,change:a,color:l})=>i.jsx(b,{className:"bg-card border-border",children:i.jsx(_,{className:"p-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:s}),i.jsx("h3",{className:"text-3xl font-bold text-foreground",children:t}),a&&i.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400 mt-1 flex items-center gap-1",children:[i.jsx(M,{className:"w-4 h-4"}),a]})]}),i.jsx("div",{className:`p-4 rounded-full ${l||"bg-primary/10"}`,children:i.jsx(e,{className:"w-6 h-6 "+(l?"text-primary-foreground":"text-primary")})})]})})});return p?i.jsx("div",{className:"flex items-center justify-center h-96",children:i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[i.jsx(StatCard,{icon:k,label:"Total Clients",value:s.totalClients,change:"+12% this month"}),i.jsx(StatCard,{icon:C,label:"Active Meal Plans",value:s.activeMealPlans,color:"bg-green-600 dark:bg-green-700"}),i.jsx(StatCard,{icon:S,label:"Upcoming Appointments",value:s.upcomingAppointments,color:"bg-blue-600 dark:bg-blue-700"}),i.jsx(StatCard,{icon:M,label:"Client Success Rate",value:"87%",change:"+5% this month",color:"bg-purple-600 dark:bg-purple-700"})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[i.jsxs(b,{className:"lg:col-span-2 bg-card border-border",children:[i.jsx(N,{children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs(y,{className:"flex items-center gap-2 text-foreground",children:[i.jsx(E,{className:"w-5 h-5"}),"Today's Schedule"]}),i.jsx(u,{variant:"ghost",size:"sm",asChild:!0,children:i.jsxs(c,{to:"/app/nutritionist?tab=schedule",children:["View All ",i.jsx(A,{className:"w-4 h-4 ml-1"})]})})]})}),i.jsx(_,{children:a.length>0?i.jsx("div",{className:"space-y-3",children:a.map(e=>{var s;return i.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg hover:bg-muted transition-colors",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-2 h-2 rounded-full bg-green-600 dark:bg-green-400"}),i.jsxs("div",{children:[i.jsx("p",{className:"font-semibold text-foreground",children:(null==(s=e.user_profiles)?void 0:s.full_name)||"Client"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:e.consultation_type||"Consultation"})]})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("p",{className:"text-sm font-medium text-foreground",children:F(new Date(e.appointment_date),"h:mm a")}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.duration_minutes," min"]})]})]},e.id)})}):i.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[i.jsx(S,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),i.jsx("p",{children:"No appointments scheduled for today"})]})})]}),i.jsxs(b,{className:"bg-card border-border",children:[i.jsx(N,{children:i.jsxs(y,{className:"flex items-center gap-2 text-foreground",children:[i.jsx(D,{className:"w-5 h-5"}),"Action Items"]})}),i.jsx(_,{children:i.jsx("div",{className:"space-y-3",children:x.map(e=>i.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg border "+("high"===e.priority?"bg-red-50/50 dark:bg-red-950/20 border-red-200 dark:border-red-900":"bg-yellow-50/50 dark:bg-yellow-950/20 border-yellow-200 dark:border-yellow-900"),children:[i.jsx(P,{className:"w-5 h-5 flex-shrink-0 "+("high"===e.priority?"text-red-600 dark:text-red-400":"text-yellow-600 dark:text-yellow-400")}),i.jsx("p",{className:"text-sm text-foreground",children:e.message})]},e.id))})})]})]}),i.jsxs(b,{className:"bg-card border-border",children:[i.jsx(N,{children:i.jsx(y,{className:"text-foreground",children:"Recent Activity"})}),i.jsx(_,{children:i.jsx("div",{className:"space-y-4",children:r.map(e=>i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm text-foreground",children:e.message}),i.jsx("p",{className:"text-xs text-muted-foreground",children:e.time})]}),i.jsx(I,{className:"w-4 h-4 text-green-600 dark:text-green-400"})]},e.id))})})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.jsx(u,{asChild:!0,className:"h-20 text-lg",variant:"outline",children:i.jsxs(c,{to:"/app/nutritionist?tab=clients",children:[i.jsx(k,{className:"w-5 h-5 mr-2"}),"Manage Clients"]})}),i.jsx(u,{asChild:!0,className:"h-20 text-lg",variant:"outline",children:i.jsxs(c,{to:"/app/nutritionist?tab=meals",children:[i.jsx(C,{className:"w-5 h-5 mr-2"}),"Create Meal Plan"]})}),i.jsx(u,{asChild:!0,className:"h-20 text-lg",variant:"outline",children:i.jsxs(c,{to:"/app/nutritionist?tab=schedule",children:[i.jsx(S,{className:"w-5 h-5 mr-2"}),"Schedule Appointment"]})})]})]})},ClientProfileDialog=({client:e,open:s,onOpenChange:t,onUpdate:a})=>{var l;const{user:r}=o(),[c,d]=n.useState("overview"),[p,g]=n.useState([]),[j,f]=n.useState(null),[v,w]=n.useState(""),[k,C]=n.useState({weight_kg:"",body_fat_percentage:"",waist_cm:"",hips_cm:""}),[S,M]=n.useState(!1);n.useEffect(()=>{s&&e&&fetchClientData()},[s,e]);const fetchClientData=()=>__async(null,null,function*(){try{const{data:s}=yield m.from("client_progress").select("*").eq("client_id",e.id).order("date",{ascending:!0});g(s||[]);const{data:t}=yield m.from("client_health_data").select("*").eq("client_id",e.id).single();f(t),w(e.nutritionist_notes||"")}catch(s){console.error("Error fetching client data:",s)}});return i.jsx(Je,{open:s,onOpenChange:t,children:i.jsxs(Ze,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[i.jsx(Qe,{children:i.jsxs(Xe,{className:"flex items-center gap-2",children:[i.jsx(R,{className:"w-5 h-5"}),null==e?void 0:e.full_name]})}),i.jsxs(Ve,{value:c,onValueChange:d,children:[i.jsxs(Ge,{className:"grid w-full grid-cols-3",children:[i.jsx(He,{value:"overview",children:"Overview"}),i.jsx(He,{value:"progress",children:"Progress Tracking"}),i.jsx(He,{value:"notes",children:"Notes"})]}),i.jsxs(Ye,{value:"overview",className:"space-y-4",children:[i.jsxs(b,{children:[i.jsx(N,{children:i.jsx(y,{children:"Basic Information"})}),i.jsxs(_,{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"Email"}),i.jsx("p",{className:"font-medium",children:null==e?void 0:e.email})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"Age"}),i.jsx("p",{className:"font-medium",children:(null==e?void 0:e.age)||"N/A"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"Height"}),i.jsx("p",{className:"font-medium",children:(null==e?void 0:e.height_cm)?`${e.height_cm} cm`:"N/A"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"Current Weight"}),i.jsx("p",{className:"font-medium",children:(null==e?void 0:e.latestWeight)?`${e.latestWeight} kg`:"N/A"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"BMI"}),i.jsx("p",{className:"font-medium",children:((e,s)=>{if(!e||!s)return"N/A";const t=s/100;return(e/(t*t)).toFixed(1)})(null==e?void 0:e.latestWeight,null==e?void 0:e.height_cm)})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"Activity Level"}),i.jsx("p",{className:"font-medium capitalize",children:(null==(l=null==e?void 0:e.activity_level)?void 0:l.replace("_"," "))||"N/A"})]})]})]}),j&&i.jsxs(b,{children:[i.jsx(N,{children:i.jsx(y,{children:"Health Information"})}),i.jsxs(_,{className:"space-y-3",children:[j.allergies&&j.allergies.length>0&&i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Allergies"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:j.allergies.map((e,s)=>i.jsx("span",{className:"px-2 py-1 bg-destructive/10 text-destructive rounded text-sm",children:e},s))})]}),j.dietary_restrictions&&j.dietary_restrictions.length>0&&i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Dietary Restrictions"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:j.dietary_restrictions.map((e,s)=>i.jsx("span",{className:"px-2 py-1 bg-amber-500/10 text-amber-600 rounded text-sm",children:e},s))})]})]})]})]}),i.jsxs(Ye,{value:"progress",className:"space-y-4",children:[p.length>0&&i.jsxs(b,{children:[i.jsx(N,{children:i.jsx(y,{children:"Weight Trend"})}),i.jsx(_,{children:i.jsx(z,{width:"100%",height:300,children:i.jsxs(O,{data:p,children:[i.jsx(q,{strokeDasharray:"3 3"}),i.jsx(T,{dataKey:"date",tickFormatter:e=>F(new Date(e),"MMM d")}),i.jsx(L,{}),i.jsx(W,{labelFormatter:e=>F(new Date(e),"MMM d, yyyy")}),i.jsx($,{type:"monotone",dataKey:"weight_kg",stroke:"hsl(var(--primary))",strokeWidth:2,dot:{fill:"hsl(var(--primary))"}})]})})})]}),i.jsxs(b,{children:[i.jsx(N,{children:i.jsxs(y,{className:"flex items-center gap-2",children:[i.jsx(U,{className:"w-5 h-5"}),"Add Progress Entry"]})}),i.jsxs(_,{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Weight (kg) *"}),i.jsx(Ke,{type:"number",step:"0.1",value:k.weight_kg,onChange:e=>C(__spreadProps(__spreadValues({},k),{weight_kg:e.target.value})),placeholder:"70.5"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Body Fat %"}),i.jsx(Ke,{type:"number",step:"0.1",value:k.body_fat_percentage,onChange:e=>C(__spreadProps(__spreadValues({},k),{body_fat_percentage:e.target.value})),placeholder:"20.5"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Waist (cm)"}),i.jsx(Ke,{type:"number",step:"0.1",value:k.waist_cm,onChange:e=>C(__spreadProps(__spreadValues({},k),{waist_cm:e.target.value})),placeholder:"80"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Hips (cm)"}),i.jsx(Ke,{type:"number",step:"0.1",value:k.hips_cm,onChange:e=>C(__spreadProps(__spreadValues({},k),{hips_cm:e.target.value})),placeholder:"95"})]})]}),i.jsx(u,{onClick:()=>__async(null,null,function*(){if(k.weight_kg){M(!0);try{const{error:s}=yield m.from("client_progress").insert(__spreadValues({client_id:e.id,nutritionist_id:r.id},k));if(s)throw s;h({title:"Progress added",description:"Client progress has been recorded"}),C({weight_kg:"",body_fat_percentage:"",waist_cm:"",hips_cm:""}),fetchClientData(),a&&a()}catch(s){console.error("Error adding progress:",s),h({variant:"destructive",title:"Error",description:"Failed to add progress"})}finally{M(!1)}}else h({variant:"destructive",title:"Error",description:"Weight is required"})}),disabled:S,className:"w-full",children:S?"Saving...":"Add Progress"})]})]}),p.length>0&&i.jsxs(b,{children:[i.jsx(N,{children:i.jsx(y,{children:"Progress History"})}),i.jsx(_,{children:i.jsx("div",{className:"space-y-2",children:p.slice().reverse().map(e=>i.jsx("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:i.jsxs("div",{children:[i.jsx("p",{className:"font-medium",children:F(new Date(e.date),"MMMM d, yyyy")}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:["Weight: ",e.weight_kg," kg",e.body_fat_percentage&&` • Body Fat: ${e.body_fat_percentage}%`]})]})},e.id))})})]})]}),i.jsx(Ye,{value:"notes",className:"space-y-4",children:i.jsxs(b,{children:[i.jsx(N,{children:i.jsxs(y,{className:"flex items-center gap-2",children:[i.jsx(B,{className:"w-5 h-5"}),"Private Notes"]})}),i.jsxs(_,{className:"space-y-4",children:[i.jsx(x,{value:v,onChange:e=>w(e.target.value),placeholder:"Add private notes about this client...",rows:10}),i.jsxs(u,{onClick:()=>__async(null,null,function*(){M(!0);try{const{error:s}=yield m.from("user_profiles").update({nutritionist_notes:v}).eq("id",e.id);if(s)throw s;h({title:"Notes saved",description:"Your notes have been saved successfully"}),a&&a()}catch(s){console.error("Error saving notes:",s),h({variant:"destructive",title:"Error",description:"Failed to save notes"})}finally{M(!1)}}),disabled:S,children:[i.jsx(K,{className:"w-4 h-4 mr-2"}),S?"Saving...":"Save Notes"]})]})]})})]})]})})},ClientManagement=()=>{const{user:e}=o(),[s,t]=n.useState([]),[a,l]=n.useState([]),[r,c]=n.useState(""),[d,x]=n.useState("all"),[h,p]=n.useState(null),[g,j]=n.useState(!1),[f,v]=n.useState(!0);n.useEffect(()=>{fetchClients()},[e]),n.useEffect(()=>{filterClients()},[r,d,s]);const fetchClients=()=>__async(null,null,function*(){v(!0);try{const{data:e,error:s}=yield m.from("user_profiles").select("*").eq("role","user").order("created_at",{ascending:!1});if(s)throw s;const a=yield Promise.all((e||[]).map(e=>__async(null,null,function*(){const{data:s}=yield m.from("client_progress").select("*").eq("client_id",e.id).order("date",{ascending:!1}).limit(2),t=null==s?void 0:s[0],a=null==s?void 0:s[1];return __spreadProps(__spreadValues({},e),{latestWeight:null==t?void 0:t.weight_kg,weightChange:t&&a?(t.weight_kg-a.weight_kg).toFixed(1):null,lastUpdate:null==t?void 0:t.date})})));t(a)}catch(e){console.error("Error fetching clients:",e)}finally{v(!1)}}),filterClients=()=>{let e=s;r&&(e=e.filter(e=>{var s,t;return(null==(s=e.full_name)?void 0:s.toLowerCase().includes(r.toLowerCase()))||(null==(t=e.email)?void 0:t.toLowerCase().includes(r.toLowerCase()))})),"active"===d?e=e.filter(e=>e.lastUpdate):"inactive"===d&&(e=e.filter(e=>!e.lastUpdate)),l(e)},handleClientClick=e=>{p(e),j(!0)},ClientCard=({client:e})=>{var s;const t=((e,s)=>{if(!e||!s)return"N/A";const t=s/100;return(e/(t*t)).toFixed(1)})(e.latestWeight,e.height_cm),a=e.weightChange&&parseFloat(e.weightChange)<0;return i.jsx(b,{className:"glass-effect hover:shadow-lg transition-all cursor-pointer h-full flex flex-col",onClick:()=>handleClientClick(e),children:i.jsxs(_,{className:"p-6 flex flex-col h-full",children:[i.jsxs("div",{className:"flex items-start justify-between mb-4",children:[i.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[i.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:i.jsx("span",{className:"text-lg font-bold text-primary",children:(null==(s=e.full_name)?void 0:s.split(" ").map(e=>e[0]).join(""))||"?"})}),i.jsxs("div",{className:"min-w-0 flex-1",children:[i.jsx("h3",{className:"font-semibold text-lg truncate",children:e.full_name||"Unknown"}),i.jsx("p",{className:"text-sm text-muted-foreground truncate",children:e.email})]})]}),i.jsx("div",{className:"px-2 py-1 rounded-full text-xs font-medium whitespace-nowrap flex-shrink-0 ml-2 "+(e.lastUpdate?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"),children:e.lastUpdate?"Active":"Inactive"})]}),i.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Current Weight"}),i.jsx("p",{className:"text-lg font-bold",children:e.latestWeight?`${e.latestWeight} kg`:"N/A"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"BMI"}),i.jsx("p",{className:"text-lg font-bold",children:t})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Progress"}),e.weightChange?i.jsxs("p",{className:"text-lg font-bold flex items-center gap-1 "+(a?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[a?i.jsx(G,{className:"w-4 h-4"}):i.jsx(M,{className:"w-4 h-4"}),Math.abs(e.weightChange)," kg"]}):i.jsx("p",{className:"text-lg font-bold text-muted-foreground",children:"-"})]})]}),i.jsxs("div",{className:"flex items-center justify-between text-sm",children:[i.jsx("div",{className:"flex items-center gap-4",children:i.jsxs("span",{className:"flex items-center gap-1 text-muted-foreground",children:[i.jsx(S,{className:"w-4 h-4"}),e.lastUpdate?F(new Date(e.lastUpdate),"MMM d, yyyy"):"No updates"]})}),i.jsx(u,{variant:"ghost",size:"sm",onClick:s=>{s.stopPropagation(),handleClientClick(e)},children:"View Profile"})]})]})})};return f?i.jsx("div",{className:"flex items-center justify-center h-96",children:i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):i.jsxs("div",{className:"space-y-6",children:[i.jsx("div",{className:"flex items-center justify-between",children:i.jsxs("div",{children:[i.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[i.jsx(k,{className:"w-8 h-8 text-primary"}),"Client Management"]}),i.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage and track your clients' progress"})]})}),i.jsx(b,{className:"glass-effect",children:i.jsx(_,{className:"p-4",children:i.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[i.jsxs("div",{className:"relative flex-1",children:[i.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),i.jsx(Ke,{placeholder:"Search clients by name or email...",value:r,onChange:e=>c(e.target.value),className:"pl-10"})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(u,{variant:"all"===d?"default":"outline",onClick:()=>x("all"),children:["All (",s.length,")"]}),i.jsx(u,{variant:"active"===d?"default":"outline",onClick:()=>x("active"),children:"Active"}),i.jsx(u,{variant:"inactive"===d?"default":"outline",onClick:()=>x("inactive"),children:"Inactive"})]})]})})}),a.length>0?i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 md:gap-6",children:a.map(e=>i.jsx(ClientCard,{client:e},e.id))}):i.jsx(b,{className:"glass-effect",children:i.jsxs(_,{className:"p-12 text-center",children:[i.jsx(k,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),i.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No clients found"}),i.jsx("p",{className:"text-muted-foreground",children:r?"Try adjusting your search":"Your clients will appear here"})]})}),h&&i.jsx(ClientProfileDialog,{client:h,open:g,onOpenChange:j,onUpdate:fetchClients})]})},RecipeDatabase=({onSelectRecipe:e})=>{const{user:s}=o(),[t,a]=n.useState([]),[l,r]=n.useState([]),[c,d]=n.useState(""),[g,j]=n.useState("all"),[f,v]=n.useState(!1),[N,y]=n.useState(null),[w,C]=n.useState(!0),[S,M]=n.useState(!1),[A,F]=n.useState({name:"",description:"",category:"breakfast",servings:1,prep_time_minutes:0,cook_time_minutes:0,ingredients:[{name:"",amount:"",unit:""}],instructions:[""],calories_per_serving:0,protein_g:0,carbs_g:0,fat_g:0,fiber_g:0,tags:[],is_public:!1}),D=["breakfast","lunch","dinner","snack","dessert"];n.useEffect(()=>{fetchRecipes()},[s]),n.useEffect(()=>{filterRecipes()},[c,g,t]);const fetchRecipes=()=>__async(null,null,function*(){C(!0);try{const{data:e,error:t}=yield m.from("recipes").select("*").or(`nutritionist_id.eq.${s.id},is_public.eq.true`).order("created_at",{ascending:!1});if(t)throw t;a(e||[])}catch(e){console.error("Error fetching recipes:",e),h({variant:"destructive",title:"Error",description:"Failed to fetch recipes"})}finally{C(!1)}}),filterRecipes=()=>{let e=t;c&&(e=e.filter(e=>{var s,t;return(null==(s=e.name)?void 0:s.toLowerCase().includes(c.toLowerCase()))||(null==(t=e.description)?void 0:t.toLowerCase().includes(c.toLowerCase()))})),"all"!==g&&(e=e.filter(e=>e.category===g)),r(e)},handleOpenDialog=(e=null)=>{e?(y(e),F(__spreadProps(__spreadValues({},e),{ingredients:e.ingredients||[{name:"",amount:"",unit:""}],instructions:e.instructions||[""],tags:e.tags||[]}))):(y(null),F({name:"",description:"",category:"breakfast",servings:1,prep_time_minutes:0,cook_time_minutes:0,ingredients:[{name:"",amount:"",unit:""}],instructions:[""],calories_per_serving:0,protein_g:0,carbs_g:0,fat_g:0,fiber_g:0,tags:[],is_public:!1})),v(!0)},updateIngredient=(e,s,t)=>{const a=[...A.ingredients];a[e][s]=t,F(__spreadProps(__spreadValues({},A),{ingredients:a}))},RecipeCard=({recipe:t})=>{var a;return i.jsx(b,{className:"glass-effect hover:shadow-lg transition-all cursor-pointer group",children:i.jsxs(_,{className:"p-6",children:[i.jsxs("div",{className:"flex items-start justify-between mb-4",children:[i.jsxs("div",{className:"flex-1",onClick:()=>e&&e(t),children:[i.jsx("h3",{className:"font-semibold text-lg mb-1",children:t.name}),i.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:t.description})]}),i.jsxs("div",{className:"flex gap-1 ml-2",children:[i.jsx(u,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),handleOpenDialog(t)},children:i.jsx(J,{className:"w-4 h-4"})}),t.nutritionist_id===s.id&&i.jsx(u,{variant:"ghost",size:"sm",onClick:e=>{var s;e.stopPropagation(),s=t.id,__async(null,null,function*(){if(confirm("Are you sure you want to delete this recipe?"))try{const{error:e}=yield m.from("recipes").delete().eq("id",s);if(e)throw e;h({title:"Recipe deleted successfully"}),fetchRecipes()}catch(e){console.error("Error deleting recipe:",e),h({variant:"destructive",title:"Error",description:"Failed to delete recipe"})}})},className:"text-destructive hover:text-destructive",children:i.jsx(Z,{className:"w-4 h-4"})})]})]}),i.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[i.jsx(p,{variant:"outline",className:"capitalize",children:t.category}),null==(a=t.tags)?void 0:a.slice(0,2).map(e=>i.jsx(p,{variant:"secondary",children:e},e))]}),i.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4 text-sm",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(E,{className:"w-4 h-4 text-muted-foreground"}),i.jsxs("span",{children:[(t.prep_time_minutes||0)+(t.cook_time_minutes||0)," min"]})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(k,{className:"w-4 h-4 text-muted-foreground"}),i.jsxs("span",{children:[t.servings," servings"]})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Q,{className:"w-4 h-4 text-muted-foreground"}),i.jsxs("span",{children:[t.calories_per_serving||0," cal"]})]})]}),i.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs",children:[i.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[i.jsxs("p",{className:"font-semibold",children:[t.protein_g||0,"g"]}),i.jsx("p",{className:"text-muted-foreground",children:"Protein"})]}),i.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[i.jsxs("p",{className:"font-semibold",children:[t.carbs_g||0,"g"]}),i.jsx("p",{className:"text-muted-foreground",children:"Carbs"})]}),i.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[i.jsxs("p",{className:"font-semibold",children:[t.fat_g||0,"g"]}),i.jsx("p",{className:"text-muted-foreground",children:"Fat"})]}),i.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[i.jsxs("p",{className:"font-semibold",children:[t.fiber_g||0,"g"]}),i.jsx("p",{className:"text-muted-foreground",children:"Fiber"})]})]})]})})};return w?i.jsx("div",{className:"flex items-center justify-center h-96",children:i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[i.jsx(H,{className:"w-8 h-8 text-primary"}),"Recipe Database"]}),i.jsx("p",{className:"text-muted-foreground mt-1",children:"Create and manage your recipe library"})]}),i.jsxs(u,{onClick:()=>handleOpenDialog(),children:[i.jsx(U,{className:"w-4 h-4 mr-2"}),"New Recipe"]})]}),i.jsx(b,{className:"glass-effect",children:i.jsx(_,{className:"p-4",children:i.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[i.jsxs("div",{className:"relative flex-1",children:[i.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),i.jsx(Ke,{placeholder:"Search recipes...",value:c,onChange:e=>d(e.target.value),className:"pl-10"})]}),i.jsxs("div",{className:"flex gap-2 flex-wrap",children:[i.jsx(u,{variant:"all"===g?"default":"outline",onClick:()=>j("all"),size:"sm",children:"All"}),D.map(e=>i.jsx(u,{variant:g===e?"default":"outline",onClick:()=>j(e),size:"sm",className:"capitalize",children:e},e))]})]})})}),l.length>0?i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(e=>i.jsx(RecipeCard,{recipe:e},e.id))}):i.jsx(b,{className:"glass-effect",children:i.jsxs(_,{className:"p-12 text-center",children:[i.jsx(H,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),i.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No recipes found"}),i.jsx("p",{className:"text-muted-foreground mb-4",children:c||"all"!==g?"Try adjusting your filters":"Create your first recipe to get started"}),i.jsxs(u,{onClick:()=>handleOpenDialog(),children:[i.jsx(U,{className:"w-4 h-4 mr-2"}),"Create Recipe"]})]})}),i.jsx(Je,{open:f,onOpenChange:v,children:i.jsxs(Ze,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[i.jsx(Qe,{children:i.jsx(Xe,{children:N?"Edit Recipe":"Create New Recipe"})}),i.jsxs("div",{className:"space-y-6 py-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"col-span-2",children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Recipe Name *"}),i.jsx(Ke,{value:A.name,onChange:e=>F(__spreadProps(__spreadValues({},A),{name:e.target.value})),placeholder:"e.g., Grilled Chicken Salad"})]}),i.jsxs("div",{className:"col-span-2",children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Description"}),i.jsx(x,{value:A.description,onChange:e=>F(__spreadProps(__spreadValues({},A),{description:e.target.value})),placeholder:"Brief description of the recipe",rows:3})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Category"}),i.jsx("select",{value:A.category,onChange:e=>F(__spreadProps(__spreadValues({},A),{category:e.target.value})),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:D.map(e=>i.jsx("option",{value:e,className:"capitalize",children:e},e))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Servings"}),i.jsx(Ke,{type:"number",min:"1",value:A.servings,onChange:e=>F(__spreadProps(__spreadValues({},A),{servings:parseInt(e.target.value)}))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Prep Time (min)"}),i.jsx(Ke,{type:"number",min:"0",value:A.prep_time_minutes,onChange:e=>F(__spreadProps(__spreadValues({},A),{prep_time_minutes:parseInt(e.target.value)}))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Cook Time (min)"}),i.jsx(Ke,{type:"number",min:"0",value:A.cook_time_minutes,onChange:e=>F(__spreadProps(__spreadValues({},A),{cook_time_minutes:parseInt(e.target.value)}))})]})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-3",children:"Nutrition (per serving)"}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Calories"}),i.jsx(Ke,{type:"number",step:"0.1",value:A.calories_per_serving,onChange:e=>F(__spreadProps(__spreadValues({},A),{calories_per_serving:parseFloat(e.target.value)}))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Protein (g)"}),i.jsx(Ke,{type:"number",step:"0.1",value:A.protein_g,onChange:e=>F(__spreadProps(__spreadValues({},A),{protein_g:parseFloat(e.target.value)}))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Carbs (g)"}),i.jsx(Ke,{type:"number",step:"0.1",value:A.carbs_g,onChange:e=>F(__spreadProps(__spreadValues({},A),{carbs_g:parseFloat(e.target.value)}))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Fat (g)"}),i.jsx(Ke,{type:"number",step:"0.1",value:A.fat_g,onChange:e=>F(__spreadProps(__spreadValues({},A),{fat_g:parseFloat(e.target.value)}))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Fiber (g)"}),i.jsx(Ke,{type:"number",step:"0.1",value:A.fiber_g,onChange:e=>F(__spreadProps(__spreadValues({},A),{fiber_g:parseFloat(e.target.value)}))})]})]})]}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsx("h3",{className:"font-semibold",children:"Ingredients"}),i.jsxs(u,{onClick:()=>{F(__spreadProps(__spreadValues({},A),{ingredients:[...A.ingredients,{name:"",amount:"",unit:""}]}))},size:"sm",variant:"outline",children:[i.jsx(U,{className:"w-4 h-4 mr-1"}),"Add"]})]}),i.jsx("div",{className:"space-y-2",children:A.ingredients.map((e,s)=>i.jsxs("div",{className:"flex gap-2",children:[i.jsx(Ke,{placeholder:"Ingredient name",value:e.name,onChange:e=>updateIngredient(s,"name",e.target.value),className:"flex-1"}),i.jsx(Ke,{placeholder:"Amount",value:e.amount,onChange:e=>updateIngredient(s,"amount",e.target.value),className:"w-24"}),i.jsx(Ke,{placeholder:"Unit",value:e.unit,onChange:e=>updateIngredient(s,"unit",e.target.value),className:"w-24"}),i.jsx(u,{variant:"ghost",size:"sm",onClick:()=>(e=>{F(__spreadProps(__spreadValues({},A),{ingredients:A.ingredients.filter((s,t)=>t!==e)}))})(s),disabled:1===A.ingredients.length,children:i.jsx(Y,{className:"w-4 h-4"})})]},s))})]}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsx("h3",{className:"font-semibold",children:"Instructions"}),i.jsxs(u,{onClick:()=>{F(__spreadProps(__spreadValues({},A),{instructions:[...A.instructions,""]}))},size:"sm",variant:"outline",children:[i.jsx(U,{className:"w-4 h-4 mr-1"}),"Add Step"]})]}),i.jsx("div",{className:"space-y-2",children:A.instructions.map((e,s)=>i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("span",{className:"text-sm font-medium text-muted-foreground pt-2",children:[s+1,"."]}),i.jsx(x,{placeholder:"Instruction step",value:e,onChange:e=>((e,s)=>{const t=[...A.instructions];t[e]=s,F(__spreadProps(__spreadValues({},A),{instructions:t}))})(s,e.target.value),rows:2,className:"flex-1"}),i.jsx(u,{variant:"ghost",size:"sm",onClick:()=>(e=>{F(__spreadProps(__spreadValues({},A),{instructions:A.instructions.filter((s,t)=>t!==e)}))})(s),disabled:1===A.instructions.length,children:i.jsx(Y,{className:"w-4 h-4"})})]},s))})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-3",children:"Tags"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:["vegetarian","vegan","gluten-free","dairy-free","high-protein","low-carb","keto","paleo"].map(e=>i.jsx(p,{variant:A.tags.includes(e)?"default":"outline",className:"cursor-pointer",onClick:()=>(e=>{const s=A.tags.includes(e)?A.tags.filter(s=>s!==e):[...A.tags,e];F(__spreadProps(__spreadValues({},A),{tags:s}))})(e),children:e},e))})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"checkbox",id:"is_public",checked:A.is_public,onChange:e=>F(__spreadProps(__spreadValues({},A),{is_public:e.target.checked})),className:"w-4 h-4"}),i.jsx("label",{htmlFor:"is_public",className:"text-sm font-medium",children:"Make this recipe public (visible to other nutritionists)"})]})]}),i.jsxs(es,{children:[i.jsx(u,{variant:"outline",onClick:()=>v(!1),children:"Cancel"}),i.jsxs(u,{onClick:()=>__async(null,null,function*(){if(A.name){M(!0);try{const e=__spreadProps(__spreadValues({},A),{nutritionist_id:s.id,ingredients:A.ingredients.filter(e=>e.name),instructions:A.instructions.filter(e=>e.trim())});if(N){const{error:s}=yield m.from("recipes").update(e).eq("id",N.id);if(s)throw s;h({title:"Recipe updated successfully"})}else{const{error:s}=yield m.from("recipes").insert(e);if(s)throw s;h({title:"Recipe created successfully"})}v(!1),fetchRecipes()}catch(e){console.error("Error saving recipe:",e),h({variant:"destructive",title:"Error",description:"Failed to save recipe"})}finally{M(!1)}}else h({variant:"destructive",title:"Error",description:"Recipe name is required"})}),disabled:S,children:[i.jsx(K,{className:"w-4 h-4 mr-2"}),S?"Saving...":"Save Recipe"]})]})]})})]})},MealPlanning=()=>{const{user:e}=o(),[s,t]=n.useState([]),[a,l]=n.useState([]),[r,c]=n.useState([]),[d,g]=n.useState(""),[j,f]=n.useState("all"),[v,N]=n.useState(!1),[y,w]=n.useState(null),[M,E]=n.useState(!0),[A,F]=n.useState(!1),[D,P]=n.useState(!1),[I,R]=n.useState(null),[z,O]=n.useState(null),[q,T]=n.useState({client_id:"",name:"",description:"",start_date:"",end_date:"",target_calories:2e3,target_protein_g:150,target_carbs_g:200,target_fat_g:60,meal_schedule:{},notes:"",status:"active"}),L=["breakfast","lunch","dinner","snack"];n.useEffect(()=>{fetchMealPlans(),fetchClients()},[e]),n.useEffect(()=>{filterPlans()},[d,j,s]);const fetchMealPlans=()=>__async(null,null,function*(){E(!0);try{const{data:s,error:a}=yield m.from("meal_plans_v2").select("\n          *,\n          client:user_profiles!meal_plans_v2_client_id_fkey(id, full_name, email)\n        ").eq("nutritionist_id",e.id).order("created_at",{ascending:!1});if(a)throw a;t(s||[])}catch(s){console.error("Error fetching meal plans:",s),h({variant:"destructive",title:"Error",description:"Failed to fetch meal plans"})}finally{E(!1)}}),fetchClients=()=>__async(null,null,function*(){try{const{data:e,error:s}=yield m.from("user_profiles").select("id, full_name, email").eq("role","user").order("full_name",{ascending:!0});if(s)throw s;l(e||[])}catch(e){console.error("Error fetching clients:",e)}}),filterPlans=()=>{let e=s;d&&(e=e.filter(e=>{var s,t,a;return(null==(s=e.name)?void 0:s.toLowerCase().includes(d.toLowerCase()))||(null==(a=null==(t=e.client)?void 0:t.full_name)?void 0:a.toLowerCase().includes(d.toLowerCase()))})),"all"!==j&&(e=e.filter(e=>e.status===j)),c(e)},handleOpenDialog=(e=null)=>{if(e)w(e),T({client_id:e.client_id,name:e.name,description:e.description||"",start_date:e.start_date,end_date:e.end_date,target_calories:e.target_calories||2e3,target_protein_g:e.target_protein_g||150,target_carbs_g:e.target_carbs_g||200,target_fat_g:e.target_fat_g||60,meal_schedule:e.meal_schedule||{},notes:e.notes||"",status:e.status});else{w(null);const e=(new Date).toISOString().split("T")[0],s=new Date(Date.now()+6048e5).toISOString().split("T")[0];T({client_id:"",name:"",description:"",start_date:e,end_date:s,target_calories:2e3,target_protein_g:150,target_carbs_g:200,target_fat_g:60,meal_schedule:{},notes:"",status:"active"})}N(!0)},MealPlanCard=({plan:e})=>{const s=e.client,t=Math.ceil((new Date(e.end_date)-new Date(e.start_date))/864e5);return i.jsx(b,{className:"glass-effect hover:shadow-lg transition-all",children:i.jsxs(_,{className:"p-6",children:[i.jsxs("div",{className:"flex items-start justify-between mb-4",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"font-semibold text-lg mb-1",children:e.name}),i.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[i.jsx(k,{className:"w-3 h-3"}),(null==s?void 0:s.full_name)||"Unknown Client"]})]}),i.jsx(p,{variant:"active"===e.status?"default":"secondary",children:e.status})]}),i.jsxs("div",{className:"space-y-2 mb-4",children:[i.jsxs("div",{className:"flex items-center justify-between text-sm",children:[i.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[i.jsx(S,{className:"w-4 h-4"}),"Duration:"]}),i.jsxs("span",{className:"font-medium",children:[t," days"]})]}),i.jsxs("div",{className:"flex items-center justify-between text-sm",children:[i.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[i.jsx(X,{className:"w-4 h-4"}),"Daily Calories:"]}),i.jsxs("span",{className:"font-medium",children:[e.target_calories||0," kcal"]})]})]}),i.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4 text-xs",children:[i.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[i.jsxs("p",{className:"font-semibold",children:[e.target_protein_g||0,"g"]}),i.jsx("p",{className:"text-muted-foreground",children:"Protein"})]}),i.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[i.jsxs("p",{className:"font-semibold",children:[e.target_carbs_g||0,"g"]}),i.jsx("p",{className:"text-muted-foreground",children:"Carbs"})]}),i.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[i.jsxs("p",{className:"font-semibold",children:[e.target_fat_g||0,"g"]}),i.jsx("p",{className:"text-muted-foreground",children:"Fat"})]})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(u,{variant:"outline",size:"sm",onClick:()=>handleOpenDialog(e),className:"flex-1",children:[i.jsx(J,{className:"w-4 h-4 mr-1"}),"Edit"]}),i.jsx(u,{variant:"outline",size:"sm",onClick:()=>{return s=e.id,__async(null,null,function*(){if(confirm("Are you sure you want to delete this meal plan?"))try{const{error:e}=yield m.from("meal_plans_v2").delete().eq("id",s);if(e)throw e;h({title:"Meal plan deleted successfully"}),fetchMealPlans()}catch(e){console.error("Error deleting meal plan:",e),h({variant:"destructive",title:"Error",description:"Failed to delete meal plan"})}});var s},className:"text-destructive",children:i.jsx(Z,{className:"w-4 h-4"})})]})]})})};return M?i.jsx("div",{className:"flex items-center justify-center h-96",children:i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[i.jsx(C,{className:"w-8 h-8 text-primary"}),"Meal Planning"]}),i.jsx("p",{className:"text-muted-foreground mt-1",children:"Create and manage personalized meal plans"})]}),i.jsxs(u,{onClick:()=>handleOpenDialog(),children:[i.jsx(U,{className:"w-4 h-4 mr-2"}),"New Meal Plan"]})]}),i.jsx(b,{className:"glass-effect",children:i.jsx(_,{className:"p-4",children:i.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[i.jsxs("div",{className:"relative flex-1",children:[i.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),i.jsx(Ke,{placeholder:"Search meal plans...",value:d,onChange:e=>g(e.target.value),className:"pl-10"})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(u,{variant:"all"===j?"default":"outline",onClick:()=>f("all"),size:"sm",children:["All (",s.length,")"]}),i.jsx(u,{variant:"active"===j?"default":"outline",onClick:()=>f("active"),size:"sm",children:"Active"}),i.jsx(u,{variant:"completed"===j?"default":"outline",onClick:()=>f("completed"),size:"sm",children:"Completed"}),i.jsx(u,{variant:"archived"===j?"default":"outline",onClick:()=>f("archived"),size:"sm",children:"Archived"})]})]})})}),r.length>0?i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(e=>i.jsx(MealPlanCard,{plan:e},e.id))}):i.jsx(b,{className:"glass-effect",children:i.jsxs(_,{className:"p-12 text-center",children:[i.jsx(C,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),i.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No meal plans found"}),i.jsx("p",{className:"text-muted-foreground mb-4",children:d||"all"!==j?"Try adjusting your filters":"Create your first meal plan to get started"}),i.jsxs(u,{onClick:()=>handleOpenDialog(),children:[i.jsx(U,{className:"w-4 h-4 mr-2"}),"Create Meal Plan"]})]})}),i.jsx(Je,{open:v,onOpenChange:N,children:i.jsxs(Ze,{className:"max-w-5xl max-h-[90vh] overflow-y-auto",children:[i.jsx(Qe,{children:i.jsx(Xe,{children:y?"Edit Meal Plan":"Create New Meal Plan"})}),i.jsxs(Ve,{defaultValue:"basic",className:"mt-4",children:[i.jsxs(Ge,{className:"grid w-full grid-cols-3",children:[i.jsx(He,{value:"basic",children:"Basic Info"}),i.jsx(He,{value:"schedule",children:"Meal Schedule"}),i.jsx(He,{value:"targets",children:"Nutrition Targets"})]}),i.jsx(Ye,{value:"basic",className:"space-y-4",children:i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"col-span-2",children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Client *"}),i.jsxs("select",{value:q.client_id,onChange:e=>T(__spreadProps(__spreadValues({},q),{client_id:e.target.value})),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[i.jsx("option",{value:"",children:"Select a client"}),a.map(e=>i.jsxs("option",{value:e.id,children:[e.full_name," (",e.email,")"]},e.id))]})]}),i.jsxs("div",{className:"col-span-2",children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Plan Name *"}),i.jsx(Ke,{value:q.name,onChange:e=>T(__spreadProps(__spreadValues({},q),{name:e.target.value})),placeholder:"e.g., Weight Loss Plan - Week 1"})]}),i.jsxs("div",{className:"col-span-2",children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Description"}),i.jsx(x,{value:q.description,onChange:e=>T(__spreadProps(__spreadValues({},q),{description:e.target.value})),placeholder:"Brief description of the meal plan goals and approach",rows:3})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Start Date *"}),i.jsx(Ke,{type:"date",value:q.start_date,onChange:e=>T(__spreadProps(__spreadValues({},q),{start_date:e.target.value}))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"End Date *"}),i.jsx(Ke,{type:"date",value:q.end_date,onChange:e=>T(__spreadProps(__spreadValues({},q),{end_date:e.target.value}))})]}),i.jsxs("div",{className:"col-span-2",children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Notes"}),i.jsx(x,{value:q.notes,onChange:e=>T(__spreadProps(__spreadValues({},q),{notes:e.target.value})),placeholder:"Additional notes, instructions, or guidelines",rows:3})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Status"}),i.jsxs("select",{value:q.status,onChange:e=>T(__spreadProps(__spreadValues({},q),{status:e.target.value})),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[i.jsx("option",{value:"active",children:"Active"}),i.jsx("option",{value:"completed",children:"Completed"}),i.jsx("option",{value:"archived",children:"Archived"})]})]})]})}),i.jsxs(Ye,{value:"schedule",className:"space-y-4",children:[i.jsx("div",{className:"text-sm text-muted-foreground mb-4",children:"Click on a meal slot to assign a recipe from your database"}),i.jsx("div",{className:"space-y-4",children:["monday","tuesday","wednesday","thursday","friday","saturday","sunday"].map(e=>i.jsxs("div",{className:"border border-border rounded-lg p-4",children:[i.jsx("h4",{className:"font-semibold capitalize mb-3",children:e}),i.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:L.map(s=>{var t,a;return i.jsxs(u,{variant:"outline",size:"sm",onClick:()=>((e,s)=>{R(e),O(s),P(!0)})(e,s),className:"h-auto py-3 flex flex-col items-start",children:[i.jsx("span",{className:"text-xs text-muted-foreground capitalize",children:s}),i.jsx("span",{className:"text-xs mt-1",children:(null==(a=null==(t=q.meal_schedule)?void 0:t[e])?void 0:a[s])?"✓ Assigned":"+ Add Recipe"})]},s)})})]},e))})]}),i.jsxs(Ye,{value:"targets",className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Daily Calories Target"}),i.jsx(Ke,{type:"number",value:q.target_calories,onChange:e=>T(__spreadProps(__spreadValues({},q),{target_calories:parseInt(e.target.value)}))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Protein Target (g)"}),i.jsx(Ke,{type:"number",value:q.target_protein_g,onChange:e=>T(__spreadProps(__spreadValues({},q),{target_protein_g:parseInt(e.target.value)}))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Carbs Target (g)"}),i.jsx(Ke,{type:"number",value:q.target_carbs_g,onChange:e=>T(__spreadProps(__spreadValues({},q),{target_carbs_g:parseInt(e.target.value)}))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Fat Target (g)"}),i.jsx(Ke,{type:"number",value:q.target_fat_g,onChange:e=>T(__spreadProps(__spreadValues({},q),{target_fat_g:parseInt(e.target.value)}))})]})]}),i.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg",children:[i.jsx("h4",{className:"font-semibold mb-2",children:"Macro Distribution"}),i.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-muted-foreground",children:"Protein"}),i.jsxs("p",{className:"font-semibold",children:[(4*q.target_protein_g/q.target_calories*100).toFixed(0),"%"]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-muted-foreground",children:"Carbs"}),i.jsxs("p",{className:"font-semibold",children:[(4*q.target_carbs_g/q.target_calories*100).toFixed(0),"%"]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-muted-foreground",children:"Fat"}),i.jsxs("p",{className:"font-semibold",children:[(9*q.target_fat_g/q.target_calories*100).toFixed(0),"%"]})]})]})]})]})]}),i.jsxs(es,{className:"mt-6",children:[i.jsx(u,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),i.jsxs(u,{onClick:()=>__async(null,null,function*(){if(q.client_id&&q.name&&q.start_date&&q.end_date){F(!0);try{const s=__spreadProps(__spreadValues({},q),{nutritionist_id:e.id});if(y){const{error:e}=yield m.from("meal_plans_v2").update(s).eq("id",y.id);if(e)throw e;h({title:"Meal plan updated successfully"})}else{const{error:e}=yield m.from("meal_plans_v2").insert(s);if(e)throw e;h({title:"Meal plan created successfully"})}N(!1),fetchMealPlans()}catch(s){console.error("Error saving meal plan:",s),h({variant:"destructive",title:"Error",description:"Failed to save meal plan"})}finally{F(!1)}}else h({variant:"destructive",title:"Error",description:"Please fill in all required fields"})}),disabled:A,children:[i.jsx(K,{className:"w-4 h-4 mr-2"}),A?"Saving...":"Save Meal Plan"]})]})]})}),i.jsx(Je,{open:D,onOpenChange:P,children:i.jsxs(Ze,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[i.jsx(Qe,{children:i.jsxs(Xe,{children:["Select Recipe for ",I&&z&&i.jsxs("span",{className:"capitalize",children:[I," - ",z]})]})}),i.jsx(RecipeDatabase,{onSelectRecipe:e=>{if(I&&z){const s=__spreadValues({},q.meal_schedule);s[I]||(s[I]={}),s[I][z]=e.id,T(__spreadProps(__spreadValues({},q),{meal_schedule:s})),P(!1),R(null),O(null),h({title:"Recipe added to meal plan"})}}})]})})]})},AppointmentSchedule=()=>{const{user:e}=o(),[s,t]=n.useState([]),[a,l]=n.useState([]),[r,c]=n.useState(new Date),[d,g]=n.useState(new Date),[j,f]=n.useState(!1),[v,w]=n.useState(null),[k,C]=n.useState(!0),[M,A]=n.useState(!1),[D,P]=n.useState("month"),[I,z]=n.useState({client_id:"",title:"",description:"",appointment_date:"",appointment_time:"",duration_minutes:60,consultation_type:"follow_up",meeting_link:"",status:"scheduled",notes:""}),O=[{value:"scheduled",label:"Scheduled",color:"bg-blue-500"},{value:"completed",label:"Completed",color:"bg-green-500"},{value:"cancelled",label:"Cancelled",color:"bg-red-500"},{value:"no_show",label:"No Show",color:"bg-gray-500"}];n.useEffect(()=>{fetchAppointments(),fetchClients()},[e,r]);const fetchAppointments=()=>__async(null,null,function*(){C(!0);try{const s=ee(r),a=se(r),{data:l,error:i}=yield m.from("appointments").select("\n          *,\n          client:user_profiles!appointments_client_id_fkey(id, full_name, email)\n        ").eq("nutritionist_id",e.id).gte("appointment_date",s.toISOString()).lte("appointment_date",a.toISOString()).order("appointment_date",{ascending:!0});if(i)throw i;t(l||[])}catch(s){console.error("Error fetching appointments:",s),h({variant:"destructive",title:"Error",description:"Failed to fetch appointments"})}finally{C(!1)}}),fetchClients=()=>__async(null,null,function*(){try{const{data:e,error:s}=yield m.from("user_profiles").select("id, full_name, email").eq("role","user").order("full_name",{ascending:!0});if(s)throw s;l(e||[])}catch(e){console.error("Error fetching clients:",e)}}),handleOpenDialog=(e=null,s=null)=>{if(e){const s=new Date(e.appointment_date);w(e),z({client_id:e.client_id,title:e.title,description:e.description||"",appointment_date:F(s,"yyyy-MM-dd"),appointment_time:F(s,"HH:mm"),duration_minutes:e.duration_minutes||60,consultation_type:e.consultation_type||"follow_up",meeting_link:e.meeting_link||"",status:e.status||"scheduled",notes:e.notes||""})}else{const e=s||d;w(null),z({client_id:"",title:"",description:"",appointment_date:F(e,"yyyy-MM-dd"),appointment_time:"10:00",duration_minutes:60,consultation_type:"follow_up",meeting_link:"",status:"scheduled",notes:""})}f(!0)},getAppointmentsForDate=e=>s.filter(s=>re(oe(s.appointment_date),e)),AppointmentCard=({appointment:e,compact:s=!1})=>{var t;const a=O.find(s=>s.value===e.status),l=new Date(e.appointment_date);return s?i.jsxs("div",{onClick:()=>handleOpenDialog(e),className:"text-xs p-1 mb-1 rounded cursor-pointer hover:opacity-80 transition-opacity truncate",style:{backgroundColor:(null==a?void 0:a.color.replace("bg-",""))+"30"},children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(E,{className:"w-3 h-3"}),i.jsx("span",{className:"font-medium",children:F(l,"h:mm a")})]}),i.jsx("div",{className:"truncate",children:e.title})]}):i.jsx(b,{className:"glass-effect hover:shadow-lg transition-all",children:i.jsxs(_,{className:"p-4",children:[i.jsxs("div",{className:"flex items-start justify-between mb-3",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsx(E,{className:"w-4 h-4 text-muted-foreground"}),i.jsxs("span",{className:"text-sm font-semibold",children:[F(l,"MMM d, yyyy")," at ",F(l,"h:mm a")]})]}),i.jsx("h3",{className:"font-semibold text-lg",children:e.title}),i.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[i.jsx(R,{className:"w-3 h-3"}),(null==(t=e.client)?void 0:t.full_name)||"Unknown Client"]})]}),i.jsx(p,{variant:"completed"===e.status?"default":"secondary",children:null==a?void 0:a.label})]}),e.description&&i.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:e.description}),i.jsxs("div",{className:"flex items-center justify-between text-sm",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("span",{className:"text-muted-foreground",children:["Duration: ",e.duration_minutes," min"]}),e.meeting_link&&i.jsxs("span",{className:"flex items-center gap-1 text-primary",children:[i.jsx(me,{className:"w-4 h-4"}),"Video call"]})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(u,{variant:"outline",size:"sm",onClick:()=>handleOpenDialog(e),children:i.jsx(J,{className:"w-4 h-4"})}),i.jsx(u,{variant:"outline",size:"sm",onClick:()=>{return s=e.id,__async(null,null,function*(){if(confirm("Are you sure you want to delete this appointment?"))try{const{error:e}=yield m.from("appointments").delete().eq("id",s);if(e)throw e;h({title:"Appointment deleted successfully"}),fetchAppointments()}catch(e){console.error("Error deleting appointment:",e),h({variant:"destructive",title:"Error",description:"Failed to delete appointment"})}});var s},className:"text-destructive",children:i.jsx(Z,{className:"w-4 h-4"})})]})]})]})})};return k?i.jsx("div",{className:"flex items-center justify-center h-96",children:i.jsx(te,{className:"w-12 h-12 animate-spin text-primary"})}):i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[i.jsx(S,{className:"w-8 h-8 text-primary"}),"Schedule"]}),i.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your appointments and consultations"})]}),i.jsxs(u,{onClick:()=>handleOpenDialog(),children:[i.jsx(U,{className:"w-4 h-4 mr-2"}),"New Appointment"]})]}),i.jsxs(b,{className:"glass-effect",children:[i.jsx(N,{children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(u,{variant:"outline",size:"sm",onClick:()=>c(ne(r,1)),children:i.jsx(ae,{className:"w-4 h-4"})}),i.jsx("h3",{className:"text-xl font-semibold min-w-[200px] text-center",children:F(r,"MMMM yyyy")}),i.jsx(u,{variant:"outline",size:"sm",onClick:()=>c(ce(r,1)),children:i.jsx(le,{className:"w-4 h-4"})})]}),i.jsx(u,{variant:"outline",size:"sm",onClick:()=>c(new Date),children:"Today"})]})}),i.jsx(_,{children:i.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>i.jsx("div",{className:"text-center font-semibold text-sm py-2",children:e},e)),(()=>{const e=ee(r),s=se(r);return de({start:e,end:s})})().map(e=>{const s=getAppointmentsForDate(e),t=re(e,d),a=ie(e);return i.jsxs("div",{onClick:()=>g(e),className:`min-h-[100px] p-2 border rounded-lg cursor-pointer transition-colors ${t?"border-primary bg-primary/10":"border-border hover:bg-muted/50"} ${a?"bg-primary/5":""}`,children:[i.jsx("div",{className:"text-sm font-semibold mb-1 "+(a?"text-primary":""),children:F(e,"d")}),i.jsxs("div",{className:"space-y-1",children:[s.slice(0,2).map(e=>i.jsx(AppointmentCard,{appointment:e,compact:!0},e.id)),s.length>2&&i.jsxs("div",{className:"text-xs text-muted-foreground",children:["+",s.length-2," more"]})]})]},e.toISOString())})]})})]}),i.jsxs(b,{className:"glass-effect",children:[i.jsx(N,{children:i.jsxs(y,{children:["Appointments for ",F(d,"EEEE, MMMM d, yyyy")]})}),i.jsx(_,{children:getAppointmentsForDate(d).length>0?i.jsx("div",{className:"space-y-4",children:getAppointmentsForDate(d).map(e=>i.jsx(AppointmentCard,{appointment:e},e.id))}):i.jsxs("div",{className:"text-center py-12",children:[i.jsx(S,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),i.jsx("p",{className:"text-muted-foreground",children:"No appointments scheduled for this date"}),i.jsxs(u,{variant:"outline",onClick:()=>handleOpenDialog(null,d),className:"mt-4",children:[i.jsx(U,{className:"w-4 h-4 mr-2"}),"Schedule Appointment"]})]})})]}),i.jsx(Je,{open:j,onOpenChange:f,children:i.jsxs(Ze,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[i.jsx(Qe,{children:i.jsx(Xe,{children:v?"Edit Appointment":"New Appointment"})}),i.jsx("div",{className:"space-y-4 py-4",children:i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"col-span-2",children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Client *"}),i.jsxs("select",{value:I.client_id,onChange:e=>z(__spreadProps(__spreadValues({},I),{client_id:e.target.value})),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[i.jsx("option",{value:"",children:"Select a client"}),a.map(e=>i.jsxs("option",{value:e.id,children:[e.full_name," (",e.email,")"]},e.id))]})]}),i.jsxs("div",{className:"col-span-2",children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Title *"}),i.jsx(Ke,{value:I.title,onChange:e=>z(__spreadProps(__spreadValues({},I),{title:e.target.value})),placeholder:"e.g., Initial Consultation"})]}),i.jsxs("div",{className:"col-span-2",children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Description"}),i.jsx(x,{value:I.description,onChange:e=>z(__spreadProps(__spreadValues({},I),{description:e.target.value})),placeholder:"Brief description of the appointment",rows:3})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Date *"}),i.jsx(Ke,{type:"date",value:I.appointment_date,onChange:e=>z(__spreadProps(__spreadValues({},I),{appointment_date:e.target.value}))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Time *"}),i.jsx(Ke,{type:"time",value:I.appointment_time,onChange:e=>z(__spreadProps(__spreadValues({},I),{appointment_time:e.target.value}))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Duration (minutes)"}),i.jsx(Ke,{type:"number",min:"15",step:"15",value:I.duration_minutes,onChange:e=>z(__spreadProps(__spreadValues({},I),{duration_minutes:e.target.value}))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Type"}),i.jsx("select",{value:I.consultation_type,onChange:e=>z(__spreadProps(__spreadValues({},I),{consultation_type:e.target.value})),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[{value:"initial",label:"Initial Consultation"},{value:"follow_up",label:"Follow-up"},{value:"check_in",label:"Check-in"}].map(e=>i.jsx("option",{value:e.value,children:e.label},e.value))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Status"}),i.jsx("select",{value:I.status,onChange:e=>z(__spreadProps(__spreadValues({},I),{status:e.target.value})),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:O.map(e=>i.jsx("option",{value:e.value,children:e.label},e.value))})]}),i.jsxs("div",{className:"col-span-2",children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Meeting Link (optional)"}),i.jsx(Ke,{value:I.meeting_link,onChange:e=>z(__spreadProps(__spreadValues({},I),{meeting_link:e.target.value})),placeholder:"https://zoom.us/j/..."})]}),i.jsxs("div",{className:"col-span-2",children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Notes"}),i.jsx(x,{value:I.notes,onChange:e=>z(__spreadProps(__spreadValues({},I),{notes:e.target.value})),placeholder:"Additional notes about this appointment",rows:3})]})]})}),i.jsxs(es,{children:[i.jsx(u,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),i.jsx(u,{onClick:()=>__async(null,null,function*(){if(I.client_id&&I.title&&I.appointment_date&&I.appointment_time){A(!0);try{const s=new Date(`${I.appointment_date}T${I.appointment_time}`),t={nutritionist_id:e.id,client_id:I.client_id,title:I.title,description:I.description,appointment_date:s.toISOString(),duration_minutes:parseInt(I.duration_minutes),consultation_type:I.consultation_type,meeting_link:I.meeting_link,status:I.status,notes:I.notes};if(v){const{error:e}=yield m.from("appointments").update(t).eq("id",v.id);if(e)throw e;h({title:"Appointment updated successfully"})}else{const{error:e}=yield m.from("appointments").insert(t);if(e)throw e;h({title:"Appointment created successfully"})}f(!1),fetchAppointments()}catch(s){console.error("Error saving appointment:",s),h({variant:"destructive",title:"Error",description:"Failed to save appointment"})}finally{A(!1)}}else h({variant:"destructive",title:"Error",description:"Please fill in all required fields"})}),disabled:M,children:M?i.jsxs(i.Fragment,{children:[i.jsx(te,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):i.jsxs(i.Fragment,{children:[i.jsx(K,{className:"w-4 h-4 mr-2"}),"Save Appointment"]})})]})]})})]})},MessagingCenter=()=>{var e,s,t;const{user:a}=o(),[l,r]=n.useState([]),[c,d]=n.useState([]),[g,j]=n.useState(null),[f,v]=n.useState([]),[y,w]=n.useState(""),[k,C]=n.useState(""),[S,M]=n.useState(!0),[E,A]=n.useState(!1),[D,P]=n.useState(!1),[I,z]=n.useState(""),[O,q]=n.useState("");n.useEffect(()=>{fetchClients(),fetchConversations()},[a]),n.useEffect(()=>{g&&(fetchMessages(g),markAsRead(g))},[g]);const fetchClients=()=>__async(null,null,function*(){try{const{data:e,error:s}=yield m.from("user_profiles").select("id, full_name, email, profile_picture_url").eq("role","user").order("full_name",{ascending:!0});if(s)throw s;r(e||[])}catch(e){console.error("Error fetching clients:",e)}}),fetchConversations=()=>__async(null,null,function*(){M(!0);try{const{data:e,error:s}=yield m.from("messages").select("\n          *,\n          sender:user_profiles!messages_sender_id_fkey(id, full_name, email, profile_picture_url),\n          recipient:user_profiles!messages_recipient_id_fkey(id, full_name, email, profile_picture_url)\n        ").or(`sender_id.eq.${a.id},recipient_id.eq.${a.id}`).order("created_at",{ascending:!1});if(s)throw s;const t=new Map;(e||[]).forEach(e=>{const s=e.sender_id===a.id?e.recipient_id:e.sender_id,l=e.sender_id===a.id?e.recipient:e.sender;t.has(s)||t.set(s,{partnerId:s,partner:l,lastMessage:e,unreadCount:0}),e.recipient_id!==a.id||e.is_read||t.get(s).unreadCount++}),d(Array.from(t.values()))}catch(e){console.error("Error fetching conversations:",e),h({variant:"destructive",title:"Error",description:"Failed to fetch conversations"})}finally{M(!1)}}),fetchMessages=e=>__async(null,null,function*(){try{const s=e.partnerId,{data:t,error:l}=yield m.from("messages").select("\n          *,\n          sender:user_profiles!messages_sender_id_fkey(id, full_name, profile_picture_url)\n        ").or(`and(sender_id.eq.${a.id},recipient_id.eq.${s}),and(sender_id.eq.${s},recipient_id.eq.${a.id})`).order("created_at",{ascending:!0});if(l)throw l;v(t||[])}catch(s){console.error("Error fetching messages:",s)}}),markAsRead=e=>__async(null,null,function*(){try{const{error:s}=yield m.from("messages").update({is_read:!0}).eq("sender_id",e.partnerId).eq("recipient_id",a.id).eq("is_read",!1);if(s)throw s;fetchConversations()}catch(s){console.error("Error marking as read:",s)}}),handleSendMessage=()=>__async(null,null,function*(){if(y.trim()&&g){A(!0);try{const{error:e}=yield m.from("messages").insert({sender_id:a.id,recipient_id:g.partnerId,message_text:y.trim(),is_read:!1});if(e)throw e;w(""),yield fetchMessages(g),yield fetchConversations()}catch(e){console.error("Error sending message:",e),h({variant:"destructive",title:"Error",description:"Failed to send message"})}finally{A(!1)}}}),T=c.filter(e=>{var s,t,a,l;return(null==(t=null==(s=e.partner)?void 0:s.full_name)?void 0:t.toLowerCase().includes(k.toLowerCase()))||(null==(l=null==(a=e.partner)?void 0:a.email)?void 0:l.toLowerCase().includes(k.toLowerCase()))}),ConversationItem=({conversation:e})=>{var s,t;return i.jsx("div",{onClick:()=>j(e),className:"p-4 border-b border-border cursor-pointer hover:bg-muted/50 transition-colors "+((null==g?void 0:g.partnerId)===e.partnerId?"bg-muted":""),children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:(null==(s=e.partner)?void 0:s.profile_picture_url)?i.jsx("img",{src:e.partner.profile_picture_url,alt:e.partner.full_name,className:"w-12 h-12 rounded-full object-cover"}):i.jsx(R,{className:"w-6 h-6 text-primary"})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex items-center justify-between mb-1",children:[i.jsx("h4",{className:"font-semibold text-sm truncate",children:(null==(t=e.partner)?void 0:t.full_name)||"Unknown"}),i.jsx("span",{className:"text-xs text-muted-foreground flex-shrink-0 ml-2",children:F(new Date(e.lastMessage.created_at),"MMM d")})]}),i.jsx("p",{className:"text-sm truncate "+(e.unreadCount>0?"font-semibold":"text-muted-foreground"),children:e.lastMessage.message_text}),e.unreadCount>0&&i.jsxs(p,{variant:"default",className:"mt-1",children:[e.unreadCount," new"]})]})]})})},MessageBubble=({message:e})=>{var s,t;const l=e.sender_id===a.id;return i.jsx("div",{className:`flex ${l?"justify-end":"justify-start"} mb-4`,children:i.jsxs("div",{className:"max-w-[70%] "+(l?"order-2":"order-1"),children:[!l&&i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsx("div",{className:"w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center",children:(null==(s=e.sender)?void 0:s.profile_picture_url)?i.jsx("img",{src:e.sender.profile_picture_url,alt:e.sender.full_name,className:"w-6 h-6 rounded-full object-cover"}):i.jsx(R,{className:"w-3 h-3 text-primary"})}),i.jsx("span",{className:"text-xs text-muted-foreground",children:null==(t=e.sender)?void 0:t.full_name})]}),i.jsxs("div",{className:"rounded-lg p-3 "+(l?"bg-primary text-primary-foreground":"bg-muted"),children:[i.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:e.message_text}),i.jsxs("div",{className:"flex items-center justify-end gap-1 mt-1 "+(l?"text-primary-foreground/70":"text-muted-foreground"),children:[i.jsx("span",{className:"text-xs",children:F(new Date(e.created_at),"h:mm a")}),l&&(e.is_read?i.jsx(ge,{className:"w-3 h-3"}):i.jsx(je,{className:"w-3 h-3"}))]})]})]})})};return S?i.jsx("div",{className:"flex items-center justify-center h-96",children:i.jsx(te,{className:"w-12 h-12 animate-spin text-primary"})}):i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[i.jsx(ue,{className:"w-8 h-8 text-primary"}),"Messages"]}),i.jsx("p",{className:"text-muted-foreground mt-1",children:"Communicate with your clients"})]}),i.jsxs(u,{onClick:()=>P(!0),children:[i.jsx(U,{className:"w-4 h-4 mr-2"}),"New Message"]})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[i.jsxs(b,{className:"glass-effect lg:col-span-1",children:[i.jsx(N,{className:"pb-3",children:i.jsxs("div",{className:"relative",children:[i.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),i.jsx(Ke,{placeholder:"Search conversations...",value:k,onChange:e=>C(e.target.value),className:"pl-10"})]})}),i.jsx(_,{className:"p-0",children:i.jsx("div",{className:"max-h-[600px] overflow-y-auto",children:T.length>0?T.map(e=>i.jsx(ConversationItem,{conversation:e},e.partnerId)):i.jsxs("div",{className:"text-center py-12 px-4",children:[i.jsx(ue,{className:"w-12 h-12 mx-auto text-muted-foreground mb-3 opacity-50"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:k?"No conversations found":"No messages yet"}),i.jsxs(u,{variant:"outline",size:"sm",onClick:()=>P(!0),className:"mt-3",children:[i.jsx(U,{className:"w-4 h-4 mr-1"}),"Start a conversation"]})]})})})]}),i.jsx(b,{className:"glass-effect lg:col-span-2",children:g?i.jsxs(i.Fragment,{children:[i.jsx(N,{className:"border-b border-border",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(u,{variant:"ghost",size:"sm",onClick:()=>j(null),className:"lg:hidden",children:i.jsx(xe,{className:"w-4 h-4"})}),i.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:(null==(e=g.partner)?void 0:e.profile_picture_url)?i.jsx("img",{src:g.partner.profile_picture_url,alt:g.partner.full_name,className:"w-10 h-10 rounded-full object-cover"}):i.jsx(R,{className:"w-5 h-5 text-primary"})}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold",children:null==(s=g.partner)?void 0:s.full_name}),i.jsx("p",{className:"text-xs text-muted-foreground",children:null==(t=g.partner)?void 0:t.email})]})]})}),i.jsxs(_,{className:"p-0",children:[i.jsx("div",{className:"h-[450px] overflow-y-auto p-4",children:f.map(e=>i.jsx(MessageBubble,{message:e},e.id))}),i.jsxs("div",{className:"border-t border-border p-4",children:[i.jsxs("div",{className:"flex gap-2",children:[i.jsx(x,{placeholder:"Type your message...",value:y,onChange:e=>w(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),handleSendMessage())},className:"min-h-[60px] resize-none"}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx(u,{variant:"outline",size:"icon",disabled:!0,title:"File attachment (coming soon)",children:i.jsx(he,{className:"w-4 h-4"})}),i.jsx(u,{onClick:handleSendMessage,disabled:!y.trim()||E,size:"icon",children:E?i.jsx(te,{className:"w-4 h-4 animate-spin"}):i.jsx(pe,{className:"w-4 h-4"})})]})]}),i.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Press Enter to send, Shift+Enter for new line"})]})]})]}):i.jsx(_,{className:"flex items-center justify-center h-[600px]",children:i.jsxs("div",{className:"text-center",children:[i.jsx(ue,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),i.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No conversation selected"}),i.jsx("p",{className:"text-muted-foreground mb-4",children:"Choose a conversation from the list or start a new one"}),i.jsxs(u,{onClick:()=>P(!0),children:[i.jsx(U,{className:"w-4 h-4 mr-2"}),"New Message"]})]})})})]}),i.jsx(Je,{open:D,onOpenChange:P,children:i.jsxs(Ze,{className:"max-w-2xl",children:[i.jsx(Qe,{children:i.jsx(Xe,{children:"New Message"})}),i.jsxs("div",{className:"space-y-4 py-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"To:"}),i.jsxs("select",{value:I,onChange:e=>z(e.target.value),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[i.jsx("option",{value:"",children:"Select a client"}),l.map(e=>i.jsxs("option",{value:e.id,children:[e.full_name," (",e.email,")"]},e.id))]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Message:"}),i.jsx(x,{value:O,onChange:e=>q(e.target.value),placeholder:"Type your message here...",rows:6})]})]}),i.jsxs(es,{children:[i.jsx(u,{variant:"outline",onClick:()=>P(!1),children:"Cancel"}),i.jsx(u,{onClick:()=>__async(null,null,function*(){if(I&&O.trim()){A(!0);try{const{error:e}=yield m.from("messages").insert({sender_id:a.id,recipient_id:I,message_text:O.trim(),is_read:!1});if(e)throw e;h({title:"Message sent",description:"Your message has been sent successfully"}),P(!1),z(""),q(""),yield fetchConversations()}catch(e){console.error("Error sending message:",e),h({variant:"destructive",title:"Error",description:"Failed to send message"})}finally{A(!1)}}else h({variant:"destructive",title:"Error",description:"Please select a client and enter a message"})}),disabled:E,children:E?i.jsxs(i.Fragment,{children:[i.jsx(te,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):i.jsxs(i.Fragment,{children:[i.jsx(pe,{className:"w-4 h-4 mr-2"}),"Send Message"]})})]})]})})]})},AnalyticsDashboard=()=>{const{toast:e}=g(),[s,t]=n.useState(!0),[a,l]=n.useState(!1),[r,c]=n.useState("30"),[d,o]=n.useState({totalClients:0,activeClients:0,totalAppointments:0,completedAppointments:0,averageSuccessRate:0,totalRevenue:0}),[x,h]=n.useState([]),[p,j]=n.useState([]),[f,v]=n.useState([]),[b,N]=n.useState([]),[y,_]=n.useState([]),[w,C]=n.useState([]);n.useEffect(()=>{fetchAnalytics()},[r]);const fetchAnalytics=()=>__async(null,null,function*(){t(!0);try{yield Promise.all([fetchMetrics(),fetchClientProgress(),fetchAppointmentTrends(),fetchGoalDistribution(),fetchComplianceData(),fetchTopPerformers(),fetchRevenueData()])}catch(s){console.error("Error fetching analytics:",s),e({title:"Error",description:"Failed to load analytics data",variant:"destructive"})}finally{t(!1)}}),fetchMetrics=()=>__async(null,null,function*(){const e=new Date;e.setDate(e.getDate()-parseInt(r));const{data:s}=yield m.from("user_profiles").select("id, role, created_at").eq("role","user"),t=(null==s?void 0:s.length)||0,a=(null==s?void 0:s.filter(s=>new Date(s.created_at)>=e).length)||0,{data:l}=yield m.from("appointments").select("*").gte("appointment_date",e.toISOString()),i=(null==l?void 0:l.length)||0,n=(null==l?void 0:l.filter(e=>"completed"===e.status).length)||0,{data:c}=yield m.from("client_progress").select("*").gte("date",e.toISOString()),d=(null==c?void 0:c.length)>0?c.filter(e=>e.weight_kg&&e.weight_kg>0).length/c.length*100:0;o({totalClients:t,activeClients:a,totalAppointments:i,completedAppointments:n,averageSuccessRate:Math.round(d),totalRevenue:75*i})}),fetchClientProgress=()=>__async(null,null,function*(){const e=fe(new Date,parseInt(r)),{data:s}=yield m.from("client_progress").select("\n        *,\n        user_profiles!client_progress_user_id_fkey(full_name)\n      ").gte("date",e.toISOString()).order("date",{ascending:!0});if(s){const e=s.reduce((e,s)=>{const t=F(new Date(s.date),"MMM dd");return e[t]||(e[t]={date:t,totalWeight:0,count:0}),s.weight_kg&&(e[t].totalWeight+=s.weight_kg,e[t].count+=1),e},{}),t=Object.values(e).map(e=>({date:e.date,avgWeight:e.count>0?(e.totalWeight/e.count).toFixed(1):0}));h(t)}}),fetchAppointmentTrends=()=>__async(null,null,function*(){const e=fe(new Date,parseInt(r)),{data:s}=yield m.from("appointments").select("*").gte("appointment_date",e.toISOString()).order("appointment_date",{ascending:!0});if(s){const e=s.reduce((e,s)=>{const t=F(new Date(s.appointment_date),"MMM dd");return e[t]||(e[t]={date:t,scheduled:0,completed:0,cancelled:0}),"scheduled"===s.status&&(e[t].scheduled+=1),"completed"===s.status&&(e[t].completed+=1),"cancelled"===s.status&&(e[t].cancelled+=1),e},{});j(Object.values(e))}}),fetchGoalDistribution=()=>__async(null,null,function*(){const{data:e}=yield m.from("client_health_data").select("goals");if(e){const s=e.reduce((e,s)=>((s.goals||[]).forEach(s=>{e[s]=(e[s]||0)+1}),e),{}),t=Object.entries(s).map(([e,s])=>({name:e.replace("_"," ").toUpperCase(),value:s}));v(t)}}),fetchComplianceData=()=>__async(null,null,function*(){const e=fe(new Date,parseInt(r)),{data:s}=yield m.from("habit_logs").select("\n        *,\n        client_habits!habit_logs_habit_id_fkey(habit_name)\n      ").gte("log_date",e.toISOString()).order("log_date",{ascending:!0});if(s){const e=s.reduce((e,s)=>{const t=F(new Date(s.log_date),"MMM dd");return e[t]||(e[t]={date:t,total:0,completed:0}),e[t].total+=1,s.completed&&(e[t].completed+=1),e},{}),t=Object.values(e).map(e=>({date:e.date,rate:e.total>0?Math.round(e.completed/e.total*100):0}));N(t)}}),fetchTopPerformers=()=>__async(null,null,function*(){const e=fe(new Date,parseInt(r)),{data:s}=yield m.from("client_progress").select("\n        user_id,\n        weight_kg,\n        date,\n        user_profiles!client_progress_user_id_fkey(full_name, email)\n      ").gte("date",e.toISOString()).order("date",{ascending:!0});if(s){const e=s.reduce((e,s)=>{var t,a;return e[s.user_id]||(e[s.user_id]={userId:s.user_id,name:(null==(t=s.user_profiles)?void 0:t.full_name)||"Unknown",email:(null==(a=s.user_profiles)?void 0:a.email)||"",weights:[]}),s.weight_kg&&e[s.user_id].weights.push(s.weight_kg),e},{}),t=Object.values(e).map(e=>{const s=e.weights;if(s.length<2)return null;const t=s[0],a=t-s[s.length-1],l=(a/t*100).toFixed(1);return __spreadProps(__spreadValues({},e),{weightChange:a.toFixed(1),percentChange:parseFloat(l)})}).filter(Boolean).sort((e,s)=>Math.abs(s.percentChange)-Math.abs(e.percentChange)).slice(0,5);_(t)}}),fetchRevenueData=()=>__async(null,null,function*(){const e=fe(new Date,parseInt(r)),{data:s}=yield m.from("appointments").select("appointment_date, consultation_type").eq("status","completed").gte("appointment_date",e.toISOString()).order("appointment_date",{ascending:!0});if(s){const e=s.reduce((e,s)=>{const t=F(new Date(s.appointment_date),"MMM dd");e[t]||(e[t]={date:t,revenue:0});const a="initial"===s.consultation_type?100:"check_in"===s.consultation_type?50:75;return e[t].revenue+=a,e},{});C(Object.values(e))}}),M=["hsl(142, 76%, 36%)","hsl(217, 91%, 60%)","hsl(38, 92%, 50%)","hsl(0, 84%, 60%)","hsl(258, 90%, 66%)","hsl(330, 81%, 60%)"];return s?i.jsx("div",{className:"flex items-center justify-center h-64",children:i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):i.jsxs("div",{className:"space-y-6",children:[i.jsxs(ve.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-3xl font-bold text-foreground",children:"Analytics Dashboard"}),i.jsx("p",{className:"text-muted-foreground mt-1",children:"Track performance and client success metrics"})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("select",{value:r,onChange:e=>c(e.target.value),className:"px-4 py-2 rounded-lg border border-border bg-card text-foreground",children:[i.jsx("option",{value:"7",children:"Last 7 days"}),i.jsx("option",{value:"30",children:"Last 30 days"}),i.jsx("option",{value:"90",children:"Last 90 days"})]}),i.jsxs(u,{variant:"outline",onClick:()=>__async(null,null,function*(){l(!0),yield fetchAnalytics(),l(!1),e({title:"Success",description:"Analytics data refreshed"})}),disabled:a,children:[i.jsx(be,{className:"h-4 w-4 mr-2 "+(a?"animate-spin":"")}),"Refresh"]}),i.jsxs(u,{onClick:()=>{e({title:"Export Started",description:"Generating analytics report..."})},children:[i.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Export Report"]})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[i.jsx(MetricCard,{icon:k,title:"Total Clients",value:d.totalClients,change:`+${d.activeClients} this period`,trend:"up",color:"blue"}),i.jsx(MetricCard,{icon:S,title:"Appointments",value:d.totalAppointments,change:`${d.completedAppointments} completed`,trend:"up",color:"green"}),i.jsx(MetricCard,{icon:X,title:"Success Rate",value:`${d.averageSuccessRate}%`,change:"Average client progress",trend:"up",color:"purple"})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[i.jsxs(ve.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Average Client Progress"}),i.jsx(ye,{className:"h-5 w-5 text-muted-foreground"})]}),i.jsx(z,{width:"100%",height:300,children:i.jsxs(_e,{data:x,children:[i.jsx("defs",{children:i.jsxs("linearGradient",{id:"colorWeight",x1:"0",y1:"0",x2:"0",y2:"1",children:[i.jsx("stop",{offset:"5%",stopColor:"hsl(217, 91%, 60%)",stopOpacity:.3}),i.jsx("stop",{offset:"95%",stopColor:"hsl(217, 91%, 60%)",stopOpacity:0})]})}),i.jsx(q,{strokeDasharray:"3 3",className:"stroke-border"}),i.jsx(T,{dataKey:"date",className:"stroke-muted-foreground"}),i.jsx(L,{className:"stroke-muted-foreground"}),i.jsx(W,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--popover-foreground))"}}),i.jsx(we,{type:"monotone",dataKey:"avgWeight",stroke:"hsl(217, 91%, 60%)",fillOpacity:1,fill:"url(#colorWeight)"})]})})]}),i.jsxs(ve.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Appointment Trends"}),i.jsx(ke,{className:"h-5 w-5 text-gray-400"})]}),i.jsx(z,{width:"100%",height:300,children:i.jsxs(Ce,{data:p,children:[i.jsx(q,{strokeDasharray:"3 3",className:"stroke-border"}),i.jsx(T,{dataKey:"date",className:"stroke-muted-foreground"}),i.jsx(L,{className:"stroke-muted-foreground"}),i.jsx(W,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--popover-foreground))"}}),i.jsx(Se,{}),i.jsx(Me,{dataKey:"scheduled",fill:"hsl(217, 91%, 60%)",name:"Scheduled"}),i.jsx(Me,{dataKey:"completed",fill:"hsl(142, 76%, 36%)",name:"Completed"}),i.jsx(Me,{dataKey:"cancelled",fill:"hsl(0, 84%, 60%)",name:"Cancelled"})]})})]}),i.jsxs(ve.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Client Goals Distribution"}),i.jsx(Ee,{className:"h-5 w-5 text-gray-400"})]}),i.jsx(z,{width:"100%",height:300,children:i.jsxs(Ae,{children:[i.jsx(Fe,{data:f,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,percent:s})=>`${e} ${(100*s).toFixed(0)}%`,outerRadius:80,fill:"hsl(217, 91%, 60%)",dataKey:"value",children:f.map((e,s)=>i.jsx(De,{fill:M[s%M.length]},`cell-${s}`))}),i.jsx(W,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--popover-foreground))"}})]})})]}),i.jsxs(ve.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Client Compliance Rate"}),i.jsx(Pe,{className:"h-5 w-5 text-gray-400"})]}),i.jsx(z,{width:"100%",height:300,children:i.jsxs(O,{data:b,children:[i.jsx(q,{strokeDasharray:"3 3",className:"stroke-border"}),i.jsx(T,{dataKey:"date",className:"stroke-muted-foreground"}),i.jsx(L,{className:"stroke-muted-foreground"}),i.jsx(W,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--popover-foreground))"}}),i.jsx($,{type:"monotone",dataKey:"rate",stroke:"hsl(142, 76%, 36%)",strokeWidth:2,dot:{fill:"hsl(142, 76%, 36%)"}})]})})]})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[i.jsxs(ve.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Top Performers"}),i.jsx(Pe,{className:"h-5 w-5 text-yellow-500"})]}),0===y.length?i.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No progress data available"}):i.jsx("div",{className:"space-y-4",children:y.map((e,s)=>i.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted/50",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 text-primary font-bold",children:s+1}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-foreground",children:e.name}),i.jsx("p",{className:"text-sm text-muted-foreground",children:e.email})]})]}),i.jsxs("div",{className:"text-right",children:[i.jsxs("p",{className:"font-bold "+(e.weightChange>0?"text-destructive":"text-primary"),children:[e.weightChange>0?"+":"",e.weightChange," kg"]}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:[Math.abs(e.percentChange),"% change"]})]})]},e.userId))})]}),i.jsxs(ve.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h3",{className:"text-lg font-semibold text-card-foreground",children:"Revenue Trends"}),i.jsx(Ie,{className:"h-5 w-5 text-green-500"})]}),i.jsxs("div",{className:"mb-4",children:[i.jsxs("p",{className:"text-3xl font-bold text-foreground",children:["$",d.totalRevenue.toLocaleString()]}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Total revenue this period"})]}),i.jsx(z,{width:"100%",height:200,children:i.jsxs(_e,{data:w,children:[i.jsx("defs",{children:i.jsxs("linearGradient",{id:"colorRevenue",x1:"0",y1:"0",x2:"0",y2:"1",children:[i.jsx("stop",{offset:"5%",stopColor:"hsl(142, 76%, 36%)",stopOpacity:.3}),i.jsx("stop",{offset:"95%",stopColor:"hsl(142, 76%, 36%)",stopOpacity:0})]})}),i.jsx(q,{strokeDasharray:"3 3",className:"stroke-border"}),i.jsx(T,{dataKey:"date",className:"stroke-muted-foreground"}),i.jsx(L,{className:"stroke-muted-foreground"}),i.jsx(W,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--popover-foreground))"}}),i.jsx(we,{type:"monotone",dataKey:"revenue",stroke:"hsl(142, 76%, 36%)",fillOpacity:1,fill:"url(#colorRevenue)"})]})})]})]})]})},MetricCard=({icon:e,title:s,value:t,change:a,trend:l,color:r})=>i.jsx(ve.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-card rounded-xl shadow-lg p-6 border border-border",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:s}),i.jsx("p",{className:"text-3xl font-bold text-card-foreground mb-2",children:t}),i.jsxs("div",{className:"flex items-center gap-1 text-sm",children:["up"===l?i.jsx(M,{className:"h-4 w-4 text-primary"}):i.jsx(G,{className:"h-4 w-4 text-destructive"}),i.jsx("span",{className:"up"===l?"text-primary":"text-destructive",children:a})]})]}),i.jsx("div",{className:`p-3 rounded-lg ${{blue:"bg-blue-500/10 text-blue-500",green:"bg-primary/10 text-primary",purple:"bg-violet-500/10 text-violet-500",red:"bg-destructive/10 text-destructive"}[r]}`,children:i.jsx(e,{className:"h-6 w-6"})})]})}),ResourceLibrary=()=>{const{toast:e}=g(),[s,t]=n.useState(!0),[a,l]=n.useState([]),[r,c]=n.useState([]),[d,o]=n.useState(""),[x,h]=n.useState("all"),[j,f]=n.useState(null),[v,b]=n.useState(!1),[N,y]=n.useState(!1),[_,w]=n.useState({title:"",description:"",content:"",resource_type:"article",category:"nutrition",url:"",file_url:"",tags:[],is_public:!0}),[k,C]=n.useState(""),S=[{value:"all",label:"All Resources",icon:Re},{value:"nutrition",label:"Nutrition",icon:ze},{value:"exercise",label:"Exercise",icon:ze},{value:"wellness",label:"Wellness",icon:ze},{value:"recipes",label:"Recipes",icon:ze},{value:"guides",label:"Guides",icon:B}],M=[{value:"article",label:"Article",icon:B},{value:"video",label:"Video",icon:me},{value:"pdf",label:"PDF Document",icon:Ne},{value:"link",label:"External Link",icon:Le}];n.useEffect(()=>{fetchResources()},[]),n.useEffect(()=>{filterResources()},[a,d,x]);const fetchResources=()=>__async(null,null,function*(){t(!0);try{const{data:e,error:s}=yield m.from("educational_resources").select("*").order("created_at",{ascending:!1});if(s)throw s;l(e||[])}catch(s){console.error("Error fetching resources:",s),e({title:"Error",description:"Failed to load resources",variant:"destructive"})}finally{t(!1)}}),filterResources=()=>{let e=a;if("all"!==x&&(e=e.filter(e=>e.category===x)),d){const s=d.toLowerCase();e=e.filter(e=>{var t,a;return e.title.toLowerCase().includes(s)||(null==(t=e.description)?void 0:t.toLowerCase().includes(s))||(null==(a=e.tags)?void 0:a.some(e=>e.toLowerCase().includes(s)))})}c(e)},handleShareResource=s=>__async(null,null,function*(){e({title:"Share Link Copied",description:"Resource link copied to clipboard"})}),addTag=()=>{k&&!_.tags.includes(k)&&(w(__spreadProps(__spreadValues({},_),{tags:[..._.tags,k]})),C(""))},resetForm=()=>{w({title:"",description:"",content:"",resource_type:"article",category:"nutrition",url:"",file_url:"",tags:[],is_public:!0}),f(null)},getResourceColor=e=>{const s={article:"bg-blue-500/10 text-blue-600 dark:text-blue-400",video:"bg-purple-500/10 text-purple-600 dark:text-purple-400",pdf:"bg-red-500/10 text-red-600 dark:text-red-400",link:"bg-green-500/10 text-green-600 dark:text-green-400"};return s[e]||s.article};return s?i.jsx("div",{className:"flex items-center justify-center h-64",children:i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):i.jsxs("div",{className:"space-y-6",children:[i.jsxs(ve.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-3xl font-bold text-foreground",children:"Resource Library"}),i.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage educational content and resources for clients"})]}),i.jsxs(u,{onClick:()=>{resetForm(),b(!0)},children:[i.jsx(U,{className:"h-4 w-4 mr-2"}),"Add Resource"]})]}),i.jsxs("div",{className:"flex gap-4",children:[i.jsxs("div",{className:"flex-1 relative",children:[i.jsx(V,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground"}),i.jsx("input",{type:"text",placeholder:"Search resources...",value:d,onChange:e=>o(e.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border border-border bg-background text-foreground"})]}),i.jsx("div",{className:"flex gap-2",children:S.map(e=>{const s=e.icon;return i.jsxs(u,{variant:x===e.value?"default":"outline",onClick:()=>h(e.value),className:"whitespace-nowrap",children:[i.jsx(s,{className:"h-4 w-4 mr-2"}),e.label]},e.value)})})]}),0===r.length?i.jsxs(ve.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-12 bg-card rounded-xl border border-border",children:[i.jsx(ze,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground"}),i.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No Resources Found"}),i.jsx("p",{className:"text-muted-foreground mb-4",children:d||"all"!==x?"Try adjusting your filters":"Get started by creating your first resource"}),i.jsxs(u,{onClick:()=>{resetForm(),b(!0)},children:[i.jsx(U,{className:"h-4 w-4 mr-2"}),"Add Resource"]})]}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map((s,t)=>{const a=(e=>{const s=M.find(s=>s.value===e);return s?s.icon:B})(s.resource_type);return i.jsxs(ve.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*t},className:"bg-card rounded-xl shadow-lg border border-border overflow-hidden hover:shadow-xl transition-shadow",children:[i.jsx("div",{className:`p-4 ${getResourceColor(s.resource_type)}`,children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsx(a,{className:"h-8 w-8"}),i.jsx(p,{variant:s.is_public?"default":"secondary",children:s.is_public?"Public":"Private"})]})}),i.jsxs("div",{className:"p-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2 line-clamp-2",children:s.title}),i.jsx("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-3",children:s.description||"No description available"}),s.tags&&s.tags.length>0&&i.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[s.tags.slice(0,3).map((e,s)=>i.jsxs(p,{variant:"outline",className:"text-xs",children:[i.jsx(Oe,{className:"h-3 w-3 mr-1"}),e]},s)),s.tags.length>3&&i.jsxs(p,{variant:"outline",className:"text-xs",children:["+",s.tags.length-3]})]}),i.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground mb-4",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(E,{className:"h-3 w-3"}),F(new Date(s.created_at),"MMM dd, yyyy")]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(qe,{className:"h-3 w-3"}),s.view_count||0," views"]})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(u,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>(e=>__async(null,null,function*(){f(e),y(!0);try{yield m.from("educational_resources").update({view_count:(e.view_count||0)+1}).eq("id",e.id)}catch(s){console.error("Error updating view count:",s)}}))(s),children:[i.jsx(qe,{className:"h-4 w-4 mr-1"}),"View"]}),i.jsx(u,{size:"sm",variant:"outline",onClick:()=>(e=>{f(e),w({title:e.title,description:e.description||"",content:e.content||"",resource_type:e.resource_type,category:e.category,url:e.url||"",file_url:e.file_url||"",tags:e.tags||[],is_public:e.is_public}),b(!0)})(s),children:i.jsx(J,{className:"h-4 w-4"})}),i.jsx(u,{size:"sm",variant:"outline",onClick:()=>handleShareResource(),children:i.jsx(Te,{className:"h-4 w-4"})}),i.jsx(u,{size:"sm",variant:"outline",onClick:()=>{return t=s.id,__async(null,null,function*(){if(confirm("Are you sure you want to delete this resource?"))try{const{error:s}=yield m.from("educational_resources").delete().eq("id",t);if(s)throw s;e({title:"Success",description:"Resource deleted successfully"}),fetchResources()}catch(s){console.error("Error deleting resource:",s),e({title:"Error",description:"Failed to delete resource",variant:"destructive"})}});var t},children:i.jsx(Z,{className:"h-4 w-4"})})]})]})]},s.id)})}),i.jsx(Je,{open:v,onOpenChange:b,children:i.jsxs(Ze,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[i.jsx(Qe,{children:i.jsx(Xe,{children:j?"Edit Resource":"Add New Resource"})}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Title *"}),i.jsx("input",{type:"text",value:_.title,onChange:e=>w(__spreadProps(__spreadValues({},_),{title:e.target.value})),className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",placeholder:"Resource title"})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Type *"}),i.jsx("select",{value:_.resource_type,onChange:e=>w(__spreadProps(__spreadValues({},_),{resource_type:e.target.value})),className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",children:M.map(e=>i.jsx("option",{value:e.value,children:e.label},e.value))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Category"}),i.jsx("select",{value:_.category,onChange:e=>w(__spreadProps(__spreadValues({},_),{category:e.target.value})),className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",children:S.filter(e=>"all"!==e.value).map(e=>i.jsx("option",{value:e.value,children:e.label},e.value))})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Description"}),i.jsx("textarea",{value:_.description,onChange:e=>w(__spreadProps(__spreadValues({},_),{description:e.target.value})),rows:3,className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",placeholder:"Brief description"})]}),("link"===_.resource_type||"video"===_.resource_type)&&i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"URL"}),i.jsx("input",{type:"url",value:_.url,onChange:e=>w(__spreadProps(__spreadValues({},_),{url:e.target.value})),className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",placeholder:"https://example.com"})]}),"pdf"===_.resource_type&&i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"File URL"}),i.jsx("input",{type:"url",value:_.file_url,onChange:e=>w(__spreadProps(__spreadValues({},_),{file_url:e.target.value})),className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground",placeholder:"Upload file and paste URL"})]}),"article"===_.resource_type&&i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Content"}),i.jsx("textarea",{value:_.content,onChange:e=>w(__spreadProps(__spreadValues({},_),{content:e.target.value})),rows:10,className:"w-full px-4 py-2 rounded-lg border border-border bg-background text-foreground font-mono text-sm",placeholder:"Write your article content here (supports Markdown)"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Tags"}),i.jsxs("div",{className:"flex gap-2 mb-2",children:[i.jsx("input",{type:"text",value:k,onChange:e=>C(e.target.value),onKeyPress:e=>"Enter"===e.key&&(e.preventDefault(),addTag()),className:"flex-1 px-4 py-2 rounded-lg border border-border bg-background text-foreground",placeholder:"Add a tag and press Enter"}),i.jsx(u,{onClick:addTag,children:"Add"})]}),i.jsx("div",{className:"flex flex-wrap gap-2",children:_.tags.map((e,s)=>i.jsxs(p,{className:"flex items-center gap-1",children:[e,i.jsx(Y,{className:"h-3 w-3 cursor-pointer",onClick:()=>{return s=e,void w(__spreadProps(__spreadValues({},_),{tags:_.tags.filter(e=>e!==s)}));var s}})]},s))})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"checkbox",id:"is_public",checked:_.is_public,onChange:e=>w(__spreadProps(__spreadValues({},_),{is_public:e.target.checked})),className:"w-4 h-4"}),i.jsx("label",{htmlFor:"is_public",className:"text-sm font-medium text-foreground",children:"Make this resource public to all clients"})]})]}),i.jsxs(es,{children:[i.jsx(u,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),i.jsxs(u,{onClick:()=>__async(null,null,function*(){if(_.title&&_.resource_type)try{const{data:{user:s}}=yield m.auth.getUser(),t=__spreadProps(__spreadValues({},_),{created_by:null==s?void 0:s.id,view_count:0});let a;if(j){const{data:s,error:l}=yield m.from("educational_resources").update(t).eq("id",j.id).select().single();if(l)throw l;a=s,e({title:"Success",description:"Resource updated successfully"})}else{const{data:s,error:l}=yield m.from("educational_resources").insert([t]).select().single();if(l)throw l;a=s,e({title:"Success",description:"Resource created successfully"})}b(!1),resetForm(),fetchResources()}catch(s){console.error("Error saving resource:",s),e({title:"Error",description:"Failed to save resource",variant:"destructive"})}else e({title:"Validation Error",description:"Please fill in required fields",variant:"destructive"})}),children:[j?"Update":"Create"," Resource"]})]})]})}),i.jsx(Je,{open:N,onOpenChange:y,children:i.jsx(Ze,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:j&&i.jsxs(i.Fragment,{children:[i.jsx(Qe,{children:i.jsx("div",{className:"flex items-start justify-between",children:i.jsxs("div",{className:"flex-1",children:[i.jsx(Xe,{className:"text-2xl mb-2 text-foreground",children:j.title}),i.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[i.jsx(p,{children:j.resource_type}),i.jsx(p,{variant:"outline",children:j.category}),i.jsx("span",{children:"•"}),i.jsx("span",{children:F(new Date(j.created_at),"MMMM dd, yyyy")}),i.jsx("span",{children:"•"}),i.jsxs("span",{children:[j.view_count||0," views"]})]})]})})}),i.jsxs("div",{className:"space-y-4",children:[j.description&&i.jsx("div",{children:i.jsx("p",{className:"text-muted-foreground",children:j.description})}),j.tags&&j.tags.length>0&&i.jsx("div",{className:"flex flex-wrap gap-2",children:j.tags.map((e,s)=>i.jsxs(p,{variant:"outline",children:[i.jsx(Oe,{className:"h-3 w-3 mr-1"}),e]},s))}),"article"===j.resource_type&&j.content&&i.jsx("div",{className:"prose dark:prose-invert max-w-none",children:i.jsx("div",{className:"whitespace-pre-wrap text-foreground",children:j.content})}),"link"===j.resource_type&&j.url&&i.jsx("div",{className:"p-4 bg-muted/50 rounded-lg",children:i.jsxs("a",{href:j.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-primary hover:underline",children:[i.jsx(We,{className:"h-4 w-4"}),"Open External Link"]})}),"video"===j.resource_type&&j.url&&i.jsx("div",{className:"aspect-video bg-muted rounded-lg flex items-center justify-center",children:i.jsxs("a",{href:j.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-primary hover:underline",children:[i.jsx(me,{className:"h-6 w-6"}),"Watch Video"]})}),"pdf"===j.resource_type&&j.file_url&&i.jsx("div",{className:"p-4 bg-muted/50 rounded-lg",children:i.jsxs("a",{href:j.file_url,download:!0,className:"flex items-center gap-2 text-primary hover:underline",children:[i.jsx(Ne,{className:"h-4 w-4"}),"Download PDF"]})})]}),i.jsxs(es,{children:[i.jsx(u,{variant:"outline",onClick:()=>y(!1),children:"Close"}),i.jsxs(u,{onClick:()=>handleShareResource(),children:[i.jsx(Te,{className:"h-4 w-4 mr-2"}),"Share"]})]})]})})})]})},NutritionistSettings=()=>{const{user:e,userProfile:s}=o(),[t,a]=n.useState(!0),[l,r]=n.useState(!1),[c,d]=n.useState("business"),[p,g]=n.useState({business_name:"",business_address:"",business_phone:"",license_number:"",specializations:[],consultation_duration_default:60,buffer_time_minutes:15,working_hours:{monday:{enabled:!0,start:"09:00",end:"17:00"},tuesday:{enabled:!0,start:"09:00",end:"17:00"},wednesday:{enabled:!0,start:"09:00",end:"17:00"},thursday:{enabled:!0,start:"09:00",end:"17:00"},friday:{enabled:!0,start:"09:00",end:"17:00"},saturday:{enabled:!1,start:"09:00",end:"13:00"},sunday:{enabled:!1,start:"09:00",end:"13:00"}},time_zone:Intl.DateTimeFormat().resolvedOptions().timeZone,booking_advance_days:30,hourly_rate:"",initial_consultation_fee:"",follow_up_fee:"",package_pricing:[],email_notifications:!0,sms_notifications:!1,appointment_reminders:!0,reminder_hours_before:24,brand_color:"#10b981",logo_url:"",custom_email_signature:""}),[j,f]=n.useState(""),[v,k]=n.useState({name:"",sessions:"",price:""});n.useEffect(()=>{fetchSettings()},[e]);const fetchSettings=()=>__async(null,null,function*(){a(!0);try{const{data:s,error:t}=yield m.from("nutritionist_settings").select("*").eq("nutritionist_id",e.id).single();if(t&&"PGRST116"!==t.code)throw t;s&&g(__spreadProps(__spreadValues(__spreadValues({},p),s),{specializations:s.specializations||[],working_hours:s.working_hours||p.working_hours,package_pricing:s.package_pricing||[]}))}catch(s){console.error("Error fetching settings:",s)}finally{a(!1)}}),handleSaveSettings=()=>__async(null,null,function*(){r(!0);try{const{data:s}=yield m.from("nutritionist_settings").select("id").eq("nutritionist_id",e.id).single(),t=__spreadProps(__spreadValues({},p),{nutritionist_id:e.id});if(s){const{error:s}=yield m.from("nutritionist_settings").update(t).eq("nutritionist_id",e.id);if(s)throw s}else{const{error:e}=yield m.from("nutritionist_settings").insert(t);if(e)throw e}h({title:"Settings saved",description:"Your settings have been updated successfully"})}catch(s){console.error("Error saving settings:",s),h({variant:"destructive",title:"Error",description:"Failed to save settings"})}finally{r(!1)}}),handleAddSpecialization=()=>{j.trim()&&!p.specializations.includes(j.trim())&&(g(__spreadProps(__spreadValues({},p),{specializations:[...p.specializations,j.trim()]})),f(""))},updateWorkingHours=(e,s,t)=>{g(__spreadProps(__spreadValues({},p),{working_hours:__spreadProps(__spreadValues({},p.working_hours),{[e]:__spreadProps(__spreadValues({},p.working_hours[e]),{[s]:t})})}))};return t?i.jsx("div",{className:"flex items-center justify-center h-96",children:i.jsx(te,{className:"w-12 h-12 animate-spin text-primary"})}):i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[i.jsx($e,{className:"w-8 h-8 text-primary"}),"Settings"]}),i.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your business settings and preferences"})]}),i.jsx(u,{onClick:handleSaveSettings,disabled:l,children:l?i.jsxs(i.Fragment,{children:[i.jsx(te,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):i.jsxs(i.Fragment,{children:[i.jsx(K,{className:"w-4 h-4 mr-2"}),"Save Changes"]})})]}),i.jsxs(Ve,{value:c,onValueChange:d,children:[i.jsxs(Ge,{className:"grid w-full grid-cols-5",children:[i.jsx(He,{value:"business",children:"Business"}),i.jsx(He,{value:"availability",children:"Availability"}),i.jsx(He,{value:"pricing",children:"Pricing"}),i.jsx(He,{value:"notifications",children:"Notifications"}),i.jsx(He,{value:"branding",children:"Branding"})]}),i.jsx(Ye,{value:"business",className:"space-y-4",children:i.jsxs(b,{children:[i.jsxs(N,{children:[i.jsxs(y,{className:"flex items-center gap-2",children:[i.jsx(Ue,{className:"w-5 h-5"}),"Business Information"]}),i.jsx(w,{children:"Manage your professional business details"})]}),i.jsxs(_,{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Business Name"}),i.jsx(Ke,{value:p.business_name,onChange:e=>g(__spreadProps(__spreadValues({},p),{business_name:e.target.value})),placeholder:"Your Nutrition Practice"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"License Number"}),i.jsx(Ke,{value:p.license_number,onChange:e=>g(__spreadProps(__spreadValues({},p),{license_number:e.target.value})),placeholder:"License #"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Business Address"}),i.jsx(x,{value:p.business_address,onChange:e=>g(__spreadProps(__spreadValues({},p),{business_address:e.target.value})),placeholder:"123 Main St, City, State, ZIP",rows:2})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Business Phone"}),i.jsx(Ke,{value:p.business_phone,onChange:e=>g(__spreadProps(__spreadValues({},p),{business_phone:e.target.value})),placeholder:"+1 (555) 000-0000"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Specializations"}),i.jsxs("div",{className:"flex gap-2 mb-2",children:[i.jsx(Ke,{value:j,onChange:e=>f(e.target.value),placeholder:"e.g., Weight Loss, Sports Nutrition",onKeyPress:e=>"Enter"===e.key&&handleAddSpecialization()}),i.jsx(u,{onClick:handleAddSpecialization,children:"Add"})]}),i.jsx("div",{className:"flex flex-wrap gap-2",children:p.specializations.map((e,s)=>i.jsxs("span",{className:"px-3 py-1 bg-primary/10 text-primary rounded-full text-sm flex items-center gap-2",children:[e,i.jsx("button",{onClick:()=>(e=>{g(__spreadProps(__spreadValues({},p),{specializations:p.specializations.filter(s=>s!==e)}))})(e),className:"text-primary/60 hover:text-primary",children:"×"})]},s))})]})]})]})}),i.jsx(Ye,{value:"availability",className:"space-y-4",children:i.jsxs(b,{children:[i.jsxs(N,{children:[i.jsxs(y,{className:"flex items-center gap-2",children:[i.jsx(E,{className:"w-5 h-5"}),"Working Hours"]}),i.jsx(w,{children:"Set your available hours for client bookings"})]}),i.jsxs(_,{className:"space-y-4",children:[["monday","tuesday","wednesday","thursday","friday","saturday","sunday"].map(e=>{var s,t,a,l;return i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-32",children:i.jsxs("label",{className:"flex items-center gap-2",children:[i.jsx(ss,{checked:(null==(s=p.working_hours[e])?void 0:s.enabled)||!1,onCheckedChange:s=>updateWorkingHours(e,"enabled",s)}),i.jsx("span",{className:"capitalize font-medium",children:e})]})}),(null==(t=p.working_hours[e])?void 0:t.enabled)&&i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Ke,{type:"time",value:(null==(a=p.working_hours[e])?void 0:a.start)||"09:00",onChange:s=>updateWorkingHours(e,"start",s.target.value),className:"w-32"}),i.jsx("span",{children:"to"}),i.jsx(Ke,{type:"time",value:(null==(l=p.working_hours[e])?void 0:l.end)||"17:00",onChange:s=>updateWorkingHours(e,"end",s.target.value),className:"w-32"})]})]},e)}),i.jsxs("div",{className:"pt-4 border-t border-border grid grid-cols-3 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Default Consultation Duration"}),i.jsxs("select",{value:p.consultation_duration_default,onChange:e=>g(__spreadProps(__spreadValues({},p),{consultation_duration_default:parseInt(e.target.value)})),className:"w-full px-3 py-2 bg-background border border-border rounded-md",children:[i.jsx("option",{value:"30",children:"30 minutes"}),i.jsx("option",{value:"45",children:"45 minutes"}),i.jsx("option",{value:"60",children:"60 minutes"}),i.jsx("option",{value:"90",children:"90 minutes"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Buffer Time (minutes)"}),i.jsx(Ke,{type:"number",value:p.buffer_time_minutes,onChange:e=>g(__spreadProps(__spreadValues({},p),{buffer_time_minutes:parseInt(e.target.value)}))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Booking Advance (days)"}),i.jsx(Ke,{type:"number",value:p.booking_advance_days,onChange:e=>g(__spreadProps(__spreadValues({},p),{booking_advance_days:parseInt(e.target.value)}))})]})]})]})]})}),i.jsx(Ye,{value:"pricing",className:"space-y-4",children:i.jsxs(b,{children:[i.jsxs(N,{children:[i.jsxs(y,{className:"flex items-center gap-2",children:[i.jsx(Ie,{className:"w-5 h-5"}),"Consultation Pricing"]}),i.jsx(w,{children:"Set your consultation fees and package pricing"})]}),i.jsxs(_,{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Hourly Rate"}),i.jsx(Ke,{type:"number",step:"0.01",value:p.hourly_rate,onChange:e=>g(__spreadProps(__spreadValues({},p),{hourly_rate:e.target.value})),placeholder:"100.00"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Initial Consultation Fee"}),i.jsx(Ke,{type:"number",step:"0.01",value:p.initial_consultation_fee,onChange:e=>g(__spreadProps(__spreadValues({},p),{initial_consultation_fee:e.target.value})),placeholder:"150.00"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Follow-up Fee"}),i.jsx(Ke,{type:"number",step:"0.01",value:p.follow_up_fee,onChange:e=>g(__spreadProps(__spreadValues({},p),{follow_up_fee:e.target.value})),placeholder:"75.00"})]})]}),i.jsxs("div",{className:"pt-4 border-t border-border",children:[i.jsx("h4",{className:"font-semibold mb-4",children:"Package Pricing"}),i.jsxs("div",{className:"grid grid-cols-4 gap-2 mb-4",children:[i.jsx(Ke,{placeholder:"Package name",value:v.name,onChange:e=>k(__spreadProps(__spreadValues({},v),{name:e.target.value}))}),i.jsx(Ke,{type:"number",placeholder:"Sessions",value:v.sessions,onChange:e=>k(__spreadProps(__spreadValues({},v),{sessions:e.target.value}))}),i.jsx(Ke,{type:"number",step:"0.01",placeholder:"Price",value:v.price,onChange:e=>k(__spreadProps(__spreadValues({},v),{price:e.target.value}))}),i.jsx(u,{onClick:()=>{v.name&&v.sessions&&v.price&&(g(__spreadProps(__spreadValues({},p),{package_pricing:[...p.package_pricing,{name:v.name,sessions:parseInt(v.sessions),price:parseFloat(v.price)}]})),k({name:"",sessions:"",price:""}))},children:"Add Package"})]}),p.package_pricing.length>0&&i.jsx("div",{className:"space-y-2",children:p.package_pricing.map((e,s)=>i.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-medium",children:e.name}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.sessions," sessions • $",e.price]})]}),i.jsx(u,{variant:"ghost",size:"sm",onClick:()=>(e=>{g(__spreadProps(__spreadValues({},p),{package_pricing:p.package_pricing.filter((s,t)=>t!==e)}))})(s),children:"Remove"})]},s))})]})]})]})}),i.jsx(Ye,{value:"notifications",className:"space-y-4",children:i.jsxs(b,{children:[i.jsxs(N,{children:[i.jsxs(y,{className:"flex items-center gap-2",children:[i.jsx(D,{className:"w-5 h-5"}),"Notification Preferences"]}),i.jsx(w,{children:"Manage how you receive notifications and reminders"})]}),i.jsxs(_,{className:"space-y-6",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-medium",children:"Email Notifications"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive notifications via email"})]}),i.jsx(ss,{checked:p.email_notifications,onCheckedChange:e=>g(__spreadProps(__spreadValues({},p),{email_notifications:e}))})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-medium",children:"SMS Notifications"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive notifications via text message"})]}),i.jsx(ss,{checked:p.sms_notifications,onCheckedChange:e=>g(__spreadProps(__spreadValues({},p),{sms_notifications:e}))})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-medium",children:"Appointment Reminders"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Send reminders for upcoming appointments"})]}),i.jsx(ss,{checked:p.appointment_reminders,onCheckedChange:e=>g(__spreadProps(__spreadValues({},p),{appointment_reminders:e}))})]}),p.appointment_reminders&&i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Send reminders (hours before appointment)"}),i.jsx(Ke,{type:"number",value:p.reminder_hours_before,onChange:e=>g(__spreadProps(__spreadValues({},p),{reminder_hours_before:parseInt(e.target.value)}))})]})]})]})}),i.jsx(Ye,{value:"branding",className:"space-y-4",children:i.jsxs(b,{children:[i.jsxs(N,{children:[i.jsxs(y,{className:"flex items-center gap-2",children:[i.jsx(Be,{className:"w-5 h-5"}),"Branding & Customization"]}),i.jsx(w,{children:"Customize your brand appearance and communications"})]}),i.jsxs(_,{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Brand Color"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Ke,{type:"color",value:p.brand_color,onChange:e=>g(__spreadProps(__spreadValues({},p),{brand_color:e.target.value})),className:"w-20 h-10"}),i.jsx(Ke,{value:p.brand_color,onChange:e=>g(__spreadProps(__spreadValues({},p),{brand_color:e.target.value})),placeholder:"#10b981"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Logo URL"}),i.jsx(Ke,{value:p.logo_url,onChange:e=>g(__spreadProps(__spreadValues({},p),{logo_url:e.target.value})),placeholder:"https://example.com/logo.png"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Custom Email Signature"}),i.jsx(x,{value:p.custom_email_signature,onChange:e=>g(__spreadProps(__spreadValues({},p),{custom_email_signature:e.target.value})),placeholder:"Best regards,\nYour Name\nCertified Nutritionist",rows:4})]})]})]})})]}),i.jsx("div",{className:"flex justify-end sticky bottom-4",children:i.jsx(u,{onClick:handleSaveSettings,disabled:l,size:"lg",children:l?i.jsxs(i.Fragment,{children:[i.jsx(te,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):i.jsxs(i.Fragment,{children:[i.jsx(K,{className:"w-4 h-4 mr-2"}),"Save All Changes"]})})})]})},NutritionistPanel=({user:e})=>{const[s]=d(),[t,a]=n.useState("dashboard");n.useEffect(()=>{const e=s.get("tab");a(e||"dashboard")},[s]);return i.jsx(f,{children:i.jsx(ve.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:(()=>{switch(t){case"dashboard":default:return i.jsx(DashboardOverview,{user:e});case"clients":return i.jsx(ClientManagement,{});case"meals":return i.jsx(MealPlanning,{});case"schedule":return i.jsx(AppointmentSchedule,{});case"messages":return i.jsx(MessagingCenter,{});case"analytics":return i.jsx(AnalyticsDashboard,{});case"resources":return i.jsx(ResourceLibrary,{});case"blog":return i.jsx(v,{user:e});case"settings":return i.jsx(NutritionistSettings,{})}})()},t)})},NutritionistDashboardV2=()=>{var e;const{userProfile:s}=o(),t={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}};return i.jsxs(i.Fragment,{children:[i.jsxs(j,{children:[i.jsx("title",{children:"Nutritionist Dashboard - GreenoFig"}),i.jsx("meta",{name:"description",content:"Manage your nutrition practice and clients"})]}),i.jsxs(ve.div,{variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"visible",className:"space-y-8",children:[i.jsxs(ve.div,{variants:t,children:[i.jsxs("h1",{className:"text-4xl font-bold",children:["Nutritionist ",i.jsx("span",{className:"gradient-text",children:"Portal"})]}),i.jsxs("p",{className:"text-text-secondary mt-2",children:["Welcome, ",(null==(e=null==s?void 0:s.full_name)?void 0:e.split(" ")[0])||"Nutritionist",". Manage your clients and practice from here."]})]}),i.jsx(ve.div,{variants:t,children:i.jsx(NutritionistPanel,{user:s})})]})]})};export{NutritionistDashboardV2 as default};
