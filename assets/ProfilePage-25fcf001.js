import{j as e}from"./vendor-ui-fc6158c5.js";import{r as s}from"./vendor-react-c35372bd.js";import{u as t,H as a,B as r,A as l,b as i,d,s as n,t as o}from"./index-05318a06.js";import{C as c,c as m,a as u,b as x,e as h}from"./card-aef3fa8a.js";import{I as p}from"./input-a2afde68.js";import{C as f}from"./checkbox-4d0e9ce0.js";import{L as g}from"./label-00b518b2.js";import{L as j,m as b,U as v,a6 as N,bk as y,a5 as w,ai as _,a as k,b5 as C,aO as P}from"./vendor-utils-1c344488.js";import"./vendor-editor-c22fa4d3.js";const S=()=>{var S,F,A,E;const{user:U,userProfile:$,refreshUserProfile:H}=t(),[L,q]=s.useState(null),[I,z]=s.useState(!1),[G,M]=s.useState(!0),[W,B]=s.useState(!1),[D,Y]=s.useState(!1),R=s.useRef(null),[V,K]=s.useState(!1),[O,T]=s.useState(""),[J,Q]=s.useState(""),[X,Z]=s.useState(""),[ee,se]=s.useState(!1),[te,ae]=s.useState(!1),[re,le]=s.useState(!1);s.useEffect(()=>{$&&(q({...$}),M(!1))},[$]);const ie=e=>{const{name:s,value:t}=e.target;q(e=>({...e,[s]:t}))},de=()=>{I&&R.current.click()};return G||!L?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(j,{className:"h-12 w-12 animate-spin text-primary"})}):e.jsxs(e.Fragment,{children:[e.jsxs(a,{children:[e.jsx("title",{children:"My Profile - GreenoFig"}),e.jsx("meta",{name:"description",content:"Manage your profile and settings."})]}),e.jsxs(b.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},initial:"hidden",animate:"visible",className:"max-w-4xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl font-bold",children:["My ",e.jsx("span",{className:"gradient-text",children:"Profile"})]}),e.jsx("p",{className:"text-text-secondary mt-2",children:"View and manage your personal details."})]}),e.jsx(r,{onClick:()=>z(!I),disabled:W||D,children:I?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"mr-2 h-4 w-4"})," View Profile"]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"mr-2 h-4 w-4"})," Edit Profile"]})})]}),e.jsx(c,{className:"glass-effect",children:e.jsx(m,{className:"p-6",children:I?e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!U)return;B(!0);const{id:s,created_at:t,updated_at:a,role:r,email:l,profile_picture_url:i,...d}=L,{error:c}=await n.from("user_profiles").update(d).eq("id",U.id);c?o({variant:"destructive",title:"Error updating profile",description:c.message}):(await H(),o({title:"Profile Updated!",description:"Your information has been successfully saved."}),z(!1)),B(!1)},className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"relative group",children:[e.jsxs(l,{className:"h-24 w-24 cursor-pointer",onClick:de,children:[e.jsx(i,{src:null==L?void 0:L.profile_picture_url,alt:null==L?void 0:L.full_name}),e.jsx(d,{className:"text-4xl",children:(null==(S=null==L?void 0:L.full_name)?void 0:S.split(" ").map(e=>e[0]).join(""))||"?"})]}),D?e.jsx("div",{className:"absolute inset-0 bg-background/80 flex items-center justify-center rounded-full",children:e.jsx(j,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center rounded-full opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer",onClick:de,children:e.jsx(y,{className:"h-8 w-8 text-white"})}),e.jsx("input",{type:"file",ref:R,onChange:async e=>{const s=e.target.files[0];if(!s||!U)return;Y(!0);const t=s.name.split(".").pop(),a=`avatars/${`${U.id}.${t}`}`,{error:r}=await n.storage.from("user-assets").upload(a,s,{upsert:!0});if(r)return o({variant:"destructive",title:"Upload failed",description:r.message}),void Y(!1);const{data:{publicUrl:l}}=n.storage.from("user-assets").getPublicUrl(a),i=`${l}?t=${(new Date).getTime()}`,{error:d}=await n.from("user_profiles").update({profile_picture_url:i}).eq("id",U.id);d?o({variant:"destructive",title:"Failed to save avatar",description:d.message}):(await H(),o({title:"Avatar updated!",description:"Your new profile picture is now live."})),Y(!1)},accept:"image/png, image/jpeg",className:"hidden"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"full_name",className:"block text-sm font-medium text-text-primary",children:"Full Name"}),e.jsx("input",{type:"text",name:"full_name",id:"full_name",value:L.full_name||"",onChange:ie,className:"mt-1 block w-full bg-background border border-border rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-text-secondary",children:"Email"}),e.jsx("input",{type:"email",name:"email",id:"email",value:L.email||"",disabled:!0,className:"mt-1 block w-full bg-muted border-border rounded-md shadow-sm py-2 px-3 sm:text-sm cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"age",className:"block text-sm font-medium text-text-primary",children:"Age"}),e.jsx("input",{type:"number",name:"age",id:"age",value:L.age||"",onChange:ie,className:"mt-1 block w-full bg-background border border-border rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"height_cm",className:"block text-sm font-medium text-text-primary",children:"Height (cm)"}),e.jsx("input",{type:"number",name:"height_cm",id:"height_cm",value:L.height_cm||"",onChange:ie,className:"mt-1 block w-full bg-background border border-border rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"weight_kg",className:"block text-sm font-medium text-text-primary",children:"Weight (kg)"}),e.jsx("input",{type:"number",step:"0.1",name:"weight_kg",id:"weight_kg",value:L.weight_kg||"",onChange:ie,className:"mt-1 block w-full bg-background border border-border rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-text-primary mb-3 flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4"}),"Health Goals"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[{id:"lose_weight",label:"Lose Weight"},{id:"build_muscle",label:"Build Muscle"},{id:"improve_endurance",label:"Improve Endurance"},{id:"eat_healthier",label:"Eat Healthier"},{id:"increase_energy",label:"Increase Energy"},{id:"reduce_stress",label:"Reduce Stress"},{id:"better_sleep",label:"Better Sleep"}].map(s=>e.jsxs("div",{className:"flex items-center space-x-2 p-3 rounded-lg border border-border hover:bg-muted/50 transition-colors",children:[e.jsx(f,{id:s.id,checked:(L.health_goals||[]).includes(s.id),onCheckedChange:()=>(e=>{const s=L.health_goals||[],t=s.includes(e)?s.filter(s=>s!==e):[...s,e];q(e=>({...e,health_goals:t}))})(s.id)}),e.jsx(g,{htmlFor:s.id,className:"text-sm font-medium cursor-pointer flex-1",children:s.label})]},s.id))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Select all that apply to personalize your experience"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(r,{type:"submit",disabled:W||D,children:[W?e.jsx(j,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(_,{className:"mr-2 h-4 w-4"}),"Save Changes"]})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs(l,{className:"h-24 w-24 border-2 border-primary",children:[e.jsx(i,{src:null==L?void 0:L.profile_picture_url,alt:null==L?void 0:L.full_name}),e.jsx(d,{className:"text-4xl",children:(null==(F=null==L?void 0:L.full_name)?void 0:F.split(" ").map(e=>e[0]).join(""))||"?"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-text-primary",children:L.full_name}),e.jsx("p",{className:"text-text-secondary",children:L.email}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize mt-1",children:L.role||"user"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-6 pt-6 border-t border-border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Age"}),e.jsx("p",{className:"text-lg font-semibold",children:L.age||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Gender"}),e.jsx("p",{className:"text-lg font-semibold capitalize",children:L.gender||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Height"}),e.jsx("p",{className:"text-lg font-semibold",children:L.height_cm?`${L.height_cm} cm`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Weight"}),e.jsx("p",{className:"text-lg font-semibold",children:L.weight_kg?`${L.weight_kg} kg`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Activity Level"}),e.jsx("p",{className:"text-lg font-semibold capitalize",children:(null==(A=L.activity_level)?void 0:A.replace("_"," "))||"N/A"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Health Goals"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(null==(E=L.health_goals)?void 0:E.length)>0?L.health_goals.map(s=>e.jsx("span",{className:"px-3 py-1 text-sm rounded-full bg-primary/10 text-primary font-medium",children:s},s)):e.jsx("p",{children:"No goals set."})})]})]})})}),e.jsxs(c,{className:"glass-effect",children:[e.jsxs(u,{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),"Change Password"]}),e.jsx(h,{children:"Update your password to keep your account secure"})]}),e.jsx(m,{children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),J.length<8)o({variant:"destructive",title:"Password too short",description:"Password must be at least 8 characters long."});else if(J===X){K(!0);try{const{error:e}=await n.auth.signInWithPassword({email:U.email,password:O});if(e)return o({variant:"destructive",title:"Incorrect current password",description:"Please enter your correct current password."}),void K(!1);const{error:s}=await n.auth.updateUser({password:J});if(s)throw s;o({title:"Password updated successfully",description:"Your password has been changed."}),T(""),Q(""),Z("")}catch(s){o({variant:"destructive",title:"Error updating password",description:s.message})}finally{K(!1)}}else o({variant:"destructive",title:"Passwords do not match",description:"Please make sure both passwords are the same."})},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{type:ee?"text":"password",value:O,onChange:e=>T(e.target.value),placeholder:"Enter current password",disabled:V,required:!0,className:"pr-10"}),e.jsx("button",{type:"button",onClick:()=>se(!ee),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:ee?e.jsx(C,{className:"w-4 h-4"}):e.jsx(P,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{type:te?"text":"password",value:J,onChange:e=>Q(e.target.value),placeholder:"Enter new password",disabled:V,required:!0,minLength:8,className:"pr-10"}),e.jsx("button",{type:"button",onClick:()=>ae(!te),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:te?e.jsx(C,{className:"w-4 h-4"}):e.jsx(P,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"At least 8 characters"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{type:re?"text":"password",value:X,onChange:e=>Z(e.target.value),placeholder:"Confirm new password",disabled:V,required:!0,minLength:8,className:"pr-10"}),e.jsx("button",{type:"button",onClick:()=>le(!re),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:re?e.jsx(C,{className:"w-4 h-4"}):e.jsx(P,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(r,{type:"submit",disabled:V,children:[V&&e.jsx(j,{className:"mr-2 h-4 w-4 animate-spin"}),V?"Updating...":"Update Password"]})})]})})]})]})]})};export{S as default};
