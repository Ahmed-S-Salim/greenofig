var e=Object.defineProperty,s=(s,t,a)=>(((s,t,a)=>{t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a})(s,"symbol"!=typeof t?t+"":t,a),a);import{j as t}from"./vendor-ui-fc6158c5.js";import{R as a,u as l,r}from"./vendor-react-c35372bd.js";import{B as i,s as n,t as o,a as c}from"./index-05318a06.js";import{C as d,a as m,b as h,c as u,e as x}from"./card-aef3fa8a.js";import{_ as p,az as g,L as j,F as f,Q as v,j as N,aj as b,$ as w,bj as y,ak as _,aO as C,T as k,n as P,k as S,a9 as D,z as E,X as M,l as A,a5 as $,a6 as z}from"./vendor-utils-1c344488.js";import{I as T}from"./input-a2afde68.js";import{T as V,a as F,b as L,c as R}from"./tabs-9cefe97b.js";import{C as I}from"./checkbox-4d0e9ce0.js";class q extends a.Component{constructor(e){super(e),s(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})}),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,s){this.setState({error:e,errorInfo:s})}render(){return this.state.hasError?t.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:t.jsxs(d,{className:"max-w-2xl w-full glass-effect",children:[t.jsx(m,{children:t.jsxs(h,{className:"flex items-center gap-3 text-2xl",children:[t.jsx(p,{className:"w-8 h-8 text-red-500"}),"Something Went Wrong"]})}),t.jsxs(u,{className:"space-y-4",children:[t.jsx("p",{className:"text-text-secondary",children:"We encountered an unexpected error. This has been logged and we'll look into it."}),this.state.error&&t.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-lg",children:t.jsx("p",{className:"font-mono text-sm text-red-400",children:this.state.error.toString()})}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs(i,{onClick:this.handleReset,className:"flex items-center gap-2",children:[t.jsx(g,{className:"w-4 h-4"}),"Try Again"]}),t.jsx(i,{variant:"outline",onClick:()=>{const e=window.location.hostname.includes("github.io")?"/greenofig":"";window.location.href=`${e}/app/admin`},children:"Go to Dashboard"})]}),!1]})]})}):this.props.children}}const B=({user:e})=>{const s=l(),[a,q]=r.useState([]),[B,O]=r.useState([]),[W,G]=r.useState([]),[K,Q]=r.useState(""),[U,H]=r.useState("all"),[J,X]=r.useState("all"),[Y,Z]=r.useState("all"),[ee,se]=r.useState(!0),[te,ae]=r.useState("posts"),[le,re]=r.useState([]),[ie,ne]=r.useState([]),[oe,ce]=r.useState([]),[de,me]=r.useState([]),[he,ue]=r.useState({totalPosts:0,publishedPosts:0,draftPosts:0,scheduledPosts:0,totalViews:0,totalComments:0,pendingComments:0,avgViewsPerPost:0});r.useEffect(()=>{xe(),pe(),ge(),je(),fe()},[]),r.useEffect(()=>{ve()},[K,U,J,Y,a]);const xe=async()=>{se(!0);try{const{data:e,error:s}=await n.from("blog_posts").select("\n          *,\n          author:user_profiles!blog_posts_author_id_fkey(id, full_name, email)\n        ").order("created_at",{ascending:!1});if(s)throw s;q(e||[])}catch(e){o({variant:"destructive",title:"Error",description:"Failed to fetch blog posts"})}finally{se(!1)}},pe=async()=>{try{const{data:e,error:s}=await n.from("blog_categories").select("*").order("name",{ascending:!0});if(s)throw s;O(e||[])}catch(e){}},ge=async()=>{try{const{data:e,error:s}=await n.from("user_profiles").select("id, full_name, email, role").in("role",["nutritionist","admin","super_admin"]).order("full_name",{ascending:!0});if(s)throw s;ne(e||[])}catch(e){}},je=async()=>{try{const{data:e,error:s}=await n.from("blog_comments").select("\n          *,\n          blog_post:blog_posts(title, slug),\n          user:user_profiles(full_name)\n        ").order("created_at",{ascending:!1});if(s)throw s;ce(e||[]),me((null==e?void 0:e.filter(e=>!e.is_approved))||[])}catch(e){}},fe=async()=>{try{const{data:e}=await n.from("blog_posts").select("status, view_count"),{data:s}=await n.from("blog_comments").select("is_approved");if(e){const t=e.reduce((e,s)=>e+(s.view_count||0),0),a={totalPosts:e.length,publishedPosts:e.filter(e=>"published"===e.status).length,draftPosts:e.filter(e=>"draft"===e.status).length,scheduledPosts:e.filter(e=>"scheduled"===e.status).length,totalViews:t,totalComments:(null==s?void 0:s.length)||0,pendingComments:(null==s?void 0:s.filter(e=>!e.is_approved).length)||0,avgViewsPerPost:e.length>0?Math.round(t/e.length):0};ue(a)}}catch(e){}},ve=()=>{let e=a;K&&(e=e.filter(e=>{var s,t;return(null==(s=e.title)?void 0:s.toLowerCase().includes(K.toLowerCase()))||(null==(t=e.excerpt)?void 0:t.toLowerCase().includes(K.toLowerCase()))})),"all"!==U&&(e=e.filter(e=>e.status===U)),"all"!==J&&(e=e.filter(e=>e.author_id===J)),"all"!==Y&&(e=e.filter(e=>e.category===Y)),G(e)},Ne=async e=>{if(0!==le.length)try{switch(e){case"publish":await n.from("blog_posts").update({status:"published",published_at:(new Date).toISOString()}).in("id",le),o({title:`Published ${le.length} posts`});break;case"draft":await n.from("blog_posts").update({status:"draft"}).in("id",le),o({title:`Moved ${le.length} posts to draft`});break;case"archive":await n.from("blog_posts").update({status:"archived"}).in("id",le),o({title:`Archived ${le.length} posts`});break;case"delete":confirm(`Delete ${le.length} posts permanently?`)&&(await n.from("blog_posts").delete().in("id",le),o({title:`Deleted ${le.length} posts`}))}re([]),xe(),fe()}catch(s){o({variant:"destructive",title:"Error",description:"Failed to perform bulk action"})}else o({variant:"destructive",title:"No posts selected",description:"Please select posts to perform bulk actions"})},be=({icon:e,title:s,value:a,change:l,color:r})=>t.jsx(d,{children:t.jsx(u,{className:"p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:s}),t.jsx("h3",{className:"text-3xl font-bold text-foreground",children:a}),l&&t.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400 mt-1 flex items-center gap-1",children:[t.jsx(k,{className:"w-4 h-4"}),l]})]}),t.jsx("div",{className:`p-4 rounded-full ${r||"bg-primary/10"}`,children:t.jsx(e,{className:"w-6 h-6 text-primary"})})]})})}),we=({post:a})=>{var l;const r=le.includes(a.id);return t.jsx(d,{className:"glass-effect hover:shadow-lg transition-all "+(r?"ring-2 ring-primary":""),children:t.jsxs(u,{className:"p-6",children:[t.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[t.jsx(I,{checked:r,onCheckedChange:()=>{return e=a.id,void re(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e]);var e}}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-semibold text-lg mb-1",children:a.title}),t.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:a.excerpt||"No excerpt"})]}),t.jsx(c,{className:{draft:"bg-gray-500",published:"bg-green-500",scheduled:"bg-blue-500",archived:"bg-red-500"}[a.status],children:a.status})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4 text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{className:"w-4 h-4 text-muted-foreground"}),t.jsx("span",{children:(null==(l=a.author)?void 0:l.full_name)||"Unknown"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(C,{className:"w-4 h-4 text-muted-foreground"}),t.jsxs("span",{children:[a.view_count||0," views"]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(P,{className:"w-4 h-4 text-muted-foreground"}),t.jsx("span",{children:a.published_at?D(new Date(a.published_at),"MMM d"):"Not published"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx($,{className:"w-4 h-4 text-muted-foreground"}),t.jsx("span",{children:a.focus_keyword||"No keyword"})]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(i,{variant:"outline",size:"sm",onClick:()=>{const t="nutritionist"===(null==e?void 0:e.role)?"nutritionist":"admin";s(`/app/${t}/blog/edit/${a.id}`)},className:"flex-1",children:[t.jsx(z,{className:"w-4 h-4 mr-1"}),"Edit"]}),t.jsx(i,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this post?"))try{const{error:s}=await n.from("blog_posts").delete().eq("id",e);if(s)throw s;o({title:"Post deleted successfully"}),xe(),fe()}catch(s){o({variant:"destructive",title:"Error",description:"Failed to delete post"})}})(a.id),className:"text-destructive",children:t.jsx(_,{className:"w-4 h-4"})}),"published"===a.status&&t.jsx(i,{variant:"outline",size:"sm",onClick:()=>{const e=window.location.hostname.includes("github.io")?"/greenofig":"";window.open(`${e}/blog/${a.slug}`,"_blank")},children:t.jsx(C,{className:"w-4 h-4"})})]})]})})};return ee?t.jsx("div",{className:"flex items-center justify-center h-96",children:t.jsx(j,{className:"w-12 h-12 animate-spin text-primary"})}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[t.jsx(f,{className:"w-8 h-8 text-primary"}),"Blog Management"]}),t.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage all blog posts, categories, and comments"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(i,{variant:"outline",onClick:xe,children:[t.jsx(g,{className:"w-4 h-4 mr-2"}),"Refresh"]}),t.jsxs(i,{onClick:()=>{const t="nutritionist"===(null==e?void 0:e.role)?"nutritionist":"admin";s(`/app/${t}/blog/new`)},children:[t.jsx(v,{className:"w-4 h-4 mr-2"}),"Create Post"]})]})]}),t.jsxs(V,{value:te,onValueChange:ae,children:[t.jsxs(F,{className:"grid w-full grid-cols-4",children:[t.jsxs(L,{value:"posts",children:["Posts (",he.totalPosts,")"]}),t.jsxs(L,{value:"analytics",children:[t.jsx(N,{className:"w-4 h-4 mr-1"}),"Analytics"]}),t.jsxs(L,{value:"categories",children:["Categories (",B.length,")"]}),t.jsxs(L,{value:"comments",children:["Comments (",he.pendingComments," pending)"]})]}),t.jsxs(R,{value:"posts",className:"space-y-4",children:[t.jsx(d,{className:"glass-effect",children:t.jsx(u,{className:"p-4",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(b,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),t.jsx(T,{placeholder:"Search posts...",value:K,onChange:e=>Q(e.target.value),className:"pl-10"})]}),t.jsxs("select",{value:U,onChange:e=>H(e.target.value),className:"px-3 py-2 bg-background border border-border rounded-md",children:[t.jsx("option",{value:"all",children:"All Status"}),t.jsx("option",{value:"published",children:"Published"}),t.jsx("option",{value:"draft",children:"Draft"}),t.jsx("option",{value:"scheduled",children:"Scheduled"}),t.jsx("option",{value:"archived",children:"Archived"})]}),t.jsxs("select",{value:J,onChange:e=>X(e.target.value),className:"px-3 py-2 bg-background border border-border rounded-md",children:[t.jsx("option",{value:"all",children:"All Authors"}),ie.map(e=>t.jsx("option",{value:e.id,children:e.full_name},e.id))]}),t.jsxs("select",{value:Y,onChange:e=>Z(e.target.value),className:"px-3 py-2 bg-background border border-border rounded-md",children:[t.jsx("option",{value:"all",children:"All Categories"}),B.map(e=>t.jsx("option",{value:e.slug,children:e.name},e.id))]})]}),le.length>0&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-primary/10 rounded-lg",children:[t.jsxs("span",{className:"text-sm font-medium",children:[le.length," posts selected"]}),t.jsxs("div",{className:"flex gap-2 ml-auto",children:[t.jsxs(i,{size:"sm",variant:"outline",onClick:()=>Ne("publish"),children:[t.jsx(w,{className:"w-4 h-4 mr-1"}),"Publish"]}),t.jsxs(i,{size:"sm",variant:"outline",onClick:()=>Ne("draft"),children:[t.jsx(f,{className:"w-4 h-4 mr-1"}),"Draft"]}),t.jsxs(i,{size:"sm",variant:"outline",onClick:()=>Ne("archive"),children:[t.jsx(y,{className:"w-4 h-4 mr-1"}),"Archive"]}),t.jsxs(i,{size:"sm",variant:"outline",onClick:()=>Ne("delete"),className:"text-destructive",children:[t.jsx(_,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(I,{checked:le.length===W.length&&W.length>0,onCheckedChange:()=>{le.length===W.length?re([]):re(W.map(e=>e.id))}}),t.jsxs("span",{className:"text-sm text-muted-foreground",children:["Select All (",W.length," posts)"]})]})]})})}),W.length>0?t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:W.map(e=>t.jsx(we,{post:e},e.id))}):t.jsx(d,{className:"glass-effect",children:t.jsxs(u,{className:"p-12 text-center",children:[t.jsx(f,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No posts found"}),t.jsx("p",{className:"text-muted-foreground",children:K||"all"!==U?"Try adjusting your filters":"No blog posts yet"})]})})]}),t.jsxs(R,{value:"analytics",className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[t.jsx(be,{icon:f,title:"Total Posts",value:he.totalPosts}),t.jsx(be,{icon:w,title:"Published",value:he.publishedPosts}),t.jsx(be,{icon:C,title:"Total Views",value:he.totalViews.toLocaleString()}),t.jsx(be,{icon:k,title:"Avg Views/Post",value:he.avgViewsPerPost})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[t.jsx(be,{icon:f,title:"Drafts",value:he.draftPosts}),t.jsx(be,{icon:P,title:"Scheduled",value:he.scheduledPosts}),t.jsx(be,{icon:S,title:"Total Comments",value:he.totalComments}),t.jsx(be,{icon:p,title:"Pending Comments",value:he.pendingComments})]}),t.jsxs(d,{children:[t.jsx(m,{children:t.jsx(h,{children:"Top Performing Posts"})}),t.jsx(u,{children:t.jsx("div",{className:"space-y-3",children:a.filter(e=>"published"===e.status).sort((e,s)=>(s.view_count||0)-(e.view_count||0)).slice(0,10).map((e,s)=>{var a;return t.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 text-primary font-bold",children:s+1}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium",children:e.title}),t.jsx("p",{className:"text-sm text-muted-foreground",children:null==(a=e.author)?void 0:a.full_name})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"font-bold",children:e.view_count||0}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"views"})]})]},e.id)})})})]})]}),t.jsx(R,{value:"categories",className:"space-y-4",children:t.jsxs(d,{children:[t.jsxs(m,{children:[t.jsx(h,{children:"Blog Categories"}),t.jsx(x,{children:"Manage content categories"})]}),t.jsx(u,{children:t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:B.map(e=>t.jsxs("div",{className:"p-4 bg-card border border-border rounded-lg",children:[t.jsx("h3",{className:"font-semibold mb-1",children:e.name}),t.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:e.description||"No description"}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("span",{className:"text-xs text-muted-foreground",children:[a.filter(s=>s.category===e.slug).length," posts"]}),t.jsx(c,{variant:"outline",children:e.slug})]})]},e.id))})})]})}),t.jsxs(R,{value:"comments",className:"space-y-4",children:[t.jsxs(d,{children:[t.jsxs(m,{children:[t.jsxs(h,{children:["Pending Comments (",de.length,")"]}),t.jsx(x,{children:"Review and moderate comments"})]}),t.jsx(u,{children:de.length>0?t.jsx("div",{className:"space-y-3",children:de.map(e=>{var s,a;return t.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg",children:[t.jsxs("div",{className:"flex items-start justify-between mb-2",children:[t.jsxs("div",{children:[t.jsx("p",{className:"font-medium",children:e.author_name||(null==(s=e.user)?void 0:s.full_name)}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:['on "',null==(a=e.blog_post)?void 0:a.title,'"']})]}),t.jsx("span",{className:"text-xs text-muted-foreground",children:D(new Date(e.created_at),"MMM d, yyyy")})]}),t.jsx("p",{className:"text-sm mb-3",children:e.content}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(i,{size:"sm",onClick:()=>(async e=>{try{const{error:s}=await n.from("blog_comments").update({is_approved:!0}).eq("id",e);if(s)throw s;o({title:"Comment approved"}),je(),fe()}catch(s){o({variant:"destructive",title:"Error",description:"Failed to approve comment"})}})(e.id),children:[t.jsx(E,{className:"w-4 h-4 mr-1"}),"Approve"]}),t.jsxs(i,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(confirm("Delete this comment?"))try{const{error:s}=await n.from("blog_comments").delete().eq("id",e);if(s)throw s;o({title:"Comment deleted"}),je(),fe()}catch(s){o({variant:"destructive",title:"Error",description:"Failed to delete comment"})}})(e.id),children:[t.jsx(M,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]},e.id)})}):t.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No pending comments"})})]}),t.jsxs(d,{children:[t.jsx(m,{children:t.jsx(h,{children:"Recent Comments"})}),t.jsx(u,{children:t.jsx("div",{className:"space-y-3",children:oe.filter(e=>e.is_approved).slice(0,10).map(e=>{var s,a;return t.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg",children:[t.jsxs("div",{className:"flex items-start justify-between mb-1",children:[t.jsx("p",{className:"font-medium text-sm",children:e.author_name||(null==(s=e.user)?void 0:s.full_name)}),t.jsx("span",{className:"text-xs text-muted-foreground",children:D(new Date(e.created_at),"MMM d")})]}),t.jsxs("p",{className:"text-sm text-muted-foreground mb-1",children:['on "',null==(a=e.blog_post)?void 0:a.title,'"']}),t.jsx("p",{className:"text-sm",children:e.content})]},e.id)})})})]})]})]})]})};export{q as E,B as a};
