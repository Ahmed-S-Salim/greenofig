import{j as e}from"./vendor-ui-5701c8ab.js";import{r as t,k as s,u as n}from"./vendor-react-c35372bd.js";import{B as o,L as l,I as r,a,t as i,u as c,T as d,s as h}from"./index-8b14cb79.js";import{C as u,a as p,b as m,c as f}from"./card-dd4d8de1.js";import{S as g}from"./switch-c279a85e.js";import{T as x,a as b,b as w,c as y}from"./tabs-70057a82.js";import{S as v,a as j,b as C,c as N,d as S}from"./select-0f6e4c1b.js";import{E as A,M as k,m as M,a as T,b as z,P as H,S as L,k as $,c as R,T as E,F,d as _,e as O,D as I,f as D,N as B,g as P,h as W,i as G,j as K,l as q,u as U,n as V,U as J,o as Y,p as X,q as Z,r as Q,s as ee}from"./vendor-editor-1616b420.js";import{D as te,a as se,b as ne,d as oe,e as le}from"./dropdown-menu-ca3146b1.js";import{D as re,e as ae,a as ie,b as ce,c as de}from"./dialog-da002b66.js";import{bp as he,a0 as ue,bq as pe,br as me,bs as fe,bt as ge,bu as xe,bv as be,bw as we,b0 as ye,bx as ve,by as je,bz as Ce,bA as Ne,bB as Se,bC as Ae,bD as ke,bE as Me,bF as Te,bG as ze,bH as He,bI as Le,bJ as $e,au as Re,bK as Ee,bL as Fe,bM as _e,bj as Oe,bN as Ie,bO as De,at as Be,K as Pe,r as We,U as Ge,L as Ke,h as qe,aI as Ue,S as Ve,bh as Je,V as Ye,m as Xe,A as Ze,aW as Qe,as as et,X as tt,R as st,w as nt,bP as ot,aV as lt,_ as rt}from"./vendor-utils-278148e0.js";var at=A.create({name:"textAlign",addOptions:()=>({types:[],alignments:["left","center","right","justify"],defaultAlignment:null}),addGlobalAttributes(){return[{types:this.options.types,attributes:{textAlign:{default:this.options.defaultAlignment,parseHTML:e=>{const t=e.style.textAlign;return this.options.alignments.includes(t)?t:this.options.defaultAlignment},renderHTML:e=>e.textAlign?{style:`text-align: ${e.textAlign}`}:{}}}}]},addCommands(){return{setTextAlign:e=>({commands:t})=>!!this.options.alignments.includes(e)&&this.options.types.map(s=>t.updateAttributes(s,{textAlign:e})).every(e=>e),unsetTextAlign:()=>({commands:e})=>this.options.types.map(t=>e.resetAttributes(t,"textAlign")).every(e=>e),toggleTextAlign:e=>({editor:t,commands:s})=>!!this.options.alignments.includes(e)&&(t.isActive({textAlign:e})?s.unsetTextAlign():s.setTextAlign(e))}},addKeyboardShortcuts(){return{"Mod-Shift-l":()=>this.editor.commands.setTextAlign("left"),"Mod-Shift-e":()=>this.editor.commands.setTextAlign("center"),"Mod-Shift-r":()=>this.editor.commands.setTextAlign("right"),"Mod-Shift-j":()=>this.editor.commands.setTextAlign("justify")}}}),it=(e,t=0)=>{const s=[];return!e.children.length||t>20||Array.from(e.children).forEach(e=>{"SPAN"===e.tagName?s.push(e):e.children.length&&s.push(...it(e,t+1))}),s},ct=k.create({name:"textStyle",priority:101,addOptions:()=>({HTMLAttributes:{},mergeNestedSpanStyles:!0}),parseHTML(){return[{tag:"span",consuming:!1,getAttrs:e=>!!e.hasAttribute("style")&&(this.options.mergeNestedSpanStyles&&(e=>{if(!e.children.length)return;const t=it(e);t&&t.forEach(e=>{var t,s;const n=e.getAttribute("style"),o=null==(s=null==(t=e.parentElement)?void 0:t.closest("span"))?void 0:s.getAttribute("style");e.setAttribute("style",`${o};${n}`)})})(e),{})}]},renderHTML({HTMLAttributes:e}){return["span",M(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleTextStyle:e=>({commands:t})=>t.toggleMark(this.name,e),removeEmptyTextStyle:()=>({tr:e})=>{const{selection:t}=e;return e.doc.nodesBetween(t.from,t.to,(t,s)=>{if(t.isTextblock)return!0;t.marks.filter(e=>e.type===this.type).some(e=>Object.values(e.attrs).some(e=>!!e))||e.removeMark(s,s+t.nodeSize,this.type)}),!0}}}}),dt=A.create({name:"backgroundColor",addOptions:()=>({types:["textStyle"]}),addGlobalAttributes(){return[{types:this.options.types,attributes:{backgroundColor:{default:null,parseHTML:e=>{var t;const s=e.getAttribute("style");if(s){const e=s.split(";").map(e=>e.trim()).filter(Boolean);for(let t=e.length-1;t>=0;t-=1){const s=e[t].split(":");if(s.length>=2){const e=s[0].trim().toLowerCase(),t=s.slice(1).join(":").trim();if("background-color"===e)return t.replace(/['"]+/g,"")}}}return null==(t=e.style.backgroundColor)?void 0:t.replace(/['"]+/g,"")},renderHTML:e=>e.backgroundColor?{style:`background-color: ${e.backgroundColor}`}:{}}}}]},addCommands:()=>({setBackgroundColor:e=>({chain:t})=>t().setMark("textStyle",{backgroundColor:e}).run(),unsetBackgroundColor:()=>({chain:e})=>e().setMark("textStyle",{backgroundColor:null}).removeEmptyTextStyle().run()})}),ht=A.create({name:"color",addOptions:()=>({types:["textStyle"]}),addGlobalAttributes(){return[{types:this.options.types,attributes:{color:{default:null,parseHTML:e=>{var t;const s=e.getAttribute("style");if(s){const e=s.split(";").map(e=>e.trim()).filter(Boolean);for(let t=e.length-1;t>=0;t-=1){const s=e[t].split(":");if(s.length>=2){const e=s[0].trim().toLowerCase(),t=s.slice(1).join(":").trim();if("color"===e)return t.replace(/['"]+/g,"")}}}return null==(t=e.style.color)?void 0:t.replace(/['"]+/g,"")},renderHTML:e=>e.color?{style:`color: ${e.color}`}:{}}}}]},addCommands:()=>({setColor:e=>({chain:t})=>t().setMark("textStyle",{color:e}).run(),unsetColor:()=>({chain:e})=>e().setMark("textStyle",{color:null}).removeEmptyTextStyle().run()})}),ut=A.create({name:"fontFamily",addOptions:()=>({types:["textStyle"]}),addGlobalAttributes(){return[{types:this.options.types,attributes:{fontFamily:{default:null,parseHTML:e=>e.style.fontFamily,renderHTML:e=>e.fontFamily?{style:`font-family: ${e.fontFamily}`}:{}}}}]},addCommands:()=>({setFontFamily:e=>({chain:t})=>t().setMark("textStyle",{fontFamily:e}).run(),unsetFontFamily:()=>({chain:e})=>e().setMark("textStyle",{fontFamily:null}).removeEmptyTextStyle().run()})}),pt=A.create({name:"fontSize",addOptions:()=>({types:["textStyle"]}),addGlobalAttributes(){return[{types:this.options.types,attributes:{fontSize:{default:null,parseHTML:e=>e.style.fontSize,renderHTML:e=>e.fontSize?{style:`font-size: ${e.fontSize}`}:{}}}}]},addCommands:()=>({setFontSize:e=>({chain:t})=>t().setMark("textStyle",{fontSize:e}).run(),unsetFontSize:()=>({chain:e})=>e().setMark("textStyle",{fontSize:null}).removeEmptyTextStyle().run()})}),mt=A.create({name:"lineHeight",addOptions:()=>({types:["textStyle"]}),addGlobalAttributes(){return[{types:this.options.types,attributes:{lineHeight:{default:null,parseHTML:e=>e.style.lineHeight,renderHTML:e=>e.lineHeight?{style:`line-height: ${e.lineHeight}`}:{}}}}]},addCommands:()=>({setLineHeight:e=>({chain:t})=>t().setMark("textStyle",{lineHeight:e}).run(),unsetLineHeight:()=>({chain:e})=>e().setMark("textStyle",{lineHeight:null}).removeEmptyTextStyle().run()})});A.create({name:"textStyleKit",addExtensions(){const e=[];return!1!==this.options.backgroundColor&&e.push(dt.configure(this.options.backgroundColor)),!1!==this.options.color&&e.push(ht.configure(this.options.color)),!1!==this.options.fontFamily&&e.push(ut.configure(this.options.fontFamily)),!1!==this.options.fontSize&&e.push(pt.configure(this.options.fontSize)),!1!==this.options.lineHeight&&e.push(mt.configure(this.options.lineHeight)),!1!==this.options.textStyle&&e.push(ct.configure(this.options.textStyle)),e}});var ft,gt,xt=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))$/,bt=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))/g,wt=k.create({name:"highlight",addOptions:()=>({multicolor:!1,HTMLAttributes:{}}),addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:e=>e.getAttribute("data-color")||e.style.backgroundColor,renderHTML:e=>e.color?{"data-color":e.color,style:`background-color: ${e.color}; color: inherit`}:{}}}:{}},parseHTML:()=>[{tag:"mark"}],renderHTML({HTMLAttributes:e}){return["mark",M(this.options.HTMLAttributes,e),0]},renderMarkdown:(e,t)=>`==${t.renderChildren(e)}==`,parseMarkdown:(e,t)=>t.applyMark("highlight",t.parseInline(e.tokens||[])),markdownTokenizer:{name:"highlight",level:"inline",start:e=>e.indexOf("=="),tokenize(e,t,s){const n=/^(==)([^=]+)(==)/.exec(e);if(n){const e=n[2].trim(),t=s.inlineTokens(e);return{type:"highlight",raw:n[0],text:e,tokens:t}}}},addCommands(){return{setHighlight:e=>({commands:t})=>t.setMark(this.name,e),toggleHighlight:e=>({commands:t})=>t.toggleMark(this.name,e),unsetHighlight:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[T({find:xt,type:this.type})]},addPasteRules(){return[z({find:bt,type:this.type})]}});if("undefined"!=typeof WeakMap){let e=new WeakMap;ft=t=>e.get(t),gt=(t,s)=>(e.set(t,s),s)}else{const e=[],t=10;let s=0;ft=t=>{for(let s=0;s<e.length;s+=2)if(e[s]==t)return e[s+1]},gt=(n,o)=>(s==t&&(s=0),e[s++]=n,e[s++]=o)}var yt=class{constructor(e,t,s,n){this.width=e,this.height=t,this.map=s,this.problems=n}findCell(e){for(let t=0;t<this.map.length;t++){const s=this.map[t];if(s!=e)continue;const n=t%this.width,o=t/this.width|0;let l=n+1,r=o+1;for(let e=1;l<this.width&&this.map[t+e]==s;e++)l++;for(let e=1;r<this.height&&this.map[t+this.width*e]==s;e++)r++;return{left:n,top:o,right:l,bottom:r}}throw new RangeError(`No cell with offset ${e} found`)}colCount(e){for(let t=0;t<this.map.length;t++)if(this.map[t]==e)return t%this.width;throw new RangeError(`No cell with offset ${e} found`)}nextCell(e,t,s){const{left:n,right:o,top:l,bottom:r}=this.findCell(e);return"horiz"==t?(s<0?0==n:o==this.width)?null:this.map[l*this.width+(s<0?n-1:o)]:(s<0?0==l:r==this.height)?null:this.map[n+this.width*(s<0?l-1:r)]}rectBetween(e,t){const{left:s,right:n,top:o,bottom:l}=this.findCell(e),{left:r,right:a,top:i,bottom:c}=this.findCell(t);return{left:Math.min(s,r),top:Math.min(o,i),right:Math.max(n,a),bottom:Math.max(l,c)}}cellsInRect(e){const t=[],s={};for(let n=e.top;n<e.bottom;n++)for(let o=e.left;o<e.right;o++){const l=n*this.width+o,r=this.map[l];s[r]||(s[r]=!0,o==e.left&&o&&this.map[l-1]==r||n==e.top&&n&&this.map[l-this.width]==r||t.push(r))}return t}positionAt(e,t,s){for(let n=0,o=0;;n++){const l=o+s.child(n).nodeSize;if(n==e){let s=t+e*this.width;const n=(e+1)*this.width;for(;s<n&&this.map[s]<o;)s++;return s==n?l-1:this.map[s]}o=l}}static get(e){return ft(e)||gt(e,function(e){if("table"!=e.type.spec.tableRole)throw new RangeError("Not a table node: "+e.type.name);const t=function(e){let t=-1,s=!1;for(let n=0;n<e.childCount;n++){const o=e.child(n);let l=0;if(s)for(let t=0;t<n;t++){const s=e.child(t);for(let e=0;e<s.childCount;e++){const o=s.child(e);t+o.attrs.rowspan>n&&(l+=o.attrs.colspan)}}for(let e=0;e<o.childCount;e++){const t=o.child(e);l+=t.attrs.colspan,t.attrs.rowspan>1&&(s=!0)}-1==t?t=l:t!=l&&(t=Math.max(t,l))}return t}(e),s=e.childCount,n=[];let o=0,l=null;const r=[];for(let c=0,d=t*s;c<d;c++)n[c]=0;for(let c=0,d=0;c<s;c++){const a=e.child(c);d++;for(let e=0;;e++){for(;o<n.length&&0!=n[o];)o++;if(e==a.childCount)break;const i=a.child(e),{colspan:h,rowspan:u,colwidth:p}=i.attrs;for(let e=0;e<u;e++){if(e+c>=s){(l||(l=[])).push({type:"overlong_rowspan",pos:d,n:u-e});break}const a=o+e*t;for(let e=0;e<h;e++){0==n[a+e]?n[a+e]=d:(l||(l=[])).push({type:"collision",row:c,pos:d,n:h-e});const s=p&&p[e];if(s){const n=(a+e)%t*2,o=r[n];null==o||o!=s&&1==r[n+1]?(r[n]=s,r[n+1]=1):o==s&&r[n+1]++}}}o+=h,d+=i.nodeSize}const i=(c+1)*t;let h=0;for(;o<i;)0==n[o++]&&h++;h&&(l||(l=[])).push({type:"missing",row:c,n:h}),d++}0!==t&&0!==s||(l||(l=[])).push({type:"zero_sized"});const a=new yt(t,s,n,l);let i=!1;for(let c=0;!i&&c<r.length;c+=2)null!=r[c]&&r[c+1]<s&&(i=!0);i&&function(e,t,s){e.problems||(e.problems=[]);const n={};for(let o=0;o<e.map.length;o++){const l=e.map[o];if(n[l])continue;n[l]=!0;const r=s.nodeAt(l);if(!r)throw new RangeError(`No cell with offset ${l} found`);let a=null;const i=r.attrs;for(let s=0;s<i.colspan;s++){const n=t[2*((o+s)%e.width)];null==n||i.colwidth&&i.colwidth[s]==n||((a||(a=vt(i)))[s]=n)}a&&e.problems.unshift({type:"colwidth mismatch",pos:l,colwidth:a})}}(a,r,e);return a}(e))}};function vt(e){if(e.colwidth)return e.colwidth.slice();const t=[];for(let s=0;s<e.colspan;s++)t.push(0);return t}function jt(e){let t=e.cached.tableNodeTypes;if(!t){t=e.cached.tableNodeTypes={};for(const s in e.nodes){const n=e.nodes[s],o=n.spec.tableRole;o&&(t[o]=n)}}return t}var Ct=new H("selectingCells");function Nt(e){for(let t=e.depth-1;t>0;t--)if("row"==e.node(t).type.spec.tableRole)return e.node(0).resolve(e.before(t+1));return null}function St(e){const t=e.selection.$head;for(let s=t.depth;s>0;s--)if("row"==t.node(s).type.spec.tableRole)return!0;return!1}function At(e){const t=e.selection;if("$anchorCell"in t&&t.$anchorCell)return t.$anchorCell.pos>t.$headCell.pos?t.$anchorCell:t.$headCell;if("node"in t&&t.node&&"cell"==t.node.type.spec.tableRole)return t.$anchor;const s=Nt(t.$head)||function(e){for(let t=e.nodeAfter,s=e.pos;t;t=t.firstChild,s++){const n=t.type.spec.tableRole;if("cell"==n||"header_cell"==n)return e.doc.resolve(s)}for(let t=e.nodeBefore,s=e.pos;t;t=t.lastChild,s--){const n=t.type.spec.tableRole;if("cell"==n||"header_cell"==n)return e.doc.resolve(s-t.nodeSize)}}(t.$head);if(s)return s;throw new RangeError(`No cell found around position ${t.head}`)}function kt(e){return"row"==e.parent.type.spec.tableRole&&!!e.nodeAfter}function Mt(e,t){return e.depth==t.depth&&e.pos>=t.start(-1)&&e.pos<=t.end(-1)}function Tt(e,t,s){const n=e.node(-1),o=yt.get(n),l=e.start(-1),r=o.nextCell(e.pos-l,t,s);return null==r?null:e.node(0).resolve(l+r)}function zt(e,t,s=1){const n={...e,colspan:e.colspan-s};return n.colwidth&&(n.colwidth=n.colwidth.slice(),n.colwidth.splice(t,s),n.colwidth.some(e=>e>0)||(n.colwidth=null)),n}function Ht(e,t,s=1){const n={...e,colspan:e.colspan+s};if(n.colwidth){n.colwidth=n.colwidth.slice();for(let e=0;e<s;e++)n.colwidth.splice(t,0,0)}return n}var Lt=class e extends L{constructor(e,t=e){const s=e.node(-1),n=yt.get(s),o=e.start(-1),l=n.rectBetween(e.pos-o,t.pos-o),r=e.node(0),a=n.cellsInRect(l).filter(e=>e!=t.pos-o);a.unshift(t.pos-o);const i=a.map(e=>{const t=s.nodeAt(e);if(!t)throw RangeError(`No cell with offset ${e} found`);const n=o+e+1;return new R(r.resolve(n),r.resolve(n+t.content.size))});super(i[0].$from,i[0].$to,i),this.$anchorCell=e,this.$headCell=t}map(t,s){const n=t.resolve(s.map(this.$anchorCell.pos)),o=t.resolve(s.map(this.$headCell.pos));if(kt(n)&&kt(o)&&Mt(n,o)){const t=this.$anchorCell.node(-1)!=n.node(-1);return t&&this.isRowSelection()?e.rowSelection(n,o):t&&this.isColSelection()?e.colSelection(n,o):new e(n,o)}return E.between(n,o)}content(){const e=this.$anchorCell.node(-1),t=yt.get(e),s=this.$anchorCell.start(-1),n=t.rectBetween(this.$anchorCell.pos-s,this.$headCell.pos-s),o={},l=[];for(let a=n.top;a<n.bottom;a++){const s=[];for(let l=a*t.width+n.left,r=n.left;r<n.right;r++,l++){const r=t.map[l];if(o[r])continue;o[r]=!0;const a=t.findCell(r);let i=e.nodeAt(r);if(!i)throw RangeError(`No cell with offset ${r} found`);const c=n.left-a.left,d=a.right-n.right;if(c>0||d>0){let e=i.attrs;if(c>0&&(e=zt(e,0,c)),d>0&&(e=zt(e,e.colspan-d,d)),a.left<n.left){if(i=i.type.createAndFill(e),!i)throw RangeError(`Could not create cell with attrs ${JSON.stringify(e)}`)}else i=i.type.create(e,i.content)}if(a.top<n.top||a.bottom>n.bottom){const e={...i.attrs,rowspan:Math.min(a.bottom,n.bottom)-Math.max(a.top,n.top)};i=a.top<n.top?i.type.createAndFill(e):i.type.create(e,i.content)}s.push(i)}l.push(e.child(a).copy(F.from(s)))}const r=this.isColSelection()&&this.isRowSelection()?e:l;return new _(F.from(r),1,1)}replace(e,t=_.empty){const s=e.steps.length,n=this.ranges;for(let l=0;l<n.length;l++){const{$from:o,$to:r}=n[l],a=e.mapping.slice(s);e.replace(a.map(o.pos),a.map(r.pos),l?_.empty:t)}const o=L.findFrom(e.doc.resolve(e.mapping.slice(s).map(this.to)),-1);o&&e.setSelection(o)}replaceWith(e,t){this.replace(e,new _(F.from(t),0,0))}forEachCell(e){const t=this.$anchorCell.node(-1),s=yt.get(t),n=this.$anchorCell.start(-1),o=s.cellsInRect(s.rectBetween(this.$anchorCell.pos-n,this.$headCell.pos-n));for(let l=0;l<o.length;l++)e(t.nodeAt(o[l]),n+o[l])}isColSelection(){const e=this.$anchorCell.index(-1),t=this.$headCell.index(-1);if(Math.min(e,t)>0)return!1;const s=e+this.$anchorCell.nodeAfter.attrs.rowspan,n=t+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(s,n)==this.$headCell.node(-1).childCount}static colSelection(t,s=t){const n=t.node(-1),o=yt.get(n),l=t.start(-1),r=o.findCell(t.pos-l),a=o.findCell(s.pos-l),i=t.node(0);return r.top<=a.top?(r.top>0&&(t=i.resolve(l+o.map[r.left])),a.bottom<o.height&&(s=i.resolve(l+o.map[o.width*(o.height-1)+a.right-1]))):(a.top>0&&(s=i.resolve(l+o.map[a.left])),r.bottom<o.height&&(t=i.resolve(l+o.map[o.width*(o.height-1)+r.right-1]))),new e(t,s)}isRowSelection(){const e=this.$anchorCell.node(-1),t=yt.get(e),s=this.$anchorCell.start(-1),n=t.colCount(this.$anchorCell.pos-s),o=t.colCount(this.$headCell.pos-s);if(Math.min(n,o)>0)return!1;const l=n+this.$anchorCell.nodeAfter.attrs.colspan,r=o+this.$headCell.nodeAfter.attrs.colspan;return Math.max(l,r)==t.width}eq(t){return t instanceof e&&t.$anchorCell.pos==this.$anchorCell.pos&&t.$headCell.pos==this.$headCell.pos}static rowSelection(t,s=t){const n=t.node(-1),o=yt.get(n),l=t.start(-1),r=o.findCell(t.pos-l),a=o.findCell(s.pos-l),i=t.node(0);return r.left<=a.left?(r.left>0&&(t=i.resolve(l+o.map[r.top*o.width])),a.right<o.width&&(s=i.resolve(l+o.map[o.width*(a.top+1)-1]))):(a.left>0&&(s=i.resolve(l+o.map[a.top*o.width])),r.right<o.width&&(t=i.resolve(l+o.map[o.width*(r.top+1)-1]))),new e(t,s)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(t,s){return new e(t.resolve(s.anchor),t.resolve(s.head))}static create(t,s,n=s){return new e(t.resolve(s),t.resolve(n))}getBookmark(){return new $t(this.$anchorCell.pos,this.$headCell.pos)}};Lt.prototype.visible=!1,L.jsonID("cell",Lt);var $t=class e{constructor(e,t){this.anchor=e,this.head=t}map(t){return new e(t.map(this.anchor),t.map(this.head))}resolve(e){const t=e.resolve(this.anchor),s=e.resolve(this.head);return"row"==t.parent.type.spec.tableRole&&"row"==s.parent.type.spec.tableRole&&t.index()<t.parent.childCount&&s.index()<s.parent.childCount&&Mt(t,s)?new Lt(t,s):L.near(s,1)}};function Rt(e){if(!(e.selection instanceof Lt))return null;const t=[];return e.selection.forEachCell((e,s)=>{t.push(D.node(s,s+e.nodeSize,{class:"selectedCell"}))}),I.create(e.doc,t)}var Et=new H("fix-tables");function Ft(e,t,s,n){const o=e.childCount,l=t.childCount;e:for(let r=0,a=0;r<l;r++){const l=t.child(r);for(let t=a,n=Math.min(o,r+3);t<n;t++)if(e.child(t)==l){a=t+1,s+=l.nodeSize;continue e}n(l,s),a<o&&e.child(a).sameMarkup(l)?Ft(e.child(a),l,s+1,n):l.nodesBetween(0,l.content.size,n,s+1),s+=l.nodeSize}}function _t(e,t){let s;const n=(t,n)=>{"table"==t.type.spec.tableRole&&(s=function(e,t,s,n){const o=yt.get(t);if(!o.problems)return n;n||(n=e.tr);const l=[];for(let i=0;i<o.height;i++)l.push(0);for(let i=0;i<o.problems.length;i++){const e=o.problems[i];if("collision"==e.type){const o=t.nodeAt(e.pos);if(!o)continue;const r=o.attrs;for(let t=0;t<r.rowspan;t++)l[e.row+t]+=e.n;n.setNodeMarkup(n.mapping.map(s+1+e.pos),null,zt(r,r.colspan-e.n,e.n))}else if("missing"==e.type)l[e.row]+=e.n;else if("overlong_rowspan"==e.type){const o=t.nodeAt(e.pos);if(!o)continue;n.setNodeMarkup(n.mapping.map(s+1+e.pos),null,{...o.attrs,rowspan:o.attrs.rowspan-e.n})}else if("colwidth mismatch"==e.type){const o=t.nodeAt(e.pos);if(!o)continue;n.setNodeMarkup(n.mapping.map(s+1+e.pos),null,{...o.attrs,colwidth:e.colwidth})}else if("zero_sized"==e.type){const e=n.mapping.map(s);n.delete(e,e+t.nodeSize)}}let r,a;for(let i=0;i<l.length;i++)l[i]&&(null==r&&(r=i),a=i);for(let i=0,c=s+1;i<o.height;i++){const s=t.child(i),o=c+s.nodeSize,d=l[i];if(d>0){let t="cell";s.firstChild&&(t=s.firstChild.type.spec.tableRole);const l=[];for(let s=0;s<d;s++){const s=jt(e.schema)[t].createAndFill();s&&l.push(s)}const h=0!=i&&r!=i-1||a!=i?o-1:c+1;n.insert(n.mapping.map(h),l)}c=o}return n.setMeta(Et,{fixTables:!0})}(e,t,n,s))};return t?t.doc!=e.doc&&Ft(t.doc,e.doc,0,n):e.doc.descendants(n),s}function Ot(e){const t=e.selection,s=At(e),n=s.node(-1),o=s.start(-1),l=yt.get(n);return{...t instanceof Lt?l.rectBetween(t.$anchorCell.pos-o,t.$headCell.pos-o):l.findCell(s.pos-o),tableStart:o,map:l,table:n}}function It(e,{map:t,tableStart:s,table:n},o){let l=o>0?-1:0;(function(e,t,s){const n=jt(t.type.schema).header_cell;for(let o=0;o<e.height;o++)if(t.nodeAt(e.map[s+o*e.width]).type!=n)return!1;return!0})(t,n,o+l)&&(l=0==o||o==t.width?null:0);for(let r=0;r<t.height;r++){const a=r*t.width+o;if(o>0&&o<t.width&&t.map[a-1]==t.map[a]){const l=t.map[a],i=n.nodeAt(l);e.setNodeMarkup(e.mapping.map(s+l),null,Ht(i.attrs,o-t.colCount(l))),r+=i.attrs.rowspan-1}else{const i=null==l?jt(n.type.schema).cell:n.nodeAt(t.map[a+l]).type,c=t.positionAt(r,o,n);e.insert(e.mapping.map(s+c),i.createAndFill())}}return e}function Dt(e,{map:t,table:s,tableStart:n},o){const l=e.mapping.maps.length;for(let r=0;r<t.height;){const a=r*t.width+o,i=t.map[a],c=s.nodeAt(i),d=c.attrs;if(o>0&&t.map[a-1]==i||o<t.width-1&&t.map[a+1]==i)e.setNodeMarkup(e.mapping.slice(l).map(n+i),null,zt(d,o-t.colCount(i)));else{const t=e.mapping.slice(l).map(n+i);e.delete(t,t+c.nodeSize)}r+=d.rowspan}}function Bt(e,{map:t,tableStart:s,table:n},o){var l;let r=s;for(let c=0;c<o;c++)r+=n.child(c).nodeSize;const a=[];let i=o>0?-1:0;(function(e,t,s){var n;const o=jt(t.type.schema).header_cell;for(let l=0;l<e.width;l++)if((null==(n=t.nodeAt(e.map[l+s*e.width]))?void 0:n.type)!=o)return!1;return!0})(t,n,o+i)&&(i=0==o||o==t.height?null:0);for(let c=0,d=t.width*o;c<t.width;c++,d++)if(o>0&&o<t.height&&t.map[d]==t.map[d-t.width]){const o=t.map[d],l=n.nodeAt(o).attrs;e.setNodeMarkup(s+o,null,{...l,rowspan:l.rowspan+1}),c+=l.colspan-1}else{const e=null==i?jt(n.type.schema).cell:null==(l=n.nodeAt(t.map[d+i*t.width]))?void 0:l.type,s=null==e?void 0:e.createAndFill();s&&a.push(s)}return e.insert(r,jt(n.type.schema).row.create(null,a)),e}function Pt(e,{map:t,table:s,tableStart:n},o){let l=0;for(let c=0;c<o;c++)l+=s.child(c).nodeSize;const r=l+s.child(o).nodeSize,a=e.mapping.maps.length;e.delete(l+n,r+n);const i=new Set;for(let c=0,d=o*t.width;c<t.width;c++,d++){const l=t.map[d];if(!i.has(l))if(i.add(l),o>0&&l==t.map[d-t.width]){const t=s.nodeAt(l).attrs;e.setNodeMarkup(e.mapping.slice(a).map(l+n),null,{...t,rowspan:t.rowspan-1}),c+=t.colspan-1}else if(o<t.height&&l==t.map[d+t.width]){const r=s.nodeAt(l),i=r.attrs,d=r.type.create({...i,rowspan:r.attrs.rowspan-1},r.content),h=t.positionAt(o+1,c,s);e.insert(e.mapping.slice(a).map(n+h),d),c+=i.colspan-1}}}function Wt(e){const t=e.content;return 1==t.childCount&&t.child(0).isTextblock&&0==t.child(0).childCount}function Gt(e,t){const s=e.selection;if(!(s instanceof Lt)||s.$anchorCell.pos==s.$headCell.pos)return!1;const n=Ot(e),{map:o}=n;if(function({width:e,height:t,map:s},n){let o=n.top*e+n.left,l=o,r=(n.bottom-1)*e+n.left,a=o+(n.right-n.left-1);for(let i=n.top;i<n.bottom;i++){if(n.left>0&&s[l]==s[l-1]||n.right<e&&s[a]==s[a+1])return!0;l+=e,a+=e}for(let i=n.left;i<n.right;i++){if(n.top>0&&s[o]==s[o-e]||n.bottom<t&&s[r]==s[r+e])return!0;o++,r++}return!1}(o,n))return!1;if(t){const s=e.tr,l={};let r,a,i=F.empty;for(let e=n.top;e<n.bottom;e++)for(let t=n.left;t<n.right;t++){const c=o.map[e*o.width+t],d=n.table.nodeAt(c);if(!l[c]&&d)if(l[c]=!0,null==r)r=c,a=d;else{Wt(d)||(i=i.append(d.content));const e=s.mapping.map(c+n.tableStart);s.delete(e,e+d.nodeSize)}}if(null==r||null==a)return!0;if(s.setNodeMarkup(r+n.tableStart,null,{...Ht(a.attrs,a.attrs.colspan,n.right-n.left-a.attrs.colspan),rowspan:n.bottom-n.top}),i.size){const e=r+1+a.content.size,t=Wt(a)?r+1:e;s.replaceWith(t+n.tableStart,e+n.tableStart,i)}s.setSelection(new Lt(s.doc.resolve(r+n.tableStart))),t(s)}return!0}function Kt(e,t){const s=jt(e.schema);return(n=({node:e})=>s[e.type.spec.tableRole],(e,t)=>{var s;const o=e.selection;let l,r;if(o instanceof Lt){if(o.$anchorCell.pos!=o.$headCell.pos)return!1;l=o.$anchorCell.nodeAfter,r=o.$anchorCell.pos}else{if(l=function(e){for(let t=e.depth;t>0;t--){const s=e.node(t).type.spec.tableRole;if("cell"===s||"header_cell"===s)return e.node(t)}return null}(o.$from),!l)return!1;r=null==(s=Nt(o.$from))?void 0:s.pos}if(null==l||null==r)return!1;if(1==l.attrs.colspan&&1==l.attrs.rowspan)return!1;if(t){let s=l.attrs;const a=[],i=s.colwidth;s.rowspan>1&&(s={...s,rowspan:1}),s.colspan>1&&(s={...s,colspan:1});const c=Ot(e),d=e.tr;for(let e=0;e<c.right-c.left;e++)a.push(i?{...s,colwidth:i&&i[e]?[i[e]]:null}:s);let h;for(let e=c.top;e<c.bottom;e++){let t=c.map.positionAt(e,c.left,c.table);e==c.top&&(t+=l.nodeSize);for(let s=c.left,o=0;s<c.right;s++,o++)s==c.left&&e==c.top||d.insert(h=d.mapping.map(t+c.tableStart,1),n({node:l,row:e,col:s}).createAndFill(a[o]))}d.setNodeMarkup(r,n({node:l,row:c.top,col:c.left}),a[0]),o instanceof Lt&&d.setSelection(new Lt(d.doc.resolve(o.$anchorCell.pos),h?d.doc.resolve(h):void 0)),t(d)}return!0})(e,t);var n}function qt(e,t,s){const n=t.map.cellsInRect({left:0,top:0,right:"row"==e?t.map.width:1,bottom:"column"==e?t.map.height:1});for(let o=0;o<n.length;o++){const e=t.table.nodeAt(n[o]);if(e&&e.type!==s.header_cell)return!1}return!0}function Ut(e,t){return(t=t||{useDeprecatedLogic:!1}).useDeprecatedLogic?function(e){return function(t,s){if(!St(t))return!1;if(s){const n=jt(t.schema),o=Ot(t),l=t.tr,r=o.map.cellsInRect("column"==e?{left:o.left,top:0,right:o.right,bottom:o.map.height}:"row"==e?{left:0,top:o.top,right:o.map.width,bottom:o.bottom}:o),a=r.map(e=>o.table.nodeAt(e));for(let e=0;e<r.length;e++)a[e].type==n.header_cell&&l.setNodeMarkup(o.tableStart+r[e],n.cell,a[e].attrs);if(0==l.steps.length)for(let e=0;e<r.length;e++)l.setNodeMarkup(o.tableStart+r[e],n.header_cell,a[e].attrs);s(l)}return!0}}(e):function(t,s){if(!St(t))return!1;if(s){const n=jt(t.schema),o=Ot(t),l=t.tr,r=qt("row",o,n),a=qt("column",o,n),i=("column"===e?r:"row"===e&&a)?1:0,c="column"==e?{left:0,top:i,right:1,bottom:o.map.height}:"row"==e?{left:i,top:0,right:o.map.width,bottom:1}:o,d="column"==e?a?n.cell:n.header_cell:"row"==e?r?n.cell:n.header_cell:n.cell;o.map.cellsInRect(c).forEach(e=>{const t=e+o.tableStart,s=l.doc.nodeAt(t);s&&l.setNodeMarkup(t,d,s.attrs)}),s(l)}return!0}}Ut("row",{useDeprecatedLogic:!0}),Ut("column",{useDeprecatedLogic:!0});var Vt=Ut("cell",{useDeprecatedLogic:!0});function Jt(e){return function(t,s){if(!St(t))return!1;const n=function(e,t){if(t<0){const t=e.nodeBefore;if(t)return e.pos-t.nodeSize;for(let s=e.index(-1)-1,n=e.before();s>=0;s--){const t=e.node(-1).child(s),o=t.lastChild;if(o)return n-1-o.nodeSize;n-=t.nodeSize}}else{if(e.index()<e.parent.childCount-1)return e.pos+e.nodeAfter.nodeSize;const t=e.node(-1);for(let s=e.indexAfter(-1),n=e.after();s<t.childCount;s++){const e=t.child(s);if(e.childCount)return n+1;n+=e.nodeSize}}return null}(At(t),e);if(null==n)return!1;if(s){const e=t.doc.resolve(n);s(t.tr.setSelection(E.between(e,(o=e,o.node(0).resolve(o.pos+o.nodeAfter.nodeSize)))).scrollIntoView())}var o;return!0}}function Yt(e,t){const s=e.selection;if(!(s instanceof Lt))return!1;if(t){const n=e.tr,o=jt(e.schema).cell.createAndFill().content;s.forEachCell((e,t)=>{e.content.eq(o)||n.replace(n.mapping.map(t+1),n.mapping.map(t+e.nodeSize-1),new _(o,0,0))}),n.docChanged&&t(n)}return!0}function Xt(e){if(!e.size)return null;let{content:t,openStart:s,openEnd:n}=e;for(;1==t.childCount&&(s>0&&n>0||"table"==t.child(0).type.spec.tableRole);)s--,n--,t=t.child(0).content;const o=t.child(0),l=o.type.spec.tableRole,r=o.type.schema,a=[];if("row"==l)for(let i=0;i<t.childCount;i++){let e=t.child(i).content;const o=i?0:Math.max(0,s-1),l=i<t.childCount-1?0:Math.max(0,n-1);(o||l)&&(e=Zt(jt(r).row,new _(e,o,l)).content),a.push(e)}else{if("cell"!=l&&"header_cell"!=l)return null;a.push(s||n?Zt(jt(r).row,new _(t,s,n)).content:t)}return function(e,t){const s=[];for(let o=0;o<t.length;o++){const e=t[o];for(let t=e.childCount-1;t>=0;t--){const{rowspan:n,colspan:l}=e.child(t).attrs;for(let e=o;e<o+n;e++)s[e]=(s[e]||0)+l}}let n=0;for(let o=0;o<s.length;o++)n=Math.max(n,s[o]);for(let o=0;o<s.length;o++)if(o>=t.length&&t.push(F.empty),s[o]<n){const l=jt(e).cell.createAndFill(),r=[];for(let e=s[o];e<n;e++)r.push(l);t[o]=t[o].append(F.from(r))}return{height:t.length,width:n,rows:t}}(r,a)}function Zt(e,t){const s=e.createAndFill();return new P(s).replace(0,s.content.size,t).doc}function Qt(e,t,s,n,o,l,r,a){if(0==r||r==t.height)return!1;let i=!1;for(let c=o;c<l;c++){const o=r*t.width+c,l=t.map[o];if(t.map[o-t.width]==l){i=!0;const o=s.nodeAt(l),{top:d,left:h}=t.findCell(l);e.setNodeMarkup(e.mapping.slice(a).map(l+n),null,{...o.attrs,rowspan:r-d}),e.insert(e.mapping.slice(a).map(t.positionAt(r,h,s)),o.type.createAndFill({...o.attrs,rowspan:d+o.attrs.rowspan-r})),c+=o.attrs.colspan-1}}return i}function es(e,t,s,n,o,l,r,a){if(0==r||r==t.width)return!1;let i=!1;for(let c=o;c<l;c++){const o=c*t.width+r,l=t.map[o];if(t.map[o-1]==l){i=!0;const o=s.nodeAt(l),d=t.colCount(l),h=e.mapping.slice(a).map(l+n);e.setNodeMarkup(h,null,zt(o.attrs,r-d,o.attrs.colspan-(r-d))),e.insert(h+o.nodeSize,o.type.createAndFill(zt(o.attrs,0,r-d))),c+=o.attrs.rowspan-1}}return i}function ts(e,t,s,n,o){let l=s?e.doc.nodeAt(s-1):e.doc;if(!l)throw new Error("No table found");let r=yt.get(l);const{top:a,left:i}=n,c=i+o.width,d=a+o.height,h=e.tr;let u=0;function p(){if(l=s?h.doc.nodeAt(s-1):h.doc,!l)throw new Error("No table found");r=yt.get(l),u=h.mapping.maps.length}(function(e,t,s,n,o,l,r){const a=jt(e.doc.type.schema);let i,c;if(o>t.width)for(let d=0,h=0;d<t.height;d++){const l=s.child(d);h+=l.nodeSize;const u=[];let p;p=null==l.lastChild||l.lastChild.type==a.cell?i||(i=a.cell.createAndFill()):c||(c=a.header_cell.createAndFill());for(let e=t.width;e<o;e++)u.push(p);e.insert(e.mapping.slice(r).map(h-1+n),u)}if(l>t.height){const d=[];for(let e=0,n=(t.height-1)*t.width;e<Math.max(t.width,o);e++){const o=!(e>=t.width)&&s.nodeAt(t.map[n+e]).type==a.header_cell;d.push(o?c||(c=a.header_cell.createAndFill()):i||(i=a.cell.createAndFill()))}const h=a.row.create(null,F.from(d)),u=[];for(let e=t.height;e<l;e++)u.push(h);e.insert(e.mapping.slice(r).map(n+s.nodeSize-2),u)}return!(!i&&!c)})(h,r,l,s,c,d,u)&&p(),Qt(h,r,l,s,i,c,a,u)&&p(),Qt(h,r,l,s,i,c,d,u)&&p(),es(h,r,l,s,a,d,i,u)&&p(),es(h,r,l,s,a,d,c,u)&&p();for(let m=a;m<d;m++){const e=r.positionAt(m,i,l),t=r.positionAt(m,c,l);h.replace(h.mapping.slice(u).map(e+s),h.mapping.slice(u).map(t+s),new _(o.rows[m-a],0,0))}p(),h.setSelection(new Lt(h.doc.resolve(s+r.positionAt(a,i,l)),h.doc.resolve(s+r.positionAt(d-1,c-1,l)))),t(h)}var ss=$({ArrowLeft:os("horiz",-1),ArrowRight:os("horiz",1),ArrowUp:os("vert",-1),ArrowDown:os("vert",1),"Shift-ArrowLeft":ls("horiz",-1),"Shift-ArrowRight":ls("horiz",1),"Shift-ArrowUp":ls("vert",-1),"Shift-ArrowDown":ls("vert",1),Backspace:Yt,"Mod-Backspace":Yt,Delete:Yt,"Mod-Delete":Yt});function ns(e,t,s){return!s.eq(e.selection)&&(t&&t(e.tr.setSelection(s).scrollIntoView()),!0)}function os(e,t){return(s,n,o)=>{if(!o)return!1;const l=s.selection;if(l instanceof Lt)return ns(s,n,L.near(l.$headCell,t));if("horiz"!=e&&!l.empty)return!1;const r=cs(o,e,t);if(null==r)return!1;if("horiz"==e)return ns(s,n,L.near(s.doc.resolve(l.head+t),t));{const o=s.doc.resolve(r),l=Tt(o,e,t);let a;return a=l?L.near(l,1):t<0?L.near(s.doc.resolve(o.before(-1)),-1):L.near(s.doc.resolve(o.after(-1)),1),ns(s,n,a)}}}function ls(e,t){return(s,n,o)=>{if(!o)return!1;const l=s.selection;let r;if(l instanceof Lt)r=l;else{const n=cs(o,e,t);if(null==n)return!1;r=new Lt(s.doc.resolve(n))}const a=Tt(r.$headCell,e,t);return!!a&&ns(s,n,new Lt(r.$anchorCell,a))}}function rs(e,t){const s=Nt(e.state.doc.resolve(t));return!!s&&(e.dispatch(e.state.tr.setSelection(new Lt(s))),!0)}function as(e,t,s){if(!St(e.state))return!1;let n=Xt(s);const o=e.state.selection;if(o instanceof Lt){n||(n={width:1,height:1,rows:[F.from(Zt(jt(e.state.schema).cell,s))]});const t=o.$anchorCell.node(-1),l=o.$anchorCell.start(-1),r=yt.get(t).rectBetween(o.$anchorCell.pos-l,o.$headCell.pos-l);return n=function({width:e,height:t,rows:s},n,o){if(e!=n){const t=[],o=[];for(let e=0;e<s.length;e++){const l=s[e],r=[];for(let s=t[e]||0,o=0;s<n;o++){let a=l.child(o%l.childCount);s+a.attrs.colspan>n&&(a=a.type.createChecked(zt(a.attrs,a.attrs.colspan,s+a.attrs.colspan-n),a.content)),r.push(a),s+=a.attrs.colspan;for(let s=1;s<a.attrs.rowspan;s++)t[e+s]=(t[e+s]||0)+a.attrs.colspan}o.push(F.from(r))}s=o,e=n}if(t!=o){const e=[];for(let n=0,l=0;n<o;n++,l++){const r=[],a=s[l%t];for(let e=0;e<a.childCount;e++){let t=a.child(e);n+t.attrs.rowspan>o&&(t=t.type.create({...t.attrs,rowspan:Math.max(1,o-t.attrs.rowspan)},t.content)),r.push(t)}e.push(F.from(r))}s=e,t=o}return{width:e,height:t,rows:s}}(n,r.right-r.left,r.bottom-r.top),ts(e.state,e.dispatch,l,r,n),!0}if(n){const t=At(e.state),s=t.start(-1);return ts(e.state,e.dispatch,s,yt.get(t.node(-1)).findCell(t.pos-s),n),!0}return!1}function is(e,t){var s;if(t.ctrlKey||t.metaKey)return;const n=ds(e,t.target);let o;if(t.shiftKey&&e.state.selection instanceof Lt)l(e.state.selection.$anchorCell,t),t.preventDefault();else if(t.shiftKey&&n&&null!=(o=Nt(e.state.selection.$anchor))&&(null==(s=hs(e,t))?void 0:s.pos)!=o.pos)l(o,t),t.preventDefault();else if(!n)return;function l(t,s){let n=hs(e,s);const o=null==Ct.getState(e.state);if(!n||!Mt(t,n)){if(!o)return;n=t}const l=new Lt(t,n);if(o||!e.state.selection.eq(l)){const s=e.state.tr.setSelection(l);o&&s.setMeta(Ct,t.pos),e.dispatch(s)}}function r(){e.root.removeEventListener("mouseup",r),e.root.removeEventListener("dragstart",r),e.root.removeEventListener("mousemove",a),null!=Ct.getState(e.state)&&e.dispatch(e.state.tr.setMeta(Ct,-1))}function a(s){const o=s,a=Ct.getState(e.state);let i;if(null!=a)i=e.state.doc.resolve(a);else if(ds(e,o.target)!=n&&(i=hs(e,t),!i))return r();i&&l(i,o)}e.root.addEventListener("mouseup",r),e.root.addEventListener("dragstart",r),e.root.addEventListener("mousemove",a)}function cs(e,t,s){if(!(e.state.selection instanceof E))return null;const{$head:n}=e.state.selection;for(let o=n.depth-1;o>=0;o--){const l=n.node(o);if((s<0?n.index(o):n.indexAfter(o))!=(s<0?0:l.childCount))return null;if("cell"==l.type.spec.tableRole||"header_cell"==l.type.spec.tableRole){const l=n.before(o),r="vert"==t?s>0?"down":"up":s>0?"right":"left";return e.endOfTextblock(r)?l:null}}return null}function ds(e,t){for(;t&&t!=e.dom;t=t.parentNode)if("TD"==t.nodeName||"TH"==t.nodeName)return t;return null}function hs(e,t){const s=e.posAtCoords({left:t.clientX,top:t.clientY});return s&&s?Nt(e.state.doc.resolve(s.pos)):null}var us=class{constructor(e,t){this.node=e,this.defaultCellMinWidth=t,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.table.style.setProperty("--default-cell-min-width",`${t}px`),this.colgroup=this.table.appendChild(document.createElement("colgroup")),ps(e,this.colgroup,this.table,t),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type==this.node.type&&(this.node=e,ps(e,this.colgroup,this.table,this.defaultCellMinWidth),!0)}ignoreMutation(e){return"attributes"==e.type&&(e.target==this.table||this.colgroup.contains(e.target))}};function ps(e,t,s,n,o,l){var r;let a=0,i=!0,c=t.firstChild;const d=e.firstChild;if(d){for(let e=0,s=0;e<d.childCount;e++){const{colspan:r,colwidth:h}=d.child(e).attrs;for(let e=0;e<r;e++,s++){const r=o==s?l:h&&h[e],d=r?r+"px":"";if(a+=r||n,r||(i=!1),c)c.style.width!=d&&(c.style.width=d),c=c.nextSibling;else{const e=document.createElement("col");e.style.width=d,t.appendChild(e)}}}for(;c;){const e=c.nextSibling;null==(r=c.parentNode)||r.removeChild(c),c=e}i?(s.style.width=a+"px",s.style.minWidth=""):(s.style.width="",s.style.minWidth=a+"px")}}var ms=new H("tableColumnResizing");function fs({handleWidth:e=5,cellMinWidth:t=25,defaultCellMinWidth:s=100,View:n=us,lastColumnResizable:o=!0}={}){const l=new O({key:ms,state:{init(e,t){var o,r;const a=null==(r=null==(o=l.spec)?void 0:o.props)?void 0:r.nodeViews,i=jt(t.schema).table.name;return n&&a&&(a[i]=(e,t)=>new n(e,s,t)),new gs(-1,!1)},apply:(e,t)=>t.apply(e)},props:{attributes:e=>{const t=ms.getState(e);return t&&t.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(t,s)=>{!function(e,t,s,n){if(!e.editable)return;const o=ms.getState(e.state);if(!o)return;if(!o.dragging){const l=function(e){for(;e&&"TD"!=e.nodeName&&"TH"!=e.nodeName;)e=e.classList&&e.classList.contains("ProseMirror")?null:e.parentNode;return e}(t.target);let r=-1;if(l){const{left:n,right:o}=l.getBoundingClientRect();t.clientX-n<=s?r=xs(e,t,"left",s):o-t.clientX<=s&&(r=xs(e,t,"right",s))}if(r!=o.activeHandle){if(!n&&-1!==r){const t=e.state.doc.resolve(r),s=t.node(-1),n=yt.get(s),o=t.start(-1);if(n.colCount(t.pos-o)+t.nodeAfter.attrs.colspan-1==n.width-1)return}ws(e,r)}}}(t,s,e,o)},mouseleave:e=>{!function(e){if(!e.editable)return;const t=ms.getState(e.state);t&&t.activeHandle>-1&&!t.dragging&&ws(e,-1)}(e)},mousedown:(e,n)=>{!function(e,t,s,n){var o;if(!e.editable)return!1;const l=null!=(o=e.dom.ownerDocument.defaultView)?o:window,r=ms.getState(e.state);if(!r||-1==r.activeHandle||r.dragging)return!1;const a=e.state.doc.nodeAt(r.activeHandle),i=function(e,t,{colspan:s,colwidth:n}){const o=n&&n[n.length-1];if(o)return o;const l=e.domAtPos(t);let r=l.node.childNodes[l.offset].offsetWidth,a=s;if(n)for(let i=0;i<s;i++)n[i]&&(r-=n[i],a--);return r/a}(e,r.activeHandle,a.attrs);function c(t){l.removeEventListener("mouseup",c),l.removeEventListener("mousemove",d);const n=ms.getState(e.state);(null==n?void 0:n.dragging)&&(!function(e,t,s){const n=e.state.doc.resolve(t),o=n.node(-1),l=yt.get(o),r=n.start(-1),a=l.colCount(n.pos-r)+n.nodeAfter.attrs.colspan-1,i=e.state.tr;for(let c=0;c<l.height;c++){const e=c*l.width+a;if(c&&l.map[e]==l.map[e-l.width])continue;const t=l.map[e],n=o.nodeAt(t).attrs,d=1==n.colspan?0:a-l.colCount(t);if(n.colwidth&&n.colwidth[d]==s)continue;const h=n.colwidth?n.colwidth.slice():vs(n.colspan);h[d]=s,i.setNodeMarkup(r+t,null,{...n,colwidth:h})}i.docChanged&&e.dispatch(i)}(e,n.activeHandle,bs(n.dragging,t,s)),e.dispatch(e.state.tr.setMeta(ms,{setDragging:null})))}function d(t){if(!t.which)return c(t);const o=ms.getState(e.state);if(o&&o.dragging){const l=bs(o.dragging,t,s);ys(e,o.activeHandle,l,n)}}e.dispatch(e.state.tr.setMeta(ms,{setDragging:{startX:t.clientX,startWidth:i}})),ys(e,r.activeHandle,i,n),l.addEventListener("mouseup",c),l.addEventListener("mousemove",d),t.preventDefault()}(e,n,t,s)}},decorations:e=>{const t=ms.getState(e);if(t&&t.activeHandle>-1)return function(e,t){var s;const n=[],o=e.doc.resolve(t),l=o.node(-1);if(!l)return I.empty;const r=yt.get(l),a=o.start(-1),i=r.colCount(o.pos-a)+o.nodeAfter.attrs.colspan-1;for(let c=0;c<r.height;c++){const t=i+c*r.width;if(!(i!=r.width-1&&r.map[t]==r.map[t+1]||0!=c&&r.map[t]==r.map[t-r.width])){const o=r.map[t],i=a+o+l.nodeAt(o).nodeSize-1,c=document.createElement("div");c.className="column-resize-handle",(null==(s=ms.getState(e))?void 0:s.dragging)&&n.push(D.node(a+o,a+o+l.nodeAt(o).nodeSize,{class:"column-resize-dragging"})),n.push(D.widget(i,c))}}return I.create(e.doc,n)}(e,t.activeHandle)},nodeViews:{}}});return l}var gs=class e{constructor(e,t){this.activeHandle=e,this.dragging=t}apply(t){const s=this,n=t.getMeta(ms);if(n&&null!=n.setHandle)return new e(n.setHandle,!1);if(n&&void 0!==n.setDragging)return new e(s.activeHandle,n.setDragging);if(s.activeHandle>-1&&t.docChanged){let n=t.mapping.map(s.activeHandle,-1);return kt(t.doc.resolve(n))||(n=-1),new e(n,s.dragging)}return s}};function xs(e,t,s,n){const o="right"==s?-n:n,l=e.posAtCoords({left:t.clientX+o,top:t.clientY});if(!l)return-1;const{pos:r}=l,a=Nt(e.state.doc.resolve(r));if(!a)return-1;if("right"==s)return a.pos;const i=yt.get(a.node(-1)),c=a.start(-1),d=i.map.indexOf(a.pos-c);return d%i.width==0?-1:c+i.map[d-1]}function bs(e,t,s){const n=t.clientX-e.startX;return Math.max(s,e.startWidth+n)}function ws(e,t){e.dispatch(e.state.tr.setMeta(ms,{setHandle:t}))}function ys(e,t,s,n){const o=e.state.doc.resolve(t),l=o.node(-1),r=o.start(-1),a=yt.get(l).colCount(o.pos-r)+o.nodeAfter.attrs.colspan-1;let i=e.domAtPos(o.start(-1)).node;for(;i&&"TABLE"!=i.nodeName;)i=i.parentNode;i&&ps(l,i.firstChild,i,n,a,s)}function vs(e){return Array(e).fill(0)}function js({allowTableNodeSelection:e=!1}={}){return new O({key:Ct,state:{init:()=>null,apply(e,t){const s=e.getMeta(Ct);if(null!=s)return-1==s?null:s;if(null==t||!e.docChanged)return t;const{deleted:n,pos:o}=e.mapping.mapResult(t);return n?null:o}},props:{decorations:Rt,handleDOMEvents:{mousedown:is},createSelectionBetween:e=>null!=Ct.getState(e.state)?e.state.selection:null,handleTripleClick:rs,handleKeyDown:ss,handlePaste:as},appendTransaction:(t,s,n)=>function(e,t,s){const n=(t||e).selection,o=(t||e).doc;let l,r;if(n instanceof B&&(r=n.node.type.spec.tableRole)){if("cell"==r||"header_cell"==r)l=Lt.create(o,n.from);else if("row"==r){const e=o.resolve(n.from+1);l=Lt.rowSelection(e,e)}else if(!s){const e=yt.get(n.node),t=n.from+1,s=t+e.map[e.width*e.height-1];l=Lt.create(o,t+1,s)}}else n instanceof E&&function({$from:e,$to:t}){if(e.pos==t.pos||e.pos<t.pos-6)return!1;let s=e.pos,n=t.pos,o=e.depth;for(;o>=0&&!(e.after(o+1)<e.end(o));o--,s++);for(let l=t.depth;l>=0&&!(t.before(l+1)>t.start(l));l--,n--);return s==n&&/row|table/.test(e.node(o).type.spec.tableRole)}(n)?l=E.create(o,n.from):n instanceof E&&function({$from:e,$to:t}){let s,n;for(let o=e.depth;o>0;o--){const t=e.node(o);if("cell"===t.type.spec.tableRole||"header_cell"===t.type.spec.tableRole){s=t;break}}for(let o=t.depth;o>0;o--){const e=t.node(o);if("cell"===e.type.spec.tableRole||"header_cell"===e.type.spec.tableRole){n=e;break}}return s!==n&&0===t.parentOffset}(n)&&(l=E.create(o,n.$from.start(),n.$from.end()));return l&&(t||(t=e.tr)).setSelection(l),t}(n,_t(n,s),e)})}var Cs=W.create({name:"tableCell",addOptions:()=>({HTMLAttributes:{}}),content:"block+",addAttributes:()=>({colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:e=>{var t,s;const n=e.getAttribute("colwidth"),o=n?n.split(",").map(e=>parseInt(e,10)):null;if(!o){const n=null==(t=e.closest("table"))?void 0:t.querySelectorAll("colgroup > col"),o=Array.from((null==(s=e.parentElement)?void 0:s.children)||[]).indexOf(e);if(o&&o>-1&&n&&n[o]){const e=n[o].getAttribute("width");return e?[parseInt(e,10)]:null}}return o}}}),tableRole:"cell",isolating:!0,parseHTML:()=>[{tag:"td"}],renderHTML({HTMLAttributes:e}){return["td",M(this.options.HTMLAttributes,e),0]}}),Ns=W.create({name:"tableHeader",addOptions:()=>({HTMLAttributes:{}}),content:"block+",addAttributes:()=>({colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:e=>{const t=e.getAttribute("colwidth");return t?t.split(",").map(e=>parseInt(e,10)):null}}}),tableRole:"header_cell",isolating:!0,parseHTML:()=>[{tag:"th"}],renderHTML({HTMLAttributes:e}){return["th",M(this.options.HTMLAttributes,e),0]}}),Ss=W.create({name:"tableRow",addOptions:()=>({HTMLAttributes:{}}),content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML:()=>[{tag:"tr"}],renderHTML({HTMLAttributes:e}){return["tr",M(this.options.HTMLAttributes,e),0]}});function As(e,t){return t?["width",`${Math.max(t,e)}px`]:["min-width",`${e}px`]}function ks(e,t,s,n,o,l){var r;let a=0,i=!0,c=t.firstChild;const d=e.firstChild;if(null!==d)for(let h=0,u=0;h<d.childCount;h+=1){const{colspan:e,colwidth:s}=d.child(h).attrs;for(let r=0;r<e;r+=1,u+=1){const e=o===u?l:s&&s[r],d=e?`${e}px`:"";if(a+=e||n,e||(i=!1),c){if(c.style.width!==d){const[t,s]=As(n,e);c.style.setProperty(t,s)}c=c.nextSibling}else{const s=document.createElement("col"),[o,l]=As(n,e);s.style.setProperty(o,l),t.appendChild(s)}}}for(;c;){const e=c.nextSibling;null==(r=c.parentNode)||r.removeChild(c),c=e}i?(s.style.width=`${a}px`,s.style.minWidth=""):(s.style.width="",s.style.minWidth=`${a}px`)}var Ms=class{constructor(e,t){this.node=e,this.cellMinWidth=t,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),ks(e,this.colgroup,this.table,t),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type===this.node.type&&(this.node=e,ks(e,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(e){const t=e.target,s=this.dom.contains(t),n=this.contentDOM.contains(t);return!(!s||n||"attributes"!==e.type&&"childList"!==e.type&&"characterData"!==e.type)}};function Ts(e,t){return t?e.createChecked(null,t):e.createAndFill()}function zs(e,t,s,n,o){const l=function(e){if(e.cached.tableNodeTypes)return e.cached.tableNodeTypes;const t={};return Object.keys(e.nodes).forEach(s=>{const n=e.nodes[s];n.spec.tableRole&&(t[n.spec.tableRole]=n)}),e.cached.tableNodeTypes=t,t}(e),r=[],a=[];for(let c=0;c<s;c+=1){const e=Ts(l.cell,o);if(e&&a.push(e),n){const e=Ts(l.header_cell,o);e&&r.push(e)}}const i=[];for(let c=0;c<t;c+=1)i.push(l.row.createChecked(null,n&&0===c?r:a));return l.table.createChecked(null,i)}var Hs=({editor:e})=>{const{selection:t}=e.state;if(!(t instanceof Lt))return!1;let s=0;const n=q(t.ranges[0].$from,e=>"table"===e.type.name);null==n||n.node.descendants(e=>{if("table"===e.type.name)return!1;["tableCell","tableHeader"].includes(e.type.name)&&(s+=1)});return s===t.ranges.length&&(e.commands.deleteTable(),!0)};var Ls=function(e,t,s={}){var n;const o=null!=(n=s.cellLineSeparator)?n:"";if(!e||!e.content||0===e.content.length)return"";const l=[];e.content.forEach(e=>{const s=[];e.content&&e.content.forEach(e=>{let n="";if(e.content&&Array.isArray(e.content)&&e.content.length>1){n=e.content.map(e=>t.renderChildren(e)).join(o)}else n=e.content?t.renderChildren(e.content):"";const l=(n||"").replace(/\s+/g," ").trim();const r="tableHeader"===e.type;s.push({text:l,isHeader:r})}),l.push(s)});const r=l.reduce((e,t)=>Math.max(e,t.length),0);if(0===r)return"";const a=new Array(r).fill(0);l.forEach(e=>{var t;for(let s=0;s<r;s+=1){const n=((null==(t=e[s])?void 0:t.text)||"").length;n>a[s]&&(a[s]=n),a[s]<3&&(a[s]=3)}});const i=(e,t)=>e+" ".repeat(Math.max(0,t-e.length)),c=l[0],d=c.some(e=>e.isHeader);let h="\n";const u=new Array(r).fill(0).map((e,t)=>d&&c[t]&&c[t].text||"");return h+=`| ${u.map((e,t)=>i(e,a[t])).join(" | ")} |\n`,h+=`| ${a.map(e=>"-".repeat(Math.max(3,e))).join(" | ")} |\n`,(d?l.slice(1):l).forEach(e=>{h+=`| ${new Array(r).fill(0).map((t,s)=>i(e[s]&&e[s].text||"",a[s])).join(" | ")} |\n`}),h},$s=W.create({name:"table",addOptions:()=>({HTMLAttributes:{},resizable:!1,renderWrapper:!1,handleWidth:5,cellMinWidth:25,View:Ms,lastColumnResizable:!0,allowTableNodeSelection:!1}),content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML:()=>[{tag:"table"}],renderHTML({node:e,HTMLAttributes:t}){const{colgroup:s,tableWidth:n,tableMinWidth:o}=function(e,t,s,n){let o=0,l=!0;const r=[],a=e.firstChild;if(!a)return{};for(let d=0,h=0;d<a.childCount;d+=1){const{colspan:e,colwidth:i}=a.child(d).attrs;for(let a=0;a<e;a+=1,h+=1){const e=s===h?n:i&&i[a];o+=e||t,e||(l=!1);const[c,d]=As(t,e);r.push(["col",{style:`${c}: ${d}`}])}}const i=l?`${o}px`:"",c=l?"":`${o}px`;return{colgroup:["colgroup",{},...r],tableWidth:i,tableMinWidth:c}}(e,this.options.cellMinWidth),l=["table",M(this.options.HTMLAttributes,t,{style:n?`width: ${n}`:`min-width: ${o}`}),s,["tbody",0]];return this.options.renderWrapper?["div",{class:"tableWrapper"},l]:l},parseMarkdown:(e,t)=>{const s=[];if(e.header){const n=[];e.header.forEach(e=>{n.push(t.createNode("tableHeader",{},[{type:"paragraph",content:t.parseInline(e.tokens)}]))}),s.push(t.createNode("tableRow",{},n))}return e.rows&&e.rows.forEach(e=>{const n=[];e.forEach(e=>{n.push(t.createNode("tableCell",{},[{type:"paragraph",content:t.parseInline(e.tokens)}]))}),s.push(t.createNode("tableRow",{},n))}),t.createNode("table",void 0,s)},renderMarkdown:(e,t)=>Ls(e,t),addCommands:()=>({insertTable:({rows:e=3,cols:t=3,withHeaderRow:s=!0}={})=>({tr:n,dispatch:o,editor:l})=>{const r=zs(l.schema,e,t,s);if(o){const e=n.selection.from+1;n.replaceSelectionWith(r).scrollIntoView().setSelection(E.near(n.doc.resolve(e)))}return!0},addColumnBefore:()=>({state:e,dispatch:t})=>function(e,t){if(!St(e))return!1;if(t){const s=Ot(e);t(It(e.tr,s,s.left))}return!0}(e,t),addColumnAfter:()=>({state:e,dispatch:t})=>function(e,t){if(!St(e))return!1;if(t){const s=Ot(e);t(It(e.tr,s,s.right))}return!0}(e,t),deleteColumn:()=>({state:e,dispatch:t})=>function(e,t){if(!St(e))return!1;if(t){const s=Ot(e),n=e.tr;if(0==s.left&&s.right==s.map.width)return!1;for(let e=s.right-1;Dt(n,s,e),e!=s.left;e--){const e=s.tableStart?n.doc.nodeAt(s.tableStart-1):n.doc;if(!e)throw RangeError("No table found");s.table=e,s.map=yt.get(e)}t(n)}return!0}(e,t),addRowBefore:()=>({state:e,dispatch:t})=>function(e,t){if(!St(e))return!1;if(t){const s=Ot(e);t(Bt(e.tr,s,s.top))}return!0}(e,t),addRowAfter:()=>({state:e,dispatch:t})=>function(e,t){if(!St(e))return!1;if(t){const s=Ot(e);t(Bt(e.tr,s,s.bottom))}return!0}(e,t),deleteRow:()=>({state:e,dispatch:t})=>function(e,t){if(!St(e))return!1;if(t){const s=Ot(e),n=e.tr;if(0==s.top&&s.bottom==s.map.height)return!1;for(let e=s.bottom-1;Pt(n,s,e),e!=s.top;e--){const e=s.tableStart?n.doc.nodeAt(s.tableStart-1):n.doc;if(!e)throw RangeError("No table found");s.table=e,s.map=yt.get(s.table)}t(n)}return!0}(e,t),deleteTable:()=>({state:e,dispatch:t})=>function(e,t){const s=e.selection.$anchor;for(let n=s.depth;n>0;n--)if("table"==s.node(n).type.spec.tableRole)return t&&t(e.tr.delete(s.before(n),s.after(n)).scrollIntoView()),!0;return!1}(e,t),mergeCells:()=>({state:e,dispatch:t})=>Gt(e,t),splitCell:()=>({state:e,dispatch:t})=>Kt(e,t),toggleHeaderColumn:()=>({state:e,dispatch:t})=>Ut("column")(e,t),toggleHeaderRow:()=>({state:e,dispatch:t})=>Ut("row")(e,t),toggleHeaderCell:()=>({state:e,dispatch:t})=>Vt(e,t),mergeOrSplit:()=>({state:e,dispatch:t})=>!!Gt(e,t)||Kt(e,t),setCellAttribute:(e,t)=>({state:s,dispatch:n})=>function(e,t){return function(s,n){if(!St(s))return!1;const o=At(s);if(o.nodeAfter.attrs[e]===t)return!1;if(n){const l=s.tr;s.selection instanceof Lt?s.selection.forEachCell((s,n)=>{s.attrs[e]!==t&&l.setNodeMarkup(n,null,{...s.attrs,[e]:t})}):l.setNodeMarkup(o.pos,null,{...o.nodeAfter.attrs,[e]:t}),n(l)}return!0}}(e,t)(s,n),goToNextCell:()=>({state:e,dispatch:t})=>Jt(1)(e,t),goToPreviousCell:()=>({state:e,dispatch:t})=>Jt(-1)(e,t),fixTables:()=>({state:e,dispatch:t})=>(t&&_t(e),!0),setCellSelection:e=>({tr:t,dispatch:s})=>{if(s){const s=Lt.create(t.doc,e.anchorCell,e.headCell);t.setSelection(s)}return!0}}),addKeyboardShortcuts(){return{Tab:()=>!!this.editor.commands.goToNextCell()||!!this.editor.can().addRowAfter()&&this.editor.chain().addRowAfter().goToNextCell().run(),"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:Hs,"Mod-Backspace":Hs,Delete:Hs,"Mod-Delete":Hs}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[fs({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,defaultCellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],js({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(e){const t={name:e.name,options:e.options,storage:e.storage};return{tableRole:G(K(e,"tableRole",t))}}});A.create({name:"tableKit",addExtensions(){const e=[];return!1!==this.options.table&&e.push($s.configure(this.options.table)),!1!==this.options.tableCell&&e.push(Cs.configure(this.options.tableCell)),!1!==this.options.tableHeader&&e.push(Ns.configure(this.options.tableHeader)),!1!==this.options.tableRow&&e.push(Ss.configure(this.options.tableRow)),e}});const Rs=ct.extend({addAttributes(){var e;return{...null==(e=this.parent)?void 0:e.call(this),fontSize:{default:null,parseHTML:e=>e.style.fontSize,renderHTML:e=>e.fontSize?{style:`font-size: ${e.fontSize}`}:{}}}},addCommands(){var e;return{...null==(e=this.parent)?void 0:e.call(this),setFontSize:e=>({commands:t,state:s})=>{const{from:n,to:o}=s.selection;return n!==o&&t.setMark(this.name,{fontSize:e})},unsetFontSize:()=>({commands:e})=>e.unsetMark(this.name)}}}),Es=({editor:s})=>{const[n,a]=t.useState(!1),[i,c]=t.useState(!1),[d,h]=t.useState(!1),[u,p]=t.useState(3),[m,f]=t.useState(3),[g,x]=t.useState(!1),[b,w]=t.useState("");if(!s)return null;const y=()=>{try{const e=Function('"use strict"; return ('+b+")")();s.chain().focus().insertContent(String(e)).run(),w(""),x(!1)}catch(e){alert("Invalid math expression")}},v=s.isActive("table");return e.jsxs("div",{className:"border-b border-white/10 p-2 space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap gap-1 items-center",children:[e.jsxs(te,{children:[e.jsx(se,{asChild:!0,children:e.jsxs(o,{type:"button",variant:"ghost",size:"sm",title:"Font Size - Select text first, then choose size",className:"gap-1",children:[e.jsx(he,{className:"w-4 h-4"}),e.jsx(ue,{className:"w-3 h-3"})]})}),e.jsxs(ne,{align:"start",className:"bg-background border-white/10",children:[e.jsx("div",{className:"px-2 py-1 text-xs text-text-secondary",children:"Select text first, then click size"}),e.jsx(oe,{className:"bg-white/10"}),["12px","14px","16px","18px","20px","24px","28px","32px","36px","48px"].map(t=>e.jsx(le,{onClick:()=>{const{from:e,to:n}=s.state.selection;e!==n?s.chain().focus().setFontSize(t).run():alert("Please select text first before applying font size")},className:"cursor-pointer hover:bg-white/10",children:e.jsx("span",{style:{fontSize:t},children:t})},t)),e.jsx(oe,{className:"bg-white/10"}),e.jsx(le,{onClick:()=>s.chain().focus().unsetFontSize().run(),className:"cursor-pointer hover:bg-white/10 text-red-400",children:"Reset Size"})]})]}),e.jsx("div",{className:"w-px h-8 bg-white/10 mx-1"}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>s.chain().focus().toggleBold().run(),className:s.isActive("bold")?"bg-white/10":"",title:"Bold (Ctrl+B) - Make text bold",children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>s.chain().focus().toggleItalic().run(),className:s.isActive("italic")?"bg-white/10":"",title:"Italic (Ctrl+I) - Make text italic",children:e.jsx(me,{className:"w-4 h-4"})}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>s.chain().focus().toggleUnderline().run(),className:s.isActive("underline")?"bg-white/10":"",title:"Underline (Ctrl+U) - Underline text",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>s.chain().focus().toggleStrike().run(),className:s.isActive("strike")?"bg-white/10":"",title:"Strikethrough - Strike through text",children:e.jsx(ge,{className:"w-4 h-4"})}),e.jsx("div",{className:"w-px h-8 bg-white/10 mx-1"}),e.jsxs(te,{children:[e.jsx(se,{asChild:!0,children:e.jsxs(o,{type:"button",variant:"ghost",size:"sm",title:"Headings - Different heading levels",className:"gap-1",children:[e.jsx(xe,{className:"w-4 h-4"}),e.jsx(ue,{className:"w-3 h-3"})]})}),e.jsxs(ne,{align:"start",className:"bg-background border-white/10",children:[e.jsxs(le,{onClick:()=>s.chain().focus().toggleHeading({level:1}).run(),className:"cursor-pointer hover:bg-white/10 "+(s.isActive("heading",{level:1})?"bg-white/10":""),children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Heading 1 (Large)"]}),e.jsxs(le,{onClick:()=>s.chain().focus().toggleHeading({level:2}).run(),className:"cursor-pointer hover:bg-white/10 "+(s.isActive("heading",{level:2})?"bg-white/10":""),children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Heading 2 (Medium)"]}),e.jsxs(le,{onClick:()=>s.chain().focus().toggleHeading({level:3}).run(),className:"cursor-pointer hover:bg-white/10 "+(s.isActive("heading",{level:3})?"bg-white/10":""),children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Heading 3 (Small)"]}),e.jsx(oe,{className:"bg-white/10"}),e.jsx(le,{onClick:()=>s.chain().focus().setParagraph().run(),className:"cursor-pointer hover:bg-white/10",children:"Normal Text"})]})]}),e.jsx("div",{className:"w-px h-8 bg-white/10 mx-1"}),e.jsxs("div",{className:"relative",children:[e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>a(!n),title:"Text Color - Change text color",children:e.jsx(ye,{className:"w-4 h-4"})}),n&&e.jsx("div",{className:"absolute top-full left-0 mt-1 p-2 bg-background border border-white/10 rounded-lg shadow-lg z-50 flex gap-1",children:["#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#FFA500","#800080","#008000"].map(t=>e.jsx("button",{type:"button",className:"w-6 h-6 rounded border border-white/20 hover:scale-110 transition-transform",style:{backgroundColor:t},onClick:()=>{s.chain().focus().setColor(t).run(),a(!1)},title:`Set color to ${t}`},t))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>c(!i),className:s.isActive("highlight")?"bg-white/10":"",title:"Highlight - Highlight text background",children:e.jsx(ve,{className:"w-4 h-4"})}),i&&e.jsx("div",{className:"absolute top-full left-0 mt-1 p-2 bg-background border border-white/10 rounded-lg shadow-lg z-50 flex gap-1",children:["transparent","#FFE066","#66FFE0","#FF6666","#66FF66","#6666FF","#FFAA66","#FF66FF"].map(t=>e.jsx("button",{type:"button",className:"w-6 h-6 rounded border border-white/20 hover:scale-110 transition-transform",style:{backgroundColor:t},onClick:()=>{"transparent"===t?s.chain().focus().unsetHighlight().run():s.chain().focus().setHighlight({color:t}).run(),c(!1)},title:"transparent"===t?"Remove highlight":`Highlight with ${t}`},t))})]}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>s.chain().focus().unsetAllMarks().run(),title:"Clear Formatting - Remove all text formatting",children:e.jsx(je,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 items-center",children:[e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>s.chain().focus().setTextAlign("left").run(),className:s.isActive({textAlign:"left"})?"bg-white/10":"",title:"Align Left - Align text to the left",children:e.jsx(Ce,{className:"w-4 h-4"})}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>s.chain().focus().setTextAlign("center").run(),className:s.isActive({textAlign:"center"})?"bg-white/10":"",title:"Align Center - Center align text",children:e.jsx(Ne,{className:"w-4 h-4"})}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>s.chain().focus().setTextAlign("right").run(),className:s.isActive({textAlign:"right"})?"bg-white/10":"",title:"Align Right - Align text to the right",children:e.jsx(Se,{className:"w-4 h-4"})}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>s.chain().focus().setTextAlign("justify").run(),className:s.isActive({textAlign:"justify"})?"bg-white/10":"",title:"Justify - Justify text alignment",children:e.jsx(Ae,{className:"w-4 h-4"})}),e.jsx("div",{className:"w-px h-8 bg-white/10 mx-1"}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>s.chain().focus().toggleBulletList().run(),className:s.isActive("bulletList")?"bg-white/10":"",title:"Bullet List - Create an unordered list",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>s.chain().focus().toggleOrderedList().run(),className:s.isActive("orderedList")?"bg-white/10":"",title:"Numbered List - Create a numbered list",children:e.jsx(Me,{className:"w-4 h-4"})}),e.jsx("div",{className:"w-px h-8 bg-white/10 mx-1"}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>{const e=s.getAttributes("link").href,t=window.prompt("Enter URL:",e||"");null!==t&&(""!==t?s.chain().focus().extendMarkRange("link").setLink({href:t}).run():s.chain().focus().extendMarkRange("link").unsetLink().run())},className:s.isActive("link")?"bg-white/10":"",title:"Add Link - Insert or edit a hyperlink",children:e.jsx(Te,{className:"w-4 h-4"})}),s.isActive("link")&&e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>s.chain().focus().unsetLink().run(),title:"Remove Link - Remove the hyperlink",children:e.jsx(ze,{className:"w-4 h-4"})}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>{const e=window.prompt("Enter image URL:");e&&s.chain().focus().setImage({src:e}).run()},title:"Insert Image - Add an image from URL",children:e.jsx(He,{className:"w-4 h-4"})}),e.jsxs(re,{open:d,onOpenChange:h,children:[e.jsx(ae,{asChild:!0,children:e.jsx(o,{type:"button",variant:"ghost",size:"sm",title:"Insert Table - Create a custom table",children:e.jsx(Le,{className:"w-4 h-4"})})}),e.jsxs(ie,{className:"bg-background border-white/10",children:[e.jsx(ce,{children:e.jsx(de,{children:"Insert Table"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"rows",children:"Number of Rows"}),e.jsx(r,{id:"rows",type:"number",min:"1",max:"20",value:u,onChange:e=>p(e.target.value),className:"bg-background/50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"cols",children:"Number of Columns"}),e.jsx(r,{id:"cols",type:"number",min:"1",max:"10",value:m,onChange:e=>f(e.target.value),className:"bg-background/50"})]}),e.jsx(o,{onClick:()=>{s.chain().focus().insertTable({rows:parseInt(u),cols:parseInt(m),withHeaderRow:!0}).run(),h(!1)},className:"w-full",children:"Insert Table"})]})]})]}),v&&e.jsxs(te,{children:[e.jsx(se,{asChild:!0,children:e.jsxs(o,{type:"button",variant:"ghost",size:"sm",title:"Table Options - Manage table",className:"gap-1 bg-white/10",children:[e.jsx($e,{className:"w-4 h-4"}),e.jsx(ue,{className:"w-3 h-3"})]})}),e.jsxs(ne,{align:"start",className:"bg-background border-white/10",children:[e.jsx(le,{onClick:()=>{s.chain().focus().addColumnBefore().run()},className:"cursor-pointer hover:bg-white/10",children:"Add Column Before"}),e.jsx(le,{onClick:()=>{s.chain().focus().addColumnAfter().run()},className:"cursor-pointer hover:bg-white/10",children:"Add Column After"}),e.jsx(le,{onClick:()=>{s.chain().focus().deleteColumn().run()},className:"cursor-pointer hover:bg-white/10 text-red-400",children:"Delete Column"}),e.jsx(oe,{className:"bg-white/10"}),e.jsx(le,{onClick:()=>{s.chain().focus().addRowBefore().run()},className:"cursor-pointer hover:bg-white/10",children:"Add Row Before"}),e.jsx(le,{onClick:()=>{s.chain().focus().addRowAfter().run()},className:"cursor-pointer hover:bg-white/10",children:"Add Row After"}),e.jsx(le,{onClick:()=>{s.chain().focus().deleteRow().run()},className:"cursor-pointer hover:bg-white/10 text-red-400",children:"Delete Row"}),e.jsx(oe,{className:"bg-white/10"}),e.jsxs(le,{onClick:()=>{s.chain().focus().deleteTable().run()},className:"cursor-pointer hover:bg-white/10 text-red-400",children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Delete Entire Table"]})]})]}),v&&e.jsxs(re,{open:g,onOpenChange:x,children:[e.jsx(ae,{asChild:!0,children:e.jsx(o,{type:"button",variant:"ghost",size:"sm",title:"Calculate - Insert math result",children:e.jsx(Ee,{className:"w-4 h-4"})})}),e.jsxs(ie,{className:"bg-background border-white/10",children:[e.jsx(ce,{children:e.jsx(de,{children:"Calculate Math Expression"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"math",children:"Math Expression"}),e.jsx(r,{id:"math",placeholder:"e.g., 25 + 30 * 2",value:b,onChange:e=>w(e.target.value),className:"bg-background/50",onKeyDown:e=>{"Enter"===e.key&&y()}}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Supported: +, -, *, /, (), Math functions"})]}),e.jsx(o,{onClick:y,className:"w-full",children:"Calculate & Insert"})]})]})]}),e.jsxs(te,{children:[e.jsx(se,{asChild:!0,children:e.jsx(o,{type:"button",variant:"ghost",size:"sm",title:"More Options - Additional formatting tools",className:"gap-1",children:e.jsx(Fe,{className:"w-4 h-4"})})}),e.jsxs(ne,{align:"start",className:"bg-background border-white/10",children:[e.jsxs(le,{onClick:()=>s.chain().focus().toggleBlockquote().run(),className:"cursor-pointer hover:bg-white/10 "+(s.isActive("blockquote")?"bg-white/10":""),children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Blockquote"]}),e.jsxs(le,{onClick:()=>s.chain().focus().toggleCodeBlock().run(),className:"cursor-pointer hover:bg-white/10 "+(s.isActive("codeBlock")?"bg-white/10":""),children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"Code Block"]}),e.jsx(oe,{className:"bg-white/10"}),e.jsx(le,{onClick:()=>s.chain().focus().setHorizontalRule().run(),className:"cursor-pointer hover:bg-white/10",children:"Horizontal Rule"})]})]}),e.jsx("div",{className:"flex-1"}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>s.chain().focus().undo().run(),disabled:!s.can().undo(),title:"Undo (Ctrl+Z) - Undo last action",children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>s.chain().focus().redo().run(),disabled:!s.can().redo(),title:"Redo (Ctrl+Y) - Redo last action",children:e.jsx(De,{className:"w-4 h-4"})})]})]})},Fs=({content:t,onChange:s,placeholder:n="Write your content here..."})=>{const o=U({extensions:[V.configure({heading:{levels:[1,2,3]},bulletList:{keepMarks:!0,keepAttributes:!1},orderedList:{keepMarks:!0,keepAttributes:!1}}),J,Rs,ht,wt.configure({multicolor:!0}),at.configure({types:["heading","paragraph"],alignments:["left","center","right","justify"]}),Y.configure({openOnClick:!1,HTMLAttributes:{class:"text-primary underline cursor-pointer hover:text-primary/80"}}),X.configure({HTMLAttributes:{class:"max-w-full h-auto rounded-lg my-4"}}),$s.configure({resizable:!0,HTMLAttributes:{class:"border-collapse table-auto w-full my-4"}}),Ss,Ns.configure({HTMLAttributes:{class:"border border-white/20 bg-white/5 px-4 py-2 font-bold"}}),Cs.configure({HTMLAttributes:{class:"border border-white/20 px-4 py-2"}}),Z.configure({placeholder:n}),Q.configure({limit:5e4})],content:t,onUpdate:({editor:e})=>{s(e.getHTML())},editorProps:{attributes:{class:"prose prose-invert max-w-none min-h-[400px] p-4 focus:outline-none [&_h1]:text-4xl [&_h1]:font-bold [&_h1]:my-6 [&_h2]:text-3xl [&_h2]:font-bold [&_h2]:my-5 [&_h3]:text-2xl [&_h3]:font-semibold [&_h3]:my-4 [&_p]:text-base [&_p]:my-2 [&_table]:border-collapse [&_table]:w-full [&_th]:border [&_th]:border-white/20 [&_th]:bg-white/5 [&_th]:px-4 [&_th]:py-2 [&_td]:border [&_td]:border-white/20 [&_td]:px-4 [&_td]:py-2 [&_ul]:list-disc [&_ul]:ml-6 [&_ol]:list-decimal [&_ol]:ml-6"}}});return e.jsxs("div",{className:"border border-white/10 rounded-lg bg-background/50",children:[e.jsx(Es,{editor:o}),e.jsx(ee,{editor:o}),o&&e.jsxs("div",{className:"border-t border-white/10 px-4 py-2 text-xs text-text-secondary flex justify-between",children:[e.jsxs("span",{children:[o.storage.characterCount.characters()," characters"]}),e.jsxs("span",{children:[o.storage.characterCount.words()," words"]})]})]})},_s=({title:t,metaDescription:s,slug:n,excerpt:o})=>{const l=t||"Your Blog Post Title",r=s||o||"Your blog post description will appear here...",a=`greenofig.com/blog/${n||"your-post-slug"}`,i=l.length>60?l.substring(0,57)+"...":l,c=r.length>160?r.substring(0,157)+"...":r;return e.jsxs(u,{className:"glass-effect",children:[e.jsx(p,{children:e.jsxs(m,{className:"flex items-center gap-2 text-lg",children:[e.jsx(Be,{className:"w-5 h-5"}),"SEO Preview"]})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-text-secondary mb-2 flex items-center gap-1",children:[e.jsx(Pe,{className:"w-3 h-3"}),"Google Search Result"]}),e.jsxs("div",{className:"bg-background/50 p-4 rounded-lg border border-white/10",children:[e.jsx("div",{className:"text-sm text-blue-400 mb-1",children:a}),e.jsx("div",{className:"text-xl text-blue-500 hover:underline cursor-pointer mb-2",children:i}),e.jsx("div",{className:"text-sm text-text-secondary leading-relaxed",children:c})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-text-secondary",children:"Title: "}),e.jsxs("span",{className:l.length>60?"text-red-400":"text-green-400",children:[l.length,"/60"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-secondary",children:"Description: "}),e.jsxs("span",{className:r.length>160?"text-red-400":"text-green-400",children:[r.length,"/160"]})]})]}),e.jsxs("div",{className:"text-xs text-text-secondary space-y-1",children:[l.length>60&&e.jsx("p",{className:"text-yellow-400",children:" Title is too long (max 60 characters)"}),r.length>160&&e.jsx("p",{className:"text-yellow-400",children:" Description is too long (max 160 characters)"}),l.length<30&&t&&e.jsx("p",{className:"text-yellow-400",children:" Title might be too short (recommended 30-60 characters)"}),r.length<120&&s&&e.jsx("p",{className:"text-yellow-400",children:" Description might be too short (recommended 120-160 characters)"})]})]})]})},Os=t.forwardRef(({className:t,orientation:s="horizontal",...n},o)=>e.jsx("div",{ref:o,className:`shrink-0 bg-border ${"horizontal"===s?"h-[1px] w-full":"h-full w-[1px]"} ${t||""}`,...n}));Os.displayName="Separator";const Is=({onContentGenerated:s,onSEOGenerated:n})=>{const[l,c]=t.useState([{role:"assistant",content:"Hi! I'm your AI blog writing assistant. Tell me what topic you'd like to write about, and I'll help you create amazing content for your health and wellness blog!"}]),[d,h]=t.useState(""),[g,x]=t.useState(!1),[b,w]=t.useState(""),[y,v]=t.useState(null),j=t.useRef(null);t.useEffect(()=>{var e;null==(e=j.current)||e.scrollIntoView({behavior:"smooth"})},[l]);const C=async()=>{if(!d.trim()||g)return;const e=d.trim();h(""),c(t=>[...t,{role:"user",content:e}]);if(e.toLowerCase().includes("write")||e.toLowerCase().includes("create")||e.toLowerCase().includes("blog about")||1===l.length){x(!0),c(e=>[...e,{role:"assistant",content:" Generating your blog post... This may take a minute."}]);try{const t=await(async e=>{try{const t=await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=AIzaSyAtipbc8w5-_n9PCIl2H60SqIgYR0gPGB8",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:`Write a comprehensive, engaging blog post about "${e}" for a health and wellness website called GreenoFig. The blog should be:\n\n- Professional yet conversational\n- 1500-2000 words\n- Well-structured with clear headings (use HTML tags: h2, h3)\n- Include actionable tips and advice\n- Use bullet points and lists where appropriate\n- Include a compelling introduction and conclusion\n- SEO-friendly\n- Written in HTML format\n\nWrite only the blog content, starting with an h2 heading. Do not include a title or meta information.`}]}],generationConfig:{temperature:.7,maxOutputTokens:4096}})}),s=await t.json();if(s.candidates&&s.candidates[0])return s.candidates[0].content.parts[0].text;throw new Error("No content generated")}catch(t){throw t}})(e);w(t),c(e=>{const t=[...e];return t[t.length-1]={role:"assistant",content:" I've generated a comprehensive blog post for you! You can preview it below and copy it to the editor.\n\nWould you like me to generate SEO elements (title, meta description, keywords) as well?"},t})}catch(t){c(e=>{const t=[...e];return t[t.length-1]={role:"assistant",content:" Sorry, I encountered an error generating the blog. Please try again or rephrase your request."},t}),i({title:"Error",description:"Failed to generate blog content",variant:"destructive"})}finally{x(!1)}}else if(e.toLowerCase().includes("seo")||e.toLowerCase().includes("yes"))if(b){x(!0),c(e=>[...e,{role:"assistant",content:" Generating SEO elements..."}]);try{const e=await(async e=>{try{const t=await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=AIzaSyAtipbc8w5-_n9PCIl2H60SqIgYR0gPGB8",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:`Based on this blog content, generate SEO elements in JSON format:\n\nBlog Content:\n${e.substring(0,1e3)}...\n\nGenerate a JSON object with these fields:\n{\n  "title": "Compelling blog title (50-60 characters)",\n  "metaTitle": "SEO-optimized meta title (50-60 characters)",\n  "metaDescription": "Engaging meta description (150-160 characters)",\n  "slug": "url-friendly-slug",\n  "excerpt": "Brief excerpt (150-200 characters)",\n  "focusKeyword": "main keyword phrase",\n  "keywords": ["keyword1", "keyword2", "keyword3", "keyword4", "keyword5"]\n}\n\nReturn ONLY the JSON object, no other text.`}]}],generationConfig:{temperature:.5,maxOutputTokens:500}})}),s=await t.json();if(s.candidates&&s.candidates[0]){const e=s.candidates[0].content.parts[0].text,t=e.match(/```json\n([\s\S]*?)\n```/)||e.match(/\{[\s\S]*\}/);return t?JSON.parse(t[1]||t[0]):JSON.parse(e)}throw new Error("No SEO data generated")}catch(t){throw t}})(b);v(e),c(e=>{const t=[...e];return t[t.length-1]={role:"assistant",content:" SEO elements generated! Check the preview below to see how it will look on Google.\n\nYou can now copy everything to your blog editor!"},t})}catch(t){c(e=>{const t=[...e];return t[t.length-1]={role:"assistant",content:" Sorry, I had trouble generating SEO elements. You can create them manually in the editor."},t})}finally{x(!1)}}else c(e=>[...e,{role:"assistant",content:"Please generate a blog post first, then I can help with SEO!"}]);else c(e=>[...e,{role:"assistant",content:"I can help you write blog posts! Just tell me what topic you want to write about, or ask me to generate a blog about a specific subject."}])};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(u,{children:[e.jsx(p,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-5 h-5 text-primary"}),"AI Blog Writing Assistant"]})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"h-96 overflow-y-auto space-y-3 p-4 bg-muted/20 rounded-lg",children:[l.map((t,s)=>e.jsxs("div",{className:"flex gap-3 "+("user"===t.role?"justify-end":"justify-start"),children:["assistant"===t.role&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(We,{className:"w-4 h-4 text-primary"})}),e.jsx("div",{className:"max-w-[80%] rounded-lg p-3 "+("user"===t.role?"bg-primary text-primary-foreground":"bg-background border"),children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t.content})}),"user"===t.role&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary flex items-center justify-center flex-shrink-0",children:e.jsx(Ge,{className:"w-4 h-4 text-primary-foreground"})})]},s)),e.jsx("div",{ref:j})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{value:d,onChange:e=>h(e.target.value),onKeyPress:e=>"Enter"===e.key&&!e.shiftKey&&C(),placeholder:"e.g., Write a blog about the benefits of morning meditation...",disabled:g}),e.jsx(o,{onClick:C,disabled:g||!d.trim(),size:"icon",children:g?e.jsx(Ke,{className:"w-4 h-4 animate-spin"}):e.jsx(qe,{className:"w-4 h-4"})}),e.jsx(o,{onClick:()=>{c([{role:"assistant",content:"Hi! I'm your AI blog writing assistant. Tell me what topic you'd like to write about, and I'll help you create amazing content for your health and wellness blog!"}]),w(""),v(null)},variant:"outline",size:"icon",disabled:g,children:e.jsx(Ue,{className:"w-4 h-4"})})]})]})]}),b&&e.jsxs(u,{children:[e.jsx(p,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-5 h-5 text-yellow-500"}),"Generated Blog Content"]}),e.jsxs(o,{onClick:()=>{b&&(s(b),i({title:"Content Copied!",description:"Blog content has been added to the editor"}))},size:"sm",children:[e.jsx(Je,{className:"w-4 h-4 mr-2"}),"Copy to Editor"]})]})}),e.jsx(f,{children:e.jsx("div",{className:"max-h-96 overflow-y-auto p-4 bg-muted/20 rounded-lg",children:e.jsx("div",{className:"prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:b}})})})]}),y&&e.jsxs(u,{children:[e.jsx(p,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5 text-blue-500"}),"Google Search Preview"]}),e.jsxs(o,{onClick:()=>{y&&(n(y),i({title:"SEO Data Applied!",description:"Title, meta description, and keywords have been added"}))},size:"sm",children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"}),"Apply SEO Data"]})]})}),e.jsxs(f,{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-white border rounded-lg",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("span",{children:"greenofig.com"}),e.jsx("span",{children:""}),e.jsx("span",{className:"text-gray-500",children:y.slug})]}),e.jsx("h3",{className:"text-xl text-blue-600 hover:underline cursor-pointer",children:y.metaTitle}),e.jsx("p",{className:"text-sm text-gray-600",children:y.metaDescription})]})}),e.jsx(Os,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Title"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:y.title})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Excerpt"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:y.excerpt})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Focus Keyword"}),e.jsx(a,{variant:"secondary",children:y.focusKeyword})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Keywords"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:y.keywords.map((t,s)=>e.jsx(a,{variant:"outline",children:t},s))})]})]})]})]})]})},Ds=()=>{var A;const{postId:k}=s(),M=n(),{user:T,userProfile:z}=c(),[H,L]=t.useState(""),[$,R]=t.useState(""),[E,F]=t.useState(""),[_,O]=t.useState("draft"),[I,D]=t.useState(""),[B,P]=t.useState(""),[W,G]=t.useState(""),[K,q]=t.useState([]),[U,V]=t.useState(""),[J,Y]=t.useState(!1),[X,Z]=t.useState(""),[Q,ee]=t.useState(""),[te,se]=t.useState([]),[ne,oe]=t.useState([]),[le,re]=t.useState([]),[ae,ie]=t.useState(0),[ce,de]=t.useState(!1),[he,ue]=t.useState(!!k),[pe,me]=t.useState("editor"),[fe,ge]=t.useState(!0),xe=t.useCallback(()=>"nutritionist"===(null==z?void 0:z.role)?"/app/nutritionist?tab=blog":"/app/admin?tab=blog",[z]);t.useEffect(()=>{(async()=>{const[e,t]=await Promise.all([h.from("blog_categories").select("*").order("name"),h.from("blog_tags").select("*").order("name")]);e.data&&oe(e.data),t.data&&re(t.data)})()},[]),t.useEffect(()=>{if(k){(async()=>{ue(!0);const{data:e,error:t}=await h.from("blog_posts").select("*").eq("id",k).single();if(t)return i({title:"Error fetching post data",description:t.message,variant:"destructive"}),M(xe()),void ue(!1);const{data:s,error:n}=await h.from("blog_post_tags").select("tag_id").eq("post_id",k);e&&(L(e.title),R(e.content||""),F(e.cover_image_url||""),O(e.status),D(e.slug||""),P(e.meta_description||""),G(e.excerpt||""),q(e.keywords||[]),Y(e.featured||!1),Z(e.scheduled_publish_at||""),ee(e.category_id||""),ie(e.reading_time_minutes||0),ge(!1),s&&s.length>0&&se(s.map(e=>e.tag_id))),ue(!1)})()}},[k]),t.useEffect(()=>{if(fe&&H){const e=H.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim();D(e)}},[H,fe]),t.useEffect(()=>{if($){const e=$.replace(/<[^>]*>/g,"").split(/\s+/).filter(e=>e.length>0).length,t=Math.ceil(e/200);ie(t)}},[$]),t.useEffect(()=>{if($&&!W&&!k){const e=$.replace(/<[^>]*>/g,"").substring(0,200).trim();e.length>0&&G(e)}},[$,W,k]);const be=()=>{U.trim()&&!K.includes(U.trim())&&(q([...K,U.trim()]),V(""))};return he?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Ke,{className:"w-12 h-12 animate-spin text-primary"})}):e.jsxs(Xe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-7xl mx-auto py-6 px-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>M(xe()),className:"mr-2",children:e.jsx(Ze,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-3xl font-bold",children:k?"Edit Post":"Create New Post"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{variant:"outline",onClick:()=>me("preview"),children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Preview"]}),e.jsxs(o,{onClick:async()=>{if(!H||!$)return void i({title:"Title and content are required",variant:"destructive"});if(!I)return void i({title:"Slug is required",variant:"destructive"});de(!0);const e={title:H,content:$,cover_image_url:E||null,status:X&&"published"===_?"scheduled":_,author_id:T.id,slug:I,meta_description:B||null,excerpt:W||null,keywords:K.length>0?K:null,featured:J,scheduled_publish_at:X||null,category_id:Q||null,reading_time_minutes:ae,published_at:"published"!==_||k?void 0:(new Date).toISOString()};let t,s=k;if(k){const{error:s}=await h.from("blog_posts").update(e).eq("id",k);t=s}else{const{data:n,error:o}=await h.from("blog_posts").insert(e).select().single();t=o,n&&(s=n.id)}if(t)return i({title:"Error saving post",description:t.message,variant:"destructive"}),void de(!1);if(s&&(await h.from("blog_post_tags").delete().eq("post_id",s),te.length>0)){const e=te.map(e=>({post_id:s,tag_id:e}));await h.from("blog_post_tags").insert(e)}i({title:"Post saved successfully!"}),M(xe()),de(!1)},disabled:ce,children:[ce?e.jsx(Ke,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(et,{className:"w-4 h-4 mr-2"}),k?"Update Post":"Save Post"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs(x,{value:pe,onValueChange:me,children:[e.jsxs(b,{className:"grid w-full grid-cols-4",children:[e.jsxs(w,{value:"ai-assistant",children:[e.jsx(Ve,{className:"w-4 h-4 mr-1"}),"AI Assistant"]}),e.jsx(w,{value:"editor",children:"Editor"}),e.jsx(w,{value:"seo",children:"SEO"}),e.jsx(w,{value:"preview",children:"Preview"})]}),e.jsx(y,{value:"ai-assistant",className:"space-y-4",children:e.jsx(Is,{onContentGenerated:e=>{R(e),me("editor")},onSEOGenerated:e=>{L(e.title),D(e.slug),P(e.metaDescription),G(e.excerpt),q(e.keywords),me("seo")}})}),e.jsx(y,{value:"editor",className:"space-y-4",children:e.jsx(u,{className:"glass-effect",children:e.jsxs(f,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"title",children:"Post Title *"}),e.jsx(r,{id:"title",placeholder:"Your amazing blog post title",value:H,onChange:e=>L(e.target.value),className:"text-2xl font-bold"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"content",children:"Content *"}),e.jsx(Fs,{content:$,onChange:R,placeholder:"Write your masterpiece here..."}),e.jsx("div",{className:"flex justify-between text-xs text-text-secondary",children:e.jsxs("span",{children:["Reading time: ~",ae," min"]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"excerpt",children:"Excerpt"}),e.jsx(d,{id:"excerpt",placeholder:"Brief summary of your post (auto-generated if empty)",value:W,onChange:e=>G(e.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"cover-image",children:"Cover Image URL"}),e.jsx(r,{id:"cover-image",placeholder:"https://source.unsplash.com/random",value:E,onChange:e=>F(e.target.value)}),E&&e.jsx("img",{src:E,alt:"Cover preview",className:"w-full h-48 object-cover rounded-lg"})]})]})})}),e.jsxs(y,{value:"seo",className:"space-y-4",children:[e.jsxs(u,{className:"glass-effect",children:[e.jsx(p,{children:e.jsx(m,{children:"SEO Settings"})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{htmlFor:"slug",children:"URL Slug *"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{htmlFor:"auto-slug",className:"text-xs text-text-secondary",children:"Auto-generate"}),e.jsx(g,{id:"auto-slug",checked:fe,onCheckedChange:ge})]})]}),e.jsx(r,{id:"slug",placeholder:"your-post-slug",value:I,onChange:e=>{D(e.target.value),ge(!1)},disabled:fe}),e.jsxs("p",{className:"text-xs text-text-secondary",children:["URL: greenofig.com/blog/",I||"your-post-slug"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"meta-description",children:"Meta Description"}),e.jsx(d,{id:"meta-description",placeholder:"Brief description for search engines (120-160 characters)",value:B,onChange:e=>P(e.target.value),rows:3,maxLength:160}),e.jsxs("p",{className:"text-xs text-text-secondary text-right",children:[B.length,"/160"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"keywords",children:"Keywords"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{id:"keywords",placeholder:"Add keyword and press Enter",value:U,onChange:e=>V(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),be())}}),e.jsx(o,{type:"button",onClick:be,children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:K.map((t,s)=>e.jsxs(a,{variant:"secondary",className:"flex items-center gap-1",children:[t,e.jsx(tt,{className:"w-3 h-3 cursor-pointer",onClick:()=>(e=>{q(K.filter(t=>t!==e))})(t)})]},s))})]})]})]}),e.jsx(_s,{title:H,metaDescription:B,slug:I,excerpt:W})]}),e.jsx(y,{value:"preview",className:"space-y-4",children:e.jsx(u,{className:"glass-effect",children:e.jsxs(f,{className:"p-8",children:[E&&e.jsx("img",{src:E,alt:H,className:"w-full h-64 object-cover rounded-lg mb-6"}),e.jsx("h1",{className:"text-4xl font-bold mb-4",children:H||"Your Post Title"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-text-secondary mb-6",children:[e.jsxs("span",{children:[ae," min read"]}),Q&&e.jsx("span",{children:null==(A=ne.find(e=>e.id===Q))?void 0:A.name})]}),e.jsx("div",{className:"prose prose-invert max-w-none",dangerouslySetInnerHTML:{__html:$||"<p>Your content will appear here...</p>"}})]})})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(u,{className:"glass-effect",children:[e.jsx(p,{children:e.jsx(m,{className:"text-lg",children:"Publishing"})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Status"}),e.jsxs(v,{value:_,onValueChange:O,children:[e.jsx(j,{children:e.jsx(C,{})}),e.jsxs(N,{children:[e.jsx(S,{value:"draft",children:"Draft"}),e.jsx(S,{value:"published",children:"Published"}),e.jsx(S,{value:"archived",children:"Archived"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(st,{className:"w-4 h-4"}),e.jsx(l,{htmlFor:"featured",children:"Featured Post"})]}),e.jsx(g,{id:"featured",checked:J,onCheckedChange:Y})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"scheduled",className:"flex items-center gap-2",children:[e.jsx(nt,{className:"w-4 h-4"}),"Schedule Publishing"]}),e.jsx(r,{id:"scheduled",type:"datetime-local",value:X,onChange:e=>Z(e.target.value),className:"w-full min-w-0"})]})]})]}),e.jsxs(u,{className:"glass-effect",children:[e.jsx(p,{children:e.jsxs(m,{className:"text-lg flex items-center gap-2",children:[e.jsx(ot,{className:"w-4 h-4"}),"Category"]})}),e.jsx(f,{children:e.jsxs(v,{value:Q,onValueChange:ee,children:[e.jsx(j,{children:e.jsx(C,{placeholder:"Select category"})}),e.jsx(N,{children:ne.map(t=>e.jsx(S,{value:t.id,children:t.name},t.id))})]})})]}),e.jsxs(u,{className:"glass-effect",children:[e.jsx(p,{children:e.jsxs(m,{className:"text-lg flex items-center gap-2",children:[e.jsx(lt,{className:"w-4 h-4"}),"Tags"]})}),e.jsx(f,{children:e.jsx("div",{className:"flex flex-wrap gap-2",children:le.map(t=>e.jsx(a,{variant:te.includes(t.id)?"default":"outline",className:"cursor-pointer",onClick:()=>{return e=t.id,void(te.includes(e)?se(te.filter(t=>t!==e)):se([...te,e]));var e},children:t.name},t.id))})})]}),k&&e.jsxs(u,{className:"glass-effect",children:[e.jsx(p,{children:e.jsxs(m,{className:"text-lg flex items-center gap-2",children:[e.jsx(rt,{className:"w-4 h-4"}),"Statistics"]})}),e.jsx(f,{className:"space-y-2 text-sm",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-secondary",children:"Reading Time:"}),e.jsxs("span",{children:[ae," min"]})]})})]})]})]})]})};export{Ds as default};
