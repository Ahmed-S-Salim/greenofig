import{j as e}from"./vendor-ui-CAdTc8ma.js";import{R as s,u as t,a}from"./vendor-react-DYWoKpfz.js";import{B as l,s as r,t as i,I as n,e as c}from"./index-xFs2J342.js";import{C as o,a as d,b as m,c as x,e as h}from"./card-Druh6IIU.js";import{N as u,am as p,b as g,ad as j,an as f,ao as N,T as v,i as b,ap as w,aa as y,aq as _,ah as C,n as k,J as P,f as S,G as E,o as D,al as M,K as $,P as A}from"./vendor-utils-7_dm-8Ld.js";import{T as z,a as T,b as V,c as F}from"./tabs-vw2b6a3A.js";import{C as R}from"./checkbox-BvmbMZJl.js";class I extends s.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,s){console.error("Error caught by boundary:",e,s),this.setState({error:e,errorInfo:s})}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(o,{className:"max-w-2xl w-full glass-effect",children:[e.jsx(d,{children:e.jsxs(m,{className:"flex items-center gap-3 text-2xl",children:[e.jsx(u,{className:"w-8 h-8 text-red-500"}),"Something Went Wrong"]})}),e.jsxs(x,{className:"space-y-4",children:[e.jsx("p",{className:"text-text-secondary",children:"We encountered an unexpected error. This has been logged and we'll look into it."}),this.state.error&&e.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-lg",children:e.jsx("p",{className:"font-mono text-sm text-red-400",children:this.state.error.toString()})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(l,{onClick:this.handleReset,className:"flex items-center gap-2",children:[e.jsx(p,{className:"w-4 h-4"}),"Try Again"]}),e.jsx(l,{variant:"outline",onClick:()=>{const e=window.location.hostname.includes("github.io")?"/greenofig":"";window.location.href=`${e}/app/admin`},children:"Go to Dashboard"})]}),!1]})]})}):this.props.children}}const L=({user:s})=>{const I=t(),[L,q]=a.useState([]),[B,W]=a.useState([]),[G,J]=a.useState([]),[K,O]=a.useState(""),[U,H]=a.useState("all"),[Q,X]=a.useState("all"),[Y,Z]=a.useState("all"),[ee,se]=a.useState(!0),[te,ae]=a.useState("posts"),[le,re]=a.useState([]),[ie,ne]=a.useState([]),[ce,oe]=a.useState([]),[de,me]=a.useState([]),[xe,he]=a.useState({totalPosts:0,publishedPosts:0,draftPosts:0,scheduledPosts:0,totalViews:0,totalComments:0,pendingComments:0,avgViewsPerPost:0});a.useEffect(()=>{ue(),pe(),ge(),je(),fe()},[]),a.useEffect(()=>{Ne()},[K,U,Q,Y,L]);const ue=async()=>{se(!0);try{const{data:e,error:s}=await r.from("blog_posts").select("\n          *,\n          author:user_profiles!blog_posts_author_id_fkey(id, full_name, email)\n        ").order("created_at",{ascending:!1});if(s)throw s;q(e||[])}catch(e){console.error("Error fetching posts:",e),i({variant:"destructive",title:"Error",description:"Failed to fetch blog posts"})}finally{se(!1)}},pe=async()=>{try{const{data:e,error:s}=await r.from("blog_categories").select("*").order("name",{ascending:!0});if(s)throw s;W(e||[])}catch(e){console.error("Error fetching categories:",e)}},ge=async()=>{try{const{data:e,error:s}=await r.from("user_profiles").select("id, full_name, email, role").in("role",["nutritionist","admin","super_admin"]).order("full_name",{ascending:!0});if(s)throw s;ne(e||[])}catch(e){console.error("Error fetching authors:",e)}},je=async()=>{try{const{data:e,error:s}=await r.from("blog_comments").select("\n          *,\n          blog_post:blog_posts(title, slug),\n          user:user_profiles(full_name)\n        ").order("created_at",{ascending:!1});if(s)throw s;oe(e||[]),me(e?.filter(e=>!e.is_approved)||[])}catch(e){console.error("Error fetching comments:",e)}},fe=async()=>{try{const{data:e}=await r.from("blog_posts").select("status, view_count"),{data:s}=await r.from("blog_comments").select("is_approved");if(e){const t=e.reduce((e,s)=>e+(s.view_count||0),0),a={totalPosts:e.length,publishedPosts:e.filter(e=>"published"===e.status).length,draftPosts:e.filter(e=>"draft"===e.status).length,scheduledPosts:e.filter(e=>"scheduled"===e.status).length,totalViews:t,totalComments:s?.length||0,pendingComments:s?.filter(e=>!e.is_approved).length||0,avgViewsPerPost:e.length>0?Math.round(t/e.length):0};he(a)}}catch(e){console.error("Error fetching analytics:",e)}},Ne=()=>{let e=L;K&&(e=e.filter(e=>e.title?.toLowerCase().includes(K.toLowerCase())||e.excerpt?.toLowerCase().includes(K.toLowerCase()))),"all"!==U&&(e=e.filter(e=>e.status===U)),"all"!==Q&&(e=e.filter(e=>e.author_id===Q)),"all"!==Y&&(e=e.filter(e=>e.category===Y)),J(e)},ve=async e=>{if(0!==le.length)try{switch(e){case"publish":await r.from("blog_posts").update({status:"published",published_at:(new Date).toISOString()}).in("id",le),i({title:`Published ${le.length} posts`});break;case"draft":await r.from("blog_posts").update({status:"draft"}).in("id",le),i({title:`Moved ${le.length} posts to draft`});break;case"archive":await r.from("blog_posts").update({status:"archived"}).in("id",le),i({title:`Archived ${le.length} posts`});break;case"delete":confirm(`Delete ${le.length} posts permanently?`)&&(await r.from("blog_posts").delete().in("id",le),i({title:`Deleted ${le.length} posts`}))}re([]),ue(),fe()}catch(s){console.error("Bulk action error:",s),i({variant:"destructive",title:"Error",description:"Failed to perform bulk action"})}else i({variant:"destructive",title:"No posts selected",description:"Please select posts to perform bulk actions"})},be=({icon:s,title:t,value:a,change:l,color:r})=>e.jsx(o,{children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:t}),e.jsx("h3",{className:"text-3xl font-bold text-foreground",children:a}),l&&e.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400 mt-1 flex items-center gap-1",children:[e.jsx(P,{className:"w-4 h-4"}),l]})]}),e.jsx("div",{className:`p-4 rounded-full ${r||"bg-primary/10"}`,children:e.jsx(s,{className:"w-6 h-6 text-primary"})})]})})}),we=({post:t})=>{const a=le.includes(t.id);return e.jsx(o,{className:"glass-effect hover:shadow-lg transition-all "+(a?"ring-2 ring-primary":""),children:e.jsxs(x,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx(R,{checked:a,onCheckedChange:()=>{return e=t.id,void re(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e]);var e}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:t.title}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:t.excerpt||"No excerpt"})]}),e.jsx(c,{className:{draft:"bg-gray-500",published:"bg-green-500",scheduled:"bg-blue-500",archived:"bg-red-500"}[t.status],children:t.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{children:t.author?.full_name||"Unknown"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:[t.view_count||0," views"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{children:t.published_at?E(new Date(t.published_at),"MMM d"):"Not published"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(v,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{children:t.focus_keyword||"No keyword"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{const e="nutritionist"===s?.role?"nutritionist":"admin";console.log("Edit clicked, navigating to:",`/app/${e}/blog/edit/${t.id}`),I(`/app/${e}/blog/edit/${t.id}`)},className:"flex-1",children:[e.jsx(A,{className:"w-4 h-4 mr-1"}),"Edit"]}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this post?"))try{const{error:s}=await r.from("blog_posts").delete().eq("id",e);if(s)throw s;i({title:"Post deleted successfully"}),ue(),fe()}catch(s){console.error("Error deleting post:",s),i({variant:"destructive",title:"Error",description:"Failed to delete post"})}})(t.id),className:"text-destructive",children:e.jsx(C,{className:"w-4 h-4"})}),"published"===t.status&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{const e=window.location.hostname.includes("github.io")?"/greenofig":"";window.open(`${e}/blog/${t.slug}`,"_blank")},children:e.jsx(k,{className:"w-4 h-4"})})]})]})})};return ee?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(g,{className:"w-12 h-12 animate-spin text-primary"})}):e.jsx("div",{className:"min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-2 sm:px-4 lg:px-6 py-4 sm:py-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl lg:text-2xl font-bold",children:"Blog Management"}),e.jsx("p",{className:"text-xs sm:text-sm text-text-secondary mt-1",children:"Manage all blog posts, categories, and comments"})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:ue,className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",children:[e.jsx(p,{className:"w-4 h-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]}),e.jsxs(l,{size:"sm",onClick:()=>{const e="nutritionist"===s?.role?"nutritionist":"admin";console.log("Create Post clicked, navigating to:",`/app/${e}/blog/new`),I(`/app/${e}/blog/new`)},className:"h-8 px-2 text-xs sm:h-9 sm:px-3 sm:text-sm",children:[e.jsx(j,{className:"w-4 h-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Create Post"}),e.jsx("span",{className:"inline sm:hidden",children:"New"})]})]})]}),e.jsxs(z,{value:te,onValueChange:ae,children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsxs(T,{className:"w-full max-w-full overflow-x-auto flex-nowrap scrollbar-hide h-auto justify-start sm:justify-center px-1",children:[e.jsxs(V,{value:"posts",className:"flex-shrink-0 text-xs sm:text-sm px-2 sm:px-3 py-2",children:[e.jsx(f,{className:"w-3 h-3 sm:w-4 sm:h-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Posts"}),e.jsx("span",{className:"inline sm:hidden",children:"Posts"}),e.jsxs("span",{className:"ml-1",children:["(",xe.totalPosts,")"]})]}),e.jsxs(V,{value:"analytics",className:"flex-shrink-0 text-xs sm:text-sm px-2 sm:px-3 py-2",children:[e.jsx(N,{className:"w-3 h-3 sm:w-4 sm:h-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Analytics"}),e.jsx("span",{className:"inline sm:hidden",children:"Stats"})]}),e.jsxs(V,{value:"categories",className:"flex-shrink-0 text-xs sm:text-sm px-2 sm:px-3 py-2",children:[e.jsx(v,{className:"w-3 h-3 sm:w-4 sm:h-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Categories"}),e.jsx("span",{className:"inline sm:hidden",children:"Cat"}),e.jsxs("span",{className:"ml-1",children:["(",B.length,")"]})]}),e.jsxs(V,{value:"comments",className:"flex-shrink-0 text-xs sm:text-sm px-2 sm:px-3 py-2",children:[e.jsx(b,{className:"w-3 h-3 sm:w-4 sm:h-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Comments"}),e.jsx("span",{className:"inline sm:hidden",children:"Msgs"}),e.jsxs("span",{className:"ml-1",children:["(",xe.pendingComments,")"]})]})]})}),e.jsxs(F,{value:"posts",className:"space-y-4",children:[e.jsx(o,{className:"glass-effect",children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(w,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(n,{placeholder:"Search posts...",value:K,onChange:e=>O(e.target.value),className:"pl-10"})]}),e.jsxs("select",{value:U,onChange:e=>H(e.target.value),className:"px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"published",children:"Published"}),e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"scheduled",children:"Scheduled"}),e.jsx("option",{value:"archived",children:"Archived"})]}),e.jsxs("select",{value:Q,onChange:e=>X(e.target.value),className:"px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"all",children:"All Authors"}),ie.map(s=>e.jsx("option",{value:s.id,children:s.full_name},s.id))]}),e.jsxs("select",{value:Y,onChange:e=>Z(e.target.value),className:"px-3 py-2 bg-background border border-border rounded-md",children:[e.jsx("option",{value:"all",children:"All Categories"}),B.map(s=>e.jsx("option",{value:s.slug,children:s.name},s.id))]})]}),le.length>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 p-3 bg-primary/10 rounded-lg",children:[e.jsxs("span",{className:"text-xs sm:text-sm font-medium",children:[le.length," selected"]}),e.jsxs("div",{className:"flex flex-wrap gap-2 w-full sm:w-auto sm:ml-auto",children:[e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>ve("publish"),className:"h-8 px-2 text-xs",children:[e.jsx(y,{className:"w-3 h-3 sm:w-4 sm:h-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Publish"})]}),e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>ve("draft"),className:"h-8 px-2 text-xs",children:[e.jsx(f,{className:"w-3 h-3 sm:w-4 sm:h-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Draft"})]}),e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>ve("archive"),className:"h-8 px-2 text-xs",children:[e.jsx(_,{className:"w-3 h-3 sm:w-4 sm:h-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Archive"})]}),e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>ve("delete"),className:"h-8 px-2 text-xs text-destructive",children:[e.jsx(C,{className:"w-3 h-3 sm:w-4 sm:h-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Delete"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{checked:le.length===G.length&&G.length>0,onCheckedChange:()=>{le.length===G.length?re([]):re(G.map(e=>e.id))}}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Select All (",G.length," posts)"]})]})]})})}),G.length>0?e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4",children:G.map(s=>e.jsx(we,{post:s},s.id))}):e.jsx(o,{className:"glass-effect",children:e.jsxs(x,{className:"p-12 text-center",children:[e.jsx(f,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No posts found"}),e.jsx("p",{className:"text-muted-foreground",children:K||"all"!==U?"Try adjusting your filters":"No blog posts yet"})]})})]}),e.jsxs(F,{value:"analytics",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(be,{icon:f,title:"Total Posts",value:xe.totalPosts}),e.jsx(be,{icon:y,title:"Published",value:xe.publishedPosts}),e.jsx(be,{icon:k,title:"Total Views",value:xe.totalViews.toLocaleString()}),e.jsx(be,{icon:P,title:"Avg Views/Post",value:xe.avgViewsPerPost})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(be,{icon:f,title:"Drafts",value:xe.draftPosts}),e.jsx(be,{icon:S,title:"Scheduled",value:xe.scheduledPosts}),e.jsx(be,{icon:b,title:"Total Comments",value:xe.totalComments}),e.jsx(be,{icon:u,title:"Pending Comments",value:xe.pendingComments})]}),e.jsxs(o,{children:[e.jsx(d,{children:e.jsx(m,{children:"Top Performing Posts"})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-3",children:L.filter(e=>"published"===e.status).sort((e,s)=>(s.view_count||0)-(e.view_count||0)).slice(0,10).map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 text-primary font-bold",children:t+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.author?.full_name})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold",children:s.view_count||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"views"})]})]},s.id))})})]})]}),e.jsx(F,{value:"categories",className:"space-y-4",children:e.jsxs(o,{children:[e.jsxs(d,{children:[e.jsx(m,{children:"Blog Categories"}),e.jsx(h,{children:"Manage content categories"})]}),e.jsx(x,{children:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4",children:B.map(s=>e.jsxs("div",{className:"p-4 bg-card border border-border rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.description||"No description"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[L.filter(e=>e.category===s.slug).length," posts"]}),e.jsx(c,{variant:"outline",children:s.slug})]})]},s.id))})})]})}),e.jsxs(F,{value:"comments",className:"space-y-4",children:[e.jsxs(o,{children:[e.jsxs(d,{children:[e.jsxs(m,{children:["Pending Comments (",de.length,")"]}),e.jsx(h,{children:"Review and moderate comments"})]}),e.jsx(x,{children:de.length>0?e.jsx("div",{className:"space-y-3",children:de.map(s=>e.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.author_name||s.user?.full_name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:['on "',s.blog_post?.title,'"']})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:E(new Date(s.created_at),"MMM d, yyyy")})]}),e.jsx("p",{className:"text-sm mb-3",children:s.content}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{size:"sm",onClick:()=>(async e=>{try{const{error:s}=await r.from("blog_comments").update({is_approved:!0}).eq("id",e);if(s)throw s;i({title:"Comment approved"}),je(),fe()}catch(s){console.error("Error approving comment:",s),i({variant:"destructive",title:"Error",description:"Failed to approve comment"})}})(s.id),children:[e.jsx(D,{className:"w-4 h-4 mr-1"}),"Approve"]}),e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(confirm("Delete this comment?"))try{const{error:s}=await r.from("blog_comments").delete().eq("id",e);if(s)throw s;i({title:"Comment deleted"}),je(),fe()}catch(s){console.error("Error deleting comment:",s),i({variant:"destructive",title:"Error",description:"Failed to delete comment"})}})(s.id),children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]},s.id))}):e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No pending comments"})})]}),e.jsxs(o,{children:[e.jsx(d,{children:e.jsx(m,{children:"Recent Comments"})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-3",children:ce.filter(e=>e.is_approved).slice(0,10).map(s=>e.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsx("p",{className:"font-medium text-sm",children:s.author_name||s.user?.full_name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:E(new Date(s.created_at),"MMM d")})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-1",children:['on "',s.blog_post?.title,'"']}),e.jsx("p",{className:"text-sm",children:s.content})]},s.id))})})]})]})]})]})})};export{I as E,L as a};
